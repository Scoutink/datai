# C4 Forensics (Mermaid)

## System Context
```mermaid
flowchart LR
  U[End User / Consultant] --> SPA[Angular SPA]
  SPA --> API[Laravel API]
  API --> DB[(MySQL/MariaDB)]
  API --> FS[(Local/S3 Storage)]
  API --> EXT[Email/OpenAI/Gemini integrations]
```

## Container Diagram
```mermaid
flowchart TB
  subgraph Browser
    SPA[Angular app\nresources/frontend/angular]
  end
  subgraph Server
    WEB[Laravel web routes\nserves SPA]
    API[Laravel API routes\nauth + hasToken]
    SCH[Scheduler/Commands]
  end
  DB[(datai schema)]
  ST[(Storage local/s3)]

  SPA --> API
  WEB --> SPA
  API --> DB
  API --> ST
  SCH --> DB
  SCH --> ST
```

## Component Diagram: Documents module
```mermaid
flowchart LR
  DL[DocumentListComponent\nDocumentLibraryListComponent] --> DS[DocumentService / DocumentLibraryService]
  DS --> AR[/api/documents, /api/document/*]
  AR --> DC[DocumentController]
  AR --> DPC[DocumentPermissionController]
  AR --> DVC[DocumentVersionController]
  AR --> DWC[DocumentWatermarkController]
  DC --> DR[DocumentRepository]
  DPC --> DPR[DocumentPermissionRepository]
  DVC --> DVR[DocumentVersionsRepository]
  DR --> T1[(documents, permissions, comments, versions)]
```

## Component Diagram: Auth/RBAC
```mermaid
flowchart LR
  Login[LoginComponent] --> Sec[SecurityService]
  Sec --> AuthAPI[/api/auth/login,/api/auth/refresh]
  AuthAPI --> AC[AuthController]
  AC --> RC[(userRoles, roleClaims, userClaims)]
  APIReq[any protected api request] --> HT[HasToken middleware]
  HT --> JWT[(claims in JWT payload)]
  Route[Angular route + menu] --> AG[AuthGuard + hasClaim directive]
  AG --> JWT
```
