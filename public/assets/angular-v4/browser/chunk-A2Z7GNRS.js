import{b as Bt}from"./chunk-V4GBUP5U.js";import{B as Q,Ba as _,C as G,Ca as P,Da as A,Ea as l,Fa as F,G as $e,Ga as Be,H as I,Ha as jt,J as W,Ja as ce,La as B,Oc as te,Q as ae,R as U,S as Ve,Tc as Yt,W as ee,Xa as Lt,Y as Ye,a as f,ab as $t,b as R,ba as oe,bb as Vt,ca as Ut,da as q,ea as Nt,fa as xt,ga as bt,ja as Pe,la as Ft,m as re,na as wt,o as Se,oa as kt,p as ve,qa as j,s as Ae,sd as Pt,t as Tt,td as Ke,xd as Qe,ya as H,z as It}from"./chunk-SXJN2XK6.js";var Ge={};function or(n,r){if(Ge[n]=(Ge[n]||0)+1,typeof r=="function")return qe(n,(...t)=>R(f({},r(...t)),{type:n}));switch(r?r._as:"empty"){case"empty":return qe(n,()=>({type:n}));case"props":return qe(n,t=>R(f({},t),{type:n}));default:throw new Error("Unexpected config.")}}function qe(n,r){return Object.defineProperty(r,"type",{value:n,writable:!1})}var cr="@ngrx/store/init",se=(()=>{class n extends ve{constructor(){super({type:cr})}next(e){if(typeof e=="function")throw new TypeError(`
        Dispatch expected an object, instead it received a function.
        If you're using the createAction function, make sure to invoke the function
        before dispatching the action. For example, someAction should be someAction().`);if(typeof e>"u")throw new TypeError("Actions must be objects");if(typeof e.type>"u")throw new TypeError("Actions must have a type property");super.next(e)}complete(){}ngOnDestroy(){super.complete()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),hn=[se],ur=new A("@ngrx/store Internal Root Guard"),Kt=new A("@ngrx/store Internal Initial State"),Xe=new A("@ngrx/store Initial State"),dr=new A("@ngrx/store Reducer Factory"),Qt=new A("@ngrx/store Internal Reducer Factory Provider"),hr=new A("@ngrx/store Initial Reducers"),He=new A("@ngrx/store Internal Initial Reducers"),qt=new A("@ngrx/store Store Features"),Ht=new A("@ngrx/store Internal Store Reducers"),ze=new A("@ngrx/store Internal Feature Reducers"),zt=new A("@ngrx/store Internal Feature Configs"),lr=new A("@ngrx/store Internal Store Features"),Gt=new A("@ngrx/store Internal Feature Reducers Token"),fr=new A("@ngrx/store Feature Reducers"),Wt=new A("@ngrx/store User Provided Meta Reducers"),me=new A("@ngrx/store Meta Reducers"),Zt=new A("@ngrx/store Internal Resolved Meta Reducers"),Jt=new A("@ngrx/store User Runtime Checks Config"),Xt=new A("@ngrx/store Internal User Runtime Checks Config"),ue=new A("@ngrx/store Internal Runtime Checks"),et=new A("@ngrx/store Check if Action types are unique"),ln=new A("@ngrx/store Root Store Provider"),fn=new A("@ngrx/store Feature State Provider");function he(n,r={}){let e=Object.keys(n),t={};for(let i=0;i<e.length;i++){let a=e[i];typeof n[a]=="function"&&(t[a]=n[a])}let s=Object.keys(t);return function(a,o){a=a===void 0?r:a;let d=!1,c={};for(let h=0;h<s.length;h++){let y=s[h],C=t[y],x=a[y],V=C(x,o);c[y]=V,d=d||V!==x}return d?c:a}}function pn(n,r){return Object.keys(n).filter(e=>e!==r).reduce((e,t)=>Object.assign(e,{[t]:n[t]}),{})}function Ce(...n){return function(r){if(n.length===0)return r;let e=n[n.length-1];return n.slice(0,-1).reduceRight((s,i)=>i(s),e(r))}}function pr(n,r){return Array.isArray(r)&&r.length>0&&(n=Ce.apply(null,[...r,n])),(e,t)=>{let s=n(e);return(i,a)=>(i=i===void 0?t:i,s(i,a))}}function yn(n){let r=Array.isArray(n)&&n.length>0?Ce(...n):e=>e;return(e,t)=>(e=r(e),(s,i)=>(s=s===void 0?t:s,e(s,i)))}var de=class extends re{},Re=class extends se{},En="@ngrx/store/update-reducers",ne=(()=>{class n extends ve{get currentReducers(){return this.reducers}constructor(e,t,s,i){super(i(s,t)),this.dispatcher=e,this.initialState=t,this.reducers=s,this.reducerFactory=i}addFeature(e){this.addFeatures([e])}addFeatures(e){let t=e.reduce((s,{reducers:i,reducerFactory:a,metaReducers:o,initialState:d,key:c})=>{let h=typeof i=="function"?yn(o)(i,d):pr(a,o)(i,d);return s[c]=h,s},{});this.addReducers(t)}removeFeature(e){this.removeFeatures([e])}removeFeatures(e){this.removeReducers(e.map(t=>t.key))}addReducer(e,t){this.addReducers({[e]:t})}addReducers(e){this.reducers=f(f({},this.reducers),e),this.updateReducers(Object.keys(e))}removeReducer(e){this.removeReducers([e])}removeReducers(e){e.forEach(t=>{this.reducers=pn(this.reducers,t)}),this.updateReducers(e)}updateReducers(e){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:En,features:e})}ngOnDestroy(){this.complete()}static{this.\u0275fac=function(t){return new(t||n)(l(Re),l(Xe),l(hr),l(dr))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),gn=[ne,{provide:de,useExisting:ne},{provide:Re,useExisting:se}],Z=(()=>{class n extends Se{ngOnDestroy(){this.complete()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=Lt(n)))(s||n)}})()}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Sn=[Z],Me=class extends re{},er=(()=>{class n extends ve{static{this.INIT=cr}constructor(e,t,s,i){super(i);let o=e.pipe(It(Tt)).pipe(H(t)),d={state:i},c=o.pipe(kt(vn,d));this.stateSubscription=c.subscribe(({state:h,action:y})=>{this.next(h),s.next(y)}),this.state=Bt(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}static{this.\u0275fac=function(t){return new(t||n)(l(se),l(de),l(Z),l(Xe))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();function vn(n={state:void 0},[r,e]){let{state:t}=n;return{state:e(t,r),action:r}}var An=[er,{provide:Me,useExisting:er}],$=(()=>{class n extends re{constructor(e,t,s){super(),this.actionsObserver=t,this.reducerManager=s,this.source=e,this.state=e.state}select(e,...t){return Rn.call(null,e,...t)(this)}selectSignal(e,t){return Yt(()=>e(this.state()),t)}lift(e){let t=new n(this,this.actionsObserver,this.reducerManager);return t.operator=e,t}dispatch(e){this.actionsObserver.next(e)}next(e){this.actionsObserver.next(e)}error(e){this.actionsObserver.error(e)}complete(){this.actionsObserver.complete()}addReducer(e,t){this.reducerManager.addReducer(e,t)}removeReducer(e){this.reducerManager.removeReducer(e)}static{this.\u0275fac=function(t){return new(t||n)(l(Me),l(se),l(ne))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),mn=[$];function Rn(n,r,...e){return function(s){let i;if(typeof n=="string"){let a=[r,...e].filter(Boolean);i=s.pipe(wt(n,...a))}else if(typeof n=="function")i=s.pipe(I(a=>n(a,r)));else throw new TypeError(`Unexpected type '${typeof n}' in select operator, expected 'string' or 'function'`);return i.pipe(xt())}}var tt="https://ngrx.io/guide/store/configuration/runtime-checks";function tr(n){return n===void 0}function rr(n){return n===null}function yr(n){return Array.isArray(n)}function Mn(n){return typeof n=="string"}function Cn(n){return typeof n=="boolean"}function _n(n){return typeof n=="number"}function Er(n){return typeof n=="object"&&n!==null}function On(n){return Er(n)&&!yr(n)}function Dn(n){if(!On(n))return!1;let r=Object.getPrototypeOf(n);return r===Object.prototype||r===null}function We(n){return typeof n=="function"}function Tn(n){return We(n)&&n.hasOwnProperty("\u0275cmp")}function In(n,r){return Object.prototype.hasOwnProperty.call(n,r)}var Un=!1;function Nn(){return Un}function nr(n,r){return n===r}function xn(n,r,e){for(let t=0;t<n.length;t++)if(!e(n[t],r[t]))return!0;return!1}function gr(n,r=nr,e=nr){let t=null,s=null,i;function a(){t=null,s=null}function o(h=void 0){i={result:h}}function d(){i=void 0}function c(){if(i!==void 0)return i.result;if(!t)return s=n.apply(null,arguments),t=arguments,s;if(!xn(arguments,t,r))return s;let h=n.apply(null,arguments);return t=arguments,e(s,h)?s:(s=h,h)}return{memoized:c,reset:a,setResult:o,clearResult:d}}function k(...n){return Fn(gr)(...n)}function bn(n,r,e,t){if(e===void 0){let i=r.map(a=>a(n));return t.memoized.apply(null,i)}let s=r.map(i=>i(n,e));return t.memoized.apply(null,[...s,e])}function Fn(n,r={stateFn:bn}){return function(...e){let t=e;if(Array.isArray(t[0])){let[h,...y]=t;t=[...h,...y]}else t.length===1&&wn(t[0])&&(t=kn(t[0]));let s=t.slice(0,t.length-1),i=t[t.length-1],a=s.filter(h=>h.release&&typeof h.release=="function"),o=n(function(...h){return i.apply(null,h)}),d=gr(function(h,y){return r.stateFn.apply(null,[h,s,y,o])});function c(){d.reset(),o.reset(),a.forEach(h=>h.release())}return Object.assign(d.memoized,{release:c,projector:o.memoized,setResult:d.setResult,clearResult:d.clearResult})}}function Sr(n){return k(r=>{let e=r[n];return!Nn()&&te()&&!(n in r)&&console.warn(`@ngrx/store: The feature name "${n}" does not exist in the state, therefore createFeatureSelector cannot access it.  Be sure it is imported in a loaded module using StoreModule.forRoot('${n}', ...) or StoreModule.forFeature('${n}', ...).  If the default state is intended to be undefined, as is the case with router state, this development-only warning message can be ignored.`),e},r=>r)}function wn(n){return!!n&&typeof n=="object"&&Object.values(n).every(r=>typeof r=="function")}function kn(n){let r=Object.values(n),e=Object.keys(n),t=(...s)=>e.reduce((i,a,o)=>R(f({},i),{[a]:s[o]}),{});return[...r,t]}function jn(n){return n instanceof A?F(n):n}function Ln(n,r){return r.map((e,t)=>{if(n[t]instanceof A){let s=F(n[t]);return{key:e.key,reducerFactory:s.reducerFactory?s.reducerFactory:he,metaReducers:s.metaReducers?s.metaReducers:[],initialState:s.initialState}}return e})}function $n(n){return n.map(r=>r instanceof A?F(r):r)}function vr(n){return typeof n=="function"?n():n}function Vn(n,r){return n.concat(r)}function Yn(){if(F($,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function Pn(n,r){return function(e,t){let s=r.action(t)?Ze(t):t,i=n(e,s);return r.state()?Ze(i):i}}function Ze(n){Object.freeze(n);let r=We(n);return Object.getOwnPropertyNames(n).forEach(e=>{if(!e.startsWith("\u0275")&&In(n,e)&&(!r||e!=="caller"&&e!=="callee"&&e!=="arguments")){let t=n[e];(Er(t)||We(t))&&!Object.isFrozen(t)&&Ze(t)}}),n}function Bn(n,r){return function(e,t){if(r.action(t)){let i=Je(t);sr(i,"action")}let s=n(e,t);if(r.state()){let i=Je(s);sr(i,"state")}return s}}function Je(n,r=[]){return(tr(n)||rr(n))&&r.length===0?{path:["root"],value:n}:Object.keys(n).reduce((t,s)=>{if(t)return t;let i=n[s];return Tn(i)?t:tr(i)||rr(i)||_n(i)||Cn(i)||Mn(i)||yr(i)?!1:Dn(i)?Je(i,[...r,s]):{path:[...r,s],value:i}},!1)}function sr(n,r){if(n===!1)return;let e=n.path.join("."),t=new Error(`Detected unserializable ${r} at "${e}". ${tt}#strict${r}serializability`);throw t.value=n.value,t.unserializablePath=e,t}function Kn(n,r){return function(e,t){if(r.action(t)&&!$t.isInAngularZone())throw new Error(`Action '${t.type}' running outside NgZone. ${tt}#strictactionwithinngzone`);return n(e,t)}}function Qn(n){return te()?f({strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1},n):{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function qn({strictActionSerializability:n,strictStateSerializability:r}){return e=>n||r?Bn(e,{action:t=>n&&!rt(t),state:()=>r}):e}function Hn({strictActionImmutability:n,strictStateImmutability:r}){return e=>n||r?Pn(e,{action:t=>n&&!rt(t),state:()=>r}):e}function rt(n){return n.type.startsWith("@ngrx")}function zn({strictActionWithinNgZone:n}){return r=>n?Kn(r,{action:e=>n&&!rt(e)}):r}function Gn(n){return[{provide:Xt,useValue:n},{provide:Jt,useFactory:Wn,deps:[Xt]},{provide:ue,deps:[Jt],useFactory:Qn},{provide:me,multi:!0,deps:[ue],useFactory:Hn},{provide:me,multi:!0,deps:[ue],useFactory:qn},{provide:me,multi:!0,deps:[ue],useFactory:zn}]}function Ar(){return[{provide:et,multi:!0,deps:[ue],useFactory:Zn}]}function Wn(n){return n}function Zn(n){if(!n.strictActionTypeUniqueness)return;let r=Object.entries(Ge).filter(([,e])=>e>1).map(([e])=>e);if(r.length)throw new Error(`Action types are registered more than once, ${r.map(e=>`"${e}"`).join(", ")}. ${tt}#strictactiontypeuniqueness`)}function Jn(n={},r={}){return[{provide:ur,useFactory:Yn},{provide:Kt,useValue:r.initialState},{provide:Xe,useFactory:vr,deps:[Kt]},{provide:He,useValue:n},{provide:Ht,useExisting:n instanceof A?n:He},{provide:hr,deps:[He,[new Be(Ht)]],useFactory:jn},{provide:Wt,useValue:r.metaReducers?r.metaReducers:[]},{provide:Zt,deps:[me,Wt],useFactory:Vn},{provide:Qt,useValue:r.reducerFactory?r.reducerFactory:he},{provide:dr,deps:[Qt,Zt],useFactory:pr},hn,gn,Sn,An,mn,Gn(r.runtimeChecks),Ar()]}function Xn(n,r,e={}){return[{provide:zt,multi:!0,useValue:n instanceof Object?{}:e},{provide:qt,multi:!0,useValue:{key:n instanceof Object?n.name:n,reducerFactory:!(e instanceof A)&&e.reducerFactory?e.reducerFactory:he,metaReducers:!(e instanceof A)&&e.metaReducers?e.metaReducers:[],initialState:!(e instanceof A)&&e.initialState?e.initialState:void 0}},{provide:lr,deps:[zt,qt],useFactory:Ln},{provide:ze,multi:!0,useValue:n instanceof Object?n.reducer:r},{provide:Gt,multi:!0,useExisting:r instanceof A?r:ze},{provide:fr,multi:!0,deps:[ze,[new Be(Gt)]],useFactory:$n},Ar()]}var le=(()=>{class n{constructor(e,t,s,i,a,o){}static{this.\u0275fac=function(t){return new(t||n)(l(se),l(de),l(Z),l($),l(ur,8),l(et,8))}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})(),_e=(()=>{class n{constructor(e,t,s,i,a){this.features=e,this.featureReducers=t,this.reducerManager=s;let o=e.map((d,c)=>{let y=t.shift()[c];return R(f({},d),{reducers:y,initialState:vr(d.initialState)})});s.addFeatures(o)}ngOnDestroy(){this.reducerManager.removeFeatures(this.features)}static{this.\u0275fac=function(t){return new(t||n)(l(lr),l(fr),l(ne),l(le),l(et,8))}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})(),ei=(()=>{class n{static forRoot(e,t){return{ngModule:le,providers:[...Jn(e,t)]}}static forFeature(e,t,s={}){return{ngModule:_e,providers:[...Xn(e,t,s)]}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})();var es={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},De="__@ngrx/effects_create__";function fe(n,r={}){let e=r.functional?n:n(),t=f(f({},es),r);return Object.defineProperty(e,De,{value:t}),e}function ts(n){return Object.getOwnPropertyNames(n).filter(t=>n[t]&&n[t].hasOwnProperty(De)?n[t][De].hasOwnProperty("dispatch"):!1).map(t=>{let s=n[t][De];return f({propertyName:t},s)})}function rs(n){return ts(n)}function _r(n){return Object.getPrototypeOf(n)}function ns(n){return!!n.constructor&&n.constructor.name!=="Object"&&n.constructor.name!=="Function"}function Or(n){return typeof n=="function"}function Rr(n){return n.filter(Or)}function ss(n){return n instanceof A||Or(n)}function is(n,r,e){let t=_r(n),i=!!t&&t.constructor.name!=="Object"?t.constructor.name:null,a=rs(n).map(({propertyName:o,dispatch:d,useEffectsErrorHandler:c})=>{let h=typeof n[o]=="function"?n[o]():n[o],y=c?e(h,r):h;return d===!1?y.pipe(Ut()):y.pipe(Ft()).pipe(I(x=>({effect:n[o],notification:x,propertyName:o,sourceName:i,sourceInstance:n})))});return ae(...a)}var as=10;function Dr(n,r,e=as){return n.pipe(ee(t=>(r&&r.handleError(t),e<=1?n:Dr(n,r,e-1))))}var Te=(()=>{class n extends re{constructor(e){super(),e&&(this.source=e)}lift(e){let t=new n;return t.source=this,t.operator=e,t}static{this.\u0275fac=function(t){return new(t||n)(l(Z))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function st(...n){return U(r=>n.some(e=>typeof e=="string"?e===r.type:e.type===r.type))}var Tr=new A("@ngrx/effects Internal Root Guard"),Oe=new A("@ngrx/effects User Provided Effects"),nt=new A("@ngrx/effects Internal Root Effects"),Ir=new A("@ngrx/effects Internal Root Effects Instances"),Mr=new A("@ngrx/effects Internal Feature Effects"),Ur=new A("@ngrx/effects Internal Feature Effects Instance Groups"),os=new A("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>Dr}),Nr="@ngrx/effects/init",li=or(Nr);function cs(n,r){if(n.notification.kind==="N"){let e=n.notification.value;!us(e)&&r.handleError(new Error(`Effect ${ds(n)} dispatched an invalid action: ${hs(e)}`))}}function us(n){return typeof n!="function"&&n&&n.type&&typeof n.type=="string"}function ds({propertyName:n,sourceInstance:r,sourceName:e}){let t=typeof r[n]=="function";return!!e?`"${e}.${String(n)}${t?"()":""}"`:`"${String(n)}()"`}function hs(n){try{return JSON.stringify(n)}catch{return n}}var ls="ngrxOnIdentifyEffects";function fs(n){return it(n,ls)}var ps="ngrxOnRunEffects";function ys(n){return it(n,ps)}var Es="ngrxOnInitEffects";function gs(n){return it(n,Es)}function it(n,r){return n&&r in n&&typeof n[r]=="function"}var Ie=(()=>{class n extends Se{constructor(e,t){super(),this.errorHandler=e,this.effectsErrorHandler=t}addEffects(e){this.next(e)}toActions(){return this.pipe(Pe(e=>ns(e)?_r(e):e),W(e=>e.pipe(Pe(Ss))),W(e=>{let t=e.pipe(bt(i=>vs(this.errorHandler,this.effectsErrorHandler)(i)),I(i=>(cs(i,this.errorHandler),i.notification)),U(i=>i.kind==="N"&&i.value!=null),Nt()),s=e.pipe(oe(1),U(gs),I(i=>i.ngrxOnInitEffects()));return ae(t,s)}))}static{this.\u0275fac=function(t){return new(t||n)(l(Vt),l(os))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Ss(n){return fs(n)?n.ngrxOnIdentifyEffects():""}function vs(n,r){return e=>{let t=is(e,n,r);return ys(e)?e.ngrxOnRunEffects(t):t}}var xr=(()=>{class n{get isStarted(){return!!this.effectsSubscription}constructor(e,t){this.effectSources=e,this.store=t,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}static{this.\u0275fac=function(t){return new(t||n)(l(Ie),l($))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),br=(()=>{class n{constructor(e,t,s,i,a,o,d){this.sources=e,t.start();for(let c of i)e.addEffects(c);s.dispatch({type:Nr})}addEffects(e){this.sources.addEffects(e)}static{this.\u0275fac=function(t){return new(t||n)(l(Ie),l(xr),l($),l(Ir),l(le,8),l(_e,8),l(Tr,8))}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})(),As=(()=>{class n{constructor(e,t,s,i){let a=t.flat();for(let o of a)e.addEffects(o)}static{this.\u0275fac=function(t){return new(t||n)(l(br),l(Ur),l(le,8),l(_e,8))}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})(),fi=(()=>{class n{static forFeature(...e){let t=e.flat(),s=Rr(t);return{ngModule:As,providers:[s,{provide:Mr,multi:!0,useValue:t},{provide:Oe,multi:!0,useValue:[]},{provide:Ur,multi:!0,useFactory:Cr,deps:[Mr,Oe]}]}}static forRoot(...e){let t=e.flat(),s=Rr(t);return{ngModule:br,providers:[s,{provide:nt,useValue:[t]},{provide:Tr,useFactory:ms},{provide:Oe,multi:!0,useValue:[]},{provide:Ir,useFactory:Cr,deps:[nt,Oe]}]}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({})}}return n})();function Cr(n,r){let e=[];for(let t of n)e.push(...t);for(let t of r)e.push(...t);return e.map(t=>ss(t)?F(t):t)}function ms(){let n=F(xr,{optional:!0,skipSelf:!0}),r=F(nt,{self:!0});if(!(r.length===1&&r[0].length===0)&&n)throw new TypeError("EffectsModule.forRoot() called twice. Feature modules should use EffectsModule.forFeature() instead.");return"guarded"}function Ms(){return{ids:[],entities:{}}}function Cs(){function n(r={}){return Object.assign(Ms(),r)}return{getInitialState:n}}function _s(){function n(r){let e=a=>a.ids,t=a=>a.entities,s=k(e,t,(a,o)=>a.map(d=>o[d])),i=k(e,a=>a.length);return r?{selectIds:k(r,e),selectEntities:k(r,t),selectAll:k(r,s),selectTotal:k(r,i)}:{selectIds:e,selectEntities:t,selectAll:s,selectTotal:i}}return{getSelectors:n}}var m=function(n){return n[n.EntitiesOnly=0]="EntitiesOnly",n[n.Both=1]="Both",n[n.None=2]="None",n}(m||{});function T(n){return function(e,t){let s={ids:[...t.ids],entities:f({},t.entities)},i=n(e,s);return i===m.Both?Object.assign({},t,s):i===m.EntitiesOnly?R(f({},t),{entities:s.entities}):t}}function z(n,r){let e=r(n);return te()&&e===void 0&&console.warn("@ngrx/entity: The entity passed to the `selectId` implementation returned undefined.","You should probably provide your own `selectId` implementation.","The entity that was passed:",n,"The `selectId` implementation:",r.toString()),e}function Fr(n){function r(g,S){let E=z(g,n);return E in S.entities?m.None:(S.ids.push(E),S.entities[E]=g,m.Both)}function e(g,S){let E=!1;for(let p of g)E=r(p,S)!==m.None||E;return E?m.Both:m.None}function t(g,S){return S.ids=[],S.entities={},e(g,S),m.Both}function s(g,S){let E=z(g,n);return E in S.entities?(S.entities[E]=g,m.EntitiesOnly):(S.ids.push(E),S.entities[E]=g,m.Both)}function i(g,S){let E=g.map(p=>s(p,S));switch(!0){case E.some(p=>p===m.Both):return m.Both;case E.some(p=>p===m.EntitiesOnly):return m.EntitiesOnly;default:return m.None}}function a(g,S){return o([g],S)}function o(g,S){let p=(g instanceof Array?g:S.ids.filter(v=>g(S.entities[v]))).filter(v=>v in S.entities).map(v=>delete S.entities[v]).length>0;return p&&(S.ids=S.ids.filter(v=>v in S.entities)),p?m.Both:m.None}function d(g){return Object.assign({},g,{ids:[],entities:{}})}function c(g,S,E){let p=E.entities[S.id],v=Object.assign({},p,S.changes),M=z(v,n),O=M!==S.id;return O&&(g[S.id]=M,delete E.entities[S.id]),E.entities[M]=v,O}function h(g,S){return y([g],S)}function y(g,S){let E={};return g=g.filter(v=>v.id in S.entities),g.length>0?g.filter(M=>c(E,M,S)).length>0?(S.ids=S.ids.map(M=>E[M]||M),m.Both):m.EntitiesOnly:m.None}function C(g,S){let p=S.ids.reduce((v,M)=>{let O=g(S.entities[M]);return O!==S.entities[M]&&v.push({id:M,changes:O}),v},[]).filter(({id:v})=>v in S.entities);return y(p,S)}function x({map:g,id:S},E){let p=E.entities[S];if(!p)return m.None;let v=g(p);return h({id:S,changes:v},E)}function V(g,S){return K([g],S)}function K(g,S){let E=[],p=[];for(let O of g){let b=z(O,n);b in S.entities?p.push({id:b,changes:O}):E.push(O)}let v=y(p,S),M=e(E,S);switch(!0){case(M===m.None&&v===m.None):return m.None;case(M===m.Both||v===m.Both):return m.Both;default:return m.EntitiesOnly}}return{removeAll:d,addOne:T(r),addMany:T(e),setAll:T(t),setOne:T(s),setMany:T(i),updateOne:T(h),updateMany:T(y),upsertOne:T(V),upsertMany:T(K),removeOne:T(a),removeMany:T(o),map:T(C),mapOne:T(x)}}function Os(n,r){let{removeOne:e,removeMany:t,removeAll:s}=Fr(n);function i(E,p){return a([E],p)}function a(E,p){let v=E.filter(M=>!(z(M,n)in p.entities));return v.length===0?m.None:(S(v,p),m.Both)}function o(E,p){return p.entities={},p.ids=[],a(E,p),m.Both}function d(E,p){let v=z(E,n);return v in p.entities?(p.ids=p.ids.filter(M=>M!==v),S([E],p),m.Both):i(E,p)}function c(E,p){let v=E.map(M=>d(M,p));switch(!0){case v.some(M=>M===m.Both):return m.Both;case v.some(M=>M===m.EntitiesOnly):return m.EntitiesOnly;default:return m.None}}function h(E,p){return C([E],p)}function y(E,p,v){if(!(p.id in v.entities))return!1;let M=v.entities[p.id],O=Object.assign({},M,p.changes),b=z(O,n);return delete v.entities[p.id],E.push(O),b!==p.id}function C(E,p){let v=[],M=E.filter(O=>y(v,O,p)).length>0;if(v.length===0)return m.None;{let O=p.ids,b=[];return p.ids=p.ids.filter((Y,X)=>Y in p.entities?!0:(b.push(X),!1)),S(v,p),!M&&b.every(Y=>p.ids[Y]===O[Y])?m.EntitiesOnly:m.Both}}function x(E,p){let v=p.ids.reduce((M,O)=>{let b=E(p.entities[O]);return b!==p.entities[O]&&M.push({id:O,changes:b}),M},[]);return C(v,p)}function V({map:E,id:p},v){let M=v.entities[p];if(!M)return m.None;let O=E(M);return h({id:p,changes:O},v)}function K(E,p){return g([E],p)}function g(E,p){let v=[],M=[];for(let Y of E){let X=z(Y,n);X in p.entities?M.push({id:X,changes:Y}):v.push(Y)}let O=C(M,p),b=a(v,p);switch(!0){case(b===m.None&&O===m.None):return m.None;case(b===m.Both||O===m.Both):return m.Both;default:return m.EntitiesOnly}}function S(E,p){E.sort(r);let v=[],M=0,O=0;for(;M<E.length&&O<p.ids.length;){let b=E[M],Y=z(b,n),X=p.ids[O],dn=p.entities[X];r(b,dn)<=0?(v.push(Y),M++):(v.push(X),O++)}M<E.length?p.ids=v.concat(E.slice(M).map(n)):p.ids=v.concat(p.ids.slice(O)),E.forEach((b,Y)=>{p.entities[n(b)]=b})}return{removeOne:e,removeMany:t,removeAll:s,addOne:T(i),updateOne:T(h),upsertOne:T(K),setAll:T(o),setOne:T(d),setMany:T(c),addMany:T(a),updateMany:T(C),upsertMany:T(g),map:T(x),mapOne:T(V)}}function wr(n={}){let{selectId:r,sortComparer:e}={selectId:n.selectId??(a=>a.id),sortComparer:n.sortComparer??!1},t=Cs(),s=_s(),i=e?Os(r,e):Fr(r);return f(f(f({selectId:r,sortComparer:e},t),s),i)}var ye=(()=>{class n{create(e,t,s,i){let a=typeof e=="string"?R(f({},i||{}),{entityName:e,entityOp:t,data:s}):e;return this.createCore(a)}createCore(e){let{entityName:t,entityOp:s,tag:i}=e;if(!t)throw new Error("Missing entity name for new action");if(s==null)throw new Error("Missing EntityOp for new action");return{type:this.formatActionType(s,i||t),payload:e}}createFromAction(e,t){return this.create(f(f({},e.payload),t))}formatActionType(e,t){return`[${t}] ${e}`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Ue=class{constructor(r,e){this.entityName=r,this.selectId=e}mustBeEntity(r){let e=this.extractData(r);if(!e)return this.throwError(r,"should have a single entity.");let t=this.selectId(e);return this.isNotKeyType(t)&&this.throwError(r,"has a missing or invalid entity key (id)"),e}mustBeEntities(r){let e=this.extractData(r);return Array.isArray(e)?(e.forEach((t,s)=>{let i=this.selectId(t);if(this.isNotKeyType(i)){let a=`, item ${s+1}, does not have a valid entity key (id)`;this.throwError(r,a)}}),e):this.throwError(r,"should be an array of entities")}mustBeKey(r){let e=this.extractData(r);if(e===void 0)throw new Error("should be a single entity key");if(this.isNotKeyType(e))throw new Error("is not a valid key (id)");return e}mustBeKeys(r){let e=this.extractData(r);return Array.isArray(e)?(e.forEach((t,s)=>{if(this.isNotKeyType(t)){let i=`${this.entityName} ', item ${s+1}, is not a valid entity key (id)`;this.throwError(r,i)}}),e):this.throwError(r,"should be an array of entity keys (id)")}mustBeUpdate(r){let e=this.extractData(r);if(!e)return this.throwError(r,"should be a single entity update");let{id:t,changes:s}=e,i=this.selectId(s);return(this.isNotKeyType(t)||this.isNotKeyType(i))&&this.throwError(r,"has a missing or invalid entity key (id)"),e}mustBeUpdates(r){let e=this.extractData(r);return Array.isArray(e)?(e.forEach((t,s)=>{let{id:i,changes:a}=t,o=this.selectId(a);(this.isNotKeyType(i)||this.isNotKeyType(o))&&this.throwError(r,`, item ${s+1}, has a missing or invalid entity key (id)`)}),e):this.throwError(r,"should be an array of entity updates")}mustBeUpdateResponse(r){let e=this.extractData(r);if(!e)return this.throwError(r,"should be a single entity update");let{id:t,changes:s}=e,i=this.selectId(s);return(this.isNotKeyType(t)||this.isNotKeyType(i))&&this.throwError(r,"has a missing or invalid entity key (id)"),e}mustBeUpdateResponses(r){let e=this.extractData(r);return Array.isArray(e)?(e.forEach((t,s)=>{let{id:i,changes:a}=t,o=this.selectId(a);(this.isNotKeyType(i)||this.isNotKeyType(o))&&this.throwError(r,`, item ${s+1}, has a missing or invalid entity key (id)`)}),e):this.throwError(r,"should be an array of entity updates")}extractData(r){return r.payload&&r.payload.data}isNotKeyType(r){return typeof r!="string"&&typeof r!="number"}throwError(r,e){throw new Error(`${this.entityName} EntityAction guard for "${r.type}": payload ${e}`)}};function Ee(n){return n?.id}function $r(n){if(n==null)return[];if(Array.isArray(n[0])){let[r,...e]=n;n=[...r,...e]}return n}function Vr(n){return n=n||Ee,function(e){let t=n(e);if(t==null)throw new Error("Primary key may not be null/undefined.");return e&&{id:t,changes:e}}}function kr(...n){let r=$r(n);switch(r.length){case 0:return U(t=>t.payload&&t.payload.entityOp!=null);case 1:let e=r[0];return U(t=>t.payload&&e===t.payload.entityOp);default:return U(t=>{let s=t.payload&&t.payload.entityOp;return s&&r.some(i=>i===s)})}}function jr(...n){let r=$r(n);switch(r.length){case 0:return U(t=>t.payload&&t.payload.entityName!=null);case 1:let e=r[0];return U(t=>t.payload&&e===t.payload.entityName);default:return U(t=>{let s=t.payload&&t.payload.entityName;return!!s&&r.some(i=>i===s)})}}var L=function(n){return n.Add="Add",n.Delete="Delete",n.Update="Update",n.Upsert="Upsert",n}(L||{}),at=class{add(r,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:r,op:L.Add,entities:e}}delete(r,e){let t=Array.isArray(e)?e:e?[e]:[];return{entityName:r,op:L.Delete,entities:t}}update(r,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:r,op:L.Update,entities:e}}upsert(r,e){return e=Array.isArray(e)?e:e?[e]:[],{entityName:r,op:L.Upsert,entities:e}}},Ui=new at;function Yr(n){n=n&&n.changes?n:{changes:[]};let r=n.changes.filter(e=>e!=null&&e.entities&&e.entities.length>0);return R(f({},n),{changes:r})}var N=function(n){return n[n.IgnoreChanges=0]="IgnoreChanges",n[n.PreserveChanges=1]="PreserveChanges",n[n.OverwriteChanges=2]="OverwriteChanges",n}(N||{}),D=function(n){return n.CLEAR_COLLECTIONS="@ngrx/data/entity-cache/clear-collections",n.LOAD_COLLECTIONS="@ngrx/data/entity-cache/load-collections",n.MERGE_QUERY_SET="@ngrx/data/entity-cache/merge-query-set",n.SET_ENTITY_CACHE="@ngrx/data/entity-cache/set-cache",n.SAVE_ENTITIES="@ngrx/data/entity-cache/save-entities",n.SAVE_ENTITIES_CANCEL="@ngrx/data/entity-cache/save-entities-cancel",n.SAVE_ENTITIES_CANCELED="@ngrx/data/entity-cache/save-entities-canceled",n.SAVE_ENTITIES_ERROR="@ngrx/data/entity-cache/save-entities-error",n.SAVE_ENTITIES_SUCCESS="@ngrx/data/entity-cache/save-entities-success",n}(D||{}),ot=class{constructor(r,e){this.type=D.CLEAR_COLLECTIONS,this.payload={collections:r,tag:e}}},ct=class{constructor(r,e){this.type=D.LOAD_COLLECTIONS,this.payload={collections:r,tag:e}}},ut=class{constructor(r,e,t){this.type=D.MERGE_QUERY_SET,this.payload={querySet:r,mergeStrategy:e===null?N.PreserveChanges:e,tag:t}}},dt=class{constructor(r,e){this.cache=r,this.type=D.SET_ENTITY_CACHE,this.payload={cache:r,tag:e}}},ht=class{constructor(r,e,t){this.type=D.SAVE_ENTITIES,t=t||{},r&&(r.tag=r.tag||t.tag),this.payload=R(f({changeSet:r,url:e},t),{tag:r.tag})}},lt=class{constructor(r,e,t,s){this.type=D.SAVE_ENTITIES_CANCEL,this.payload={correlationId:r,reason:e,entityNames:t,tag:s}}},ft=class{constructor(r,e,t){this.type=D.SAVE_ENTITIES_CANCELED,this.payload={correlationId:r,reason:e,tag:t}}},pt=class{constructor(r,e){this.type=D.SAVE_ENTITIES_ERROR;let t=e.payload.correlationId;this.payload={error:r,originalAction:e,correlationId:t}}},pe=class{constructor(r,e,t){this.type=D.SAVE_ENTITIES_SUCCESS,t=t||{},r&&(r.tag=r.tag||t.tag),this.payload=R(f({changeSet:r,url:e},t),{tag:r.tag})}},u=function(n){return n.CANCEL_PERSIST="@ngrx/data/cancel-persist",n.CANCELED_PERSIST="@ngrx/data/canceled-persist",n.QUERY_ALL="@ngrx/data/query-all",n.QUERY_ALL_SUCCESS="@ngrx/data/query-all/success",n.QUERY_ALL_ERROR="@ngrx/data/query-all/error",n.QUERY_LOAD="@ngrx/data/query-load",n.QUERY_LOAD_SUCCESS="@ngrx/data/query-load/success",n.QUERY_LOAD_ERROR="@ngrx/data/query-load/error",n.QUERY_MANY="@ngrx/data/query-many",n.QUERY_MANY_SUCCESS="@ngrx/data/query-many/success",n.QUERY_MANY_ERROR="@ngrx/data/query-many/error",n.QUERY_BY_KEY="@ngrx/data/query-by-key",n.QUERY_BY_KEY_SUCCESS="@ngrx/data/query-by-key/success",n.QUERY_BY_KEY_ERROR="@ngrx/data/query-by-key/error",n.SAVE_ADD_MANY="@ngrx/data/save/add-many",n.SAVE_ADD_MANY_ERROR="@ngrx/data/save/add-many/error",n.SAVE_ADD_MANY_SUCCESS="@ngrx/data/save/add-many/success",n.SAVE_ADD_ONE="@ngrx/data/save/add-one",n.SAVE_ADD_ONE_ERROR="@ngrx/data/save/add-one/error",n.SAVE_ADD_ONE_SUCCESS="@ngrx/data/save/add-one/success",n.SAVE_DELETE_MANY="@ngrx/data/save/delete-many",n.SAVE_DELETE_MANY_SUCCESS="@ngrx/data/save/delete-many/success",n.SAVE_DELETE_MANY_ERROR="@ngrx/data/save/delete-many/error",n.SAVE_DELETE_ONE="@ngrx/data/save/delete-one",n.SAVE_DELETE_ONE_SUCCESS="@ngrx/data/save/delete-one/success",n.SAVE_DELETE_ONE_ERROR="@ngrx/data/save/delete-one/error",n.SAVE_UPDATE_MANY="@ngrx/data/save/update-many",n.SAVE_UPDATE_MANY_SUCCESS="@ngrx/data/save/update-many/success",n.SAVE_UPDATE_MANY_ERROR="@ngrx/data/save/update-many/error",n.SAVE_UPDATE_ONE="@ngrx/data/save/update-one",n.SAVE_UPDATE_ONE_SUCCESS="@ngrx/data/save/update-one/success",n.SAVE_UPDATE_ONE_ERROR="@ngrx/data/save/update-one/error",n.SAVE_UPSERT_MANY="@ngrx/data/save/upsert-many",n.SAVE_UPSERT_MANY_SUCCESS="@ngrx/data/save/upsert-many/success",n.SAVE_UPSERT_MANY_ERROR="@ngrx/data/save/upsert-many/error",n.SAVE_UPSERT_ONE="@ngrx/data/save/upsert-one",n.SAVE_UPSERT_ONE_SUCCESS="@ngrx/data/save/upsert-one/success",n.SAVE_UPSERT_ONE_ERROR="@ngrx/data/save/upsert-one/error",n.ADD_ALL="@ngrx/data/add-all",n.ADD_MANY="@ngrx/data/add-many",n.ADD_ONE="@ngrx/data/add-one",n.REMOVE_ALL="@ngrx/data/remove-all",n.REMOVE_MANY="@ngrx/data/remove-many",n.REMOVE_ONE="@ngrx/data/remove-one",n.UPDATE_MANY="@ngrx/data/update-many",n.UPDATE_ONE="@ngrx/data/update-one",n.UPSERT_MANY="@ngrx/data/upsert-many",n.UPSERT_ONE="@ngrx/data/upsert-one",n.COMMIT_ALL="@ngrx/data/commit-all",n.COMMIT_MANY="@ngrx/data/commit-many",n.COMMIT_ONE="@ngrx/data/commit-one",n.UNDO_ALL="@ngrx/data/undo-all",n.UNDO_MANY="@ngrx/data/undo-many",n.UNDO_ONE="@ngrx/data/undo-one",n.SET_CHANGE_STATE="@ngrx/data/set-change-state",n.SET_COLLECTION="@ngrx/data/set-collection",n.SET_FILTER="@ngrx/data/set-filter",n.SET_LOADED="@ngrx/data/set-loaded",n.SET_LOADING="@ngrx/data/set-loading",n}(u||{}),yt="/success",Rt="/error";function Ds(n){return n+Rt}function Pr(n){return n+yt}var J=class extends Error{constructor(r,e){super(typeof r=="string"?r:Ts(r)??void 0),this.error=r,this.requestData=e,this.name=this.constructor.name}};function Ts(n){let{error:r,body:e,message:t}=n,s=null;return r?s=typeof r=="string"?r:r.message:t?s=t:e&&(s=typeof e=="string"?e:e.error),typeof s=="string"?s:s?JSON.stringify(s):null}var Ne=class{},ie=class{},Br=new A("@ngrx/data Plural Names"),xe=class{};var be=class{},Is=(()=>{class n{constructor(e){this.pluralizer=e,this.knownHttpResourceUrls={}}getResourceUrls(e,t,s=!1){let i=this.knownHttpResourceUrls[e];if(!i){let a=s?t:Us(t);i={entityResourceUrl:`${a}/${e}/`.toLowerCase(),collectionResourceUrl:`${a}/${this.pluralizer.pluralize(e)}/`.toLowerCase()},this.registerHttpResourceUrls({[e]:i})}return i}entityResource(e,t,s){return this.getResourceUrls(e,t,s).entityResourceUrl}collectionResource(e,t){return this.getResourceUrls(e,t).collectionResourceUrl}registerHttpResourceUrls(e){this.knownHttpResourceUrls=f(f({},this.knownHttpResourceUrls),e||{})}static{this.\u0275fac=function(t){return new(t||n)(l(xe))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();function Us(n){return n.replace(/^[/\s]+|[/\s]+$/g,"")}var Et=class{get name(){return this._name}constructor(r,e,t,s){this.http=e,this.httpUrlGenerator=t,this.getDelay=0,this.saveDelay=0,this.timeout=0,this.trailingSlashEndpoints=!1,this._name=`${r} DefaultDataService`,this.entityName=r;let{root:i="api",delete404OK:a=!0,getDelay:o=0,saveDelay:d=0,timeout:c=0,trailingSlashEndpoints:h=!1}=s||{};this.delete404OK=a,this.entityUrl=t.entityResource(r,i,h),this.entitiesUrl=t.collectionResource(r,i),this.getDelay=o,this.saveDelay=d,this.timeout=c}add(r,e){let t=r||new Error(`No "${this.entityName}" entity to add`);return this.execute("POST",this.entityUrl,t,null,e)}delete(r,e){let t;return r==null&&(t=new Error(`No "${this.entityName}" key to delete`)),this.execute("DELETE",this.entityUrl+r,t,null,e).pipe(I(s=>r))}getAll(r){return this.execute("GET",this.entitiesUrl,null,null,r)}getById(r,e){let t;return r==null&&(t=new Error(`No "${this.entityName}" key to get`)),this.execute("GET",this.entityUrl+r,t,null,e)}getWithQuery(r,e){let t=typeof r=="string"?{fromString:r}:{fromObject:r},s=new Ke(t);return this.execute("GET",this.entitiesUrl,void 0,{params:s},e)}update(r,e){let t=r&&r.id,s=t==null?new Error(`No "${this.entityName}" update data or id`):r.changes;return this.execute("PUT",this.entityUrl+t,s,null,e)}upsert(r,e){let t=r||new Error(`No "${this.entityName}" entity to upsert`);return this.execute("POST",this.entityUrl,t,null,e)}execute(r,e,t,s,i){let a;i&&(a={headers:i?.httpHeaders?new Pt(i?.httpHeaders):void 0,params:i?.httpParams?new Ke(i?.httpParams):void 0});let o;(s||a)&&(te()&&s&&a&&console.warn("@ngrx/data: options.httpParams will be merged with queryParams when both are are provided to getWithQuery(). In the event of a conflict HttpOptions.httpParams will override queryParams`. The queryParams parameter of getWithQuery() will be removed in next major release."),o=R(f({},s),{headers:a?.headers??s?.headers,params:a?.params??s?.params}));let d={method:r,url:e,data:t,options:o};if(t instanceof Error)return this.handleError(d)(t);let c;switch(r){case"DELETE":{c=this.http.delete(e,o),this.saveDelay&&(c=c.pipe(q(this.saveDelay)));break}case"GET":{c=this.http.get(e,o),this.getDelay&&(c=c.pipe(q(this.getDelay)));break}case"POST":{c=this.http.post(e,t,o),this.saveDelay&&(c=c.pipe(q(this.saveDelay)));break}case"PUT":{c=this.http.put(e,t,o),this.saveDelay&&(c=c.pipe(q(this.saveDelay)));break}default:{let h=new Error("Unimplemented HTTP method, "+r);c=G(h)}}return this.timeout&&(c=c.pipe($e(this.timeout+this.saveDelay))),c.pipe(ee(this.handleError(d)))}handleError(r){return e=>{let t=this.handleDelete404(e,r);if(t)return t;let s=new J(e,r);return G(s)}}handleDelete404(r,e){if(r.status===404&&e.method==="DELETE"&&this.delete404OK)return Q({})}},Kr=(()=>{class n{constructor(e,t,s){this.http=e,this.httpUrlGenerator=t,this.config=s,s=s||{},t.registerHttpResourceUrls(s.entityHttpResourceUrls)}create(e){return new Et(e,this.http,this.httpUrlGenerator,this.config)}static{this.\u0275fac=function(t){return new(t||n)(l(Qe),l(be),l(Ne,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();function Ns(n){let r=n.entityName;if(!r)throw new Error("Missing required entityName");n.entityName=r=r.trim();let e=n.selectId||Ee,t=n.sortComparer=n.sortComparer||!1,s=wr({selectId:e,sortComparer:t}),i=n.entityDispatcherOptions||{},a=s.getInitialState(f({entityName:r,filter:"",loaded:!1,loading:!1,changeState:{}},n.additionalCollectionState||{})),o=n.noChangeTracking===!0;return{entityName:r,entityAdapter:s,entityDispatcherOptions:i,initialState:a,metadata:n,noChangeTracking:o,selectId:e,sortComparer:t}}var Qr=new A("@ngrx/data Entity Metadata"),ge=(()=>{class n{constructor(e){this.definitions={},e&&e.forEach(t=>this.registerMetadataMap(t))}getDefinition(e,t=!0){e=e.trim();let s=this.definitions[e];if(!s&&t)throw new Error(`No EntityDefinition for entity type "${e}".`);return s}registerMetadata(e){if(e){let t=Ns(e);this.registerDefinition(t)}}registerMetadataMap(e={}){Object.keys(e||{}).forEach(t=>this.registerMetadata(f({entityName:t},e[t])))}registerDefinition(e){this.definitions[e.entityName]=e}registerDefinitions(e){Object.assign(this.definitions,e)}static{this.\u0275fac=function(t){return new(t||n)(l(Qr,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Lr=L.Update,qr=(()=>{class n{constructor(e,t,s){this.entityDefinitionService=e,this.http=t,this.idSelectors={},this.saveDelay=0,this.timeout=0;let{saveDelay:i=0,timeout:a=0}=s||{};this.saveDelay=i,this.timeout=a}saveEntities(e,t){e=this.filterChangeSet(e),e=this.flattenUpdates(e);let s=this.http.post(t,e).pipe(I(i=>this.restoreUpdates(i)),ee(this.handleError({method:"POST",url:t,data:e})));return this.timeout&&(s=s.pipe($e(this.timeout))),this.saveDelay&&(s=s.pipe(q(this.saveDelay))),s}handleError(e){return t=>{let s=new J(t,e);return G(s)}}filterChangeSet(e){return Yr(e)}flattenUpdates(e){let t=e.changes;if(t.length===0)return e;let s=!1;return t=t.map(i=>i.op===Lr&&i.entities.length>0?(s=!0,R(f({},i),{entities:i.entities.map(a=>a.changes)})):i),s?R(f({},e),{changes:t}):e}restoreUpdates(e){if(e==null)return e;let t=e.changes;if(t.length===0)return e;let s=!1;return t=t.map(i=>{if(i.op===Lr){s=!0;let a=this.getIdSelector(i.entityName);return R(f({},i),{entities:i.entities.map(o=>({id:a(o),changes:o}))})}else return i}),s?R(f({},e),{changes:t}):e}getIdSelector(e){let t=this.idSelectors[e];return t||(t=this.entityDefinitionService.getDefinition(e).selectId,this.idSelectors[e]=t),t}static{this.\u0275fac=function(t){return new(t||n)(l(ge),l(Qe),l(Ne,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Hr=(()=>{class n{constructor(e){this.defaultDataServiceFactory=e,this.services={}}getService(e){e=e.trim();let t=this.services[e];return t||(t=this.defaultDataServiceFactory.create(e),this.services[e]=t),t}registerService(e,t){this.services[e.trim()]=t}registerServices(e){this.services=f(f({},this.services),e)}static{this.\u0275fac=function(t){return new(t||n)(l(Kr))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Fe=class{},xs=(()=>{class n{constructor(e,t){this.logger=e,this.entityActionFactory=t}handleSuccess(e){let t=Pr(e.payload.entityOp);return s=>this.entityActionFactory.createFromAction(e,{entityOp:t,data:s})}handleError(e){let t=Ds(e.payload.entityOp);return s=>{let a={error:s instanceof J?s:new J(s,null),originalAction:e};return this.logger.error(a),this.entityActionFactory.createFromAction(e,{entityOp:t,data:a})}}static{this.\u0275fac=function(t){return new(t||n)(l(ie),l(ye))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),we=class{constructor(r){this.message=r,this.message=r||"Canceled by user"}},Mt=(()=>{class n{constructor(){this.seed=0,this.prefix="CRID"}next(){return this.seed+=1,this.prefix+this.seed}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Ct=(()=>{class n{constructor(){this.optimisticAdd=!1,this.optimisticDelete=!0,this.optimisticUpdate=!1,this.optimisticUpsert=!1,this.optimisticSaveEntities=!1}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),bs=(()=>{class n{constructor(e,t,s,i){this.correlationIdGenerator=e,this.defaultDispatcherOptions=t,this.store=i,this.reducedActions$=s.pipe(j(1)),this.raSubscription=this.reducedActions$.subscribe()}dispatch(e){return this.store.dispatch(e),e}cancelSaveEntities(e,t,s,i){if(!e)throw new Error("Missing correlationId");let a=new lt(e,t,s,i);this.dispatch(a)}clearCollections(e,t){this.dispatch(new ot(e,t))}loadCollections(e,t){this.dispatch(new ct(e,t))}mergeQuerySet(e,t,s){this.dispatch(new ut(e,t,s))}setEntityCache(e,t){this.dispatch(new dt(e,t))}saveEntities(e,t,s){let i=Array.isArray(e)?{changes:e}:e;s=s||{};let a=s.correlationId==null?this.correlationIdGenerator.next():s.correlationId,o=s.isOptimistic==null?this.defaultDispatcherOptions.optimisticSaveEntities||!1:s.isOptimistic===!0,d=s.tag||"Save Entities";s=R(f({},s),{correlationId:a,isOptimistic:o,tag:d});let c=new ht(i,t,s);return this.dispatch(c),this.getSaveEntitiesResponseData$(s.correlationId).pipe(j(1))}getSaveEntitiesResponseData$(e){return this.reducedActions$.pipe(U(t=>t.type===D.SAVE_ENTITIES_SUCCESS||t.type===D.SAVE_ENTITIES_ERROR||t.type===D.SAVE_ENTITIES_CANCEL),U(t=>e===t.payload.correlationId),oe(1),W(t=>t.type===D.SAVE_ENTITIES_CANCEL?G(new we(t.payload.reason)):t.type===D.SAVE_ENTITIES_SUCCESS?Q(t.payload.changeSet):G(t.payload)))}static{this.\u0275fac=function(t){return new(t||n)(l(Mt),l(Ct),l(Z),l($))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),gt=class{constructor(r,e,t,s=Ee,i,a,o,d){this.entityName=r,this.entityActionFactory=e,this.store=t,this.selectId=s,this.defaultDispatcherOptions=i,this.reducedActions$=a,this.correlationIdGenerator=d,this.guard=new Ue(r,s),this.toUpdate=Vr(s);let c=k(o,h=>h[r]);this.entityCollection$=t.select(c)}createEntityAction(r,e,t){return this.entityActionFactory.create(f({entityName:this.entityName,entityOp:r,data:e},t))}createAndDispatch(r,e,t){let s=this.createEntityAction(r,e,t);return this.dispatch(s),s}dispatch(r){return this.store.dispatch(r),r}add(r,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticAdd);let t=this.createEntityAction(u.SAVE_ADD_ONE,r,e);return e.isOptimistic&&this.guard.mustBeEntity(t),this.dispatch(t),this.getResponseData$(e.correlationId).pipe(H(this.entityCollection$),I(([s,i])=>i.entities[this.selectId(s)]),j(1))}cancel(r,e,t){if(!r)throw new Error("Missing correlationId");this.createAndDispatch(u.CANCEL_PERSIST,e,{correlationId:r})}delete(r,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticDelete);let t=this.getKey(r),s=this.createEntityAction(u.SAVE_DELETE_ONE,t,e);return this.guard.mustBeKey(s),this.dispatch(s),this.getResponseData$(e.correlationId).pipe(I(()=>t),j(1))}getAll(r){r=this.setQueryEntityActionOptions(r);let e=this.createEntityAction(u.QUERY_ALL,null,r);return this.dispatch(e),this.getResponseData$(r.correlationId).pipe(H(this.entityCollection$),I(([t,s])=>t.reduce((i,a)=>{let o=s.entities[this.selectId(a)];return o&&i.push(o),i},[])),j(1))}getByKey(r,e){e=this.setQueryEntityActionOptions(e);let t=this.createEntityAction(u.QUERY_BY_KEY,r,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(H(this.entityCollection$),I(([s,i])=>i.entities[this.selectId(s)]),j(1))}getWithQuery(r,e){e=this.setQueryEntityActionOptions(e);let t=this.createEntityAction(u.QUERY_MANY,r,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(H(this.entityCollection$),I(([s,i])=>s.reduce((a,o)=>{let d=i.entities[this.selectId(o)];return d&&a.push(d),a},[])),j(1))}load(r){r=this.setQueryEntityActionOptions(r);let e=this.createEntityAction(u.QUERY_LOAD,null,r);return this.dispatch(e),this.getResponseData$(r.correlationId).pipe(j(1))}loadWithQuery(r,e){e=this.setQueryEntityActionOptions(e);let t=this.createEntityAction(u.QUERY_MANY,r,e);return this.dispatch(t),this.getResponseData$(e.correlationId).pipe(j(1))}update(r,e){let t=this.toUpdate(r);e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpdate);let s=this.createEntityAction(u.SAVE_UPDATE_ONE,t,e);return e.isOptimistic&&this.guard.mustBeUpdate(s),this.dispatch(s),this.getResponseData$(e.correlationId).pipe(I(i=>i.changes),H(this.entityCollection$),I(([i,a])=>a.entities[this.selectId(i)]),j(1))}upsert(r,e){e=this.setSaveEntityActionOptions(e,this.defaultDispatcherOptions.optimisticUpsert);let t=this.createEntityAction(u.SAVE_UPSERT_ONE,r,e);return e.isOptimistic&&this.guard.mustBeEntity(t),this.dispatch(t),this.getResponseData$(e.correlationId).pipe(H(this.entityCollection$),I(([s,i])=>i.entities[this.selectId(s)]),j(1))}addAllToCache(r,e){this.createAndDispatch(u.ADD_ALL,r,e)}addOneToCache(r,e){this.createAndDispatch(u.ADD_ONE,r,e)}addManyToCache(r,e){this.createAndDispatch(u.ADD_MANY,r,e)}clearCache(r){this.createAndDispatch(u.REMOVE_ALL,void 0,r)}removeOneFromCache(r,e){this.createAndDispatch(u.REMOVE_ONE,this.getKey(r),e)}removeManyFromCache(r,e){if(!r||r.length===0)return;let t=typeof r[0]=="object"?r.map(s=>this.getKey(s)):r;this.createAndDispatch(u.REMOVE_MANY,t,e)}updateOneInCache(r,e){let t=this.toUpdate(r);this.createAndDispatch(u.UPDATE_ONE,t,e)}updateManyInCache(r,e){if(!r||r.length===0)return;let t=r.map(s=>this.toUpdate(s));this.createAndDispatch(u.UPDATE_MANY,t,e)}upsertOneInCache(r,e){this.createAndDispatch(u.UPSERT_ONE,r,e)}upsertManyInCache(r,e){!r||r.length===0||this.createAndDispatch(u.UPSERT_MANY,r,e)}setFilter(r){this.createAndDispatch(u.SET_FILTER,r)}setLoaded(r){this.createAndDispatch(u.SET_LOADED,!!r)}setLoading(r){this.createAndDispatch(u.SET_LOADING,!!r)}getKey(r){return typeof r=="object"?this.selectId(r):r}getResponseData$(r){return this.reducedActions$.pipe(U(e=>!!e.payload),U(e=>{let{correlationId:t,entityName:s,entityOp:i}=e.payload;return s===this.entityName&&t===r&&(i.endsWith(yt)||i.endsWith(Rt)||i===u.CANCEL_PERSIST)}),oe(1),W(e=>{let{entityOp:t}=e.payload;return t===u.CANCEL_PERSIST?G(new we(e.payload.data)):t.endsWith(yt)?Q(e.payload.data):G(e.payload.data.error)}))}setQueryEntityActionOptions(r){r=r||{};let e=r.correlationId==null?this.correlationIdGenerator.next():r.correlationId;return R(f({},r),{correlationId:e})}setSaveEntityActionOptions(r,e){r=r||{};let t=r.correlationId==null?this.correlationIdGenerator.next():r.correlationId,s=r.isOptimistic==null?e||!1:r.isOptimistic===!0;return R(f({},r),{correlationId:t,isOptimistic:s})}},je="entityCache",_t=new A("@ngrx/data Entity Cache Name"),zr=new A("@ngrx/data Entity Cache Meta Reducers"),Gr=new A("@ngrx/data Entity Collection Meta Reducers"),Fs=new A("@ngrx/data Initial Entity Cache State"),Le=new A("@ngrx/data Entity Cache Selector"),ws={provide:Le,useFactory:Wr,deps:[[new jt,_t]]};function Wr(n){return n=n||je,Sr(n)}var Ot=(()=>{class n{constructor(e,t,s,i,a,o){this.entityActionFactory=e,this.store=t,this.entityDispatcherDefaultOptions=s,this.entityCacheSelector=a,this.correlationIdGenerator=o,this.reducedActions$=i.pipe(j(1)),this.raSubscription=this.reducedActions$.subscribe()}create(e,t=Ee,s={}){let i=f(f({},this.entityDispatcherDefaultOptions),s);return new gt(e,this.entityActionFactory,this.store,t,i,this.reducedActions$,this.entityCacheSelector,this.correlationIdGenerator)}ngOnDestroy(){this.raSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||n)(l(ye),l($),l(Ct),l(Z),l(Le),l(Mt))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Zr=new A("@ngrx/data Entity Effects Scheduler"),Jr=(()=>{class n{constructor(e,t,s,i,a){this.actions=e,this.dataService=t,this.entityActionFactory=s,this.logger=i,this.scheduler=a,this.responseDelay=10,this.saveEntitiesCancel$=fe(()=>this.actions.pipe(st(D.SAVE_ENTITIES_CANCEL),U(o=>o.payload.correlationId!=null)),{dispatch:!1}),this.saveEntities$=fe(()=>this.actions.pipe(st(D.SAVE_ENTITIES),W(o=>this.saveEntities(o))))}saveEntities(e){let t=e.payload.error;if(t)return this.handleSaveEntitiesError$(e)(t);try{let s=Yr(e.payload.changeSet),{correlationId:i,mergeStrategy:a,tag:o,url:d}=e.payload,c={correlationId:i,mergeStrategy:a,tag:o};if(s.changes.length===0)return Q(new pe(s,d,c));let h=this.saveEntitiesCancel$.pipe(U(C=>i===C.payload.correlationId),I(C=>new ft(i,C.payload.reason,C.payload.tag))),y=this.dataService.saveEntities(s,d).pipe(Ye(C=>this.handleSaveEntitiesSuccess$(e,this.entityActionFactory)(C)),ee(this.handleSaveEntitiesError$(e)));return Ve(h,y)}catch(s){return this.handleSaveEntitiesError$(e)(s)}}handleSaveEntitiesError$(e){return t=>{let s=t instanceof J?t:new J(t,null);return Q(new pt(s,e)).pipe(q(this.responseDelay,this.scheduler||Ae))}}handleSaveEntitiesSuccess$(e,t){let{url:s,correlationId:i,mergeStrategy:a,tag:o}=e.payload,d={correlationId:i,mergeStrategy:a,tag:o};return c=>{if(c)return Q(new pe(c,s,d));if(c=e.payload.changeSet,!e.payload.isOptimistic)return Q(new pe(c,s,d));let h=c.changes.reduce((y,C)=>y.indexOf(C.entityName)===-1?y.concat(C.entityName):y,[]);return ae(h.map(y=>t.create(y,u.SET_LOADING,!1)))}}static{this.\u0275fac=function(t){return new(t||n)(l(Te),l(qr),l(ye),l(ie),l(Zr,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),ks=[u.QUERY_ALL,u.QUERY_LOAD,u.QUERY_BY_KEY,u.QUERY_MANY,u.SAVE_ADD_ONE,u.SAVE_DELETE_ONE,u.SAVE_UPDATE_ONE,u.SAVE_UPSERT_ONE],Xr=(()=>{class n{constructor(e,t,s,i,a){this.actions=e,this.dataService=t,this.entityActionFactory=s,this.resultHandler=i,this.scheduler=a,this.responseDelay=10,this.cancel$=fe(()=>this.actions.pipe(kr(u.CANCEL_PERSIST),I(o=>o.payload.correlationId),U(o=>o!=null)),{dispatch:!1}),this.persist$=fe(()=>this.actions.pipe(kr(ks),W(o=>this.persist(o))))}persist(e){if(e.payload.skip)return this.handleSkipSuccess$(e);if(e.payload.error)return this.handleError$(e)(e.payload.error);try{let t=this.cancel$.pipe(U(i=>e.payload.correlationId===i),I(i=>this.entityActionFactory.createFromAction(e,{entityOp:u.CANCELED_PERSIST}))),s=this.callDataService(e).pipe(I(this.resultHandler.handleSuccess(e)),ee(this.handleError$(e)));return Ve(t,s)}catch(t){return this.handleError$(e)(t)}}callDataService(e){let{entityName:t,entityOp:s,data:i,httpOptions:a}=e.payload,o=this.dataService.getService(t);switch(s){case u.QUERY_ALL:case u.QUERY_LOAD:return o.getAll(a);case u.QUERY_BY_KEY:return o.getById(i,a);case u.QUERY_MANY:return o.getWithQuery(i,a);case u.SAVE_ADD_ONE:return o.add(i,a);case u.SAVE_DELETE_ONE:return o.delete(i,a);case u.SAVE_UPDATE_ONE:let{id:d,changes:c}=i;return o.update(i,a).pipe(I(h=>h&&Object.keys(h).length>0?{id:d,changes:f(f({},c),h),changed:!0}:{id:d,changes:c,changed:!1}));case u.SAVE_UPSERT_ONE:return o.upsert(i,a).pipe(I(h=>h&&Object.keys(h).length>0?h:i));default:throw new Error(`Persistence action "${s}" is not implemented.`)}}handleError$(e){return t=>Q(this.resultHandler.handleError(e)(t)).pipe(q(this.responseDelay,this.scheduler||Ae))}handleSkipSuccess$(e){let t=Pr(e.payload.entityOp),s=this.entityActionFactory.createFromAction(e,{entityOp:t});return Q(s).pipe(q(this.responseDelay,this.scheduler||Ae))}static{this.\u0275fac=function(t){return new(t||n)(l(Te),l(Hr),l(ye),l(Fe),l(Zr,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();var St=class{constructor(r,e){this.entityName=r,r=r.trim();let{dispatcher:t,selectors:s,selectors$:i}=e.create(r);this.entityName=r,this.dispatcher=t,this.guard=t.guard,this.selectId=t.selectId,this.toUpdate=t.toUpdate,this.selectors=s,this.selectors$=i,this.collection$=i.collection$,this.count$=i.count$,this.entities$=i.entities$,this.entityActions$=i.entityActions$,this.entityMap$=i.entityMap$,this.errors$=i.errors$,this.filter$=i.filter$,this.filteredEntities$=i.filteredEntities$,this.keys$=i.keys$,this.loaded$=i.loaded$,this.loading$=i.loading$,this.changeState$=i.changeState$}createEntityAction(r,e,t){return this.dispatcher.createEntityAction(r,e,t)}createAndDispatch(r,e,t){return this.dispatcher.createAndDispatch(r,e,t)}dispatch(r){return this.dispatcher.dispatch(r)}get store(){return this.dispatcher.store}add(r,e){return this.dispatcher.add(r,e)}cancel(r,e,t){this.dispatcher.cancel(r,e,t)}delete(r,e){return this.dispatcher.delete(r,e)}getAll(r){return this.dispatcher.getAll(r)}getByKey(r,e){return this.dispatcher.getByKey(r,e)}getWithQuery(r,e){return this.dispatcher.getWithQuery(r,e)}load(r){return this.dispatcher.load(r)}loadWithQuery(r,e){return this.dispatcher.loadWithQuery(r,e)}update(r,e){return this.dispatcher.update(r,e)}upsert(r,e){return this.dispatcher.upsert(r,e)}addAllToCache(r,e){this.dispatcher.addAllToCache(r,e)}addOneToCache(r,e){this.dispatcher.addOneToCache(r,e)}addManyToCache(r,e){this.dispatcher.addManyToCache(r,e)}clearCache(){this.dispatcher.clearCache()}removeOneFromCache(r,e){this.dispatcher.removeOneFromCache(r,e)}removeManyFromCache(r,e){this.dispatcher.removeManyFromCache(r,e)}updateOneInCache(r,e){this.dispatcher.updateOneInCache(r,e)}updateManyInCache(r,e){this.dispatcher.updateManyInCache(r,e)}upsertOneInCache(r,e){this.dispatcher.upsertOneInCache(r,e)}upsertManyInCache(r,e){this.dispatcher.upsertManyInCache(r,e)}setFilter(r){this.dispatcher.setFilter(r)}setLoaded(r){this.dispatcher.setLoaded(!!r)}setLoading(r){this.dispatcher.setLoading(!!r)}},ke=(()=>{class n{constructor(e){this.entityDefinitionService=e}create(e){let t=this.entityDefinitionService&&this.entityDefinitionService.getDefinition(e,!1);return t&&t.initialState||js(e)}static{this.\u0275fac=function(t){return new(t||n)(l(ge,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();function js(n){return{entityName:n,ids:[],entities:{},filter:void 0,loaded:!1,loading:!1,changeState:{}}}var en=(()=>{class n{constructor(e,t){this.entityCollectionCreator=e||new ke,this.selectEntityCache=t||Wr(je)}createCollectionSelector(e){let t=(s={})=>s[e]||this.entityCollectionCreator.create(e);return k(this.selectEntityCache,t)}createCollectionSelectors(e){let t=typeof e=="string"?{entityName:e}:e,s=g=>g.ids,i=g=>g.entities,a=k(s,i,(g,S)=>g.map(E=>S[E])),o=k(s,g=>g.length),d=g=>g.filter,c=t.filterFn,h=c?k(a,d,(g,S)=>c(g,S)):a,y=g=>g.loaded,C=g=>g.loading,x=g=>g.changeState,V=t.additionalCollectionState||{},K={};return Object.keys(V).forEach(g=>{K["select"+g[0].toUpperCase()+g.slice(1)]=S=>S[g]}),f({selectCount:o,selectEntities:a,selectEntityMap:i,selectFilter:d,selectFilteredEntities:h,selectKeys:s,selectLoaded:y,selectLoading:C,selectChangeState:x},K)}create(e){let t=typeof e=="string"?{entityName:e}:e,s=t.entityName,i=this.createCollectionSelector(s),a=this.createCollectionSelectors(t),o={};return Object.keys(a).forEach(d=>{o[d]=k(i,a[d])}),f({entityName:s,selectCollection:i,selectEntityCache:this.selectEntityCache},o)}static{this.\u0275fac=function(t){return new(t||n)(l(ke,8),l(Le,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Dt=(()=>{class n{constructor(e,t,s){this.store=e,this.actions=t,this.selectEntityCache=s,this.entityCache$=this.store.select(this.selectEntityCache),this.entityActionErrors$=t.pipe(U(i=>i.payload&&i.payload.entityOp&&i.payload.entityOp.endsWith(Rt)),j(1))}create(e,t){let s={entityName:e};return Object.keys(t).forEach(i=>{if(i.startsWith("select")){let a=i[6].toLowerCase()+i.substring(7)+"$";s[a]=this.store.select(t[i])}}),s.entityActions$=this.actions.pipe(jr(e)),s.errors$=this.entityActionErrors$.pipe(jr(e)),s}static{this.\u0275fac=function(t){return new(t||n)(l($),l(Te),l(Le))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),tn=(()=>{class n{constructor(e,t,s,i){this.entityDispatcherFactory=e,this.entityDefinitionService=t,this.entitySelectorsFactory=s,this.entitySelectors$Factory=i}create(e){e=e.trim();let t=this.entityDefinitionService.getDefinition(e),s=this.entityDispatcherFactory.create(e,t.selectId,t.entityDispatcherOptions),i=this.entitySelectorsFactory.create(t.metadata),a=this.entitySelectors$Factory.create(e,i);return{dispatcher:s,entityName:e,selectors:i,selectors$:a}}static{this.\u0275fac=function(t){return new(t||n)(l(Ot),l(ge),l(en),l(Dt))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),rn=(()=>{class n{constructor(e){this.entityCollectionServiceElementsFactory=e}create(e){return new St(e,this.entityCollectionServiceElementsFactory)}static{this.\u0275fac=function(t){return new(t||n)(l(tn))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),nn=(()=>{class n{constructor(e,t,s,i){this.entityCollectionServiceFactory=e,this.store=i,this.entityActionErrors$=s.entityActionErrors$,this.entityCache$=s.entityCache$,this.reducedActions$=t.reducedActions$}static{this.\u0275fac=function(t){return new(t||n)(l(rn),l(Ot),l(Dt),l($))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Ls=(()=>{class n{constructor(e){this.entityServicesElements=e,this.EntityCollectionServices={}}get entityActionErrors$(){return this.entityServicesElements.entityActionErrors$}get entityCache$(){return this.entityServicesElements.entityCache$}get entityCollectionServiceFactory(){return this.entityServicesElements.entityCollectionServiceFactory}get reducedActions$(){return this.entityServicesElements.reducedActions$}get store(){return this.entityServicesElements.store}dispatch(e){this.store.dispatch(e)}createEntityCollectionService(e){return this.entityCollectionServiceFactory.create(e)}getEntityCollectionService(e){let t=this.EntityCollectionServices[e];return t||(t=this.createEntityCollectionService(e),this.EntityCollectionServices[e]=t),t}registerEntityCollectionService(e,t){this.EntityCollectionServices[t||e.entityName]=e}registerEntityCollectionServices(e){Array.isArray(e)?e.forEach(t=>this.registerEntityCollectionService(t)):Object.keys(e||{}).forEach(t=>{this.registerEntityCollectionService(e[t],t)})}static{this.\u0275fac=function(t){return new(t||n)(l(nn))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),vt=class{},w=function(n){return n[n.Unchanged=0]="Unchanged",n[n.Added=1]="Added",n[n.Deleted=2]="Deleted",n[n.Updated=3]="Updated",n}(w||{}),At=class{constructor(r,e){this.adapter=r,this.selectId=e,this.selectId=e||Ee}commitAll(r){return Object.keys(r.changeState).length===0?r:R(f({},r),{changeState:{}})}commitMany(r,e){if(r==null||r.length===0)return e;let t=!1,s=r.reduce((i,a)=>{let o=typeof a=="object"?this.selectId(a):a;return i[o]&&(t||(i=f({},i),t=!0),delete i[o]),i},e.changeState);return t?R(f({},e),{changeState:s}):e}commitOne(r,e){return r==null?e:this.commitMany([r],e)}mergeQueryResults(r,e,t){return this.mergeServerUpserts(r,e,N.PreserveChanges,t)}mergeSaveAdds(r,e,t){return this.mergeServerUpserts(r,e,N.OverwriteChanges,t)}mergeSaveDeletes(r,e,t){t=t??N.OverwriteChanges;let s=r;return e=t===N.IgnoreChanges?e:this.commitMany(s,e),this.adapter.removeMany(s,e)}mergeSaveUpdates(r,e,t,s=!1){if(r==null||r.length===0)return e;let i=!1,a=e.changeState;t=t??N.OverwriteChanges;let o;switch(t){case N.IgnoreChanges:return o=d(r),this.adapter.updateMany(o,e);case N.OverwriteChanges:return a=r.reduce((c,h)=>{let y=h.id;return c[y]&&(i||(c=f({},c),i=!0),delete c[y]),c},e.changeState),e=i?R(f({},e),{changeState:a}):e,o=d(r),this.adapter.updateMany(o,e);case N.PreserveChanges:{let c=[];return a=r.reduce((h,y)=>{let C=y.id,x=h[C];if(x){i||(h=f({},h),i=!0);let V=this.selectId(y.changes),K=x;V!==C&&delete h[C];let g=f(f({},K.originalValue),y.changes);h[V]=R(f({},K),{originalValue:g})}else c.push(y);return h},e.changeState),e=i?R(f({},e),{changeState:a}):e,o=d(c),this.adapter.updateMany(o,e)}}function d(c){return s===!0&&(c=c.filter(h=>h.changed===!0)),c.map(h=>({id:h.id,changes:h.changes}))}}mergeSaveUpserts(r,e,t){return this.mergeServerUpserts(r,e,N.OverwriteChanges,t)}mergeServerUpserts(r,e,t,s){if(r==null||r.length===0)return e;let i=!1,a=e.changeState;switch(s=s??t,s){case N.IgnoreChanges:return this.adapter.upsertMany(r,e);case N.OverwriteChanges:return e=this.adapter.upsertMany(r,e),a=r.reduce((o,d)=>{let c=this.selectId(d);return o[c]&&(i||(o=f({},o),i=!0),delete o[c]),o},e.changeState),i?R(f({},e),{changeState:a}):e;case N.PreserveChanges:{let o=[];return a=r.reduce((d,c)=>{let h=this.selectId(c);return d[h]?i||(d=R(f({},d),{[h]:R(f({},d[h]),{originalValue:c})}),i=!0):o.push(c),d},e.changeState),e=this.adapter.upsertMany(o,e),i?R(f({},e),{changeState:a}):e}}}trackAddMany(r,e,t){if(t===N.IgnoreChanges||r==null||r.length===0)return e;let s=!1,i=r.reduce((a,o)=>{let d=this.selectId(o);if(d==null||d==="")throw new Error(`${e.entityName} entity add requires a key to be tracked`);return a[d]||(s||(s=!0,a=f({},a)),a[d]={changeType:w.Added}),a},e.changeState);return s?R(f({},e),{changeState:i}):e}trackAddOne(r,e,t){return r==null?e:this.trackAddMany([r],e,t)}trackDeleteMany(r,e,t){if(t===N.IgnoreChanges||r==null||r.length===0)return e;let s=!1,i=e.entities,a=r.reduce((o,d)=>{let c=i[d];if(c){let y=o[d];y?y.changeType===w.Added?(h(),delete o[d]):y.changeType===w.Updated&&(h(),o[d]=R(f({},o[d]),{changeType:w.Deleted})):(h(),o[d]={changeType:w.Deleted,originalValue:c})}return o;function h(){s||(s=!0,o=f({},o))}},e.changeState);return s?R(f({},e),{changeState:a}):e}trackDeleteOne(r,e,t){return r==null?e:this.trackDeleteMany([r],e,t)}trackUpdateMany(r,e,t){if(t===N.IgnoreChanges||r==null||r.length===0)return e;let s=!1,i=e.entities,a=r.reduce((o,d)=>{let{id:c,changes:h}=d;if(c==null||c==="")throw new Error(`${e.entityName} entity update requires a key to be tracked`);let y=i[c];return y&&(o[c]||(s||(s=!0,o=f({},o)),o[c]={changeType:w.Updated,originalValue:y})),o},e.changeState);return s?R(f({},e),{changeState:a}):e}trackUpdateOne(r,e,t){return r==null?e:this.trackUpdateMany([r],e,t)}trackUpsertMany(r,e,t){if(t===N.IgnoreChanges||r==null||r.length===0)return e;let s=!1,i=e.entities,a=r.reduce((o,d)=>{let c=this.selectId(d);if(c==null||c==="")throw new Error(`${e.entityName} entity upsert requires a key to be tracked`);if(!o[c]){s||(s=!0,o=f({},o));let y=i[c];o[c]=y==null?{changeType:w.Added}:{changeType:w.Updated,originalValue:y}}return o},e.changeState);return s?R(f({},e),{changeState:a}):e}trackUpsertOne(r,e,t){return r==null?e:this.trackUpsertMany([r],e,t)}undoAll(r){let e=Object.keys(r.changeState),{remove:t,upsert:s}=e.reduce((i,a)=>{let o=i.chgState[a];switch(o.changeType){case w.Added:i.remove.push(a);break;case w.Deleted:let d=o.originalValue;d&&i.upsert.push(d);break;case w.Updated:i.upsert.push(o.originalValue);break}return i},{remove:[],upsert:[],chgState:r.changeState});return r=this.adapter.removeMany(t,r),r=this.adapter.upsertMany(s,r),R(f({},r),{changeState:{}})}undoMany(r,e){if(r==null||r.length===0)return e;let t=!1,{changeState:s,remove:i,upsert:a}=r.reduce((o,d)=>{let c=o.changeState,h=typeof d=="object"?this.selectId(d):d,y=c[h];if(y)switch(t||(c=f({},c),t=!0),delete c[h],o.changeState=c,y.changeType){case w.Added:o.remove.push(h);break;case w.Deleted:let C=y.originalValue;C&&o.upsert.push(C);break;case w.Updated:o.upsert.push(y.originalValue);break}return o},{remove:[],upsert:[],changeState:e.changeState});return e=this.adapter.removeMany(i,e),e=this.adapter.upsertMany(a,e),t?R(f({},e),{changeState:s}):e}undoOne(r,e){return r==null?e:this.undoMany([r],e)}},mt=class{constructor(r,e,t){this.entityName=r,this.definition=e,this.methods={[u.CANCEL_PERSIST]:this.cancelPersist.bind(this),[u.QUERY_ALL]:this.queryAll.bind(this),[u.QUERY_ALL_ERROR]:this.queryAllError.bind(this),[u.QUERY_ALL_SUCCESS]:this.queryAllSuccess.bind(this),[u.QUERY_BY_KEY]:this.queryByKey.bind(this),[u.QUERY_BY_KEY_ERROR]:this.queryByKeyError.bind(this),[u.QUERY_BY_KEY_SUCCESS]:this.queryByKeySuccess.bind(this),[u.QUERY_LOAD]:this.queryLoad.bind(this),[u.QUERY_LOAD_ERROR]:this.queryLoadError.bind(this),[u.QUERY_LOAD_SUCCESS]:this.queryLoadSuccess.bind(this),[u.QUERY_MANY]:this.queryMany.bind(this),[u.QUERY_MANY_ERROR]:this.queryManyError.bind(this),[u.QUERY_MANY_SUCCESS]:this.queryManySuccess.bind(this),[u.SAVE_ADD_MANY]:this.saveAddMany.bind(this),[u.SAVE_ADD_MANY_ERROR]:this.saveAddManyError.bind(this),[u.SAVE_ADD_MANY_SUCCESS]:this.saveAddManySuccess.bind(this),[u.SAVE_ADD_ONE]:this.saveAddOne.bind(this),[u.SAVE_ADD_ONE_ERROR]:this.saveAddOneError.bind(this),[u.SAVE_ADD_ONE_SUCCESS]:this.saveAddOneSuccess.bind(this),[u.SAVE_DELETE_MANY]:this.saveDeleteMany.bind(this),[u.SAVE_DELETE_MANY_ERROR]:this.saveDeleteManyError.bind(this),[u.SAVE_DELETE_MANY_SUCCESS]:this.saveDeleteManySuccess.bind(this),[u.SAVE_DELETE_ONE]:this.saveDeleteOne.bind(this),[u.SAVE_DELETE_ONE_ERROR]:this.saveDeleteOneError.bind(this),[u.SAVE_DELETE_ONE_SUCCESS]:this.saveDeleteOneSuccess.bind(this),[u.SAVE_UPDATE_MANY]:this.saveUpdateMany.bind(this),[u.SAVE_UPDATE_MANY_ERROR]:this.saveUpdateManyError.bind(this),[u.SAVE_UPDATE_MANY_SUCCESS]:this.saveUpdateManySuccess.bind(this),[u.SAVE_UPDATE_ONE]:this.saveUpdateOne.bind(this),[u.SAVE_UPDATE_ONE_ERROR]:this.saveUpdateOneError.bind(this),[u.SAVE_UPDATE_ONE_SUCCESS]:this.saveUpdateOneSuccess.bind(this),[u.SAVE_UPSERT_MANY]:this.saveUpsertMany.bind(this),[u.SAVE_UPSERT_MANY_ERROR]:this.saveUpsertManyError.bind(this),[u.SAVE_UPSERT_MANY_SUCCESS]:this.saveUpsertManySuccess.bind(this),[u.SAVE_UPSERT_ONE]:this.saveUpsertOne.bind(this),[u.SAVE_UPSERT_ONE_ERROR]:this.saveUpsertOneError.bind(this),[u.SAVE_UPSERT_ONE_SUCCESS]:this.saveUpsertOneSuccess.bind(this),[u.ADD_ALL]:this.addAll.bind(this),[u.ADD_MANY]:this.addMany.bind(this),[u.ADD_ONE]:this.addOne.bind(this),[u.REMOVE_ALL]:this.removeAll.bind(this),[u.REMOVE_MANY]:this.removeMany.bind(this),[u.REMOVE_ONE]:this.removeOne.bind(this),[u.UPDATE_MANY]:this.updateMany.bind(this),[u.UPDATE_ONE]:this.updateOne.bind(this),[u.UPSERT_MANY]:this.upsertMany.bind(this),[u.UPSERT_ONE]:this.upsertOne.bind(this),[u.COMMIT_ALL]:this.commitAll.bind(this),[u.COMMIT_MANY]:this.commitMany.bind(this),[u.COMMIT_ONE]:this.commitOne.bind(this),[u.UNDO_ALL]:this.undoAll.bind(this),[u.UNDO_MANY]:this.undoMany.bind(this),[u.UNDO_ONE]:this.undoOne.bind(this),[u.SET_CHANGE_STATE]:this.setChangeState.bind(this),[u.SET_COLLECTION]:this.setCollection.bind(this),[u.SET_FILTER]:this.setFilter.bind(this),[u.SET_LOADED]:this.setLoaded.bind(this),[u.SET_LOADING]:this.setLoading.bind(this)},this.adapter=e.entityAdapter,this.isChangeTracking=e.noChangeTracking!==!0,this.selectId=e.selectId,this.guard=new Ue(r,this.selectId),this.toUpdate=Vr(this.selectId),this.entityChangeTracker=t||new At(this.adapter,this.selectId)}cancelPersist(r){return this.setLoadingFalse(r)}queryAll(r){return this.setLoadingTrue(r)}queryAllError(r,e){return this.setLoadingFalse(r)}queryAllSuccess(r,e){let t=this.extractData(e),s=this.extractMergeStrategy(e);return R(f({},this.entityChangeTracker.mergeQueryResults(t,r,s)),{loaded:!0,loading:!1})}queryByKey(r,e){return this.setLoadingTrue(r)}queryByKeyError(r,e){return this.setLoadingFalse(r)}queryByKeySuccess(r,e){let t=this.extractData(e),s=this.extractMergeStrategy(e);return r=t==null?r:this.entityChangeTracker.mergeQueryResults([t],r,s),this.setLoadingFalse(r)}queryLoad(r){return this.setLoadingTrue(r)}queryLoadError(r,e){return this.setLoadingFalse(r)}queryLoadSuccess(r,e){let t=this.extractData(e);return R(f({},this.adapter.setAll(t,r)),{loading:!1,loaded:!0,changeState:{}})}queryMany(r,e){return this.setLoadingTrue(r)}queryManyError(r,e){return this.setLoadingFalse(r)}queryManySuccess(r,e){let t=this.extractData(e),s=this.extractMergeStrategy(e);return R(f({},this.entityChangeTracker.mergeQueryResults(t,r,s)),{loaded:!0,loading:!1})}saveAddMany(r,e){if(this.isOptimistic(e)){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackAddMany(t,r,s),r=this.adapter.addMany(t,r)}return this.setLoadingTrue(r)}saveAddManyError(r,e){return this.setLoadingFalse(r)}saveAddManySuccess(r,e){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);return this.isOptimistic(e)?r=this.entityChangeTracker.mergeSaveUpserts(t,r,s):r=this.entityChangeTracker.mergeSaveAdds(t,r,s),this.setLoadingFalse(r)}saveAddOne(r,e){if(this.isOptimistic(e)){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackAddOne(t,r,s),r=this.adapter.addOne(t,r)}return this.setLoadingTrue(r)}saveAddOneError(r,e){return this.setLoadingFalse(r)}saveAddOneSuccess(r,e){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);if(this.isOptimistic(e)){let i=this.toUpdate(t);r=this.entityChangeTracker.mergeSaveUpdates([i],r,s,!1)}else r=this.entityChangeTracker.mergeSaveAdds([t],r,s);return this.setLoadingFalse(r)}saveDeleteOne(r,e){let t=this.extractData(e),s=typeof t=="object"?this.selectId(t):t,i=r.changeState[s];if(i&&(i.changeType===w.Added?(r=this.adapter.removeOne(s,r),r=this.entityChangeTracker.commitOne(s,r),e.payload.skip=!0):r=this.entityChangeTracker.trackDeleteOne(s,r)),this.isOptimistic(e)){let a=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackDeleteOne(s,r,a),r=this.adapter.removeOne(s,r)}return this.setLoadingTrue(r)}saveDeleteOneError(r,e){return this.setLoadingFalse(r)}saveDeleteOneSuccess(r,e){let t=this.extractData(e);if(this.isOptimistic(e)){let s=this.extractMergeStrategy(e);r=this.entityChangeTracker.mergeSaveDeletes([t],r,s)}else r=this.adapter.removeOne(t,r),r=this.entityChangeTracker.commitOne(t,r);return this.setLoadingFalse(r)}saveDeleteMany(r,e){let t=this.extractData(e).map(s=>typeof s=="object"?this.selectId(s):s);if(t.forEach(s=>{let i=r.changeState[s];i&&(i.changeType===w.Added?(r=this.adapter.removeOne(s,r),r=this.entityChangeTracker.commitOne(s,r),e.payload.skip=!0):r=this.entityChangeTracker.trackDeleteOne(s,r))}),this.isOptimistic(e)){let s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackDeleteMany(t,r,s),r=this.adapter.removeMany(t,r)}return this.setLoadingTrue(r)}saveDeleteManyError(r,e){return this.setLoadingFalse(r)}saveDeleteManySuccess(r,e){let t=this.extractData(e);if(this.isOptimistic(e)){let s=this.extractMergeStrategy(e);r=this.entityChangeTracker.mergeSaveDeletes(t,r,s)}else r=this.adapter.removeMany(t,r),r=this.entityChangeTracker.commitMany(t,r);return this.setLoadingFalse(r)}saveUpdateOne(r,e){let t=this.guard.mustBeUpdate(e);if(this.isOptimistic(e)){let s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackUpdateOne(t,r,s),r=this.adapter.updateOne(t,r)}return this.setLoadingTrue(r)}saveUpdateOneError(r,e){return this.setLoadingFalse(r)}saveUpdateOneSuccess(r,e){let t=this.guard.mustBeUpdateResponse(e),s=this.isOptimistic(e),i=this.extractMergeStrategy(e);return r=this.entityChangeTracker.mergeSaveUpdates([t],r,i,s),this.setLoadingFalse(r)}saveUpdateMany(r,e){let t=this.guard.mustBeUpdates(e);if(this.isOptimistic(e)){let s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackUpdateMany(t,r,s),r=this.adapter.updateMany(t,r)}return this.setLoadingTrue(r)}saveUpdateManyError(r,e){return this.setLoadingFalse(r)}saveUpdateManySuccess(r,e){let t=this.guard.mustBeUpdateResponses(e),s=this.isOptimistic(e),i=this.extractMergeStrategy(e);return r=this.entityChangeTracker.mergeSaveUpdates(t,r,i,!1),this.setLoadingFalse(r)}saveUpsertOne(r,e){if(this.isOptimistic(e)){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackUpsertOne(t,r,s),r=this.adapter.upsertOne(t,r)}return this.setLoadingTrue(r)}saveUpsertOneError(r,e){return this.setLoadingFalse(r)}saveUpsertOneSuccess(r,e){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.mergeSaveUpserts([t],r,s),this.setLoadingFalse(r)}saveUpsertMany(r,e){if(this.isOptimistic(e)){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);r=this.entityChangeTracker.trackUpsertMany(t,r,s),r=this.adapter.upsertMany(t,r)}return this.setLoadingTrue(r)}saveUpsertManyError(r,e){return this.setLoadingFalse(r)}saveUpsertManySuccess(r,e){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.mergeSaveUpserts(t,r,s),this.setLoadingFalse(r)}addAll(r,e){let t=this.guard.mustBeEntities(e);return R(f({},this.adapter.setAll(t,r)),{loading:!1,loaded:!0,changeState:{}})}addMany(r,e){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackAddMany(t,r,s),this.adapter.addMany(t,r)}addOne(r,e){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackAddOne(t,r,s),this.adapter.addOne(t,r)}removeMany(r,e){let t=this.guard.mustBeKeys(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackDeleteMany(t,r,s),this.adapter.removeMany(t,r)}removeOne(r,e){let t=this.guard.mustBeKey(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackDeleteOne(t,r,s),this.adapter.removeOne(t,r)}removeAll(r,e){return R(f({},this.adapter.removeAll(r)),{loaded:!1,loading:!1,changeState:{}})}updateMany(r,e){let t=this.guard.mustBeUpdates(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackUpdateMany(t,r,s),this.adapter.updateMany(t,r)}updateOne(r,e){let t=this.guard.mustBeUpdate(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackUpdateOne(t,r,s),this.adapter.updateOne(t,r)}upsertMany(r,e){let t=this.guard.mustBeEntities(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackUpsertMany(t,r,s),this.adapter.upsertMany(t,r)}upsertOne(r,e){let t=this.guard.mustBeEntity(e),s=this.extractMergeStrategy(e);return r=this.entityChangeTracker.trackUpsertOne(t,r,s),this.adapter.upsertOne(t,r)}commitAll(r){return this.entityChangeTracker.commitAll(r)}commitMany(r,e){return this.entityChangeTracker.commitMany(this.extractData(e),r)}commitOne(r,e){return this.entityChangeTracker.commitOne(this.extractData(e),r)}undoAll(r){return this.entityChangeTracker.undoAll(r)}undoMany(r,e){return this.entityChangeTracker.undoMany(this.extractData(e),r)}undoOne(r,e){return this.entityChangeTracker.undoOne(this.extractData(e),r)}setChangeState(r,e){let t=this.extractData(e);return r.changeState===t?r:R(f({},r),{changeState:t})}setCollection(r,e){let t=this.extractData(e);return r===t?r:t}setFilter(r,e){let t=this.extractData(e);return r.filter===t?r:R(f({},r),{filter:t})}setLoaded(r,e){let t=this.extractData(e)===!0||!1;return r.loaded===t?r:R(f({},r),{loaded:t})}setLoading(r,e){return this.setLoadingFlag(r,this.extractData(e))}setLoadingFalse(r){return this.setLoadingFlag(r,!1)}setLoadingTrue(r){return this.setLoadingFlag(r,!0)}setLoadingFlag(r,e){return e=e===!0,r.loading===e?r:R(f({},r),{loading:e})}extractData(r){return r.payload&&r.payload.data}extractMergeStrategy(r){return this.isChangeTracking?r.payload&&r.payload.mergeStrategy:N.IgnoreChanges}isOptimistic(r){return r.payload&&r.payload.isOptimistic===!0}},sn=(()=>{class n{constructor(e){this.entityDefinitionService=e}create(e){let t=this.entityDefinitionService.getDefinition(e);return new mt(e,t).methods}static{this.\u0275fac=function(t){return new(t||n)(l(ge))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),an=(()=>{class n{constructor(e){this.methodsFactory=e}create(e){let t=this.methodsFactory.create(e);return function(i,a){let o=t[a.payload.entityOp];return o?o(i,a):i}}static{this.\u0275fac=function(t){return new(t||n)(l(sn))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),on=(()=>{class n{constructor(e,t){this.entityCollectionReducerFactory=e,this.entityCollectionReducers={},this.entityCollectionMetaReducer=Ce.apply(null,t||[])}getOrCreateReducer(e){let t=this.entityCollectionReducers[e];return t||(t=this.entityCollectionReducerFactory.create(e),t=this.registerReducer(e,t),this.entityCollectionReducers[e]=t),t}registerReducer(e,t){return t=this.entityCollectionMetaReducer(t),this.entityCollectionReducers[e.trim()]=t}registerReducers(e){(e?Object.keys(e):[]).forEach(s=>this.registerReducer(s,e[s]))}static{this.\u0275fac=function(t){return new(t||n)(l(an),l(Gr,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),cn=(()=>{class n{constructor(e,t,s){this.entityCollectionCreator=e,this.entityCollectionReducerRegistry=t,this.logger=s}create(){return e.bind(this);function e(t={},s){switch(s.type){case D.CLEAR_COLLECTIONS:return this.clearCollectionsReducer(t,s);case D.LOAD_COLLECTIONS:return this.loadCollectionsReducer(t,s);case D.MERGE_QUERY_SET:return this.mergeQuerySetReducer(t,s);case D.SAVE_ENTITIES:return this.saveEntitiesReducer(t,s);case D.SAVE_ENTITIES_CANCEL:return this.saveEntitiesCancelReducer(t,s);case D.SAVE_ENTITIES_ERROR:return this.saveEntitiesErrorReducer(t,s);case D.SAVE_ENTITIES_SUCCESS:return this.saveEntitiesSuccessReducer(t,s);case D.SET_ENTITY_CACHE:return s.payload.cache}let i=s.payload;return i&&i.entityName&&i.entityOp&&!i.error?this.applyCollectionReducer(t,s):t}}clearCollectionsReducer(e,t){let{collections:s,tag:i}=t.payload,a=u.REMOVE_ALL;return s||(s=Object.keys(e)),e=s.reduce((o,d)=>{let c={entityName:d,entityOp:a},h={type:`[${d}] ${t.type}`,payload:c};return o=this.applyCollectionReducer(o,h),o},e),e}loadCollectionsReducer(e,t){let{collections:s,tag:i}=t.payload,a=u.ADD_ALL;return e=Object.keys(s).reduce((d,c)=>{let h={entityName:c,entityOp:a,data:s[c]},y={type:`[${c}] ${t.type}`,payload:h};return d=this.applyCollectionReducer(d,y),d},e),e}mergeQuerySetReducer(e,t){let{mergeStrategy:s,querySet:i,tag:a}=t.payload;s=s===null?N.PreserveChanges:s;let o=u.QUERY_MANY_SUCCESS;return e=Object.keys(i).reduce((c,h)=>{let y={entityName:h,entityOp:o,data:i[h],mergeStrategy:s},C={type:`[${h}] ${t.type}`,payload:y};return c=this.applyCollectionReducer(c,C),c},e),e}saveEntitiesReducer(e,t){let{changeSet:s,correlationId:i,isOptimistic:a,mergeStrategy:o,tag:d}=t.payload;try{s.changes.forEach(h=>{let y=h.entityName,C={entityName:y,entityOp:c(h),data:h.entities,correlationId:i,isOptimistic:a,mergeStrategy:o,tag:d},x={type:`[${y}] ${t.type}`,payload:C};if(e=this.applyCollectionReducer(e,x),x.payload.error)throw x.payload.error})}catch(h){t.payload.error=h}return e;function c(h){switch(h.op){case L.Add:return u.SAVE_ADD_MANY;case L.Delete:return u.SAVE_DELETE_MANY;case L.Update:return u.SAVE_UPDATE_MANY;case L.Upsert:return u.SAVE_UPSERT_MANY}}}saveEntitiesCancelReducer(e,t){return this.clearLoadingFlags(e,t.payload.entityNames||[])}saveEntitiesErrorReducer(e,t){let a=t.payload.originalAction.payload.changeSet.changes.map(o=>o.entityName);return this.clearLoadingFlags(e,a)}saveEntitiesSuccessReducer(e,t){let{changeSet:s,correlationId:i,isOptimistic:a,mergeStrategy:o,tag:d}=t.payload;return s.changes.forEach(h=>{let y=h.entityName,C={entityName:y,entityOp:c(h),data:h.entities,correlationId:i,isOptimistic:a,mergeStrategy:o,tag:d},x={type:`[${y}] ${t.type}`,payload:C};e=this.applyCollectionReducer(e,x)}),e;function c(h){switch(h.op){case L.Add:return u.SAVE_ADD_MANY_SUCCESS;case L.Delete:return u.SAVE_DELETE_MANY_SUCCESS;case L.Update:return u.SAVE_UPDATE_MANY_SUCCESS;case L.Upsert:return u.SAVE_UPSERT_MANY_SUCCESS}}}applyCollectionReducer(e={},t){let s=t.payload.entityName,i=e[s],a=this.entityCollectionReducerRegistry.getOrCreateReducer(s),o;try{o=a(i||this.entityCollectionCreator.create(s),t)}catch(d){this.logger.error(d),t.payload.error=d}return t.payload.error||i===o?e:R(f({},e),{[s]:o})}clearLoadingFlags(e,t){let s=!1;return t.forEach(i=>{let a=e[i];a.loading&&(s||(e=f({},e),s=!0),e[i]=R(f({},a),{loading:!1}))}),e}static{this.\u0275fac=function(t){return new(t||n)(l(ke),l(on),l(ie))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),$s=(()=>{class n{error(e,t){e&&(t?console.error(e,t):console.error(e))}log(e,t){e&&(t?console.log(e,t):console.log(e))}warn(e,t){e&&(t?console.warn(e,t):console.warn(e))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})(),Vs=["equipment","information","money","series"],Ys=(()=>{class n{constructor(e){this.pluralNames={},e&&e.forEach(t=>this.registerPluralNames(t))}pluralize(e){let t=this.pluralNames[e];return t||(Vs.indexOf(e.toLowerCase())>=0?e:/[aeiou]y$/.test(e)?e+"s":e.endsWith("y")?e.substring(0,e.length-1)+"ies":/[s|ss|sh|ch|x|z]$/.test(e)?e+"es":e+"s")}registerPluralNames(e){this.pluralNames=f(f({},this.pluralNames),e||{})}static{this.\u0275fac=function(t){return new(t||n)(l(Br,8))}}static{this.\u0275prov=_({token:n,factory:n.\u0275fac})}}return n})();var Ps=[Mt,Ct,ye,bs,cn,ws,ke,an,sn,on,tn,rn,ge,Ot,en,Dt,nn,{provide:_t,useValue:je},{provide:vt,useClass:Ls},{provide:ie,useClass:$s},{provide:ce,multi:!0,useValue:()=>Bs()}];function Bs(){let n=F(ne),r=F(cn),e=F(_t,{optional:!0}),t=F(Fs,{optional:!0}),s=F(zr,{optional:!0}),i=e||je,a=(s||[]).map(c=>c instanceof A?F(c):c),o=typeof t=="function"?t():t,d={key:i,reducers:r.create(),reducerFactory:he,initialState:o||{},metaReducers:a};n.addFeature(d)}var Ks=[Kr,qr,Hr,Jr,Xr,{provide:be,useClass:Is},{provide:Fe,useClass:xs},{provide:xe,useClass:Ys},{provide:ce,multi:!0,useValue:()=>Qs()}];function Qs(){let n=F(Ie),r=F(Jr),e=F(Xr);n.addEffects(r),n.addEffects(e)}function un(n){return[{provide:zr,useValue:n.entityCacheMetaReducers?n.entityCacheMetaReducers:[]},{provide:Gr,useValue:n.entityCollectionMetaReducers?n.entityCollectionMetaReducers:[]},{provide:Br,multi:!0,useValue:n.pluralNames?n.pluralNames:{}},{provide:Qr,multi:!0,useValue:n.entityMetadata?n.entityMetadata:[]}]}var qs=(()=>{class n{static forRoot(e){return{ngModule:n,providers:[un(e)]}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({providers:[Ps]})}}return n})(),Ni=(()=>{class n{static forRoot(e){return{ngModule:n,providers:[un(e)]}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=B({type:n})}static{this.\u0275inj=P({providers:[Ks],imports:[qs]})}}return n})();export{cr as a,se as b,Xe as c,de as d,Re as e,En as f,Z as g,Me as h,ei as i,fi as j,St as k,tn as l,Ni as m};
