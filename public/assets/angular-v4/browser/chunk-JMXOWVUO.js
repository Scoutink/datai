import{a as F}from"./chunk-DL4SMTXP.js";import{B as D,F as k,H as Dt,I as kt,J as Ht,L as $t,M as Ft,O as Vt,P as Ot,R as Bt,S as zt,U as Ut,Y as H,Z as Qt,ba as $,da as qt,j as jt,ja as Gt,n as At,o as Nt,p as Pt,v as P,x as Rt,z as R}from"./chunk-H5SZDBVN.js";import"./chunk-XE6VZSAJ.js";import"./chunk-KX634QZQ.js";import"./chunk-3O3IKF6A.js";import{ka as N,ma as Lt}from"./chunk-TR4MAYT5.js";import{p as Tt,t as A}from"./chunk-AWIVOLPG.js";import"./chunk-J2LIJEQH.js";import"./chunk-AGIEFCW2.js";import"./chunk-F5F27R7A.js";import{C as wt,D as xt,c as Et,h as yt,n as Mt}from"./chunk-6EN4EXPL.js";import{$ as rt,$b as mt,B as et,Ba as st,Ca as x,Cb as p,Ea as lt,Fc as u,Gb as d,Gc as f,Ka as T,Kd as _t,La as j,Md as bt,Nd as It,Pd as Y,Q as it,Qb as o,Rb as r,Sb as g,Ta as U,Tb as _,Ua as Q,Ub as b,W as nt,Wb as q,Zb as y,dd as L,fa as ot,fc as G,gc as W,ha as at,hc as J,jd as ht,kc as K,mc as c,md as vt,nc as I,o as tt,ob as l,oc as E,p as w,pb as S,pd as gt,sc as dt,tc as pt,td as Ct,uc as ut,wa as ct,xd as St,yc as X,zc as ft}from"./chunk-SXJN2XK6.js";var V=class{constructor(a){this.interactiveService=a,this.contentSubject=new w([]),this.loadingSubject=new w(!1),this.totalCountSubject=new w(0),this.loading$=this.loadingSubject.asObservable(),this.totalCount$=this.totalCountSubject.asObservable()}connect(a){return this.contentSubject.asObservable()}disconnect(a){this.contentSubject.complete(),this.loadingSubject.complete(),this.totalCountSubject.complete()}loadContent(a="",e="id",i="desc",n=0,s=10){this.loadingSubject.next(!0),this.interactiveService.getContent(a,e,i,n+1,s).pipe(nt(()=>et({data:[],total:0})),at(()=>this.loadingSubject.next(!1))).subscribe(m=>{this.contentSubject.next(m.data),this.totalCountSubject.next(m.total)})}};var B=(()=>{class t{constructor(e){this.http=e,this.apiUrl="interactive"}getContent(e,i,n,s,m){let C=new Ct().set("search",e).set("sortColumn",i).set("sortOrder",n).set("pageIndex",s.toString()).set("pageSize",m.toString());return this.http.get(`${this.apiUrl}/content`,{params:C})}getLibraries(){return this.http.get(`${this.apiUrl}/libraries`)}getEditorSettings(e){let i=e?`${this.apiUrl}/editor/settings/${e}`:`${this.apiUrl}/editor/settings`;return this.http.get(i)}saveContent(e){return this.http.post(`${this.apiUrl}/editor/store`,e)}deleteContent(e){return this.http.delete(`${this.apiUrl}/content/${e}`)}static{this.\u0275fac=function(i){return new(i||t)(lt(St))}}static{this.\u0275prov=st({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var ae=()=>["/interactive/create"],ce=()=>[10,20,50],se=t=>["/interactive/edit",t];function le(t,a){t&1&&(o(0,"div",34),g(1,"mat-spinner"),r())}function me(t,a){t&1&&(o(0,"th",35),c(1," Title "),r())}function de(t,a){if(t&1&&(o(0,"td",36),c(1),r()),t&2){let e=a.$implicit;l(),E(" ",e.title," ")}}function pe(t,a){t&1&&(o(0,"th",37),c(1," Library "),r())}function ue(t,a){if(t&1&&(o(0,"td",36),c(1),r()),t&2){let e=a.$implicit;l(),E(" ",e.library_title," ")}}function fe(t,a){t&1&&(o(0,"th",37),c(1," Author "),r())}function he(t,a){if(t&1&&(o(0,"td",36),c(1),r()),t&2){let e=a.$implicit;l(),E(" ",e.created_by_name," ")}}function ve(t,a){t&1&&(o(0,"th",35),c(1," Created At "),r())}function ge(t,a){if(t&1&&(o(0,"td",36),c(1),u(2,"date"),r()),t&2){let e=a.$implicit;l(),E(" ",f(2,1,e.created_at)," ")}}function Ce(t,a){t&1&&(o(0,"th",37),c(1," Actions "),r())}function Se(t,a){if(t&1){let e=q();o(0,"td",36)(1,"button",38)(2,"mat-icon"),c(3,"more_vert"),r()(),o(4,"mat-menu",null,1)(6,"button",39)(7,"mat-icon"),c(8,"edit"),r(),o(9,"span"),c(10,"Edit"),r()(),o(11,"button",40),y("click",function(){let n=U(e).$implicit,s=mt();return Q(s.deleteContent(n.id))}),o(12,"mat-icon"),c(13,"delete"),r(),o(14,"span"),c(15,"Delete"),r()()()()}if(t&2){let e=a.$implicit,i=K(5);l(),d("matMenuTriggerFor",i),l(5),d("routerLink",ft(2,se,e.id))}}function _e(t,a){t&1&&g(0,"tr",41)}function be(t,a){t&1&&g(0,"tr",42)}var Jt=(()=>{class t{constructor(e){this.interactiveService=e,this.displayedColumns=["title","library","author","created_at","actions"],this.searchString="",this.searchSubject=new tt}ngOnInit(){this.dataSource=new V(this.interactiveService),this.dataSource.loadContent(),this.searchSubject.pipe(rt(300),ot()).subscribe(e=>{this.dataSource.loadContent(e)})}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),it(this.sort.sortChange,this.paginator.page).pipe(ct(()=>this.loadContentPage())).subscribe()}loadContentPage(){this.dataSource.loadContent(this.searchString,this.sort.active,this.sort.direction,this.paginator.pageIndex,this.paginator.pageSize)}onSearch(e){this.searchString=e,this.searchSubject.next(e)}deleteContent(e){}static{this.\u0275fac=function(i){return new(i||t)(S(B))}}static{this.\u0275cmp=T({type:t,selectors:[["app-interactive-list"]],viewQuery:function(i,n){if(i&1&&(G($,5),G(H,5)),i&2){let s;W(s=J())&&(n.paginator=s.first),W(s=J())&&(n.sort=s.first)}},decls:53,vars:23,consts:[["searchInput",""],["menu","matMenu"],[1,"content"],[1,"content-block"],[1,"block-header"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"breadcrumb-list"],[1,"breadcrumb-item"],[1,"page-title"],[1,"row","clearfix"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[1,"card"],[1,"body"],[1,"row","margin-bottom-10"],[1,"col-sm-12","col-md-6"],["mat-raised-button","","color","primary",3,"routerLink"],["appearance","outline",1,"w-100"],["matInput","",3,"keyup"],["matSuffix",""],["class","loading-shade",4,"ngIf"],[1,"table-responsive","mat-elevation-z8"],["mat-table","","matSort","",1,"w-100",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","library"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","author"],["matColumnDef","created_at"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"length","pageSize","pageSizeOptions"],[1,"loading-shade"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,n){if(i&1){let s=q();o(0,"section",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"ul",7)(6,"li",8)(7,"h4",9),c(8),u(9,"translate"),r()()()()()(),o(10,"div",10)(11,"div",11)(12,"div",12)(13,"div",13)(14,"div",14)(15,"div",15)(16,"button",16)(17,"mat-icon"),c(18,"add"),r(),c(19),u(20,"translate"),r()(),o(21,"div",15)(22,"mat-form-field",17)(23,"mat-label"),c(24),u(25,"translate"),r(),o(26,"input",18,0),y("keyup",function(){U(s);let C=K(27);return Q(n.onSearch(C.value))}),r(),o(28,"mat-icon",19),c(29,"search"),r()()()(),p(30,le,2,0,"div",20),u(31,"async"),o(32,"div",21)(33,"table",22),_(34,23),p(35,me,2,0,"th",24)(36,de,2,1,"td",25),b(),_(37,26),p(38,pe,2,0,"th",27)(39,ue,2,1,"td",25),b(),_(40,28),p(41,fe,2,0,"th",27)(42,he,2,1,"td",25),b(),_(43,29),p(44,ve,2,0,"th",24)(45,ge,3,3,"td",25),b(),_(46,30),p(47,Ce,2,0,"th",27)(48,Se,16,4,"td",25),b(),p(49,_e,1,0,"tr",31)(50,be,1,0,"tr",32),r(),g(51,"mat-paginator",33),u(52,"async"),r()()()()()()()}i&2&&(l(8),I(f(9,11,"INTERACTIVE_CONTENT")),l(8),d("routerLink",X(21,ae)),l(3),E(" ",f(20,13,"CREATE_NEW")," "),l(5),I(f(25,15,"SEARCH")),l(6),d("ngIf",f(31,17,n.dataSource.loading$)),l(3),d("dataSource",n.dataSource),l(16),d("matHeaderRowDef",n.displayedColumns),l(),d("matRowDefColumns",n.displayedColumns),l(),d("length",f(52,19,n.dataSource.totalCount$))("pageSize",10)("pageSizeOptions",X(22,ce)))},dependencies:[L,It,N,Lt,D,R,P,Rt,jt,Nt,At,Pt,k,Dt,Ht,Ot,$t,kt,Bt,Ft,Vt,zt,Ut,H,Qt,$,ht,vt,A],styles:[".table-container[_ngcontent-%COMP%]{overflow:auto;max-height:70vh}.loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000026;z-index:1000;display:flex;align-items:center;justify-content:center}"]})}}return t})();function Ie(t,a){t&1&&(o(0,"div",13),g(1,"mat-spinner"),r())}var Z=(()=>{class t{constructor(e,i,n,s){this.interactiveService=e,this.route=i,this.router=n,this.toastr=s,this.loading=!0,this.title=""}ngOnInit(){this.interactiveService.getEditorSettings().subscribe({next:e=>{this.settings=e,this.initializeH5P(e)},error:e=>{this.loading=!1,this.toastr.error("Failed to load editor settings."),console.error(e)}})}initializeH5P(e){window.H5PIntegration=e,this.loadAssets(e.core.scripts,e.core.styles,e.editor.assets.js,e.editor.assets.css).then(()=>{this.loading=!1;let i=window.H5P.jQuery,n=i("#h5p-editor-form");new H5PEditor.Editor(void 0,void 0,n.find(".h5p-editor"))})}loadAssets(e,i,n,s){let m=[...e,...n],C=[...i,...s],z=h=>new Promise((v,Yt)=>{if(document.querySelector(`script[src="${h}"]`)){v();return}let M=document.createElement("script");M.src=h,M.onload=()=>v(),M.onerror=()=>Yt(),document.body.appendChild(M)}),Xt=h=>{if(document.querySelector(`link[href="${h}"]`))return;let v=document.createElement("link");v.rel="stylesheet",v.href=h,document.head.appendChild(v)};return C.forEach(h=>Xt(h)),m.reduce((h,v)=>h.then(()=>z(v)),Promise.resolve())}save(){let e=window.H5P.jQuery,i=window.H5PEditor.Html,n=window.H5PEditor.instances[0];if(!n){this.toastr.error("Editor instance not found");return}let s=n.getParams(),m=n.getLibrary();if(!s||!m){this.toastr.warning("Please select content type.");return}let C={title:this.title||"Untitled",library:m,params:JSON.stringify(s)};this.interactiveService.saveContent(C).subscribe({next:z=>{this.toastr.success("Saved successfully!"),this.router.navigate(["/interactive"])},error:z=>this.toastr.error("Failed to save.")})}static{this.\u0275fac=function(i){return new(i||t)(S(B),S(_t),S(bt),S(Tt))}}static{this.\u0275cmp=T({type:t,selectors:[["app-interactive-editor"]],decls:21,vars:8,consts:[[1,"page-header-main"],[1,"row","align-items-center","justify-content-between"],[1,"col-md-auto","col-sm-auto"],[1,"content-header"],["mat-raised-button","","color","primary",3,"click"],[1,"interactive-editor-container",2,"padding","20px"],[1,"row","mb-3"],[1,"col-md-12"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Enter content title",3,"ngModelChange","ngModel"],["class","d-flex justify-content-center p-5",4,"ngIf"],["id","h5p-editor-form"],[1,"h5p-editor"],[1,"d-flex","justify-content-center","p-5"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),c(5),u(6,"translate"),r()()(),o(7,"div",2)(8,"button",4),y("click",function(){return n.save()}),c(9),u(10,"translate"),r()()()(),o(11,"div",5)(12,"div",6)(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),c(16,"Title"),r(),o(17,"input",9),ut("ngModelChange",function(m){return pt(n.title,m)||(n.title=m),m}),r()()()(),p(18,Ie,2,0,"div",10),o(19,"div",11),g(20,"div",12),r()()),i&2&&(l(5),I(f(6,4,"CREATE_INTERACTIVE_CONTENT")),l(4),I(f(10,6,"SAVE")),l(8),dt("ngModel",n.title),l(),d("ngIf",n.loading))},dependencies:[L,Et,yt,Mt,N,D,R,P,k,A],styles:[`.interactive-editor-container{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}.h5p-editor{min-height:500px}
`],encapsulation:2})}}return t})();var Ee=[{path:"create",component:Z,canActivate:[F],data:{claimType:"MANAGE_INTERACTIVE_CONTENT"}},{path:"edit/:id",component:Z,canActivate:[F],data:{claimType:"MANAGE_INTERACTIVE_CONTENT"}},{path:"",component:Jt,canActivate:[F],data:{claimType:"MANAGE_INTERACTIVE_CONTENT"}},{path:"content",redirectTo:"",pathMatch:"full"}],Kt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=j({type:t})}static{this.\u0275inj=x({imports:[Y.forChild(Ee),Y]})}}return t})();var ni=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=j({type:t})}static{this.\u0275inj=x({imports:[gt,Kt,Gt,qt,wt,xt]})}}return t})();export{ni as InteractiveModule};
