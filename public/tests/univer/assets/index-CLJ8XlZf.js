import{L as ve,bB as J,aG as z,bk as xe,da as fe,b6 as ae,c5 as yt,fk as Rt,u as we,d_ as _e,aB as Be,dv as rt,f$ as pe,gf as Ze,gd as Fe,ea as xt,gl as Mt,bm as He,bi as Ae,ba as nt,bh as jt,bo as Ot,b7 as Tt}from"./index-BI8deSNo.js";import{IDrawingManagerService as Q,getDrawingShapeKeyByDrawingSearch as A,SetDrawingSelectedOperation as Me}from"./index-u4QJ_A0o.js";import{aa as le,ad as Ge,t as je,aG as it,a_ as Et,y as Ut,a5 as me,aD as ze,cG as Ce,c as Oe,bm as Le,bz as Ye,bP as Dt,cY as Nt}from"./index-DnxWP_AP.js";import{bt as B,bE as kt,w as Bt,ae as Ht,a8 as At,a6 as Pt}from"./index-BeEHzc6r.js";import{aj as _,ak as g,a4 as Y,d as Lt,T as Vt,Z as ne,f as ge,u as Gt,p as at,i as Xe}from"./index-BmfxE5KL.js";import{b as Wt}from"./bufferTime-Dc1Jgi3q.js";import"./shareReplay-DR2HpNHE.js";import"./isObservable-DLg0_x3m.js";var $t=Object.defineProperty,Zt=(t,e,r)=>e in t?$t(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,K=(t,e,r)=>Zt(t,typeof e!="symbol"?e+"":e,r),j=(t=>(t.default="0",t.left="1",t.center="2",t.right="3",t.top="4",t.middle="5",t.bottom="6",t.horizon="7",t.vertical="8",t))(j||{});const $e={id:"sheet.operation.set-image-align",type:ve.OPERATION,handler:(t,e)=>!0},We={id:"sheet.operation.open-image-crop",type:ve.OPERATION,handler:(t,e)=>!0},ie={id:"sheet.operation.close-image-crop",type:ve.OPERATION,handler:(t,e)=>!0};var D=(t=>(t.FREE="0",t.R1_1="1",t.R16_9="2",t.R9_16="3",t.R5_4="4",t.R4_5="5",t.R4_3="6",t.R3_4="7",t.R3_2="8",t.R2_3="9",t))(D||{});const Te={id:"sheet.operation.Auto-image-crop",type:ve.OPERATION,handler:(t,e)=>!0},st={id:"sheet.operation.image-reset-size",type:ve.OPERATION,handler:(t,e)=>!0};function Ke(t,e,r,n){const i=n.getDrawingByParam(t);if(i==null)return;const a=A(t),s=r.getObject(a);if(s&&!(s instanceof me))return;if(s!=null){s.addObject(e);return}const o=new me(a);r.addObject(o,je).attachTransformerTo(o),o.addObject(e);const{transform:l}=i;l&&o.transformByState({left:l.left,top:l.top,angle:l.angle})}function ot(t,e){var r;const n=e?t.getUnit(e):t.getFocusedUnit();if(n==null)return;const i=n.getUnitId();let a;return n.type===fe.UNIVER_SHEET?a=(r=n.getActiveSheet())==null?void 0:r.getSheetId():(n.type===fe.UNIVER_DOC||n.type===fe.UNIVER_SLIDE)&&(a=i),{unitId:i,subUnitId:a,current:n}}const Ft="drawing-ui.config",Je={},zt="COMPONENT_IMAGE_POPUP_MENU";function Z({ref:t,...e}){const{icon:r,id:n,className:i,extend:a,...s}=e,o=`univerjs-icon univerjs-icon-${n} ${i||""}`.trim(),l=_.useRef(`_${Kt()}`);return lt(r,`${n}`,{defIds:r.defIds,idSuffix:l.current},{ref:t,className:o,...s},a)}function lt(t,e,r,n,i){return _.createElement(t.tag,{key:e,...Yt(t,r,i),...n},(Xt(t,r).children||[]).map((a,s)=>lt(a,`${e}-${t.tag}-${s}`,r,void 0,i)))}function Yt(t,e,r){const n={...t.attrs};r!=null&&r.colorChannel1&&n.fill==="colorChannel1"&&(n.fill=r.colorChannel1),t.tag==="mask"&&n.id&&(n.id=n.id+e.idSuffix),Object.entries(n).forEach(([a,s])=>{a==="mask"&&typeof s=="string"&&(n[a]=s.replace(/url\(#(.*)\)/,`url(#$1${e.idSuffix})`))});const{defIds:i}=e;return!i||i.length===0||(t.tag==="use"&&n["xlink:href"]&&(n["xlink:href"]=n["xlink:href"]+e.idSuffix),Object.entries(n).forEach(([a,s])=>{typeof s=="string"&&(n[a]=s.replace(/url\(#(.*)\)/,`url(#$1${e.idSuffix})`))})),n}function Xt(t,e){var r;const{defIds:n}=e;return!n||n.length===0?t:t.tag==="defs"&&(r=t.children)!=null&&r.length?{...t,children:t.children.map(i=>typeof i.attrs.id=="string"&&n&&n.includes(i.attrs.id)?{...i,attrs:{...i.attrs,id:i.attrs.id+e.idSuffix}}:i)}:t}function Kt(){return Math.random().toString(36).substring(2,8)}Z.displayName="UniverIcon";const Jt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.0045 4.4334C14.8881 4.4334 15.6045 3.71705 15.6045 2.8334C15.6045 1.94974 14.8881 1.2334 14.0045 1.2334H3.70449C2.82084 1.2334 2.10449 1.94974 2.10449 2.8334C2.10449 3.71705 2.82084 4.4334 3.70449 4.4334H14.0045ZM14.4045 2.8334C14.4045 3.05431 14.2254 3.2334 14.0045 3.2334H3.70449C3.48358 3.2334 3.30449 3.05431 3.30449 2.8334C3.30449 2.61248 3.48358 2.4334 3.70449 2.4334H14.0045C14.2254 2.4334 14.4045 2.61249 14.4045 2.8334Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.1544 8.5999C15.038 8.5999 15.7544 7.88356 15.7544 6.9999C15.7544 6.11625 15.038 5.3999 14.1544 5.3999H3.85439C2.97074 5.3999 2.25439 6.11625 2.25439 6.9999C2.25439 7.88356 2.97074 8.5999 3.85439 8.5999H14.1544ZM14.5544 6.9999C14.5544 7.22082 14.3753 7.3999 14.1544 7.3999H3.85439C3.63348 7.3999 3.45439 7.22082 3.45439 6.9999C3.45439 6.77899 3.63348 6.5999 3.85439 6.5999H14.1544C14.3753 6.5999 14.5544 6.77899 14.5544 6.9999Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.57975 14.5902L6.58023 12.5907C6.34591 12.3564 6.34591 11.9765 6.58023 11.7421C6.81454 11.5078 7.19444 11.5078 7.42876 11.7421L8.40449 12.7179V10.1664C8.40449 9.83504 8.67312 9.56641 9.00449 9.56641C9.33586 9.56641 9.60449 9.83504 9.60449 10.1664V12.7179L10.5802 11.7421C10.8145 11.5078 11.1944 11.5078 11.4288 11.7421C11.6631 11.9765 11.6631 12.3564 11.4288 12.5907L9.42923 14.5902"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.57975 14.5902C8.58121 14.5917 8.58268 14.5931 8.58416 14.5946C8.64077 14.6502 8.70566 14.6923 8.77482 14.7209C8.84557 14.7502 8.92314 14.7664 9.00449 14.7664C9.08585 14.7664 9.16342 14.7502 9.23416 14.7209C9.30332 14.6923 9.36821 14.6502 9.42482 14.5946"}}]},ct=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"bottom-icon",ref:e,icon:Jt}))});ct.displayName="BottomIcon";const Qt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.97705 7.51296C5.97705 7.18159 6.24568 6.91296 6.57705 6.91296H8.48632C8.81769 6.91296 9.08632 7.18159 9.08632 7.51296C9.08632 7.84433 8.81769 8.11296 8.48632 8.11296H6.57705C6.24568 8.11296 5.97705 7.84433 5.97705 7.51296Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6.57705 9.41028C6.24568 9.41028 5.97705 9.67891 5.97705 10.0103C5.97705 10.3416 6.24568 10.6103 6.57705 10.6103H10.8199C11.1512 10.6103 11.4199 10.3416 11.4199 10.0103C11.4199 9.67891 11.1512 9.41028 10.8199 9.41028H6.57705Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M3.51074 2.37063C3.51074 1.48697 4.22709 0.77063 5.11074 0.77063H9.80318L9.81294 0.770708C9.97168 0.768161 10.1311 0.82824 10.2511 0.95055L14.4317 5.21408C14.5165 5.30049 14.5697 5.406 14.5917 5.51645C14.6041 5.5644 14.6106 5.61467 14.6106 5.66648V11.6406C14.6106 12.5243 13.8943 13.2406 13.0106 13.2406H5.11074C4.22709 13.2406 3.51074 12.5243 3.51074 11.6406V2.37063ZM10.4032 4.66648V2.81964L12.6063 5.06648H10.8032C10.5823 5.06648 10.4032 4.88739 10.4032 4.66648ZM5.11074 1.97063C4.88983 1.97063 4.71074 2.14972 4.71074 2.37063V11.6406C4.71074 11.8615 4.88983 12.0406 5.11074 12.0406H13.0106C13.2316 12.0406 13.4106 11.8615 13.4106 11.6406V6.26648H10.8032C9.91953 6.26648 9.20318 5.55013 9.20318 4.66648V1.97063H5.11074Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.58916 6.6741C2.58916 6.34273 2.32053 6.0741 1.98916 6.0741C1.65779 6.0741 1.38916 6.34273 1.38916 6.6741V12.6294C1.38916 14.0653 2.55322 15.2294 3.98916 15.2294H9.41408C9.74545 15.2294 10.0141 14.9607 10.0141 14.6294C10.0141 14.298 9.74545 14.0294 9.41408 14.0294H3.98916C3.21596 14.0294 2.58916 13.4026 2.58916 12.6294V6.6741Z"}}]},dt=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"create-copy-icon",ref:e,icon:Qt}))});dt.displayName="CreateCopyIcon";const qt={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.38125 1.16211C6.49759 1.16211 5.78125 1.87845 5.78125 2.76211V5.6377H2.87783C1.99418 5.6377 1.27783 6.35404 1.27783 7.2377V13.2377C1.27783 14.1214 1.99418 14.8377 2.87783 14.8377H8.87783C9.76149 14.8377 10.4778 14.1214 10.4778 13.2377V10.3621H13.3813C14.2649 10.3621 14.9813 9.64577 14.9813 8.76211V2.76211C14.9813 1.87845 14.2649 1.16211 13.3813 1.16211H7.38125ZM10.4778 9.16211H13.3813C13.6022 9.16211 13.7812 8.98302 13.7812 8.76211V2.76211C13.7812 2.5412 13.6022 2.36211 13.3813 2.36211H7.38125C7.16034 2.36211 6.98125 2.5412 6.98125 2.76211V5.6377H8.87783C9.76149 5.6377 10.4778 6.35404 10.4778 7.2377V9.16211ZM6.98125 6.8377H8.87783C9.09875 6.8377 9.27783 7.01678 9.27783 7.2377V9.16211H7.38125C7.16034 9.16211 6.98125 8.98302 6.98125 8.76211V6.8377ZM5.78125 6.8377V8.76211C5.78125 9.64577 6.49759 10.3621 7.38125 10.3621H9.27783V13.2377C9.27783 13.4586 9.09875 13.6377 8.87783 13.6377H2.87783C2.65692 13.6377 2.47783 13.4586 2.47783 13.2377V7.2377C2.47783 7.01678 2.65692 6.8377 2.87783 6.8377H5.78125Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ut=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"group-icon",ref:e,icon:qt}))});ut.displayName="GroupIcon";const er={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},gt=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"more-down-icon",ref:e,icon:er}))});gt.displayName="MoreDownIcon";const tr={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.25 2.96401C1.25 3.84767 1.96634 4.56401 2.85 4.56401H13.15C14.0337 4.56401 14.75 3.84767 14.75 2.96401C14.75 2.08036 14.0337 1.36401 13.15 1.36401H2.85C1.96635 1.36401 1.25 2.08036 1.25 2.96401ZM2.85 3.36401C2.62909 3.36401 2.45 3.18493 2.45 2.96401C2.45 2.7431 2.62909 2.56401 2.85 2.56401H13.15C13.3709 2.56401 13.55 2.7431 13.55 2.96401C13.55 3.18493 13.3709 3.36401 13.15 3.36401H2.85Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.57564 11.6118C5.80995 11.3774 6.18985 11.3774 6.42417 11.6118L7.3999 12.5875V6.36951C7.3999 6.03814 7.66853 5.76951 7.9999 5.76951C8.33127 5.76951 8.5999 6.03814 8.5999 6.36951V12.5875L9.57564 11.6118C9.80995 11.3774 10.1899 11.3774 10.4242 11.6118C10.6585 11.8461 10.6585 12.226 10.4242 12.4603L8.4324 14.452C8.32324 14.5655 8.16982 14.6362 7.9999 14.6362C7.82998 14.6362 7.67655 14.5655 7.56739 14.452L5.57564 12.4603C5.34132 12.226 5.34132 11.8461 5.57564 11.6118Z"}}]},ht=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"move-down-icon",ref:e,icon:tr}))});ht.displayName="MoveDownIcon";const rr={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.25 13.036C1.25 12.1523 1.96634 11.436 2.85 11.436H13.15C14.0337 11.436 14.75 12.1523 14.75 13.036C14.75 13.9196 14.0337 14.636 13.15 14.636H2.85C1.96635 14.636 1.25 13.9196 1.25 13.036ZM2.85 12.636C2.62909 12.636 2.45 12.8151 2.45 13.036C2.45 13.2569 2.62909 13.436 2.85 13.436H13.15C13.3709 13.436 13.55 13.2569 13.55 13.036C13.55 12.8151 13.3709 12.636 13.15 12.636H2.85Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.57564 4.38825C5.80995 4.62256 6.18985 4.62256 6.42417 4.38825L7.3999 3.41251V9.63049C7.3999 9.96186 7.66853 10.2305 7.9999 10.2305C8.33127 10.2305 8.5999 9.96186 8.5999 9.63049V3.41251L9.57564 4.38825C9.80995 4.62256 10.1899 4.62256 10.4242 4.38825C10.6585 4.15393 10.6585 3.77403 10.4242 3.53972L8.4324 1.54796C8.32324 1.43445 8.16982 1.36382 7.9999 1.36382C7.82998 1.36382 7.67655 1.43446 7.56739 1.54797L5.57564 3.53972C5.34132 3.77403 5.34132 4.15393 5.57564 4.38825Z"}}]},ft=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"move-up-icon",ref:e,icon:rr}))});ft.displayName="MoveUpIcon";const nr={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.82994 1.40913C7.88746 1.35161 7.95376 1.30821 8.02453 1.27893C8.09527 1.24959 8.17285 1.2334 8.2542 1.2334C8.33555 1.2334 8.41313 1.24959 8.48387 1.27893C8.55464 1.30821 8.62094 1.35161 8.67846 1.40913L10.6785 3.40913C10.9128 3.64345 10.9128 4.02335 10.6785 4.25766C10.4441 4.49198 10.0642 4.49198 9.82994 4.25766L8.8542 3.28193V5.8334C8.8542 6.16477 8.58557 6.4334 8.2542 6.4334C7.92283 6.4334 7.6542 6.16477 7.6542 5.8334V3.28193L6.67846 4.25766C6.44415 4.49198 6.06425 4.49198 5.82994 4.25766C5.59562 4.02335 5.59562 3.64345 5.82994 3.40913L7.82994 1.40913Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.50439 9C1.50439 8.11634 2.22074 7.4 3.10439 7.4H13.4044C14.288 7.4 15.0044 8.11634 15.0044 9C15.0044 9.88366 14.2881 10.6 13.4044 10.6H3.1044C2.22074 10.6 1.50439 9.88366 1.50439 9ZM3.10439 8.6C2.88348 8.6 2.70439 8.77909 2.70439 9C2.70439 9.22091 2.88348 9.4 3.1044 9.4H13.4044C13.6253 9.4 13.8044 9.22091 13.8044 9C13.8044 8.77909 13.6253 8.6 13.4044 8.6H3.10439Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.6543 13.1665C1.6543 12.2828 2.37064 11.5665 3.2543 11.5665H13.5543C14.438 11.5665 15.1543 12.2828 15.1543 13.1665C15.1543 14.0502 14.438 14.7665 13.5543 14.7665H3.2543C2.37064 14.7665 1.6543 14.0502 1.6543 13.1665ZM3.2543 12.7665C3.03338 12.7665 2.8543 12.9456 2.8543 13.1665C2.8543 13.3874 3.03338 13.5665 3.2543 13.5665H13.5543C13.7752 13.5665 13.9543 13.3874 13.9543 13.1665C13.9543 12.9456 13.7752 12.7665 13.5543 12.7665H3.2543Z",fillRule:"evenodd",clipRule:"evenodd"}}]},pt=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"topmost-icon",ref:e,icon:nr}))});pt.displayName="TopmostIcon";const ir={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.46855 2.83731C7.46855 2.61639 7.64764 2.4373 7.86855 2.4373H13.8603C14.0812 2.4373 14.2603 2.61639 14.2603 2.8373V9.5049C14.2603 9.72581 14.0812 9.90489 13.8603 9.90489H12.866C12.5346 9.90489 12.266 10.1735 12.266 10.5049C12.266 10.8363 12.5346 11.1049 12.866 11.1049H13.8603C14.7439 11.1049 15.4603 10.3886 15.4603 9.5049V2.8373C15.4603 1.95365 14.7439 1.2373 13.8603 1.2373H7.86855C6.9849 1.2373 6.26855 1.95365 6.26855 2.83731V3.48688C6.26855 3.81825 6.53718 4.08688 6.86855 4.08688C7.19993 4.08688 7.46855 3.81825 7.46855 3.48688V2.83731Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M3.19888 5.56299C2.31522 5.56299 1.59888 6.27933 1.59888 7.16299V13.163C1.59888 14.0466 2.31522 14.763 3.19888 14.763H9.19888C10.0825 14.763 10.7989 14.0466 10.7989 13.163V7.16299C10.7989 6.27933 10.0825 5.56299 9.19888 5.56299H3.19888ZM2.79888 7.16299C2.79888 6.94207 2.97796 6.76299 3.19888 6.76299H9.19888C9.41979 6.76299 9.59888 6.94207 9.59888 7.16299V13.163C9.59888 13.3839 9.41979 13.563 9.19888 13.563H3.19888C2.97796 13.563 2.79888 13.3839 2.79888 13.163V7.16299Z",fillRule:"evenodd",clipRule:"evenodd"}}]},mt=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"ungroup-icon",ref:e,icon:ir}))});mt.displayName="UngroupIcon";const ar={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",fillRule:"evenodd",clipRule:"evenodd"}}]},vt=_.forwardRef(function(t,e){return _.createElement(Z,Object.assign({},t,{id:"autofill-double-icon",ref:e,icon:ar}))});vt.displayName="AutofillDoubleIcon";function sr(t){var e;const{popup:r}=t,n=(e=r?.extraProps)==null?void 0:e.menuItems;if(!n)return null;const i=B(ae),a=B(J),[s,o]=_.useState(!1),[l,c]=_.useState(!1),d=()=>{c(!0)},u=()=>{c(!1)},f=h=>{o(h)},v=h=>{i.executeCommand(h.commandId,h.commandParams),o(!1)},w=s||l,p=n.filter(h=>!h.disable);return g.jsx("div",{onMouseEnter:d,onMouseLeave:u,children:g.jsx(Lt,{align:"start",items:p.map(h=>({type:"item",children:a.t(h.label),onSelect:()=>v(h)})),open:s,onOpenChange:f,children:g.jsxs("div",{className:Y("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",Vt,{"univer-bg-gray-100 dark:!univer-bg-gray-800":s,"univer-bg-white dark:!univer-bg-gray-900":!s}),children:[g.jsx(vt,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),w&&g.jsx(gt,{className:"dark:!univer-text-white"})]})})})}var or=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},Qe=(t,e)=>(r,n)=>e(r,n,t);let Ee=class extends Be{constructor(t,e){super(),this._componentManager=t,this._commandService=e,this._init()}_initCustomComponents(){const t=this._componentManager;this.disposeWithMe(t.register(zt,sr))}_initCommands(){[We,ie,st,$e,Te].forEach(t=>this.disposeWithMe(this._commandService.registerCommand(t)))}_init(){this._initCommands(),this._initCustomComponents()}};Ee=or([Qe(0,He(Bt)),Qe(1,ae)],Ee);function Pe(t,e){const r=[];return t.forEach(n=>{const{oKey:i,left:a,top:s,height:o,width:l,angle:c}=n,d=e.getDrawingOKey(i);if(d==null)return r.push(null),!0;const{unitId:u,subUnitId:f,drawingId:v,drawingType:w}=d,p={unitId:u,subUnitId:f,drawingId:v,drawingType:w,transform:{left:a,top:s,height:o,width:l,angle:c}};w===z.DRAWING_IMAGE&&(p.srcRect=n.srcRect),r.push(p)}),r}var lr=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},Ie=(t,e)=>(r,n)=>e(r,n,t);let Ue=class extends Be{constructor(t,e,r,n){super(),K(this,"_sceneListenerOnDrawingMap",new WeakSet),this._currentUniverService=t,this._commandService=e,this._renderManagerService=r,this._drawingManagerService=n,this._initialize()}dispose(){super.dispose()}_initialize(){this._recoveryImages(),this._drawingAddListener(),this._drawingRemoveListener(),this._drawingUpdateListener(),this._commandExecutedListener(),this._drawingArrangeListener(),this._drawingGroupListener(),this._drawingRefreshListener(),this._drawingVisibleListener()}_recoveryImages(){const t=this._drawingManagerService.drawingManagerData,e=ot(this._currentUniverService);if(e==null)return;const{unitId:r,subUnitId:n}=e;Object.keys(t).forEach(i=>{Object.keys(t[i]).forEach(a=>{const s=t[i][a].data;s==null||i!==r||a!==n||Object.keys(s).forEach(o=>{s[o]&&this._insertDrawing([{unitId:i,subUnitId:a,drawingId:o}])})})})}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===$e.id){const e=t.params;if(e==null)return;this._drawingAlign(e)}}))}_drawingGroupListener(){this.disposeWithMe(this._drawingManagerService.group$.subscribe(t=>{this._groupDrawings(t)})),this.disposeWithMe(this._drawingManagerService.ungroup$.subscribe(t=>{this._ungroupDrawings(t)}))}_getSceneAndTransformerByDrawingSearch(t){if(t==null)return;const e=this._renderManagerService.getRenderById(t),r=e?.scene;if(r==null)return null;const n=r.getTransformerByCreate();return{scene:r,transformer:n}}_groupDrawings(t){t.forEach(e=>{this._groupDrawing(e)})}_groupDrawing(t){const{parent:e,children:r}=t,{unitId:n,subUnitId:i,drawingId:a}=e,s=this._getSceneAndTransformerByDrawingSearch(e.unitId);if(s==null)return;const{scene:o,transformer:l}=s;this._commandService.syncExecuteCommand(ie.id);const c=[];if(r.forEach(f=>{const v=A(f),w=o.getObjectIncludeInGroup(v);if(w==null||c.includes(w))return;c.push(w);const{transform:p}=f;p!=null&&(w.classType===ze.GROUP?w.transformByState({left:p.left,top:p.top}):w.transformByState(p))}),c.length===0)return;const d=A({unitId:n,subUnitId:i,drawingId:a}),u=new me(d);o.addObject(u,je).attachTransformerTo(u),u.addObjects(...c),e.transform&&u.transformByState({left:e.transform.left,top:e.transform.top}),l.clearSelectedObjects(),l.setSelectedControl(u)}_ungroupDrawings(t){t.forEach(e=>{this._ungroupDrawing(e)})}_ungroupDrawing(t){const{parent:e,children:r}=t,n=this._getSceneAndTransformerByDrawingSearch(e.unitId);if(n==null)return;const{scene:i,transformer:a}=n;r.forEach(d=>{const u=A(d),f=i.getObjectIncludeInGroup(u);if(f==null)return!0;if(f==null)return;const{transform:v}=d;v!=null&&(f.classType===ze.GROUP?f.transformByState({left:v.left,top:v.top}):f.transformByState(v))});const s=A(e),o=i.getObject(s),{width:l,height:c}=o;o.getObjects().forEach(d=>{o.removeSelfObjectAndTransform(d.oKey,l,c)}),o.dispose(),a.clearSelectedObjects()}_drawingAlign(t){const{alignType:e}=t,r=this._drawingManagerService.getFocusDrawings();if(e===j.default)return;const n=[];let i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=0;r.forEach(c=>{const{unitId:d,subUnitId:u,drawingId:f,drawingType:v}=c,w=this._drawingManagerService.getDrawingByParam({unitId:d,subUnitId:u,drawingId:f});if(w==null||w.transform==null)return;n.push({unitId:d,subUnitId:u,drawingId:f,drawingType:v,transform:w.transform});const{left:p=0,top:h=0,width:S=0,height:b=0}=w.transform;i=Math.min(i,p),a=Math.min(a,h),s=Math.max(s,p+S),o=Math.max(o,h+b),l++}),l!==0&&(this._sortDrawingTransform(n,e),this._applyAlignType(n,e,i,a,s,o,l))}_applyAlignType(t,e,r,n,i,a,s){const o=Math.round((i-r)/s*10)/10,l=Math.round((a-n)/s*10)/10,c=[],d=this._getSceneAndTransformerByDrawingSearch(t[0].unitId);if(d==null)return;const{scene:u,transformer:f}=d;t.forEach((v,w)=>{const{unitId:p,subUnitId:h,drawingId:S,transform:b,drawingType:R}=v,{left:x=0,top:T=0,width:C=0,height:M=0}=b;let I=x,y=T;switch(e){case j.left:I=r;break;case j.center:I=r+(i-r)/2-C/2;break;case j.right:I=i-C;break;case j.top:y=n;break;case j.middle:y=n+(a-n)/2-M/2;break;case j.bottom:y=a-M;break;case j.horizon:I=r+o*w;break;case j.vertical:y=n+l*w;break}(I!==x||y!==T)&&c.push({unitId:p,subUnitId:h,drawingId:S,drawingType:R,transform:{left:I,top:y}})}),this._drawingManagerService.featurePluginUpdateNotification(c),f.refreshControls().changeNotification()}_sortDrawingTransform(t,e){t.sort((r,n)=>{const i=r.transform,a=n.transform,{left:s=0,top:o=0,width:l=0,height:c=0}=i,{left:d=0,top:u=0,width:f=0,height:v=0}=a;switch(e){case j.left:return s-d;case j.center:return s+l/2-(d+f/2);case j.right:return s+l-(d+f);case j.top:return o-u;case j.middle:return o+c/2-(u+v/2);case j.bottom:return o+c-(u+v);case j.horizon:return s+l/2-(d+f/2);case j.vertical:return o+c/2-(u+v/2);default:return 0}})}_drawingArrangeListener(){this.disposeWithMe(this._drawingManagerService.order$.subscribe(t=>{this._drawingArrange(t)}))}_drawingArrange(t){const{unitId:e,subUnitId:r,drawingIds:n}=t,i=this._getSceneAndTransformerByDrawingSearch(e);if(i==null)return;const{scene:a}=i;n.forEach(s=>{const o=A({unitId:e,subUnitId:r,drawingId:s}),l=a.fuzzyMathObjects(o,!0);if(l==null||l.length===0)return;const c=this._drawingManagerService.getDrawingOrder(e,r).indexOf(s);for(const d of l)d.setProps({zIndex:c}),d.makeDirty()})}_drawingAddListener(){this.disposeWithMe(this._drawingManagerService.add$.subscribe(t=>{this._insertDrawing(t)}))}_insertDrawing(t){const e=[];t.forEach(r=>{const{unitId:n}=r;if(this._drawingManagerService.getDrawingByParam(r)==null)return;const i=this._getSceneAndTransformerByDrawingSearch(n);if(i==null)return;const{scene:a}=i;e.includes(a)||e.push(a)}),e.forEach(r=>{this._sceneListenerOnDrawingMap.has(r)||(this._addListenerOnDrawing(r),this._sceneListenerOnDrawingMap.add(r))})}_drawingRemoveListener(){this.disposeWithMe(this._drawingManagerService.remove$.subscribe(t=>{t.forEach(e=>{var r;const{unitId:n,subUnitId:i,drawingId:a}=e,s=this._getSceneAndTransformerByDrawingSearch(n);if(s==null)return;const{scene:o}=s,l=A({unitId:n,subUnitId:i,drawingId:a}),c=o.fuzzyMathObjects(l,!0);if(c.length>0){for(const d of c)d.dispose();(r=o.getTransformer())==null||r.clearSelectedObjects()}})}))}_drawingUpdateListener(){this.disposeWithMe(this._drawingManagerService.update$.subscribe(t=>{t.forEach(e=>{var r;const{unitId:n,subUnitId:i,drawingId:a}=e,s=this._drawingManagerService.getDrawingByParam(e);if(s==null)return;const{transform:o,drawingType:l}=s,c=this._getSceneAndTransformerByDrawingSearch(n);if(c==null)return;const{scene:d,transformer:u}=c;if(o==null)return!0;const{left:f=0,top:v=0,width:w=0,height:p=0,angle:h=0,flipX:S=!1,flipY:b=!1,skewX:R=0,skewY:x=0}=o,T=A({unitId:n,subUnitId:i,drawingId:a}),C=d.getObject(T);if(C==null)return!0;C.transformByState({left:f,top:v,width:w,height:p,angle:h,flipX:S,flipY:b,skewX:R,skewY:x}),(r=d.getTransformer())==null||r.debounceRefreshControls()})}))}_drawingRefreshListener(){this.disposeWithMe(this._drawingManagerService.refreshTransform$.subscribe(t=>{t.forEach(e=>{const{unitId:r,subUnitId:n,drawingId:i}=e,a=this._getSceneAndTransformerByDrawingSearch(r);if(a==null)return;const s=this._drawingManagerService.getDrawingByParam(e);if(s==null)return;const{transform:o}=s,{scene:l}=a,c=A({unitId:r,subUnitId:n,drawingId:i}),d=l.getObject(c);if(d==null||o==null)return!0;const{left:u=0,top:f=0,width:v=0,height:w=0,angle:p=0,flipX:h=!1,flipY:S=!1,skewX:b=0,skewY:R=0}=o;d.transformByState({left:u,top:f,width:v,height:w,angle:p,flipX:h,flipY:S,skewX:b,skewY:R})})}))}_drawingVisibleListener(){this.disposeWithMe(this._drawingManagerService.visible$.subscribe(t=>{t.forEach(e=>{const{unitId:r,subUnitId:n,drawingId:i,visible:a}=e,s=this._getSceneAndTransformerByDrawingSearch(r);if(s==null)return;const{scene:o}=s,l=A({unitId:r,subUnitId:n,drawingId:i}),c=o.getObject(l);if(c==null)return!0;a?c.show():c.hide()})}))}_filterUpdateParams(t,e){return t.filter((r,n)=>{if(r==null)return!1;const{transform:i}=r;return rt(i,e?.[n])})}_addListenerOnDrawing(t){const e=t.getTransformerByCreate();let r=null;this.disposeWithMe(pe(e.changeStart$.subscribe(n=>{const{objects:i}=n,a=Array.from(i.values()),s=[];r=a.map(o=>{const{left:l,top:c,height:d,width:u,angle:f,oKey:v,isInGroup:w}=o,p=this._drawingManagerService.getDrawingOKey(v);if(w||o instanceof me){let h=o.ancestorGroup;if(h==null&&o instanceof me&&(h=o),h==null)return null;const S=this._drawingManagerService.getDrawingOKey(h.oKey);if(S){const{unitId:b,subUnitId:R,drawingId:x}=S;s.push({unitId:b,subUnitId:R,drawingId:x});const{left:T,top:C,height:M,width:I,angle:y}=h;return{left:T,top:C,height:M,width:I,angle:y}}}else if(p!=null){const{unitId:h,subUnitId:S,drawingId:b}=p;return s.push({unitId:h,subUnitId:S,drawingId:b}),{left:l,top:c,height:d,width:u,angle:f}}return null}).filter(o=>o!=null),s.length>0?this._commandService.syncExecuteCommand(Me.id,s):this._commandService.syncExecuteCommand(Me.id,[])}))),this.disposeWithMe(pe(e.changeEnd$.subscribe(n=>{const{objects:i}=n,a=this._filterUpdateParams(Pe(i,this._drawingManagerService),r);a.length>0&&this._drawingManagerService.featurePluginUpdateNotification(a)})))}};Ue=lr([Ie(0,Ae),Ie(1,ae),Ie(2,le),Ie(3,Q)],Ue);class be extends Et{constructor(e,r){r==null&&(r={}),r.transformerConfig={keepRatio:!1,isCropper:!0,anchorFill:"rgb(0, 0, 0)",anchorStroke:"rgb(255, 255, 255)",anchorSize:24},super(e,r),K(this,"_srcRect"),K(this,"_prstGeom"),K(this,"_applyTransform"),K(this,"_dragPadding",8),K(this,"_cacheCanvas"),r!=null&&r.srcRect&&(this._srcRect=r.srcRect),r!=null&&r.prstGeom&&(this._prstGeom=r.prstGeom),r!=null&&r.applyTransform&&(this._applyTransform=r.applyTransform),r!=null&&r.dragPadding&&(this._dragPadding=r.dragPadding),this._applyProps()}refreshSrcRect(e,r){this._srcRect=e,this._applyTransform=r,this._applyProps()}get srcRect(){return this._srcRect}dispose(){var e;super.dispose(),(e=this._cacheCanvas)==null||e.dispose(),this._srcRect=null}isHit(e){const r=this.getInverseCoord(e);return r.x>=-this.strokeWidth/2&&r.x<=this.width+this.strokeWidth/2&&r.y>=-this.strokeWidth/2&&r.y<=this.height+this.strokeWidth/2&&!this._inSurround(r)}_inSurround(e){const r=this._dragPadding;return e.x>=r-this.strokeWidth/2&&e.x<=this.width+this.strokeWidth/2-r&&e.y>=r-this.strokeWidth/2&&e.y<=this.height+this.strokeWidth/2-r}render(e,r){return this.visible?(e.save(),this._draw(e),e.restore(),this.makeDirty(!1),this):(this.makeDirty(!1),this)}_draw(e){var r,n;const i=this.getScene().getEngine(),{width:a,height:s}=i;this._initialCacheCanvas(),(r=this._cacheCanvas)==null||r.clear();const o=(n=this._cacheCanvas)==null?void 0:n.getContext();o!=null&&(o.save(),it.drawWith(o,{left:0,top:0,width:a,height:s,fill:"rgba(0, 0, 0, 0.5)"}),o.setTransform(e.getTransform()),this._clipForApplyObject(o),this._applyCache(e),o.restore())}_clipForApplyObject(e){let r=0;if(this._prstGeom!=null&&(r=1),e.globalCompositeOperation="destination-out",e.beginPath(),r===0){const n=this.transform.getMatrix();e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.rect(0,0,this.width,this.height),e.fill()}}_applyProps(){if(this._applyTransform==null)return;let e=0,r=0,n=0,i=0;const{left:a=0,top:s=0,width:o=0,height:l=0,angle:c}=this._applyTransform;if(this._srcRect!=null){const{left:f=0,top:v=0,right:w=0,bottom:p=0}=this._srcRect;e=f,r=v,n=w,i=p}const d=a+e,u=s+r;this.transformByState({left:d,top:u,width:a+o-n-d,height:s+l-i-u,angle:c})}_applyCache(e){if(!e||this._cacheCanvas==null)return;const r=this._cacheCanvas.getContext();r.save(),e.save(),e.setTransform(1,0,0,1,0,0),r.setTransform(1,0,0,1,0,0),e.drawImage(this._cacheCanvas.getCanvasEle(),0,0),e.restore(),r.restore()}_initialCacheCanvas(){if(this._cacheCanvas!=null)return;const e=this.getScene();if(e==null)return;this._cacheCanvas=new Ut;const r=e.getEngine();this._cacheCanvas.setSize(r.width,r.height),r.onTransformChange$.subscribeEvent(()=>{var n;(n=this._cacheCanvas)==null||n.setSize(r.width,r.height),this.makeDirty(!0)})}}var cr=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},oe=(t,e)=>(r,n)=>e(r,n,t);let De=class extends Be{constructor(t,e,r,n,i,a){super(),K(this,"_sceneListenerOnImageMap",new WeakSet),this._commandService=t,this._drawingManagerService=e,this._renderManagerService=r,this._univerInstanceService=n,this._messageService=i,this._localeService=a,this._init()}_init(){this._initOpenCrop(),this._initCloseCrop(),this._initAutoCrop()}_initAutoCrop(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id!==Te.id)return;const e=t.params;if(e==null)return;const{cropType:r}=e,n=this._drawingManagerService.getFocusDrawings();if(n.length!==1)return;const i=n[0],{unitId:a,subUnitId:s,drawingId:o}=i,l=this._renderManagerService.getRenderById(a),c=l?.scene;if(c==null)return!0;this._searchCropObject(c)!=null&&this._commandService.syncExecuteCommand(ie.id,{isAuto:!0});const d=A({unitId:a,subUnitId:s,drawingId:o}),u=c.getObject(d);if(!(u instanceof Ge)){this._messageService.show({type:Xe.Error,content:this._localeService.t("image-cropper.error")});return}u!=null&&(this._updateCropperObject(r,u),this._commandService.executeCommand(We.id,{unitId:a,subUnitId:s,drawingId:o}))}))}_calculateSrcRectByRatio(t,e,r,n,i,a){const s=r/n,o=i/a;let l=r,c=n;s>o?l=n*o:c=r/o;const d=(r-l)/2,u=(n-c)/2;return{left:Ce(d,1),top:Ce(u,1),right:Ce(r-(d+l),1),bottom:Ce(n-(u+c),1)}}_updateCropperObject(t,e){const{left:r,top:n,width:i,height:a}=e.calculateTransformWithSrcRect();let s;switch(t){case D.R1_1:s=this._calculateSrcRectByRatio(r,n,i,a,1,1);break;case D.R16_9:s=this._calculateSrcRectByRatio(r,n,i,a,16,9);break;case D.R9_16:s=this._calculateSrcRectByRatio(r,n,i,a,9,16);break;case D.R5_4:s=this._calculateSrcRectByRatio(r,n,i,a,5,4);break;case D.R4_5:s=this._calculateSrcRectByRatio(r,n,i,a,4,5);break;case D.R4_3:s=this._calculateSrcRectByRatio(r,n,i,a,4,3);break;case D.R3_4:s=this._calculateSrcRectByRatio(r,n,i,a,3,4);break;case D.R3_2:s=this._calculateSrcRectByRatio(r,n,i,a,3,2);break;case D.R2_3:s=this._calculateSrcRectByRatio(r,n,i,a,2,3);break;case D.FREE:}if(s==null)return;e.setSrcRect(s);const{left:o=0,top:l=0,bottom:c=0,right:d=0}=s;e.transformByStateCloseCropper({left:r+o,top:n+l,width:i-d-o,height:a-c-l})}_initOpenCrop(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id!==We.id)return;const e=t.params;if(e==null)return;const{unitId:r,subUnitId:n,drawingId:i}=e,a=this._renderManagerService.getRenderById(r),s=a?.scene;if(s==null)return!0;if(this._sceneListenerOnImageMap.has(s)||(this._addListenerOnImage(s),this._sceneListenerOnImageMap.add(s)),this._drawingManagerService.getDrawingByParam({unitId:r,subUnitId:n,drawingId:i})==null)return;const o=A({unitId:r,subUnitId:n,drawingId:i}),l=s.getObject(o);if(l==null)return;if(!(l instanceof Ge)){this._messageService.show({type:Xe.Error,content:this._localeService.t("image-cropper.error")});return}const c=s.getTransformer();c?.clearControls();const d=new be(`${o}-crop`,{srcRect:l.srcRect,prstGeom:l.prstGeom,applyTransform:l.calculateTransformWithSrcRect()});s.addObject(d,l.getLayerIndex()+1).attachTransformerTo(d),c?.createControlForCopper(d),this._addHoverForImageCopper(d),l.openRenderByCropper(),c?.refreshControls(),d.makeDirty(!0),this._commandService.syncExecuteCommand(Me.id,[{unitId:r,subUnitId:n,drawingId:i}])}))}_searchCropObject(t){const e=t.getAllObjectsByOrder();for(const r of e)if(r instanceof be)return r}_initCloseCrop(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id!==ie.id)return;const r=this._univerInstanceService.getFocusedUnit();if(r==null)return;const n=r.getUnitId(),i=this._renderManagerService.getRenderById(n),a=i?.scene;if(a==null)return!0;const s=this._searchCropObject(a);if(s==null)return;const o=this._getApplyObjectByCropObject(s);if(o==null)return;const l=a.getTransformerByCreate();l.detachFrom(s),l.clearCopperControl();const c=this._getSrcRectByTransformState(o,s),d=this._drawingManagerService.getDrawingOKey(o.oKey);if(d!=null){const{left:u,top:f,height:v,width:w}=s;this._drawingManagerService.featurePluginUpdateNotification([{...d,transform:{...d.transform,left:u,top:f,height:v,width:w},srcRect:c.srcRectAngle}])}o.setSrcRect({...c.srcRectAngle}),o.closeRenderByCropper(),o.makeDirty(!0),s?.dispose()}));const t=this._univerInstanceService.getCurrentTypeOfUnit$(fe.UNIVER_SHEET).pipe(kt(e=>e?e.activeSheet$:Mt(null)));this.disposeWithMe(t.subscribe(()=>{this._commandService.syncExecuteCommand(ie.id)}))}_getApplyObjectByCropObject(t){const e=t.oKey,r=e.slice(0,e.length-5),n=t.getScene();if(!n)return null;const i=n.getObject(r);return i??null}_addListenerOnImage(t){const e=t.getTransformerByCreate();let r=null;this.disposeWithMe(e.changeStart$.subscribe(n=>{const{objects:i}=n,a=i.values().next().value;if(a==null||!(a instanceof be))return;const{left:s,top:o,height:l,width:c,angle:d}=a;r={left:s,top:o,height:l,width:c,angle:d},e.clearCopperControl()})),this.disposeWithMe(e.changeEnd$.subscribe(n=>{const{objects:i}=n,a=i.values().next().value;if(a==null||!(a instanceof be))return;const{left:s,top:o,height:l,width:c,angle:d}=a;if(!rt({left:s,top:o,height:l,width:c,angle:d},r))return;const u=this._getApplyObjectByCropObject(a);if(u==null)return;const f=this._getSrcRectByTransformState(u,a);a.refreshSrcRect(f.srcRect,u.getState()),e.createControlForCopper(a)})),this._endCropListener(t)}_addHoverForImageCopper(t){this.disposeWithMe(t.onPointerEnter$.subscribeEvent(()=>{t.cursor=Oe.MOVE})),this.disposeWithMe(t.onPointerLeave$.subscribeEvent(()=>{t.cursor=Oe.DEFAULT}))}_endCropListener(t){const e=t.getTransformerByCreate();this.disposeWithMe(e.clearControl$.subscribe(r=>{r===!0&&this._commandService.syncExecuteCommand(ie.id)}))}_getSrcRectByTransformState(t,e){const{left:r,top:n,height:i,width:a,strokeWidth:s,angle:o}=e,{left:l,top:c,width:d,height:u,angle:f,strokeWidth:v}=t,w=r-l,p=n-c,h={left:w,top:p,right:d-w-a,bottom:u-p-i},S={...h};if(f!==0){const b=r+a/2,R=n+i/2,x=new Le(b,R),T=d/2+l,C=u/2+c,M=new Le(T,C),I=new Le(l,c);I.rotateByPoint(Ye(f),M);const y=I.clone();y.rotateByPoint(Ye(-f),x);const E=r-y.x,N=n-y.y;S.left=E,S.top=N,S.right=d-E-a,S.bottom=u-N-i}return{srcRect:h,srcRectAngle:S}}};De=cr([oe(0,ae),oe(1,Q),oe(2,le),oe(3,Ae),oe(4,Ht),oe(5,He(J))],De);var dr=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},he=(t,e)=>(r,n)=>e(r,n,t);let Ne=class{constructor(t,e,r,n,i){this._drawingManagerService=t,this._imageIoService=e,this._galleryService=r,this._urlImageService=n,this._univerInstanceService=i}async renderImages(t,e){const{transform:r,drawingType:n,source:i,imageSourceType:a,srcRect:s,prstGeom:o,groupId:l,unitId:c,subUnitId:d,drawingId:u,isMultiTransform:f,transforms:v}=t;if(n!==z.DRAWING_IMAGE||!this._drawingManagerService.getDrawingVisible()||r==null)return;const w=f&&v?v:[r],p=[];for(const h of w){const{left:S,top:b,width:R,height:x,angle:T,flipX:C,flipY:M,skewX:I,skewY:y}=h,E=w.indexOf(h),N=A({unitId:c,subUnitId:d,drawingId:u},f?E:void 0),U=e.getObject(N);if(U!=null){U.transformByState({left:S,top:b,width:R,height:x,angle:T,flipX:C,flipY:M,skewX:I,skewY:y});continue}if(!this._drawingManagerService.getDrawingVisible()||d!==this._getActiveSheetId())continue;const X=this._drawingManagerService.getDrawingOrder(c,d),q=X.indexOf(u),V={...h,zIndex:q===-1?X.length-1:q},se=this._imageIoService.getImageSourceCache(i,a);let ce=!1;if(se!=null)V.image=se;else if(a===xe.UUID)try{V.url=await this._imageIoService.getImage(i)}catch(ee){console.error(ee);continue}else if(a===xe.URL){try{V.url=await this._urlImageService.getImage(i)}catch(ee){console.error(ee),V.url=i}ce=!0}else V.url=i,ce=!0;if(e.getObject(N))continue;V.printable=!0;const L=new Ge(N,V);ce&&this._imageIoService.addImageSourceCache(i,a,L.getNative()),e.addObject(L,je),this._drawingManagerService.getDrawingEditable()&&e.attachTransformerTo(L),l&&Ke({drawingId:l,unitId:c,subUnitId:d},L,e,this._drawingManagerService),o!=null&&L.setPrstGeom(o),s!=null&&L.setSrcRect(s),p.push(L)}return p}_getActiveSheetId(){var t,e;return(e=(t=this._univerInstanceService.getCurrentUnitOfType(fe.UNIVER_SHEET))==null?void 0:t.getActiveSheet())==null?void 0:e.getSheetId()}renderFloatDom(t,e){const{transform:r,drawingType:n,groupId:i,unitId:a,subUnitId:s,drawingId:o,isMultiTransform:l,transforms:c}=t;if(n!==z.DRAWING_DOM||!this._drawingManagerService.getDrawingVisible()||r==null)return;const d=l&&c?c:[r],u=[];for(const f of d){const{left:v,top:w,width:p,height:h,angle:S,flipX:b,flipY:R,skewX:x,skewY:T}=f,C=d.indexOf(f),M=A({unitId:a,subUnitId:s,drawingId:o},l?C:void 0),I=e.getObject(M);if(I!=null){I.transformByState({left:v,top:w,width:p,height:h,angle:S,flipX:b,flipY:R,skewX:x,skewY:T});continue}const y=this._drawingManagerService.getDrawingOrder(a,s),E=y.indexOf(o),N={...f,zIndex:E===-1?y.length-1:E};if(e.getObject(M))continue;N.printable=!1;const U=new it(M,N);this._drawingManagerService.getDrawingVisible()&&(e.addObject(U,je),this._drawingManagerService.getDrawingEditable()&&t.allowTransform!==!1&&e.attachTransformerTo(U),i&&Ke({drawingId:i,unitId:a,subUnitId:s},U,e,this._drawingManagerService),u.push(U))}return u}renderDrawing(t,e){const r=this._drawingManagerService.getDrawingByParam(t);if(r!=null&&r.drawingType===z.DRAWING_IMAGE)return this.renderImages(r,e)}previewImage(t,e,r,n){this._galleryService.open({images:[e],onOpenChange:i=>{i||this._galleryService.close()}})}_adjustImageSize(t,e,r,n){if(t<=r&&e<=n)return{width:t,height:e};const i=r/t,a=n/e,s=Math.min(i,a);return{width:Math.floor(t*s),height:Math.floor(e*s)}}};Ne=dr([he(0,Q),he(1,nt),he(2,At),he(3,jt),he(4,Ae)],Ne);var ur=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},re=(t,e)=>(r,n)=>e(r,n,t);let ke=class extends Be{constructor(t,e,r,n,i,a,s){super(),this._commandService=t,this._renderManagerService=e,this._drawingManagerService=r,this._dialogService=n,this._imageIoService=i,this._currentUniverService=a,this._drawingRenderService=s,this._initialize()}dispose(){super.dispose()}_initialize(){this._drawingAddListener(),this._commandExecutedListener(),this._imageUpdateListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===st.id){const e=t.params;if(e==null)return;this._resetImageSize(e)}}))}_getSceneAndTransformerByDrawingSearch(t){if(t==null)return;const e=this._renderManagerService.getRenderById(t),r=e?.scene;if(r==null)return null;const n=r.getTransformerByCreate();return{scene:r,transformer:n}}_resetImageSize(t){const e=[],r=[];t.forEach(n=>{const{unitId:i,subUnitId:a,drawingId:s}=n,o=this._getSceneAndTransformerByDrawingSearch(i);if(o==null)return;const{scene:l}=o,c=A({unitId:i,subUnitId:a,drawingId:s}),d=l.getObject(c);if(d==null)return!0;const u=this._drawingManagerService.getDrawingByParam(n);if(u==null)return!0;if(u.drawingType!==z.DRAWING_IMAGE)return;d.resetSize();const{width:f,height:v}=d.getNativeSize();r.includes(l)===!1&&r.push(l),e.push({...u,transform:{...u.transform,height:v,width:f,angle:0},srcRect:null,prstGeom:null})}),this._drawingManagerService.featurePluginUpdateNotification(e),r.forEach(n=>{n.getTransformerByCreate().refreshControls().changeNotification()}),this._commandService.syncExecuteCommand(Me.id,t)}_drawingAddListener(){this.disposeWithMe(this._drawingManagerService.add$.pipe(Wt(33),Ze(t=>t.length>0),Fe(t=>t.flat()),Fe(t=>{const e=new Map;for(const r of t)e.set(`${r.unitId}|${r.subUnitId}|${r.drawingId}`,r);return[...e.values()]}),Ze(t=>t.length>0)).subscribe(t=>{this._insertImages(t)}))}_insertImages(t){t.forEach(async e=>{var r;const{unitId:n,subUnitId:i}=e,a=this._getSceneAndTransformerByDrawingSearch(n),s=(r=ot(this._currentUniverService,n))==null?void 0:r.subUnitId;if(a==null||s!==i)return;const o=this._drawingManagerService.getDrawingByParam(e);if(o==null)return;const l=await this._drawingRenderService.renderImages(o,a.scene);if(this._drawingManagerService.refreshTransform([o]),!(l==null||l.length===0))for(const c of l)this._addHoverForImage(c),this._addDialogForImage(c)})}_imageUpdateListener(){this.disposeWithMe(this._drawingManagerService.update$.subscribe(t=>{t.forEach(e=>{const{unitId:r,subUnitId:n,drawingId:i}=e,a=this._drawingManagerService.getDrawingByParam(e);if(a==null)return;const{transform:s,drawingType:o,srcRect:l,prstGeom:c,source:d,imageSourceType:u}=a;if(o!==z.DRAWING_IMAGE)return;const f=this._getSceneAndTransformerByDrawingSearch(r);if(f==null)return;const{scene:v,transformer:w}=f;if(s==null)return!0;const p=A({unitId:r,subUnitId:n,drawingId:i}),h=v.getObject(p);if(h==null)return!0;h.setSrcRect(l),h.setPrstGeom(c),d!=null&&d.length>0&&(u===xe.BASE64||u===xe.URL)&&h.changeSource(d)})}))}_addHoverForImage(t){this.disposeWithMe(pe(t.onPointerEnter$.subscribeEvent(()=>{t.cursor=Oe.GRAB}))),this.disposeWithMe(pe(t.onPointerLeave$.subscribeEvent(()=>{t.cursor=Oe.DEFAULT})))}_addDialogForImage(t){this.disposeWithMe(pe(t.onDblclick$.subscribeEvent(()=>{const e=`${t.oKey}-viewer-dialog`;this._drawingRenderService.previewImage(e,t.getNative().src,t.getNativeSize().width,t.getNativeSize().height)})))}};ke=ur([re(0,ae),re(1,le),re(2,Q),re(3,Pt),re(4,nt),re(5,Ae),re(6,He(Ne))],ke);var gr=(t,e,r,n)=>{for(var i=e,a=t.length-1,s;a>=0;a--)(s=t[a])&&(i=s(i)||i);return i},qe=(t,e)=>(r,n)=>e(r,n,t);const hr="UNIVER_DRAWING_UI_PLUGIN";var Ve;let et=(Ve=class extends yt{constructor(t=Je,e,r){super(),this._config=t,this._injector=e,this._configService=r;const{menu:n,...i}=Rt({},Je,this._config);n&&this._configService.setConfig("menu",n,{merge:!0}),this._configService.setConfig(Ft,i)}onStarting(){this._initDependencies()}onRendered(){this._injector.get(Ue),this._injector.get(Ee),this._injector.get(De),this._injector.get(ke)}_initDependencies(){[[Ne],[Ue],[Ee],[De],[ke]].forEach(t=>this._injector.add(t))}},K(Ve,"pluginName",hr),Ve);et=gr([qe(1,He(Ot)),qe(2,Tt)],et);const fr=t=>{const e=B(ae),r=B(J),{alignShow:n}=t,[i,a]=_.useState(j.default),s=[{label:r.t("image-panel.align.default"),value:j.default},{options:[{label:r.t("image-panel.align.left"),value:j.left},{label:r.t("image-panel.align.center"),value:j.center},{label:r.t("image-panel.align.right"),value:j.right}]},{options:[{label:r.t("image-panel.align.top"),value:j.top},{label:r.t("image-panel.align.middle"),value:j.middle},{label:r.t("image-panel.align.bottom"),value:j.bottom}]},{options:[{label:r.t("image-panel.align.horizon"),value:j.horizon},{label:r.t("image-panel.align.vertical"),value:j.vertical}]}];function o(l){a(l),e.executeCommand($e.id,{alignType:l})}return g.jsxs("div",{className:Y("univer-relative univer-w-full",{"univer-hidden":!n}),children:[g.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:g.jsx("div",{children:r.t("image-panel.align.title")})}),g.jsx("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:g.jsx("div",{className:"univer-w-full univer-text-gray-900 dark:!univer-text-white",children:g.jsx(at,{value:i,options:s,onChange:o})})})]})},pr=t=>{const{arrangeShow:e,drawings:r}=t,n=B(J),i=B(Q),[a,s]=_.useState(r);_.useEffect(()=>{const l=i.focus$.subscribe(c=>{s(c)});return()=>{l.unsubscribe()}},[]);const o=l=>{const c=a[0].unitId,d=a[0].subUnitId,u=a.map(f=>f.drawingId);i.featurePluginOrderUpdateNotification({unitId:c,subUnitId:d,drawingIds:u,arrangeType:l})};return g.jsxs("div",{className:Y("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!e}),children:[g.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:g.jsx("div",{children:n.t("image-panel.arrange.title")})}),g.jsxs("div",{className:"univer-grid univer-grid-cols-2 univer-gap-2",children:[g.jsxs(ne,{onClick:()=>{o(we.forward)},children:[g.jsx(ft,{}),n.t("image-panel.arrange.forward")]}),g.jsxs(ne,{onClick:()=>{o(we.backward)},children:[g.jsx(ht,{}),n.t("image-panel.arrange.backward")]}),g.jsxs(ne,{onClick:()=>{o(we.front)},children:[g.jsx(pt,{}),n.t("image-panel.arrange.front")]}),g.jsxs(ne,{onClick:()=>{o(we.back)},children:[g.jsx(ct,{}),n.t("image-panel.arrange.back")]})]})]})},mr=t=>{const e=B(J),r=B(le),n=B(Q),{hasGroup:i,drawings:a}=t,[s,o]=_.useState(!1),[l,c]=_.useState(!0),[d,u]=_.useState(!0),f=()=>{const p=n.getFocusDrawings(),{unitId:h,subUnitId:S}=p[0],b=xt(10),R=Dt(0,0,p.map(C=>C.transform||{})),x={unitId:h,subUnitId:S,drawingId:b,drawingType:z.DRAWING_GROUP,transform:R},T=p.map(C=>{const M=C.transform||{left:0,top:0},{unitId:I,subUnitId:y,drawingId:E}=C;return{unitId:I,subUnitId:y,drawingId:E,transform:{...M,left:M.left-R.left,top:M.top-R.top},groupId:b}});n.featurePluginGroupUpdateNotification([{parent:x,children:T}])},v=p=>{if(p.drawingType!==z.DRAWING_GROUP)return;const{unitId:h,subUnitId:S,drawingId:b,transform:R={width:0,height:0}}=p;if(R==null)return;const x=n.getDrawingsByGroup({unitId:h,subUnitId:S,drawingId:b});if(x.length===0)return;const T=x.map(C=>{const{transform:M}=C,{unitId:I,subUnitId:y,drawingId:E}=C,N=Nt(M||{},R,R.width||0,R.height||0);return{unitId:I,subUnitId:y,drawingId:E,transform:{...M,...N},groupId:void 0}});return{parent:p,children:T}},w=()=>{const p=n.getFocusDrawings().map(h=>v(h)).filter(h=>h!=null);p.length!==0&&n.featurePluginUngroupUpdateNotification(p)};return _.useEffect(()=>{const p=a[0];if(p==null)return;const{unitId:h}=p,S=r.getRenderById(h),b=S?.scene;if(b==null)return;const R=b.getTransformerByCreate(),x=R.clearControl$.subscribe(C=>{C===!0&&o(!1)}),T=R.changeStart$.subscribe(C=>{const{objects:M}=C,I=Pe(M,n),y=I.filter(U=>U?.drawingType===z.DRAWING_GROUP);let E=!1,N=!1;I.length>1&&(E=!0),y.length>0&&(N=!0),o(E||N),c(E),u(N)});return()=>{T.unsubscribe(),x.unsubscribe()}},[]),g.jsxs("div",{className:Y("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":i===!0&&s===!1||i===!1}),children:[g.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:g.jsx("div",{children:e.t("image-panel.group.title")})}),g.jsxs("div",{className:"univer-flex univer-items-center univer-justify-center univer-gap-2",children:[g.jsxs(ne,{className:Y({"univer-hidden":!l}),onClick:f,children:[g.jsx(ut,{}),e.t("image-panel.group.group")]}),g.jsxs(ne,{className:Y({"univer-hidden":!d}),onClick:w,children:[g.jsx(mt,{}),e.t("image-panel.group.unGroup")]})]})]})},Se=20,ye=20,tt=[-360,360],Re=300,vr=t=>{var e;const r=B(J),n=B(Q),i=B(le),{drawings:a,transformShow:s}=t,o=a[0];if(o==null)return;const l=o.transform;if(l==null)return;const{unitId:c,subUnitId:d,drawingId:u,drawingType:f}=o,v=i.getRenderById(c),w=v?.scene;if(w==null)return;const p=(e=w.getEngine())==null?void 0:e.activeScene;if(p==null)return;const h=w.getTransformerByCreate(),{width:S=0,height:b=0,left:R=0,top:x=0,angle:T=0}=l,[C,M]=_.useState(S),[I,y]=_.useState(b),[E,N]=_.useState(R),[U,X]=_.useState(x),[q,V]=_.useState(T),[se,ce]=_.useState(h.keepRatio),L=(m,O,H,P)=>{const{width:k,height:F}=p,{ancestorLeft:G,ancestorTop:W}=w;let $=m,te=O,de=H,ue=P;return m+G<0&&($=-G),O+W<0&&(te=-W),de=k-$-G,de<Se&&(de=Se),ue=F-te-W,ue<ye&&(ue=ye),m+de+G>k&&($=k-H-G),O+ue+W>F&&(te=F-P-W),{limitLeft:$,limitTop:te,limitWidth:de,limitHeight:ue}},ee=m=>{const{objects:O}=m,H=Pe(O,n);if(H.length!==1)return;const P=H[0];if(P==null)return;const{transform:k}=P;if(k==null)return;const{width:F,height:G,left:W,top:$,angle:te}=k;F!=null&&M(F),G!=null&&y(G),W!=null&&N(W),$!=null&&X($),te!=null&&V(te)};_.useEffect(()=>{const m=[h.changeStart$.subscribe(O=>{ee(O)}),h.changing$.subscribe(O=>{ee(O)}),h.changeEnd$.subscribe(O=>{ee(O)}),n.focus$.subscribe(O=>{if(O.length!==1)return;const H=n.getDrawingByParam(O[0]);if(H==null)return;const P=H.transform;if(P==null)return;const{width:k,height:F,left:G,top:W,angle:$}=P;k!=null&&M(k),F!=null&&y(F),G!=null&&N(G),W!=null&&X(W),$!=null&&V($)})];return()=>{m.forEach(O=>O.unsubscribe())}},[]);const wt=_e(m=>{if(m==null)return;const{limitWidth:O,limitHeight:H}=L(E,U,m,I);m=Math.min(m,O);const P={unitId:c,subUnitId:d,drawingId:u,drawingType:f,transform:{width:m}};if(se){let k=m/C*I;if(k=Math.max(k,ye),k>H)return;y(k),P.transform.height=k}M(m),n.featurePluginUpdateNotification([P]),h.refreshControls().changeNotification()},Re),_t=_e(m=>{if(m==null)return;const{limitHeight:O,limitWidth:H}=L(E,U,C,m);m=Math.min(m,O);const P={unitId:c,subUnitId:d,drawingId:u,drawingType:f,transform:{height:m}};if(se){let k=m/I*C;if(k=Math.max(k,Se),k>H)return;M(k),P.transform.width=k}y(m),n.featurePluginUpdateNotification([P]),h.refreshControls().changeNotification()},Re),Ct=_e(m=>{if(m==null)return;const{limitLeft:O}=L(m,U,C,I);m=O;const H={unitId:c,subUnitId:d,drawingId:u,drawingType:f,transform:{left:m}};N(m),n.featurePluginUpdateNotification([H]),h.refreshControls().changeNotification()},Re),It=_e(m=>{if(m==null)return;const{limitTop:O}=L(E,m,C,I);m=O;const H={unitId:c,subUnitId:d,drawingId:u,drawingType:f,transform:{top:m}};X(m),n.featurePluginUpdateNotification([H]),h.refreshControls().changeNotification()},Re),bt=m=>{if(m==null)return;const O={unitId:c,subUnitId:d,drawingId:u,drawingType:f,transform:{angle:m}};V(m),n.featurePluginUpdateNotification([O]),h.refreshControls().changeNotification()},St=m=>{ce(m),h.keepRatio=m};return g.jsxs("div",{className:Y("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!s}),children:[g.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:g.jsx("div",{children:r.t("image-panel.transform.title")})}),g.jsxs("div",{className:"univer-grid univer-grid-cols-3 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.width")}),g.jsx(ge,{precision:1,value:C,min:Se,onChange:m=>{wt(m)}})]}),g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.height")}),g.jsx(ge,{precision:1,value:I,min:ye,onChange:m=>{_t(m)}})]}),g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.lock")}),g.jsx("div",{className:"univer-text-center",children:g.jsx(Gt,{checked:se,onChange:St})})]})]}),g.jsxs("div",{className:"univer-grid univer-grid-cols-3 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.x")}),g.jsx(ge,{precision:1,value:E,onChange:m=>{Ct(m)}})]}),g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.y")}),g.jsx(ge,{precision:1,value:U,onChange:m=>{It(m)}})]}),g.jsxs("div",{children:[g.jsx("span",{children:r.t("image-panel.transform.rotate")}),g.jsx(ge,{precision:1,value:q,min:tt[0],max:tt[1],onChange:bt})]})]})]})},wr=t=>{const e=B(ae),r=B(J),{drawings:n,cropperShow:i}=t;if(n[0]==null)return;const[a,s]=_.useState(D.FREE),o=_.useRef(!1),l=[{label:r.t("image-panel.crop.mode"),value:D.FREE},{label:"1:1",value:D.R1_1},{label:"16:9",value:D.R16_9},{label:"9:16",value:D.R9_16},{label:"5:4",value:D.R5_4},{label:"4:5",value:D.R4_5},{label:"4:3",value:D.R4_3},{label:"3:4",value:D.R3_4},{label:"3:2",value:D.R3_2},{label:"2:3",value:D.R2_3}];_.useEffect(()=>{const u=e.onCommandExecuted(f=>{if(f.id===ie.id){const v=f.params;v!=null&&v.isAuto||(o.current=!1)}});return()=>{u?.dispose()}},[]);function c(u){s(u),o.current&&e.executeCommand(Te.id,{cropType:u})}const d=u=>{e.executeCommand(Te.id,{cropType:u}),o.current=!0};return g.jsxs("div",{className:Y("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",{"univer-hidden":!i}),children:[g.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:g.jsx("div",{children:r.t("image-panel.crop.title")})}),g.jsxs("div",{className:"univer-flex univer-items-center univer-justify-center univer-gap-2",children:[g.jsxs(ne,{onClick:()=>{d(a)},children:[g.jsx(dt,{}),r.t("image-panel.crop.start")]}),g.jsx(at,{value:a,options:l,onChange:c})]})]})},Mr=t=>{const e=B(Q),r=B(le),n=B(J),{drawings:i,hasArrange:a=!0,hasTransform:s=!0,hasAlign:o=!0,hasCropper:l=!0,hasGroup:c=!0}=t,d=i[0];if(d==null)return;const{unitId:u}=d,f=r.getRenderById(u),v=f?.scene;if(v==null)return;const w=v.getTransformerByCreate(),[p,h]=_.useState(!0),[S,b]=_.useState(!0),[R,x]=_.useState(!1),[T,C]=_.useState(!0),[M,I]=_.useState(!1);return _.useEffect(()=>{const y=w.clearControl$.subscribe(U=>{U===!0&&(h(!1),b(!1),x(!1),C(!1),I(!0))}),E=w.changeStart$.subscribe(U=>{const{objects:X}=U,q=Pe(X,e);q.length===0?(h(!1),b(!1),x(!1),C(!1),I(!0)):q.length===1?(h(!0),b(!0),x(!1),C(!0),I(!1)):(h(!0),b(!1),x(!0),C(!1),I(!1))}),N=e.focus$.subscribe(U=>{U.length===0?(h(!1),b(!1),x(!1),C(!1),I(!0)):U.length===1?(h(!0),b(!0),x(!1),C(!0),I(!1)):(h(!0),b(!1),x(!0),C(!1),I(!1))});return()=>{E.unsubscribe(),y.unsubscribe(),N.unsubscribe()}},[]),g.jsxs(g.Fragment,{children:[g.jsx("div",{className:Y("univer-h-full",{"univer-hidden":!M}),children:g.jsx("div",{className:"univer-flex univer-h-full univer-items-center univer-justify-center",children:g.jsx("span",{children:n.t("image-panel.null")})})}),g.jsx(pr,{arrangeShow:a===!0?p:!1,drawings:i}),g.jsx(vr,{transformShow:s===!0?S:!1,drawings:i}),g.jsx(fr,{alignShow:o===!0?R:!1,drawings:i}),g.jsx(wr,{cropperShow:l===!0?T:!1,drawings:i}),g.jsx(mr,{hasGroup:c,drawings:i})]})};export{Te as AutoImageCropOperation,zt as COMPONENT_IMAGE_POPUP_MENU,ie as CloseImageCropOperation,Mr as DrawingCommonPanel,Ne as DrawingRenderService,be as ImageCropperObject,sr as ImagePopupMenu,st as ImageResetSizeOperation,We as OpenImageCropOperation,$e as SetDrawingAlignOperation,et as UniverDrawingUIPlugin,ot as getCurrentUnitInfo,Pe as getUpdateParams,Ke as insertGroupObject};
