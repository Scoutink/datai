import{cr as Xe,fT as Ee,c5 as ke,fk as Te,da as Ye,bY as A,aE as me,el as ie,T as ee,cJ as ze,cM as ye,dh as Pe,bm as W,bo as $,b7 as fe,bB as ce,b9 as Ve}from"./index-BI8deSNo.js";import{ab as De,ai as Re,J as je,F as Oe,K as Le,aW as we,aU as oe,bn as K,aX as _e,ad as ve,aw as de,aG as J,d as Me,b5 as We,bb as Ne,b6 as Ke,ba as Ae,b7 as Ce,bI as ue,aL as He,aa as Fe}from"./index-DnxWP_AP.js";import"./shareReplay-DR2HpNHE.js";var Be=Object.defineProperty,qe=(e,t,a)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t,a)=>qe(e,typeof t!="symbol"?t+"":t,a);const Je="slides.config",pe={};var $e=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},te=(e,t)=>(a,i)=>t(a,i,e);const Ue="slides";var B;let ge=(B=class extends ke{constructor(e=pe,t,a,i){super(),f(this,"_canvasEngine",null),this._config=e,this._injector=t,this._renderManagerService=a,this._configService=i;const{...s}=Te({},pe,this._config);this._configService.setConfig(Je,s),this._initializeDependencies(this._injector)}initialize(){this.initCanvasEngine()}onReady(){}getConfig(){return this._config}initCanvasEngine(){this._canvasEngine=this._injector.get(De)}onRendered(){this.initialize()}getCanvasEngine(){return this._canvasEngine}_initializeDependencies(e){[].forEach(t=>{e.add(t)})}},f(B,"pluginName",Ue),f(B,"type",Ye.UNIVER_SLIDE),B);ge=$e([te(1,W($)),te(2,Fe),te(3,fe)],ge);class C{constructor(){f(this,"zIndex",0),f(this,"viewKey",null)}check(t){if(t===this.viewKey)return this}create(t){}}const N=Xe.create();var Ze=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},Qe=(e,t)=>(a,i)=>t(a,i,e);let se=class extends C{constructor(e){super(),f(this,"zIndex",5),f(this,"viewKey",A.DOCUMENT),f(this,"_liquid",new Re),this._localeService=e}check(e){if(e===this.viewKey)return this}convert(e,t){var a,i;const{id:s,zIndex:n,left:r=0,top:l=0,width:c,height:w,angle:p,scaleX:o,scaleY:d,skewX:_,skewY:g,flipX:X,flipY:k,title:E,description:b,document:h}=e;if(h==null)return;const T=new me(h),Y=new je(T),v=Oe.create(Y,this._localeService),I=new Le("__DocsRender__",v);v.calculate();const S=new we("__DocsViewer__"+s,{top:l,left:r,width:c,height:w,zIndex:n,angle:p,scaleX:o,scaleY:d,skewX:_,skewY:g,flipX:X,flipY:k}),u=new oe("__DocsScene__"+s,S),y=new K("__DocsViewPort_"+s,u,{left:0,top:0,bottom:0,right:0,explicitViewportWidthSet:!1,explicitViewportHeightSet:!1,isWheelPreventDefaultX:!0});u.attachControl(),u.onMouseWheel$.subscribeEvent((m,M)=>{const x=m;if(x.ctrlKey){const D=Math.abs(x.deltaX);let z=D<40?.2:D<80?.4:.2;z*=x.deltaY>0?-1:1,u.scaleX<1&&(z/=2),u.scaleX+z>4?u.scale(4,4):u.scaleX+z<.1?u.scale(.1,.1):(x.deltaY>0,x.preventDefault())}else y.onMouseWheel(x,M)}),new _e(y,{mainScene:t}),u.addObject(I);const P=v.getActualSize();I.resize(P.actualWidth,P.actualHeight),u.resize(P.actualWidth,P.actualHeight+200),(a=I.getSkeleton())==null||a.getPageSize(),I.pageRender$.subscribe(m=>{const{page:M,pageLeft:x,pageTop:D,ctx:z}=m,{width:Z,height:Q,marginBottom:G,marginLeft:R,marginRight:H,marginTop:F}=M;z.save(),z.translate(x-.5,D-.5),z.restore()});const{left:O,top:L}=I,V=v.getSkeletonData();if(V==null)return;const{pages:j}=V,U=[],he=new Map;this._recalculateSizeBySkeleton(I,u,v);for(let m=0,M=j.length;m<M;m++){const x=j[m],{skeDrawings:D,marginLeft:z,marginTop:Z,pageWidth:Q,pageHeight:G}=x;this._liquid.translatePagePadding(x),D.forEach(R=>{const{aLeft:H,aTop:F,height:Ie,width:Se,drawingOrigin:be}=R,{docTransform:wt}=be,xe=new ve(R.drawingId,{left:H+O+this._liquid.x,top:F+L+this._liquid.y,width:Se,height:Ie,zIndex:11});he.set(R.drawingId,{marginLeft:this._liquid.x,marginTop:this._liquid.y}),U.push(xe)}),this._liquid.translatePage(x,I.pageLayoutType,I.pageMarginLeft,I.pageMarginTop)}return u.addObjects(U),U.forEach(m=>{u.attachTransformerTo(m)}),(i=u.getTransformer())==null||i.changing$.subscribe(m=>{const{objects:M}=m;M.forEach(x=>{const{oKey:D,left:z,top:Z,height:Q,width:G}=x,R=he.get(D),H=R?.marginLeft||0,F=R?.marginTop||0;v?.getViewModel().getDataModel().updateDrawing(D,{left:z-O-H,top:Z-L-F,height:Q,width:G})}),v?.calculate()}),this._calculatePagePosition(I,u,y),S}_recalculateSizeBySkeleton(e,t,a){var i;const s=(i=a.getSkeletonData())==null?void 0:i.pages;if(s==null)return;let n=0,r=0;for(let l=0,c=s.length;l<c;l++){const w=s[l],{pageWidth:p,pageHeight:o}=w;e.pageLayoutType===de.VERTICAL?(r+=o,r+=e.pageMarginTop,l===c-1&&(r+=e.pageMarginTop),n=Math.max(n,p)):e.pageLayoutType===de.HORIZONTAL&&(n+=p,l!==c-1&&(n+=e.pageMarginLeft),r=Math.max(r,o))}e.resize(n,r),t.resize(n,r)}_calculatePagePosition(e,t,a,i=1){const s=t?.getParent(),{width:n,height:r,pageMarginLeft:l,pageMarginTop:c}=e;if(s==null||n===Number.POSITIVE_INFINITY||r===Number.POSITIVE_INFINITY)return;const{width:w,height:p}=s;let o=0,d=0,_=0,g=0,X=Number.POSITIVE_INFINITY;if(w>(n+l*2)*i?(o=w/2-n*i/2,o/=i,_=(w-l*2)/i,X=0):(o=l,_=n+l*2,X=(_-w/i)/2),p>r?(d=p/2-r/2,g=(p-c*2)/i):(d=c,g=r+c*2),t.resize(_,g+200),e.translate(o,d),X!==Number.POSITIVE_INFINITY&&a!=null){const k=a.transScroll2ViewportScrollValue(X,0).x;a.scrollToBarPos({x:k})}return this}};se=Ze([Qe(0,W(ce))],se);class Ge{constructor(){f(this,"zIndex",5)}create(t){return t.createInstance(se)}}N.add(new Ge);class et extends C{constructor(){super(...arguments),f(this,"zIndex",1),f(this,"viewKey",A.IMAGE)}check(t){if(t===this.viewKey)return this}convert(t){const{id:a,zIndex:i,left:s=0,top:n=0,width:r,height:l,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,title:X,description:k,image:E={}}=t,{imageProperties:b,placeholder:h,link:T}=E,Y=b?.contentUrl||"";return new ve(a,{url:Y,top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0})}}class tt{constructor(){f(this,"zIndex",4)}create(t){return t.createInstance(et)}}N.add(new tt);var it=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},st=(e,t)=>(a,i)=>t(a,i,e);let ne=class extends C{constructor(e){super(),f(this,"zIndex",2),f(this,"viewKey",A.TEXT),this._localeService=e}check(e){if(e===this.viewKey)return this}convert(e,t){const{id:a,zIndex:i,left:s=0,top:n=0,width:r,height:l,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,title:X,description:k,richText:E={}}=e,{text:b,ff:h,fs:T,it:Y,bl:v,ul:I,st:S,ol:u,bg:y,bd:P,cl:O,rich:L}=E;let V={top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0},j=!1;if(b!=null?(V={...V,text:b,ff:h,fs:T,it:Y,bl:v,ul:I,st:S,ol:u,bg:y,bd:P,cl:O},j=!0):L!=null&&(V={...V,richText:L},j=!0),j!==!1)return new He(this._localeService,a,V)}};ne=it([st(0,W(ce))],ne);class nt{constructor(){f(this,"zIndex",0)}create(t){return t.createInstance(ne)}}N.add(new nt);class at extends C{constructor(){super(...arguments),f(this,"zIndex",2),f(this,"viewKey",A.SHAPE)}check(t){if(t===this.viewKey)return this}convert(t){const{id:a,zIndex:i,left:s=0,top:n=0,width:r,height:l,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,title:X,description:k}=t,{shapeType:E,text:b,shapeProperties:h,placeholder:T,link:Y}=t.shape||{},v=h==null?"":ie(h.shapeBackgroundFill)||"rgba(255,255,255,1)",I=h?.outline,S={};if(I){const{outlineFill:u,weight:y}=I;S.strokeWidth=y,S.stroke=ie(u)||"rgba(0,0,0,1)"}if(E===ee.Rect)return new J(a,{fill:v,top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0,...S});if(E===ee.RoundRect){const u=h?.radius||0;return new J(a,{fill:v,top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0,radius:u,...S})}if(E===ee.Ellipse){console.warn(h?.radius);const u=h?.radius||0;return new Me(a,{fill:v,top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0,radius:u,...S})}}}class rt{constructor(){f(this,"zIndex",2)}create(t){return t.createInstance(at)}}N.add(new rt);var lt=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},ct=(e,t)=>(a,i)=>t(a,i,e);let ae=class{constructor(e){f(this,"_adaptors",[]),this._injector=e,this._adaptorLoader()}convertToRenderObjects(e,t){const a=Object.keys(e),i=[];return a.forEach(s=>{const n=e[s],r=this._executor(n,t);r!=null&&i.push(r)}),i}convertToRenderObject(e,t){return this._executor(e,t)}_executor(e,t){var a;const{id:i,type:s}=e;for(const n of this._adaptors){const r=(a=n.check(s))==null?void 0:a.convert(e,t);if(r!=null)return r}}_adaptorLoader(){N.getData().sort(Ee).forEach(e=>{this._adaptors.push(e.create(this._injector))})}};ae=lt([ct(0,W($))],ae);var ot=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},ht=(e,t)=>(a,i)=>t(a,i,e),dt=(e=>(e.MAIN="__SLIDERender__",e.SCENE_VIEWER="__SLIDEViewer__",e.SCENE="__SLIDEScene__",e.VIEWPORT="__SLIDEViewPort_",e))(dt||{});let re=class extends C{constructor(e){super(),f(this,"zIndex",6),f(this,"viewKey",A.SLIDE),f(this,"_ObjectProvider",null),this._injector=e}check(e){if(e===this.viewKey)return this}convert(e,t){const{id:a,zIndex:i,left:s=0,top:n=0,width:r,height:l,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,title:X,description:k,slide:E}=e;if(E==null)return;const b=new ze(E),h=new We("__SLIDERender__"+a,{top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0});h.enableNav(),h.enableSelectedClipElement();const T=b.getPageOrder(),Y=b.getPages();if(!T||!Y)return h;this._ObjectProvider=new ae(this._injector);for(let v=0,I=T.length;v<I;v++){const S=Y[T[v]],{id:u}=S;h.addPageScene(this._createScene(u,h,S,t,b))}return h.activeFirstPage(),h}_createScene(e,t,a,i,s){var n;const{width:r,height:l}=t,c=new oe(e,t,{width:r,height:l});new K(`PageViewer_${e}`,c,{left:0,top:0,bottom:0,right:0,explicitViewportWidthSet:!1,explicitViewportHeightSet:!1}).closeClip();const{pageElements:w,pageBackgroundFill:p}=a,o=(n=this._ObjectProvider)==null?void 0:n.convertToRenderObjects(w,i);return this._addBackgroundRect(c,p,s),c.addObjects(o),o?.forEach(d=>{c.attachTransformerTo(d)}),c}_addBackgroundRect(e,t,a){const i=a.getPageSize(),{width:s=0,height:n=0}=i,r=new J("canvas",{left:0,top:0,width:s,height:n,strokeWidth:1,stroke:"rgba(198,198,198, 1)",fill:ie(t)||"rgba(255,255,255, 1)",zIndex:0,evented:!1});e.addObject(r,0)}};re=ot([ht(0,W($))],re);class ut{constructor(){f(this,"zIndex",6)}create(t){return t.createInstance(re)}}N.add(new ut);var pt=(e,t,a,i)=>{for(var s=t,n=e.length-1,r;n>=0;n--)(r=e[n])&&(s=r(s)||s);return s},q=(e,t)=>(a,i)=>t(a,i,e);let le=class extends C{constructor(e,t,a,i){super(),f(this,"zIndex",4),f(this,"viewKey",A.SPREADSHEET),this._localeService=e,this._contextService=t,this._configService=a,this._injector=i}check(e){if(e===this.viewKey)return this}convert(e,t){const{id:a,zIndex:i,left:s=0,top:n=0,width:r,height:l,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,spreadsheet:X}=e;if(X==null)return;const{worksheet:k,styles:E}=X,b=new ye(E),h=new Ne(new Pe(a,k,b),b,this._localeService,this._contextService,this._configService,this._injector),{rowTotalHeight:T,columnTotalWidth:Y,rowHeaderWidth:v,columnHeaderHeight:I}=h,S=Y+k.rowHeader.width||0,u=T+k.columnHeader.height||0,y=new we("spreadInSlideSceneViewer"+a,{top:n,left:s,width:r,height:l,zIndex:i,angle:c,scaleX:w,scaleY:p,skewX:o,skewY:d,flipX:_,flipY:g,forceRender:!0}),P=new oe("spreadInSlideScene"+a,y,{width:S,height:u});this._updateViewport(a,v,I,P,t);const O=new Ke("testSheetViewer",h,!1),L=new Ae("spreadInSlideRow",h),V=new Ce("spreadInSlideColumn",h),j=new J("spreadInSlideLeftTop",{zIndex:2,left:-1,top:-1,width:v,height:I,fill:ue([248,249,250]),stroke:ue([217,217,217]),strokeWidth:1});return O.zIndex=10,P.addObjects([O],1),P.addObjects([L,V,j],2),y}_updateViewport(e,t,a,i,s){if(s==null)return;const n=t*i.scaleX,r=a*i.scaleY,l=new K("spreadInSlideViewMain"+e,i,{left:n,top:r,bottom:0,right:0,explicitViewportWidthSet:!1,explicitViewportHeightSet:!1,isWheelPreventDefaultX:!0}),c=new K("spreadInSlideViewTop"+e,i,{left:n,height:r,top:0,right:0,explicitViewportWidthSet:!1,isWheelPreventDefaultX:!0}),w=new K("spreadInSlideViewLeft"+e,i,{left:0,bottom:0,top:r,width:n,explicitViewportHeightSet:!1,isWheelPreventDefaultX:!0});new K("spreadInSlideViewLeftTop"+e,i,{left:0,top:0,width:n,height:r,isWheelPreventDefaultX:!0}),l.onScrollAfter$.subscribeEvent(p=>{const{scrollX:o,scrollY:d,viewportScrollX:_,viewportScrollY:g}=p;c.updateScrollVal({scrollX:o,viewportScrollX:_}),w.updateScrollVal({scrollY:d,viewportScrollY:g})}),i.attachControl(),new _e(l,{mainScene:s}),i.onMouseWheel$.subscribeEvent((p,o)=>{const d=p;if(d.ctrlKey){const _=Math.abs(d.deltaX);let g=_<40?.05:_<80?.02:.01;g*=d.deltaY>0?-1:1,i.scaleX<1&&(g/=2),i.scaleX+g>4?i.scale(4,4):i.scaleX+g<.1?i.scale(.1,.1):(i.scaleBy(g,g),d.preventDefault())}else l.onMouseWheel(d,o)})}};le=pt([q(0,W(ce)),q(1,Ve),q(2,fe),q(3,W($))],le);class gt{constructor(){f(this,"zIndex",4)}create(t){return t.createInstance(le)}}N.add(new gt);var ft=(e=>(e.COMPONENT="__slideRender__",e.SCENE="__mainScene__",e.VIEW="__mainView__",e))(ft||{});export{N as CanvasObjectProviderRegistry,C as ObjectAdaptor,ae as ObjectProvider,ft as SLIDE_KEY,dt as SLIDE_VIEW_KEY,ge as UniverSlidesPlugin};
