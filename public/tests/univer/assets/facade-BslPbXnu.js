import{DocSelectionRenderService as Bi,ReplaceSnapshotCommand as jC,VIEWPORT_KEY as gd,MoveSelectionOperation as __,MoveCursorOperation as I_,getCanvasOffsetByEngine as Bf,IEditorService as no,CoverContentCommand as R_,SetInlineFormatTextColorCommand as FC,SetInlineFormatBoldCommand as y_,SetInlineFormatFontSizeCommand as Om,SetInlineFormatFontFamilyCommand as M_,SetInlineFormatItalicCommand as E_,SetInlineFormatStrikethroughCommand as x_,SetInlineFormatSubscriptCommand as k_,SetInlineFormatSuperscriptCommand as T_,SetInlineFormatUnderlineCommand as P_,DOCS_COMPONENT_MAIN_LAYER_INDEX as U_,IMEInputCommand as N_,InsertCommand as O_,BreakLineCommand as A_,DeleteLeftCommand as zC,DeleteRightCommand as V_,DOCS_VIEW_KEY as H_,convertBodyToHtml as D_,NodePositionConvertToCursor as XC,getLineBounding as YC,DOC_VERTICAL_PADDING as W_,SetInlineFormatCommand as Sa}from"./index-C5GuqOxb.js";import{gr as ZC,gs as L_,gt as wl,gu as Sl,g4 as GC,gv as B_,gw as j_,ga as F_,g5 as jf,gk as z_,gx as X_,L as H,dU as gn,az as Dt,bi as P,d5 as Q,b6 as U,i as ce,b8 as ys,bB as Oe,fM as fe,aB as ae,aA as Z,cm as z,bP as de,j as je,da as A,fy as bl,g6 as xe,f$ as He,ce as j,e_ as Am,eZ as Y_,x as tt,I as Qt,fr as qC,e as pe,fW as QC,cl as De,gm as Ve,dT as bn,aJ as so,fp as Yg,ea as hn,dD as KC,aC as Et,bq as Ci,gy as Z_,c4 as Le,gf as Wt,gd as Se,bv as $C,gl as Re,b7 as Lt,b2 as nl,b0 as sl,bd as Je,e$ as JC,fj as G_,bp as Yt,fB as xs,dH as q_,B as Q_,gq as ew,ck as K_,cz as Ms,g7 as yn,fa as Cs,f7 as rr,aE as $_,Q as J_,c$ as eI,c5 as Vm,fk as Hm,bg as tI,J as nI,fA as _l,fm as Dm,g0 as Ns,gb as Ut,fJ as sI,g3 as tw,eP as nw,l as sw,ec as iw,b9 as Ne,fl as rw,ds as Dc,fS as ow,dJ as aw,f_ as lw,b5 as Pt,eV as iI,dX as rI,bE as Ff,bD as zf,fz as or,f8 as oI,fv as aI,aw as Wm,bm as V,bo as pt,bf as lu,bc as ar,O as Ys,dc as Bn,bS as Wc,d4 as xn,dL as md,ah as it,ai as rt,aR as Lc,di as ws,aP as Zg,aS as Vn,aH as It,aQ as pd,gc as dt,gz as ji,eb as Wh,k as Ls,ca as Gg,a1 as hi,e8 as fd,dd as vn,dB as lI,eq as Ba,aV as kn,aM as uI,fO as dI,bN as Lm,g8 as ct,aN as Es,d_ as vd,fX as cI,E as Bm,c8 as hI,aU as io,dg as gI,aY as ro,fT as mI,X as uw,b as Cd,ft as pI,dZ as Au,es as lr,fR as fI,dC as td,g9 as Bc,aF as vI,eF as Xf,e5 as dw,d7 as CI,f2 as wI,ao as SI,ac as bI,Z as Yf,a9 as _I,a8 as II,N as Zf,ew as cw,dz as qg,dA as jc,fc as RI,go as Gf,dI as yI,h as qs,d6 as MI,co as EI,e9 as qf,dN as Qg,c_ as Qf,cy as fo,dO as Kf,f3 as ja,be as xI}from"./index-BI8deSNo.js";import{bE as $e,z as kI,W as hw,av as TI,aN as PI,an as te,ar as Fe,bt as G,w as Tn,bw as zt,bq as UI,br as ba,_ as NI,ad as jm,U as un,aY as OI,bF as wd,a$ as Fc,au as $f,a0 as Jf,bj as AI,a4 as zc,a6 as uu,aj as _a,a as xo,b8 as ko,l as kt,aJ as ev,aF as VI,aK as Vu,ao as ie,ba as Ce,O as Fm,B as HI,y as DI,A as WI,u as LI,F as tv,bu as nv,bz as gw,X as BI,bf as jI,bo as sv,r as FI,s as zI,Q as XI,J as YI,a5 as Xc,ae as mw,aU as ZI,b3 as GI,af as qI,ag as QI,aa as zm,a3 as KI,ai as Yc,al as Xm,am as pw}from"./index-BeEHzc6r.js";import{aS as $,aZ as tn,aY as To,bm as at,x as bt,bu as Ym,bv as Ro,bw as yo,aX as Zm,aG as Be,c as Qe,bd as Kg,aa as ze,_ as $I,a5 as Lh,bq as JI,cS as e0,cZ as Gm,aD as fw,bK as du,bD as iv,aQ as rv,b6 as vw,ba as t0,b7 as n0,bn as Qs,c_ as Nt,bb as s0,aE as i0,cG as Di,ag as r0,a_ as qm,a0 as o0,aH as il,b1 as Cw,cc as a0,l as l0,cI as ov}from"./index-DnxWP_AP.js";import{RichTextEditingMutation as Sd,DocSkeletonManagerService as Fi,DocSelectionManagerService as Qm,SetTextSelectionsOperation as Ia}from"./index-GTTB9Gpg.js";import{aj as L,ak as S,a4 as Ke,a2 as Km,R as $m,c as $g,ag as cu,d as Jm,T as Ra,Z as us,$ as u0,M as d0,r as ww,x as c0,a as h0,a3 as bd,f as g0,s as m0,E as Hi,D as p0,i as Sw,Y as _d,J as Jg,o as Mo,p as bw,g as ep,v as f0,z as Id}from"./index-BmfxE5KL.js";import{aO as Il,aG as Rd,aP as v0,bW as Ir,bh as hu,bZ as nd,bi as C0,c5 as w0,aS as S0,bJ as b0,E as _0,ab as wi,as as Zc,cb as I0,aR as R0,P as wt,y as Gc,D as y0,bT as _w,c0 as qc,bR as Iw,au as av,al as M0,ah as Rw,bQ as yw,b_ as gu,R as Mw}from"./index-BBqjqAkl.js";import{t as ln}from"./takeUntil-BWepI5Pd.js";import{a as Rn}from"./shareReplay-DR2HpNHE.js";import{U as Ew,O as E0,j as x0,a as tp,$ as np}from"./facade-bHpds0ZF.js";var k0=Array.isArray;function T0(e){return e.length===1&&k0(e[0])?e[0]:e}function xw(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ZC(e);return n?L_(xw.apply(void 0,wl([],Sl(e))),j_(n)):GC(function(s,i){B_(wl([s],Sl(T0(e))))(i)})}function ur(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xw.apply(void 0,wl([],Sl(e)))}function P0(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ZC(e);return GC(function(s,i){for(var r=e.length,o=new Array(r),a=e.map(function(){return!1}),l=!1,u=function(c){F_(e[c]).subscribe(jf(i,function(h){o[c]=h,!l&&!a[c]&&(a[c]=!0,(l=a.every(z_))&&(a=null))},X_))},d=0;d<r;d++)u(d);s.subscribe(jf(i,function(c){if(l){var h=wl([c],Sl(o));i.next(n?n.apply(void 0,wl([],Sl(h))):h)}}))})}var U0=Object.defineProperty,N0=(e,t,n)=>t in e?U0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t,n)=>N0(e,typeof t!="symbol"?t+"":t,n);function O0(e,t,n){var s,i,r;if(t.t)return t.t;if(t.v===null)return null;const o=e.getStyleByCell(t),a=e.getStyleByCell(n);if(n.t===je.FORCE_STRING){if(!Cs((s=a?.n)==null?void 0:s.pattern)&&t.v!==void 0){if(rr(t.v))return je.NUMBER;if(nw(`${t.v}`))return je.BOOLEAN}return je.FORCE_STRING}return A0(o)?Cs((i=o?.n)==null?void 0:i.pattern)?je.STRING:lv(t,n):Cs((r=a?.n)==null?void 0:r.pattern)?je.STRING:lv(t,n)}function lv(e,t){return e.v!==void 0?uv(e.v,e.t):uv(t.v,t.t)}function A0(e){var t;return!!((t=e?.n)!=null&&t.pattern)}function uv(e,t){return e===null?null:typeof e=="string"?rr(e)?(+e==0||+e==1)&&t===je.BOOLEAN?je.BOOLEAN:t!==je.STRING&&t!==je.FORCE_STRING&&tw(e)?je.FORCE_STRING:je.NUMBER:nw(e)?je.BOOLEAN:je.STRING:typeof e=="number"?(e===0||e===1)&&t===je.BOOLEAN?je.BOOLEAN:je.NUMBER:typeof e=="boolean"?je.BOOLEAN:je.FORCE_STRING}function kw(e,t){const{unitId:n}=t,s=n?e.getUnit(n,A.UNIVER_SHEET):e.getCurrentUnitOfType(A.UNIVER_SHEET);return s?{workbook:s,unitId:s.getUnitId()}:null}function Y(e,t={}){const{unitId:n,subUnitId:s}=t,i=n?e.getUnit(n,A.UNIVER_SHEET):e.getCurrentUnitOfType(A.UNIVER_SHEET);if(!i)return null;const r=s?i.getSheetBySheetId(s):i.getActiveSheet(!0);return r?{worksheet:r,workbook:i,unitId:i.getUnitId(),subUnitId:r.getSheetId()}:null}function sn(e,t){const{unitId:n,subUnitId:s}=t,i=e.getUnit(n,A.UNIVER_SHEET);if(!i)return null;const r=i.getSheetBySheetId(s);return r?{worksheet:r,workbook:i}:null}const On=(e,t)=>{if(!sn(e.get(P),t))throw new Error("Workbook or worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:Q.deepClone(t.ranges)}},qe={id:"sheet.mutation.add-worksheet-merge",type:H.MUTATION,handler:(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("Workbook or worksheet is null error!");const{worksheet:s}=n,i=s.getConfig().mergeData,r=t.ranges;for(let o=0;o<r.length;o++)i.push(r[o]);return s.getSpanModel().rebuild(i),!0}},V0=gn("CELL_CONTENT"),H0=gn("ROW_FILTERED"),ri={CELL_CONTENT:V0,ROW_FILTERED:H0};var D0=(e=>(e[e.DATA_VALIDATION=9]="DATA_VALIDATION",e[e.NUMFMT=10]="NUMFMT",e[e.CELL_IMAGE=11]="CELL_IMAGE",e))(D0||{});const Tw="sheet.interceptor.range-theme-id",dv="sheet.interceptor.ignore-range-theme";var W0=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},L0=(e,t)=>(n,s)=>t(n,s,e);const em=gn("BEFORE_CELL_EDIT"),Bh=gn("AFTER_CELL_EDIT"),jh=gn("VALIDATE_CELL");let _e=class extends ae{constructor(e){super(),E(this,"_interceptorsByName",new Map),E(this,"_commandInterceptors",[]),E(this,"_rangeInterceptors",[]),E(this,"_autoHeightInterceptors",[]),E(this,"_beforeCommandInterceptor",[]),E(this,"_afterCommandInterceptors",[]),E(this,"_workbookDisposables",new Map),E(this,"_worksheetDisposables",new Map),E(this,"_interceptorsDirty",!1),E(this,"_composedInterceptorByKey",new Map),E(this,"writeCellInterceptor",new Ci({BEFORE_CELL_EDIT:em,AFTER_CELL_EDIT:Bh,VALIDATE_CELL:jh})),this._univerInstanceService=e,this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(A.UNIVER_SHEET).subscribe(t=>{this._interceptWorkbook(t)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(A.UNIVER_SHEET).subscribe(t=>this._disposeWorkbookInterceptor(t))),this.intercept(ri.CELL_CONTENT,{priority:-1,effect:Yt.Style|Yt.Value,handler:t=>t}),this.disposeWithMe(this.writeCellInterceptor.intercept(Bh,{priority:-1,handler:t=>t})),this.disposeWithMe(this.writeCellInterceptor.intercept(em,{priority:-1,handler:t=>t})),this.disposeWithMe(this.writeCellInterceptor.intercept(jh,{priority:-1,handler:t=>t}))}dispose(){super.dispose(),this._workbookDisposables.forEach(e=>e.dispose()),this._workbookDisposables.clear(),this._worksheetDisposables.forEach(e=>e.dispose()),this._worksheetDisposables.clear(),this._interceptorsByName.clear()}interceptCommand(e){if(this._commandInterceptors.includes(e))throw new Error("[SheetInterceptorService]: Interceptor already exists!");return this._commandInterceptors.push(e),this._commandInterceptors.sort((t,n)=>{var s,i;return((s=n.priority)!=null?s:0)-((i=t.priority)!=null?i:0)}),this.disposeWithMe(He(()=>xs(this._commandInterceptors,e)))}onCommandExecute(e){const t=this._commandInterceptors.map(n=>n.getMutations(e));return{preUndos:t.map(n=>{var s;return(s=n.preUndos)!=null?s:[]}).flat(),undos:t.map(n=>n.undos).flat(),preRedos:t.map(n=>{var s;return(s=n.preRedos)!=null?s:[]}).flat(),redos:t.map(n=>n.redos).flat()}}interceptAfterCommand(e){if(this._afterCommandInterceptors.includes(e))throw new Error("[SheetInterceptorService]: Interceptor already exists!");return this._afterCommandInterceptors.push(e),this._afterCommandInterceptors.sort((t,n)=>{var s,i;return((s=n.priority)!=null?s:0)-((i=t.priority)!=null?i:0)}),this.disposeWithMe(He(()=>xs(this._afterCommandInterceptors,e)))}afterCommandExecute(e){const t=this._afterCommandInterceptors.map(n=>n.getMutations(e));return{undos:t.map(n=>n.undos).flat(),redos:t.map(n=>n.redos).flat()}}interceptAutoHeight(e){if(this._autoHeightInterceptors.includes(e))throw new Error("[SheetInterceptorService]: Interceptor already exists!");return this._autoHeightInterceptors.push(e),this._autoHeightInterceptors.sort((t,n)=>{var s,i;return((s=n.priority)!=null?s:0)-((i=t.priority)!=null?i:0)}),this.disposeWithMe(He(()=>xs(this._autoHeightInterceptors,e)))}generateMutationsOfAutoHeight(e){const t=this._autoHeightInterceptors.map(n=>n.getMutations(e));return{preUndos:t.map(n=>{var s;return(s=n.preUndos)!=null?s:[]}).flat(),undos:t.map(n=>n.undos).flat(),preRedos:t.map(n=>{var s;return(s=n.preRedos)!=null?s:[]}).flat(),redos:t.map(n=>n.redos).flat()}}interceptBeforeCommand(e){if(this._beforeCommandInterceptor.includes(e))throw new Error("[SheetInterceptorService]: Interceptor already exists!");return this._beforeCommandInterceptor.push(e),this._beforeCommandInterceptor.sort((t,n)=>{var s,i;return((s=n.priority)!=null?s:0)-((i=t.priority)!=null?i:0)}),this.disposeWithMe(He(()=>xs(this._beforeCommandInterceptor,e)))}async beforeCommandExecute(e){return(await Promise.all(this._beforeCommandInterceptor.map(t=>t.performCheck(e)))).every(t=>t)}interceptRanges(e){if(this._rangeInterceptors.includes(e))throw new Error("[SheetInterceptorService]: Interceptor already exists!");return this._rangeInterceptors.push(e),this._rangeInterceptors.sort((t,n)=>{var s,i;return((s=n.priority)!=null?s:0)-((i=t.priority)!=null?i:0)}),this.disposeWithMe(He(()=>xs(this._rangeInterceptors,e)))}generateMutationsByRanges(e){const t=this._rangeInterceptors.map(n=>n.getMutations(e));return{preUndos:t.map(n=>{var s;return(s=n.preUndos)!=null?s:[]}).flat(),undos:t.map(n=>n.undos).flat(),preRedos:t.map(n=>{var s;return(s=n.preRedos)!=null?s:[]}).flat(),redos:t.map(n=>n.redos).flat()}}onWriteCell(e,t,n,s,i){const r={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:n,col:s,origin:Q.deepClone(i)};return this.writeCellInterceptor.fetchThroughInterceptors(Bh)(i,r)}onValidateCell(e,t,n,s){const i={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:n,col:s};return this.writeCellInterceptor.fetchThroughInterceptors(jh)(Promise.resolve(!0),i)}intercept(e,t){const n=e;this._interceptorsByName.has(n)||this._interceptorsByName.set(n,[]);const s=this._interceptorsByName.get(n);s.push(t);const i=s.sort((r,o)=>{var a,l;return((a=o.priority)!=null?a:0)-((l=r.priority)!=null?l:0)});if(this._interceptorsDirty=!0,n===ri.CELL_CONTENT){const r=Yt.Style|Yt.Value;this._interceptorsByName.set(`${n}-${r}`,i);const o=Yt.Style|Yt.Value;return this._interceptorsByName.set(`${n}-${Yt.Style}`,i.filter(a=>((a.effect||o)&Yt.Style)>0)),this._interceptorsByName.set(`${n}-${Yt.Value}`,i.filter(a=>((a.effect||o)&Yt.Value)>0)),this.disposeWithMe(He(()=>{xs(this._interceptorsByName.get(n),t),xs(this._interceptorsByName.get(`${n}-${r}`),t),xs(this._interceptorsByName.get(`${n}-${Yt.Style}`),t),xs(this._interceptorsByName.get(`${n}-${Yt.Value}`),t)}))}else return this._interceptorsByName.set(n,i),this.disposeWithMe(He(()=>xs(this._interceptorsByName.get(n),t)))}fetchThroughInterceptors(e,t,n,s){const i=t===void 0?e:`${e}-${t}`,r=n??i;let o=this._composedInterceptorByKey.get(r);if(!o||!this._interceptorsDirty){let a=this._interceptorsByName.get(i);a&&s&&(a=a.filter(s)),o=q_(a||[]),this._composedInterceptorByKey.set(r,o)}return o}_interceptWorkbook(e){const t=new Et,n=e.getUnitId(),s=this,i=r=>{const o=r.getSheetId();r.__interceptViewModel(a=>{const l=new Et;s._worksheetDisposables.set(cv(n,r),l),l.add(a.registerCellContentInterceptor({getCell(u,d,c,h,g){const m=r.getCellRaw(u,d);return s.fetchThroughInterceptors(ri.CELL_CONTENT,c,h,g)(m,{unitId:n,subUnitId:o,row:u,col:d,worksheet:r,workbook:e,rawData:m})}})),l.add(a.registerRowFilteredInterceptor({getRowFiltered(u){return!!s.fetchThroughInterceptors(ri.ROW_FILTERED)(!1,{unitId:n,subUnitId:o,row:u,workbook:e,worksheet:r})}}))})};e.getSheets().forEach(r=>i(r)),t.add(e.sheetCreated$.subscribe(r=>i(r))),t.add(He(()=>e.getSheets().forEach(r=>this._disposeSheetInterceptor(n,r)))),t.add(e.sheetDisposed$.subscribe(r=>this._disposeSheetInterceptor(n,r))),this._workbookDisposables.set(n,t)}_disposeWorkbookInterceptor(e){const t=e.getUnitId(),n=this._workbookDisposables.get(t);n&&(n.dispose(),this._workbookDisposables.delete(t))}_disposeSheetInterceptor(e,t){const n=cv(e,t),s=this._worksheetDisposables.get(n);s&&(s.dispose(),this._worksheetDisposables.delete(n))}};_e=W0([L0(0,P)],_e);function cv(e,t){return`${e}|${t.getSheetId()}`}const en=e=>{const t={};return e.bg&&(t.bg={...e.bg}),e.ol&&(t.ol={...e.ol}),e.bd&&(t.bd={...e.bd}),e.cl&&(t.cl={...e.cl}),e.ht&&(t.ht=e.ht),e.vt&&(t.vt=e.vt),e.bl!==void 0&&(t.bl=e.bl),t};function B0(e){const t={};if(e.length===1)return e[0];for(const n of e)n.bg&&(t.bg=n.bg),n.ol&&(t.ol=n.ol),n.bd&&(t.bd={...t.bd,...n.bd}),n.cl&&(t.cl=n.cl),n.ht&&(t.ht=n.ht),n.vt&&(t.vt=n.vt),n.bl!==void 0&&(t.bl=n.bl);return t}const Xt={wholeStyle:1,headerRowStyle:2,headerColumnStyle:4,firstRowStyle:8,secondRowStyle:16,lastRowStyle:32,firstColumnStyle:128,secondColumnStyle:256,lastColumnStyle:512};let Si=class{constructor(t,n){E(this,"_name"),E(this,"wholeStyle",null),E(this,"headerRowStyle",null),E(this,"headerColumnStyle",null),E(this,"firstRowStyle",null),E(this,"secondRowStyle",null),E(this,"lastRowStyle",null),E(this,"firstColumnStyle",null),E(this,"secondColumnStyle",null),E(this,"lastColumnStyle",null),E(this,"_mergeCacheMap",new Map),n&&this.fromJson({...n,name:t}),this._name=t}getName(){return this._name}getWholeStyle(){return this.wholeStyle}setWholeStyle(t){this.wholeStyle=t,this._resetStyleCache()}getFirstRowStyle(){return this.firstRowStyle}setFirstRowStyle(t){this.firstRowStyle=t,this._resetStyleCache()}getSecondRowStyle(){return this.secondRowStyle}setSecondRowStyle(t){this.secondRowStyle=t,this._resetStyleCache()}getLastRowStyle(){return this.lastRowStyle}setLastRowStyle(t){this.lastRowStyle=t,this._resetStyleCache()}getFirstColumnStyle(){return this.firstColumnStyle}setFirstColumnStyle(t){this.firstColumnStyle=t,this._resetStyleCache()}getSecondColumnStyle(){return this.secondColumnStyle}setSecondColumnStyle(t){this.secondColumnStyle=t,this._resetStyleCache()}getLastColumnStyle(){return this.lastColumnStyle}setLastColumnStyle(t){this.lastColumnStyle=t,this._resetStyleCache()}getHeaderRowStyle(){return this.headerRowStyle}setHeaderRowStyle(t){this.headerRowStyle=t,this._resetStyleCache()}getHeaderColumnStyle(){return this.headerColumnStyle}setHeaderColumnStyle(t){this.headerColumnStyle=t,this._resetStyleCache()}getStyle(t,n,s,i,r){let o=0;return s&&(o=o|Xt.lastRowStyle),i&&(o=o|Xt.lastColumnStyle),t>=0&&n>=0&&(o=o|Xt.wholeStyle),t%2===1&&(o=o|(r?Xt.secondRowStyle:Xt.firstRowStyle)),t%2===0&&(o=o|(r?Xt.firstRowStyle:Xt.secondRowStyle)),t===0&&(o=o|Xt.headerRowStyle),n===0&&(o=o|Xt.headerColumnStyle),n%2===1&&(o=o|Xt.firstColumnStyle),n%2===0&&(o=o|Xt.secondColumnStyle),o===0?null:this._getMergeStyle(o)}_getMergeStyle(t){let n=this._mergeCacheMap.get(t);return n||(n=this._mergeStyle(t),this._mergeCacheMap.set(t,n)),n}_mergeStyle(t){const n=[];return this.wholeStyle&&t&Xt.wholeStyle&&n.push(this.wholeStyle),this.firstColumnStyle&&t&Xt.firstColumnStyle&&n.push(this.firstColumnStyle),this.secondColumnStyle&&t&Xt.secondColumnStyle&&n.push(this.secondColumnStyle),this.firstRowStyle&&t&Xt.firstRowStyle&&n.push(this.firstRowStyle),this.secondRowStyle&&t&Xt.secondRowStyle&&n.push(this.secondRowStyle),this.headerColumnStyle&&t&Xt.headerColumnStyle&&n.push(this.headerColumnStyle),this.lastColumnStyle&&t&Xt.lastColumnStyle&&n.push(this.lastColumnStyle),this.headerRowStyle&&t&Xt.headerRowStyle&&n.push(this.headerRowStyle),this.lastRowStyle&&t&Xt.lastRowStyle&&n.push(this.lastRowStyle),B0(n)}_resetStyleCache(){this._mergeCacheMap.clear()}toJson(){const t={name:this._name};return this.wholeStyle&&(t.wholeStyle=en(this.wholeStyle)),this.headerRowStyle&&(t.headerRowStyle=en(this.headerRowStyle)),this.headerColumnStyle&&(t.headerColumnStyle=en(this.headerColumnStyle)),this.firstRowStyle&&(t.firstRowStyle=en(this.firstRowStyle)),this.secondRowStyle&&(t.secondRowStyle=en(this.secondRowStyle)),this.lastRowStyle&&(t.lastRowStyle=en(this.lastRowStyle)),this.firstColumnStyle&&(t.firstColumnStyle=en(this.firstColumnStyle)),this.secondColumnStyle&&(t.secondColumnStyle=en(this.secondColumnStyle)),this.lastColumnStyle&&(t.lastColumnStyle=en(this.lastColumnStyle)),t}fromJson(t){this._name=t.name,t.wholeStyle&&(this.wholeStyle=en(t.wholeStyle)),t.headerRowStyle&&(this.headerRowStyle=en(t.headerRowStyle)),t.headerColumnStyle&&(this.headerColumnStyle=en(t.headerColumnStyle)),t.firstRowStyle&&(this.firstRowStyle=en(t.firstRowStyle)),t.secondRowStyle&&(this.secondRowStyle=en(t.secondRowStyle)),t.lastRowStyle&&(this.lastRowStyle=en(t.lastRowStyle)),t.firstColumnStyle&&(this.firstColumnStyle=en(t.firstColumnStyle)),t.secondColumnStyle&&(this.secondColumnStyle=en(t.secondColumnStyle)),t.lastColumnStyle&&(this.lastColumnStyle=en(t.lastColumnStyle))}dispose(){this._mergeCacheMap.clear()}};const j0=(e,t,n)=>new Si(`light-${e}`,{headerRowStyle:{bg:{rgb:t}},firstColumnStyle:{bg:{rgb:"rgb(255, 255, 255)"}},secondColumnStyle:{bg:{rgb:n}},lastRowStyle:{bg:{rgb:t}}}),F0=(e,t,n)=>new Si(`middle-${e}`,{headerRowStyle:{bg:{rgb:t}},headerColumnStyle:{bg:{rgb:n}},secondRowStyle:{bg:{rgb:n}},lastRowStyle:{bg:{rgb:t}},lastColumnStyle:{bg:{rgb:n}}}),z0=(e,t,n,s)=>new Si(`dark-${e}`,{headerRowStyle:{bg:{rgb:t},cl:{rgb:"rgb(255, 255, 255)"},ht:Pt.CENTER,bl:pe.TRUE},firstRowStyle:{bg:{rgb:n}},secondRowStyle:{bg:{rgb:s}},lastRowStyle:{bg:{rgb:t}}}),X0=[{baseName:"blue",header:"rgb(164, 202, 254)",color:"rgb(225, 239, 254)"},{baseName:"grey",header:"rgb(205, 208, 216)",color:"rgb(238, 239, 241)"},{baseName:"red",header:"rgb(248, 180, 180)",color:"rgb(253, 232, 232)"},{baseName:"orange",header:"rgb(253, 186, 140)",color:"rgb(254, 236, 220)"},{baseName:"yellow",header:"rgb(250, 200, 21)",color:"rgb(255, 244, 185)"},{baseName:"green",header:"rgb(132, 225, 188)",color:"rgb(222, 247, 236)"},{baseName:"azure",header:"rgb(126, 220, 226)",color:"rgb(213, 245, 246)"},{baseName:"indigo",header:"rgb(186, 198, 248)",color:"rgb(233, 237, 255)"},{baseName:"purple",header:"rgb(202, 191, 253)",color:"rgb(237, 235, 254)"},{baseName:"magenta",header:"rgb(248, 180, 217)",color:"rgb(252, 232, 243)"}],Y0=[{baseName:"blue",rowHeader:"rgb(63, 131, 248)",colHeader:"rgb(195, 221, 253)"},{baseName:"grey",rowHeader:"rgb(95, 101, 116)",colHeader:"rgb(227, 229, 234)"},{baseName:"red",rowHeader:"rgb(240, 82, 82)",colHeader:"rgb(251, 213, 213)"},{baseName:"orange",rowHeader:"rgb(255, 90, 31)",colHeader:"rgb(252, 217, 189)"},{baseName:"yellow",rowHeader:"rgb(212, 157, 15)",colHeader:"rgb(252, 220, 106)"},{baseName:"green",rowHeader:"rgb(13, 164, 113)",colHeader:"rgb(188, 240, 218)"},{baseName:"azure",rowHeader:"rgb(6, 148, 162)",colHeader:"rgb(175, 236, 239)"},{baseName:"indigo",rowHeader:"rgb(70, 106, 247)",colHeader:"rgb(210, 218, 250)"},{baseName:"purple",rowHeader:"rgb(144, 97, 249)",colHeader:"rgb(220, 215, 254)"},{baseName:"magenta",rowHeader:"rgb(231, 70, 148)",colHeader:"rgb(250, 209, 232)"}],Z0=[{baseName:"blue",rowHeader:"rgb(30, 66, 159)",firstRow:"rgb(195, 221, 253)",secondRow:"rgb(118, 169, 250)"},{baseName:"grey",rowHeader:"rgb(44, 48, 64)",firstRow:"rgb(227, 229, 234)",secondRow:"rgb(151, 157, 172)"},{baseName:"red",rowHeader:"rgb(155, 28, 28)",firstRow:"rgb(251, 213, 213)",secondRow:"rgb(249, 128, 128)"},{baseName:"orange",rowHeader:"rgb(180, 52, 3)",firstRow:"rgb(252, 217, 189)",secondRow:"rgb(255, 138, 76)"},{baseName:"yellow",rowHeader:"rgb(154, 109, 21)",firstRow:"rgb(252, 220, 106)",secondRow:"rgb(212, 157, 15)"},{baseName:"green",rowHeader:"rgb(4, 108, 78)",firstRow:"rgb(188, 240, 218)",secondRow:"rgb(49, 196, 141)"},{baseName:"azure",rowHeader:"rgb(3, 102, 114)",firstRow:"rgb(175, 236, 239)",secondRow:"rgb(22, 189, 202)"},{baseName:"indigo",rowHeader:"rgb(16, 51, 191)",firstRow:"rgb(210, 218, 250)",secondRow:"rgb(98, 128, 249)"},{baseName:"purple",rowHeader:"rgb(74, 29, 150)",firstRow:"rgb(220, 215, 254)",secondRow:"rgb(172, 148, 250)"},{baseName:"magenta",rowHeader:"rgb(153, 21, 75)",firstRow:"rgb(250, 209, 232)",secondRow:"rgb(241, 126, 184)"}],G0=X0.map(({baseName:e,header:t,color:n})=>j0(e,t,n)),q0=Y0.map(({baseName:e,rowHeader:t,colHeader:n})=>F0(e,t,n)),Q0=Z0.map(({baseName:e,rowHeader:t,firstRow:n,secondRow:s})=>z0(e,t,n,s)),K0=[...G0,...q0,...Q0],Pw={headerRowStyle:{bg:{rgb:"rgb(68,114,196)"},cl:{rgb:"rgb(255,255,255)"},ht:Pt.CENTER,bl:pe.TRUE},firstRowStyle:{bg:{rgb:"rgb(217,225,242)"}}},$0=new Si("default",Pw),J0=new Si("default-last-row",{...Pw,lastRowStyle:{bd:{t:{s:tt.THIN,cl:{rgb:"rgb(68,114,196)"}}},ht:Pt.CENTER,bl:pe.TRUE}});class eR{constructor(){E(this,"_toggleRanges",[])}refresh(t,n){const{startRow:s,endRow:i}=t,r=[];let o=0,a=!1,l=-1;for(let u=s;u<=i;u++){if(!n(u)){o++,o%2===1?a=!0:(a=!1,l!==-1&&(r.push([l,u-1]),l=-1));continue}o%2===1?a?l===-1&&(l=u):(a=!0,l=u):a&&(r.push([l,u-2]),a=!1,l=-1),u===i&&a&&r.push([l,u])}this._toggleRanges=r}getToggleRanges(){return this._toggleRanges.concat()}getIsToggled(t){let n=0,s=this._toggleRanges.length-1;for(;n<=s;){const i=Math.floor((n+s)/2),[r,o]=this._toggleRanges[i];if(t<r)s=i-1;else if(t>o)n=i+1;else return!0}return!1}}var tR=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Fh=(e,t)=>(n,s)=>t(n,s,e);const nR="SHEET_RANGE_THEME_MODEL_PLUGIN";let Dn=class extends ae{constructor(t,n,s){super(),E(this,"_rangeThemeStyleMap",new Map),E(this,"_rangeThemeStyleRuleMap",new Map),E(this,"_rTreeCollection",new Map),E(this,"_defaultRangeThemeMap",new Map),E(this,"_zebraCrossingCacheMap",new Map),E(this,"_rowVisibleFuncSet",new Map),E(this,"_rangeThemeMapChanged$",new Ve),E(this,"rangeThemeMapChange$",this._rangeThemeMapChanged$.asObservable()),this._sheetInterceptorService=t,this._resourceManagerService=n,this._univerInstanceService=s,this._registerIntercept(),this._initSnapshot(),this._initDefaultTheme()}_initDefaultTheme(){this.registerDefaultRangeTheme($0),this.registerDefaultRangeTheme(J0);for(const t of K0)this.registerDefaultRangeTheme(t)}_ensureRangeThemeStyleMap(t){return this._rangeThemeStyleMap.has(t)||this._rangeThemeStyleMap.set(t,new Map),this._rangeThemeStyleMap.get(t)}_ensureRangeThemeStyleRuleMap(t){return this._rangeThemeStyleRuleMap.has(t)||this._rangeThemeStyleRuleMap.set(t,new Map),this._rangeThemeStyleRuleMap.get(t)}_ensureRTreeCollection(t){return this._rTreeCollection.has(t)||this._rTreeCollection.set(t,new K_),this._rTreeCollection.get(t)}getDefaultRangeThemeStyle(t){return this._defaultRangeThemeMap.get(t)}getCustomRangeThemeStyle(t,n){return this._ensureRangeThemeStyleMap(t).get(n)}_getSheetRowVisibleFuncSet(t,n){this._rowVisibleFuncSet.has(t)||this._rowVisibleFuncSet.set(t,new Map);const s=this._rowVisibleFuncSet.get(t);return s.has(n)||s.set(n,new Set),s.get(n)}_getSheetRowVisibleHasInit(t,n){var s;return!!(this._rowVisibleFuncSet.has(t)&&(s=this._rowVisibleFuncSet.get(t))!=null&&s.has(n))}refreshSheetRowVisibleFuncSet(t,n){const s=this._getSheetRowVisibleFuncSet(t,n);s.clear();const i=this._univerInstanceService.getUnit(t);if(i){const r=i.getSheetBySheetId(n);if(r){const o=r.getRowCount(),a=r.getRowManager();for(let l=1;l<=o;l++)r.getRowVisible(l)?a.getRowHeight(l)===0&&s.add(l):s.add(l)}}}_ensureZebraCrossingCache(t,n,s){this._zebraCrossingCacheMap.has(t)||this._zebraCrossingCacheMap.set(t,new Map);const i=this._zebraCrossingCacheMap.get(t);i.has(n)||i.set(n,new Map);const r=i.get(n);return r.has(s)||r.set(s,new eR),r.get(s)}registerRangeThemeRule(t,n){const{unitId:s,subUnitId:i,range:r}=n,o=hn(),a=this._ensureRangeThemeStyleRuleMap(s),l=this._ensureRTreeCollection(s);a.set(o,{rangeInfo:n,themeName:t}),l.insert({unitId:s,sheetId:i,range:r,id:o}),this._getSheetRowVisibleHasInit(s,i)||this.refreshSheetRowVisibleFuncSet(s,i);const u=this._ensureZebraCrossingCache(s,i,o),d=this._getSheetRowVisibleFuncSet(s,i);u.refresh(r,c=>!d.has(c))}getRegisteredRangeThemeStyle(t){const{unitId:n,subUnitId:s,range:i}=t,r=this._ensureRTreeCollection(n),o=Array.from(r.bulkSearch([{unitId:n,sheetId:s,range:i}]));if(o[0]){const a=this._ensureRangeThemeStyleRuleMap(n).get(o[0]);if(a)return a.themeName}}refreshZebraCrossingCacheBySheet(t,n){this._zebraCrossingCacheMap.has(t)||this._zebraCrossingCacheMap.set(t,new Map);const s=this._zebraCrossingCacheMap.get(t);s.has(n)||s.set(n,new Map);const i=s.get(n);i&&i.forEach((r,o)=>{const a=this._ensureRangeThemeStyleRuleMap(t).get(o);a?r.refresh(a.rangeInfo.range,l=>!this._getSheetRowVisibleFuncSet(t,n).has(l)):i.delete(o)})}removeRangeThemeRule(t,n){const{unitId:s,subUnitId:i,range:r}=n,o=this._ensureRTreeCollection(s),a=Array.from(o.bulkSearch([{unitId:s,sheetId:i,range:r}])),l=this._ensureRangeThemeStyleRuleMap(s);for(let u=0;u<a.length;u++){const d=l.get(a[u]);if(d&&d.themeName===t){l.delete(a[u]),o.remove({unitId:s,sheetId:i,range:r,id:a[u]});const c=this._zebraCrossingCacheMap.get(s);if(c){const h=c.get(i);h&&h.delete(a[u])}break}}}registerDefaultRangeTheme(t){this._defaultRangeThemeMap.set(t.getName(),t),this._rangeThemeMapChanged$.next({type:"add",styleName:t.getName()})}unRegisterDefaultRangeTheme(t){this._defaultRangeThemeMap.delete(t),this._rangeThemeMapChanged$.next({type:"remove",styleName:t})}getRegisteredRangeThemes(){return Array.from(this._defaultRangeThemeMap.keys())}registerRangeThemeStyle(t,n){this._ensureRangeThemeStyleMap(t).set(n.getName(),n),this._rangeThemeMapChanged$.next({type:"add",styleName:n.getName()})}unregisterRangeThemeStyle(t,n){this._ensureRangeThemeStyleMap(t).delete(n),this._rangeThemeMapChanged$.next({type:"remove",styleName:n})}getALLRegisteredTheme(t){return Array.from(this._ensureRangeThemeStyleMap(t).keys())}getRangeThemeStyle(t,n){return this._defaultRangeThemeMap.has(n)?this._defaultRangeThemeMap.get(n):this._ensureRangeThemeStyleMap(t).get(n)}getCellStyle(t,n,s,i){const r={startRow:s,startColumn:i,endRow:s,endColumn:i},o=this._ensureRTreeCollection(t),a=Array.from(o.bulkSearch([{unitId:t,sheetId:n,range:r}]));if(a[0]){const l=this._ensureRangeThemeStyleRuleMap(t).get(a[0]);if(l){const{rangeInfo:u,themeName:d}=l,c=s-u.range.startRow,h=i-u.range.startColumn,g=this.getRangeThemeStyle(t,d),m=this._ensureZebraCrossingCache(t,n,a[0]).getIsToggled(s);if(g)return g.getStyle(c,h,s===u.range.endRow,i===u.range.endColumn,m)}}}_registerIntercept(){this.disposeWithMe(this._sheetInterceptorService.intercept(ri.CELL_CONTENT,{id:Tw,effect:Yt.Style,handler:(t,n,s)=>{const{row:i,col:r,unitId:o,subUnitId:a}=n,l=this.getCellStyle(o,a,i,r);if(l){const u=!t||t===n.rawData?{...n.rawData}:t;return u.themeStyle=l,s(u)}return s(t)}}))}toJson(t){const n=this._ensureRangeThemeStyleRuleMap(t),s=this._ensureRangeThemeStyleMap(t);if(s.size===0&&n.size===0)return"{}";const i={};n.forEach((o,a)=>{i[a]=o});const r={};return s.forEach((o,a)=>{r[a]=o.toJson()}),JSON.stringify({rangeThemeStyleRuleMap:i,rangeThemeStyleMapJson:r})}fromJSON(t,n){const{rangeThemeStyleRuleMap:s,rangeThemeStyleMapJson:i}=n;s&&Object.keys(s).forEach(r=>{const o=s[r],{themeName:a,rangeInfo:l}=o;a.startsWith("table")||(this.registerRangeThemeRule(a,l),this._ensureRTreeCollection(l.unitId).insert({unitId:r,sheetId:l.subUnitId,range:l.range,id:r}))}),i&&Object.keys(i).forEach(r=>{const o=i[r],a=new Si(o.name);a.fromJson(o),this._ensureRangeThemeStyleMap(t).set(a.getName(),a)})}deleteUnitId(t){this._rangeThemeStyleMap.delete(t),this._rangeThemeStyleRuleMap.delete(t),this._rTreeCollection.delete(t)}_initSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:t=>this.toJson(t),parseJson:t=>{if(!t)return{};try{return JSON.parse(t)}catch{return{}}},businesses:[A.UNIVER_SHEET],pluginName:nR,onLoad:(t,n)=>{this.fromJSON(t,n)},onUnLoad:t=>{this.deleteUnitId(t)}}))}dispose(){super.dispose(),this._rangeThemeStyleMap.clear(),this._rangeThemeStyleRuleMap.clear(),this._defaultRangeThemeMap.clear(),this._rTreeCollection.clear(),this._zebraCrossingCacheMap.clear(),this._rowVisibleFuncSet.clear()}};Dn=tR([Fh(0,V(_e)),Fh(1,V(lu)),Fh(2,V(P))],Dn);const Rl={id:"sheet.mutation.set-worksheet-range-theme-style",type:H.MUTATION,handler:(e,t)=>{if(!Y(e.get(P),t))return!1;const n=e.get(Dn),{unitId:s,subUnitId:i,range:r,themeName:o}=t;return n.registerRangeThemeRule(o,{range:r,unitId:s,subUnitId:i}),!0}},sR=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetRangeThemeStyleMutation]: worksheet is null error!");const{worksheet:s}=n;return{unitId:t.unitId,subUnitId:s.getSheetId(),range:t.range,themeName:t.themeName}},yl={id:"sheet.mutation.remove-worksheet-range-theme-style",type:H.MUTATION,handler:(e,t)=>{if(!Y(e.get(P),t))return!1;const n=e.get(Dn),{unitId:s,subUnitId:i,range:r,themeName:o}=t;return n.removeRangeThemeRule(o,{range:r,unitId:s,subUnitId:i}),!0}},iR=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[DeleteWorksheetRangeThemeStyleMutationFactory]: worksheet is null error!");const{worksheet:s}=n;return{unitId:t.unitId,subUnitId:s.getSheetId(),range:t.range,themeName:t.themeName}},sp=(e,t)=>{if(!sn(e.get(P),t))throw new Error("Workbook or Worksheet not found at InsertRowMutationUndoFactory");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},rn={id:"sheet.mutation.insert-row",type:H.MUTATION,handler:(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("Workbook or Worksheet not found at InsertRowMutation");const{worksheet:s}=n,i=s.getRowManager(),{range:r,rowInfo:o}=t,{startRow:a,endRow:l}=r;i.insertRowsWithData(a,l,o);const u=l-a+1;return s.setRowCount(s.getRowCount()+u),s.getCellMatrix().insertRows(a,u),!0}},Qc=(e,t)=>{if(!sn(e.get(P),t))throw new Error("Workbook or Worksheet not found at InsertColMutationUndoFactory");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},on={id:"sheet.mutation.insert-col",type:H.MUTATION,handler:(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("Workbook or Worksheet not found at InsertColMutation");const{worksheet:s}=n,i=s.getColumnManager(),{range:r,colInfo:o}=t,{startColumn:a,endColumn:l}=r;i.insertColumnsWithData(a,l,o);const u=l-a+1;return s.setColumnCount(s.getColumnCount()+u),s.getCellMatrix().insertColumns(r.startColumn,u),!0}},Mn={id:"sheet.mutation.move-range",type:H.MUTATION,handler:(e,t)=>{const{from:n,to:s}=t;if(!n||!s)return!1;const i=e.get(P).getCurrentUnitForType(A.UNIVER_SHEET);if(!i)return!1;const r=i.getSheetBySheetId(t.from.subUnitId),o=i.getSheetBySheetId(t.to.subUnitId);if(!r||!o)return!1;const a=r.getCellMatrix(),l=o.getCellMatrix();return new de(n.value).forValue((u,d,c)=>{c==null?a.realDeleteValue(u,d):a.setValue(u,d,c)}),new de(s.value).forValue((u,d,c)=>{c==null?l.realDeleteValue(u,d):l.setValue(u,d,c)}),!0}};function rR(e,t){const{unitId:n,subUnitId:s,sourceRange:i,targetRange:r}=t,o=i.startRow>r.startRow,a=i.endRow-i.startRow+1;return o?{unitId:n,subUnitId:s,sourceRange:z.clone(r),targetRange:{...i,endRow:i.endRow+a,startRow:i.startRow+a}}:{unitId:n,subUnitId:s,targetRange:z.clone(i),sourceRange:{...r,endRow:r.endRow-a,startRow:r.startRow-a}}}const Wn={id:"sheet.mutation.move-rows",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,sourceRange:i,targetRange:r}=t,o=e.get(P).getUniverSheetInstance(n);if(!o)throw new Error("[MoveRowMutation] univerSheet is null!");const a=o.getSheetBySheetId(s);if(!a)throw new Error("[MoveRowMutation] worksheet is null!");const l=i.startRow,u=i.endRow-i.startRow+1,d=r.startRow,c=a.getRowManager().getRowData();return qC(l,u,d,c),a.getCellMatrix().moveRows(l,u,d),!0}};function oR(e,t){const{unitId:n,subUnitId:s,sourceRange:i,targetRange:r}=t,o=i.startColumn>r.startColumn,a=i.endColumn-i.startColumn+1;return o?{unitId:n,subUnitId:s,sourceRange:z.clone(r),targetRange:{...i,endColumn:i.endColumn+a,startColumn:i.startColumn+a}}:{unitId:n,subUnitId:s,targetRange:z.clone(i),sourceRange:{...r,startColumn:r.startColumn-a,endColumn:r.endColumn-a}}}const Ln={id:"sheet.mutation.move-columns",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,sourceRange:i,targetRange:r}=t,o=e.get(P).getUniverSheetInstance(n);if(!o)throw new Error("[MoveColumnMutation] univerSheet is null!");const a=o.getSheetBySheetId(s);if(!a)throw new Error("[MoveColumnMutation] worksheet is null!");const l=i.startColumn,u=i.endColumn-i.startColumn+1,d=r.startColumn,c=a.getColumnManager().getColumnData();return qC(l,u,d,c),a.getCellMatrix().moveColumns(l,u,d),!0}},aR=(e,t)=>{const n=t.getRowManager().getRowData(),s={},i=e.range,r=ow(i.startRow,i.endRow,n),o=aw(s,r);return{unitId:e.unitId,subUnitId:e.subUnitId,range:e.range,rowInfo:o}},an={id:"sheet.mutation.remove-rows",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId);if(!s)return!1;const i=t.range,r=s.getRowManager().getRowData();for(let a=i.startRow;a<=i.endRow;a++)s.getRowFiltered(a);const o=i.endRow-i.startRow+1;return QC(i.startRow,o,r),s.getCellMatrix().removeRows(i.startRow,o),s.setRowCount(s.getRowCount()-o),!0}},lR=(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId);if(s==null)throw new Error("worksheet is null error!");const i=s.getColumnManager().getColumnData(),r={},o=t.range,a=ow(o.startColumn,o.endColumn,i),l=aw(r,a);return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,colInfo:l}},$t={id:"sheet.mutation.remove-col",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId);if(!s)return!1;const i=t.range,r=s.getColumnManager().getColumnData(),o=i.endColumn-i.startColumn+1;return QC(i.startColumn,o,r),s.setColumnCount(s.getColumnCount()-o),s.getCellMatrix().removeColumns(i.startColumn,o),!0}},pn=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("Workbook or worksheet is null error!");const{worksheet:s}=n,i=s.getConfig().mergeData,r=t.ranges,o=[];for(let a=0;a<r.length;a++)for(let l=i.length-1;l>=0;l--){const u=i[l],d=r[a];z.intersects(u,d)&&o.push(i[l])}return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:o}},et={id:"sheet.mutation.remove-worksheet-merge",type:H.MUTATION,handler:(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("Workbook or worksheet is null error!");const{worksheet:s}=n,i=s.getConfig().mergeData,r=t.ranges;for(let o=0;o<r.length;o++)for(let a=i.length-1;a>=0;a--){const l=i[a],u=r[o];z.intersects(l,u)&&i.splice(a,1)}return s.getSpanModel().rebuild(i),!0}},uR=e=>{const{order:t}=e,n={};return Object.keys(t).forEach(s=>{n[t[Number(s)]]=Number(s)}),{...e,order:n}},yd={id:"sheet.mutation.reorder-range",type:H.MUTATION,handler:(e,t)=>{const{subUnitId:n,unitId:s,range:i,order:r}=t,o=e.get(P).getUnit(s).getSheetBySheetId(n);if(!o)return!1;const a=new de;De.foreach(i,(u,d)=>{if(r.hasOwnProperty(u)){const c=r[u],h=Q.deepClone(o.getCellRaw(c,d));a.setValue(u,d,h)}});const l=o.getCellMatrix();return a.forValue((u,d,c)=>{l.setValue(u,d,c)}),!0}};function dR(e,t){if(e==null)return e;const n=Q.deepClone(e);if(t==null)return n;const s={};return"h"in t&&(s.h=n.h),"ia"in t&&(s.ia=n.ia),"ah"in t&&(s.ah=n.ah),"hd"in t&&(s.hd=n.hd),"s"in t&&(s.s=n.s),"custom"in t&&(s.custom=n.custom),s}function cR(e,t){if(e==null)return e;const n=Q.deepClone(e);if(t==null)return n;const s={};return"w"in t&&(s.w=n.w),"hd"in t&&(s.hd=n.hd),"s"in t&&(s.s=n.s),"custom"in t&&(s.custom=n.custom),s}const hR=(e,t)=>{const{unitId:n,subUnitId:s,columnData:i}=e,r={},o=t.getColumnManager();for(const a in i){const l=i[a],u=o.getColumn(Number(a));r[a]=cR(u,l)}return{unitId:n,subUnitId:s,columnData:r}},ol={id:"sheet.mutation.set-col-data",type:H.MUTATION,handler:(e,t)=>{const{columnData:n}=t,s=e.get(P),i=Y(s,t);if(!i)return!1;const{worksheet:r}=i,o=r.getColumnManager();for(const a in n){const l=n[a];if(l==null){o.removeColumn(Number(a));continue}const u=o.getColumnOrCreate(Number(a));Object.assign(u,l)}return!0}},gR=(e,t)=>{if(e.get(P).getUniverSheetInstance(t.unitId)==null)throw new Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},Ur={id:"sheet.mutation.set-col-hidden",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getSheetBySheetId(t.subUnitId).getColumnManager();for(let i=0;i<t.ranges.length;i++){const r=t.ranges[i];for(let o=r.startColumn;o<r.endColumn+1;o++){const a=s.getColumnOrCreate(o);a!=null&&(a.hd=pe.TRUE)}}return!0}},mR=(e,t)=>{if(e.get(P).getUniverSheetInstance(t.unitId)==null)throw new Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},Nr={id:"sheet.mutation.set-col-visible",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getSheetBySheetId(t.subUnitId).getColumnManager();for(let i=0;i<t.ranges.length;i++){const r=t.ranges[i];for(let o=r.startColumn;o<r.endColumn+1;o++){const a=s.getColumnOrCreate(o);a!=null&&(a.hd=pe.FALSE)}}return!0}},al={id:"sheet.mutation.set-gridlines-color",type:H.MUTATION,handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{worksheet:s}=n,i=s.getConfig();return i.gridlinesColor=t.color,!0}};function pR(e,t,n){var s;const i=e.getStyleByCell(t);i==null&&delete t.s,typeof n.s=="string"&&(n.s=e.get(n.s));const r=sd(i,n.s?n.s:null);r&&(Q.removeNull(r),Object.entries(r).forEach(([a,l])=>{typeof l=="object"&&l!==null&&Object.keys(l).length===0&&delete r[a]})),Q.isEmptyObject(r)?delete t.s:t.s=e.setValue(r);const o=n.v?`${n.v}\r
`:"";!n.p&&t.p&&(o&&o!==((s=t.p.body)==null?void 0:s.dataStream)?delete t.p:CR(t.p,n.s?n.s:null))}function fR(e,t){if(!t||!Object.keys(t).length)return e;const n=Q.deepClone(e??{});for(const s in t)s==="bd"?n[s]=vR(n[s]||{},t[s]):s in n||(n[s]=null);return n}function vR(e,t){if(!t||!Object.keys(t).length)return e;for(const n in t)n in e||(e[n]=null);return e}function sd(e,t,n=!1){if(t===null)return t;if(t===void 0)return e;const s=Q.deepClone(e)||{};for(const i in t)n&&["bd","tr","td","ht","vt","tb","pd","bg"].includes(i)||(i in s&&i==="bd"?s[i]=Object.assign(s[i],t[i]):s[i]=t[i]);return"cl"in s&&("ul"in s&&s.ul&&(s.ul.cl=s.cl),"ol"in s&&s.ol&&(s.ol.cl=s.cl),"st"in s&&s.st&&(s.st.cl=s.cl)),s}function Uw(e,t){return e.some(n=>n.startIndex===t)?Uw(e,t+1):t}function CR(e,t){var n;if(e.body==null)return;Array.isArray(e.body.textRuns)||(e.body.textRuns=[]);let s=0;const i=[],r=((n=e.body)==null?void 0:n.paragraphs)||[];for(const a of e.body.textRuns){const{st:l,ed:u,ts:d={}}=a;if(s<l){const h={st:s,ed:l},g=sd({},t,!0);g&&Q.removeNull(g),Q.isEmptyObject(g)||(h.ts=g),i.push(h)}const c=sd(d,t,!0);c&&Q.removeNull(c),Q.isEmptyObject(c)?delete a.ts:a.ts=c,i.push(a),s=Uw(r,u)}const o=e.body.dataStream.endsWith(`\r
`)?e.body.dataStream.length-2:e.body.dataStream.length;if(s<o){const a={st:s,ed:o},l=sd({},t,!0);l&&Q.removeNull(l),Q.isEmptyObject(l)||(a.ts=l),i.push(a)}e.body.textRuns=aI(i)}function hv(e,t){return t.v===void 0||t.v===null?t.v:e===je.NUMBER?Number(t.v):e===je.BOOLEAN?wR(t.v)?1:0:e===je.STRING||e===je.FORCE_STRING?`${t.v}`:t.v}function wR(e){if(typeof e=="string"){if(e.toUpperCase()==="TRUE")return!0;if(e.toUpperCase()==="FALSE")return!1;if(oI(e)){if(Number(e)===0)return!1;if(Number(e)===1)return!0}}if(typeof e=="number"){if(e===0)return!1;if(e===1)return!0}return typeof e=="boolean"?e:null}function SR(e){return e==null?null:(e.f===void 0&&(e.f=null),e.si===void 0&&(e.si=null),e.p===void 0&&(e.p=null),e.v===void 0&&(e.v=null),e.t===void 0&&(e.t=null),e.s===void 0&&(e.s=null),e.custom===void 0&&(e.custom=null),e)}const Vt=(e,t)=>{const{unitId:n,subUnitId:s,cellValue:i}=t,r=e.get(P).getUniverSheetInstance(n);if(r==null)throw new Error("workbook is null error!");const o=r.getSheetBySheetId(s);if(o==null)throw new Error("worksheet is null error!");const a=o.getCellMatrix(),l=r.getStyles(),u=new de;return new de(i).forValue((d,c,h)=>{const g=Q.deepClone(a?.getValue(d,c))||{},m=l.getStyleByCell(g),p=l.getStyleByCell(h);g.s=fR(m,p),u.setValue(d,c,SR(g))}),{...t,options:{},cellValue:u.getMatrix()}},le={id:"sheet.mutation.set-range-values",type:H.MUTATION,handler:(e,t)=>{const{cellValue:n,subUnitId:s,unitId:i}=t,r=e.get(P).getUnit(i);if(!r)return!1;const o=r.getSheetBySheetId(s);if(!o)return!1;const a=o.getCellMatrix(),l=r.getStyles();return new de(n).forValue((u,d,c)=>{if(!c)a.realDeleteValue(u,d);else{let h=a.getValue(u,d)||{};h=_R(c,h,l),Q.isEmptyObject(h)?a.realDeleteValue(u,d):a.setValue(u,d,h)}}),!0}},bR=new Set(["f","p","si","custom","ref","xf"]);function _R(e,t,n){const s=O0(n,e,t);return Object.keys(e).forEach(i=>{const r=i;if(bR.has(r)){const o=e[r];IR(t,r,o)}else r==="v"?e.v!==void 0&&(t.v=hv(s,e)):r==="s"&&pR(n,t,e)}),t.v!==void 0&&(t.t=s,t.v=hv(s,t)),t.v===null&&(delete t.t,delete t.v),t}function IR(e,t,n){n===void 0||(n===null?delete e[t]:e[t]=n)}const RR=(e,t)=>{const{unitId:n,subUnitId:s,rowData:i}=e,r={},o=t.getRowManager();for(const a in i){const l=i[a],u=o.getRow(Number(a));r[a]=dR(u,l)}return{unitId:n,subUnitId:s,rowData:r}},ll={id:"sheet.mutation.set-row-data",type:H.MUTATION,handler:(e,t)=>{const{rowData:n}=t,s=e.get(P),i=Y(s,t);if(!i)return!1;const{worksheet:r}=i,o=r.getRowManager();for(const a in n){const l=n[a];if(l==null){o.removeRow(Number(a));continue}const u=o.getRowOrCreate(Number(a));Object.assign(u,l)}return!0}},yR=(e,t)=>{if(e.get(P).getUniverSheetInstance(t.unitId)==null)throw new Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},Xi={id:"sheet.mutation.set-row-visible",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId).getRowManager();for(let i=0;i<t.ranges.length;i++){const r=t.ranges[i];for(let o=r.startRow;o<r.endRow+1;o++){const a=s.getRowOrCreate(o);a!=null&&(a.hd=0)}}return!0}},MR=(e,t)=>{if(e.get(P).getUniverSheetInstance(t.unitId)==null)throw new Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},Yi={id:"sheet.mutation.set-row-hidden",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId).getRowManager();for(let i=0;i<t.ranges.length;i++){const r=t.ranges[i];for(let o=r.startRow;o<r.endRow+1;o++){const a=s.getRowOrCreate(o);a!=null&&(a.hd=1)}}return!0}},ip=(e,t)=>{const{unitId:n,subUnitId:s,ranges:i}=e,r={},o=t.getColumnManager();for(let a=0;a<i.length;a++){const l=i[a];for(let u=l.startColumn;u<l.endColumn+1;u++)r[u]=o.getColumnWidth(u)}return{unitId:n,subUnitId:s,ranges:i,colWidth:r}},Cn={id:"sheet.mutation.set-worksheet-col-width",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P),s=Y(n,t);if(!s)return!1;const{worksheet:i}=s,r=i.getColumnManager(),o=t.ranges;for(let a=0;a<o.length;a++){const l=o[a];for(let u=l.startColumn;u<l.endColumn+1;u++)i.getColVisible(u)&&(typeof t.colWidth=="number"?r.setColumnWidth(u,t.colWidth):Q.isDefine(t.colWidth[u])&&r.setColumnWidth(u,t.colWidth[u]))}return!0}},ER=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetColumnCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,columnCount:n.worksheet.getColumnCount()}},ul={id:"sheet.mutation.set-worksheet-column-count",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P),s=sn(n,t);return s?(s.worksheet.setColumnCount(t.columnCount),!0):!1}},Po={id:"sheet.mutation.set-worksheet-default-style",type:H.MUTATION,handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{worksheet:s}=n,{defaultStyle:i}=t;return s.setDefaultCellStyle(i),!0}},xR=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetDefaultStyleMutationFactory]: worksheet is null error!");const{worksheet:s}=n;return{unitId:t.unitId,subUnitId:s.getSheetId(),defaultStyle:s.getDefaultCellStyle()}},kR=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetRowCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,rowCount:n.worksheet.getRowCount()}},dl={id:"sheet.mutation.set-worksheet-row-count",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P),s=sn(n,t);return s?(s.worksheet.setRowCount(t.rowCount),!0):!1}},Nw=(e,t)=>{var n,s;const{unitId:i,subUnitId:r,ranges:o}=e,a={},l=t.getRowManager();for(const{startRow:u,endRow:d}of o)for(let c=u;c<d+1;c++)a[c]=(s=(n=l.getRow(c))==null?void 0:n.h)!=null?s:t.getConfig().defaultRowHeight;return{unitId:i,subUnitId:r,ranges:o,rowHeight:a}},rp=(e,t)=>{var n;const{unitId:s,subUnitId:i,ranges:r}=e,o={},a=t.getRowManager();for(const{startRow:l,endRow:u}of r)for(let d=l;d<=u;d++)o[d]=(n=a.getRow(d))==null?void 0:n.ia;return{unitId:s,subUnitId:i,ranges:r,autoHeightInfo:o}},op=(e,t)=>{var n,s;const{unitId:i,subUnitId:r,rowsAutoHeightInfo:o}=e,a=[],l=t.getRowManager();for(const u of o){const{row:d}=u;a.push({row:d,autoHeight:(s=(n=l.getRow(d))==null?void 0:n.ah)!=null?s:t.getConfig().defaultRowHeight})}return{unitId:i,subUnitId:r,rowsAutoHeightInfo:a}},os={id:"sheet.mutation.set-worksheet-row-height",type:H.MUTATION,handler:(e,t)=>{const{ranges:n,rowHeight:s}=t,i=e.get(P),r=Y(i,t);if(!r)return!1;const{worksheet:o}=r,a=o.getRowManager();for(const{startRow:l,endRow:u}of n)for(let d=l;d<=u;d++)typeof s=="number"?a.setRowHeight(d,s):Q.isDefine(s[d])&&a.setRowHeight(d,s[d]);return!0}},qn={id:"sheet.mutation.set-worksheet-row-is-auto-height",type:H.MUTATION,handler:(e,t)=>{var n;const{ranges:s,autoHeightInfo:i}=t,r=e.get(P),o=Y(r,t);if(!o)return!1;const a=o.worksheet.getRowManager();for(const{startRow:l,endRow:u}of s)for(let d=l;d<=u;d++){const c=a.getRowOrCreate(d);typeof i=="number"?c.ia=i:c.ia=(n=i[d])!=null?n:void 0}return!0}},ds={id:"sheet.mutation.set-worksheet-row-auto-height",type:H.MUTATION,handler:(e,t)=>{const{rowsAutoHeightInfo:n}=t,s=e.get(P),i=Y(s,t);if(!i)return!1;const r=i.worksheet.getRowManager();for(const{row:o,autoHeight:a}of n){const l=r.getRowOrCreate(o);l.ah=a}return!0}},Uo={id:"sheet.mutation.toggle-gridlines",type:H.MUTATION,handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{worksheet:s}=n,i=s.getConfig();return i.showGridlines=t.showGridlines,!0}},lt={id:"sheet.operation.set-worksheet-active",type:H.OPERATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getWorksheets();for(const[,i]of s)if(i.getSheetId()===t.subUnitId)return n.setActiveSheet(i),!0;return!1}};var Ow=(e=>(e.SET_WORKSHEET_ROW_HEIGHT="sheet.mutation.set-worksheet-row-height",e.SET_WORKSHEET_ROW_IS_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-is-auto-height",e.SET_WORKSHEET_ROW_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-auto-height",e.SET_WORKSHEET_COL_WIDTH="sheet.mutation.set-worksheet-col-width",e.SET_WORKSHEET_ACTIVE="sheet.operation.set-worksheet-active",e.MOVE_ROWS="sheet.mutation.move-rows",e.MOVE_COLUMNS="sheet.mutation.move-columns",e.SET_COL_HIDDEN="sheet.mutation.set-col-hidden",e.SET_COL_VISIBLE="sheet.mutation.set-col-visible",e.SET_ROW_HIDDEN="sheet.mutation.set-row-hidden",e.SET_ROW_VISIBLE="sheet.mutation.set-row-visible",e.INSERT_COL="sheet.mutation.insert-col",e.INSERT_ROW="sheet.mutation.insert-row",e.REMOVE_COL="sheet.mutation.remove-col",e.REMOVE_ROW="sheet.mutation.remove-rows",e.TOGGLE_GRIDLINES="sheet.mutation.toggle-gridlines",e.SET_GRIDLINES_COLOR="sheet.mutation.set-gridlines-color",e))(Ow||{}),Aw=(e=>(e.SET_RANGE_VALUES="sheet.mutation.set-range-values",e.MOVE_RANGE="sheet.mutation.move-range",e.REMOVE_WORKSHEET_MERGE="sheet.mutation.remove-worksheet-merge",e.ADD_WORKSHEET_MERGE="sheet.mutation.add-worksheet-merge",e.REORDER_RANGE="sheet.mutation.reorder-range",e.SET_WORKSHEET_DEFAULT_STYLE="sheet.mutation.set-worksheet-default-style",e.SET_ROW_DATA="sheet.mutation.set-row-data",e.SET_COL_DATA="sheet.mutation.set-col-data",e.SET_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.set-worksheet-range-theme-style",e.DELETE_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.delete-worksheet-range-theme-style",e))(Aw||{});const ap=[os.id,qn.id,ds.id,Cn.id,lt.id,Wn.id,Ln.id,Ur.id,Nr.id,Yi.id,Xi.id,on.id,rn.id,$t.id,an.id,Uo.id,al.id,dl.id,ul.id],Vw=[le.id,Mn.id,et.id,qe.id,yd.id,Po.id,ll.id,ol.id,Rl.id,yl.id];function TR(e,t){switch(t.id){case"sheet.mutation.set-range-values":{const n=t.params,s=new de(n.cellValue).getDataRange();return s.endRow===-1?[]:n.cellValue?[{unitId:n.unitId,subUnitId:n.subUnitId,range:s}]:[]}case"sheet.mutation.move-range":{const n=t.params;return[{unitId:n.unitId,subUnitId:n.from.subUnitId,range:new de(n.from.value).getRange()},{unitId:n.unitId,subUnitId:n.to.subUnitId,range:new de(n.to.value).getRange()}]}case"sheet.mutation.remove-worksheet-merge":{const n=t.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:s}))}case"sheet.mutation.add-worksheet-merge":{const n=t.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:s}))}case"sheet.mutation.reorder-range":{const n=t.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:n.range}]}case"sheet.mutation.set-worksheet-default-style":{const n=Y(e,t.params);if(!n)return[];const{worksheet:s,unitId:i,subUnitId:r}=n;return[{unitId:i,subUnitId:r,range:{startRow:0,endRow:s.getRowCount()-1,startColumn:0,endColumn:s.getColumnCount()-1}}]}case"sheet.mutation.set-row-data":{const n=Y(e,t.params);if(!n)return[];const{worksheet:s,unitId:i,subUnitId:r}=n,{rowData:o}=t.params,a=Object.keys(o).map(Number);return a.length===0?[]:[{unitId:i,subUnitId:r,range:{startRow:Math.min(...a),endRow:Math.max(...a),startColumn:0,endColumn:s.getColumnCount()-1}}]}case"sheet.mutation.set-col-data":{const n=Y(e,t.params);if(!n)return[];const{worksheet:s,unitId:i,subUnitId:r}=n,{columnData:o}=t.params,a=Object.keys(o).map(Number);return a.length===0?[]:[{unitId:i,subUnitId:r,range:{startRow:0,endRow:s.getRowCount()-1,startColumn:Math.min(...a),endColumn:Math.max(...a)}}]}case"sheet.mutation.set-worksheet-range-theme-style":case"sheet.mutation.delete-worksheet-range-theme-style":{const n=t.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:n.range}]}default:return[]}}function M6(e,t){switch(e.id){case"sheet.mutation.set-worksheet-row-height":case"sheet.mutation.set-worksheet-row-is-auto-height":{const n=e.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:{...s,rangeType:j.ROW}}))}case"sheet.mutation.set-worksheet-row-auto-height":{const n=e.params;return n.rowsAutoHeightInfo.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:{startRow:s.row,endRow:s.row,startColumn:0,endColumn:t-1,rangeType:j.ROW}}))}case"sheet.mutation.set-worksheet-col-width":{const n=e.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:{...s,rangeType:j.COLUMN}}))}case"sheet.mutation.move-rows":case"sheet.mutation.move-columns":{const n=e.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:n.targetRange},{unitId:n.unitId,subUnitId:n.subUnitId,range:n.sourceRange}]}case"sheet.mutation.set-col-hidden":case"sheet.mutation.set-col-visible":{const n=e.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:{...s,rangeType:j.COLUMN}}))}case"sheet.mutation.set-row-hidden":case"sheet.mutation.set-row-visible":{const n=e.params;return n.ranges.map(s=>({unitId:n.unitId,subUnitId:n.subUnitId,range:{...s,rangeType:j.ROW}}))}case"sheet.mutation.insert-col":{const n=e.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:{...n.range,rangeType:j.COLUMN}}]}case"sheet.mutation.insert-row":{const n=e.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:{...n.range,rangeType:j.ROW}}]}case"sheet.mutation.remove-col":{const n=e.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:{...n.range,rangeType:j.COLUMN}}]}case"sheet.mutation.remove-rows":{const n=e.params;return[{unitId:n.unitId,subUnitId:n.subUnitId,range:{...n.range,rangeType:j.ROW}}]}case"sheet.mutation.toggle-gridlines":case"sheet.mutation.set-gridlines-color":return[];default:return[]}}function gv(e){return e==null?!1:e.v!==void 0&&e.v!==null&&e.v!==""||e.p!==void 0}function Wi(e,t){return e&&e.spanAnchor?gv(t.getValue(e.spanAnchor.startRow,e.spanAnchor.startColumn)):gv(e)}function PR(e,t,n,s,i){const r=e.getCellMatrix(),o=e.getSpanModel().getMergedCellRange(t,n,s,i),a=new de;return r.forValue((l,u)=>{const d=r.getValue(l,u);d&&a.setValue(l,u,d)}),o.forEach(l=>{const{startColumn:u,startRow:d,endColumn:c,endRow:h}=l;rI(d,h,u,c).forEach((g,m)=>{g===d&&m===u&&a.setValue(g,m,{...r.getValue(g,m),spanAnchor:{startRow:d,endRow:h,startColumn:u,endColumn:c}}),(g!==d||m!==u)&&(a.realDeleteValue(g,m),a.setValue(g,m,{spanAnchor:{startRow:d,endRow:h,startColumn:u,endColumn:c}}))})}),a}function UR(e,t,n,s){const{startRow:i,startColumn:r,endRow:o}=e;let a=null,l=!1;for(let u=i;u<=o;u++){const d=t.getValue(u,r-n);if(l=l||Wi(d,t),!s&&l)break;d&&d.spanAnchor&&(a?a={startRow:Math.min(d.spanAnchor.startRow,a.startRow),startColumn:Math.min(d.spanAnchor.startColumn,a.startColumn),endRow:Math.max(d.spanAnchor.endRow,a.endRow),endColumn:Math.max(d.spanAnchor.endColumn,a.endColumn)}:a={startRow:d.spanAnchor.startRow,startColumn:d.spanAnchor.startColumn,endRow:d.spanAnchor.endRow,endColumn:d.spanAnchor.endColumn})}return l?(e.startColumn=e.startColumn-n,{spanAnchor:a,hasValue:!0,range:e}):a?{spanAnchor:z.simpleRangesIntersect(e,a)?a:null,hasValue:!1,range:e}:{spanAnchor:null,hasValue:!1,range:e}}function NR(e,t,n,s){const{startRow:i,endColumn:r,endRow:o}=e;let a=null,l=!1;for(let u=i;u<=o;u++){const d=t.getValue(u,r+n);if(l=l||Wi(d,t),!s&&l)break;d&&d.spanAnchor&&(a?a={startRow:Math.min(d.spanAnchor.startRow,a.startRow),startColumn:Math.min(d.spanAnchor.startColumn,a.startColumn),endRow:Math.max(d.spanAnchor.endRow,a.endRow),endColumn:Math.max(d.spanAnchor.endColumn,a.endColumn)}:a={startRow:d.spanAnchor.startRow,startColumn:d.spanAnchor.startColumn,endRow:d.spanAnchor.endRow,endColumn:d.spanAnchor.endColumn})}return l?(e.endColumn=e.endColumn+n,{spanAnchor:a,hasValue:!0,range:e}):a?{spanAnchor:z.simpleRangesIntersect(e,a)?a:null,hasValue:!1,range:e}:{spanAnchor:null,hasValue:!1,range:e}}function OR(e,t,n,s){const{startRow:i,startColumn:r,endColumn:o}=e;let a=null,l=!1;for(let u=r;u<=o;u++){const d=t.getValue(i-n,u);if(l=l||Wi(d,t),!s&&l)break;d&&d.spanAnchor&&(a?a={startRow:Math.min(d.spanAnchor.startRow,a.startRow),startColumn:Math.min(d.spanAnchor.startColumn,a.startColumn),endRow:Math.max(d.spanAnchor.endRow,a.endRow),endColumn:Math.max(d.spanAnchor.endColumn,a.endColumn)}:a={startRow:d.spanAnchor.startRow,startColumn:d.spanAnchor.startColumn,endRow:d.spanAnchor.endRow,endColumn:d.spanAnchor.endColumn})}return l?(e.startRow=e.startRow-n,{spanAnchor:a,hasValue:!0,range:e}):a?{spanAnchor:z.simpleRangesIntersect(e,a)?a:null,hasValue:!1,range:e}:{spanAnchor:null,hasValue:!1,range:e}}function AR(e,t,n,s){const{startColumn:i,endColumn:r,endRow:o}=e;let a=null,l=!1;for(let u=i;u<=r;u++){const d=t.getValue(o+n,u);if(l=l||Wi(d,t),!s&&l)break;d&&d.spanAnchor&&(a?a={startRow:Math.min(d.spanAnchor.startRow,a.startRow),startColumn:Math.min(d.spanAnchor.startColumn,a.startColumn),endRow:Math.max(d.spanAnchor.endRow,a.endRow),endColumn:Math.max(d.spanAnchor.endColumn,a.endColumn)}:a={startRow:d.spanAnchor.startRow,startColumn:d.spanAnchor.startColumn,endRow:d.spanAnchor.endRow,endColumn:d.spanAnchor.endColumn})}return l?(e.endRow=e.endRow+n,{spanAnchor:a,hasValue:!0,range:e}):a?{spanAnchor:z.simpleRangesIntersect(e,a)?a:null,hasValue:!1,range:e}:{spanAnchor:null,hasValue:!1,range:e}}function VR({range:e,allMatrixWithSpan:t,directions:n,isWorksheetHasSpan:s,maxRow:i,maxColumn:r}){const{left:o,right:a,up:l,down:u}=n,{startRow:d,startColumn:c,endRow:h,endColumn:g}=e;let m=!1;if(o&&l&&d>0&&c>0){const p=t.getValue(d-1,c-1);Wi(p,t)&&(s&&p.spanAnchor?(e.startRow=p.spanAnchor.startRow,e.startColumn=p.spanAnchor.startColumn):(e.startRow=d-1,e.startColumn=c-1),m=!0)}if(a&&l&&d>0&&g<r-1){const p=t.getValue(d-1,g+1);Wi(p,t)&&(s&&p.spanAnchor?(e.startRow=p.spanAnchor.startRow,e.endColumn=p.spanAnchor.endColumn):(e.startRow=d-1,e.endColumn=g+1),m=!0)}if(o&&u&&h<i-1&&c>0){const p=t.getValue(h+1,c-1);Wi(p,t)&&(s&&p.spanAnchor?(e.endRow=p.spanAnchor.endRow,e.startColumn=p.spanAnchor.startColumn):(e.endRow=h+1,e.startColumn=c-1),m=!0)}if(a&&u&&h<i-1&&g<r-1){const p=t.getValue(h+1,g+1);Wi(p,t)&&(s&&p.spanAnchor?(e.endRow=p.spanAnchor.endRow,e.endColumn=p.spanAnchor.endColumn):(e.endRow=h+1,e.endColumn=g+1),m=!0)}return{hasValue:m,range:e}}function HR(e,t,n){const s=n.getMaxRows(),i=n.getMaxColumns(),r=PR(n,0,0,s-1,i-1),o=n.getSnapshot().mergeData.length>0,{left:a,right:l,up:u,down:d}=t;let c=!0,h={...e};const g=[];for(;c;){c=!1;const m=VR({range:h,allMatrixWithSpan:r,directions:t,isWorksheetHasSpan:o,maxRow:s,maxColumn:i});if(m.hasValue){h=m.range,c=!0;continue}if(u&&h.startRow!==0){const{hasValue:p,range:f,spanAnchor:v}=OR(h,r,1,o);if(v&&g.push(v),p){h=f,c=!0;continue}}if(d&&h.endRow!==s-1){const{hasValue:p,range:f,spanAnchor:v}=AR(h,r,1,o);if(v&&g.push(v),p){h=f,c=!0;continue}}if(a&&h.startColumn!==0){const{hasValue:p,range:f,spanAnchor:v}=UR(h,r,1,o);if(v&&g.push(v),p){h=f,c=!0;continue}}if(l&&h.endColumn!==i-1){const{hasValue:p,range:f,spanAnchor:v}=NR(h,r,1,o);if(v&&g.push(v),p){h=f,c=!0;continue}}}return g.length>0&&(h=z.union(h,...g)),h}const DR=e=>{const t=new de;return e.forEach(n=>{De.foreach(n,(s,i)=>{t.setValue(s,i,1)})}),t.forValue((n,s)=>{const i=t.getValue(n-1,s);i&&t.setValue(n,s,i+1)}),t},WR=e=>{const t=e;return t.forValue((n,s)=>{const i=e.getValue(n-1,s);i&&t.setValue(n,s,i+1)}),t},mv=e=>{const t={area:0},n=(s,i)=>t.area<s?(t.area=s,t.range=i,!0):!1;return e.forValue((s,i,r)=>{let o=1,a=r;n(o*a,{startRow:s-a+1,endRow:s,startColumn:i,endColumn:i});const l={startRow:s-a+1,endRow:s,startColumn:0,endColumn:i};for(let u=i-1;u>=0&&e.getValue(s,u);u--){a=Math.min(e.getValue(s,u)||0,a),o++;const d=a*o;l.startColumn=u,l.startRow=s-a+1,n(d,l)}}),t},LR=(e,t)=>{De.foreach(t,(n,s)=>{e.realDeleteValue(n,s)});for(let n=t.startColumn;n<=t.endColumn;n++){const s=t.endRow+1;if(e.getValue(s,n)>0){e.setValue(s,n,1);let i=s+1;for(;e.getValue(i,n)>0;)e.setValue(i,n,e.getValue(i-1,n)+1),i++}}return e},Hw=e=>{const t=[];let n=mv(e);for(;n.area>0;)n.range&&(t.push(n.range),LR(e,n.range)),n=mv(e);return t},Dw=e=>{const t=DR(e);return Hw(t)};let E6=class{constructor(){E(this,"_matrix",new de)}add(...t){return t.forEach(n=>{De.foreach(n,(s,i)=>{this._matrix.setValue(s,i,1)})}),this}subtract(...t){return t.forEach(n=>{De.foreach(n,(s,i)=>{this._matrix.realDeleteValue(s,i)})}),this}merge(){const t=WR(this._matrix);return Hw(t)}};const Md=1.5,Hu="rgba(255, 255, 255, 0.01)";function Ww(e){const{rangeWithCoord:t,primaryWithCoord:n,style:s}=e,i={range:{startRow:t.startRow,startColumn:t.startColumn,endRow:t.endRow,endColumn:t.endColumn,rangeType:t.rangeType,unitId:t.unitId,sheetId:t.sheetId},primary:null,style:s};return n!=null&&(i.primary=Lw(n)),i}function Lw(e){const{actualRow:t,actualColumn:n,isMerged:s,isMergedMainCell:i}=e,{startRow:r,startColumn:o,endRow:a,endColumn:l}=e.mergeInfo;return{actualRow:t,actualColumn:n,isMerged:s,isMergedMainCell:i,startRow:r,startColumn:o,endRow:a,endColumn:l}}var Bw=(e=>(e[e.Tab=1]="Tab",e[e.Comma=2]="Comma",e[e.Semicolon=4]="Semicolon",e[e.Space=8]="Space",e[e.Custom=16]="Custom",e))(Bw||{});let BR=class{constructor(){E(this,"_tabCount",0),E(this,"_commaCount",0),E(this,"_semicolonCount",0),E(this,"_spaceCount",0)}add(t){switch(t){case"	":this._tabCount++;break;case",":this._commaCount++;break;case";":this._semicolonCount++;break;case" ":this._spaceCount++;break}}update(t){t&&typeof t=="string"&&(t.includes("	")&&this._tabCount++,t.includes(",")&&this._commaCount++,t.includes(";")&&this._semicolonCount++,t.trim().includes(" ")&&this._spaceCount++)}getDelimiter(){const t=Math.max(this._tabCount,this._commaCount,this._semicolonCount,this._spaceCount);return t===0||t===this._tabCount?1:t===this._commaCount?2:t===this._semicolonCount?4:t===this._spaceCount?8:1}};function jR(e,t,n){const s=[];n!==void 0&&(e&16)>0&&s.push(n),(e&1)>0&&s.push("	"),(e&2)>0&&s.push(","),(e&4)>0&&s.push(";"),(e&8)>0&&s.push(" ");let i="";for(const o of s)i+=FR(o);let r="[".concat(i,"]");return t&&(r+="+"),new RegExp(r)}function FR(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const zR=e=>{var t;return((t=e.body)==null?void 0:t.dataStream.replace(/\r\n$/,""))||""};function XR(e){if(e!=null){if(e.p)return zR(e.p);if(e.v&&typeof e.v=="string")return e.v;if(e.t&&(e.t===je.FORCE_STRING||e.t===je.STRING))return String(e.v)}}function YR(e,t,n,s,i=!1){const r=De.transformRange(t,e),{startColumn:o,startRow:a,endColumn:l,endRow:u}=r;if(o!==l)throw new Error("The range must be in the same column.");if(n&&(n&16)>0&&(s===void 0||s.length!==1))throw new Error("The custom delimiter must a character.");const d=n===void 0,c=d?new BR:null,h=[];for(let w=a;w<=u;w++){const b=e.getCell(w,o),I=XR(b);h.push(I),c&&c.update(I)}const g=d?c.getDelimiter():n,m=jR(g,i,s);let p=-1,f=0,v=0;const C=[];for(const w of h){if(w!==void 0){const b=String(w).split(m);p<0?p=b.length:p=Math.max(p,b.length),C.push(b),f=v}else C.push(void 0);v++}return{rs:C,maxLength:p===-1?0:p,lastRow:f}}const ZR=(e,t,n="")=>e.reduce((s,i)=>{const r=i&&i[t];return typeof r!="string"?(console.warn(i,`${t} is not string`),s):(r?(s[r]||(s[r]=[]),s[r].push(i)):s[n].push(i),s)},{}),GR=(e=0)=>{let t=e;return function(){return t++}};function qR(e){return e==null?!1:e.v!==void 0&&e.v!==null&&e.v!==""||e.p!==void 0}function T6(e,t){for(let n=e.startRow;n<=e.endRow;n++)for(let s=e.startColumn;s<=e.endColumn;s++){const i=t.getCell(n,s);if(qR(i))return{startRow:n,startColumn:s,endRow:n,endColumn:s}}return null}function jw(e){const t=new de;return e.forEach(n=>{const{startRow:s,startColumn:i,endRow:r,endColumn:o}=n;for(let a=s;a<=r;a++)for(let l=i;l<=o;l++)t.setValue(a,l,null)}),t.clone()}function Fw(e){const t=new de;return e.forEach(n=>{const{startRow:s,startColumn:i,endRow:r,endColumn:o}=n;for(let a=s;a<=r;a++)for(let l=i;l<=o;l++)t.setValue(a,l,{v:null,p:null,f:null,si:null,custom:null})}),t.clone()}function QR(e){const t=new de;return e.forEach(n=>{const{startRow:s,startColumn:i,endRow:r,endColumn:o}=n;for(let a=s;a<=r;a++)for(let l=i;l<=o;l++)t.setValue(a,l,{s:null})}),t.clone()}function Or(e){const{rows:t,cols:n}=e;return{startRow:t[0],endRow:t[t.length-1],startColumn:n[0],endColumn:n[n.length-1]}}function cl(e,t,n,s){const i=t.get(P),r=n?i.getUnit(n,A.UNIVER_SHEET):i.getCurrentUnitForType(A.UNIVER_SHEET),o=s?r?.getSheetBySheetId(s):r?.getActiveSheet();if(!o)return null;const{startRow:a,endRow:l,startColumn:u,endColumn:d}=e,c=[],h=[];for(let g=a;g<=l;g++)o.getRowFiltered(g)||c.push(g);for(let g=u;g<=d;g++)h.push(g);return{rows:c,cols:h}}function Kc(e,t,n,s){const i=Y(t.get(P),{unitId:n,subUnitId:s});if(!i)return e;const{worksheet:r}=i,o=[];for(const l of e){const{startRow:u,endRow:d,startColumn:c,endColumn:h}=l,g=[];let m=u;for(let f=u;f<=d;f++)r.getRowFiltered(f)?(m<f&&g.push([m,f-1]),m=f+1):f===d&&g.push([m,d]);const p=o.findIndex(f=>f.startColumn===c&&f.endColumn===h);p>-1?o[p].rowIntervals=o[p].rowIntervals.concat(g):o.push({startColumn:c,endColumn:h,rowIntervals:g})}const a=[];for(const l of o){const{startColumn:u,endColumn:d,rowIntervals:c}=l,h=rw(c);for(const[g,m]of h)a.push({startRow:g,endRow:m,startColumn:u,endColumn:d})}return a}var dn=(e=>(e.OthersCanView="othersCanView",e.NoOneElseCanView="noOneElseCanView",e))(dn||{}),Ft=(e=>(e.DesignedUserCanEdit="designedUserCanEdit",e.OnlyMe="onlyMe",e))(Ft||{});let We=class{constructor(){E(this,"_model",new Map),E(this,"_ruleChange$",new Ve),E(this,"ruleChange$",this._ruleChange$.asObservable()),E(this,"_ruleRefresh$",new Ve),E(this,"ruleRefresh$",this._ruleRefresh$.asObservable()),E(this,"_rangeRuleInitStateChange",new xe(!1)),E(this,"rangeRuleInitStateChange$",this._rangeRuleInitStateChange.asObservable())}dispose(){this._ruleChange$.complete(),this._ruleRefresh$.complete()}ruleRefresh(t){this._ruleRefresh$.next(t)}getRangeRuleInitState(){return this._rangeRuleInitStateChange.value}changeRuleInitState(t){this._rangeRuleInitStateChange.next(t)}addRule(t,n,s){this._ensureRuleMap(t,n).set(s.id,s),this._ruleChange$.next({unitId:t,subUnitId:n,rule:s,type:"add"})}deleteRule(t,n,s){var i,r,o,a;const l=(r=(i=this._model.get(t))==null?void 0:i.get(n))==null?void 0:r.get(s);l&&((a=(o=this._model.get(t))==null?void 0:o.get(n))==null||a.delete(s),this._ruleChange$.next({unitId:t,subUnitId:n,rule:l,type:"delete"}))}setRule(t,n,s,i){var r,o;const a=this.getRule(t,n,s);a&&((o=(r=this._model.get(t))==null?void 0:r.get(n))==null||o.set(s,i),this._ruleChange$.next({unitId:t,subUnitId:n,oldRule:a,rule:i,type:"set"}))}getRule(t,n,s){var i,r;return(r=(i=this._model.get(t))==null?void 0:i.get(n))==null?void 0:r.get(s)}getSubunitRuleList(t,n){var s;return[...(((s=this._model.get(t))==null?void 0:s.get(n))||new Map).values()]}getSubunitRuleListLength(t,n){var s;const i=(s=this._model.get(t))==null?void 0:s.get(n);return i?i.size:0}_ensureRuleMap(t,n){let s=this._model.get(t);s||(s=new Map,this._model.set(t,s));let i=s.get(n);return i||(i=new Map,s.set(n,i)),i}toObject(){const t={};return[...this._model.keys()].forEach(n=>{const s=this._model.get(n),i=[...s.keys()];t[n]={},i.forEach(r=>{const o=s.get(r);t[n][r]=[...o.values()]})}),t}fromObject(t){const n=new Map;Object.keys(t).forEach(s=>{const i=t[s],r=new Map;Object.keys(i).forEach(o=>{const a=i[o].reduce((l,u)=>(l.set(u.id,u),l),new Map);r.set(o,a)}),n.set(s,r)}),this._model=n}deleteUnitModel(t){this._model.delete(t)}createRuleId(t,n){let s=hn(4);const i=this._ensureRuleMap(t,n);for(;i.has(s);)s=hn(4);return s}getTargetByPermissionId(t,n){const s=this._model.get(t);if(!s)return null;for(const[i,r]of s)for(const o of r.values())if(o.permissionId===n)return[t,i];return null}};const U6=(e,t)=>{const n=e.get(We),s=t.ruleIds.map(i=>n.getRule(t.unitId,t.subUnitId,i)).filter(i=>!!i);return{id:Hn.id,params:{subUnitId:t.subUnitId,unitId:t.unitId,rules:s}}},$n={id:"sheet.mutation.delete-range-protection",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,ruleIds:i}=t,r=e.get(We);return i.forEach(o=>{r.deleteRule(n,s,o)}),!0}},N6=e=>{const t={...e,ruleIds:e.rules.map(n=>n.id)};return{id:$n.id,params:t}},Hn={id:"sheet.mutation.add-range-protection",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,rules:i}=t,r=e.get(We);return i.forEach(o=>{r.addRule(n,s,o)}),!0}},zw={type:H.COMMAND,id:"sheet.command.add-range-protection",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),i=e.get(We),{rule:r,permissionId:o}=t,{unitId:a,subUnitId:l,ranges:u,description:d,viewState:c,editState:h}=r,g=[{ranges:u,permissionId:o,id:i.createRuleId(a,l),description:d,unitType:r.unitType,unitId:a,subUnitId:l,viewState:c,editState:h}];if(await n.executeCommand(Hn.id,{unitId:a,subUnitId:l,rules:g})){const m=[{id:Hn.id,params:{unitId:a,subUnitId:l,rules:g}}],p=[{id:$n.id,params:{unitId:a,subUnitId:l,ruleIds:g.map(f=>f.id)}}];s.pushUndoRedo({unitID:a,redoMutations:m,undoMutations:p})}return!0}};var Ct=(e=>(e[e.MOVE_START=0]="MOVE_START",e[e.MOVING=1]="MOVING",e[e.MOVE_END=2]="MOVE_END",e[e.ONLY_SET=3]="ONLY_SET",e))(Ct||{});let KR=class extends ae{constructor(t){super(),E(this,"_worksheetSelections",new Map),E(this,"_worksheetLastSelectionPrimaryCell",new Map),E(this,"_selectionMoveStart$",new Ve),E(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable()),E(this,"_selectionMoving$",new Ve),E(this,"selectionMoving$",this._selectionMoving$.asObservable()),E(this,"_selectionMoveEnd$",new xe([])),E(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable()),E(this,"_selectionSet$",new xe([])),E(this,"selectionSet$",this._selectionSet$.asObservable()),E(this,"selectionChanged$"),E(this,"_beforeSelectionMoveEnd$",new xe([])),E(this,"beforeSelectionMoveEnd$",this._beforeSelectionMoveEnd$.asObservable()),this._workbook=t,this.selectionChanged$=Ut(this._selectionMoveEnd$,this._selectionSet$)}dispose(){super.dispose(),this._beforeSelectionMoveEnd$.complete(),this._selectionMoveEnd$.complete(),this._selectionMoving$.complete(),this._selectionMoveStart$.complete(),this._selectionSet$.complete(),this._workbook=null,this.clear()}addSelections(t,n){const s=this.getSelectionsOfWorksheet(t);s.push(...n),this._selectionSet$.next(s)}setSelections(t,n=[],s){switch(this.setSelectionsOfWorksheet(t,n),s){case Ct.MOVE_START:this._selectionMoveStart$.next(n);break;case Ct.MOVING:this._selectionMoving$.next(n);break;case Ct.MOVE_END:this._beforeSelectionMoveEnd$.next(n),this._selectionMoveEnd$.next(n);break;case Ct.ONLY_SET:{this._selectionSet$.next(n);break}default:this._selectionSet$.next(n);break}}getCurrentSelections(){return this._getCurrentSelections()}getSelectionOfWorksheet(t){return this.getSelectionsOfWorksheet(t)}getSelectionsOfWorksheet(t){return this._worksheetSelections.has(t)||this._worksheetSelections.set(t,[]),this._worksheetSelections.get(t)}getLastSelectionPrimaryCellOfWorksheet(t){var n;return(n=this._worksheetLastSelectionPrimaryCell.get(t))!=null?n:null}setSelectionsOfWorksheet(t,n){this._worksheetSelections.set(t,[...n]),n.length>0&&n[n.length-1].primary&&this._worksheetLastSelectionPrimaryCell.set(t,n[n.length-1].primary)}deleteSheetSelection(t){this._worksheetSelections.set(t,[]),this._worksheetLastSelectionPrimaryCell.delete(t)}clear(){this._worksheetSelections.clear(),this._worksheetLastSelectionPrimaryCell.clear(),this._selectionSet$.next([])}_getCurrentSelections(){return this.getSelectionsOfWorksheet(this._workbook.getActiveSheet().getSheetId())}getCurrentLastSelection(){const t=this._getCurrentSelections();return t[t.length-1]}};var $R=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},JR=(e,t)=>(n,s)=>t(n,s,e);let q=class extends Ms{constructor(e){super(),E(this,"_cellStylesCache",new Map),E(this,"selectionMoveStart$"),E(this,"selectionMoving$"),E(this,"selectionMoveEnd$"),E(this,"selectionSet$"),E(this,"selectionChanged$"),E(this,"_workbookSelections",new Map),this._instanceSrv=e,this._init()}get _currentSelectionPos(){const e=this._instanceSrv.getCurrentUnitForType(A.UNIVER_SHEET);if(!e)return null;const t=e.getActiveSheet();return{unitId:e.getUnitId(),sheetId:t.getSheetId()}}get currentSelectionParam(){return this._currentSelectionPos}_init(){const e=this._instanceSrv.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe(Rn(1),ln(this.dispose$));this.selectionMoveStart$=e.pipe().pipe($e(t=>t?this._ensureWorkbookSelection(t.getUnitId()).selectionMoveStart$:Re())).pipe(ln(this.dispose$)),this.selectionMoving$=e.pipe($e(t=>t?this._ensureWorkbookSelection(t.getUnitId()).selectionMoving$:Re())).pipe(ln(this.dispose$)),this.selectionMoveEnd$=e.pipe($e(t=>t?this._ensureWorkbookSelection(t.getUnitId()).selectionMoveEnd$:Re([]))).pipe(ln(this.dispose$)),this.selectionSet$=e.pipe($e(t=>t?this._ensureWorkbookSelection(t.getUnitId()).selectionSet$:Re([]))).pipe(ln(this.dispose$)),this.selectionChanged$=e.pipe($e(t=>t?this._ensureWorkbookSelection(t.getUnitId()).selectionChanged$:Re([]))).pipe(yn((t,n)=>t.length!==n.length?!1:t.length===0&&n.length===0?!0:t.every((s,i)=>JSON.stringify(s)===JSON.stringify(n[i]))),ew(1)).pipe(ln(this.dispose$)),this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(A.UNIVER_SHEET).pipe(ln(this.dispose$)).subscribe(t=>{this._removeWorkbookSelection(t.getUnitId())})),this.disposeWithMe(this.selectionChanged$.pipe(ln(this.dispose$)).subscribe(()=>{this._cellStylesCache.clear()}))}dispose(){super.dispose(),this._cellStylesCache.clear(),this._workbookSelections.forEach(e=>e.dispose()),this._workbookSelections.clear(),this.selectionMoveStart$=Re(null),this.selectionMoving$=Re(null),this.selectionMoveEnd$=Re([]),this.selectionSet$=Re(null),this.selectionChanged$=Re(null)}clear(){this._workbookSelections.forEach(e=>e.clear())}getCurrentSelections(){return this._getCurrentSelections()}getCurrentLastSelection(){const e=this._getCurrentSelections();return e?.[e.length-1]}getCurrentLastSelectionPrimaryCell(){const e=this._currentSelectionPos;if(!e)return null;const{unitId:t,sheetId:n}=e;return this._ensureWorkbookSelection(t).getLastSelectionPrimaryCellOfWorksheet(n)}addSelections(e,t,n){if(typeof e=="string"){this._ensureWorkbookSelection(e).addSelections(t,n);return}const s=this._currentSelectionPos;if(!s)throw new Error("[SheetsSelectionsService]: cannot find current selection position!");const{unitId:i,sheetId:r}=s;this._ensureWorkbookSelection(i).addSelections(r,e)}setSelections(e,t,n,s){if(typeof e=="string"&&typeof t=="string"){const a=e;this._ensureWorkbookSelection(a).setSelections(t,n||[],s??Ct.ONLY_SET);return}const i=this._currentSelectionPos;if(!i)throw new Error("[SheetsSelectionsService]: cannot find current selection position!");const{unitId:r,sheetId:o}=i;if(typeof e=="object"){const a=e??n,l=t??Ct.ONLY_SET;this._ensureWorkbookSelection(r).setSelections(o,a,l)}}clearCurrentSelections(){this._getCurrentSelections().splice(0)}isOverlapping(){const e=this.getCurrentSelections();return e==null?!1:e.some(({range:t},n)=>e.some(({range:s},i)=>n===i?!1:t.startRow<=s.endRow&&t.endRow>=s.startRow&&t.startColumn<=s.endColumn&&t.endColumn>=s.startColumn))}_getCurrentSelections(){const e=this._currentSelectionPos;if(!e)return[];const{unitId:t,sheetId:n}=e;return this._ensureWorkbookSelection(t).getSelectionsOfWorksheet(n)}getWorkbookSelections(e){return this._ensureWorkbookSelection(e)}_ensureWorkbookSelection(e){let t=this._workbookSelections.get(e);if(!t){const n=this._instanceSrv.getUnit(e);if(!n)throw new Error(`[SheetsSelectionsService]: cannot resolve unit with id "${e}"!`);t=new KR(n),this._workbookSelections.set(e,t)}return t}_removeWorkbookSelection(e){this._workbookSelections.delete(e)}getCellStylesProperty(e){var t;const n=(t=this._instanceSrv.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:t.getActiveSheet(),s=this.getCurrentSelections();if(!n||s.length===0)return{isAllValuesSame:!1,value:null};let i=null;for(let r=0;r<s.length;r++){const o=s[r],{startRow:a,endRow:l,startColumn:u,endColumn:d}=o.range;for(let c=a;c<=l;c++)for(let h=u;h<=d;h++){const g=`${c}_${h}`;let m;this._cellStylesCache.has(g)?m=this._cellStylesCache.get(g):(m=n.getComposedCellStyle(c,h),this._cellStylesCache.set(g,m));const p=m[e];if(i!=null&&!Q.diffValue(i,p))return{isAllValuesSame:!1,value:null};i=p}}return{isAllValuesSame:!0,value:i}}};q=$R([JR(0,P)],q);const A6="DISABLE_NORMAL_SELECTIONS",Eo="SELECTIONS_ENABLED",Fo="REF_SELECTIONS_ENABLED",Os={id:"sheet.command.clear-selection-all",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(P),i=e.get(U),r=e.get(q),o=e.get(ce),a=e.get(_e),l=s.getCurrentUnitForType(A.UNIVER_SHEET);if(!l)return!1;const u=t?.unitId||l.getUnitId(),d=l.getActiveSheet();if(!d)return!1;const c=t?.subUnitId||d.getSheetId(),h=t?.ranges||((n=r.getCurrentSelections())==null?void 0:n.map(w=>w.range));if(!(h!=null&&h.length))return!1;const g=Kc(h,e,u,c),m=[],p=[],f={subUnitId:c,unitId:u,cellValue:jw(g)},v=Vt(e,f);m.push({id:le.id,params:f}),p.push({id:le.id,params:v});const C=a.onCommandExecute({id:Os.id});return m.push(...C.redos),p.unshift(...C.undos),fe(m,i)?(o.pushUndoRedo({unitID:u,undoMutations:p,redoMutations:m}),!0):!1}},Vs={id:"sheet.command.clear-selection-format",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(P),i=e.get(U),r=e.get(q),o=e.get(ce),a=e.get(_e),l=s.getCurrentUnitForType(A.UNIVER_SHEET);if(!l)return!1;const u=t?.unitId||l.getUnitId(),d=l.getActiveSheet();if(!d)return!1;const c=t?.subUnitId||d.getSheetId(),h=t?.ranges||((n=r.getCurrentSelections())==null?void 0:n.map(w=>w.range));if(!(h!=null&&h.length))return!1;const g=Kc(h,e,u,c),m=[],p=[],f={subUnitId:c,unitId:u,cellValue:QR(g)},v=Vt(e,f);m.push({id:le.id,params:f}),p.push({id:le.id,params:v});const C=a.onCommandExecute({id:Vs.id});return m.push(...C.redos),p.unshift(...C.undos),fe(m,i)?(o.pushUndoRedo({unitID:u,undoMutations:p,redoMutations:m}),!0):!1}};function Yn(e,t,n=!0){const s=t.getMatrixWithMergedCells(...sI(e)),i=[];if(s.forValue((o,a,l)=>{if(l.colSpan!==void 0&&l.rowSpan!==void 0){const u={startRow:o,startColumn:a,endRow:o+l.rowSpan-1,endColumn:a+l.colSpan-1};z.contains(e,u)||i.push(u)}}),i.length===0)return e;const r=z.union(e,...i);return n?Yn(r,t,n):r}function id(e,t,n){let s=null;return n.getMatrixWithMergedCells(e,t,e,t).forValue((i,r,o)=>(s={actualRow:i,actualColumn:r,startRow:i,startColumn:r,isMerged:o.rowSpan!==void 0||o.colSpan!==void 0,isMergedMainCell:o.rowSpan!==void 0&&o.colSpan!==void 0,endRow:i+(o.rowSpan!==void 0?o.rowSpan-1:0),endColumn:r+(o.colSpan!==void 0?o.colSpan-1:0),rangeType:j.NORMAL},!1)),s||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:j.NORMAL}}function ey(e,t,n){const{startRow:s,startColumn:i,endRow:r,endColumn:o}=e;return Number.isNaN(s)&&(e.startRow=0),Number.isNaN(r)&&(e.endRow=t-1),Number.isNaN(i)&&(e.startColumn=0),Number.isNaN(o)&&(e.endColumn=n-1),e}function Ht(e,t){const n=Number.isNaN(e.startRow)?0:e.startRow,s=Number.isNaN(e.startColumn)?0:e.startColumn,i=t.getMergedCell(n,s);return i?{...i,actualRow:n,actualColumn:s,rangeType:j.NORMAL,isMerged:!0,isMergedMainCell:!0}:{startRow:n,startColumn:s,endRow:e.startRow,endColumn:e.startColumn,actualRow:n,actualColumn:s,rangeType:j.NORMAL,isMerged:!1,isMergedMainCell:!1}}const dr=(e,t,n)=>({id:me.id,params:{unitId:t.getUnitId(),subUnitId:n.getSheetId(),reveal:!0,selections:[{range:e,primary:Ht(e,n)}]}});function V6(e){if(!e)return!1;const{range:t,primary:n}=e;return z.equals(t,n)}function ty(e){function t(n,s){function i(r){for(let o=r.startRow;o<=r.endRow;o++)if(!e.getRowFiltered(o))for(let a=r.startColumn;a<=r.endColumn;a++)s(o,a,r)}i(n)}return{forOperableEach:t}}const pv=e=>e.id!==Tw;function ss(e,t,n,s,i,r,o){const a={};for(let l=t;l<=n;l++)for(let u=s;u<=i;u++){const d=r?e.getCellWithFilteredInterceptors(o,u,dv,pv):e.getCellWithFilteredInterceptors(l,o,dv,pv);!d||!d.s||(a[l]||(a[l]={}),a[l][u]={s:d.s})}for(const l in a){for(const u in a[l]){const d=a[l][u];d.s&&typeof d.s=="object"&&Q.isEmptyObject(d.s)&&delete d.s,Q.isEmptyObject(d)&&delete a[l][u]}Q.isEmptyObject(a[l])&&delete a[l]}return a}var ny=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},sy=(e,t)=>(n,s)=>t(n,s,e);const $c=bn("sheets-formula.ref-selections.service");let Ed=class extends q{constructor(t){super(t)}_init(){const t=this._getAliveWorkbooks$().pipe(ln(this.dispose$));this.selectionMoveStart$=t.pipe($e(n=>Ut(...n.map(s=>s.selectionMoveStart$)))),this.selectionMoving$=t.pipe($e(n=>Ut(...n.map(s=>s.selectionMoving$)))),this.selectionMoveEnd$=t.pipe($e(n=>Ut(...n.map(s=>s.selectionMoveEnd$)))),this.selectionSet$=t.pipe($e(n=>Ut(...n.map(s=>s.selectionSet$))))}dispose(){super.dispose(),this.selectionMoveStart$=Re(null),this.selectionMoving$=Re(null),this.selectionMoveEnd$=Re(null),this.selectionSet$=Re(null),delete this._instanceSrv,this._workbookSelections.clear()}_getAliveWorkbooks$(){const t=this._instanceSrv.getAllUnitsForType(A.UNIVER_SHEET);t.forEach(s=>this._ensureWorkbookSelection(s.getUnitId()));const n=new xe(t);return this.disposeWithMe(this._instanceSrv.getTypeOfUnitAdded$(A.UNIVER_SHEET).subscribe(s=>{this._ensureWorkbookSelection(s.getUnitId()),n.next([...n.getValue(),s])})),this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(A.UNIVER_SHEET).subscribe(s=>{this._removeWorkbookSelection(s.getUnitId()),n.next(n.getValue().filter(i=>i!==s))})),n.pipe(Se(s=>s.map(i=>this._ensureWorkbookSelection(i.getUnitId()))))}};Ed=ny([sy(0,P)],Ed);function Zi(e,t){const n=e.get(Ne).getContextValue(Fo);return e.get(n&&!t?$c:q)}const me={id:"sheet.operation.set-selections",type:H.OPERATION,handler:(e,t)=>{if(!t)return!1;const{selections:n,type:s,unitId:i,subUnitId:r}=t;return Zi(e).setSelections(i,r,[...n],s),!0}},iy={id:"sheet.command.select-range",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const{unitId:n,subUnit:s,range:i}=t,r=e.get(U),o=Y(e.get(P),t);if(!o)return!1;const a=[{range:i,primary:Ht(i,o.worksheet),style:null}];return r.syncExecuteCommand(me.id,{unitId:n,subUnitId:s,selections:a})}},Xw="sheet.command.move-range",zi={type:H.COMMAND,id:Xw,handler:async(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(P),a=e.get(so),l=e.get(Oe),u=e.get(_e),d=Y(o);if(!d||!await u.beforeCommandExecute({id:zi.id,params:t}))return!1;const{worksheet:c,subUnitId:h,unitId:g}=d,m=lp(e,{unitId:g,subUnitId:h,range:t.fromRange},{subUnitId:h,range:t.toRange});if(m===null)return a.emit(l.t("sheets.info.acrossMergedCell")),!1;const p=u.onCommandExecute({id:zi.id,params:t}),f=[...(n=p.preRedos)!=null?n:[],...m.redos,...p.redos,{id:me.id,params:{unitId:g,subUnitId:h,selections:[{range:t.toRange,primary:ry(t.fromRange,t.toRange,c)}],type:Ct.MOVE_END}}],v=[...(s=p.preUndos)!=null?s:[],...m.undos,...p.undos,{id:me.id,params:{unitId:g,subUnitId:h,selections:[{range:t.fromRange,primary:Ht(t.fromRange,c)}],type:Ct.MOVE_END}}];if(fe(f,i).result){const{undos:C,redos:w}=u.generateMutationsOfAutoHeight({unitId:g,subUnitId:h,ranges:[t.fromRange,t.toRange]}),b=u.afterCommandExecute({id:zi.id,params:t});return fe([...b.redos,...w],i),r.pushUndoRedo({unitID:g,undoMutations:[...v,...b.undos,...C],redoMutations:[...f,...b.redos,...w]}),!0}return!1}};function lp(e,t,n,s=!1){const i=[],r=[],{range:o,subUnitId:a,unitId:l}=t,{range:u,subUnitId:d}=n,c=e.get(P).getUniverSheetInstance(l),h=c?.getSheetBySheetId(d),g=c?.getSheetBySheetId(a),m=h?.getCellMatrix(),p=g?.getCellMatrix();if(h&&g&&m&&p){const f=Yn(u,h,!1);if(!z.equals(u,f)&&!s)return null;const v=new de,C=new de,w=new de;De.foreach(o,(M,x)=>{const N=p.getValue(M,x);if(v.setValue(M,x,Q.deepClone(N)),N){const T=c?.getStyles().get(N.s);w.setValue(M,x,Q.deepClone(T))}C.setValue(M,x,null)});const b=new de,I=new de;De.foreach(u,(M,x)=>{b.setValue(M,x,Q.deepClone(m.getValue(M,x)))}),De.foreach(o,(M,x)=>{const N=Dc(M,x),T=z.getRelativeRange(N,o),O=z.getPositionRange(T,u),k=Q.deepClone(w.getValue(M,x)),D=Q.deepClone(v.getValue(M,x));D&&k&&(D.s=k),I.setValue(O.startRow,O.startColumn,D)});const _={fromRange:t.range,toRange:n.range,from:{value:C.getMatrix(),subUnitId:a},to:{value:I.getMatrix(),subUnitId:d},unitId:l},R={fromRange:n.range,toRange:t.range,from:{value:v.getMatrix(),subUnitId:a},to:{value:b.getMatrix(),subUnitId:d},unitId:l};i.push({id:Mn.id,params:_}),r.push({id:Mn.id,params:R})}return{redos:i,undos:r}}function ry(e,t,n){const s=e.startRow,i=e.startColumn,r=n.getMergedCell(s,i),o=Ht(t,n);if(r){const a=r.endRow-r.startRow+1,l=r.endColumn-r.startColumn+1;o.endRow=o.startRow+a-1,o.endColumn=o.startColumn+l-1,o.actualRow=o.startRow,o.actualColumn=o.startColumn,o.isMerged=!1,o.isMergedMainCell=!0}return o}var xd=(e=>(e[e.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",e[e.UNIVER_DOC=1]="UNIVER_DOC",e[e.UNIVER_SHEET=2]="UNIVER_SHEET",e[e.UNIVER_SLIDE=3]="UNIVER_SLIDE",e[e.UNIVER_PROJECT=4]="UNIVER_PROJECT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(xd||{}),X=(e=>(e[e.View=0]="View",e[e.Edit=1]="Edit",e[e.ManageCollaborator=2]="ManageCollaborator",e[e.Print=3]="Print",e[e.Duplicate=4]="Duplicate",e[e.Comment=5]="Comment",e[e.Copy=6]="Copy",e[e.Share=7]="Share",e[e.Export=8]="Export",e[e.MoveWorksheet=9]="MoveWorksheet",e[e.DeleteWorksheet=10]="DeleteWorksheet",e[e.HideWorksheet=11]="HideWorksheet",e[e.RenameWorksheet=12]="RenameWorksheet",e[e.CreateWorksheet=13]="CreateWorksheet",e[e.SetWorksheetStyle=14]="SetWorksheetStyle",e[e.EditWorksheetCell=15]="EditWorksheetCell",e[e.InsertHyperlink=16]="InsertHyperlink",e[e.Sort=17]="Sort",e[e.Filter=18]="Filter",e[e.PivotTable=19]="PivotTable",e[e.FloatImg=20]="FloatImg",e[e.History=21]="History",e[e.RwHgtClWdt=22]="RwHgtClWdt",e[e.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",e[e.ViewFilter=24]="ViewFilter",e[e.MoveSheet=25]="MoveSheet",e[e.DeleteSheet=26]="DeleteSheet",e[e.HideSheet=27]="HideSheet",e[e.CopySheet=28]="CopySheet",e[e.RenameSheet=29]="RenameSheet",e[e.CreateSheet=30]="CreateSheet",e[e.SelectProtectedCells=31]="SelectProtectedCells",e[e.SelectUnProtectedCells=32]="SelectUnProtectedCells",e[e.SetCellStyle=33]="SetCellStyle",e[e.SetCellValue=34]="SetCellValue",e[e.SetRowStyle=35]="SetRowStyle",e[e.SetColumnStyle=36]="SetColumnStyle",e[e.InsertRow=37]="InsertRow",e[e.InsertColumn=38]="InsertColumn",e[e.DeleteRow=39]="DeleteRow",e[e.DeleteColumn=40]="DeleteColumn",e[e.EditExtraObject=41]="EditExtraObject",e[e.Delete=42]="Delete",e[e.RecoverHistory=43]="RecoverHistory",e[e.ViewHistory=44]="ViewHistory",e[e.CreatePermissionObject=45]="CreatePermissionObject",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(X||{}),se=(e=>(e[e.Unkonwn=0]="Unkonwn",e[e.Workbook=1]="Workbook",e[e.Worksheet=2]="Worksheet",e[e.SelectRange=3]="SelectRange",e[e.Document=4]="Document",e[e.Slide=5]="Slide",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(se||{});class he{constructor(t,n,s){E(this,"type",se.SelectRange),E(this,"subType",X.Edit),E(this,"status",Le.INIT),E(this,"value",!0),E(this,"id"),E(this,"unitId"),E(this,"subUnitId"),E(this,"permissionId"),this.unitId=t,this.subUnitId=n,this.permissionId=s,this.id=`${se.SelectRange}.${X.Edit}.${s}`}}class Gi{constructor(t,n,s){E(this,"type",se.SelectRange),E(this,"subType",X.View),E(this,"status",Le.INIT),E(this,"value",!1),E(this,"id"),E(this,"unitId"),E(this,"subUnitId"),E(this,"permissionId"),this.unitId=t,this.subUnitId=n,this.permissionId=s,this.id=`${se.SelectRange}.${X.View}.${s}`}}class up{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Comment),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Comment}_${t}`}}class oi{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Copy),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Copy}_${t}`}}let Yw=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"subType",X.CopySheet),E(this,"status",Le.INIT),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.CopySheet}_${t}`}};class oo{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.CreatePermissionObject),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.CreatePermissionObject}_${t}`}}let mu=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.CreateSheet),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.CreateSheet}_${t}`}},dp=class{constructor(t){E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.DeleteColumn),this.unitId=t,this.id=`${this.type}.${X.DeleteColumn}_${t}`}},cp=class{constructor(t){E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.DeleteRow),this.unitId=t,this.id=`${this.type}.${X.DeleteRow}_${t}`}},Jc=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.DeleteSheet),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.DeleteSheet}_${t}`}},hp=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Duplicate),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Duplicate}_${t}`}};class ne{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Edit),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Edit}_${t}`}}class gp{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Export),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Export}_${t}`}}let ya=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.HideSheet),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.HideSheet}_${t}`}},Zw=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.History),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.History}_${t}`}},Ma=class{constructor(t){E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.InsertColumn),this.unitId=t,this.id=`${this.type}.${X.InsertColumn}_${t}`}},Ea=class{constructor(t){E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.InsertRow),this.unitId=t,this.id=`${this.type}.${X.InsertRow}_${t}`}},xa=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.ManageCollaborator),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.ManageCollaborator}_${t}`}},eh=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.MoveSheet),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.MoveSheet}_${t}`}},mp=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Print),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Print}_${t}`}},pp=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.RecoverHistory),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.RecoverHistory}_${t}`}},ka=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.RenameSheet),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.RenameSheet}_${t}`}};class fp{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.Share),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.Share}_${t}`}}let vp=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.View),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.View}_${t}`}},Cp=class{constructor(t){E(this,"id"),E(this,"value",!0),E(this,"type",se.Workbook),E(this,"status",Le.INIT),E(this,"subType",X.ViewHistory),this.unitId=t,this.unitId=t,this.id=`${this.type}.${X.ViewHistory}_${t}`}},qi=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.Copy),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.Copy}_${t}_${n}`}},th=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.DeleteColumn),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.DeleteColumn}_${t}_${n}`}};class pu{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.Delete),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.Delete}_${t}_${n}`}}class nh{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.DeleteRow),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.DeleteRow}_${t}_${n}`}}class oe{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.Edit),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.Edit}_${t}_${n}`}}class wp{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.EditExtraObject),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.EditExtraObject}_${t}_${n}`}}class Sp{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.Filter),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.Filter}_${t}_${n}`}}class ao{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.InsertColumn),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.InsertColumn}_${t}_${n}`}}class bp{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.InsertHyperlink),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.InsertHyperlink}_${t}_${n}`}}class lo{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.InsertRow),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.InsertRow}_${t}_${n}`}}let sh=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.ManageCollaborator),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.ManageCollaborator}_${t}_${n}`}};class _p{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.PivotTable),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.PivotTable}_${t}_${n}`}}let oy=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SelectProtectedCells),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SelectProtectedCells}_${t}_${n}`}},ay=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SelectUnProtectedCells),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SelectUnProtectedCells}_${t}_${n}`}};class mt{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SetCellStyle),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SetCellStyle}_${t}_${n}`}}let nn=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SetCellValue),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SetCellValue}_${t}_${n}`}};class Qn{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SetColumnStyle),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SetColumnStyle}_${t}_${n}`}}class Kn{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.SetRowStyle),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.SetRowStyle}_${t}_${n}`}}class Ip{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.Sort),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.Sort}_${t}_${n}`}}let cr=class{constructor(t,n){E(this,"value",!0),E(this,"type",se.Worksheet),E(this,"status",Le.INIT),E(this,"id"),E(this,"subType",X.View),this.unitId=t,this.subUnitId=n,this.id=`${this.type}.${X.View}_${t}_${n}`}};const An={id:"sheet.command.set-range-values",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(U),i=e.get(ce),r=e.get(P),o=e.get(q),a=e.get(_e),l=e.get(Je),u=Y(r,t);if(!u)return!1;const{subUnitId:d,unitId:c,workbook:h,worksheet:g}=u,{value:m,range:p,redoUndoId:f}=t,v=p?[p]:(n=o.getCurrentSelections())==null?void 0:n.map(T=>T.range);if(!v||!v.length||!l.getPermissionPoint(new oe(c,d).id))return!1;const C=new de;let w;if(Q.isArray(m))for(let T=0;T<v.length;T++){const{startRow:O,startColumn:k,endRow:D,endColumn:B}=v[T];for(let W=0;W<=D-O;W++)for(let F=0;F<=B-k;F++)C.setValue(W+O,F+k,m[W][F])}else if(JC(m))for(let T=0;T<v.length;T++){const{startRow:O,startColumn:k,endRow:D,endColumn:B}=v[T];for(let W=O;W<=D;W++)for(let F=k;F<=B;F++)C.setValue(W,F,m)}else w=m;const b={subUnitId:d,unitId:c,cellValue:w??C.getMatrix()},I=Vt(e,b),_=G_(b.cellValue,(T,O)=>g.getCellHeight(T,O)||void 0);if(!s.syncExecuteCommand(le.id,b))return!1;const{undos:R,redos:M}=a.onCommandExecute({id:An.id,params:b}),{undos:x,redos:N}=a.generateMutationsOfAutoHeight({unitId:c,subUnitId:d,ranges:v,cellHeights:new de(_)});if(fe([...M,...N],s).result){const T=dr(p??C.getRange(),h,g);return i.pushUndoRedo({unitID:c,undoMutations:[{id:le.id,params:I},...R,...x,T],redoMutations:[{id:le.id,params:b},...M,...N,Q.deepClone(T)],id:f}),!0}return!1}};function Gw(e,t){const n=[],s=[],{unitId:i,subUnitId:r,range:o,shiftDimension:a,cellValue:l={}}=t,u=e.get(P),d=e.get(_e),c=u.getUniverSheetInstance(i),h=c?.getSheetBySheetId(r);if(h){const g=h.getCellMatrix(),m=g.getDataRange();if(o.startColumn<=m.endColumn||o.startRow<=m.endRow){let w,b;if(a===Dt.COLUMNS){const _=Math.min(o.endRow,m.endRow);let R=0;for(let x=o.startRow;x<=_;x++){const N=g.getRow(x),T=N?iw(N)-1:0;R=Math.max(R,T)}w={startRow:o.startRow,startColumn:o.startColumn,endRow:_,endColumn:R};const M=o.endColumn-o.startColumn+1;b={startRow:o.startRow,startColumn:w.startColumn+M,endRow:_,endColumn:w.endColumn+M}}else{const _=Math.min(o.endColumn,m.endColumn),R=m.endRow;w={startRow:o.startRow,startColumn:o.startColumn,endRow:R,endColumn:_};const M=o.endRow-o.startRow+1;b={startRow:w.startRow+M,startColumn:o.startColumn,endRow:w.endRow+M,endColumn:_}}const I=lp(e,{unitId:i,subUnitId:r,range:w},{subUnitId:r,range:b},!0);I&&(n.push(...I.redos),s.push(...I.undos))}if(Object.entries(l).length===0)for(let w=o.startRow;w<=o.endRow;w++){l[w]||(l[w]={});for(let b=o.startColumn;b<=o.endColumn;b++)l[w][b]=null}const p={subUnitId:r,unitId:i,cellValue:l},f=Vt(e,p),{undos:v,redos:C}=d.onCommandExecute({id:An.id,params:{...p,range:o}});n.push({id:le.id,params:p},...C),s.push({id:le.id,params:f},...v)}return{redo:n,undo:s}}function qw(e,t){const n=[],s=[],{unitId:i,subUnitId:r,range:o,shiftDimension:a}=t,l=e.get(P),u=e.get(_e),d=l.getUniverSheetInstance(i),c=d?.getSheetBySheetId(r);if(c){const h=c.getCellMatrix(),g=h.getDataRange(),m={subUnitId:r,unitId:i,cellValue:jw([o])},p=Vt(e,m),f=u.onCommandExecute({id:An.id,params:m});if(n.push({id:le.id,params:m},...f.redos),s.push(...f.undos,{id:le.id,params:p}),o.startColumn<=g.endColumn||o.startRow<=g.endRow){let v=null,C=null;if(a===Dt.COLUMNS&&o.endColumn<g.endColumn){const w=Math.min(o.endRow,g.endRow);let b=0;for(let _=o.startRow;_<=w;_++){const R=h.getRow(_),M=R?iw(R)-1:0;b=Math.max(b,M)}v={startRow:o.startRow,startColumn:o.endColumn+1,endRow:w,endColumn:b};const I=o.endColumn-o.startColumn+1;C={startRow:o.startRow,startColumn:v.startColumn-I,endRow:w,endColumn:v.endColumn-I}}if(a===Dt.ROWS&&o.endRow<g.endRow){const w=Math.min(o.endColumn,g.endColumn),b=g.endRow;v={startRow:o.endRow+1,startColumn:o.startColumn,endRow:b,endColumn:w};const I=o.endRow-o.startRow+1;C={startRow:v.startRow-I,startColumn:o.startColumn,endRow:v.endRow-I,endColumn:w}}if(v&&C){const w=lp(e,{unitId:i,subUnitId:r,range:v},{subUnitId:r,range:C},!0);w&&(n.push(...w.redos),s.push(...w.undos))}}}return{redo:n,undo:s}}function lP(e,t,n,s,i,r){const{startRow:o,endRow:a,startColumn:l,endColumn:u}=t;if(i===Dt.ROWS){const d=a-o+1;for(let c=n;c>=o;c--)for(let h=l;h<=u;h++){const g=e.getValue(c,h);g==null?e.realDeleteValue(c+d,h):e.setValue(c+d,h,g)}for(let c=a;c>=o;c--)for(let h=l;h<=u;h++)r&&r[c]&&r[c][h]?e.setValue(c,h,r[c][h]):e.realDeleteValue(c,h)}else if(i===Dt.COLUMNS){const d=u-l+1;for(let c=o;c<=a;c++)for(let h=s;h>=l;h--){const g=e.getValue(c,h);g==null?e.realDeleteValue(c,h+d):e.setValue(c,h+d,g)}for(let c=o;c<=a;c++)for(let h=u;h>=l;h--)r&&r[c]&&r[c][h]?e.setValue(c,h,r[c][h]):e.realDeleteValue(c,h)}}function uP(e,t,n,s,i){const{startRow:r,endRow:o,startColumn:a,endColumn:l}=t,u=o-r+1,d=l-a+1;if(i===Dt.ROWS)for(let c=r;c<=n;c++)for(let h=a;h<=l;h++){const g=e.getValue(c+u,h);g==null?e.realDeleteValue(c,h):e.setValue(c,h,g)}else if(i===Dt.COLUMNS)for(let c=r;c<=o;c++)for(let h=a;h<=s;h++){const g=e.getValue(c,h+d);g==null?e.realDeleteValue(c,h):e.setValue(c,h,g)}}const Qw="sheet.command.delete-range-move-left",Bs={type:H.COMMAND,id:Qw,handler:async(e,t)=>{var n,s,i;const r=e.get(U),o=e.get(ce),a=e.get(P),l=e.get(q),u=e.get(_e),d=Y(a);if(!d)return!1;const{worksheet:c,workbook:h,subUnitId:g,unitId:m}=d;let p=t?.range;if(p||(p=(n=l.getCurrentLastSelection())==null?void 0:n.range),!p)return!1;const f={range:p,subUnitId:g,unitId:m,shiftDimension:Dt.COLUMNS},v=u.onCommandExecute({id:Bs.id,params:{range:p}}),{redo:C,undo:w}=qw(e,f),b=[...(s=v.preRedos)!=null?s:[],...C],I=[...v.undos,...w];if(b.push(...v.redos),b.push(dr(p,h,c)),I.push(...(i=v.preUndos)!=null?i:[]),fe(b,r).result){const _=u.afterCommandExecute({id:Bs.id,params:{range:p}});return fe(_.redos,r),I.push(..._.undos),b.push(..._.redos),o.pushUndoRedo({unitID:m,undoMutations:I.reverse(),redoMutations:b}),!0}return!1}},Kw="sheet.command.delete-range-move-up",js={type:H.COMMAND,id:Kw,handler:async(e,t)=>{var n,s,i;const r=e.get(U),o=e.get(ce),a=e.get(P),l=e.get(q),u=e.get(_e),d=Y(a);if(!d)return!1;const{unitId:c,subUnitId:h,workbook:g,worksheet:m}=d;let p=t?.range;if(p||(p=(n=l.getCurrentLastSelection())==null?void 0:n.range),!p)return!1;const f={range:p,subUnitId:h,unitId:c,shiftDimension:Dt.ROWS},v=u.onCommandExecute({id:js.id,params:{range:p}}),{redo:C,undo:w}=qw(e,f),b=[...(s=v.preRedos)!=null?s:[],...C],I=[...v.undos,...w];if(b.push(...v.redos),b.push(dr(p,g,m)),I.push(...(i=v.preUndos)!=null?i:[]),fe(b,r).result){const _=u.afterCommandExecute({id:js.id,params:{range:p}});return fe(_.redos,r),I.push(..._.undos),b.push(..._.redos),o.pushUndoRedo({unitID:c,undoMutations:I.reverse(),redoMutations:b}),!0}return!1}},$w="sheet.command.insert-range-move-down",Fs={type:H.COMMAND,id:$w,handler:async(e,t)=>{var n,s,i;const r=e.get(U),o=e.get(ce),a=e.get(P),l=e.get(q),u=e.get(_e),d=e.get(so),c=e.get(Oe);if(l.isOverlapping())return d.emit(c.t("sheets.info.overlappingSelections")),!1;const h=Y(a);if(!h)return!1;const{unitId:g,subUnitId:m,worksheet:p,workbook:f}=h;let v=t?.range;if(v||(v=(n=l.getCurrentLastSelection())==null?void 0:n.range),!v)return!1;const C=[],w=[],b=p.getCellMatrix(),I=b.getDataRange(),_=b.getSlice(I.startRow,I.endRow,v.startColumn,v.endColumn).getDataRange().endRow,R=Math.max(_+(v.endRow-v.startRow+1)-I.endRow,0);if(R>0){const k=v.startRow-1,D=p.getRowHeight(k),B={unitId:g,subUnitId:m,range:{startRow:I.endRow+1,endRow:I.endRow+R,startColumn:I.startColumn,endColumn:I.endColumn},rowInfo:new Array(R).fill(void 0).map(()=>({h:D,hd:pe.FALSE}))};C.push({id:rn.id,params:B});const W=sp(e,B);w.push({id:an.id,params:W})}const M={};De.foreach(v,(k,D)=>{const B=p.getCell(k,D);B&&(M[k]||(M[k]={}),M[k][D]={s:B.s})});const x={range:v,subUnitId:m,unitId:g,shiftDimension:Dt.ROWS,cellValue:M},{redo:N,undo:T}=Gw(e,x);C.push(...N),w.push(...T);const O=u.onCommandExecute({id:Fs.id,params:{range:v}});if(C.push(...O.redos),C.push(dr(v,f,p)),w.push(...(s=O.preUndos)!=null?s:[]),C.unshift(...(i=O.preRedos)!=null?i:[]),w.unshift(...O.undos),fe(C,r)){const k=u.afterCommandExecute({id:Fs.id,params:{range:v}});return fe(k.redos,r),w.push(...k.undos),C.push(...k.redos),o.pushUndoRedo({unitID:g,undoMutations:w.reverse(),redoMutations:C}),!0}return!1}},Rp="sheet.command.insert-range-move-right",gi={type:H.COMMAND,id:Rp,handler:async(e,t)=>{var n,s,i;const r=e.get(U),o=e.get(ce),a=e.get(P),l=e.get(q),u=e.get(_e),d=e.get(so),c=e.get(Oe);if(l.isOverlapping())return d.emit(c.t("sheets.info.overlappingSelections")),!1;const h=Y(a);if(!h)return!1;const{workbook:g,worksheet:m,unitId:p,subUnitId:f}=h;let v=t?.range;if(v||(v=(n=l.getCurrentLastSelection())==null?void 0:n.range),!v)return!1;const C=[],w=[],b=m.getCellMatrix(),I=b.getDataRange(),_=b.getSlice(v.startRow,v.endRow,I.startColumn,I.endColumn).getDataRange().endColumn,R=Math.max(_+(v.endColumn-v.startColumn+1)-I.endColumn,0);if(R>0){const k=v.startColumn-1,D=m.getColumnWidth(k),B={unitId:p,subUnitId:f,range:{startRow:I.startRow+1,endRow:I.endRow,startColumn:I.endColumn+1,endColumn:I.endColumn+R},colInfo:new Array(R).fill(void 0).map(()=>({w:D,hd:pe.FALSE}))};C.push({id:on.id,params:B});const W=Qc(e,B);w.push({id:$t.id,params:W})}const M={};De.foreach(v,(k,D)=>{const B=m.getCell(k,D);!B||!B.s||(M[k]||(M[k]={}),M[k][D]={s:B.s})});const x={range:v,subUnitId:f,unitId:p,shiftDimension:Dt.COLUMNS,cellValue:M},{redo:N,undo:T}=Gw(e,x);C.push(...N),w.push(...T);const O=u.onCommandExecute({id:gi.id,params:{range:v}});if(C.push(...O.redos),C.push(dr(v,g,m)),w.push(...(s=O.preUndos)!=null?s:[]),C.unshift(...(i=O.preRedos)!=null?i:[]),w.unshift(...O.undos),fe(C,r).result){const k=u.afterCommandExecute({id:gi.id,params:{range:v}});return fe(k.redos,r),w.push(...k.undos),C.push(...k.redos),o.pushUndoRedo({unitID:p,undoMutations:w.reverse(),redoMutations:C}),!0}return!1}},Jw="sheet.command.insert-row",bs={type:H.COMMAND,id:Jw,handler:async(e,t)=>{const n=e.get(U),s=e.get(_e),{range:i,direction:r,unitId:o,subUnitId:a,cellValue:l}=t;return await s.beforeCommandExecute({id:bs.id,params:t})?n.syncExecuteCommand(kd.id,{range:i,direction:r,unitId:o,subUnitId:a,cellValue:l}):!1}},kd={type:H.COMMAND,id:"sheet.command.insert-row-by-range",handler:(e,t)=>{var n,s,i,r;const o=Y(e.get(P),t);if(!o)throw new Error("Workbook or Worksheet not found at InsertRowByRangeCommand");const{workbook:a,worksheet:l,unitId:u,subUnitId:d}=o,{range:c,direction:h,cellValue:g}=t,{startRow:m,endRow:p}=c;c.rangeType=j.ROW;const f=h===Z.UP?m:m-1;if(f<0||f>l.getRowCount()-1)throw new Error("Anchor row is out of bounds in InsertRowByRangeCommand");const v=e.get(U),C=e.get(ce),w=e.get(_e),b={unitId:u,subUnitId:d,range:c},I=l.getRowHeight(f);I!==l.getConfig().defaultRowHeight&&(b.rowInfo=new Array(p-m+1).fill(void 0).map(()=>({h:I,hd:pe.FALSE})));const _=sp(e,b),R=[{id:rn.id,params:b}],M=[{id:an.id,params:_}];g&&Object.keys(g).length>0&&R.push({id:le.id,params:{unitId:u,subUnitId:d,cellValue:g}});const x=w.onCommandExecute({id:bs.id,params:t});if(R.unshift(...(n=x.preRedos)!=null?n:[]),R.push(...(s=x.redos)!=null?s:[]),R.push(dr(c,a,l)),M.unshift(...(i=x.preUndos)!=null?i:[]),M.push(...(r=x.undos)!=null?r:[]),fe(R,v).result){const N=w.afterCommandExecute({id:bs.id,params:t});return fe(N.redos,v),R.push(...N.redos),M.push(...N.undos),C.pushUndoRedo({unitID:t.unitId,undoMutations:M,redoMutations:R}),!0}return!1}},yp={type:H.COMMAND,id:"sheet.command.insert-row-before",handler:async(e,t)=>{var n;const s=(n=e.get(q).getCurrentSelections())==null?void 0:n.map(f=>f.range);let i;if(s?.length===1)i=s[0];else return!1;const r=e.get(P),o=Y(r);if(!o)return!1;const{worksheet:a,subUnitId:l,unitId:u}=o,d=t.value||0,c=i.startRow,h=i.startRow+d-1,g=0,m=a.getColumnCount()-1,p={unitId:u,subUnitId:l,direction:Z.UP,range:{startRow:c,endRow:h,startColumn:g,endColumn:m},cellValue:ss(a,c,h,g,m,!0,c-1)};return e.get(U).executeCommand(bs.id,p)}},ly={type:H.COMMAND,id:"sheet.command.insert-row-after",handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(p=>p.range);let s;if(n?.length===1)s=n[0];else return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=s.endRow-s.startRow+1,d=s.endRow+1,c=s.endRow+u,h=0,g=o.getColumnCount()-1,m={unitId:a,subUnitId:l,direction:Z.DOWN,range:{startRow:d,endRow:c,startColumn:h,endColumn:g,rangeType:j.ROW},cellValue:ss(o,d,c,h,g,!0,s.endRow)};return e.get(U).executeCommand(bs.id,m)}},Mp={type:H.COMMAND,id:"sheet.command.insert-multi-rows-above",handler:async(e,t)=>{var n;const s=(n=e.get(q).getCurrentSelections())==null?void 0:n.map(v=>v.range);let i;if(s?.length===1)i=s[0];else return!1;const r=e.get(P),o=Y(r);if(!o)return!1;const{worksheet:a,unitId:l,subUnitId:u}=o,d=t.value||0,c=i.startRow,h=i.startRow+d-1,g=0,m=a.getColumnCount()-1,p=ss(a,c,h,g,m,!0,c-1),f={unitId:l,subUnitId:u,direction:Z.UP,range:{startRow:c,endRow:h,startColumn:g,endColumn:m,rangeType:j.ROW},cellValue:p};return e.get(U).executeCommand(bs.id,f)}},Ep={type:H.COMMAND,id:"sheet.command.insert-multi-rows-after",handler:async(e,t)=>{var n;const s=(n=e.get(q).getCurrentSelections())==null?void 0:n.map(f=>f.range);let i;if(s?.length===1)i=s[0];else return!1;const r=e.get(P),o=Y(r);if(!o)return!1;const{worksheet:a,unitId:l,subUnitId:u}=o,d=t.value||0,c=i.endRow+1,h=i.endRow+d,g=0,m=a.getColumnCount()-1,p={unitId:l,subUnitId:u,direction:Z.DOWN,range:{startRow:c,endRow:h,startColumn:g,endColumn:m,rangeType:j.ROW},cellValue:ss(a,c,h,g,m,!0,i.endRow)};return e.get(U).executeCommand(bs.id,p)}},eS="sheet.command.insert-col",_s={type:H.COMMAND,id:eS,handler:async(e,t)=>{const n=e.get(U),s=e.get(_e),{range:i,direction:r,subUnitId:o,unitId:a,cellValue:l}=t;return await s.beforeCommandExecute({id:_s.id,params:t})?n.syncExecuteCommand(Td.id,{range:i,direction:r,unitId:a,subUnitId:o,cellValue:l}):!1}},Td={type:H.COMMAND,id:"sheet.command.insert-col-by-range",handler:(e,t)=>{var n,s,i,r;const o=Y(e.get(P),t);if(!o)throw new Error("Workbook or Worksheet not found at InsertColByRangeCommand");const{workbook:a,worksheet:l,unitId:u,subUnitId:d}=o,{range:c,direction:h,cellValue:g}=t,{startColumn:m,endColumn:p}=c;c.rangeType=j.COLUMN;const f=h===Z.LEFT?m:m-1;if(f<0||f>l.getColumnCount()-1)throw new Error("Anchor column is out of bounds in InsertColByRangeCommand");const v=e.get(U),C=e.get(ce),w=e.get(_e),b={unitId:u,subUnitId:d,range:c},I=l.getColumnWidth(f);I!==l.getConfig().defaultColumnWidth&&(b.colInfo=new Array(p-m+1).fill(void 0).map(()=>({w:I,hd:pe.FALSE})));const _=Qc(e,b),R=[{id:on.id,params:b}],M=[{id:$t.id,params:_}];g&&Object.keys(g).length>0&&R.push({id:le.id,params:{unitId:u,subUnitId:d,cellValue:g}});const x=w.onCommandExecute({id:_s.id,params:t});if(R.unshift(...(n=x.preRedos)!=null?n:[]),R.push(...(s=x.redos)!=null?s:[]),R.push(dr(c,a,l)),M.unshift(...(i=x.preUndos)!=null?i:[]),M.push(...(r=x.undos)!=null?r:[]),fe(R,v).result){const N=w.afterCommandExecute({id:_s.id,params:t});return fe(N.redos,v),R.push(...N.redos),M.push(...N.undos),C.pushUndoRedo({unitID:t.unitId,undoMutations:M.filter(Boolean),redoMutations:R.filter(Boolean)}),!0}return!1}},xp={type:H.COMMAND,id:"sheet.command.insert-col-before",handler:async(e,t)=>{const n=e.get(q).getCurrentSelections();let s;if(n?.length===1)s=n[0].range;else return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=t.value||0,d=s.startColumn,c=s.startColumn+u-1,h=0,g=o.getRowCount()-1,m={unitId:a,subUnitId:l,direction:Z.LEFT,range:{startColumn:d,endColumn:c,startRow:h,endRow:g,rangeType:j.COLUMN},cellValue:ss(o,h,g,d,c,!1,d-1)};return e.get(U).executeCommand(_s.id,m)}},uy={type:H.COMMAND,id:"sheet.command.insert-col-after",handler:async e=>{const t=e.get(q).getCurrentSelections();let n;if(t?.length===1)n=t[0].range;else return!1;const s=e.get(P),i=Y(s);if(!i)return!1;const{worksheet:r,unitId:o,subUnitId:a}=i,l=n.endColumn-n.startColumn+1,u=n.endColumn+1,d=n.endColumn+l,c=0,h=r.getRowCount()-1,g={unitId:o,subUnitId:a,direction:Z.RIGHT,range:{startColumn:u,endColumn:d,startRow:c,endRow:h},cellValue:ss(r,c,h,u,d,!1,n.endColumn)};return e.get(U).executeCommand(_s.id,g)}},kp={type:H.COMMAND,id:"sheet.command.insert-multi-cols-before",handler:async(e,t)=>{const n=e.get(q).getCurrentSelections();let s;if(n?.length===1)s=n[0].range;else return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=t.value||0,d=s.startColumn,c=s.startColumn+u-1,h=0,g=o.getRowCount()-1,m={unitId:a,subUnitId:l,direction:Z.LEFT,range:{startColumn:d,endColumn:c,startRow:h,endRow:g,rangeType:j.COLUMN},cellValue:ss(o,h,g,d,c,!1,d-1)};return e.get(U).executeCommand(_s.id,m)}},Tp={type:H.COMMAND,id:"sheet.command.insert-multi-cols-right",handler:async(e,t)=>{const n=e.get(q).getCurrentSelections();let s;if(n?.length===1)s=n[0].range;else return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=t.value||0,d=s.endColumn+1,c=s.endColumn+u,h=0,g=o.getRowCount()-1,m={unitId:a,subUnitId:l,direction:Z.RIGHT,range:{startColumn:d,endColumn:c,startRow:h,endRow:g},cellValue:ss(o,h,g,d,c,!1,s.endColumn)};return e.get(U).executeCommand(_s.id,m)}},tS=lw((e,t,n,s)=>{if(!s.disposed){const i=dr(e,t,n);s.executeCommand(i.id,i.params)}},300),Pd="sheet.command.remove-row",Pp={type:H.COMMAND,id:"sheet.command.remove-row-by-range",handler:(e,t)=>{var n,s,i;if(!t)return!1;const r=e.get(P),o=Y(r,t);if(!o)return!1;const{workbook:a,worksheet:l}=o,u=e.get(_e),{range:d,unitId:c,subUnitId:h}=t,g=Kc([d],e,c,h).reverse(),m=[],p=[];g.forEach(C=>{const w=[],b=[],I={unitId:c,subUnitId:h,range:C},_=aR(I,l),R=l.getCellMatrix().getSlice(C.startRow,C.endRow,0,l.getColumnCount()-1),M={unitId:c,subUnitId:h,cellValue:R.getMatrix()};b.push({id:an.id,params:I}),w.push({id:rn.id,params:_}),w.push({id:le.id,params:M}),p.push(...b),m.unshift(...w)});const f=u.onCommandExecute({id:Pd,params:{range:d}}),v=e.get(U);if(fe([...(n=f.preRedos)!=null?n:[],...p,...f.redos],v).result){tS(d,a,l,v);const C=u.afterCommandExecute({id:Pd,params:{range:d}});return fe(C.redos,v),e.get(ce).pushUndoRedo({unitID:c,undoMutations:[...(s=f.preUndos)!=null?s:[],...m,...f.undos,...C.undos],redoMutations:[...(i=f.preRedos)!=null?i:[],...p,...f.redos,...C.redos]}),!0}return!1}},Ta={type:H.COMMAND,id:Pd,handler:async(e,t)=>{var n;const s=e.get(q),i=e.get(_e),r=e.get(U);let o=t?.range;if(o||(o=(n=s.getCurrentLastSelection())==null?void 0:n.range),!o)return!1;const a=e.get(P),l=Y(a);if(!l)return!1;const{worksheet:u,subUnitId:d,unitId:c}=l;return o={...o,startColumn:0,endColumn:Math.max(u.getMaxColumns()-1,0)},await i.beforeCommandExecute({id:Ta.id,params:{range:o}})?r.syncExecuteCommand(Pp.id,{range:o,unitId:c,subUnitId:d}):!1}},Ud="sheet.command.remove-col",Up={type:H.COMMAND,id:"sheet.command.remove-col-by-range",handler:(e,t)=>{var n,s,i;if(!t)return!1;const r=e.get(P),o=Y(r,t);if(!o)return!1;const{workbook:a,worksheet:l}=o,u=e.get(_e),{range:d,unitId:c,subUnitId:h}=t,g={unitId:c,subUnitId:h,range:d},m=lR(e,g),p=l.getCellMatrix().getSlice(0,l.getRowCount()-1,d.startColumn,d.endColumn),f={unitId:c,subUnitId:h,cellValue:p.getMatrix()},v=u.onCommandExecute({id:Ud,params:{range:d}}),C=e.get(U);if(fe([...(n=v.preRedos)!=null?n:[],{id:$t.id,params:g},...v.redos],C).result){tS(d,a,l,C);const w=u.afterCommandExecute({id:Ud,params:{range:d}});return fe(w.redos,C),e.get(ce).pushUndoRedo({unitID:c,undoMutations:[...(s=v.preUndos)!=null?s:[],{id:on.id,params:m},{id:le.id,params:f},...v.undos,...w.undos],redoMutations:[...(i=v.preRedos)!=null?i:[],{id:$t.id,params:g},...v.redos,...w.redos]}),!0}return!1}},Pa={type:H.COMMAND,id:Ud,handler:async(e,t)=>{var n;const s=e.get(q),i=e.get(_e),r=e.get(U);let o=t?.range;if(o||(o=(n=s.getCurrentLastSelection())==null?void 0:n.range),!o)return!1;const a=e.get(P),l=Y(a);if(!l)return!1;const{worksheet:u,subUnitId:d,unitId:c}=l;return o={...o,startRow:0,endRow:Math.max(u.getMaxRows()-1,0)},await i.beforeCommandExecute({id:Pa.id,params:{range:o}})?r.syncExecuteCommand(Up.id,{range:o,unitId:c,subUnitId:d}):!1}},dy=(e,t)=>{const n=e.get(P),{subUnitId:s,unitId:i}=t,r=sn(n,t);if(!r)throw new Error("[RemoveSheetUndoMutationFactory]: Worksheet is null error!");const{workbook:o,worksheet:a}=r,l=a.getConfig();return{index:o.getConfig().sheetOrder.findIndex(u=>u===s),sheet:l,unitId:i}},En={id:"sheet.mutation.remove-sheet",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P),{subUnitId:s,unitId:i}=t,r=n.getUniverSheetInstance(i);return r?r.removeSheet(s):!1}};function cy(e,t){return t.getMergeData().some(n=>n.startRow<e&&e<=n.endRow)}function hy(e,t){return t.getMergeData().some(n=>n.startColumn<e&&e<=n.endColumn)}const nS="sheet.command.move-rows",Qi={id:nS,type:H.COMMAND,handler:(e,t)=>{var n,s;const i=e.get(q),{fromRange:{startRow:r},toRange:{startRow:o},range:a}=t,l=a?[iS(a)]:i.getCurrentSelections(),u=l?.filter(k=>k.range.rangeType===j.ROW&&k.range.startRow<=r&&r<=k.range.endRow);if(u?.length!==1)return!1;const d=e.get(_e),c=e.get(P),h=Y(c,t);if(!h)return!1;const{workbook:g,worksheet:m}=h,p=g.getUnitId(),f=m.getSheetId(),v=e.get(so),C=e.get(Oe),w=u[0].range,b=u[0].primary,I=Yn(w,m,!1);if(!z.equals(w,I))return v.emit(C.t("sheets.info.partOfCell")),!1;if(cy(o,m))return v.emit(C.t("sheets.info.acrossMergedCell")),!1;const _={...w,startRow:o,endRow:o+w.endRow-w.startRow},R={unitId:p,subUnitId:f,sourceRange:w,targetRange:_},M=rR(e,R),x=e.get(U),N=d.onCommandExecute({id:Qi.id,params:t}),T=[...(n=N.preRedos)!=null?n:[],{id:Wn.id,params:R}],O=[...(s=N.preUndos)!=null?s:[],{id:Wn.id,params:M}];if(b){const k=o-r<0,D=w.endRow-w.startRow+1,B=k?_:{..._,startRow:_.startRow-D,endRow:_.endRow-D},W={unitId:p,subUnitId:f,type:Ct.MOVE_END,selections:[{range:B,primary:Ht(B,m),style:null}]},F={unitId:p,subUnitId:f,type:Ct.MOVE_END,selections:[{range:w,primary:b,style:null}]};T.push({id:me.id,params:W}),O.push({id:me.id,params:F})}if(T.push(...N.redos),O.push(...N.undos),fe(T,x).result){const k=d.afterCommandExecute({id:Qi.id,params:t});return fe(k.redos,x),T.push(...k.redos),O.push(...k.undos),e.get(ce).pushUndoRedo({unitID:p,undoMutations:O,redoMutations:T}),!0}return!1}},sS="sheet.command.move-cols",Ki={id:sS,type:H.COMMAND,handler:(e,t)=>{var n,s;const i=e.get(q),{fromRange:{startColumn:r},toRange:{startColumn:o},range:a}=t,l=a?[iS(a)]:i.getCurrentSelections(),u=l?.filter(k=>k.range.rangeType===j.COLUMN&&k.range.startColumn<=r&&r<=k.range.endColumn);if(u?.length!==1)return!1;const d=e.get(_e),c=e.get(P),h=Y(c,t);if(!h)return!1;const{workbook:g,worksheet:m}=h,p=g.getUnitId(),f=m.getSheetId(),v=e.get(so),C=e.get(Oe),w=u[0].range,b=u[0].primary,I=Yn(w,m,!1);if(!z.equals(w,I))return v.emit(C.t("sheets.info.partOfCell")),!1;if(hy(o,m))return v.emit(C.t("sheets.info.acrossMergedCell")),!1;const _={...w,startColumn:o,endColumn:o+w.endColumn-w.startColumn},R={unitId:p,subUnitId:f,sourceRange:w,targetRange:_},M=oR(e,R),x=e.get(U),N=d.onCommandExecute({id:Ki.id,params:t}),T=[...(n=N.preRedos)!=null?n:[],{id:Ln.id,params:R}],O=[...(s=N.preUndos)!=null?s:[],{id:Ln.id,params:M}];if(b){const k=w.endColumn-w.startColumn+1,D=o-r<0?_:{..._,startColumn:_.startColumn-k,endColumn:_.endColumn-k},B={unitId:p,subUnitId:f,type:Ct.MOVE_END,selections:[{range:D,primary:Ht(D,m),style:null}]},W={unitId:p,subUnitId:f,type:Ct.MOVE_END,selections:[{range:w,primary:b,style:null}]};T.push({id:me.id,params:B}),O.push({id:me.id,params:W})}if(T.push(...N.redos),O.push(...N.undos),fe(T,x).result){const k=d.afterCommandExecute({id:Ki.id,params:t});return fe(k.redos,x),T.push(...k.redos),O.push(...k.undos),e.get(ce).pushUndoRedo({unitID:p,undoMutations:O,redoMutations:T}),!0}return!1}};function iS(e){return{range:e,primary:null,style:null}}var gy=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},my=(e,t)=>(n,s)=>t(n,s,e);let zs=class extends ae{constructor(e){super(),E(this,"_sheetSkeletonStore",new Map),this._injector=e,this.disposeWithMe(()=>{this._sheetSkeletonStore=new Map})}getSkeleton(e,t){if(this._sheetSkeletonStore.has(e))return this._sheetSkeletonStore.get(e).get(t)}setSkeleton(e,t,n){this._sheetSkeletonStore.has(e)||this._sheetSkeletonStore.set(e,new Map),this._sheetSkeletonStore.get(e).set(t,n)}deleteSkeleton(e,t){this._sheetSkeletonStore.has(e)&&this._sheetSkeletonStore.get(e).delete(t)}};zs=gy([my(0,V(pt))],zs);function Np(e,t){const n=new de;return e.map(s=>De.transformRange(s,t)).forEach(s=>{De.foreach(s,(i,r)=>{const o=t.getCellHeight(i,r);o&&n.setValue(i,r,o)})}),n}const py=1e4;function fu(e,t){if(!t)return{suitableRanges:e,remainingRanges:[]};const n=t.worksheet.getColumnCount(),s=Math.ceil(py/n),i=[],r=[],o=t.getOffsetRelativeToRowCol(0,t.scrollY).row,a=e.map(u=>{let d;return o>=u.startRow&&o<=u.endRow?d=0:o<u.startRow?d=u.startRow-o:d=o-u.endRow,{range:u,distance:d,rowCount:u.endRow-u.startRow+1}});a.sort((u,d)=>u.distance!==d.distance?u.distance-d.distance:u.rowCount-d.rowCount);let l=0;for(const u of a)if(l+u.rowCount<=s)i.push(u.range),l+=u.rowCount;else{const d=s-l;if(d>0){const c={...u.range,endRow:u.range.startRow+d-1},h={...u.range,startRow:u.range.startRow+d};i.push(c),r.push(h),l=s}else r.push(u.range)}return{suitableRanges:i,remainingRanges:r}}function rS(e){let t=0;return e.forEach(()=>{t++}),t}const oS="sheet.command.reorder-range",tm={id:oS,type:H.COMMAND,handler:(e,t)=>{var n,s;const{subUnitId:i,unitId:r,range:o,order:a}=t,l=e.get(U),u={id:yd.id,params:{unitId:r,subUnitId:i,order:a,range:o}},d={id:yd.id,params:uR(u.params)},c=e.get(_e),h=c.onCommandExecute({id:tm.id,params:t}),g=[...(n=h.preRedos)!=null?n:[],u,...h.redos],m=[...(s=h.preUndos)!=null?s:[],d,...h.undos],p=fe(g,l),{suitableRanges:f,remainingRanges:v}=fu([o],e.get(zs).getSkeleton(r,i)),{undos:C,redos:w}=c.generateMutationsOfAutoHeight({unitId:r,subUnitId:i,ranges:[o],autoHeightRanges:f,lazyAutoHeightRanges:v}),b=c.afterCommandExecute({id:tm.id,params:t});return p.result?(fe([...b.redos,...w],l),e.get(ce).pushUndoRedo({unitID:r,undoMutations:[...m,...b.undos,...C],redoMutations:[...g,...b.redos,...w]}),!0):!1}},ve={MoveRangeCommandId:Xw,InsertRowCommandId:Jw,InsertColCommandId:eS,RemoveColCommandId:Ud,RemoveRowCommandId:Pd,DeleteRangeMoveLeftCommandId:Qw,DeleteRangeMoveUpCommandId:Kw,InsertRangeMoveDownCommandId:$w,InsertRangeMoveRightCommandId:Rp,MoveColsCommandId:sS,MoveRowsCommandId:nS,ReorderRangeCommandId:oS};var nt=(e=>(e[e.Set=0]="Set",e[e.Delete=1]="Delete",e[e.HorizontalMove=2]="HorizontalMove",e[e.VerticalMove=3]="VerticalMove",e[e.Unknown=4]="Unknown",e))(nt||{});const Hs=e=>{const t={...e},n=Number.isNaN(t.startRow)&&Number.isNaN(t.endRow)&&!Number.isNaN(t.startColumn)&&!Number.isNaN(t.endColumn),s=Number.isNaN(t.startColumn)&&Number.isNaN(t.endColumn)&&!Number.isNaN(t.startRow)&&!Number.isNaN(t.endRow);return(t.rangeType===j.COLUMN||n)&&(t.startRow=0,t.endRow=Ff-1),(t.rangeType===j.ROW||s)&&(t.startColumn=0,t.endColumn=zf-1),t.rangeType===j.ALL&&(t.startColumn=0,t.endColumn=zf-1,t.startRow=0,t.endRow=Ff-1),t},is=e=>{let t=e.rangeType;return e.rangeType===j.COLUMN?t=j.ROW:e.rangeType===j.ROW&&(t=j.COLUMN),{startRow:e.startColumn,endRow:e.endColumn,startColumn:e.startRow,endColumn:e.endRow,rangeType:t}},Nd=(e,t,n)=>{const s={...n},i={...t},r=(p,f)=>{const v=Math.max(p.start,f.start),C=Math.min(p.end,f.end);return C<v?null:{start:v,end:C}},o=p=>p.end-p.start+1,a=(p,f)=>({start:p.start-f.start,end:p.start-f.start+p.end-p.start}),l=(p,f)=>({start:f.start+p.start,end:f.start+p.start+p.end-p.start}),u=t.start>e.start;if(u){const p=Math.min(e.end,t.start)-e.start+1;i.start-=p,i.end-=p}const d=o(e),c=d,h=r(e,s),g=h&&o(h)>=o(s);if(e.end<s.start)s.start-=d,s.end-=d;else if(h){const p=o(h);if(g){const f=a(s,e),v=l(f,i);s.start=v.start,s.end=v.end}else h.start>e.start?u?(s.end-=p+d,s.start-=d):s.end-=p:u?s.end-=p:s.start>e.start&&s.end>e.end?(s.start-=d,s.end-=d+p):s.end-=p}const m=r(i,s);return g||(i.start<=s.start?(s.start+=c,s.end+=c):m&&(u?i.end<=s.start||i.start<=s.start&&i.end>=s.start?(s.start+=c,s.end+=c):i.start>=s.start&&i.start<=s.end&&(s.end+=c):s.start<i.start&&s.end>i.start?s.end+=c:(s.start>=i.end||s.start>=i.start&&s.start<=i.end)&&(s.end+=c,s.start+=c))),{step:s.start-n.start,length:o(s)-o(n)}},aS=(e,t)=>{const{fromRange:n,toRange:s}=e.params||{};if(!s||!n)return[];const i=Hs(n),r=Hs(s),o=Hs(t),a=Nd({start:i.startRow,end:i.endRow},{start:r.startRow,end:r.endRow},{start:o.startRow,end:o.endRow});return a===null?[{type:nt.Delete}]:[{type:nt.VerticalMove,step:a.step||0,length:a.length||0}]},fy=(e,t)=>{const{fromRange:n,toRange:s}=e.params||{};if(!n||!s)return[t];const i=n.startRow,r=n.endRow-n.startRow+1,o=s.startRow,a=new de;return De.foreach(t,(l,u)=>{a.setValue(l,u,1)}),a.moveRows(i,r,o),or(a,l=>l===1)},vy=(e,t)=>{const{range:n,order:s}=e.params||{};if(!n||!s)return[t];const i=new de;De.foreach(t,(o,a)=>{i.setValue(o,a,1)});const r=new de;return De.foreach(n,(o,a)=>{var l;if(Object.prototype.hasOwnProperty.call(s,o)){const u=s[o],d=(l=i.getValue(u,a))!=null?l:0;r.setValue(o,a,d)}}),r.forValue((o,a,l)=>{i.setValue(o,a,l)}),or(i,o=>o===1)},lS=(e,t)=>{const{fromRange:n,toRange:s}=e.params||{};if(!s||!n)return[];const i=Hs(n),r=Hs(s),o=Hs(t),a=Nd({start:i.startColumn,end:i.endColumn},{start:r.startColumn,end:r.endColumn},{start:o.startColumn,end:o.endColumn});return a===null?[{type:nt.Delete}]:[{type:nt.HorizontalMove,step:a.step||0,length:a.length||0}]},Cy=(e,t)=>{const{fromRange:n,toRange:s}=e.params||{};if(!n||!s)return[t];const i=n.startColumn,r=n.endColumn-n.startColumn+1,o=s.startColumn,a=new de;return De.foreach(t,(l,u)=>{a.setValue(l,u,1)}),a.moveColumns(i,r,o),or(a,l=>l===1)},wy=(e,t)=>{var n,s;const i=(n=e.params)==null?void 0:n.toRange,r=(s=e.params)==null?void 0:s.fromRange;if(!i||!r)return[];const o=[];if(z.contains(i,t)&&o.push({type:nt.Delete}),z.contains(r,t)){o.push({type:nt.Delete});const a=z.getRelativeRange(t,r),l=z.getPositionRange(a,i);return[{type:nt.Set,range:l}]}return o},Sy=(e,t)=>{var n,s;const i=(n=e.params)==null?void 0:n.toRange,r=(s=e.params)==null?void 0:s.fromRange;if(!i||!r)return[t];if(!z.intersects(r,t)&&!z.intersects(i,t))return[t];if(z.contains(r,t)){const h=z.getRelativeRange(t,r);return[z.getPositionRange(h,i)]}const o=new de;De.foreach(t,(h,g)=>{o.setValue(h,g,1)});const a=new de,l=z.getIntersects(r,t);l&&De.foreach(l,(h,g)=>{o.getValue(h,g)&&(o.setValue(h,g,void 0),a.setValue(h,g,1))});const u=i.startColumn-r.startColumn,d=i.startRow-r.startRow,c={startColumn:i.startColumn-u,endColumn:i.endColumn-u,startRow:i.startRow-d,endRow:i.endRow-d};return c&&De.foreach(c,(h,g)=>{var m;const p=h+d,f=g+u;o.setValue(p,f,(m=a.getValue(h,g))!=null?m:0)}),or(o,h=>h===1)},zo=(e,t)=>{const n=Hs(e),s=Hs(t),i=o=>o.endColumn-o.startColumn+1,r=o=>o.endRow-o.startRow+1;if(n.startRow<=s.startRow&&n.endRow>=s.endRow){if(s.startColumn<n.startColumn&&s.endColumn>=n.startColumn&&s.endColumn<=n.endColumn||s.startColumn<n.startColumn&&s.endColumn>=n.endColumn){const o=z.getIntersects(s,n);if(o)return{step:0,length:-i(o)}}if(s.startColumn>=n.startColumn&&s.endColumn<=n.endColumn&&r(n)>=r(s))return null;if(s.startColumn>=n.startColumn&&s.startColumn<=n.endColumn&&s.endColumn>n.endColumn){const o=z.getIntersects(s,n);if(o){const a=-i(o);return{step:-(i(n)-i(o)),length:a}}}if(s.startColumn>n.endColumn)return{step:-i(n),length:0}}return{step:0,length:0}},uS=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=zo(s,t);if(!r)i.push({type:nt.Delete});else{const{step:o,length:a}=r;i.push({type:nt.HorizontalMove,step:o,length:a})}return i},by=(e,t,n)=>{var s;const i=(s=e.params)==null?void 0:s.range;if(!i)return[];const r=[];if(n&&n.length>0){let a=i.startRow;for(let l=i.startRow;l<=i.endRow;l++){if(n.includes(l)){if(l===a){a=l+1;continue}o({...i,startRow:a,endRow:l-1}),a=l+1;continue}l===i.endRow&&o({...i,startRow:a,endRow:i.endRow})}}else o(i);function o(a){const l=zo(is(a),is(t));if(!l)r.push({type:nt.Delete});else{const{step:u,length:d}=l;r.push({type:nt.VerticalMove,step:u,length:d})}}return r},_y=(e,t)=>{const{range:n,order:s}=e.params||{};if(!n||!s)return[];if(z.contains(n,t)&&t.endRow===t.startRow){const i=[],r=t.startRow;for(const o in s)if(s[o]===r){const a=Number(o);return i.push({type:nt.VerticalMove,step:a-r,length:0}),i}return[]}return[]},Xo=(e,t)=>{const n=Hs(e),s=Hs(t),i=r=>r.endColumn-r.startColumn+1;return n.startRow<=s.startRow&&n.endRow>=s.endRow?s.startColumn<n.startColumn&&s.endColumn>=n.startColumn&&s.endColumn<=n.endColumn||s.startColumn<n.startColumn&&s.endColumn>=n.endColumn?{step:0,length:i(n)}:s.startColumn>=n.startColumn&&s.endColumn<=n.endColumn||s.startColumn>=n.startColumn&&s.startColumn<=n.endColumn&&s.endColumn>n.endColumn||s.startColumn>=n.endColumn?{step:i(n),length:0}:{step:0,length:0}:{step:0,length:0}};function Iy(e,t,n){const s=[];if(z.contains(t,n)&&s.push({type:nt.Delete}),z.contains(e,n)){s.push({type:nt.Delete});const i=z.getRelativeRange(n,e),r=z.getPositionRange(i,t);return[{type:nt.Set,range:r}]}return s}const Ry=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=Xo(is(s),is(t)),{step:o,length:a}=r;return i.push({type:nt.VerticalMove,step:o,length:a}),i},yy=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=Xo(s,t),{step:o,length:a}=r;return i.push({type:nt.HorizontalMove,step:o,length:a}),i},My=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=Xo(is(s),is(t)),{step:o,length:a}=r;return i.push({type:nt.VerticalMove,step:o,length:a}),i},Ey=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[t];const i=s.endRow-s.startRow+1,r={...s,startRow:s.startRow,endRow:Number.POSITIVE_INFINITY},o=z.subtract(t,r),a=z.getIntersects(r,t);if(!a)return[t];const l=new de;return o.forEach(u=>{De.foreach(u,(d,c)=>{l.setValue(d,c,1)})}),a&&De.foreach(a,(u,d)=>{l.setValue(u+i,d,1)}),or(l,u=>u===1)},xy=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=Xo(s,t),{step:o,length:a}=r;return i.push({type:nt.HorizontalMove,step:o,length:a}),i},ky=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[t];const i=s.endColumn-s.startColumn+1,r={...s,startColumn:s.startColumn,endColumn:Number.POSITIVE_INFINITY},o=z.subtract(t,r),a=z.getIntersects(r,t);if(!a)return[t];const l=new de;return o.forEach(u=>{De.foreach(u,(d,c)=>{l.setValue(d,c,1)})}),a&&De.foreach(a,(u,d)=>{l.setValue(u,d+i,1)}),or(l,u=>u===1)},Ty=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=zo(s,t);if(!r)i.push({type:nt.Delete});else{const{step:o,length:a}=r;i.push({type:nt.HorizontalMove,step:o,length:a})}return i},Py=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[t];const i={startRow:s.startRow,endRow:s.endRow,startColumn:s.startColumn,endColumn:Number.POSITIVE_INFINITY},r=s.endColumn-s.startColumn+1,o=z.getIntersects(s,t),a=z.subtract(t,i),l=z.getIntersects(i,t);if(!o&&!l)return[t];const u=new de;return l&&De.foreach(l,(d,c)=>{u.setValue(d,c-r,1)}),o&&De.foreach(o,(d,c)=>{u.setValue(d,c-r,0)}),a.forEach(d=>{De.foreach(d,(c,h)=>{u.setValue(c,h,1)})}),or(u,d=>d===1)},Uy=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[];const i=[],r=zo(is(s),is(t));if(!r)i.push({type:nt.Delete});else{const{step:o,length:a}=r;i.push({type:nt.VerticalMove,step:o,length:a})}return i},Ny=(e,t)=>{var n;const s=(n=e.params)==null?void 0:n.range;if(!s)return[t];const i={...s,startRow:s.startRow,endRow:Number.POSITIVE_INFINITY},r=s.endRow-s.startRow+1,o=z.getIntersects(s,t),a=z.subtract(t,i),l=z.getIntersects(i,t);if(!o&&!l)return[t];const u=new de;return l&&De.foreach(l,(d,c)=>{u.setValue(d-r,c,1)}),o&&De.foreach(o,(d,c)=>{u.setValue(d-r,c,0)}),a.forEach(d=>{De.foreach(d,(c,h)=>{u.setValue(c,h,1)})}),or(u,d=>d===1)},Oy=(e,t)=>{var n;const s=((n=e.ranges)!=null?n:[e.range]).map(a=>[a.startRow,a.endRow]),i=rw(s);let r=t.startRow,o=t.endRow;for(let a=i.length-1;a>=0;a--){const[l,u]=i[a];if(l<=t.startRow&&u>=t.endRow)return[];if(u<r){const d=u-l+1;r-=d,o-=d}else if(!(l>o)){const d=Math.max(l,r),c=Math.min(u,o)-d+1;if(o-=c,l<=r){const h=d-r;r-=h}}}return[{...t,startRow:r,endRow:o}]},Ay=(e,t)=>{const n=e.params,s=n.range.startRow,i=n.range.endRow-n.range.startRow+1;if(n.direction===Z.UP){if(s<t.startRow)return[{...t,startRow:t.startRow+i,endRow:t.endRow+i}];if(s<=t.endRow)return[{...t,endRow:t.endRow+i}]}else{if(s<=t.startRow)return[{...t,startRow:t.startRow+i,endRow:t.endRow+i}];if(s<=t.endRow+1)return[{...t,endRow:t.endRow+i}]}return[t]},Vy=(e,t)=>{const n=e.params,s=n.range.startColumn,i=n.range.endColumn-n.range.startColumn+1;if(n.direction===Z.LEFT){if(s<t.startColumn)return[{...t,startColumn:t.startColumn+i,endColumn:t.endColumn+i}];if(s<=t.endColumn)return[{...t,endColumn:t.endColumn+i}]}else{if(s<=t.startColumn)return[{...t,startColumn:t.startColumn+i,endColumn:t.endColumn+i}];if(s<=t.endColumn+1)return[{...t,endColumn:t.endColumn+i}]}return[t]},Yo=(e,t)=>{let n={...t};return e.forEach(s=>{switch(s.type){case nt.Delete:{n=null;break}case nt.HorizontalMove:{if(!n)return;n.startColumn+=s.step,n.endColumn+=s.step+(s.length||0);break}case nt.VerticalMove:{if(!n)return;n.startRow+=s.step,n.endRow+=s.step+(s.length||0);break}case nt.Set:{n=s.range;break}}}),n&&(n.endColumn<n.startColumn||n.endRow<n.startRow)?null:n},Hy=(e,t)=>{let n=[];switch(t.id){case ve.DeleteRangeMoveLeftCommandId:{n=Ty(t,e);break}case ve.DeleteRangeMoveUpCommandId:{n=Uy(t,e);break}case ve.InsertColCommandId:{n=yy(t,e);break}case ve.InsertRangeMoveDownCommandId:{n=My(t,e);break}case ve.InsertRangeMoveRightCommandId:{n=xy(t,e);break}case ve.InsertRowCommandId:{n=Ry(t,e);break}case ve.MoveColsCommandId:{n=lS(t,e);break}case ve.MoveRangeCommandId:{n=wy(t,e);break}case ve.MoveRowsCommandId:{n=aS(t,e);break}case ve.RemoveColCommandId:{n=uS(t,e);break}case ve.RemoveRowCommandId:{n=by(t,e);break}case ve.ReorderRangeCommandId:{n=_y(t,e);break}}return Yo(n,e)},dP=(e,t,n)=>[Bs.id,js.id].includes(t.id)||cS(t,n).some(s=>z.intersects(s,e))?Hy(e,t):e,Dy=(e,t)=>{let n=[];switch(t.id){case ve.DeleteRangeMoveLeftCommandId:return Py(t,e);case ve.DeleteRangeMoveUpCommandId:return Ny(t,e);case ve.InsertRangeMoveDownCommandId:return Ey(t,e);case ve.InsertRangeMoveRightCommandId:return ky(t,e);case ve.InsertColCommandId:return Vy(t,e);case ve.InsertRowCommandId:return Ay(t,e);case ve.MoveColsCommandId:return Cy(t,e);case ve.MoveRangeCommandId:return Sy(t,e);case ve.MoveRowsCommandId:return fy(t,e);case ve.ReorderRangeCommandId:return vy(t,e);case ve.RemoveColCommandId:{n=uS(t,e);break}case ve.RemoveRowCommandId:return Oy(t.params,e)}const s=Yo(n,e);return s?[s]:[]},cP=(e,t,n)=>[Bs.id,js.id,Fs.id,Rp].includes(t.id)||cS(t,n).some(s=>z.intersects(s,e))?Dy(e,t):e;function dS(e,t){const{id:n,params:s}=t;let i={length:0,step:0,type:nt.Unknown};switch(n){case En.id:i.type=nt.Delete;break;case Wn.id:i=Nd({start:s.sourceRange.startRow,end:s.sourceRange.endRow},{start:s.targetRange.startRow,end:s.targetRange.endRow},{start:e.startRow,end:e.endRow}),i.type=nt.VerticalMove;break;case Ln.id:i=Nd({start:s.sourceRange.startColumn,end:s.sourceRange.endColumn},{start:s.targetRange.startColumn,end:s.targetRange.endColumn},{start:e.startColumn,end:e.endColumn}),i.type=nt.HorizontalMove;break;case $t.id:i=zo(s.range,e),i?i.type=nt.HorizontalMove:i={step:0,length:0,type:nt.Delete};break;case an.id:i=zo(is(s.range),is(e)),i?i.type=nt.VerticalMove:i={step:0,length:0,type:nt.Delete};break;case rn.id:i=Xo(is(s.range),is(e)),i.type=nt.VerticalMove;break;case on.id:i=Xo(s.range,e),i.type=nt.HorizontalMove;break;case Mn.id:{const r=s.fromRange||new de(s.from).getRange(),o=s.toRange||new de(s.to).getRange();i=Iy(r,o,e)}break}return i?Array.isArray(i)?Yo(i,e):Yo([i],e):e}function cS(e,t){var n,s,i,r,o,a;const{selectionManagerService:l}=t;switch(e.id){case ve.MoveColsCommandId:{const u=e.params;return[u.fromRange,{...u.toRange,startColumn:u.toRange.startColumn-.5,endColumn:u.toRange.endColumn-.5}]}case ve.MoveRowsCommandId:{const u=e.params;return[u.fromRange,{...u.toRange,startRow:u.toRange.startRow-.5,endRow:u.toRange.startRow-.5}]}case ve.MoveRangeCommandId:{const u=e;return[u.params.fromRange,u.params.toRange]}case ve.InsertRowCommandId:{const u=e.params.range;return[{...u,startRow:u.startRow-.5,endRow:u.endRow-.5}]}case ve.InsertColCommandId:{const u=e.params.range;return[{...u,startColumn:u.startColumn-.5,endColumn:u.endColumn-.5}]}case ve.RemoveRowCommandId:return[e.params.range];case ve.RemoveColCommandId:return[e.params.range];case ve.DeleteRangeMoveUpCommandId:case ve.InsertRangeMoveDownCommandId:{const u=((n=e.params)==null?void 0:n.range)||((i=(s=l.getCurrentSelections())==null?void 0:s.map(d=>d.range))==null?void 0:i[0]);return u?[u]:[]}case ve.DeleteRangeMoveLeftCommandId:case ve.InsertRangeMoveRightCommandId:{const u=((r=e.params)==null?void 0:r.range)||((a=(o=l.getCurrentSelections())==null?void 0:o.map(d=>d.range))==null?void 0:a[0]);return u?[u]:[]}case ve.ReorderRangeCommandId:{const u=e,{range:d,order:c}=u.params,h=[];for(let g=d.startRow;g<=d.endRow;g++)g in c&&h.push({startRow:g,endRow:g,startColumn:d.startColumn,endColumn:d.endColumn});return h}}}function Wy(e){switch(e.id){case Ln.id:{const t=e.params;return[t.sourceRange,{...t.targetRange,startColumn:t.targetRange.startColumn-.5,endColumn:t.targetRange.startColumn-.5}]}case Wn.id:{const t=e.params;return[t.sourceRange,{...t.targetRange,startRow:t.targetRange.startRow-.5,endRow:t.targetRange.startRow-.5}]}case Mn.id:{const t=e.params;return[new de(t.from.value).getRange(),new de(t.to.value).getRange()]}case on.id:{const t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.startColumn-.5}]}case rn.id:{const t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.startRow-.5}]}case $t.id:return[e.params.range];case an.id:return[e.params.range]}}function hP(e,t){const n=e.get(P);switch(t.id){case ve.MoveColsCommandId:{const s=t.params,i=Y(n,s);if(!i)return;const{unitId:r,subUnitId:o}=i,{fromRange:a,toRange:l}=s;return{unitId:r,subUnitId:o,ranges:[a,{...l,startColumn:a.startColumn<l.startColumn?a.endColumn+1:l.startColumn,endColumn:a.startColumn<l.startColumn?l.endColumn-1:a.startColumn-1}]}}case ve.MoveRowsCommandId:{const s=t.params,i=Y(n,s);if(!i)return;const{unitId:r,subUnitId:o}=i,{fromRange:a,toRange:l}=s;return{unitId:r,subUnitId:o,ranges:[a,{...l,startRow:a.startRow<l.startRow?a.endRow+1:l.startRow,endRow:a.startRow<l.startRow?l.endRow-1:a.startRow-1}]}}case ve.MoveRangeCommandId:{const s=t.params,i=Y(n);if(!i)return;const{unitId:r,subUnitId:o}=i,{fromRange:a,toRange:l}=s;return{unitId:r,subUnitId:o,ranges:[a,l]}}case ve.InsertRowCommandId:{const s=t.params,i=Y(n,s);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[...l.startRow>0?[{...l,startRow:l.startRow-1,endRow:l.endRow-1}]:[],{...l,startRow:l.startRow,endRow:r.getRowCount()-1}]}}case ve.InsertColCommandId:{const s=t.params,i=Y(n,s);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[...l.startColumn>0?[{...l,startColumn:l.startColumn-1,endColumn:l.endColumn-1}]:[],{...l,startColumn:l.startColumn,endColumn:r.getColumnCount()-1}]}}case ve.RemoveRowCommandId:{const s=t.params,i=Y(n);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[l,{...l,startRow:l.endRow+1,endRow:r.getRowCount()-1}]}}case ve.RemoveColCommandId:{const s=t.params,i=Y(n);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[l,{...l,startColumn:l.endColumn+1,endColumn:r.getColumnCount()-1}]}}case ve.DeleteRangeMoveUpCommandId:case ve.InsertRangeMoveDownCommandId:{const s=t.params,i=Y(n);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[l,{...l,startRow:l.endRow+1,endRow:r.getRowCount()-1}]}}case ve.DeleteRangeMoveLeftCommandId:case ve.InsertRangeMoveRightCommandId:{const s=t.params,i=Y(n);if(!i)return;const{worksheet:r,unitId:o,subUnitId:a}=i,{range:l}=s;return{unitId:o,subUnitId:a,ranges:[l,{...l,startColumn:l.endColumn+1,endColumn:r.getColumnCount()-1}]}}case ve.ReorderRangeCommandId:{const s=t.params,i=Y(n);if(!i)return;const{unitId:r,subUnitId:o}=i,{range:a,order:l}=s,u=[];for(let d=a.startRow;d<=a.endRow;d++)d in l&&u.push({startRow:d,endRow:d,startColumn:a.startColumn,endColumn:a.endColumn});return{unitId:r,subUnitId:o,ranges:u}}}}var Ly=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Du=(e,t)=>(n,s)=>t(n,s,e);const By=gn("MERGE_REDO"),jy=gn("MERGE_UNDO");class Fy extends ae{constructor(t,n,s,i,r=!1){super(),this._unitId=t,this._subUnitId=n,this._range=s,this._callback=i,this._skipIntersects=r}onMutation(t){var n,s;if(((n=t.params)==null?void 0:n.unitId)!==this._unitId)return;if(t.id===Mn.id){const o=t.params;if(o.from.subUnitId!==this._subUnitId||o.to.subUnitId!==this._subUnitId)return}else if(((s=t.params)==null?void 0:s.subUnitId)!==this._subUnitId)return;if(!this._range)return;if(this._skipIntersects){if(t.id===En.id)return;const o=Wy(t);if(o!=null&&o.some(a=>z.intersects(a,this._range)))return}const i=dS(this._range,t);if(i&&z.equals(i,this._range))return!1;const r=this._range;this._range=i,this._callback(r,i)}}let Ar=class extends ae{constructor(e,t,n,s){super(),E(this,"interceptor",new Ci({MERGE_REDO:By,MERGE_UNDO:jy})),E(this,"_watchRanges",new Set),E(this,"_refRangeManagerMap",new Map),E(this,"_serializer",Yy()),E(this,"_onRefRangeChange",()=>{this._sheetInterceptorService.interceptCommand({getMutations:i=>{const r=(()=>{switch(i.id){case ve.MoveColsCommandId:{const c=i.params,h=Y(this._univerInstanceService,c);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f=Math.min(c.fromRange.startColumn,c.toRange.startColumn);return this._checkRange([{...c.fromRange,startColumn:f,endColumn:g.getColumnCount()-1}],m,p)}case ve.MoveRowsCommandId:{const c=i.params,h=Y(this._univerInstanceService,c);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f=Math.min(c.fromRange.startRow,c.toRange.startRow);return this._checkRange([{...c.fromRange,startRow:f,endRow:g.getRowCount()-1}],m,p)}case ve.MoveRangeCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{unitId:g,subUnitId:m}=h;return this._checkRange([c.fromRange,c.toRange],g,m)}case ve.InsertRowCommandId:{const c=i.params,h=Y(this._univerInstanceService,c);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={startRow:Math.max(0,c.range.startRow-1),endRow:g.getRowCount()-1,startColumn:0,endColumn:g.getColumnCount()-1,rangeType:j.ROW};return this._checkRange([f],m,p)}case ve.InsertColCommandId:{const c=i.params,h=Y(this._univerInstanceService,c);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={startRow:0,endRow:g.getRowCount()-1,startColumn:Math.max(0,c.range.startColumn-1),endColumn:g.getColumnCount()-1,rangeType:j.COLUMN};return this._checkRange([f],m,p)}case ve.RemoveRowCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={startRow:c.range.startRow,endRow:g.getRowCount()-1,startColumn:0,endColumn:g.getColumnCount()-1,rangeType:j.ROW};return this._checkRange([f],m,p)}case ve.RemoveColCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={startRow:0,endRow:g.getRowCount()-1,startColumn:c.range.startColumn,endColumn:g.getColumnCount()-1,rangeType:j.COLUMN};return this._checkRange([f],m,p)}case ve.DeleteRangeMoveUpCommandId:case ve.InsertRangeMoveDownCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={...c.range,endRow:g.getRowCount()-1};return this._checkRange([f],m,p)}case ve.DeleteRangeMoveLeftCommandId:case ve.InsertRangeMoveRightCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{worksheet:g,unitId:m,subUnitId:p}=h,f={...c.range,endColumn:g.getColumnCount()-1};return this._checkRange([f],m,p)}case ve.ReorderRangeCommandId:{const c=i.params,h=Y(this._univerInstanceService);if(!h)return[];const{unitId:g,subUnitId:m}=h,{range:p,order:f}=c,v=[];for(let C=p.startRow;C<=p.endRow;C++)C in f&&v.push({startRow:C,endRow:C,startColumn:p.startColumn,endColumn:p.endColumn});return this._checkRange(v,g,m)}}})();if(!r||r.length===0)return{redos:[],undos:[],preRedos:[],preUndos:[]};const o=r.reduce((c,h)=>{const g=h(i);return c.push(g),c},[]).reduce((c,h)=>{var g,m;return c.redos.push(...h.redos),c.undos.push(...h.undos),c.preRedos.push(...(g=h.preRedos)!=null?g:[]),c.preUndos.push(...(m=h.preUndos)!=null?m:[]),c},{redos:[],undos:[],preUndos:[],preRedos:[]}),a=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(o.preRedos,null)||[],l=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(o.redos,null)||[],u=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(o.preUndos,null)||[],d=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(o.undos,null)||[];return{redos:l,undos:d,preRedos:a,preUndos:u}}})}),E(this,"_checkRange",(i,r,o)=>{const a=fv(r,o),l=this._refRangeManagerMap.get(a);if(l){const u=new Set;return[...l.keys()].forEach(d=>{const c=l.get(d),h=this._serializer.deserialize(d),g={...h,startRow:+h.startRow,endRow:+h.endRow,startColumn:+h.startColumn,endColumn:+h.endColumn,rangeType:h.rangeType&&+h.rangeType};i.some(m=>z.intersects(m,g))&&c&&c.forEach(m=>{u.add(m)})}),[...u]}return[]}),E(this,"registerRefRange",(i,r,o,a)=>{const l=o||zy(this._univerInstanceService),u=a||Xy(this._univerInstanceService);if(!l||!u)return He(()=>{});const d=fv(l,u),c=this._serializer.serialize(i);let h=this._refRangeManagerMap.get(d);h||(h=new Map,this._refRangeManagerMap.set(d,h));const g=h.get(c);return g?g.add(r):h.set(c,new Set([r])),He(()=>{const m=h.get(c);m&&(m.delete(r),m.size||(h.delete(c),h.size||this._refRangeManagerMap.delete(d)))})}),this._commandService=e,this._sheetInterceptorService=t,this._univerInstanceService=n,this._selectionManagerService=s,this._onRefRangeChange(),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_REDO,{priority:-1,handler:i=>i}),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_UNDO,{priority:-1,handler:i=>i})}watchRange(e,t,n,s,i){let r;this._watchRanges.size===0&&(r=this._commandService.onCommandExecuted(u=>{if(u.type!==H.MUTATION)return!1;for(const d of this._watchRanges)d.onMutation(u)}));const o=new Fy(e,t,n,s,i);this._watchRanges.add(o);const a=He(()=>{this._watchRanges.delete(o),this._watchRanges.size===0&&(r?.dispose(),r=null)}),l=this.disposeWithMe(a);return He(()=>{l.dispose(),a.dispose()})}};Ar=Ly([Du(0,U),Du(1,V(_e)),Du(2,V(P)),Du(3,V(q))],Ar);function zy(e){var t;return(t=e.getCurrentUnitOfType(A.UNIVER_SHEET))==null?void 0:t.getUnitId()}function Xy(e){var t,n;return(n=(t=e.getCurrentUnitOfType(A.UNIVER_SHEET))==null?void 0:t.getActiveSheet())==null?void 0:n.getSheetId()}function fv(e,t){return`${e}_${t}`}function Yy(){const e=["startRow","startColumn","endRow","endColumn","rangeType"];return{deserialize:t=>{const n=e.reduce((s,i,r)=>(s[String(r)]=i,s),{});return t.split("_").reduce((s,i,r)=>{const o=String(r);return i&&n[o]&&(s[n[o]]=i),s},{})},serialize:t=>e.reduce((n,s,i)=>{const r=t[s];return r!==void 0?`${n}${i>0?"_":""}${r}`:`${n}`},"")}}var Zy=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},vo=(e,t)=>(n,s)=>t(n,s,e);const Gy=[on.id,rn.id,$t.id,an.id],qy=[Wn.id,Ln.id];function Vr(e,t){let n=e;if(t!==void 0){const s=[];for(let i=0;i<n.length;i++){const{startRow:r,endRow:o,startColumn:a,endColumn:l}=n[i];if(t===Dt.ROWS)for(let u=r;u<=o;u++){const d={startRow:u,endRow:u,startColumn:a,endColumn:l};s.push(d)}else if(t===Dt.COLUMNS)for(let u=a;u<=l;u++){const d={startRow:r,endRow:o,startColumn:u,endColumn:u};s.push(d)}}n=s}return n}const hS=gn("mergeCellPermissionCheck");let Ml=class extends ae{constructor(e,t,n,s,i,r){super(),E(this,"disposableCollection",new Et),E(this,"interceptor",new Ci({MERGE_CELL_INTERCEPTOR_CHECK:hS})),this._commandService=e,this._refRangeService=t,this._univerInstanceService=n,this._injector=s,this._sheetInterceptorService=i,this._selectionManagerService=r,this._onRefRangeChange(),this._initCommandInterceptor(),this._commandExecutedListener()}_initCommandInterceptor(){const e=this;this._sheetInterceptorService.interceptCommand({getMutations(t){var n;switch(t.id){case Os.id:case Vs.id:{const s=e._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),i=s.getUnitId(),r=s?.getActiveSheet();if(!r)return{redos:[],undos:[]};const o=r.getSheetId(),a=r.getConfig().mergeData,l=(n=e._selectionManagerService.getCurrentSelections())==null?void 0:n.map(u=>u.range);if(l&&l.length>0&&l.some(u=>a.some(d=>z.intersects(d,u)))){const u={unitId:i,subUnitId:o,ranges:l},d=pn(e._injector,u),c=[{id:et.id,params:u}],h=[{id:qe.id,params:d}];return{redos:c,undos:h}}}}return{redos:[],undos:[]}}}),this._sheetInterceptorService.interceptRanges({getMutations:({unitId:t,subUnitId:n,ranges:s})=>{const i=[],r=[],o={redos:i,undos:r};if(!s||!s.length)return o;const a=Y(this._univerInstanceService,{unitId:t,subUnitId:n});if(!a)return o;const{worksheet:l}=a,u=l.getMergeData().filter(d=>s.some(c=>z.intersects(d,c)));return u.length?(i.push({id:et.id,params:{unitId:t,subUnitId:n,ranges:u}}),r.push({id:qe.id,params:{unitId:t,subUnitId:n,ranges:u}}),{undos:r,redos:i}):o}})}refRangeHandle(e,t,n){switch(e.id){case ve.MoveColsCommandId:{const s=e.params;return this._handleMoveColsCommand(s,t,n)}case ve.MoveRowsCommandId:{const s=e.params;return this._handleMoveRowsCommand(s,t,n)}case bs.id:{const s=e.params,i=s.unitId||t,r=s.subUnitId||n;return this._handleInsertRowCommand(s,i,r)}case _s.id:{const s=e.params,i=s.unitId||t,r=s.subUnitId||n;return this._handleInsertColCommand(s,i,r)}case Pa.id:{const s=e.params;return this._handleRemoveColCommand(s,t,n)}case Ta.id:{const s=e.params;return this._handleRemoveRowCommand(s,t,n)}case zi.id:{const s=e.params;return this._handleMoveRangeCommand(s,t,n)}case gi.id:{const s=e.params;return this._handleInsertRangeMoveRightCommand(s,t,n)}case Fs.id:{const s=e.params;return this._handleInsertRangeMoveDownCommand(s,t,n)}case js.id:{const s=e.params;return this._handleDeleteRangeMoveUpCommand(s,t,n)}case Bs.id:{const s=e.params;return this._handleDeleteRangeMoveLeftCommand(s,t,n)}}return{redos:[],undos:[]}}_onRefRangeChange(){const e=(t,n)=>{const s=this._univerInstanceService.getUniverSheetInstance(t);if(!s)return;const i=s?.getSheetBySheetId(n);if(!i)return;this.disposableCollection.dispose();const r=i.getMergeData(),o=a=>this.refRangeHandle(a,t,n);r.forEach(a=>{this.disposableCollection.add(this._refRangeService.registerRefRange(a,o,t,n))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===lt.id){const n=t.params,s=n.subUnitId,i=n.unitId;if(!s||!i)return;e(i,s)}if(t.id===qe.id){const n=t.params,s=n.subUnitId,i=n.unitId;if(!s||!i)return;e(n.unitId,n.subUnitId)}})),this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe(Z_(t=>!!t)).subscribe(t=>{const n=t.getActiveSheet();n&&e(t.getUnitId(),n.getSheetId())})}_handleMoveRowsCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=[...i.getMergeData()],o={unitId:t,subUnitId:n,ranges:[]},a={unitId:t,subUnitId:n,ranges:[]},{fromRange:l}=e,{startRow:u,endRow:d}=l;if(r.forEach(g=>{if(u<=g.startRow&&d>=g.endRow){o.ranges.push(g);const m=aS({id:ve.MoveRowsCommandId,params:e},g),p=Yo(m,g);p&&a.ranges.push(p)}}),o.ranges.length===0)return this._handleNull();const c=pn(this._injector,o),h=On(this._injector,a);return{preRedos:[{id:et.id,params:o}],redos:[{id:qe.id,params:a}],preUndos:[{id:et.id,params:h}],undos:[{id:qe.id,params:c}]}}_handleMoveColsCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=[...i.getMergeData()],o={unitId:t,subUnitId:n,ranges:[]},a={unitId:t,subUnitId:n,ranges:[]},{fromRange:l}=e,{startColumn:u,endColumn:d}=l;if(r.forEach(g=>{if(u<=g.startColumn&&d>=g.endColumn){o.ranges.push(g);const m=lS({id:ve.MoveColsCommandId,params:e},g),p=Yo(m,g);p&&a.ranges.push(p)}}),o.ranges.length===0)return this._handleNull();const c=pn(this._injector,o),h=On(this._injector,a);return{preRedos:[{id:et.id,params:o}],redos:[{id:qe.id,params:a}],preUndos:[{id:et.id,params:h}],undos:[{id:qe.id,params:c}]}}_handleMoveRangeCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=i.getMergeData(),o=r.filter(h=>z.intersects(h,e.fromRange)),a=r.filter(h=>z.intersects(h,e.toRange)),l=o.map(h=>z.getRelativeRange(h,e.fromRange)).map(h=>z.getPositionRange(h,e.toRange)),u=Vr(l).filter(h=>!r.some(g=>z.equals(h,g))),d=[{id:et.id,params:{unitId:t,subUnitId:n,ranges:o}},{id:et.id,params:{unitId:t,subUnitId:n,ranges:a}},{id:qe.id,params:{unitId:t,subUnitId:n,ranges:u}}],c=[{id:et.id,params:{unitId:t,subUnitId:n,ranges:u}},{id:qe.id,params:{unitId:t,subUnitId:n,ranges:a}},{id:qe.id,params:{unitId:t,subUnitId:n,ranges:o}}];return{redos:d,undos:c}}_handleInsertRowCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const{range:r}=e,{startRow:o,endRow:a}=r,l=Q.deepClone(i.getMergeData()).reduce((f,v)=>(o>v.startRow&&o<=v.endRow&&f.push(v),f),[]);if(l.length===0)return this._handleNull();const u=Q.deepClone(i.getMergeData()).reduce((f,v)=>{if(o>v.startRow&&o<=v.endRow){const C=a-o+1;v.endRow+=C,this._checkIsMergeCell(v)&&f.push(v)}return f},[]),d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d},{id:qe.id,params:h}],p=[{id:et.id,params:g},{id:qe.id,params:c}];return{redos:m,undos:p}}_handleInsertColCommand(e,t,n){const{range:s}=e,i=ps(this._univerInstanceService,t);if(!i)return this._handleNull();const r=fs(i,n);if(!r)return this._handleNull();const{startColumn:o,endColumn:a}=s,l=Q.deepClone(r.getMergeData()).reduce((f,v)=>(o>v.startColumn&&o<=v.endColumn&&f.push(v),f),[]);if(l.length===0)return this._handleNull();const u=Q.deepClone(r.getMergeData()).reduce((f,v)=>{if(o>v.startColumn&&o<=v.endColumn){const C=a-o+1;v.endColumn+=C,this._checkIsMergeCell(v)&&f.push(v)}return f},[]),d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d},{id:qe.id,params:h}],p=[{id:et.id,params:g},{id:qe.id,params:c}];return{redos:m,undos:p}}_handleRemoveColCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const{range:r}=e,{startColumn:o,endColumn:a}=r,l=Q.deepClone(i.getMergeData()).reduce((C,w)=>(z.intersects(r,w)&&C.push(w),C),[]);if(l.length===0)return this._handleNull();const u=Q.deepClone(i.getMergeData()).reduce((C,w)=>{if(z.intersects(r,w)){if(o<=w.startColumn&&a>=w.endColumn)return C;o>=w.startColumn&&a<=w.endColumn?w.endColumn-=a-o+1:o<w.startColumn?(w.startColumn=o,w.endColumn-=a-o+1):a>w.endColumn&&(w.endColumn=o-1),this._checkIsMergeCell(w)&&C.push(w)}return C},[]),d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d}],p=[{id:qe.id,params:h}],f=[{id:et.id,params:g}],v=[{id:qe.id,params:c}];return{preUndos:f,undos:v,preRedos:m,redos:p}}_handleRemoveRowCommand(e,t,n){const{range:s}=e,i=ps(this._univerInstanceService,t);if(!i)return this._handleNull();const r=fs(i,n);if(!r)return this._handleNull();const{startRow:o,endRow:a}=s,l=Q.deepClone(r.getMergeData()).reduce((C,w)=>(z.intersects(s,w)&&C.push(w),C),[]);if(l.length===0)return this._handleNull();const u=Q.deepClone(r.getMergeData()).reduce((C,w)=>{if(z.intersects(s,w)){if(o<=w.startRow&&a>=w.endRow)return C;o>=w.startRow&&a<=w.endRow?w.endRow-=a-o+1:o<w.startRow?(w.startRow=o,w.endRow-=a-o+1):a>w.endRow&&(w.endRow=o-1),this._checkIsMergeCell(w)&&C.push(w)}return C},[]),d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d}],p=[{id:qe.id,params:h}],f=[{id:et.id,params:g}],v=[{id:qe.id,params:c}];return{preUndos:f,undos:v,preRedos:m,redos:p}}_handleInsertRangeMoveRightCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=e.range,o=i.getMaxColumns()-1,a=i.getMergeData(),l=[],u=[];a.forEach(m=>{const{startRow:p,endRow:f,startColumn:v,endColumn:C}=r;if(z.intersects({startRow:p,startColumn:v,endRow:f,endColumn:o},m)&&(l.push(m),z.contains({startRow:p,startColumn:v,endRow:f,endColumn:o},m))){const w=C-v+1;u.push({startRow:m.startRow,startColumn:m.startColumn+w,endRow:m.endRow,endColumn:m.endColumn+w})}});const d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h);return{preRedos:[{id:et.id,params:d}],redos:[{id:qe.id,params:h}],preUndos:[{id:et.id,params:g}],undos:[{id:qe.id,params:c}]}}_handleInsertRangeMoveDownCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=e.range,o=i.getMaxRows()-1,a=i.getMergeData(),l=[],u=[];a.forEach(C=>{const{startRow:w,startColumn:b,endColumn:I,endRow:_}=r;if(z.intersects({startRow:w,startColumn:b,endRow:o,endColumn:I},C)&&(l.push(C),z.contains({startRow:w,startColumn:b,endRow:o,endColumn:I},C))){const R=_-w+1;u.push({startRow:C.startRow+R,startColumn:C.startColumn,endRow:C.endRow+R,endColumn:C.endColumn})}});const d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d}],p=[{id:qe.id,params:h}],f=[{id:et.id,params:g}],v=[{id:qe.id,params:c}];return{redos:p,undos:v,preRedos:m,preUndos:f}}_handleDeleteRangeMoveUpCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=e.range,o=i.getMaxRows()-1,a=i.getMergeData(),l=[],u=[];a.forEach(C=>{const{startRow:w,startColumn:b,endColumn:I,endRow:_}=r;if(z.intersects({startRow:w,startColumn:b,endRow:o,endColumn:I},C)&&(l.push(C),z.contains({startRow:w,startColumn:b,endRow:o,endColumn:I},C))){const R=_-w+1,M=z.moveVertical(C,-R);u.push(M)}});const d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h),m=[{id:et.id,params:d}],p=[{id:qe.id,params:h}],f=[{id:et.id,params:g}],v=[{id:qe.id,params:c}];return{redos:p,undos:v,preRedos:m,preUndos:f}}_handleDeleteRangeMoveLeftCommand(e,t,n){const s=ps(this._univerInstanceService,t);if(!s)return this._handleNull();const i=fs(s,n);if(!i)return this._handleNull();const r=e.range,o=i.getMaxColumns()-1,a=i.getMergeData(),l=[],u=[];a.forEach(m=>{const{startRow:p,endRow:f,startColumn:v,endColumn:C}=r;if(z.intersects({startRow:p,startColumn:v,endRow:f,endColumn:o},m)&&(l.push(m),z.contains({startRow:p,startColumn:v,endRow:f,endColumn:o},m))){const w=C-v+1;u.push({startRow:m.startRow,startColumn:m.startColumn-w,endRow:m.endRow,endColumn:m.endColumn-w})}});const d={unitId:t,subUnitId:n,ranges:l},c=pn(this._injector,d),h={unitId:t,subUnitId:n,ranges:u},g=On(this._injector,h);return{preRedos:[{id:et.id,params:d}],redos:[{id:qe.id,params:h}],undos:[{id:qe.id,params:c}],preUndos:[{id:et.id,params:g}]}}_checkIsMergeCell(e){return!(e.startRow===e.endRow&&e.startColumn===e.endColumn)}_handleNull(){return{redos:[],undos:[]}}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(qy.includes(e.id)){if(!e.params)return;const t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;const n=t.getSheetBySheetId(e.params.subUnitId);if(!n)return;const{sourceRange:s,targetRange:i}=e.params,r=s.startColumn===i.startColumn&&s.endColumn===i.endColumn,o=r?s.endRow-s.startRow+1:s.endColumn-s.startColumn+1,a=r?s.startRow:s.startColumn,l=r?i.startRow:i.startColumn,u=n.getConfig().mergeData,d=[];u.forEach(m=>{let{startRow:p,endRow:f,startColumn:v,endColumn:C,rangeType:w}=m;z.intersects(m,s)||(r?a<p&&l>f?(p-=o,f-=o):a>f&&l<=p&&(p+=o,f+=o):a<v&&l>C?(v-=o,C-=o):a>C&&l<=v&&(v+=o,C+=o)),m.startRow===m.endRow&&m.startColumn===m.endColumn||d.push({startRow:p,endRow:f,startColumn:v,endColumn:C,rangeType:w})}),n.setMergeData(d),this.disposableCollection.dispose();const{unitId:c,subUnitId:h}=e.params,g=m=>this.refRangeHandle(m,c,h);d.forEach(m=>{this.disposableCollection.add(this._refRangeService.registerRefRange(m,g,c,h))})}if(Gy.includes(e.id)){const t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;const n=t.getSheetBySheetId(e.params.subUnitId);if(!n)return;const s=n.getConfig().mergeData,i=e.params;if(!i)return;const{range:r}=i,o=e.id.includes("row"),a=e.id.includes("insert"),l=o?r.startRow:r.startColumn,u=o?r.endRow:r.endColumn,d=u-l+1,c=[];s.forEach(p=>{let{startRow:f,endRow:v,startColumn:C,endColumn:w,rangeType:b}=p;a?o?l<=f&&(f+=d,v+=d):l<=C&&(C+=d,w+=d):o?u<f&&(f-=d,v-=d):u<C&&(C-=d,w-=d),p.startRow===p.endRow&&p.startColumn===p.endColumn||c.push({startRow:f,endRow:v,startColumn:C,endColumn:w,rangeType:b})}),n.setMergeData(c),this.disposableCollection.dispose();const{unitId:h,subUnitId:g}=e.params,m=p=>this.refRangeHandle(p,h,g);c.forEach(p=>{this.disposableCollection.add(this._refRangeService.registerRefRange(p,m,h,g))})}}))}};Ml=Zy([vo(0,V(U)),vo(1,V(Ar)),vo(2,V(P)),vo(3,V(pt)),vo(4,V(_e)),vo(5,V(q))],Ml);function ps(e,t){return t?e.getUniverSheetInstance(t):e.getCurrentUnitForType(A.UNIVER_SHEET)}function fs(e,t){return t?e.getSheetBySheetId(t):e.getActiveSheet()}const Qy=(e,t,n)=>{const s=e.get(q).getCurrentSelections(),{value:i,selections:r,unitId:o,subUnitId:a}=t;if(s&&s.length>0){const l=s[s?.length-1].primary;if(l){const{actualColumn:u,actualRow:d}=l;let{startRow:c,startColumn:h,endRow:g,endColumn:m}=r[r.length-1];if(i===Dt.COLUMNS){const C=n.find(w=>w.startColumn===u&&w.endColumn===u&&d===w.startRow);C&&(m=C.endColumn,c=C.startRow,g=C.endRow)}else if(i===Dt.ROWS){const C=n.find(w=>w.startRow===d&&w.endRow===d&&u===w.startColumn);C&&(g=C.endRow,h=C.startColumn,m=C.endColumn)}const p={startRow:c,startColumn:h,endRow:g,endColumn:m,actualRow:d,actualColumn:u,isMerged:!0,isMergedMainCell:c===d&&h===u},f=s.map((C,w,b)=>({range:C.range,style:null,primary:w===b.length-1?p:null})),v={unitId:o,subUnitId:a,type:Ct.ONLY_SET,selections:f};return{id:me.id,params:v}}return null}return null},Ky=(e,t)=>{const n=e.get(q).getCurrentSelections(),{unitId:s,subUnitId:i}=t;if(n&&n.length>0&&n[n?.length-1].primary){const r={unitId:s,subUnitId:i,type:Ct.ONLY_SET,selections:[...n]};return{id:me.id,params:r}}return null},vu={type:H.COMMAND,id:"sheet.command.remove-worksheet-merge",handler:(e,t)=>{var n;const s=e.get(q),i=e.get(U),r=e.get(ce),o=t?.ranges||((n=s.getCurrentSelections())==null?void 0:n.map(_=>_.range));if(!(o!=null&&o.length))return!1;const a=Y(e.get(P),t);if(!a)return!1;const{subUnitId:l,unitId:u,worksheet:d}=a,c={unitId:u,subUnitId:l,ranges:o},h=d.getConfig().mergeData.filter(_=>o.some(R=>z.intersects(R,_)));if(!h.length)return!1;const g=pn(e,c),m=s.getCurrentSelections(),p=Q.deepClone(m),f=Q.deepClone(m);if(m.length){const _=f[f.length-1],{startRow:R,startColumn:M}=_.range;_.primary={startRow:R,startColumn:M,endRow:R,endColumn:M,actualRow:R,actualColumn:M,isMerged:!1,isMergedMainCell:!1}}const v=$y(d,h),C={unitId:u,subUnitId:l,cellValue:v.getMatrix()},w=Vt(e,C),b=[{id:et.id,params:g},{id:le.id,params:C},{id:me.id,params:{unitId:u,subUnitId:l,selections:f,type:Ct.ONLY_SET}}],I=[{id:qe.id,params:g},{id:le.id,params:w},{id:me.id,params:{unitId:u,subUnitId:l,selections:p,type:Ct.ONLY_SET}}];return fe(b,i)?(r.pushUndoRedo({unitID:u,undoMutations:I,redoMutations:b}),!0):!1}};function $y(e,t){const n=new de;return t.forEach(s=>{const{startRow:i,startColumn:r,endColumn:o,endRow:a}=s,l=e.getCellMatrix().getValue(i,r);if(l!=null&&l.s)for(let u=i;u<=a;u++)for(let d=r;d<=o;d++)(u!==i||d!==r)&&n.setValue(u,d,{s:l.s})}),n}function Jy(e,t){return t.some(n=>eM(e,n))}function eM(e,t){const{startRow:n,startColumn:s,endColumn:i,endRow:r}=t,o=e.getMatrixWithMergedCells(n,s,r,i);let a=!1;return o.forValue((l,u,d)=>{if(d&&(l!==n||u!==s)&&e.cellHasValue(d))return a=!0,!1}),a}function gS(e,t,n,s){const i=[],r=[],o=n.getSheetId();return s.forEach(a=>{const l=tM(n,a),u={unitId:t,subUnitId:o,cellValue:l.getData()},d=Vt(e,u);i.push({id:le.id,params:d}),r.push({id:le.id,params:u})}),{undos:i,redos:r}}function tM(e,t){const{startRow:n,startColumn:s,endColumn:i,endRow:r}=t,o=e.getMatrixWithMergedCells(n,s,r,i,sw.Raw),a=new de;let l=null;return o.forValue((u,d,c)=>{var h,g,m,p;c&&u>=n&&d>=s&&(!l&&e.cellHasValue(c)&&(c.v!==""||((p=(m=(g=(h=c.p)==null?void 0:h.body)==null?void 0:g.dataStream)==null?void 0:m.length)!=null?p:0)>2)&&(l=c),a.setValue(u,d,c.s?{v:null,t:null,f:null,si:null,p:null,s:c.s}:null))}),a.setValue(n,s,l),a}const bi={type:H.COMMAND,id:"sheet.command.add-worksheet-merge",handler:async(e,t)=>{const n=e.get(P),s=Y(n,t);if(!s)return!1;const{worksheet:i}=s,{unitId:r,subUnitId:o,selections:a}=t,l=e.get(U),u=e.get(ce),d=Vr(a,t.value),c=Jy(i,d);if(c&&!t.defaultMerge){const I=e.get(ys),_=e.get(Oe);if(!await I.confirm({id:"merge.confirm.add-worksheet-merge",title:{title:"merge.confirm.warning"},children:{title:"merge.confirm.title"},cancelText:_.t("merge.confirm.cancel"),confirmText:_.t("merge.confirm.confirm")}))return!1}const h=[],g=[],m={unitId:r,subUnitId:o,ranges:Q.deepClone(d)},p={unitId:r,subUnitId:o,ranges:Q.deepClone(d)},f=pn(e,m),v=On(e,p);if(f.ranges.length>0&&h.push({id:et.id,params:f}),h.push({id:qe.id,params:p}),g.push({id:et.id,params:v}),f.ranges.length>0&&g.push({id:qe.id,params:f}),c){const I=gS(e,r,i,d);h.unshift(...I.redos),g.push(...I.undos)}const C=Qy(e,t,d);C&&h.push(C);const w=Ky(e,t);w&&g.push(w);const b=e.get(_e).onCommandExecute({id:bi.id,params:{unitId:r,subUnitId:o,ranges:d}});return h.push(...b.redos),g.push(...b.undos),fe(h,l).result?(u.pushUndoRedo({unitID:r,undoMutations:g,redoMutations:h}),!0):!1}},Op={type:H.COMMAND,id:"sheet.command.add-worksheet-merge-all",handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(u=>u.range),s=Hp("mergeAll",n);if(!(s!=null&&s.length))return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o}=r,a=o.getUnitId(),l=o.getSheetId();return e.get(U).executeCommand(bi.id,{selections:s,unitId:a,subUnitId:l})}},Ap={type:H.COMMAND,id:"sheet.command.add-worksheet-merge-vertical",handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(u=>u.range),s=Hp("mergeVertical",n);if(!(s!=null&&s.length))return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o}=r,a=o.getUnitId(),l=o.getSheetId();return e.get(U).executeCommand(bi.id,{value:Dt.COLUMNS,selections:s,unitId:a,subUnitId:l})}},Vp={type:H.COMMAND,id:"sheet.command.add-worksheet-merge-horizontal",handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(d=>d.range),s=Hp("mergeHorizontal",n);if(!(s!=null&&s.length))return!1;const i=e.get(P),r=Y(i);if(!r)return!1;const{workbook:o,worksheet:a}=r,l=o.getUnitId(),u=a.getSheetId();return e.get(U).executeCommand(bi.id,{value:Dt.ROWS,selections:s,unitId:l,subUnitId:u})}};function zh(e,t,n,s,i={}){const r=Y(e.get(P),{unitId:t,subUnitId:n});if(!r)return;const o=e.get(U),{defaultMerge:a=!0,isForceMerge:l=!1}=i,{worksheet:u}=r;if(u.getMergeData().some(d=>s.some(c=>z.intersects(c,d)))){if(!l)throw new Error("The ranges to be merged overlap with the existing merged cells");o.syncExecuteCommand(vu.id,{unitId:t,subUnitId:n,ranges:s})}o.executeCommand(bi.id,{unitId:t,subUnitId:n,selections:s,defaultMerge:a})}function Hp(e,t){return t?e==="mergeAll"?t.filter(n=>!(n.startRow===n.endRow&&n.startColumn===n.endColumn)):e==="mergeVertical"?t.filter(n=>n.startRow!==n.endRow):e==="mergeHorizontal"?t.filter(n=>n.startColumn!==n.endColumn):t:null}class ft{constructor(){E(this,"_model",new Map),E(this,"_ruleChange",new Ve),E(this,"_ruleRefresh",new Ve),E(this,"_resetOrder",new Ve),E(this,"ruleChange$",this._ruleChange.asObservable()),E(this,"ruleRefresh$",this._ruleRefresh.asObservable()),E(this,"resetOrder$",this._resetOrder.asObservable()),E(this,"_worksheetRuleInitStateChange",new xe(!1)),E(this,"worksheetRuleInitStateChange$",this._worksheetRuleInitStateChange.asObservable())}changeRuleInitState(t){this._worksheetRuleInitStateChange.next(t)}getSheetRuleInitState(){return this._worksheetRuleInitStateChange.value}addRule(t,n){this._ensureSubUnitMap(t).set(n.subUnitId,n),this._ruleChange.next({unitId:t,rule:n,type:"add",subUnitId:n.subUnitId})}deleteRule(t,n){var s,i,r;const o=(i=(s=this._model)==null?void 0:s.get(t))==null?void 0:i.get(n);o&&((r=this._model.get(t))==null||r.delete(n),this._ruleChange.next({unitId:t,rule:o,type:"delete",subUnitId:n}))}setRule(t,n,s){var i,r;const o=this.getRule(t,n);o&&((r=(i=this._model)==null?void 0:i.get(t))==null||r.set(n,s),this._ruleChange.next({unitId:t,oldRule:o,rule:s,type:"set",subUnitId:n}))}getRule(t,n){var s,i;return(i=(s=this._model)==null?void 0:s.get(t))==null?void 0:i.get(n)}toObject(){const t={};return[...this._model.keys()].forEach(n=>{const s=this._model.get(n);s!=null&&s.size&&(t[n]=[],[...s.keys()].forEach(i=>{const r=s.get(i);r&&t[n].push(r)}))}),t}fromObject(t){const n=new Map;Object.keys(t).forEach(s=>{const i=t[s];if(i!=null&&i.length){const r=new Map;i.forEach(o=>{r.set(o.subUnitId,o)}),n.set(s,r)}}),this._model=n}deleteUnitModel(t){this._model.delete(t)}_ensureSubUnitMap(t){let n=this._model.get(t);return n||(n=new Map,this._model.set(t,n)),n}ruleRefresh(t){this._ruleRefresh.next(t)}resetOrder(){this._resetOrder.next(Math.random())}getTargetByPermissionId(t,n){const s=this._model.get(t);if(!s)return null;for(const[i,r]of s)if(r.permissionId===n)return[t,i]}}const $i={id:"sheet.mutation.add-worksheet-protection",type:H.MUTATION,handler:(e,t)=>{const n=e.get(ft),{unitId:s,rule:i}=t;return n.addRule(s,i),!0}},Hr={id:"sheet.mutation.delete-worksheet-protection",type:H.MUTATION,handler:(e,t)=>{const n=e.get(ft),{unitId:s,subUnitId:i}=t;return n.deleteRule(s,i),!0}},Dp={type:H.COMMAND,id:"sheet.command.add-worksheet-protection",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),{rule:i,unitId:r}=t,o=i.subUnitId;if(await n.executeCommand($i.id,{unitId:r,rule:i,subUnitId:i.subUnitId})){const a=[{id:$i.id,params:{unitId:r,rule:i,subUnitId:i.subUnitId}}],l=[{id:Hr.id,params:{unitId:r,subUnitId:o}}];s.pushUndoRedo({unitID:r,redoMutations:a,undoMutations:l})}return!0}},mS={type:H.COMMAND,id:"sheet.command.set-worksheet-range-theme-style",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),{unitId:i}=t,r=sR(e,t);return n.syncExecuteCommand(Rl.id,t)?(s.pushUndoRedo({unitID:i,undoMutations:[{id:yl.id,params:r}],redoMutations:[{id:Rl.id,params:t}]}),!0):!1}},nM="sheet.command.append-row",pS={type:H.COMMAND,id:nM,handler:(e,t)=>{const n=e.get(U),s=e.get(ce),{unitId:i,subUnitId:r,cellValue:o,insertRowNums:a,insertColumnNums:l,maxRows:u,maxColumns:d}=t,c={unitId:i,subUnitId:r,cellValue:o},h=Vt(e,c),g=[{id:le.id,params:c}],m=[{id:le.id,params:h}];if(a){const p={unitId:i,subUnitId:r,range:{startRow:u,endRow:u,startColumn:0,endColumn:d-1}},f=sp(e,p);g.unshift({id:rn.id,params:p}),m.push({id:an.id,params:f})}if(l){const p={unitId:i,subUnitId:r,range:{startRow:0,endRow:u-1,startColumn:d,endColumn:d-1+l}},f=Qc(e,p);g.unshift({id:on.id,params:p}),m.push({id:$t.id,params:f})}return fe(g,n).result?(s.pushUndoRedo({unitID:i,undoMutations:m,redoMutations:g}),!0):!1}},fS=["ff","fs","tr","tb"],Tt={type:H.COMMAND,id:"sheet.command.set-style",handler:(e,t)=>{var n;const s=e.get(P),i=Y(s,t);if(!i)return!1;const{unitId:r,subUnitId:o,worksheet:a}=i,{range:l,style:u}=t,d=e.get(U),c=e.get(ce),h=e.get(q),g=l?[l]:(n=h.getCurrentSelections())==null?void 0:n.map(T=>T.range);if(!(g!=null&&g.length))return!1;const m=new de,p=ty(a);if(Q.isArray(u.value))for(let T=0;T<g.length;T++)p.forOperableEach(g[T],(O,k,D)=>{m.setValue(O,k,{s:{[u.type]:u.value[O-D.startRow][k-D.startColumn]}})});else for(let T=0;T<g.length;T++){const O={s:{[u.type]:u.value}};p.forOperableEach(g[T],(k,D)=>m.setValue(k,D,O))}const f={subUnitId:o,unitId:r,cellValue:m.getMatrix()},v=e.get(zs).getSkeleton(r,o),C=Vt(e,f);let w=null;if(fS.includes(t?.style.type)){const{suitableRanges:T,remainingRanges:O}=fu(g,v),k=Np(T,a);w={suitableRanges:T,remainingRanges:O,cellHeights:k}}const b=d.syncExecuteCommand(le.id,f),I=e.get(_e);let _=[],R=[];if(w){const{suitableRanges:T,remainingRanges:O,cellHeights:k}=w,{undos:D,redos:B}=I.generateMutationsOfAutoHeight({unitId:r,subUnitId:o,ranges:T,autoHeightRanges:T,lazyAutoHeightRanges:O,cellHeights:k});_=D,R=B}const{undos:M,redos:x}=I.onCommandExecute({id:Tt.id,params:t}),N=fe([...x,...R],d);return b&&N.result?(c.pushUndoRedo({unitID:f.unitId,undoMutations:[{id:le.id,params:C},...M,..._],redoMutations:[{id:le.id,params:f},...x,...R]}),!0):!1}},Wp={type:H.COMMAND,id:"sheet.command.set-bold",handler:e=>{const t=e.get(q).getCurrentLastSelection();if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s}=n,{actualRow:i,actualColumn:r}=t.primary,o={style:{type:"bl",value:s.getRange(i,r).getFontWeight()===nl.BOLD?pe.FALSE:pe.TRUE}};return e.get(U).syncExecuteCommand(Tt.id,o)}},Lp={type:H.COMMAND,id:"sheet.command.set-italic",handler:e=>{const t=e.get(q).getCurrentLastSelection();if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s}=n;let i=!0;if(t.primary){const{startRow:o,startColumn:a}=t.primary;i=s.getRange(o,a).getFontStyle()===sl.ITALIC}const r={style:{type:"it",value:i?pe.FALSE:pe.TRUE}};return e.get(U).syncExecuteCommand(Tt.id,r)}},Bp={type:H.COMMAND,id:"sheet.command.set-underline",handler:e=>{const t=e.get(q).getCurrentLastSelection();if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s}=n;let i=!0;t.primary&&(i=!!s.getRange(t.primary.startRow,t.primary.startColumn).getUnderline().s);const r={style:{type:"ul",value:{s:i?pe.FALSE:pe.TRUE}}};return e.get(U).syncExecuteCommand(Tt.id,r)}},jp={type:H.COMMAND,id:"sheet.command.set-stroke",handler:e=>{const t=e.get(q).getCurrentLastSelection();if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s}=n;let i=!0;t.primary&&(i=!!s.getRange(t.primary.actualRow,t.primary.actualColumn).getStrikeThrough().s);const r={style:{type:"st",value:{s:i?pe.FALSE:pe.TRUE}}};return e.get(U).syncExecuteCommand(Tt.id,r)}},gP={type:H.COMMAND,id:"sheet.command.set-overline",handler:e=>{const t=e.get(q).getCurrentLastSelection();if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s}=n;let i=!0;t.primary&&(i=!!s.getRange(t.primary.startRow,t.primary.startColumn).getOverline().s);const r={style:{type:"ol",value:{s:i?pe.FALSE:pe.TRUE}}};return e.get(U).syncExecuteCommand(Tt.id,r)}},Fp={type:H.COMMAND,id:"sheet.command.set-font-family",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={style:{type:"ff",value:t.value}};return n.syncExecuteCommand(Tt.id,s)}},Cu={type:H.COMMAND,id:"sheet.command.set-font-size",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={style:{type:"fs",value:t.value}};return n.syncExecuteCommand(Tt.id,s)}},zp={type:H.COMMAND,id:"sheet.command.set-text-color",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={style:{type:"cl",value:{rgb:t.value}}};return n.syncExecuteCommand(Tt.id,s)}},vS={type:H.COMMAND,id:"sheet.command.reset-text-color",handler:e=>{const t=e.get(U),n={style:{type:"cl",value:{rgb:null}}};return t.syncExecuteCommand(Tt.id,n)}},El={type:H.COMMAND,id:"sheet.command.set-background-color",handler:(e,t)=>{if(!t||!t.value)return!1;const n=e.get(U),s={style:{type:"bg",value:{rgb:t.value}}};return n.syncExecuteCommand(Tt.id,s)}},Xp={type:H.COMMAND,id:"sheet.command.reset-background-color",handler:e=>{const t=e.get(U),n={style:{type:"bg",value:{rgb:null}}};return t.syncExecuteCommand(Tt.id,n)}},xl={type:H.COMMAND,id:"sheet.command.set-vertical-text-align",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"vt",value:t.value}};return n.syncExecuteCommand(Tt.id,s)}},kl={type:H.COMMAND,id:"sheet.command.set-horizontal-text-align",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"ht",value:t.value}};return n.syncExecuteCommand(Tt.id,s)}},Dr={type:H.COMMAND,id:"sheet.command.set-text-wrap",handler:(e,t)=>{if(!t)return!1;const n=e.get(U),s={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tb",value:t.value}};return n.syncExecuteCommand(Tt.id,s)}},Tl={type:H.COMMAND,id:"sheet.command.set-text-rotation",handler:(e,t)=>{if(!t)return!1;const n=typeof t.value=="number"?{a:t.value}:{a:0,v:pe.TRUE},s=e.get(U),i={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tr",value:n}};return s.syncExecuteCommand(Tt.id,i)}},Od={:0,:1,:2,:3,:4,:5,:6,:7,:8,:9},Pl=["","","","","","","","","",""],nm=["","","","",""],CS=["","","",""],Yp={:{value:10,secUnit:!1},:{value:100,secUnit:!1},:{value:1e3,secUnit:!1},:{value:1e4,secUnit:!0},:{value:1e8,secUnit:!0}};function ih(e){if(!e)return 0;let t=0,n=0,s=0,i=!1;const r=e.split("");for(let o=0;o<r.length;o++){const a=Od[r[o]];if(typeof a<"u")s=a,o===r.length-1&&(n+=s);else{const l=Yp[r[o]],u=l.value;i=l.secUnit,i?(n=(n+s)*u,t+=n,n=0):n+=s*u,s=0}}return t+n}function wS(e){let t="",n="",s=0,i=!0;for(;e>0;){const r=e%10;r===0?i||(i=!0,n=Pl[r]+n):(i=!1,t=Pl[r],t+=CS[s],n=t+n),s++,e=Math.floor(e/10)}return n}function SS(e){let t=0,n="",s="",i=!1;if(e===0)return Pl[0];for(;e>0;){const r=e%1e4;i&&(s=Pl[0]+s),n=wS(r),n+=r!==0?nm[t]:nm[0],s=n+s,i=r<1e3&&r>0,e=Math.floor(e/1e4),t++}return s}function sM(e){if(!e)return!1;let t=!0;if(e)if(e.length===1)e===""||e in Od?t=!0:t=!1;else{const n=e.split("");for(let s=0;s<n.length;s++)if(!(n[s]in Od||n[s]in Yp)){t=!1;break}}return t}function iM(e){if(!e)return{isExtendNumber:!1};const t=/0|([1-9]+[0-9]*)/g,n=t.test(e);if(n){const s=e.match(t);if(s&&s.length>0){const i=s[s.length-1],r=e.lastIndexOf(i),o=e.substr(0,r),a=e.substr(r+i.length);return{isExtendNumber:!0,matchTxt:Number(i),beforeTxt:o,afterTxt:a}}return{isExtendNumber:!1}}return{isExtendNumber:n}}function rM(e){let t;return e.length===1&&(e===""||ih(e)<7)?t=!0:t=!1,t}function oM(e){let t;return e.length===2&&(e===""||e===""||e===""||e===""||e===""||e===""||e==="")?t=!0:t=!1,t}function aM(e){let t;return e.length===3&&(e===""||e===""||e===""||e===""||e===""||e===""||e==="")?t=!0:t=!1,t}function lM(e,t){let n=0;for(let s=0;s<e.length&&e[s]<t;s++)n++;return n}function uM(e){let t=!0;const n=e[1]-e[0];for(let s=1;s<e.length;s++)if(e[s]-e[s-1]!==n){t=!1;break}return t}function dM(e,t,n){const s=[],i=Math.floor(t/e),r=t%e;let o=0;if(i>0){for(let a=0;a<i;a++)for(let l=0;l<n.length;l++)s[n[l]+a*e]=o,o++;for(let a=0;a<n.length&&n[a]<r;a++)s[n[a]+e*i]=o,o++}else for(let a=0;a<n.length&&n[a]<r;a++)s[n[a]]=o,o++;return s}function cM(e,t){const n=[];for(let s=1;s<=t;s++){const i=(s-1)%e.length,r=Q.deepClone(e[i]);mi(r),n.push({v:null,s:null,p:null,f:null,si:null,t:null,...r})}return n}function hM(e,t){var n;const s=[];for(let i=1;i<=t;i++){const r=(i-1)%e.length,o={s:(n=e[r])==null?void 0:n.s};s.push(o)}return s}function bS(e){let t=!0;const n=e[1]/e[0];for(let s=1;s<e.length;s++)if(e[s]/e[s-1]!==n){t=!1;break}return t}function _S(e){const t=[];for(let n=1;n<=e;n++)t.push(n);return t}function gM(e,t,n){var s,i,r,o;const a=[],l=[];for(let u=0;u<e.length;u++)l.push(Number((s=e[u])==null?void 0:s.v));if(e.length>2&&bS(l))for(let u=1;u<=t;u++){const d=(u-1)%e.length,c=Q.deepClone(e[d]);mi(c);const h=Number((i=e[e.length-1])==null?void 0:i.v)*(Number((r=e[1])==null?void 0:r.v)/Number((o=e[0])==null?void 0:o.v))**u;c&&(sm(c)&&(c.v=h),a.push(c))}else{const u=_S(e.length);for(let d=1;d<=t;d++){const c=(d-1)%e.length,h=Q.deepClone(e[c]);mi(h);const g=n===Z.DOWN||n===Z.RIGHT,m=IS(e.length+d,l,u,g);h&&(sm(h)&&(h.v=m),a.push(h))}}return a}function IS(e,t,n,s=!0){function i(c){let h=0;for(let g=0;g<c.length;g++)h+=c[g];return h/c.length}const r=i(n),o=i(t);let a=0,l=0;for(let c=0;c<n.length;c++)a+=(n[c]-r)*(t[c]-o),l+=(n[c]-r)*(n[c]-r);let u;l===0?u=s?1:-1:u=a/l;const d=o-u*r;return Math.round((d+u*e)*1e5)/1e5}function mM(e,t,n){var s;const i=[],r=/0|([1-9]+[0-9]*)/g;for(let o=1;o<=t;o++){const a=(o-1)%e.length,l=Q.deepClone(e[a]);mi(l);const u=`${(s=e[e.length-1])==null?void 0:s.v}`;if(!u)continue;const d=u?.match(r),c=d?.[d.length-1];if(!c)continue;const h=Math.abs(Number(c)+n*o),g=u.lastIndexOf(c),m=u.substr(0,g)+h.toString()+u.substr(g+c.length);l&&(l.v=m,i.push(l))}return i}function pM(e,t){const n=[];for(let s=1;s<=t;s++){const i=(s-1)%e.length,r=Q.deepClone(e[i]);mi(r),r&&(delete r.v,n.push(r))}return n}function fM(e,t,n,s=0){var i,r;const o=[["","","","","","",""],["","","","","","",""],["","","","","","",""]];if(s>=o.length)return[];const a=o[s],l=[];for(let u=1;u<=t;u++){const d=(u-1)%e.length,c=Q.deepClone(e[d]);mi(c);let h=0;if(((i=e[e.length-1])==null?void 0:i.v)===a[0])h=7+n*u;else{const m=`${(r=e[e.length-1])==null?void 0:r.v}`;if(m){const p=m.substr(m.length-1,1);h=ih(p)+n*u}}h<0&&(h=Math.ceil(Math.abs(h)/7)*7+h);const g=h%7;c&&(c.v=a[g],l.push(c))}return l}function vM(e,t,n){var s;const i=[];for(let r=1;r<=t;r++){const o=(r-1)%e.length,a=Q.deepClone(e[o]);mi(a);const l=`${(s=e[e.length-1])==null?void 0:s.v}`,u=ih(l)+n*r;let d;u<=0?d="":d=SS(u),a&&(a.v=d,i.push(a))}return i}const hl={enWeek1:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],enWeek2:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],enMonth1:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],enMonth2:["January","February","March","April","May","June","July","August","September","October","November","December"],chnMonth1:["","","","","","","","","","","",""],chnMonth2:["","","","","","","","","","","",""],chHour1:["","","","","","","","","","","",""],chHour2:["","","","","","","","","","","",""],chYear1:["","","","","","","","","",""],chSeason1:["","","",""],chSeason2:["","","",""]};function CM(e){let t=!1;return Object.keys(hl).forEach(n=>{hl[n].includes(e)&&(t=!0)}),t}function wM(e){let t="";const n=[];return Object.keys(hl).forEach(s=>{hl[s].includes(e)&&(t=s,n.push(...hl[s]))}),{name:t,series:n}}function SM(e,t,n,s){var i;const r=s.length,o=[];for(let a=1;a<=t;a++){const l=(a-1)%e.length,u=Q.deepClone(e[l]);mi(u);const d=`${(i=e[e.length-1])==null?void 0:i.v}`;let c=s.indexOf(d)+n*a;c<0&&(c+=Math.abs(n)*r);const h=c%r;u&&(u.v=s[h],o.push(u))}return o}function bM(e,t){const n=[];let s;if(t.startRow<e.startRow)s=Z.UP;else if(t.endRow>e.endRow)s=Z.DOWN;else if(t.startColumn<e.startColumn)s=Z.LEFT;else if(t.endColumn>e.endColumn)s=Z.RIGHT;else return[];if(s===Z.DOWN||s===Z.UP){const i=e.endRow-e.startRow+1,r=t.endRow-t.startRow+1,o=Math.floor(r/i),a=r%i,l={startRow:0,startColumn:0,endRow:e.endRow-e.startRow,endColumn:e.endColumn-e.startColumn};if(s===Z.DOWN){for(let u=0;u<o;u++)n.push({repeatStartCell:{row:e.startRow+(u+1)*i,col:e.startColumn},relativeRange:l});a>0&&n.push({repeatStartCell:{row:e.startRow+(o+1)*i,col:e.startColumn},relativeRange:{startRow:0,startColumn:0,endRow:a-1,endColumn:e.endColumn-e.startColumn}})}else{for(let u=0;u<o;u++)n.push({repeatStartCell:{row:e.startRow-(u+1)*i,col:e.startColumn},relativeRange:l});a>0&&n.push({repeatStartCell:{row:e.startRow-(o+1)*i,col:e.startColumn},relativeRange:{startRow:i-a,endRow:i-1,startColumn:0,endColumn:e.endColumn-e.startColumn}})}}if(s===Z.RIGHT||s===Z.LEFT){const i=e.endColumn-e.startColumn+1,r=t.endColumn-t.startColumn+1,o=Math.floor(r/i),a=r%i,l={startRow:0,startColumn:0,endRow:e.endRow-e.startRow,endColumn:e.endColumn-e.startColumn};if(s===Z.RIGHT){for(let u=0;u<o;u++)n.push({repeatStartCell:{row:e.startRow,col:e.startColumn+(u+1)*i},relativeRange:l});a>0&&n.push({repeatStartCell:{row:e.startRow,col:e.startColumn+(o+1)*i},relativeRange:{startRow:0,startColumn:0,endRow:e.endRow-e.startRow,endColumn:a-1}})}else{for(let u=0;u<o;u++)n.push({repeatStartCell:{row:e.startRow,col:e.startColumn-(u+1)*i},relativeRange:l});a>0&&n.push({repeatStartCell:{row:e.startRow,col:e.startColumn-(o+1)*i},relativeRange:{startRow:0,startColumn:i-a,endRow:e.endRow-e.startRow,endColumn:i-1}})}}return n}function sm(e){return!(Am(e.f)||Y_(e.si)||e.t===je.BOOLEAN)}function mi(e){e&&"custom"in e&&delete e.custom}function _M(e,t){return t?e.reverse():e}function IM(e){const t=new de;return e.forEach(n=>{const{rows:s,cols:i}=n;s.forEach(r=>{i.forEach(o=>{t.setValue(r,o,{v:null,p:null,f:null,si:null,custom:null})})})}),t.clone()}const RS={chnNumChar:Od,chnNumChar2:Pl,chnUnitSection:nm,chnUnitChar:CS,chnNameValue:Yp,chineseToNumber:ih,sectionToChinese:wS,numberToChinese:SS,isChnNumber:sM,matchExtendNumber:iM,isChnWeek1:rM,isChnWeek2:oM,isChnWeek3:aM,getLenS:lM,isEqualDiff:uM,getDataIndex:dM,fillCopy:cM,fillCopyStyles:hM,isEqualRatio:bS,getXArr:_S,fillSeries:gM,forecast:IS,fillExtendNumber:mM,fillOnlyFormat:pM,fillChnWeek:fM,fillChnNumber:vM,isLoopSeries:CM,getLoopSeriesInfo:wM,fillLoopSeries:SM,getAutoFillRepeatRange:bM,needsUpdateCellValue:sm,removeCellCustom:mi,reverseIfNeed:_M,generateNullCellValueRowCol:IM};var gt=(e=>(e.COPY="COPY",e.SERIES="SERIES",e.ONLY_FORMAT="ONLY_FORMAT",e.NO_FORMAT="NO_FORMAT",e))(gt||{}),Gt=(e=>(e.NUMBER="number",e.DATE="date",e.EXTEND_NUMBER="extendNumber",e.CHN_NUMBER="chnNumber",e.CHN_WEEK2="chnWeek2",e.CHN_WEEK3="chnWeek3",e.LOOP_SERIES="loopSeries",e.FORMULA="formula",e.OTHER="other",e))(Gt||{}),Mr=(e=>(e.APPEND="APPEND",e.DEFAULT="DEFAULT",e.ONLY="ONLY",e))(Mr||{});const{chineseToNumber:Rr,fillChnNumber:vv,fillChnWeek:Zo,fillCopy:wu,fillExtendNumber:Cv,fillLoopSeries:wv,fillSeries:Ad,getLoopSeriesInfo:Xh,isChnNumber:RM,isChnWeek2:yM,isChnWeek3:MM,isEqualDiff:Su,isLoopSeries:EM,matchExtendNumber:Wu,reverseIfNeed:rs}=RS,xM={type:Gt.DATE,priority:1100,match:(e,t)=>{var n;if(e!=null&&e.f||e!=null&&e.si)return!1;if((typeof e?.v=="number"||e?.t===je.NUMBER)&&e.s){if(typeof e.s=="string"){const s=t.get(P).getCurrentUnitOfType(A.UNIVER_SHEET);if(!s)return!1;const i=s.getStyles().get(e.s),r=(n=i?.n)==null?void 0:n.pattern;if(r)return bl.getFormatInfo(r).isDate}else if(e.s.n&&bl.getFormatInfo(e.s.n.pattern).isDate)return!0}return!1},isContinue:(e,t)=>e.type===Gt.DATE,applyFunctions:{[gt.SERIES]:(e,t,n)=>{const{data:s}=e;return n===Z.LEFT||n===Z.UP?(s.reverse(),Ad(s,t,n).reverse()):Ad(s,t,n)}}},kM={type:Gt.NUMBER,priority:1e3,match:e=>typeof e?.v=="number"||e?.t===je.NUMBER,isContinue:(e,t)=>e.type===Gt.NUMBER,applyFunctions:{[gt.SERIES]:(e,t,n)=>{const{data:s}=e;return n===Z.LEFT||n===Z.UP?(s.reverse(),Ad(s,t,n).reverse()):Ad(s,t,n)}}},TM={type:Gt.EXTEND_NUMBER,priority:900,match:e=>Wu(`${e?.v}`||"").isExtendNumber,isContinue:(e,t)=>{var n;if(e.type===Gt.EXTEND_NUMBER){const{beforeTxt:s,afterTxt:i}=Wu(`${(n=e.cellData)==null?void 0:n.v}`||""),{beforeTxt:r,afterTxt:o}=Wu(`${t?.v}`||"");if(s===r&&i===o)return!0}return!1},applyFunctions:{[gt.SERIES]:(e,t,n)=>{var s;const{data:i}=e,r=n===Z.UP||n===Z.LEFT;let o;if(i.length===1)return o=r?-1:1,rs(Cv(i,t,o),r);const a=[];for(let l=0;l<i.length;l++){const u=`${(s=i[l])==null?void 0:s.v}`;u&&a.push(Number(Wu(u).matchTxt))}return r&&(i.reverse(),a.reverse()),Su(a)?(o=a[1]-a[0],rs(Cv(i,t,o),r)):wu(i,t)}}},PM={type:Gt.CHN_NUMBER,priority:830,match:e=>!!RM(`${e?.v}`||""),isContinue:(e,t)=>e.type===Gt.CHN_NUMBER,applyFunctions:{[gt.SERIES]:(e,t,n)=>{var s,i,r;const{data:o}=e,a=n===Z.LEFT||n===Z.UP;if(o.length===1){const c=`${(s=o[0])==null?void 0:s.v}`;let h;return a?h=-1:h=1,c&&(c===""||Rr(c)<7)?rs(Zo(o,t,h),a):rs(vv(o,t,h),a)}let l=!1;for(let c=0;c<o.length;c++)if(((i=o[c])==null?void 0:i.v)===""){l=!0;break}const u=[];let d=0;for(let c=0;c<o.length;c++){const h=`${(r=o[c])==null?void 0:r.v}`;h===""?c===0?u.push(0):(d++,u.push(d*7)):l&&Rr(h)>0&&Rr(h)<7?u.push(Rr(h)+d*7):u.push(Rr(h))}if(a&&(o.reverse(),u.reverse()),Su(u)){if(l||u[u.length-1]<6&&u[0]>0||u[0]<6&&u[u.length-1]>0){const h=u[1]-u[0];return rs(Zo(o,t,h),a)}const c=u[1]-u[0];return rs(vv(o,t,c),a)}return wu(o,t)}}},UM={type:Gt.CHN_WEEK2,priority:820,match:e=>!!yM(`${e?.v}`||""),isContinue:(e,t)=>e.type===Gt.CHN_WEEK2,applyFunctions:{[gt.SERIES]:(e,t,n)=>{var s;const{data:i}=e,r=n===Z.LEFT||n===Z.UP;if(i.length===1){let l;return r?l=-1:l=1,rs(Zo(i,t,l,1),r)}const o=[];let a=0;for(let l=0;l<i.length;l++){const u=`${(s=i[l])==null?void 0:s.v}`,d=u?.substr(u.length-1,1);u===""?l===0?o.push(0):(a++,o.push(a*7)):o.push(Rr(d)+a*7)}if(r&&(i.reverse(),o.reverse()),Su(o)){const l=o[1]-o[0];return rs(Zo(i,t,l,1),r)}return wu(i,t)}}},NM={type:Gt.CHN_WEEK3,priority:810,match:e=>MM(`${e?.v}`||""),isContinue:(e,t)=>e.type===Gt.CHN_WEEK3,applyFunctions:{[gt.SERIES]:(e,t,n)=>{var s;const{data:i}=e,r=n===Z.LEFT||n===Z.UP;if(i.length===1){let l;return r?l=-1:l=1,rs(Zo(i,t,l,2),r)}const o=[];let a=0;for(let l=0;l<i.length;l++){const u=`${(s=i[l])==null?void 0:s.v}`;if(u){const d=u.substr(u.length-1,1);u===""?l===0?o.push(0):(a++,o.push(a*7)):o.push(Rr(d)+a*7)}}if(r&&(i.reverse(),o.reverse()),Su(o)){const l=o[1]-o[0];return rs(Zo(i,t,l,2),r)}return wu(i,t)}}},OM={type:Gt.LOOP_SERIES,priority:800,match:e=>EM(`${e?.v}`||""),isContinue:(e,t)=>{var n;return e.type===Gt.LOOP_SERIES?Xh(`${(n=e.cellData)==null?void 0:n.v}`||"").name===Xh(`${t?.v}`||"").name:!1},applyFunctions:{[gt.SERIES]:(e,t,n)=>{var s,i;const{data:r}=e,o=n===Z.LEFT||n===Z.UP,{series:a}=Xh(`${(s=r[0])==null?void 0:s.v}`||"");if(r.length===1){let d;return o?d=-1:d=1,rs(wv(r,t,d,a),o)}const l=[];let u=0;for(let d=0;d<r.length;d++){const c=`${(i=r[d])==null?void 0:i.v}`;c&&(c===a[0]?d===0?l.push(0):(u++,l.push(u*a.length)):l.push(a.indexOf(c)+u*7))}if(o&&(r.reverse(),l.reverse()),Su(l)){const d=l[1]-l[0];return rs(wv(r,t,d,a),o)}return wu(r,t)}}},AM={type:Gt.OTHER,priority:0,match:()=>!0,isContinue:(e,t)=>e.type===Gt.OTHER},yS={dateRule:xM,numberRule:kM,extendNumberRule:TM,chnNumberRule:PM,chnWeek2Rule:UM,chnWeek3Rule:NM,loopSeriesRule:OM,otherRule:AM};var VM=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Lu=(e,t)=>(n,s)=>t(n,s,e);const{chnNumberRule:HM,chnWeek2Rule:DM,chnWeek3Rule:WM,dateRule:LM,extendNumberRule:BM,loopSeriesRule:jM,numberRule:FM,otherRule:zM}=yS;let im=class extends ae{constructor(e,t,n,s){super(),E(this,"_rules",[]),E(this,"_hooks",[]),E(this,"_applyType$",new xe(gt.SERIES)),E(this,"_isFillingStyle",!0),E(this,"_prevUndos",[]),E(this,"_autoFillLocation$",new xe(null)),E(this,"autoFillLocation$",this._autoFillLocation$.asObservable()),E(this,"_showMenu$",new xe(!1)),E(this,"showMenu$",this._showMenu$.asObservable()),E(this,"_direction",Z.DOWN),E(this,"applyType$",this._applyType$.asObservable()),E(this,"_menu$",new xe([{label:"autoFill.copy",value:gt.COPY,disable:!1},{label:"autoFill.series",value:gt.SERIES,disable:!1},{label:"autoFill.formatOnly",value:gt.ONLY_FORMAT,disable:!1},{label:"autoFill.noFormat",value:gt.NO_FORMAT,disable:!1}])),E(this,"menu$",this._menu$.asObservable()),this._commandService=e,this._undoRedoService=t,this._univerInstanceService=n,this._injector=s,this._init()}_init(){this._rules=[LM,FM,BM,HM,DM,WM,jM,zM].sort((e,t)=>t.priority-e.priority),this._isFillingStyle=!0}_getOneByPriority(e){return e.length<=0?[]:[e.reduce((t,n)=>(n.priority||0)>(t.priority||0)?n:t,e[0])]}_initPrevUndo(){this._prevUndos=[]}async triggerAutoFill(e,t,n,s,i){var r;if(n.startColumn===s.startColumn&&n.startRow===s.startRow&&n.endColumn===s.endColumn&&n.endRow===s.endRow)return!1;if(s.endColumn<n.endColumn&&s.endColumn>n.startColumn)return this._commandService.executeCommand(Vd.id,{clearRange:{startRow:s.startRow,endRow:s.endRow,startColumn:s.endColumn+1,endColumn:n.endColumn},selectionRange:s});if(s.endRow<n.endRow&&s.endRow>n.startRow)return this._commandService.executeCommand(Vd.id,{clearRange:{startRow:s.endRow+1,endRow:n.endRow,startColumn:s.startColumn,endColumn:s.endColumn},selectionRange:s});const o={startRow:s.startRow,endRow:s.endRow,startColumn:s.startColumn,endColumn:s.endColumn};let a=null;if(s.startRow<n.startRow)a=Z.UP,o.endRow=n.startRow-1;else if(s.endRow>n.endRow)a=Z.DOWN,o.startRow=n.endRow+1;else if(s.startColumn<n.startColumn)a=Z.LEFT,o.endColumn=n.startColumn-1;else if(s.endColumn>n.endColumn)a=Z.RIGHT,o.startColumn=n.endColumn+1;else return!1;this.direction=a;const l=this._injector.invoke(h=>cl(n,h)),u=this._injector.invoke(h=>cl(o,h));if(!l||!u)return!1;this.autoFillLocation={source:l,target:u,unitId:e,subUnitId:t};const d=[];if(this.getActiveHooks().forEach(h=>{var g;const m=(g=h?.onBeforeFillData)==null?void 0:g.call(h,{source:l,target:u,unitId:e,subUnitId:t},a);m&&d.unshift(m)}),this._initPrevUndo(),i)return this.fillData(i);for(let h=0;h<d.length;h++){const g=this.menu.find(m=>m.value===d[h]);if(g&&!g.disable)return this.fillData(d[h])}const c=(r=this.menu.find(h=>h.disable===!1))==null?void 0:r.value;return c?this.fillData(c):!1}addHook(e){if(this._hooks.find(t=>t.id===e.id))throw new Error(`Add hook failed, hook id '${e.id}' already exist!`);return e.priority===void 0&&(e.priority=0),e.type===void 0&&(e.type=Mr.APPEND),this._hooks.push(e),He(()=>{const t=this._hooks.findIndex(n=>n===e);t>-1&&this._hooks.splice(t,1)})}registerRule(e){if(this._rules.find(n=>n.type===e.type))throw new Error(`Registry rule failed, type '${e.type}' already exist!`);const t=this._rules.findIndex(n=>n.priority<e.priority);this._rules.splice(t===-1?this._rules.length:t,0,e)}getRules(){return this._rules}getAllHooks(){return this._hooks}getActiveHooks(){const{source:e,target:t,unitId:n,subUnitId:s}=this.autoFillLocation||{};if(!e||!t||!n||!s)return[];const i=this._hooks.filter(l=>{var u;return!((u=l.disable)!=null&&u.call(l,{source:e,target:t,unitId:n,subUnitId:s},this._direction,this.applyType))}),r=i.filter(l=>l.type===Mr.ONLY);if(r.length>0)return this._getOneByPriority(r);const o=this._getOneByPriority(i.filter(l=>l.type===Mr.DEFAULT)),a=i.filter(l=>l.type===Mr.APPEND)||[];return[...o,...a]}get applyType(){return this._applyType$.getValue()}set applyType(e){this._applyType$.next(e)}get menu(){return this._menu$.getValue()}get direction(){return this._direction}set direction(e){this._direction=e}isFillingStyle(){return this._isFillingStyle}setFillingStyle(e){this._isFillingStyle=e}get autoFillLocation(){return this._autoFillLocation$.getValue()}set autoFillLocation(e){this._autoFillLocation$.next(e)}setDisableApplyType(e,t){this._menu$.next(this._menu$.getValue().map(n=>n.value===e?{...n,disable:t}:n))}setShowMenu(e){this._showMenu$.next(e)}fillData(e){var t;this.applyType=e;const n=this._univerInstanceService.getCurrentUnitOfType(A.UNIVER_SHEET),s=n?.getUnitId(),i=(t=n?.getActiveSheet())==null?void 0:t.getSheetId(),{source:r,target:o,unitId:a=s,subUnitId:l=i}=this.autoFillLocation||{};if(!r||!o||!a||!l)return!1;const u=this._univerInstanceService.getUnit(a,A.UNIVER_SHEET);if(!u)return!1;const d=u.getSheetBySheetId(l);if(!d)return!1;const c=this.direction;this._prevUndos.length>0&&this._prevUndos.forEach(w=>{this._commandService.syncExecuteCommand(w.id,w.params)}),this._prevUndos=[];const h=z.union(Or(r),Or(o)),g=this.getActiveHooks();a===s&&l===i&&this._commandService.syncExecuteCommand(me.id,{selections:[{primary:Ht({startRow:r.rows[0],endRow:r.rows[r.rows.length-1],startColumn:r.cols[0],endColumn:r.cols[r.cols.length-1]},d),range:{...h,rangeType:j.NORMAL}}],unitId:a,subUnitId:l});const m=[],p=[];g.forEach(w=>{var b;const{undos:I,redos:_}=((b=w.onFillData)==null?void 0:b.call(w,{source:r,target:o,unitId:a,subUnitId:l},c,e))||{};I&&m.push(...I),_&&p.push(..._)});const f=p.every(w=>this._commandService.syncExecuteCommand(w.id,w.params)),{redos:v,undos:C}=this._getAutoHeightUndoRedos(p,u,d);return p.push(...v),m.push(...C),f&&(this._prevUndos=m,this._undoRedoService.pushUndoRedo({unitID:a,undoMutations:m,redoMutations:p})),g.forEach(w=>{var b;(b=w.onAfterFillData)==null||b.call(w,{source:r,target:o,unitId:a,subUnitId:l},c,e)}),this.setShowMenu(!0),!0}_getAutoHeightUndoRedos(e,t,n){if(this.applyType===gt.NO_FORMAT)return{undos:[],redos:[]};const s=[],i=n.getConfig().defaultRowHeight,r=n.getRowManager();if(e.forEach(u=>{if(u.id===le.id){const{cellValue:d}=u.params;new de(d).forValue((c,h,g)=>{const m=Object.keys(t.getStyles().get(g?.s)||{});if(g!=null&&g.p||m.length&&fS.some(p=>m.includes(p))){const p=n.getCellHeight(c,h),f=r.getRow(c);(!f&&p!==i||f&&p!==r.getRowHeight(c))&&s.push({row:c,autoHeight:p})}})}}),s.length===0)return{undos:[],redos:[]};const o={unitId:t.getUnitId(),subUnitId:n.getSheetId(),rowsAutoHeightInfo:s},a=op(o,n),l={id:ds.id,params:o};return this._commandService.syncExecuteCommand(l.id,l.params)?{redos:[l],undos:[{id:ds.id,params:a}]}:{undos:[],redos:[]}}};im=VM([Lu(0,U),Lu(1,ce),Lu(2,V(P)),Lu(3,V(pt))],im);const Ua=bn("univer.auto-fill-service"),Er={type:H.COMMAND,id:"sheet.command.auto-fill",handler:async(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{unitId:s,subUnitId:i}=n,{sourceRange:r,targetRange:o,applyType:a}=t;return e.get(Ua).triggerAutoFill(s,i,r,o,a)}},Vd={id:"sheet.command.auto-clear-content",type:H.COMMAND,handler:async(e,t)=>{const n=Y(e.get(P));if(!n)return!1;const s=e.get(U),i=e.get(ce),r=e.get(_e),o=e.get(q),{unitId:a,subUnitId:l}=n,{clearRange:u,selectionRange:d}=t,{startColumn:c,startRow:h}=d,g={subUnitId:l,unitId:a,cellValue:Fw([u])},m=Vt(e,g),p=[{id:le.id,params:g},{id:me.id,params:{selections:[{primary:{startColumn:c,startRow:h,endColumn:c,endRow:h,actualRow:h,actualColumn:c,isMerged:!1,isMergedMainCell:!1},range:{...d}}],unitId:a,subUnitId:l}}],f=[{id:le.id,params:m},{id:me.id,params:{selections:[o.getCurrentLastSelection()],unitId:a,subUnitId:l}}];if(fe(p,s)){const v=r.afterCommandExecute({id:le.id,params:g});return fe(v.redos,s),i.pushUndoRedo({unitID:a,undoMutations:[...f,...v.undos],redoMutations:[...p,...v.redos]}),!0}return!1}},as={id:"sheet.command.clear-selection-content",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(P),i=e.get(U),r=e.get(q),o=e.get(ce),a=e.get(_e),l=s.getCurrentUnitForType(A.UNIVER_SHEET);if(!l)return!1;const u=t?.unitId||l.getUnitId(),d=l.getActiveSheet();if(!d)return!1;const c=t?.subUnitId||d.getSheetId(),h=t?.ranges||((n=r.getCurrentSelections())==null?void 0:n.map(w=>w.range));if(!(h!=null&&h.length))return!1;const g=Kc(h,e,u,c),m={subUnitId:c,unitId:u,cellValue:Fw(g)},p=Vt(e,m),f=a.onCommandExecute({id:as.id}),v=[{id:le.id,params:m},...f.redos],C=[...f.undos,{id:le.id,params:p}];return fe(v,i).result?(o.pushUndoRedo({unitID:u,undoMutations:C,redoMutations:v}),!0):!1}},bu="sheets.config",Zp={largeSheetCellCountThreshold:6e3,batchSize:3e3},Sv={};var XM=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},bv=(e,t)=>(n,s)=>t(n,s,e);let Hd=class extends ae{constructor(e,t){super(),E(this,"_tasks",new Map),E(this,"_idleCallbackId",null),E(this,"_beforeUnloadHandler",null),this._commandService=e,this._univerInstanceService=t,this._setupBeforeUnloadListener(),this.disposeWithMe(()=>{this._cancelAllTasks(),this._removeBeforeUnloadListener()})}hasPendingTasks(){return this._tasks.size>0}getPendingMutationsCount(){let e=0;for(const t of this._tasks.values())e+=t.mutations.length-t.currentIndex;return e}scheduleMutations(e,t,n){if(n.length===0)return;const s=`${e}_${t}`;this._cancelTask(s),this._tasks.set(s,{unitId:e,subUnitId:t,mutations:n,currentIndex:0}),this._scheduleNextIdle()}cancelScheduledMutations(e,t){const n=`${e}_${t}`;this._cancelTask(n)}_cancelTask(e){this._tasks.delete(e),this._tasks.size===0&&this._idleCallbackId!==null&&(typeof cancelIdleCallback<"u"&&cancelIdleCallback(this._idleCallbackId),this._idleCallbackId=null)}_cancelAllTasks(){this._tasks.clear(),this._idleCallbackId!==null&&(typeof cancelIdleCallback<"u"&&cancelIdleCallback(this._idleCallbackId),this._idleCallbackId=null)}_scheduleNextIdle(){this._idleCallbackId===null&&(typeof requestIdleCallback<"u"?this._idleCallbackId=requestIdleCallback(e=>this._processIdleTasks(e),{timeout:1e3*60}):this._idleCallbackId=setTimeout(()=>{this._processIdleTasks({didTimeout:!1,timeRemaining:()=>16})},16))}_processIdleTasks(e){this._idleCallbackId=null;for(const[t,n]of this._tasks){if(!this._isSheetExist(n.unitId,n.subUnitId)){this._tasks.delete(t);continue}for(n.currentIndex;n.currentIndex<n.mutations.length;){if(e.timeRemaining()<=0&&!e.didTimeout){this._scheduleNextIdle();return}const s=n.mutations[n.currentIndex];this._commandService.syncExecuteCommand(s.id,s.params,{onlyLocal:!0}),n.currentIndex++}this._tasks.delete(t)}this._tasks.size>0&&this._scheduleNextIdle()}_isSheetExist(e,t){const n=this._univerInstanceService.getUnit(e,A.UNIVER_SHEET);return n?n.getSheetBySheetId(t)!==null:!1}_setupBeforeUnloadListener(){typeof window>"u"||(this._beforeUnloadHandler=e=>{if(this.hasPendingTasks())return e.preventDefault(),e.returnValue="",""},window.addEventListener("beforeunload",this._beforeUnloadHandler))}_removeBeforeUnloadListener(){typeof window>"u"||!this._beforeUnloadHandler||(window.removeEventListener("beforeunload",this._beforeUnloadHandler),this._beforeUnloadHandler=null)}};Hd=XM([bv(0,U),bv(1,P)],Hd);const MS={id:"sheet.mutation.copy-worksheet-end",type:H.MUTATION,handler:()=>!0},ES=(e,t)=>({subUnitId:t.sheet.id,unitId:t.unitId,subUnitName:t.sheet.name}),cs={id:"sheet.mutation.insert-sheet",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P),{sheet:s,index:i,unitId:r,styles:o}=t,a=n.getUniverSheetInstance(r);return a?(o&&a.addStyles(o),a.addWorksheet(s.id,i,KC(s))):!1}};function YM(e){let t=0;for(const n of Object.keys(e)){const s=e[Number(n)];s&&(t+=Object.keys(s).length)}return t}function ZM(e,t,n,s){const i=[];let r={},o=0;for(const u in n){const d=Number(u),c=n[d];if(!c)continue;const h=Object.keys(c).length;o>0&&o+h>s&&(i.push(r),r={},o=0),r[d]=c,o+=h,o>=s&&(i.push(r),r={},o=0)}o>0&&i.push(r);const a=i.length>0?i[0]:{},l=i.slice(1).map(u=>({id:le.id,params:{unitId:e,subUnitId:t,cellValue:u,__splitChunk__:!0}}));return{firstChunkCellData:a,remainingMutations:l}}const xS="sheet.command.copy-sheet";function GM(e,t,n,s,i,r,o){var a,l;const u=e.get(Lt).getConfig(bu),d={...Zp,...u?.largeSheetOperation},c=KC(n.getConfig());c.name=qM(t,r,c.name);const h=hn();c.id=h;const g=t.getSheetIndex(n),{cellData:m}=c,p=YM(m)>=d.largeSheetCellCountThreshold;let f,v=[];if(p){const{firstChunkCellData:_,remainingMutations:R}=ZM(s,h,m,d.batchSize),M={...c,cellData:_};f={index:g+1,sheet:M,unitId:s},v=R}else f={index:g+1,sheet:c,unitId:s};const C=ES(e,f),w=o.onCommandExecute({id:xS,params:{unitId:s,subUnitId:i,targetSubUnitId:c.id}}),b=[...(a=w.preRedos)!=null?a:[],{id:cs.id,params:f},...w.redos],I=[...(l=w.preUndos)!=null?l:[],{id:En.id,params:C},...w.undos];return{redos:b,undos:I,unitId:s,newSheetId:h,isSplit:p,scheduledMutations:v}}const rh={type:H.COMMAND,id:xS,handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(P),r=e.get(_e),o=e.get(Oe),a=e.get(Hd),l=Y(i,t);if(!l)return!1;const{workbook:u,worksheet:d,unitId:c,subUnitId:h}=l,{redos:g,undos:m,newSheetId:p,isSplit:f,scheduledMutations:v}=GM(e,u,d,c,h,o,r);if(fe(g,n).result){if(f){if(s.pushUndoRedo({unitID:c,undoMutations:m,redoMutations:[]}),v.length>0){for(const C of v)n.syncExecuteCommand(C.id,C.params,{syncOnly:!0});n.syncExecuteCommand(MS.id,{unitId:c,subUnitId:p},{syncOnly:!0}),a.scheduleMutations(c,p,v)}}else s.pushUndoRedo({unitID:c,undoMutations:m,redoMutations:g});return!0}return!1}};function qM(e,t,n){let s=`${n} ${t.t("sheets.tabs.sheetCopy","")}`,i=2;for(;e.checkSheetName(s);)s=`${n} ${t.t("sheets.tabs.sheetCopy",`${i}`)}`,i++;return s}const kS={type:H.COMMAND,id:"sheet.command.delete-range-protection",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),{unitId:i,subUnitId:r,rule:o}=t,a={unitId:i,subUnitId:r,ruleIds:[o.id]};return await n.executeCommand($n.id,a)&&s.pushUndoRedo({unitID:i,redoMutations:[{id:$n.id,params:a}],undoMutations:[{id:Hn.id,params:{unitId:i,subUnitId:r,rules:[o]}}]}),!0}},Ul={type:H.COMMAND,id:"sheet.command.delete-worksheet-protection",handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),{rule:i,unitId:r,subUnitId:o}=t;n.executeCommand(Hr.id,{unitId:r,subUnitId:o});const a=[{id:Hr.id,params:{unitId:r,subUnitId:o}}],l=[{id:$i.id,params:{unitId:r,rule:i,subUnitId:o}}];return s.pushUndoRedo({unitID:r,redoMutations:a,undoMutations:l}),!0}},TS={type:H.COMMAND,id:"sheet.command.remove-worksheet-range-theme-style",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),{unitId:i}=t,r=iR(e,t);return n.syncExecuteCommand(yl.id,t)?(s.pushUndoRedo({unitID:i,undoMutations:[{id:Rl.id,params:r}],redoMutations:[{id:yl.id,params:t}]}),!0):!1}},PS={id:"sheet.command.insert-defined-name",type:H.COMMAND,handler:(e,t)=>{const n=e.get(U),s=e.get(ce);if(!t)return!1;const i={...t};return n.syncExecuteCommand(Il.id,i)?(s.pushUndoRedo({unitID:t.unitId,undoMutations:[{id:Rd.id,params:i}],redoMutations:[{id:Il.id,params:i}]}),!0):!1}},Go={id:"sheet.command.insert-sheet",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(U),i=e.get(ce),r=e.get(P),o=e.get(Oe),a=kw(r,{unitId:t?.unitId});if(!a)return!1;const{unitId:l,workbook:u}=a;let d=u.getSheets().length;const c=t?.sheet,h=c?.id,g=Yg(c||{});t?(d=(n=t.index)!=null?n:d,g.id=h||hn(),g.name=c?.name||u.generateNewSheetName(`${o.t("sheets.tabs.sheet")}`)):(g.id=hn(),g.name=u.generateNewSheetName(`${o.t("sheets.tabs.sheet")}`));const m={index:d,sheet:g,unitId:l},p=ES(e,m);return s.syncExecuteCommand(cs.id,m)?(i.pushUndoRedo({unitID:l,undoMutations:[{id:En.id,params:p}],redoMutations:[{id:cs.id,params:m}]}),!0):!1}},Gp={id:"sheet.command.refill",type:H.COMMAND,handler:async(e,t)=>e.get(Ua).fillData(t.type)},Nl={id:"sheet.mutation.register-worksheet-range-theme-style",type:H.MUTATION,handler:(e,t)=>{if(!Y(e.get(P),t))return!1;const n=e.get(Dn),{unitId:s,rangeThemeStyleJson:i,themeName:r}=t,o=new Si(r,i);return n.registerRangeThemeStyle(s,o),!0}},qp={id:"sheet.mutation.unregister-worksheet-range-theme-style",type:H.MUTATION,handler:(e,t)=>{if(!Y(e.get(P),t))return!1;const n=e.get(Dn),{unitId:s,themeName:i}=t;return n.unregisterRangeThemeStyle(s,i),!0}},US={id:"sheet.command.register-worksheet-range-theme-style",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const{unitId:n,rangeThemeStyle:s}=t,i=e.get(P),r=e.get(U),o=e.get(ce);if(!Y(i,t))return!1;const a={unitId:n,themeName:s.getName(),rangeThemeStyleJson:s.toJson()},l={unitId:n,themeName:s.getName()};return r.syncExecuteCommand(Nl.id,a)&&o.pushUndoRedo({unitID:n,undoMutations:[{id:qp.id,params:l}],redoMutations:[{id:Nl.id,params:a}]}),!0}},oh={id:"sheet.command.remove-defined-name",type:H.COMMAND,handler:(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(_e);if(!t)return!1;const a={...t},l=o.onCommandExecute({id:oh.id,params:t}),u=[...(n=l.preRedos)!=null?n:[],{id:Rd.id,params:a},...l.redos],d=[...(s=l.preUndos)!=null?s:[],{id:Il.id,params:a},...l.undos];return fe(u,i)?(r.pushUndoRedo({unitID:t.unitId,undoMutations:d.filter(Boolean),redoMutations:u.filter(Boolean)}),!0):!1}},Wr={id:"sheet.command.remove-sheet",type:H.COMMAND,handler:(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(P),a=e.get(_e),l=e.get(Lt),u=Y(o,t);if(!u)return!1;const{unitId:d,subUnitId:c,workbook:h,worksheet:g}=u;if(h.getSheets().length<=1)return!1;const m=l.getConfig(bu),p={...Zp,...m?.largeSheetOperation},f=rS(g.getCellMatrix())>=p.largeSheetCellCountThreshold,v={subUnitId:c,unitId:d,subUnitName:g.getName()},C=f?null:dy(e,v),w=a.onCommandExecute({id:Wr.id,params:{unitId:d,subUnitId:c}}),b=[...(n=w.preRedos)!=null?n:[],{id:En.id,params:v},...w.redos],I=f?[]:[...(s=w.preUndos)!=null?s:[],{id:cs.id,params:C},...w.undos];return fe(b,i).result?(f?r.clearUndoRedo(d):r.pushUndoRedo({unitID:d,undoMutations:I,redoMutations:b}),!0):!1}};class pi{constructor(){E(this,"_borderInfo",{type:Qt.ALL,color:"#000000",style:tt.THIN,activeBorderType:!1}),E(this,"_borderInfo$",new xe(this._borderInfo)),E(this,"borderInfo$",this._borderInfo$.asObservable())}dispose(){this._borderInfo$.complete()}setType(t){this._borderInfo.type=t,this.setActiveBorderType(!0),this._refresh()}setColor(t){this._borderInfo.color=t,this._refresh()}setStyle(t){this._borderInfo.style=t,this._refresh()}setActiveBorderType(t){this._borderInfo.activeBorderType=t}getBorderInfo(){return this._borderInfo}_refresh(){this._borderInfo$.next(this._borderInfo)}}function Dd(e,t){const{startRow:n,startColumn:s,endRow:i,endColumn:r}=e;for(let o=n;o<=i;o++)for(let a=s;a<=r;a++)t(o,a)}const Qp=(e,t,n,s)=>{const{mr:i,worksheet:r}=e;t.startRow<0||t.startColumn<0||Dd(t,(o,a)=>{var l,u;const d=r.getMergedCell(o,a);let c=n;if(d&&(n.bc_tr||n.ml_tr||n.bl_tr||n.tl_mr||n.tl_bc||n.tl_br)){if(s){const h=Q.deepClone((l=i.getValue(d.startRow,d.startColumn))==null?void 0:l.s);c=h!=null&&h.bd?Object.assign(h.bd,n):n}i.setValue(d.startRow,d.startColumn,{s:{bd:c}})}else{if(s){const h=Q.deepClone((u=i.getValue(o,a))==null?void 0:u.s);c=h!=null&&h.bd?Object.assign(h.bd,n):n}i.setValue(o,a,{s:{bd:c}})}})},QM=e=>{const t={startRow:e.startRow-1,startColumn:e.startColumn,endRow:e.startRow-1,endColumn:e.endColumn},n={startRow:e.startRow,startColumn:e.startColumn-1,endRow:e.endRow,endColumn:e.startColumn-1},s={startRow:e.endRow+1,startColumn:e.startColumn,endRow:e.endRow+1,endColumn:e.endColumn},i={startRow:e.startRow,startColumn:e.endColumn+1,endRow:e.endRow,endColumn:e.endColumn+1},r={startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow,endColumn:e.endColumn},o={startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.startColumn},a={startRow:e.endRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn},l={startRow:e.startRow,startColumn:e.endColumn,endRow:e.endRow,endColumn:e.endColumn};return{topRangeOut:t,leftRangeOut:n,bottomRangeOut:s,rightRangeOut:i,topRange:r,leftRange:o,bottomRange:a,rightRange:l}};function KM(e,t,n){const{style:s,color:i,type:r}=e.getBorderInfo(),o=r===Qt.TOP||r===Qt.ALL||r===Qt.OUTSIDE,a=r===Qt.LEFT||r===Qt.ALL||r===Qt.OUTSIDE,l=r===Qt.BOTTOM||r===Qt.ALL||r===Qt.OUTSIDE,u=r===Qt.RIGHT||r===Qt.ALL||r===Qt.OUTSIDE,d=r===Qt.VERTICAL||r===Qt.ALL||r===Qt.INSIDE,c=r===Qt.HORIZONTAL||r===Qt.ALL||r===Qt.INSIDE,h=r.indexOf("tlbr")>-1,g=r.indexOf("tlbc")>-1,m=r.indexOf("tlmr")>-1,p=r.indexOf("bltr")>-1,f=r.indexOf("mltr")>-1,v=r.indexOf("bctr")>-1,C=n[0],{topRangeOut:w,leftRangeOut:b,bottomRangeOut:I,rightRangeOut:_,topRange:R,leftRange:M,bottomRange:x,rightRange:N}=QM(C),T=new de,{worksheet:O,unitId:k,subUnitId:D}=t;return{worksheet:O,unitId:k,subUnitId:D,style:s,color:i,type:r,top:o,left:a,right:u,bottom:l,vertical:d,horizontal:c,tl_br:h,tl_bc:g,tl_mr:m,bl_tr:p,ml_tr:f,bc_tr:v,topRangeOut:w,leftRangeOut:b,bottomRangeOut:I,rightRangeOut:_,topRange:R,leftRange:M,bottomRange:x,rightRange:N,range:C,mr:T,borderStyle:{s,cl:{rgb:i}}}}const $M=e=>{const{range:t,mr:n,borderStyle:s,vertical:i,horizontal:r,worksheet:o}=e;i&&Dd(t,(a,l)=>{var u,d,c;const h=o.getMergedCell(a,l);if(h){const g=(u=n.getValue(h.startRow,h.startColumn))==null?void 0:u.s;h.startColumn!==t.startColumn&&n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{l:Q.deepClone(s)}):{l:Q.deepClone(s)}}})}else{if(l!==t.endColumn){const g=(d=n.getValue(a,l))==null?void 0:d.s;n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{r:Q.deepClone(s)}):{r:Q.deepClone(s)}}})}if(l!==t.startColumn){const g=(c=n.getValue(a,l))==null?void 0:c.s;n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{l:Q.deepClone(s)}):{l:Q.deepClone(s)}}})}}}),r&&Dd(t,(a,l)=>{var u,d,c;const h=o.getMergedCell(a,l);if(h){const g=(u=n.getValue(h.startRow,h.startColumn))==null?void 0:u.s;h.startRow!==t.startRow&&n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{t:Q.deepClone(s)}):{t:Q.deepClone(s)}}})}else{if(a!==t.endRow){const g=(d=n.getValue(a,l))==null?void 0:d.s;n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{b:Q.deepClone(s)}):{b:Q.deepClone(s)}}})}if(a!==t.startRow){const g=(c=n.getValue(a,l))==null?void 0:c.s;n.setValue(a,l,{s:{bd:g!=null&&g.bd?Object.assign(g.bd,{t:Q.deepClone(s)}):{t:Q.deepClone(s)}}})}}})};function JM(e){const{borderStyle:t,tl_br:n,tl_bc:s,tl_mr:i,bl_tr:r,ml_tr:o,bc_tr:a}=e,l=(u,d,c)=>{Qp(e,u,d,c)};n&&l(e.range,{tl_br:Q.deepClone(t)},!0),s&&l(e.range,{tl_bc:Q.deepClone(t)},!0),i&&l(e.range,{tl_mr:Q.deepClone(t)},!0),r&&l(e.range,{bl_tr:Q.deepClone(t)},!0),o&&l(e.range,{ml_tr:Q.deepClone(t)},!0),a&&l(e.range,{bc_tr:Q.deepClone(t)},!0)}const eE=e=>{const{top:t,left:n,right:s,bottom:i,borderStyle:r,bottomRange:o,topRange:a,leftRange:l,rightRange:u,bottomRangeOut:d,topRangeOut:c,leftRangeOut:h,rightRangeOut:g}=e,m=(p,f,v)=>{Qp(e,p,f,v)};t&&(m(c,{b:null}),m(a,{t:Q.deepClone(r)},!0)),i&&(m(d,{t:null}),m(o,{b:Q.deepClone(r)},!0)),n&&(m(h,{r:null}),m(l,{l:Q.deepClone(r)},!0)),s&&(m(g,{l:null}),m(u,{r:Q.deepClone(r)},!0))},tE=e=>{const{range:t,worksheet:n,mr:s,top:i,bottom:r,left:o,right:a,vertical:l,horizontal:u,tl_br:d,tl_bc:c,tl_mr:h,bl_tr:g,ml_tr:m,bc_tr:p,topRange:f,bottomRange:v,leftRange:C,rightRange:w,topRangeOut:b,bottomRangeOut:I,leftRangeOut:_,rightRangeOut:R}=e,M=(x,N,T)=>{Qp(e,x,N,T)};!i&&!r&&!o&&!a&&!l&&!u&&!d&&!c&&!h&&!g&&!m&&!p&&(Dd(t,(x,N)=>{var T,O,k,D,B,W,F,K;const J=n.getMergedCell(x,N);if(J){if(J.endColumn!==t.endColumn){const ee=(T=s.getValue(J.startRow,J.startColumn))==null?void 0:T.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{r:null}):{r:null}}})}if(J.startColumn!==t.startColumn){const ee=(O=s.getValue(J.startRow,J.startColumn))==null?void 0:O.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{l:null}):{l:null}}})}if(J.endRow!==t.endRow){const ee=(k=s.getValue(J.startRow,J.startColumn))==null?void 0:k.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{b:null}):{b:null}}})}if(J.startRow!==t.startRow){const ee=(D=s.getValue(J.startRow,J.startColumn))==null?void 0:D.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{t:null}):{t:null}}})}}else{if(N!==t.endColumn){const ee=(B=s.getValue(x,N))==null?void 0:B.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{r:null}):{r:null}}})}if(N!==t.startColumn){const ee=(W=s.getValue(x,N))==null?void 0:W.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{l:null}):{l:null}}})}if(x!==t.endRow){const ee=(F=s.getValue(x,N))==null?void 0:F.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{b:null}):{b:null}}})}if(x!==t.startRow){const ee=(K=s.getValue(x,N))==null?void 0:K.s;s.setValue(x,N,{s:{bd:ee!=null&&ee.bd?Object.assign(ee.bd,{t:null}):{t:null}}})}}}),M(b,{b:null}),M(f,{t:null},!0),M(I,{t:null}),M(v,{b:null},!0),M(_,{r:null}),M(C,{l:null},!0),M(R,{l:null}),M(w,{r:null},!0),M(t,{tl_br:null},!0),M(t,{tl_bc:null},!0),M(t,{tl_mr:null},!0),M(t,{bl_tr:null},!0),M(t,{ml_tr:null},!0),M(t,{bc_tr:null},!0))},_u={id:"sheet.command.set-border",type:H.COMMAND,handler:(e,t)=>{var n;const s=e.get(U),i=e.get(ce),r=e.get(P),o=e.get(q),a=e.get(pi),l=Y(r,t);if(!l)return!1;const u=t?.ranges||((n=o.getCurrentSelections())==null?void 0:n.map(v=>v.range));if(!(u!=null&&u.length))return!1;const{activeBorderType:d}=a.getBorderInfo();if(!d)return!1;const c=KM(a,l,u);$M(c),eE(c),JM(c),tE(c);const{unitId:h,subUnitId:g,mr:m}=c,p={unitId:h,subUnitId:g,cellValue:m.getData()},f=Vt(e,p);return s.syncExecuteCommand(le.id,p)?(i.pushUndoRedo({unitID:h,undoMutations:[{id:le.id,params:f}],redoMutations:[{id:le.id,params:p}]}),!0):!1}},nE={id:"sheet.command.set-border-position",type:H.COMMAND,handler:(e,t)=>{if(!t.value)return!1;const n=e.get(U);return e.get(pi).setType(t.value),n.syncExecuteCommand(_u.id)}},sE={id:"sheet.command.set-border-style",type:H.COMMAND,handler:(e,t)=>{const n=e.get(U);return e.get(pi).setStyle(t.value),n.syncExecuteCommand(_u.id)}},iE={id:"sheet.command.set-border-color",type:H.COMMAND,handler:(e,t)=>{const n=e.get(U);return e.get(pi).setColor(t.value),n.syncExecuteCommand(_u.id)}},Ol={id:"sheet.command.set-border-basic",type:H.COMMAND,handler:(e,t)=>{const{unitId:n,subUnitId:s,value:i,ranges:r}=t,{type:o,color:a,style:l}=i,u=e.get(U),d=e.get(pi);return d.setType(o),a&&d.setColor(a),d.setStyle(l),u.syncExecuteCommand(_u.id,{unitId:n,subUnitId:s,ranges:r})}},rm={type:H.COMMAND,id:"sheet.command.set-col-data",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(P),r=Y(i,t);if(!r)return!1;const{columnData:o}=t,{unitId:a,subUnitId:l,worksheet:u}=r,d={subUnitId:l,unitId:a,columnData:o},c=hR(d,u);return n.syncExecuteCommand(ol.id,d)?(s.pushUndoRedo({unitID:a,undoMutations:[{id:ol.id,params:c}],redoMutations:[{id:ol.id,params:d}]}),!0):!1}},Ji={type:H.COMMAND,id:"sheet.command.set-col-visible-on-cols",handler:(e,t)=>{var n,s;const{unitId:i,subUnitId:r,ranges:o}=t,a=e.get(_e),l=e.get(U),u=e.get(P),d=Y(u,{unitId:i,subUnitId:r});if(!d)return!1;const{worksheet:c}=d,h={unitId:i,subUnitId:r,ranges:o},g={unitId:i,subUnitId:r,reveal:!0,selections:o.map(w=>({range:w,primary:Ht(w,c),style:null}))},m=mR(e,h),p={unitId:i,subUnitId:r,selections:NS(o).map(w=>({range:w,primary:Ht(w,c),style:null}))},f=fe([{id:Nr.id,params:h},{id:me.id,params:g}],l),v=a.onCommandExecute({id:Ji.id,params:t}),C=fe([...v.redos],l);if(f.result&&C.result){const w=a.afterCommandExecute({id:Ji.id,params:t});return fe(w.redos,l),e.get(ce).pushUndoRedo({unitID:i,undoMutations:[{id:Ur.id,params:m},{id:me.id,params:p},...(n=v.undos)!=null?n:[],...w.undos],redoMutations:[...(s=v.preRedos)!=null?s:[],{id:Nr.id,params:h},{id:me.id,params:g},...v.redos,...w.redos]}),!0}return!0}},ah={type:H.COMMAND,id:"sheet.command.set-selected-cols-visible",handler:e=>{var t;const n=e.get(q),s=e.get(U),i=(t=n.getCurrentSelections())==null?void 0:t.map(d=>d.range).filter(d=>d.rangeType===j.COLUMN);if(!(i!=null&&i.length))return!1;const r=Y(e.get(P));if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=i.map(d=>o.getHiddenCols(d.startColumn,d.endColumn)).flat();return s.executeCommand(Ji.id,{unitId:a,subUnitId:l,ranges:u})}},Lr={type:H.COMMAND,id:"sheet.command.set-col-hidden",handler:(e,t)=>{var n,s,i,r;const o=e.get(q),a=e.get(_e),l=e.get(P),u=e.get(U);let d=(n=t?.ranges)!=null&&n.length?t.ranges:(s=o.getCurrentSelections())==null?void 0:s.map(_=>_.range).filter(_=>_.rangeType===j.COLUMN);if(!(d!=null&&d.length))return!1;const c=Y(l,t);if(!c)return!1;const{worksheet:h,unitId:g,subUnitId:m}=c;d=rE(c.worksheet,d);const p={unitId:g,subUnitId:m,ranges:d},f={unitId:g,subUnitId:m,selections:NS(d).map(_=>({range:_,primary:Ht(_,h),style:null}))},v=gR(e,p),C={unitId:g,subUnitId:m,reveal:!0,selections:d.map(_=>({range:_,primary:Ht(_,h),style:null}))},w=fe([{id:Ur.id,params:p},{id:me.id,params:f}],u),b=a.onCommandExecute({id:Lr.id,params:p}),I=fe([...b.redos],u);if(w.result&&I.result){const _=a.afterCommandExecute({id:Lr.id,params:p});return fe(_.redos,u),e.get(ce).pushUndoRedo({unitID:g,undoMutations:[{id:Nr.id,params:v},{id:me.id,params:C},...(i=b.undos)!=null?i:[],..._.undos],redoMutations:[...(r=b.preRedos)!=null?r:[],{id:Ur.id,params:p},{id:me.id,params:f},...b.redos,..._.redos]}),!0}return!1}};function rE(e,t){const n=e.getRowCount()-1,s=e.getHiddenCols(),i=[];return t.forEach(r=>{const o=s.filter(a=>a.startColumn>=r.startColumn&&a.endColumn<=r.endColumn);if(o.length){let a=r.startColumn;o.forEach(l=>{l.startColumn>a&&(i.push({startColumn:a,endColumn:l.startColumn-1,startRow:0,endRow:n}),a=l.endColumn+1)}),a<=r.endColumn&&i.push({startColumn:a,endColumn:r.endColumn,startRow:0,endRow:n})}else i.push(r)}),i}function NS(e){return oE(e).map(t=>{const n=t.startColumn===0?t.endColumn+1:t.startColumn-1;return{...t,startColumn:n,endColumn:n}})}function oE(e){const t=[];let n;return e.sort((s,i)=>s.startColumn-i.startColumn).forEach(s=>{if(!n){n=s;return}n.endColumn===s.startColumn-1?n.endColumn=s.endColumn:(t.push(n),n=s)}),t.push(n),t}const qo={id:"sheet.command.set-defined-name",type:H.COMMAND,handler:(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(_e);if(!t)return!1;const a={...t},l=v0(e,t),u=o.onCommandExecute({id:qo.id,params:t}),d=[...(n=u.preRedos)!=null?n:[],{id:Rd.id,params:l},{id:Il.id,params:a},...u.redos],c=[...(s=u.preUndos)!=null?s:[],{id:Rd.id,params:a},{id:Il.id,params:l},...u.undos];return fe(d,i)?(r.pushUndoRedo({unitID:t.unitId,undoMutations:c.filter(Boolean),redoMutations:d.filter(Boolean)}),!0):!1}},lh=(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId);if(s==null)throw new Error("worksheet is null error!");const i=s.getConfig().freeze;return{unitId:t.unitId,subUnitId:t.subUnitId,...i}},wn={id:"sheet.mutation.set-frozen",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)throw new Error("universheet is null error!");const s=n.getSheetBySheetId(t.subUnitId);if(!s)return!1;const i=s.getConfig(),{startRow:r,startColumn:o,ySplit:a,xSplit:l}=t;return i.freeze={startRow:r,startColumn:o,ySplit:a,xSplit:l},!0}},gl={type:H.COMMAND,id:"sheet.command.set-frozen",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(P),r=Y(i,{unitId:t.unitId,subUnitId:t.subUnitId});if(!r)return!1;const{unitId:o,subUnitId:a,worksheet:l}=r,{startColumn:u,startRow:d,xSplit:c,ySplit:h}=t;if(d>=l.getRowCount()||u>=l.getColumnCount()||c>=l.getColumnCount()||h>=l.getRowCount())return!1;const g={unitId:o,subUnitId:a,...t},m=lh(e,g);return n.syncExecuteCommand(wn.id,g)?(s.pushUndoRedo({unitID:o,undoMutations:[{id:wn.id,params:m}],redoMutations:[{id:wn.id,params:g}]}),!0):!1}},No={type:H.COMMAND,id:"sheet.command.cancel-frozen",handler:(e,t)=>{const n=e.get(U),s=e.get(P),i=e.get(ce),r=Y(s,{unitId:t?.unitId,subUnitId:t?.subUnitId});if(!r)return!1;const{unitId:o,subUnitId:a}=r,l={unitId:o,subUnitId:a,startRow:-1,startColumn:-1,xSplit:0,ySplit:0},u=lh(e,l);return n.syncExecuteCommand(wn.id,l)&&i.pushUndoRedo({unitID:o,undoMutations:[{id:wn.id,params:u}],redoMutations:[{id:wn.id,params:l}]}),!0}},Wd={type:H.COMMAND,id:"sheet.command.set-gridlines-color",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(P),r=Y(i,t);if(!r)return!1;const{worksheet:o}=r,a=o.getConfig().gridlinesColor;if(a===t?.color)return!1;const{unitId:l,subUnitId:u}=r,d={color:t?.color,unitId:l,subUnitId:u},c={color:a,unitId:l,subUnitId:u};return n.syncExecuteCommand(al.id,d)?(s.pushUndoRedo({unitID:l,undoMutations:[{id:al.id,params:c}],redoMutations:[{id:al.id,params:d}]}),!0):!1}},Kt={id:"sheet.mutation.set-range-protection",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,rule:i,ruleId:r}=t;return e.get(We).setRule(n,s,r,i),!0}},mP=(e,t)=>{const{unitId:n,subUnitId:s,ruleId:i}=t,r=e.get(We).getRule(n,s,i);return r?{id:Kt.id,params:{...t,rule:r}}:null},Oo={id:"sheet.mutation.set-worksheet-protection",type:H.MUTATION,handler:(e,t)=>{const{unitId:n,subUnitId:s,rule:i}=t;return e.get(ft).setRule(n,s,i),!0}},OS={type:H.COMMAND,id:"sheet.command.set-protection",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),i=e.get(We),{rule:r,oldRule:o}=t,{unitId:a,subUnitId:l}=r,u=[],d=[];return o?.unitType===r.unitType?r.unitType===se.Worksheet?(u.push({id:Oo.id,params:{unitId:a,subUnitId:l,rule:r}}),d.push({id:Oo.id,params:{unitId:a,subUnitId:l,rule:o}})):(u.push({id:Kt.id,params:{unitId:a,subUnitId:l,rule:r,ruleId:r.id}}),d.push({id:Kt.id,params:{unitId:a,subUnitId:l,ruleId:o.id,rule:o}})):(o&&(o.unitType===se.Worksheet?(u.push({id:Hr.id,params:{unitId:a,subUnitId:l}}),d.push({id:$i.id,params:{unitId:a,rule:o,subUnitId:o.subUnitId}})):o.unitType===se.SelectRange&&(u.push({id:$n.id,params:{unitId:a,subUnitId:l,ruleIds:[o.id]}}),d.push({id:Hn.id,params:{unitId:a,subUnitId:l,rules:[o]}}))),r.unitType===se.Worksheet?(u.push({id:$i.id,params:{unitId:a,rule:r,subUnitId:r.subUnitId}}),d.unshift({id:Hr.id,params:{unitId:a,subUnitId:l}})):r.unitType===se.SelectRange&&(r.id=i.createRuleId(a,l),u.push({id:Hn.id,params:{unitId:a,subUnitId:l,rules:[r]}}),d.unshift({id:$n.id,params:{unitId:a,subUnitId:l,ruleIds:[r.id]}}))),fe(u,n)&&s.pushUndoRedo({unitID:a,undoMutations:d,redoMutations:u}),!0}},om={id:"sheet.command.set-range-custom-metadata",type:H.COMMAND,handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const s=e.get(U),{unitId:i,subUnitId:r}=n,{range:o,customMetadata:a}=t,{startRow:l,startColumn:u,endRow:d,endColumn:c}=o,h=Q.isArray(a),g=new de;for(let m=l;m<=d;m++)for(let p=u;p<=c;p++){const f=h?a[m-l][p-u]:a;g.setValue(m,p,f)}return s.syncExecuteCommand(le.id,{unitId:i,subUnitId:r,cellValue:g.getMatrix()})}},am={type:H.COMMAND,id:"sheet.command.set-row-data",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(P),r=Y(i,t);if(!r)return!1;const{rowData:o}=t,{unitId:a,subUnitId:l,worksheet:u}=r,d={subUnitId:l,unitId:a,rowData:o},c=RR(d,u);return n.syncExecuteCommand(ll.id,d)?(s.pushUndoRedo({unitID:a,undoMutations:[{id:ll.id,params:c}],redoMutations:[{id:ll.id,params:d}]}),!0):!1}},er={type:H.COMMAND,id:"sheet.command.set-specific-rows-visible",handler:(e,t)=>{var n,s,i;const{unitId:r,subUnitId:o,ranges:a}=t,l=e.get(U),u=e.get(ce),d=e.get(_e),c=Y(e.get(P),{unitId:r,subUnitId:o});if(!c)return!1;const{worksheet:h}=c,g={unitId:r,subUnitId:o,ranges:a},m={unitId:r,subUnitId:o,reveal:!0,selections:a.map(b=>({range:b,primary:Ht(b,h),style:null}))},p=yR(e,g),f={unitId:r,subUnitId:o,selections:AS(a).map(b=>({range:b,primary:Ht(b,h),style:null}))},v=fe([{id:Xi.id,params:g},{id:me.id,params:m}],l),C=d.onCommandExecute({id:er.id,params:t}),w=fe([...C.redos],l);if(v.result&&w.result){const b=d.afterCommandExecute({id:er.id,params:t});return fe(b.redos,l),u.pushUndoRedo({unitID:r,undoMutations:[...(n=C.preUndos)!=null?n:[],{id:Yi.id,params:p},{id:me.id,params:f},...(s=C.undos)!=null?s:[],...b.undos],redoMutations:[...(i=C.preRedos)!=null?i:[],{id:Xi.id,params:g},{id:me.id,params:m},...C.redos,...b.redos]}),!0}return!0}},uh={type:H.COMMAND,id:"sheet.command.set-selected-rows-visible",handler:async e=>{var t;const n=e.get(q),s=e.get(P),i=e.get(U),r=(t=n.getCurrentSelections())==null?void 0:t.map(c=>c.range).filter(c=>c.rangeType===j.ROW);if(!(r!=null&&r.length))return!1;const o=Y(s);if(!o)return!1;const{worksheet:a,unitId:l,subUnitId:u}=o,d=r.map(c=>a.getHiddenRows(c.startRow,c.endRow)).flat();return i.executeCommand(er.id,{unitId:l,subUnitId:u,ranges:d})}},Br={type:H.COMMAND,id:"sheet.command.set-rows-hidden",handler:(e,t)=>{var n,s,i,r,o,a;const l=e.get(q),u=e.get(U),d=e.get(ce),c=e.get(P),h=e.get(_e);let g=(n=t?.ranges)!=null&&n.length?t.ranges:(s=l.getCurrentSelections())==null?void 0:s.map(R=>R.range).filter(R=>R.rangeType===j.ROW);if(!(g!=null&&g.length))return!1;const m=Y(c,t);if(!m)return!1;g=aE(m.worksheet,g);const{unitId:p,subUnitId:f,worksheet:v}=m,C={unitId:p,subUnitId:f,ranges:g},w={unitId:p,subUnitId:f,selections:AS(g).map(R=>({range:R,primary:Ht(R,v),style:null}))},b=MR(e,C),I={unitId:p,subUnitId:f,reveal:!0,selections:g.map(R=>({range:R,primary:Ht(R,v),style:null}))},_=h.onCommandExecute({id:Br.id,params:C});if(fe([...(i=_.preRedos)!=null?i:[],{id:Yi.id,params:C},{id:me.id,params:w},..._.redos],u).result){const R=h.afterCommandExecute({id:Br.id,params:C});return fe(R.redos,u),d.pushUndoRedo({unitID:p,undoMutations:[...(r=_.preUndos)!=null?r:[],{id:Xi.id,params:b},{id:me.id,params:I},...(o=_.undos)!=null?o:[],...R.undos],redoMutations:[...(a=_.preRedos)!=null?a:[],{id:Yi.id,params:C},{id:me.id,params:w},..._.redos,...R.redos]}),!0}return!0}};function aE(e,t){const n=e.getMaxColumns()-1,s=e.getHiddenRows(),i=[];return t.forEach(r=>{const o=s.filter(a=>a.startRow>=r.startRow&&a.endRow<=r.endRow);if(o.length){let a=r.startRow;o.forEach(l=>{l.startRow>a&&(i.push({startRow:a,endRow:l.startRow-1,startColumn:0,endColumn:n}),a=l.endRow+1)}),a<=r.endRow&&i.push({startRow:a,endRow:r.endRow,startColumn:0,endColumn:n})}else i.push(r)}),i}function AS(e){return lE(e).map(t=>{const n=t.startRow===0?t.endRow+1:t.startRow-1;return{...t,startRow:n,endRow:n}})}function lE(e){const t=[];let n;return e.sort((s,i)=>s.startRow-i.startRow).forEach(s=>{if(!n){n=s;return}s.startRow===n.endRow+1?n.endRow=s.endRow:(t.push(n),n=s)}),t.push(n),t}const uE=(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().tabColor;return{...Q.deepClone(t),color:n}},kr={id:"sheet.mutation.set-tab-color",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getSheetBySheetId(t.subUnitId);return s?(s.getConfig().tabColor=t.color,!0):!1}},dh={type:H.COMMAND,id:"sheet.command.set-tab-color",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=Y(e.get(P),t);if(!i)return!1;const{unitId:r,subUnitId:o}=i,a={color:t.value,unitId:r,subUnitId:o},l=uE(e,a);return n.syncExecuteCommand(kr.id,a)?(s.pushUndoRedo({unitID:r,undoMutations:[{id:kr.id,params:l}],redoMutations:[{id:kr.id,params:a}]}),!0):!1}},VS={id:"sheet.mutation.set-workbook-name",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUnit(t.unitId,A.UNIVER_SHEET);return n?(n.setName(t.name),!0):!1}},Kp={type:H.COMMAND,id:"sheet.command.set-workbook-name",handler:(e,t)=>{var n;const s=e.get(U),i=e.get(_e);if(!kw(e.get(P),t))return!1;const r=i.onCommandExecute({id:Kp.id,params:t}),o={name:t.name,unitId:t.unitId},a=[...(n=r.preRedos)!=null?n:[],{id:VS.id,params:o},...r.redos];return fe(a,s).result}},dE=4,Iu={type:H.COMMAND,id:"sheet.command.set-worksheet-activate",handler:(e,t,n)=>{const s=e.get(U),i=Y(e.get(P),t);if(!i)return!1;const{unitId:r,subUnitId:o}=i;return new Promise(a=>{setTimeout(()=>{const l=s.syncExecuteCommand(lt.id,{unitId:r,subUnitId:o},n);a(l)},dE)})}},Qo={type:H.COMMAND,id:"sheet.command.delta-column-width",handler:async(e,t)=>{const n=e.get(q).getCurrentSelections();if(!(n!=null&&n.length))return!1;const s=e.get(U),i=e.get(ce),r=Y(e.get(P));if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,{anchorCol:u,deltaX:d}=t,c=o.getColumnWidth(u)+d,h=n.length===1&&n[0].range.rangeType===j.ALL,g=n.filter(k=>k.range.rangeType===j.COLUMN),m=h?j.ALL:g.some(({range:k})=>{const{startColumn:D,endColumn:B}=k;return D<=u&&u<=B})?j.COLUMN:j.NORMAL;let p;if(m===j.ALL){const k=o.getRowCount(),D=new Array(o.getColumnCount()).fill(void 0).map((B,W)=>({startRow:0,endRow:k-1,startColumn:W,endColumn:W}));p={subUnitId:l,unitId:a,colWidth:c,ranges:D}}else m===j.COLUMN?p={subUnitId:l,unitId:a,ranges:g.map(k=>z.clone(k.range)),colWidth:c}:p={subUnitId:l,unitId:a,colWidth:c,ranges:[{startRow:0,endRow:o.getMaxRows()-1,startColumn:u,endColumn:u}]};const f=e.get(zs).getSkeleton(a,l),{suitableRanges:v,remainingRanges:C}=fu(p.ranges,f);Np(v,o);const w=e.get(_e),{undos:b,redos:I}=w.onCommandExecute({id:Qo.id,params:p}),_=ip(p,o),R=s.syncExecuteCommand(Cn.id,p),{undos:M,redos:x}=w.generateMutationsOfAutoHeight({unitId:a,subUnitId:l,ranges:v,autoHeightRanges:v,lazyAutoHeightRanges:C}),{undos:N,redos:T}=e.get(_e).afterCommandExecute({id:Qo.id,params:p}),O=fe([...I,...T,...x],s);return R&&O.result&&i.pushUndoRedo({unitID:a,undoMutations:[{id:Cn.id,params:_},...b,...N,...M],redoMutations:[{id:Cn.id,params:p},...I,...T,...x]}),!0}},jr={type:H.COMMAND,id:"sheet.command.set-worksheet-col-width",handler:(e,t)=>{var n,s,i,r;const o=e.get(q),a=e.get(U),l=e.get(ce),u=e.get(_e),d=(n=t?.ranges)!=null&&n.length?t.ranges:(s=o.getCurrentSelections())==null?void 0:s.map(x=>x.range);if(!(d!=null&&d.length))return!1;const c=Y(e.get(P),t);if(!c)return!1;const{subUnitId:h,unitId:g,worksheet:m}=c,p=e.get(zs).getSkeleton(g,h),f={subUnitId:h,unitId:g,ranges:d,colWidth:t.value},{suitableRanges:v,remainingRanges:C}=fu(f.ranges,p);Np(v,m);const w=ip(f,m),b=a.syncExecuteCommand(Cn.id,f),{undos:I,redos:_}=u.generateMutationsOfAutoHeight({unitId:g,subUnitId:h,ranges:v,autoHeightRanges:v,lazyAutoHeightRanges:C}),R=u.onCommandExecute({id:jr.id,params:f}),M=fe([...R.redos,..._],a);if(b&&M.result){const x=u.afterCommandExecute({id:jr.id,params:f});return fe(x.redos,a),l.pushUndoRedo({unitID:g,undoMutations:[...(i=R.preUndos)!=null?i:[],{id:Cn.id,params:w},...R.undos,...x.undos,...I],redoMutations:[...(r=R.preRedos)!=null?r:[],{id:Cn.id,params:f},...R.redos,...x.redos,..._]}),!0}return!1}};H.COMMAND;const HS={type:H.COMMAND,id:"sheet.command.set-worksheet-column-count",handler:(e,t)=>{const{unitId:n,subUnitId:s,columnCount:i}=t,r=e.get(U),o=e.get(ce),a=e.get(P);if(!Y(a,t))return!1;const l={unitId:n,subUnitId:s,columnCount:i},u=ER(e,l);return r.syncExecuteCommand(ul.id,l)?(o.pushUndoRedo({unitID:n,undoMutations:[{id:ul.id,params:u}],redoMutations:[{id:ul.id,params:l}]}),!0):!1}},cE={type:H.COMMAND,id:"sheet.command.set-worksheet-default-style",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),{unitId:i}=t,r=xR(e,t);return n.syncExecuteCommand(Po.id,t)?(s.pushUndoRedo({unitID:i,undoMutations:[{id:Po.id,params:r}],redoMutations:[{id:Po.id,params:t}]}),!0):!1}},DS=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetHideMutationFactory]: worksheet is null error!");const{worksheet:s}=n;return{hidden:s.isSheetHidden(),unitId:t.unitId,subUnitId:s.getSheetId()}},cn={id:"sheet.mutation.set-worksheet-hidden",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)return!1;const s=n.getSheetBySheetId(t.subUnitId);return s?(s.getConfig().hidden=t.hidden,!0):!1}},ch={type:H.COMMAND,id:"sheet.command.set-worksheet-hidden",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(so),r=e.get(Oe),o=Y(e.get(P),t);if(!o)return!1;const{workbook:a,worksheet:l,unitId:u,subUnitId:d}=o;if(l.getConfig().hidden===pe.TRUE)return!1;const c={unitId:u,subUnitId:d,hidden:pe.TRUE},h=DS(e,c);return a.getSheets().filter(g=>g.getConfig().hidden===pe.FALSE).length===1?(i.emit(r.t("sheets.info.hideSheet")),!1):n.syncExecuteCommand(cn.id,c)?(s.pushUndoRedo({unitID:u,undoMutations:[{id:cn.id,params:h}],redoMutations:[{id:cn.id,params:c}]}),!0):!1}},hE=(e,t)=>{const n=sn(e.get(P),t);if(!n)throw new Error("[SetWorksheetNameMutationFactory]: worksheet is null error!");const{worksheet:s}=n;return{unitId:t.unitId,name:s.getName(),subUnitId:s.getSheetId()}},Fr={id:"sheet.mutation.set-worksheet-name",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(n==null)return!1;const s=n.getSheetBySheetId(t.subUnitId);return s?(s.getConfig().name=t.name,!0):!1}},zr={type:H.COMMAND,id:"sheet.command.set-worksheet-name",handler:(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(_e),a=Y(e.get(P),t);if(!a)return!1;const{unitId:l,subUnitId:u}=a,d={subUnitId:u,name:t.name,unitId:l},c=hE(e,d),h=o.onCommandExecute({id:zr.id,params:t}),g=[...(n=h.preRedos)!=null?n:[],{id:Fr.id,params:d},...h.redos],m=[...(s=h.preUndos)!=null?s:[],{id:Fr.id,params:c},...h.undos];return fe(g,i).result?(r.pushUndoRedo({unitID:l,undoMutations:m,redoMutations:g}),!0):!1}},gE=(e,t)=>({...Q.deepClone(t),toOrder:t.fromOrder,fromOrder:t.toOrder}),di={id:"sheet.mutation.set-worksheet-order",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getConfig();return s.sheetOrder.splice(t.fromOrder,1),s.sheetOrder.splice(t.toOrder,0,t.subUnitId),n.ensureSheetOrderUnique(),!0}},hh={type:H.COMMAND,id:"sheet.command.set-worksheet-order",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=Y(e.get(P),t);if(!i)return!1;const{workbook:r,unitId:o,subUnitId:a}=i,l={fromOrder:r.getConfig().sheetOrder.indexOf(a),toOrder:t.order,unitId:o,subUnitId:a},u=gE(e,l);return n.syncExecuteCommand(di.id,l)?(s.pushUndoRedo({unitID:o,undoMutations:[{id:di.id,params:u}],redoMutations:[{id:di.id,params:l}]}),!0):!1}};let _i=class{constructor(){E(this,"_model",new Map),E(this,"_pointChange",new Ve),E(this,"pointChange$",this._pointChange.asObservable())}addRule(t){this._ensureSubUnitMap(t.unitId).set(t.subUnitId,t),this._pointChange.next(t)}deleteRule(t,n){var s,i,r;const o=(s=this._model.get(t))==null?void 0:s.get(n);o&&((r=(i=this._model)==null?void 0:i.get(t))==null||r.delete(n),this._pointChange.next(o))}getRule(t,n){var s,i;return(i=(s=this._model)==null?void 0:s.get(t))==null?void 0:i.get(n)}toObject(){const t={};return[...this._model.keys()].forEach(n=>{const s=this._model.get(n);s!=null&&s.size&&(t[n]=[],[...s.keys()].forEach(i=>{const r=s.get(i);r&&t[n].push(r)}))}),t}fromObject(t){const n=new Map;Object.keys(t).forEach(s=>{const i=t[s];if(i!=null&&i.length){const r=new Map;i.forEach(o=>{r.set(o.subUnitId,o)}),n.set(s,r)}}),this._model=n}deleteUnitModel(t){this._model.delete(t)}_ensureSubUnitMap(t){let n=this._model.get(t);return n||(n=new Map,this._model.set(t,n)),n}getTargetByPermissionId(t,n){const s=this._model.get(t);if(!s)return null;for(const[i,r]of s)if(r.permissionId===n)return[t,i]}};class $p{constructor(t,n,s){E(this,"type",se.SelectRange),E(this,"subType",X.Delete),E(this,"status",Le.INIT),E(this,"value",!0),E(this,"id"),E(this,"unitId"),E(this,"subUnitId"),E(this,"permissionId"),this.unitId=t,this.subUnitId=n,this.permissionId=s,this.id=`${se.SelectRange}.${X.Delete}.${s}`}}class Jp{constructor(t,n,s){E(this,"type",se.SelectRange),E(this,"subType",X.ManageCollaborator),E(this,"status",Le.INIT),E(this,"value",!0),E(this,"id"),E(this,"unitId"),E(this,"subUnitId"),E(this,"permissionId"),this.unitId=t,this.subUnitId=n,this.permissionId=s,this.id=`${se.SelectRange}.${X.ManageCollaborator}.${s}`}}const Zn=()=>[Gi,he,Jp,$p],Vi=[X.Edit,X.View,X.ManageCollaborator,X.Delete],fP=(e="unitId",t="subUnitId",n="permissionId")=>Zn().reduce((s,i)=>{const r=new i(e,t,n);return s[r.subType]=r.value,s},{}),Al=()=>[ne,mp,up,vp,oi,gp,xa,mu,Jc,ka,ya,hp,fp,eh,Yw,Cp,pp,oo,Ea,Ma,cp,dp],mE=[X.Edit,X.Print,X.Comment,X.View,X.Copy,X.Export,X.ManageCollaborator,X.CreateSheet,X.DeleteSheet,X.RenameSheet,X.HideSheet,X.Duplicate,X.Share,X.MoveSheet,X.CopySheet,X.RecoverHistory,X.ViewHistory,X.CreatePermissionObject,X.InsertRow,X.InsertColumn,X.DeleteRow,X.DeleteColumn],_n=()=>[oe,cr,sh,pu],zn=()=>[qi,th,nh,wp,Sp,ao,lo,bp,_p,mt,nn,Qn,Kn,Ip],Yh=[X.Copy,X.DeleteColumn,X.DeleteRow,X.EditExtraObject,X.Filter,X.InsertColumn,X.InsertRow,X.InsertHyperlink,X.PivotTable,X.SetCellStyle,X.SetCellValue,X.SetColumnStyle,X.SetRowStyle,X.Sort];var pE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},xi=(e,t)=>(n,s)=>t(n,s,e);const fE="SHEET_WORKSHEET_PROTECTION_PLUGIN",vE="SHEET_WORKSHEET_PROTECTION_POINT_PLUGIN";let Ld=class extends Ms{constructor(e,t,n,s,i,r,o,a){super(),this._permissionService=e,this._univerInstanceService=t,this._injector=n,this._worksheetProtectionRuleModel=s,this._worksheetProtectionPointRuleModel=i,this._resourceManagerService=r,this._rangeProtectionRuleModel=o,this._logService=a,this._init(),this._initRuleChange(),this._initRuleSnapshot(),this._initPointSnapshot()}_init(){const e=t=>{const n=t.getUnitId(),s=i=>{const r=i.getSheetId();[..._n(),...zn()].forEach(o=>{const a=new o(n,r);this._permissionService.addPermissionPoint(a)}),this._logService.debug("[WorksheetPermissionService]","Initialization completed",n,r)};t.getSheets().forEach(i=>{s(i)}),t.sheetCreated$.subscribe(i=>{s(i)}),t.sheetDisposed$.subscribe(i=>{const r=i.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(n,r).forEach(o=>{[...Zn()].forEach(a=>{const l=new a(n,r,o.permissionId);this._permissionService.deletePermissionPoint(l.id)})}),[..._n(),...zn()].forEach(o=>{const a=new o(n,r);this._permissionService.deletePermissionPoint(a.id)})})};this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).forEach(t=>{e(t)}),this._univerInstanceService.getTypeOfUnitAdded$(A.UNIVER_SHEET).pipe(ln(this.dispose$)).subscribe(e),this._univerInstanceService.getTypeOfUnitDisposed$(A.UNIVER_SHEET).pipe(ln(this.dispose$)).subscribe(t=>{t.getSheets().forEach(n=>{const s=t.getUnitId(),i=n.getSheetId();_n().forEach(r=>{const o=new r(s,i);this._permissionService.deletePermissionPoint(o.id)})})})}_initRuleChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":break;case"delete":{_n().forEach(t=>{const n=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(n.id,!0)});break}case"set":{_n().forEach(t=>{const n=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(n.id,e.rule)});break}}}))}_initRuleSnapshot(){const e=()=>{const n=this._worksheetProtectionRuleModel.toObject();return JSON.stringify(n)},t=n=>{if(!n)return{};try{return JSON.parse(n)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:t,pluginName:fE,businesses:[xd.UNIVER_SHEET],onLoad:(n,s)=>{this._worksheetProtectionRuleModel.fromObject(s),Object.keys(s).forEach(i=>{_n().forEach(r=>{const o=new r(n,i);o.value=!1,this._permissionService.addPermissionPoint(o)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)},onUnLoad:n=>{const s=this._univerInstanceService.getUnit(n);s&&(s.getSheets().forEach(i=>{const r=i.getSheetId();[..._n(),...zn()].forEach(o=>{const a=new o(n,r);this._permissionService.deletePermissionPoint(a.id)})}),Al().forEach(i=>{const r=new i(n);this._permissionService.deletePermissionPoint(r.id)})),this._worksheetProtectionRuleModel.deleteUnitModel(n)}}))}_initPointSnapshot(){const e=()=>{const n=this._worksheetProtectionPointRuleModel.toObject();return JSON.stringify(n)},t=n=>{if(!n)return{};try{return JSON.parse(n)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:t,pluginName:vE,businesses:[xd.UNIVER_SHEET],onLoad:(n,s)=>{this._worksheetProtectionPointRuleModel.fromObject(s),Object.keys(s).forEach(i=>{zn().forEach(r=>{const o=new r(n,i);this._permissionService.addPermissionPoint(o)})})},onUnLoad:n=>{this._worksheetProtectionPointRuleModel.deleteUnitModel(n)}}))}};Ld=pE([xi(0,V(Je)),xi(1,V(P)),xi(2,V(pt)),xi(3,V(ft)),xi(4,V(_i)),xi(5,V(lu)),xi(6,V(We)),xi(7,V(ar))],Ld);const gh={id:"sheet.mutation.set-worksheet-permission-points",type:H.MUTATION,handler:(e,t)=>{const{rule:n}=t;return e.get(_i).addRule(n),!0}},WS={type:H.COMMAND,id:"sheet.command.set-worksheet-permission-points",async handler(e,t){if(!t)return!1;const n=e.get(U),{rule:s}=t;return n.executeCommand(gh.id,{rule:s,unitId:s.unitId,subUnitId:s.subUnitId}),!0}},CE={type:H.COMMAND,id:"sheet.command.set-worksheet-protection",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),{rule:i,permissionId:r,oldRule:o}=t,{unitId:a,subUnitId:l}=i,u={...i,permissionId:r};if(await n.executeCommand(Oo.id,{unitId:a,subUnitId:l,newRule:u})){const d=[{id:Oo.id,params:{unitId:a,subUnitId:l,newRule:u}}],c=[{id:Oo.id,params:{unitId:a,subUnitId:l,rule:o}}];s.pushUndoRedo({unitID:a,redoMutations:d,undoMutations:c})}return!0}},wE=(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().rightToLeft;return{...Q.deepClone(t),rightToLeft:n}},Zh={id:"sheet.mutation.set-worksheet-right-to-left",type:H.MUTATION,handler:(e,t)=>{const n=e.get(P).getUniverSheetInstance(t.unitId);if(!n)return!1;const s=n.getSheetBySheetId(t.subUnitId);if(!s)return!1;const i=s.getConfig();return i.rightToLeft=t.rightToLeft,!0}},vP={type:H.COMMAND,id:"sheet.command.set-worksheet-right-to-left",handler:async(e,t)=>{var n;const s=e.get(U),i=e.get(ce),r=Y(e.get(P),t);if(!r)return!1;const{unitId:o,subUnitId:a}=r;let l=pe.FALSE;t&&(l=(n=t.rightToLeft)!=null?n:pe.FALSE);const u={rightToLeft:l,unitId:o,subUnitId:a},d=wE(e,u);return s.syncExecuteCommand(Zh.id,u)?(i.pushUndoRedo({unitID:o,undoMutations:[{id:Zh.id,params:d}],redoMutations:[{id:Zh.id,params:u}]}),!0):!1}},LS={type:H.COMMAND,id:"sheet.command.set-worksheet-row-count",handler:(e,t)=>{const{unitId:n,subUnitId:s,rowCount:i}=t,r=e.get(U),o=e.get(ce),a=e.get(P);if(!Y(a,t))return!1;const l={unitId:n,subUnitId:s,rowCount:i},u=kR(e,l);return r.syncExecuteCommand(dl.id,l)?(o.pushUndoRedo({unitID:n,undoMutations:[{id:dl.id,params:u}],redoMutations:[{id:dl.id,params:l}]}),!0):!1}},Ko={type:H.COMMAND,id:"sheet.command.delta-row-height",handler:async(e,t)=>{var n,s;const i=e.get(q).getCurrentSelections(),r=e.get(_e);if(!(i!=null&&i.length))return!1;const o=Y(e.get(P));if(!o)return!1;const{worksheet:a,subUnitId:l,unitId:u}=o,{anchorRow:d,deltaY:c}=t,h=a.getRowHeight(d)+c,g=i.length===1&&i[0].range.rangeType===j.ALL,m=i.filter(x=>x.range.rangeType===j.ROW),p=g?j.ALL:m.some(({range:x})=>{const{startRow:N,endRow:T}=x;return N<=d&&d<=T})?j.ROW:j.NORMAL;let f;if(p===j.ALL){const x=a.getColumnCount(),N=new Array(a.getRowCount()).fill(void 0).map((T,O)=>({startRow:O,endRow:O,startColumn:0,endColumn:x-1}));f={subUnitId:l,unitId:u,rowHeight:h,ranges:N}}else p===j.ROW?f={subUnitId:l,unitId:u,ranges:m.map(x=>z.clone(x.range)),rowHeight:h}:f={subUnitId:l,unitId:u,rowHeight:h,ranges:[{startRow:d,endRow:d,startColumn:0,endColumn:a.getMaxColumns()-1}]};const v=Nw(f,a),C={unitId:u,subUnitId:l,ranges:f.ranges,autoHeightInfo:pe.FALSE},w=rp(C,a),b=e.get(U),I=e.get(ce),_=r.onCommandExecute({id:Ko.id,params:f}),R=fe([{id:os.id,params:f},{id:qn.id,params:C}],b),M=fe([..._.redos],b);if(R.result&&M.result){const x=r.afterCommandExecute({id:Ko.id,params:f});return fe(x.redos,b),I.pushUndoRedo({unitID:u,undoMutations:[...(n=_.preUndos)!=null?n:[],{id:os.id,params:v},{id:qn.id,params:w},..._.undos,...x.undos],redoMutations:[...(s=_.preRedos)!=null?s:[],{id:os.id,params:f},{id:qn.id,params:C},..._.redos,...x.redos]}),!0}return!1}},tr={type:H.COMMAND,id:"sheet.command.set-row-height",handler:(e,t)=>{var n,s,i,r;const o=e.get(q),a=e.get(U),l=e.get(ce),u=e.get(P),d=e.get(_e),c=(n=t?.ranges)!=null&&n.length?t.ranges:(s=o.getCurrentSelections())==null?void 0:s.map(R=>R.range);if(!(c!=null&&c.length))return!1;const h=Y(u,t);if(!h)return!1;const{unitId:g,subUnitId:m,worksheet:p}=h,f={subUnitId:m,unitId:g,ranges:c,rowHeight:t.value},v=Nw(f,p),C={unitId:g,subUnitId:m,ranges:f.ranges,autoHeightInfo:pe.FALSE},w=rp(C,p),b=fe([{id:os.id,params:f},{id:qn.id,params:C}],a),I=d.onCommandExecute({id:tr.id,params:f}),_=fe([...I.redos],a);if(b.result&&_.result){const R=d.afterCommandExecute({id:tr.id,params:f});return fe(R.redos,a),l.pushUndoRedo({unitID:g,undoMutations:[...(i=I.preRedos)!=null?i:[],{id:os.id,params:v},{id:qn.id,params:w},...I.undos,...R.undos],redoMutations:[...(r=I.preRedos)!=null?r:[],{id:os.id,params:f},{id:qn.id,params:C},...I.redos,...R.redos]}),!0}return!1}},ci={type:H.COMMAND,id:"sheet.command.set-row-is-auto-height",handler:(e,t)=>{var n,s;const i=e.get(U),r=e.get(ce),o=e.get(q),a=e.get(P),l=Y(a,t);if(!l)return!1;const{unitId:u,subUnitId:d,worksheet:c}=l,h=(n=t?.ranges)!=null&&n.length?t.ranges:(s=o.getCurrentSelections())==null?void 0:s.map(x=>x.range);if(!(h!=null&&h.length))return!1;const g={unitId:u,subUnitId:d,ranges:h,autoHeightInfo:pe.TRUE},m=rp(g,c),p=i.syncExecuteCommand(qn.id,g),f=e.get(zs).getSkeleton(u,d),{suitableRanges:v,remainingRanges:C}=fu(g.ranges,f),w=e.get(_e),{undos:b,redos:I}=w.generateMutationsOfAutoHeight({unitId:u,subUnitId:d,ranges:v,autoHeightRanges:v,lazyAutoHeightRanges:C}),{undos:_,redos:R}=w.onCommandExecute({id:ci.id,params:g}),M=fe([...R,...I],i);return p&&M.result?(r.pushUndoRedo({unitID:u,undoMutations:[{id:qn.id,params:m},..._,...b],redoMutations:[{id:qn.id,params:g},...R,...I]}),!0):!1}},uo={type:H.COMMAND,id:"sheet.command.set-worksheet-show",handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{unitId:s,subUnitId:i,worksheet:r}=n;if(r.getConfig().hidden===pe.FALSE)return!1;const o=e.get(U),a=e.get(ce),l={unitId:s,subUnitId:i,hidden:pe.FALSE},u=DS(e,l),d=o.syncExecuteCommand(cn.id,l),c={unitId:s,subUnitId:i},h=o.syncExecuteCommand(lt.id,c);return d&&h?(a.pushUndoRedo({unitID:s,undoMutations:[{id:cn.id,params:u}],redoMutations:[{id:cn.id,params:l}]}),!0):!1}},BS={type:H.COMMAND,id:"sheet.command.split-text-to-columns",handler:(e,t)=>{const n=Y(e.get(P),t);if(!n)return!1;const{unitId:s,subUnitId:i,worksheet:r}=n,{range:o,delimiter:a,customDelimiter:l,treatMultipleDelimitersAsOne:u}=t,{lastRow:d,rs:c,maxLength:h}=YR(r,o,a,l,u),g=r.getColumnCount(),{startColumn:m}=De.transformRange(o,r);if(o.startColumn!==o.endColumn)return!1;const p=e.get(U),f=e.get(ce),v=[],C=[],w=m+h+1-g;if(w>0){const M={unitId:s,subUnitId:i,range:{startRow:0,endRow:r.getRowCount()-1,startColumn:g-1,endColumn:g-1+w}};v.push({id:on.id,params:M});const x=Qc(e,M);C.push({id:$t.id,params:x})}const b={startRow:o.startRow,endRow:d,startColumn:m,endColumn:m+h},I=new de;for(let M=b.startRow;M<=b.endRow;M++)for(let x=b.startColumn;x<=b.endColumn;x++){const N=c[M-b.startRow];x===0&&N?.length===1?I.setValue(M,x,r.getCell(M,x)):I.setValue(M,x,{v:N?.[x-b.startColumn]||null,p:null,f:null,si:null,custom:null})}const _={unitId:s,subUnitId:i,cellValue:I.clone()},R=Vt(e,_);return v.push({id:le.id,params:_}),C.unshift({id:le.id,params:R}),fe(v,p).result?(f.pushUndoRedo({unitID:s,undoMutations:C,redoMutations:v}),!0):!1}},Xr=bn("INumfmtService"),CP=(e,t)=>{const n=e.get(Xr),{values:s,unitId:i,subUnitId:r}=t,o=[],a=[];Object.keys(s).forEach(u=>{s[u].ranges.forEach(d=>{De.foreach(d,(c,h)=>{const g=n.getValue(i,r,c,h);g?o.push({pattern:g.pattern,row:c,col:h}):a.push({startColumn:h,endColumn:h,startRow:c,endRow:c})})})});const l=[];if(o.length){const u=lm(i,r,o);Object.keys(u.values).forEach(d=>{const c=u.values[d];c.ranges=Dw(c.ranges)}),l.push({id:ef.id,params:lm(i,r,o)})}return a.length&&l.push({id:tf.id,params:{unitId:i,subUnitId:r,ranges:a}}),l},ef={id:"sheet.mutation.set.numfmt",type:H.MUTATION,handler:(e,t)=>{if(!t)return!1;const{values:n,refMap:s}=t,i=e.get(Xr),r=t.unitId,o=t.subUnitId,a=Object.keys(n).reduce((l,u)=>{const d=s[u],c=n[u].ranges;return d&&l.push({...d,ranges:c}),l},[]);return i.setValues(r,o,a),!0}},tf={id:"sheet.mutation.remove.numfmt",type:H.MUTATION,handler:(e,t)=>{if(!t)return!1;const{unitId:n,subUnitId:s,ranges:i}=t;return e.get(Xr).deleteValues(n,s,i),!0}},SE=(e,t)=>{const n=e.get(Xr),{ranges:s,unitId:i,subUnitId:r}=t,o=[];if(s.forEach(l=>{De.foreach(l,(u,d)=>{const c=n.getValue(i,r,u,d);c&&o.push({pattern:c.pattern,row:u,col:d})})}),!o.length)return[];const a=lm(i,r,o);return Object.keys(a.values).forEach(l=>{const u=a.values[l];u.ranges=Dw(u.ranges)}),[{id:ef.id,params:a}]},lm=(e,t,n)=>{const s=ZR(n,"pattern"),i={},r={},o=GR();return Object.keys(s).forEach(a=>{const l=s[a],u=o();i[u]={pattern:a},l.forEach(d=>{r[u]||(r[u]={ranges:[]}),r[u].ranges.push(Dc(d.row,d.col))})}),{unitId:e,subUnitId:t,refMap:i,values:r}},nf={id:"sheet.command.text-to-number",type:H.COMMAND,handler:(e,t)=>{var n,s,i,r,o;const a=Y(e.get(P),t);if(!a)return!1;const l=t?.ranges||((n=e.get(q).getCurrentSelections())==null?void 0:n.map(w=>w.range));if(!(l!=null&&l.length))return!1;const u=e.get(U),d=e.get(ce),{worksheet:c,unitId:h,subUnitId:g}=a,m=new de,p=[];for(let w=0;w<l.length;w++)for(let b=l[w].startRow;b<=l[w].endRow;b++)for(let I=l[w].startColumn;I<=l[w].endColumn;I++){if(m.getValue(b,I))continue;const _=c.getCellRaw(b,I),R=typeof _?.s=="string"?(i=(s=c.getStyleDataByHash(_.s))==null?void 0:s.n)==null?void 0:i.pattern:(o=(r=_?.s)==null?void 0:r.n)==null?void 0:o.pattern;_&&_.v&&(_.t!==je.NUMBER||Cs(R))&&rr(_.v)&&(m.setValue(b,I,{v:Number(_.v),t:je.NUMBER}),Cs(R)&&p.push({startRow:b,endRow:b,startColumn:I,endColumn:I}))}const f={subUnitId:g,unitId:h,cellValue:m.getMatrix()},v=[{id:le.id,params:f}],C=[{id:le.id,params:Vt(e,f)}];if(p.length){const w={unitId:h,subUnitId:g,ranges:p};v.push({id:tf.id,params:w}),C.push(...SE(e,w))}return fe(v,u).result?(d.pushUndoRedo({unitID:h,undoMutations:C,redoMutations:v}),!0):!1}},jS={id:"sheet.command.toggle-cell-checkbox",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const{unitId:n,subUnitId:s,row:i,col:r,paragraphIndex:o}=t,a=e.get(P).getUnit(n,A.UNIVER_SHEET),l=a?.getSheetBySheetId(s),u=e.get(ce),d=e.get(U);if(!l)return!1;const c=l.getCell(i,r);if(!(c!=null&&c.p))return!1;const h=Q.deepClone(c.p),g=new $_(h),m=J_.paragraph.bullet.toggleChecklist({document:g,paragraphIndex:o});if(!m)return!1;eI.apply(g.getBody(),m.serialize());const p={unitId:n,subUnitId:s,cellValue:{[i]:{[r]:{p:h,t:je.STRING}}}},f={id:le.id,params:p},v=Vt(e,p),C={id:le.id,params:v},w=[f],b=[C];return u.pushUndoRedo({redoMutations:w,undoMutations:b,unitID:n}),d.syncExecuteCommand(f.id,f.params)}},$o={type:H.COMMAND,id:"sheet.command.toggle-gridlines",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=Y(e.get(P),t);if(!i)return!1;const{worksheet:r}=i,o=r.getConfig().showGridlines;if(o===t?.showGridlines)return!1;const{unitId:a,subUnitId:l}=i,u={showGridlines:o===pe.TRUE?pe.FALSE:pe.TRUE,unitId:a,subUnitId:l},d={showGridlines:o,unitId:a,subUnitId:l};return n.syncExecuteCommand(Uo.id,u)?(s.pushUndoRedo({unitID:a,undoMutations:[{id:Uo.id,params:d}],redoMutations:[{id:Uo.id,params:u}]}),!0):!1}},FS={id:"sheet.command.unregister-worksheet-range-theme-style",type:H.COMMAND,handler:(e,t)=>{var n;if(!t||!Y(e.get(P),t))return!1;const s=e.get(U),i=e.get(ce),r=e.get(Dn),{unitId:o,themeName:a}=t,l={unitId:o,themeName:a},u={unitId:o,themeName:a,rangeThemeStyleJson:(n=r.getRangeThemeStyle(o,a))==null?void 0:n.toJson()};return s.syncExecuteCommand(Nl.id,t)?(i.pushUndoRedo({unitID:o,undoMutations:[{id:Nl.id,params:u}],redoMutations:[{id:qp.id,params:l}]}),!0):!1}},bE={id:"sheet.mutation.add-range-theme",type:H.MUTATION,handler:(e,t)=>{if(!t)return!1;const{styleJSON:n,unitId:s}=t,i=e.get(Dn),r=new Si(n.name);return r.fromJson(n),i.registerRangeThemeStyle(s,r),!0}},_E={id:"sheet.mutation.empty",type:H.MUTATION,handler:()=>!0},sf={id:"sheet.operation.mark-dirty-row-auto-height",type:H.OPERATION,handler:()=>!0},rf={id:"sheet.operation.cancel-mark-dirty-row-auto-height",type:H.OPERATION,handler:()=>!0},IE={id:"sheet.mutation.remove-range-theme",type:H.MUTATION,handler:(e,t)=>{if(!t)return!1;const{styleName:n,unitId:s}=t;return e.get(Dn).unregisterRangeThemeStyle(s,n),!0}},RE={id:"sheet.mutation.set-range-theme",type:H.MUTATION,handler:(e,t)=>{if(!t)return!1;const{unitId:n,styleName:s,style:i}=t,r=e.get(Dn).getRangeThemeStyle(n,s);return r&&(i.headerRowStyle&&r.setHeaderRowStyle(i.headerRowStyle),i.firstRowStyle&&r.setFirstRowStyle(i.firstRowStyle),i.secondRowStyle&&r.setSecondRowStyle(i.secondRowStyle),i.lastRowStyle&&r.setLastRowStyle(i.lastRowStyle)),!0}},mh={id:"sheet.operation.scroll-to-cell",type:H.OPERATION,handler:()=>!0};var yE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Gh=(e,t)=>(n,s)=>t(n,s,e);const{getLenS:ME,getDataIndex:EE,fillCopy:_v,fillCopyStyles:xE,generateNullCellValueRowCol:kE}=RS,{otherRule:TE}=yS;let Vl=class extends ae{constructor(t,n,s){super(),E(this,"_beforeApplyData",[]),E(this,"_copyData",[]),this._univerInstanceService=t,this._autoFillService=n,this._injector=s,this._init()}_init(){this._initDefaultHook()}quit(){this._beforeApplyData=[],this._copyData=[]}_initDefaultHook(){this.disposeWithMe(this._autoFillService.addHook({id:"default",type:Mr.DEFAULT,priority:0,onBeforeFillData:(t,n)=>this._presetAndCacheData(t,n),onFillData:(t,n,s)=>this._fillData(t,n,s)}))}_presetAndCacheData(t,n){var s;const{unitId:i,subUnitId:r,target:o}=t,a=(s=this._univerInstanceService.getUnit(i))==null?void 0:s.getSheetBySheetId(r);if(!a)throw new Error(`Worksheet not found for unitId: ${i}, subUnitId: ${r}`);const l=a.getCellMatrix(),u=[];return o.rows.forEach(d=>{const c=[];o.cols.forEach(h=>{c.push(Q.deepClone(l.getValue(d,h)))}),u.push(c)}),this._beforeApplyData=u,this._copyData=this._getCopyData(t,n),this._shouldDisableSeries(this._copyData)?(this._autoFillService.setDisableApplyType(gt.SERIES,!0),gt.COPY):(this._autoFillService.setDisableApplyType(gt.SERIES,!1),this._getPreferredApplyType(this._copyData))}_getApplyData(t,n,s,i,r,o=!0,a){const l=[],u=Math.floor(s/n),d=s%n,c=this._autoFillService.getRules();if(!o&&r===gt.ONLY_FORMAT)return console.error("ERROR: only format can not be applied when hasStyle is false"),[];const h={};c.forEach(g=>{h[g.type]=[]}),c.forEach(g=>{const{type:m,applyFunctions:p={}}=g,f=t[m];f&&f.forEach(v=>{const C=ME(v.index,d),w=v.index.length*u+C,b=this._applyFunctions(v,w,i,r,p,t,a),I=EE(n,s,v.index);h[m].push({data:b,index:I})})});for(let g=0;g<s;g++)c.forEach(m=>{const{type:p}=m,f=h[p];for(let v=0;v<f.length;v++)g in f[v].index&&l.push(f[v].data[f[v].index[g]])});return l}_applyFunctions(t,n,s,i,r,o,a){const{data:l}=t,u=s===Z.UP||s===Z.LEFT;if(i===gt.COPY){const d=r?.[gt.COPY];return d?d(t,n,s,o,a):(u&&l.reverse(),_v(l,n))}if(i===gt.SERIES){const d=r?.[gt.SERIES];return d?d(t,n,s,o):(u&&l.reverse(),r!=null&&r[gt.COPY]?r[gt.COPY](t,n,s,o,a):_v(l,n))}if(i===gt.ONLY_FORMAT){const d=r?.[gt.ONLY_FORMAT];return d?d(t,n,s,o):xE(l,n)}}_getCopyData(t,n){var s;const{unitId:i,subUnitId:r,source:o}=t,a=(s=this._univerInstanceService.getUnit(i))==null?void 0:s.getSheetBySheetId(r);if(!a)throw new Error("No worksheet found");const l=a.getCellMatrix(),u=this._autoFillService.getRules(),d=[],c=n===Z.DOWN||n===Z.UP;let h,g;return c?(h=o.cols,g=o.rows):(h=o.rows,g=o.cols),h.forEach(m=>{const p=this._getEmptyCopyDataPiece(),f={type:void 0,cellData:void 0};g.forEach(v=>{let C;c?C=l.getValue(v,m):C=l.getValue(m,v);const{type:w,isContinue:b}=u.find(I=>I.match(C,this._injector))||TE;if(b(f,C)){const I=p[w],_=I[I.length-1];_.data.push(C),_.index.push(v-g[0])}else{const I=p[w];I?I.push({data:[C],index:[v-g[0]]}):p[w]=[{data:[C],index:[v-g[0]]}]}f.type=w,f.cellData=C}),d.push(p)}),d}_getEmptyCopyDataPiece(){const t={};return this._autoFillService.getRules().forEach(n=>{t[n.type]=[]}),t}_getMergeApplyData(t,n,s,i,r){var o;const{unitId:a,subUnitId:l}=r,u=(o=this._univerInstanceService.getUnit(a))==null?void 0:o.getSheetBySheetId(l);if(!u)throw new Error("No active sheet found");const d=[];for(let c=t.startRow;c<=t.endRow;c++)for(let h=t.startColumn;h<=t.endColumn;h++){const{isMergedMainCell:g,startRow:m,startColumn:p,endRow:f,endColumn:v}=u.getCellInfoInMergeData(c,h);if(g){if(s===Z.DOWN){let C=m+i,w=f+i;for(;w<=n.endRow;)d.push({startRow:C,startColumn:p,endRow:w,endColumn:v}),C+=i,w+=i}else if(s===Z.UP){let C=m-i,w=f-i;for(;C>=n.startRow;)d.push({startRow:C,startColumn:p,endRow:w,endColumn:v}),C-=i,w-=i}else if(s===Z.RIGHT){let C=p+i,w=v+i;for(;w<=n.endColumn;)d.push({startRow:m,startColumn:C,endRow:f,endColumn:w}),C+=i,w+=i}else if(s===Z.LEFT){let C=p-i,w=v-i;for(;C>=n.startColumn;)d.push({startRow:m,startColumn:C,endRow:f,endColumn:w}),C-=i,w-=i}}}return d}_fillData(t,n,s){var i,r,o;const a=[],l=[];let u=!0;s===gt.NO_FORMAT&&(u=!1,s=gt.SERIES);const{source:d,target:c,unitId:h,subUnitId:g}=t;if(!d||!c||n==null)return{undos:a,redos:l};const m=Or(d),p=Or(c),{cols:f,rows:v}=c,{cols:C,rows:w}=d,b=this._copyData;let I;n===Z.DOWN||n===Z.UP?I=w.length:I=C.length;const _=[];if(n===Z.DOWN||n===Z.UP){const B=v.length,W=[];f.forEach((F,K)=>{const J=b[K],ee=this._getApplyData(J,I,B,n,s,u,t);W.push(ee)});for(let F=0;F<W[0].length;F++){const K=[];for(let J=0;J<W.length;J++)K.push({s:null,...W[J][F]});_.push(K)}}else{const B=f.length;v.forEach((W,F)=>{const K=b[F],J=this._getApplyData(K,I,B,n,s,u,t),ee=[];for(let we=0;we<J.length;we++)ee.push({s:null,...J[we]});_.push(ee)})}let R=[];const M=(i=this._univerInstanceService.getUnit(h))==null?void 0:i.getStyles();if(u?(R=this._getMergeApplyData(m,p,n,I,t),_.forEach(B=>{B.forEach(W=>{W&&M&&M&&(W.s=M.getStyleByCell(W))})})):_.forEach((B,W)=>{B.forEach((F,K)=>{F&&M&&(F.s=M.getStyleByCell(this._beforeApplyData[W][K])||null)})}),s===gt.ONLY_FORMAT&&_.forEach((B,W)=>{B.forEach((F,K)=>{if(F){const J=this._beforeApplyData[W][K]||{};F.f=J.f,F.si=J.si,F.t=J.t,F.v=J.v}})}),u){const B=[],W=(o=(r=this._univerInstanceService.getUniverSheetInstance(h))==null?void 0:r.getSheetBySheetId(g))==null?void 0:o.getMergeData();if(W&&W.forEach(F=>{z.intersects(F,p)&&B.push(F)}),B.length){const F={unitId:h,subUnitId:g,ranges:B},K=this._injector.invoke(pn,F);l.push({id:et.id,params:F}),a.unshift({id:qe.id,params:K})}}const x={subUnitId:g,unitId:h,cellValue:kE([c])},N=this._injector.invoke(Vt,x);l.push({id:le.id,params:x}),a.unshift({id:le.id,params:N});const T=new de;v.forEach((B,W)=>{f.forEach((F,K)=>{_[W][K]&&T.setValue(B,F,_[W][K])})});const O=T.getMatrix(),k={subUnitId:g,unitId:h,cellValue:O},D=this._injector.invoke(Vt,k);if(this._autoFillService.getActiveHooks().forEach(B=>{var W;(W=B.onBeforeSubmit)==null||W.call(B,t,n,s,O)}),a.unshift({id:le.id,params:D}),l.push({id:le.id,params:k}),R!=null&&R.length){const B=Vr(R),W={unitId:h,subUnitId:g,ranges:B},F=this._injector.invoke(On,W);a.unshift({id:et.id,params:F}),l.push({id:qe.id,params:W})}return{undos:a,redos:l}}_shouldDisableSeries(t){return t.every(n=>Object.keys(n).every(s=>{var i;return((i=n[s])==null?void 0:i.length)===0||[Gt.OTHER,Gt.FORMULA].includes(s)}))}_getPreferredApplyType(t){return t.every(n=>Object.keys(n).every(s=>{var i,r;return((i=n[s])==null?void 0:i.length)===0||((r=n[s])==null?void 0:r.length)===1&&n[s][0].data.length===1&&Gt.NUMBER===s}))?gt.COPY:gt.SERIES}};Vl=yE([Gh(0,P),Gh(1,Ua),Gh(2,V(pt))],Vl);const zS="maxCellsPerSheet",PE=3e6;var UE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Iv=(e,t)=>(n,s)=>t(n,s,e);const NE="SHEET_DEFINED_NAME_PLUGIN",nr="AllDefaultWorkbook";let Bd=class extends ae{constructor(t,n){super(),this._definedNamesService=t,this._resourceManagerService=n,this._initialize()}_initialize(){this._initSnapshot()}_initSnapshot(){const t=s=>{const i=this._definedNamesService.getDefinedNameMap(s);return i?JSON.stringify(i):""},n=s=>{if(!s)return{};try{return JSON.parse(s)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({pluginName:NE,businesses:[A.UNIVER_SHEET],toJson:s=>t(s),parseJson:s=>n(s),onUnLoad:s=>{this._definedNamesService.removeUnitDefinedName(s)},onLoad:(s,i)=>{this._definedNamesService.registerDefinedNames(s,i)}}))}};Bd=UE([Iv(0,wi),Iv(1,lu)],Bd);var OE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},qh=(e,t)=>(n,s)=>t(n,s,e);const AE=[wn.id],VE=[rn.id,on.id,an.id,$t.id,Wn.id,Ln.id];let Hl=class extends ae{constructor(t,n,s){var i,r;super(),E(this,"_d",new Et),E(this,"_enabled",!0),this._univerInstanceService=t,this._commandService=n,this._configService=s;const o=(r=(i=this._configService.getConfig(bu))==null?void 0:i.freezeSync)!=null?r:!0;this.setEnabled(o)}getEnabled(){return this._enabled}setEnabled(t){t?this._d.dispose():this._initOnlyLocalListener(),this._enabled=t}_initOnlyLocalListener(){this._d.add(this._commandService.beforeCommandExecuted((t,n)=>{AE.includes(t.id)&&(n||(n={}),n.onlyLocal=!0)})),this._d.add(this._commandService.onCommandExecuted((t,n)=>{if(VE.includes(t.id)&&n!=null&&n.fromCollab){const{id:s,params:i}=t;s===rn.id?this._handleInsertRowMutation(i,n):s===on.id?this._handleInsertColMutation(i,n):s===an.id?this._handleRemoveRowMutation(i,n):s===$t.id?this._handleRemoveColMutation(i,n):s===Wn.id?this._handleMoveRowsMutation(i,n):s===Ln.id&&this._handleMoveColsMutation(i,n)}}))}_handleInsertRowMutation(t,n){const{range:s,unitId:i,subUnitId:r}=t,o=this._getFreeze(i,r);if(o&&s.startRow<o.startRow){const a=s.endRow-s.startRow+1,l={...o,startRow:Math.max(1,o.startRow+a),ySplit:Math.max(1,o.ySplit+a)};this._sequenceExecute(i,r,l,n)}}_handleInsertColMutation(t,n){const{range:s,unitId:i,subUnitId:r}=t,o=this._getFreeze(i,r);if(o&&s.startColumn<o.startColumn){const a=s.endColumn-s.startColumn+1,l={...o,startColumn:Math.max(1,o.startColumn+a),xSplit:Math.max(1,o.xSplit+a)};this._sequenceExecute(i,r,l,n)}}_handleRemoveRowMutation(t,n){const{range:s,unitId:i,subUnitId:r}=t,o=this._getFreeze(i,r);if(o&&s.startRow<o.startRow){const a=Math.min(o.startRow,s.endRow+1)-s.startRow,l={...o,startRow:Math.max(1,o.startRow-a),ySplit:Math.max(1,o.ySplit-a)};this._sequenceExecute(i,r,l,n)}}_handleRemoveColMutation(t,n){const{range:s,unitId:i,subUnitId:r}=t,o=this._getFreeze(i,r);if(o&&s.startColumn<o.startColumn){const a=Math.min(o.startColumn,s.endColumn+1)-s.startColumn,l={...o,startColumn:Math.max(1,o.startColumn-a),xSplit:Math.max(1,o.xSplit-a)};this._sequenceExecute(i,r,l,n)}}_handleMoveRowsMutation(t,n){const{sourceRange:s,targetRange:i,unitId:r,subUnitId:o}=t,a=this._getFreeze(r,o);if(!a||a.startRow<=0||s.startRow>=a.startRow&&i.startRow>=a.startRow||s.endRow<a.startRow&&i.endRow<a.startRow)return;const l=s.endRow-s.startRow+1,u=Math.max(Math.min(a.startRow,s.endRow+1)-s.startRow,0),d={...a};i.startRow>=a.startRow?(d.startRow=Math.max(1,a.startRow-u),d.ySplit=Math.max(1,a.ySplit-u)):(d.startRow=a.startRow+l-u,d.ySplit=a.ySplit+l-u),this._sequenceExecute(r,o,d,n)}_handleMoveColsMutation(t,n){const{sourceRange:s,targetRange:i,unitId:r,subUnitId:o}=t,a=this._getFreeze(r,o);if(!a||a.startColumn<=0||s.startColumn>=a.startColumn&&i.startColumn>=a.startColumn||s.endColumn<a.startColumn&&i.endColumn<a.startColumn)return;const l=s.endColumn-s.startColumn+1,u=Math.max(Math.min(a.startColumn,s.endColumn+1)-s.startColumn,0),d={...a};i.startColumn>=a.startColumn?(d.startColumn=Math.max(1,a.startColumn-u),d.xSplit=Math.max(1,a.xSplit-u)):(d.startColumn=a.startColumn+l-u,d.xSplit=a.xSplit+l-u),this._sequenceExecute(r,o,d,n)}_getFreeze(t,n){const s=this._univerInstanceService.getUnit(t,A.UNIVER_SHEET);if(!s)return null;const i=s.getSheetBySheetId(n);return i?i.getFreeze():null}_sequenceExecute(t,n,s,i){fe([{id:wn.id,params:{...s,unitId:t,subUnitId:n,resetScroll:!1}}],this._commandService,i)}};Hl=OE([qh(0,V(P)),qh(1,U),qh(2,Lt)],Hl);var HE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ks=(e,t)=>(n,s)=>t(n,s,e);let Yr=class extends ae{constructor(e,t,n,s,i,r,o,a,l,u){super(),E(this,"disposableCollection",new Et),E(this,"_triggerPermissionUIEvent$",new Ve),E(this,"triggerPermissionUIEvent$",this._triggerPermissionUIEvent$.asObservable()),this._commandService=e,this._univerInstanceService=t,this._permissionService=n,this._selectionManagerService=s,this._rangeProtectionRuleModel=i,this._worksheetProtectionRuleModel=r,this._localeService=o,this._lexerTreeBuilder=a,this._contextService=l,this._definedNamesService=u,this._initialize()}blockExecuteWithoutPermission(e){throw this._triggerPermissionUIEvent$.next(e),new Q_("have no permission")}_getPermissionCheck(e,t){let n=!0,s="";switch(e){case An.id:JC(t.value)&&t.value.f?(n=this._permissionCheckWithFormula(t),s=this._localeService.t("permission.dialog.formulaErr")):n=this._permissionCheckBySetRangeValue({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[nn,oe]},t);break;case as.id:n=this.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[nn,oe]},t?.ranges,t?.unitId,t?.subUnitId),s=this._localeService.t("permission.dialog.editErr");break;case Qo.id:case jr.id:n=this.permissionCheckWithoutRange({worksheetTypes:[Qn]}),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case Ko.id:case tr.id:case ci.id:n=this.permissionCheckWithoutRange({worksheetTypes:[Kn]}),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case Ki.id:case Qi.id:n=this._permissionCheckByMoveCommand(t),s=this._localeService.t("permission.dialog.moveRowColErr");break;case zi.id:n=this._permissionCheckByMoveRangeCommand(t),s=this._localeService.t("permission.dialog.moveRangeErr");break;case hh.id:n=this._permissionCheckByWorksheetCommand([ne,eh]),s=this._localeService.t("permission.dialog.operatorSheetErr"),n===!1&&this._worksheetProtectionRuleModel.resetOrder();break;case zr.id:n=this._permissionCheckByWorksheetCommand([ne,ka]),s=this._localeService.t("permission.dialog.operatorSheetErr"),n===!1&&this._worksheetProtectionRuleModel.resetOrder();break;case uo.id:{const{unitId:i,subUnitId:r}=t;n=this._permissionCheckByWorksheetCommand([ne,ya],i,r),s=this._localeService.t("permission.dialog.operatorSheetErr"),n===!1&&this._worksheetProtectionRuleModel.resetOrder()}break;case Ji.id:n=this.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,Qn]},t.ranges,t.unitId,t.subUnitId),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case er.id:n=this.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,Kn]},t.ranges,t.unitId,t.subUnitId),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case ah.id:n=this.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,Qn]}),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case uh.id:n=this.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,Kn]}),s=this._localeService.t("permission.dialog.setRowColStyleErr");break;case gi.id:n=this._permissionCheckWithInsertRangeMove("right"),s=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case Fs.id:n=this._permissionCheckWithInsertRangeMove("bottom"),s=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case Bs.id:n=this._permissionCheckWithInsertRangeMove("left"),s=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case js.id:n=this._permissionCheckWithInsertRangeMove("top"),s=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case Er.id:n=this._permissionCheckByAutoFillCommand(t),s=this._localeService.t("permission.dialog.autoFillErr");break}n||this.blockExecuteWithoutPermission(s)}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{this._getPermissionCheck(e.id,e?.params)})),this.disposeWithMe(this._commandService.onCommandExecuted(e=>{var t;if(e.id===Fr.id){const n=e.params,{unitId:s=(t=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:t.getUnitId(),subUnitId:i}=n;if(!s||!i)return;const r=this._worksheetProtectionRuleModel.getRule(s,i),o=this._rangeProtectionRuleModel.getSubunitRuleList(s,i);r&&this._worksheetProtectionRuleModel.ruleRefresh(r.permissionId),o.length&&this._rangeProtectionRuleModel.ruleRefresh(i)}}))}_permissionCheckWithInsertRangeMove(e){var t;const n=Y(this._univerInstanceService);if(!n)return!1;const{worksheet:s,unitId:i,subUnitId:r}=n,o=Q.deepClone((t=this._selectionManagerService.getCurrentLastSelection())==null?void 0:t.range);return!(!o||(e==="top"||e==="bottom"?o.endRow=s.getRowCount()-1:(e==="left"||e==="right")&&(o.endColumn=s.getColumnCount()-1),this._rangeProtectionRuleModel.getSubunitRuleList(i,r).map(a=>a.ranges).flat().some(a=>z.getIntersects(o,a))))}_permissionCheckByWorksheetCommand(e,t,n){var s,i;const r=Y(this._univerInstanceService,{unitId:t,subUnitId:n});if(!r)return!1;const{unitId:o,subUnitId:a}=r,l=this._worksheetProtectionRuleModel.getRule(o,a),u=this._rangeProtectionRuleModel.getSubunitRuleList(o,a).length>0;return l||u?(i=(s=this._permissionService.getPermissionPoint(new xa(o).id))==null?void 0:s.value)!=null?i:!1:this._permissionService.composePermission(e.map(d=>new d(o).id)).every(d=>d.value)}permissionCheckWithoutRange(e){var t,n,s,i;const r=Y(this._univerInstanceService);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r,u=this._selectionManagerService.getCurrentLastSelection();if(!u)return!0;const d=(n=(t=u?.primary)==null?void 0:t.actualRow)!=null?n:0,c=(i=(s=u?.primary)==null?void 0:s.actualColumn)!=null?i:0,{workbookTypes:h,worksheetTypes:g,rangeTypes:m}=e;return!(h&&h.some(p=>{var f,v;const C=new p(a);return((v=(f=this._permissionService.getPermissionPoint(C.id))==null?void 0:f.value)!=null?v:!1)===!1})===!0||g&&g.some(p=>{var f,v;const C=new p(a,l);return((v=(f=this._permissionService.getPermissionPoint(C.id))==null?void 0:f.value)!=null?v:!1)===!1})===!0||m&&m.some(p=>{var f,v,C,w,b;const I=(v=(f=o.getCell(d,c))==null?void 0:f.selectionProtection)==null?void 0:v[0];if(!(I!=null&&I.ruleId))return!1;const _=(C=this._rangeProtectionRuleModel.getRule(a,l,I.ruleId))==null?void 0:C.permissionId;if(!_)return!1;const R=new p(a,l,_);return((b=(w=this._permissionService.getPermissionPoint(R.id))==null?void 0:w.value)!=null?b:!1)===!1})===!0)}permissionCheckWithRanges(e,t,n,s){var i;const r=Y(this._univerInstanceService,{unitId:n,subUnitId:s});if(!r)return!1;const o=t??((i=this._selectionManagerService.getCurrentSelections())==null?void 0:i.map(g=>g.range));if(!o)return!1;const{unitId:a,subUnitId:l}=r,{workbookTypes:u,worksheetTypes:d,rangeTypes:c}=e,h=[];return u&&h.push(...u.map(g=>new g(a).id)),d&&h.push(...d.map(g=>new g(a,l).id)),c&&this._rangeProtectionRuleModel.getSubunitRuleList(a,l).forEach(g=>{o.some(m=>g.ranges.some(p=>z.intersects(p,m)))&&h.push(...c.map(m=>new m(a,l,g.permissionId).id))}),h.length?this._permissionService.composePermission(h).every(g=>g.value):!0}_permissionCheckByMoveCommand(e){const t=Y(this._univerInstanceService,e);if(!t)return!1;const{worksheet:n,unitId:s,subUnitId:i}=t,r=e.toRange;r.endRow===n.getRowCount()-1?r.endColumn=r.startColumn:r.endRow=r.startRow;const o=this._rangeProtectionRuleModel.getSubunitRuleList(s,i).reduce((a,l)=>[...a,...l.ranges],[]).filter(a=>z.intersects(a,r));return o.length>0?!1:(o.forEach(a=>{var l,u;for(let d=a.startRow;d<=a.endRow;d++)for(let c=a.startColumn;c<=a.endColumn;c++){const h=(u=(l=n.getCell(d,c))==null?void 0:l.selectionProtection)==null?void 0:u[0];if(h?.[X.Edit]===!1)return!1}}),!0)}_permissionCheckByMoveRangeCommand(e){const t=Y(this._univerInstanceService);if(!t)return!1;const{worksheet:n,unitId:s,subUnitId:i}=t,r=e.toRange,o=this._rangeProtectionRuleModel.getSubunitRuleList(s,i).reduce((a,l)=>[...a,...l.ranges],[]).filter(a=>z.intersects(a,r));return o.length>0?!1:(o.forEach(a=>{var l,u;for(let d=a.startRow;d<=a.endRow;d++)for(let c=a.startColumn;c<=a.endColumn;c++){const h=(u=(l=n.getCell(d,c))==null?void 0:l.selectionProtection)==null?void 0:u[0];if(h?.[X.Edit]===!1)return!1}}),!0)}_permissionCheckBySetRangeValue(e,t){let n=[];t.range?n=[t.range]:n=[new de(t.value).getDataRange()];const{unitId:s,subUnitId:i}=t;return this.permissionCheckWithRanges(e,n,s,i)}_permissionCheckWithFormula(e){var t,n,s,i,r;const o=e.value,a=e.range,l=o.f;if(l){const u=l.substring(1),d=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),c=(t=e.unitId)!=null?t:d.getUnitId(),h=this._definedNamesService.getValueByName(c,u);if(h){let g=h.formulaOrRefString;g.startsWith(Ir.EQUALS)&&(g=g.slice(1));const m=g.split(",");for(let p=0;p<m.length;p++){const f=m[p],v=hu(f);if(v.sheetName){const C=d.getSheetBySheetName(v.sheetName);if(!C)return!0;const{startRow:w,endRow:b,startColumn:I,endColumn:_}=v.range;for(let R=w;R<=b;R++)for(let M=I;M<=_;M++){const x=(s=(n=C.getCell(R,M))==null?void 0:n.selectionProtection)==null?void 0:s[0];if(x?.[X.View]===!1)return!1}}}return!0}else{const g=this._lexerTreeBuilder.sequenceNodesBuilder(l);if(!g)return!0;for(let m=0;m<g.length;m++){const p=g[m];if(typeof p=="string"||p.nodeType!==nd.REFERENCE)continue;const{token:f}=p,v=C0(f),C=v.unitId?this._univerInstanceService.getUnit(v.unitId):this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!C)return!0;let w=v.sheetName?C.getSheetBySheetName(v.sheetName):C.getActiveSheet();const b=C.getUnitId();if(v.sheetName){if(w=C.getSheetBySheetName(v.sheetName),!w)return!0;const x=w?.getSheetId();if(!this._permissionService.getPermissionPoint(new cr(b,x).id))return!1}if(!w)return!0;const{startRow:I,endRow:_,startColumn:R,endColumn:M}=v.range;for(let x=I;x<=_;x++)for(let N=R;N<=M;N++){const T=(r=(i=w.getCell(x,N))==null?void 0:i.selectionProtection)==null?void 0:r[0];if(T?.[X.View]===!1)return!1}}return!0}}if(a){const u=Y(this._univerInstanceService,e);if(!u)return!1;const{unitId:d,subUnitId:c}=u,h=this._rangeProtectionRuleModel.getSubunitRuleList(d,c).filter(g=>g.ranges.some(m=>z.intersects(m,a))).map(g=>new he(d,c,g.permissionId).id);if(!this._permissionService.composePermission(h).every(g=>g.value))return!1}return!0}_permissionCheckByAutoFillCommand(e){if(!e)return!1;const{targetRange:t}=e,n=Y(this._univerInstanceService,e);if(!n)return!1;const{worksheet:s,unitId:i,subUnitId:r}=n;return!this._rangeProtectionRuleModel.getSubunitRuleList(i,r).reduce((o,a)=>[...o,...a.ranges],[]).filter(o=>z.intersects(o,t)).some(o=>{var a,l;for(let u=o.startRow;u<=o.endRow;u++)for(let d=o.startColumn;d<=o.endColumn;d++){const c=(l=(a=s.getCell(u,d))==null?void 0:a.selectionProtection)==null?void 0:l[0];if(c?.[X.Edit]===!1)return!0}return!1})}};Yr=HE([ks(0,U),ks(1,P),ks(2,Je),ks(3,V(q)),ks(4,V(We)),ks(5,V(ft)),ks(6,V(Oe)),ks(7,V(Zc)),ks(8,Ne),ks(9,wi)],Yr);var DE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Fa=(e,t)=>(n,s)=>t(n,s,e);let Jo=class extends ae{constructor(t,n,s,i,r){super(),E(this,"_unitPermissionInitStateChange",new xe(!1)),E(this,"unitPermissionInitStateChange$",this._unitPermissionInitStateChange.asObservable()),this._permissionService=t,this._univerInstanceService=n,this._rangeProtectionRuleModel=s,this._worksheetProtectionRuleModel=i,this._worksheetProtectionPointModel=r,this._init()}_init(){const t=n=>{const s=n.getUnitId();Al().forEach(i=>{const r=new i(s);this._permissionService.addPermissionPoint(r)})};this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).forEach(n=>{t(n)}),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(A.UNIVER_SHEET).subscribe(n=>{t(n)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(A.UNIVER_SHEET).subscribe(n=>{const s=n.getUnitId();n.getSheets().forEach(i=>{const r=i.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(s,r).forEach(o=>{[...Zn()].forEach(a=>{const l=new a(s,r,o.permissionId);this._permissionService.deletePermissionPoint(l.id)})}),[..._n(),...zn()].forEach(o=>{const a=new o(s,r);this._permissionService.deletePermissionPoint(a.id)})}),Al().forEach(i=>{const r=new i(s);this._permissionService.deletePermissionPoint(r.id)}),this._rangeProtectionRuleModel.deleteUnitModel(s),this._worksheetProtectionPointModel.deleteUnitModel(s),this._worksheetProtectionRuleModel.deleteUnitModel(s)}))}changeUnitInitState(t){this._unitPermissionInitStateChange.next(t)}};Jo=DE([Fa(0,V(Je)),Fa(1,V(P)),Fa(2,V(We)),Fa(3,V(ft)),Fa(4,V(_i))],Jo);var WE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ts=(e,t)=>(n,s)=>t(n,s,e);let Dl=class extends ae{constructor(t,n,s,i,r,o,a,l,u,d){super(),this._univerInstanceService=t,this._permissionService=n,this._authzIoService=s,this._rangeProtectionRuleModel=i,this._worksheetProtectionRuleModel=r,this._userManagerService=o,this._worksheetProtectionPointRuleModel=a,this._workbookPermissionService=l,this._undoRedoService=u,this._commandService=d}initPermission(){this._initRangePermissionFromSnapshot(),this._initRangePermissionChange(),this._initWorksheetPermissionFromSnapshot(),this._initWorksheetPermissionChange(),this._initWorksheetPermissionPointsChange(),this._initWorkbookPermissionFromSnapshot(),this._initUserChange(),this._refreshPermissionByCollaCreate()}refreshRangeProtectPermission(){this._initRangePermissionFromSnapshot()}async _initRangePermissionFromSnapshot(){const t=async n=>{const s=[],i=n.getUnitId(),r=n.getSheets(),o=new Map;if(r.forEach(a=>{const l=a.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(i,l).forEach(u=>{o.set(u.permissionId,u),s.push({objectID:u.permissionId,unitID:i,objectType:se.SelectRange,actions:Vi})})}),!s.length){this._rangeProtectionRuleModel.changeRuleInitState(!0);return}this._authzIoService.batchAllowed(s).then(a=>{a.forEach(l=>{const u=o.get(l.objectID);if(u){if(!this._rangeProtectionRuleModel.getRule(i,u.subUnitId,u.id))return;Zn().forEach(d=>{const c=new d(i,u.subUnitId,l.objectID),h=c.subType,g=l.actions.find(m=>m.action===h);g?.allowed!==void 0&&this._permissionService.updatePermissionPoint(c.id,g.allowed)})}}),this._rangeProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).map(n=>t(n))),this._rangeProtectionRuleModel.changeRuleInitState(!0)}_initRangePermissionChange(){this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe(t=>{t.type!=="delete"?this._authzIoService.allowed({objectID:t.rule.permissionId,unitID:t.unitId,objectType:se.SelectRange,actions:Vi}).then(n=>{this._rangeProtectionRuleModel.getRule(t.unitId,t.subUnitId,t.rule.id)&&(Zn().forEach(s=>{if(t.type==="set"){const{rule:l,oldRule:u}=t;if(l.permissionId===u?.permissionId)return}const i=t.rule,r=new s(i.unitId,i.subUnitId,i.permissionId),o=r.subType,a=n.find(l=>l.action===o);a&&this._permissionService.updatePermissionPoint(r.id,a.allowed)}),this._rangeProtectionRuleModel.ruleRefresh(t.rule.permissionId))}):this._rangeProtectionRuleModel.getSubunitRuleList(t.unitId,t.subUnitId).length===0&&(this._worksheetProtectionPointRuleModel.deleteRule(t.unitId,t.subUnitId),[...zn()].forEach(n=>{const s=new n(t.unitId,t.subUnitId);this._permissionService.updatePermissionPoint(s.id,s.value)}))}))}async initWorkbookPermissionChange(t){var n;const s=t||((n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:n.getUnitId());if(s)return this._authzIoService.allowed({objectID:s,objectType:se.Workbook,unitID:s,actions:mE}).then(i=>{Al().forEach(r=>{const o=new r(s),a=o.subType,l=i.find(u=>u.action===a);l&&this._permissionService.updatePermissionPoint(o.id,l.allowed)})})}async _initWorkbookPermissionFromSnapshot(){await Promise.all(this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).map(t=>this.initWorkbookPermissionChange(t.getUnitId()))),this._workbookPermissionService.changeUnitInitState(!0)}_initWorksheetPermissionChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(t=>{t.type!=="delete"?this._authzIoService.allowed({objectID:t.rule.permissionId,unitID:t.unitId,objectType:se.Worksheet,actions:Vi}).then(n=>{const s=this._worksheetProtectionRuleModel.getRule(t.unitId,t.subUnitId);!s||s.permissionId!==t.rule.permissionId||(_n().forEach(i=>{const r=new i(t.unitId,t.subUnitId),o=r.subType,a=n.find(l=>l.action===o);a&&this._permissionService.updatePermissionPoint(r.id,a.allowed)}),this._worksheetProtectionRuleModel.ruleRefresh(t.rule.permissionId))}):([..._n(),...zn()].forEach(n=>{const s=new n(t.unitId,t.subUnitId);this._permissionService.updatePermissionPoint(s.id,!0)}),this._worksheetProtectionPointRuleModel.deleteRule(t.unitId,t.subUnitId))}))}_initWorksheetPermissionPointsChange(){this.disposeWithMe(this._worksheetProtectionPointRuleModel.pointChange$.subscribe(t=>{this._authzIoService.allowed({objectID:t.permissionId,unitID:t.unitId,objectType:se.Worksheet,actions:Yh}).then(n=>{const s=this._worksheetProtectionPointRuleModel.getRule(t.unitId,t.subUnitId);!s||s.permissionId!==t.permissionId||zn().forEach(i=>{const r=new i(t.unitId,t.subUnitId),o=r.subType,a=n.find(l=>l.action===o);a&&this._permissionService.updatePermissionPoint(r.id,a.allowed)})})}))}async _initWorksheetPermissionFromSnapshot(){const t=async n=>{const s=[],i=n.getUnitId(),r=n.getSheets(),o=new Map;if(r.forEach(a=>{const l=a.getSheetId(),u=this._worksheetProtectionRuleModel.getRule(i,l);u&&(o.set(u.permissionId,u),s.push({objectID:u.permissionId,unitID:i,objectType:se.Worksheet,actions:Vi}));const d=this._worksheetProtectionPointRuleModel.getRule(i,l);d&&(o.set(d.permissionId,d),s.push({objectID:d.permissionId,unitID:i,objectType:se.Worksheet,actions:Yh}))}),!s.length){this._worksheetProtectionRuleModel.changeRuleInitState(!0);return}this._authzIoService.batchAllowed(s).then(a=>{a.forEach(l=>{const u=o.get(l.objectID);if(u){const d=this._worksheetProtectionRuleModel.getRule(i,u.subUnitId)||this._worksheetProtectionPointRuleModel.getRule(i,u.subUnitId);if(!d||d.permissionId!==l.objectID)return;[..._n(),...zn()].forEach(c=>{const h=new c(i,u.subUnitId),g=h.subType,m=l.actions.find(p=>p.action===g);m?.allowed!==void 0&&this._permissionService.updatePermissionPoint(h.id,m.allowed)})}}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).map(n=>t(n))),this._worksheetProtectionRuleModel.changeRuleInitState(!0)}_initUserChange(){this.disposeWithMe(this._userManagerService.currentUser$.pipe(ew(1)).subscribe(()=>{const t=this._permissionService.getAllPermissionPoint();this._permissionService.clearPermissionMap(),this._worksheetProtectionRuleModel.changeRuleInitState(!1),this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).forEach(n=>{const s=n.getUnitId();Al().forEach(i=>{let r=new i(s);t.has(r.id)&&(r=t.get(r.id)),this._permissionService.addPermissionPoint(r)}),n.getSheets().forEach(i=>{const r=i.getSheetId();[..._n(),...zn()].forEach(o=>{let a=new o(s,r);t.has(a.id)&&(a=t.get(a.id)),this._permissionService.addPermissionPoint(a)}),this._rangeProtectionRuleModel.getSubunitRuleList(s,r).forEach(o=>{Zn().forEach(a=>{let l=new a(s,r,o.permissionId);t.has(l.id)&&(l=t.get(l.id)),this._permissionService.addPermissionPoint(l)})})}),this._initWorkbookPermissionFromSnapshot(),this._initWorksheetPermissionFromSnapshot(),this._initRangePermissionFromSnapshot()})}))}refreshPermission(t,n){const s=this._worksheetProtectionRuleModel.getTargetByPermissionId(t,n);let i=!1;if(s){const[a,l]=s;this._authzIoService.allowed({objectID:n,unitID:t,objectType:se.Worksheet,actions:Vi}).then(u=>{if(!this._worksheetProtectionRuleModel.getTargetByPermissionId(t,n))return;let d="";_n().forEach(c=>{var h;const g=new c(t,l),m=g.subType,p=u.find(f=>f.action===m);p&&(((h=this._permissionService.getPermissionPoint(g.id))==null?void 0:h.value)!==p.allowed&&(i=!0),this._permissionService.updatePermissionPoint(g.id,p.allowed),d+=`${p.action}_${p.allowed}`)}),this._worksheetProtectionRuleModel.ruleRefresh(`${n}_${d}`),i&&this._undoRedoService.clearUndoRedo(t)})}const r=this._worksheetProtectionPointRuleModel.getTargetByPermissionId(t,n);if(r){const[a,l]=r;this._authzIoService.allowed({objectID:n,unitID:t,objectType:se.Worksheet,actions:Yh}).then(u=>{this._worksheetProtectionPointRuleModel.getTargetByPermissionId(t,n)&&(zn().forEach(d=>{var c;const h=new d(t,l),g=h.subType,m=u.find(p=>p.action===g);m&&(((c=this._permissionService.getPermissionPoint(h.id))==null?void 0:c.value)!==m.allowed&&(i=!0),this._permissionService.updatePermissionPoint(h.id,m.allowed))}),i&&this._undoRedoService.clearUndoRedo(t))})}const o=this._rangeProtectionRuleModel.getTargetByPermissionId(t,n);if(o){const[a,l]=o;this._authzIoService.allowed({objectID:n,unitID:t,objectType:se.SelectRange,actions:Vi}).then(u=>{if(!this._rangeProtectionRuleModel.getTargetByPermissionId(t,n))return;let d="";Zn().forEach(c=>{var h;const g=new c(t,l,n),m=g.subType,p=u.find(f=>f.action===m);p&&(((h=this._permissionService.getPermissionPoint(g.id))==null?void 0:h.value)!==p.allowed&&(i=!0),this._permissionService.updatePermissionPoint(g.id,p.allowed),d+=`${p.action}_${p.allowed}`)}),this._rangeProtectionRuleModel.ruleRefresh(`${n}_${d}`),i&&this._undoRedoService.clearUndoRedo(t)})}}_refreshPermissionByCollaCreate(){this.disposeWithMe(this._commandService.onCommandExecuted((t,n)=>{if(n!=null&&n.fromCollab&&(t.id===Hn.id||t.id===$i.id||t.id===gh.id)){const s=t.params;this._undoRedoService.clearUndoRedo(s.unitId)}}))}};Dl=WE([Ts(0,P),Ts(1,Je),Ts(2,Ys),Ts(3,V(We)),Ts(4,V(ft)),Ts(5,V(Bn)),Ts(6,V(_i)),Ts(7,V(Jo)),Ts(8,V(ce)),Ts(9,V(U))],Dl);var LE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Qh=(e,t)=>(n,s)=>t(n,s,e);let jd=class extends ae{constructor(t,n,s){super(),E(this,"_zebraCacheUpdateSubject",new Ve),this._commandService=t,this._sheetRangeThemeModel=n,this._univerInstanceService=s,this._init()}_init(){this._initializeCommandListener(),this._initTriggerCacheUpdateListener()}updateZebraCrossingCache(t,n){this._zebraCacheUpdateSubject.next({unitId:t,subUnitId:n})}_initializeCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{const{id:n}=t;let s,i;switch(n){case rn.id:{const r=t.params;s=r.unitId,i=r.subUnitId}break;case Xi.id:{const r=t.params;s=r.unitId,i=r.subUnitId}break;case Yi.id:{const r=t.params;s=r.unitId,i=r.subUnitId}break;case an.id:{const r=t.params;s=r.unitId,i=r.subUnitId}break;case os.id:{const r=t.params;s=r.unitId,i=r.subUnitId}break}s&&i&&(this._sheetRangeThemeModel.refreshSheetRowVisibleFuncSet(s,i),this._sheetRangeThemeModel.refreshZebraCrossingCacheBySheet(s,i))}))}_initTriggerCacheUpdateListener(){this.disposeWithMe(this._zebraCacheUpdateSubject.subscribe(({unitId:t,subUnitId:n})=>{this._sheetRangeThemeModel.refreshSheetRowVisibleFuncSet(t,n),this._sheetRangeThemeModel.refreshZebraCrossingCacheBySheet(t,n)}))}};jd=LE([Qh(0,V(U)),Qh(1,V(Dn)),Qh(2,V(P))],jd);var BE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Rv=(e,t)=>(n,s)=>t(n,s,e);let Wl=class{constructor(t,n){E(this,"_cache",new $C(1e4)),this._selectionProtectionRuleModel=t,this._permissionService=n,this._init()}_init(){this._permissionService.permissionPointUpdate$.pipe(Wt(t=>t.type===se.SelectRange),Wt(t=>Zn().some(n=>t instanceof n)),Se(t=>t)).subscribe(t=>{const n=this._selectionProtectionRuleModel.getSubunitRuleList(t.unitId,t.subUnitId);for(const s of n)s.permissionId===t.permissionId&&s.ranges.forEach(i=>{De.foreach(i,(r,o)=>{const a=this._createKey(t.unitId,t.subUnitId,r,o);this._cache.delete(a)})})}),this._selectionProtectionRuleModel.ruleChange$.subscribe(t=>{var n;t.rule.ranges.forEach(s=>{De.foreach(s,(i,r)=>{const o=this._createKey(t.unitId,t.subUnitId,i,r);this._cache.delete(o)})}),t.type==="set"&&((n=t.oldRule)==null||n.ranges.forEach(s=>{De.foreach(s,(i,r)=>{const o=this._createKey(t.unitId,t.subUnitId,i,r);this._cache.delete(o)})}))})}_createKey(t,n,s,i){return`${t}_${n}_${s}_${i}`}getCellInfo(t,n,s,i){const r=this._selectionProtectionRuleModel.getSubunitRuleList(t,n),o=[];if(!r||!r.length)return o;const a=this._createKey(t,n,s,i),l=this._cache.get(a);if(l)return l;const u=[];for(const d of r)if(d.ranges.some(c=>c.startRow<=s&&c.endRow>=s&&c.startColumn<=i&&c.endColumn>=i)){const c=Zn().reduce((h,g)=>{var m;const p=new g(t,n,d.permissionId),f=this._permissionService.getPermissionPoint(p.id);return h[p.subType]=(m=f?.value)!=null?m:p.value,h},{});u.push({...c,ruleId:d.id,ranges:d.ranges})}return this._cache.set(a,u),u}clear(){this._cache.clear()}};Wl=BE([Rv(0,V(We)),Rv(1,V(Je))],Wl);var jE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Kh=(e,t)=>(n,s)=>t(n,s,e);let Is=class extends ae{constructor(e,t,n){super(),E(this,"_cellRuleCache",new Map),E(this,"_permissionIdCache",new Map),E(this,"_cellInfoCache",new Map),E(this,"_rowInfoCache",new Map),E(this,"_colInfoCache",new Map),this._ruleModel=e,this._permissionService=t,this._univerInstanceService=n,this._initUpdateCellRuleCache(),this._initUpdateCellInfoCache(),this._initUpdateRowColInfoCache(),this._initCache()}_initCache(){this._univerInstanceService.getAllUnitsForType(A.UNIVER_SHEET).forEach(e=>{e.getSheets().forEach(t=>{const n=e.getUnitId(),s=t.getSheetId();this.reBuildCache(n,s)})})}_initUpdateCellInfoCache(){this._permissionService.permissionPointUpdate$.pipe(Wt(e=>e.type===se.SelectRange),Se(e=>e)).subscribe(e=>{const{subUnitId:t,unitId:n,permissionId:s}=e,i=this._permissionIdCache.get(s);if(!i)return;const r=this._ruleModel.getRule(n,t,i);if(!r)return;const o=this._ensureCellInfoMap(n,t);r.ranges.forEach(a=>{const{startRow:l,endRow:u,startColumn:d,endColumn:c}=a;for(let h=l;h<=u;h++)for(let g=d;g<=c;g++)o.delete(`${h}-${g}`)})}),this._ruleModel.ruleChange$.subscribe(e=>{var t;const{unitId:n,subUnitId:s}=e,i=this._ensureCellInfoMap(n,s);e.rule.ranges.forEach(r=>{De.foreach(r,(o,a)=>{i.delete(`${o}-${a}`)})}),e.type==="set"&&((t=e.oldRule)==null||t.ranges.forEach(r=>{De.foreach(r,(o,a)=>{this._cellInfoCache.delete(`${o}-${a}`)})}))})}_initUpdateCellRuleCache(){this._ruleModel.ruleChange$.subscribe(e=>{const{type:t}=e;t==="add"?this._addCellRuleCache(e):t==="delete"?this._deleteCellRuleCache(e):(this._deleteCellRuleCache({...e,rule:e.oldRule}),this._addCellRuleCache(e))})}_ensureRuleMap(e,t){let n=this._cellRuleCache.get(e);n||(n=new Map,this._cellRuleCache.set(e,n));let s=n.get(t);return s||(s=new Map,n.set(t,s)),s}_ensureCellInfoMap(e,t){let n=this._cellInfoCache.get(e);n||(n=new Map,this._cellInfoCache.set(e,n));let s=n.get(t);return s||(s=new Map,n.set(t,s)),s}_ensureRowColInfoMap(e,t,n){let s=n==="row"?this._rowInfoCache.get(e):this._colInfoCache.get(e);s||(s=new Map,n==="row"?this._rowInfoCache.set(e,s):this._colInfoCache.set(e,s));let i=s.get(t);return i||(i=new Map,s.set(t,i)),i}_addCellRuleCache(e){const{subUnitId:t,unitId:n,rule:s}=e,i=this._ensureRuleMap(n,t);s.ranges.forEach(r=>{const{startRow:o,endRow:a,startColumn:l,endColumn:u}=r;for(let d=o;d<=a;d++)for(let c=l;c<=u;c++)i.set(`${d}-${c}`,s.id)}),this._permissionIdCache.set(s.permissionId,s.id)}_deleteCellRuleCache(e){const{subUnitId:t,unitId:n,rule:s}=e,i=this._ensureRuleMap(n,t),r=this._ensureCellInfoMap(n,t);s.ranges.forEach(o=>{const{startRow:a,endRow:l,startColumn:u,endColumn:d}=o;for(let c=a;c<=l;c++)for(let h=u;h<=d;h++)i.delete(`${c}-${h}`),r.delete(`${c}-${h}`)}),this._permissionIdCache.delete(s.permissionId)}_getSelectionActions(e,t,n){var s,i,r,o,a,l,u,d,c,h,g,m;const p=(r=(i=this._permissionService.getPermissionPoint((s=new he(e,t,n.permissionId))==null?void 0:s.id))==null?void 0:i.value)!=null?r:!1,f=(l=(a=this._permissionService.getPermissionPoint((o=new Gi(e,t,n.permissionId))==null?void 0:o.id))==null?void 0:a.value)!=null?l:!1,v=(c=(d=this._permissionService.getPermissionPoint((u=new Jp(e,t,n.permissionId))==null?void 0:u.id))==null?void 0:d.value)!=null?c:!1,C=(m=(g=this._permissionService.getPermissionPoint((h=new $p(e,t,n.permissionId))==null?void 0:h.id))==null?void 0:g.value)!=null?m:!1;return{[X.Edit]:p,[X.View]:f,[X.ManageCollaborator]:v,[X.Delete]:C}}reBuildCache(e,t){const n=this._ensureRuleMap(e,t),s=this._ensureCellInfoMap(e,t);n.clear(),s.clear();const i=this._ensureRowColInfoMap(e,t,"row"),r=this._ensureRowColInfoMap(e,t,"col");i.clear(),r.clear(),this._ruleModel.getSubunitRuleList(e,t).forEach(o=>{const a=this._getSelectionActions(e,t,o),l={...a,ruleId:o.id,ranges:o.ranges};o.ranges.forEach(u=>{const{startRow:d,endRow:c,startColumn:h,endColumn:g}=u;for(let m=d;m<=c;m++){const p=i.get(`${m}`);p?p.set(o.id,a):i.set(`${m}`,new Map([[o.id,a]]));for(let f=h;f<=g;f++){n.set(`${m}-${f}`,o.id),s.set(`${m}-${f}`,l);const v=r.get(`${f}`);v?v.set(o.id,a):r.set(`${f}`,new Map([[o.id,a]]))}}}),this._permissionIdCache.set(o.permissionId,o.id)})}getRowPermissionInfo(e,t,n,s){var i;const r=(i=this._rowInfoCache.get(e))==null?void 0:i.get(t);if(!r)return!0;const o=r.get(`${n}`);return o?s.every(a=>{for(const l of o.values())if(l[a]===!1)return!1;return!0}):!0}getColPermissionInfo(e,t,n,s){var i;const r=(i=this._colInfoCache.get(e))==null?void 0:i.get(t);if(!r)return!0;const o=r.get(`${n}`);return o?s.every(a=>{for(const l of o.values())if(l[a]===!1)return!1;return!0}):!0}_initUpdateRowColInfoCache(){this._permissionService.permissionPointUpdate$.pipe(Wt(e=>e.type===se.SelectRange),Se(e=>e)).subscribe({next:e=>{const{subUnitId:t,unitId:n,permissionId:s}=e,i=this._permissionIdCache.get(s);if(!i)return;const r=this._ruleModel.getRule(n,t,i);if(!r)return;const o=this._ensureRowColInfoMap(n,t,"row"),a=this._ensureRowColInfoMap(n,t,"col"),l=this._getSelectionActions(n,t,r);r.ranges.forEach(u=>{const{startRow:d,endRow:c,startColumn:h,endColumn:g}=u;for(let m=d;m<=c;m++){const p=o.get(`${m}`);p?p.set(i,l):o.set(`${m}`,new Map([[i,l]]));for(let f=h;f<=g;f++){const v=a.get(`${f}`);v?v.set(i,l):a.set(`${f}`,new Map([[i,l]]))}}})}}),this._ruleModel.ruleChange$.subscribe(e=>{if(e.type==="delete"){const{unitId:t,subUnitId:n,rule:s}=e,i=this._ensureRowColInfoMap(t,n,"row"),r=this._ensureRowColInfoMap(t,n,"col");s.ranges.forEach(o=>{const{startRow:a,endRow:l,startColumn:u,endColumn:d}=o;for(let c=a;c<=l;c++){const h=i.get(`${c}`);h?.delete(s.id);for(let g=u;g<=d;g++){const m=r.get(`${g}`);m?.delete(s.id)}}})}})}getCellInfo(e,t,n,s){var i,r;const o=this._ensureCellInfoMap(e,t),a=o.get(`${n}-${s}`);if(a)return a;const l=(r=(i=this._cellRuleCache.get(e))==null?void 0:i.get(t))==null?void 0:r.get(`${n}-${s}`);if(!l)return;const u=this._ruleModel.getRule(e,t,l);if(u){const d={...this._getSelectionActions(e,t,u),ruleId:l,ranges:u.ranges};return o.set(`${n}-${s}`,d),d}}deleteUnit(e){this._cellRuleCache.delete(e),this._cellInfoCache.delete(e),this._rowInfoCache.delete(e),this._colInfoCache.delete(e);const t=this._univerInstanceService.getUnit(e);t?.getSheets().forEach(n=>{const s=n.getSheetId();this._ruleModel.getSubunitRuleList(e,s).forEach(i=>{this._permissionIdCache.delete(i.permissionId)})})}};Is=jE([Kh(0,V(We)),Kh(1,V(Je)),Kh(2,V(P))],Is);var FE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},yv=(e,t)=>(n,s)=>t(n,s,e);let Fd=class extends ae{constructor(t,n){super(),E(this,"_previousSheetIndex",-1),this._commandService=t,this._univerInstanceService=n,this.disposeWithMe(this._commandService.beforeCommandExecuted(s=>{if(s.id===En.id)return this._beforeAdjustActiveSheetOnRemoveSheet(s)})),this.disposeWithMe(this._commandService.onCommandExecuted((s,i)=>{if(s.id===En.id)return this._adjustActiveSheetOnRemoveSheet(s);if(s.id===cn.id&&s.params.hidden)return this._adjustActiveSheetOnHideSheet(s);if(i!=null&&i.fromCollab)return!1;if(s.id===cs.id)return this._adjustActiveSheetOnInsertSheet(s);if(s.id===cn.id&&!s.params.hidden)return this._adjustActiveSheetOnShowSheet(s);if(s.id===me.id)return this._adjustActiveSheetOnSelection(s)}))}_adjustActiveSheetOnHideSheet(t){var n;const{unitId:s,subUnitId:i}=t.params,r=this._univerInstanceService.getUniverSheetInstance(s);if(!r||((n=r.getActiveSheet())==null?void 0:n.getSheetId())!==i)return;const o=r.getActiveSheetIndex(),a=Mv(r,o);this._switchToNextSheet(s,a)}_beforeAdjustActiveSheetOnRemoveSheet(t){const{unitId:n,subUnitId:s}=t.params,i=this._univerInstanceService.getUniverSheetInstance(n);if(!i)return;const r=i.getSheetBySheetId(s);r&&(this._previousSheetIndex=i.getSheetIndex(r))}_adjustActiveSheetOnRemoveSheet(t){if(this._previousSheetIndex===-1)return;const{unitId:n}=t.params,s=this._univerInstanceService.getUniverSheetInstance(n);if(s&&s.getActiveSheet().getSheetId()===t.params.subUnitId){const i=this._previousSheetIndex,r=i>=1?i-1:0,o=Mv(s,r);this._switchToNextSheet(n,o)}}_adjustActiveSheetOnInsertSheet(t){const{unitId:n,sheet:s}=t.params;this._switchToNextSheet(n,s.id)}_adjustActiveSheetOnShowSheet(t){const{unitId:n,subUnitId:s}=t.params;this._switchToNextSheet(n,s)}_adjustActiveSheetOnSelection(t){var n;const{unitId:s,subUnitId:i}=t.params;i!==((n=this._univerInstanceService.getUnit(s))==null?void 0:n.getActiveSheet().getSheetId())&&this._switchToNextSheet(s,i)}_switchToNextSheet(t,n){this._commandService.executeCommand(lt.id,{unitId:t,subUnitId:n})}};Fd=FE([yv(0,U),yv(1,P)],Fd);function Mv(e,t){const n=e.getSheetSize();for(let s=t;s>-1;s--){const i=e.getSheetByIndex(s);if(!i.getConfig().hidden)return i.getSheetId()}for(let s=t;s<n;s++){const i=e.getSheetByIndex(s);if(!i.getConfig().hidden)return i.getSheetId()}throw new Error("[ActiveWorksheetController]: could not find the next unhidden sheet! Collaboration error perhaps.")}const XS="ONLY_REGISTER_FORMULA_RELATED_MUTATIONS_KEY";var zE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},$h=(e,t)=>(n,s)=>t(n,s,e);let zd=class extends ae{constructor(e,t,n){var s;super(),this._commandService=e,this._configService=t,this._dataSyncPrimaryController=n,[le,on,rn,cs,Mn,Wn,Ln,$t,an,En,et,tf,qe,VS,Fr,ef,yd,_E,Yi,Xi,sf,rf,MS].forEach(i=>{var r;this._commandService.registerCommand(i),(r=this._dataSyncPrimaryController)==null||r.registerSyncingMutations(i)}),(s=this._configService.getConfig(XS))!=null&&s||[bi,Op,Ap,Vp,pS,Os,as,Vs,rh,Bs,js,Qo,Ko,uy,xp,kp,Tp,Td,_s,Fs,gi,ly,yp,Ep,Mp,kd,bs,Go,Ki,zi,Qi,Pp,Pa,Up,Ta,Wr,tm,vu,Xp,vS,El,Ol,iE,_u,nE,sE,Lr,Ur,Nr,jr,rm,ol,gl,wn,No,kl,om,An,tr,Br,am,ll,ah,uh,Ji,er,Tt,dh,kr,zp,Tl,Dr,xl,Kp,Iu,lt,ch,cn,zr,hh,di,ds,os,ci,qn,Cn,LS,dl,HS,ul,iy,me,mh,PS,oh,qo,uo,$o,Uo,Wd,al,nf,WS,$i,Oo,Hr,gh,zw,OS,kS,Dp,Ul,CE,Hn,$n,Kt,jS,Po,cE,BS,yl,Rl,qp,Nl,FS,US,mS,TS,bE,RE,IE,Er,Vd,Gp].forEach(i=>this.disposeWithMe(this._commandService.registerCommand(i))),this._configService.setConfig(zS,PE)}};zd=zE([$h(0,U),$h(1,Lt),$h(2,Wc(I0))],zd);var XE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ev=(e,t)=>(n,s)=>t(n,s,e);let Xd=class extends ae{constructor(t,n){super(),this._univerInstanceService=t,this._commandService=n,this._initialize()}_initialize(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id!==S0.id)return;const n=t.params,{unitData:s}=n,i=Object.keys(s),r=[];for(let o=0;o<i.length;o++){const a=i[o],l=s[a];if(l==null)continue;const u=Object.keys(l);for(let d=0;d<u.length;d++){const c=u[d],h=l[c];if(h==null)continue;const g=this._getMergedCellData(a,c,h),m={subUnitId:c,unitId:a,cellValue:g};r.push({id:le.id,params:m})}}return fe(r,this._commandService,{onlyLocal:!0,fromFormula:!0,applyFormulaCalculationResult:!0})}))}_getMergedCellData(t,n,s){const i=this._univerInstanceService.getUniverSheetInstance(t),r=i?.getStyles(),o=i?.getSheetBySheetId(n),a=o?.getCellMatrix(),l=new de(s);return l.forValue((u,d,c)=>{const h=a?.getValue(u,d),g=b0(h,c,r);l.setValue(u,d,g)}),l.getMatrix()}};Xd=XE([Ev(0,V(P)),Ev(1,U)],Xd);var YE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ZE=(e,t)=>(n,s)=>t(n,s,e);let Yd=class extends ae{constructor(e){super(),this._sheetInterceptorService=e,this._initialize()}_initialize(){this._initInterceptorCellContent()}_initInterceptorCellContent(){this.disposeWithMe(this._sheetInterceptorService.intercept(ri.CELL_CONTENT,{priority:11,effect:Yt.Value|Yt.Style,handler:(e,t,n)=>{var s;if(!e)return n(e);const i=t.workbook.getStyles().getStyleByCell(e);return iI((s=i?.n)==null?void 0:s.pattern)&&e?.t===je.NUMBER&&e.v!==void 0&&e.v!==null&&rr(e.v)&&((!e||e===t.rawData)&&(e={...t.rawData}),e.v=w0(Number(e.v))),n(e)}}))}};Yd=YE([ZE(0,V(_e))],Yd);var GE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Bu=(e,t)=>(n,s)=>t(n,s,e);let Zd=class extends ae{constructor(e,t,n,s){super(),this._permissionService=e,this._worksheetProtectionRuleModel=t,this._sheetInterceptorService=n,this._rangeProtectionCache=s,this._initViewModelByRangeInterceptor(),this._initViewModelBySheetInterceptor()}_initViewModelByRangeInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(ri.CELL_CONTENT,{priority:999,effect:Yt.Value|Yt.Style,handler:(e,t,n)=>{const{unitId:s,subUnitId:i,row:r,col:o}=t,a=this._rangeProtectionCache.getCellInfo(s,i,r,o);if(a){const l=a[X.View]===!1,u=!e||e===t.rawData?{...t.rawData}:e;return u.selectionProtection=[a],l?(delete u.s,delete u.v,delete u.p,u):n(u)}return n(e)}}))}_initViewModelBySheetInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(ri.CELL_CONTENT,{priority:999,effect:Yt.Value|Yt.Style,handler:(e,t,n)=>{var s,i,r,o,a;const{unitId:l,subUnitId:u}=t,d=this._worksheetProtectionRuleModel.getRule(l,u);if(d!=null&&d.permissionId){const c=[{[X.View]:(i=(s=this._permissionService.getPermissionPoint(new cr(l,u).id))==null?void 0:s.value)!=null?i:!1,[X.Edit]:(o=(r=this._permissionService.getPermissionPoint(new oe(l,u).id))==null?void 0:r.value)!=null?o:!1}],h=!((a=c[0])!=null&&a[X.View]),g=!e||e===t.rawData?{...e}:e;return g.hasWorksheetRule=!0,g.selectionProtection=c,h?(delete g.s,delete g.v,delete g.p,g):n(g)}return n(e)}}))}};Zd=GE([Bu(0,Je),Bu(1,V(ft)),Bu(2,V(_e)),Bu(3,V(Is))],Zd);const um=bn("univer.exclusive-range-service");class qE extends ae{constructor(){super(...arguments),E(this,"_exclusiveRanges",new Map),E(this,"_exclusiveRangesChange$",new Ve),E(this,"exclusiveRangesChange$",this._exclusiveRangesChange$.asObservable())}_ensureUnitMap(t){return this._exclusiveRanges.has(t)||this._exclusiveRanges.set(t,new Map),this._exclusiveRanges.get(t)}_ensureSubunitMap(t,n){const s=this._ensureUnitMap(t);return s.has(n)||s.set(n,new Map),s.get(n)}_ensureFeature(t,n,s){const i=this._ensureSubunitMap(t,n);return i.has(s)||i.set(s,[]),i.get(s)}addExclusiveRange(t,n,s,i){const r=this._ensureFeature(t,n,s);r.push(...i),this._exclusiveRangesChange$.next({unitId:t,subUnitId:n,ranges:r.map(o=>o.range)})}getExclusiveRanges(t,n,s){var i,r;return(r=(i=this._exclusiveRanges.get(t))==null?void 0:i.get(n))==null?void 0:r.get(s)}clearExclusiveRanges(t,n,s){const i=this.getExclusiveRanges(t,n,s);this._exclusiveRangesChange$.next({unitId:t,subUnitId:n,ranges:i?.map(r=>r.range)||[]}),this._ensureFeature(t,n,s),this._exclusiveRanges.get(t).get(n).set(s,[])}clearExclusiveRangesByGroupId(t,n,s,i){const r=this.getExclusiveRanges(t,n,s);this._exclusiveRangesChange$.next({unitId:t,subUnitId:n,ranges:r?.map(a=>a.range)||[]});const o=this.getExclusiveRanges(t,n,s);if(o){const a=o.filter(l=>l.groupId!==i);this._exclusiveRanges.get(t).get(n).set(s,a)}}getInterestGroupId(t){const n=[];return t.forEach(s=>{var i;const r=s.range,{unitId:o,sheetId:a}=r;if(!o||!a)return;const l=(i=this._exclusiveRanges.get(o))==null?void 0:i.get(a);if(l)for(const u of l.keys()){const d=l.get(u);if(d){for(const c of d)if(z.intersects(r,c.range)){n.push(u);break}}}}),n}}var QE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Jh=(e,t)=>(n,s)=>t(n,s,e);let dm=class extends ae{constructor(t,n,s){super(),this._resourceManagerService=t,this._univerInstanceService=n,this._logService=s}getValue(t,n,s,i){const r=this._univerInstanceService.getUniverSheetInstance(t);if(!r)return;const o=r?.getSheetBySheetId(n);if(!o)return;const a=r.getStyles(),l=o.getCellRaw(s,i);if(l!=null&&l.s){const u=a.get(l.s);if(u!=null&&u.n)return u.n}return null}deleteValues(t,n,s){const i=this._univerInstanceService.getUniverSheetInstance(t);if(!i)return;const r=i?.getSheetBySheetId(n);if(!r)return;const o=i.getStyles();s.forEach(a=>{De.foreach(a,(l,u)=>{const d=r.getCellRaw(l,u);if(!d)return;const c=d?.s,h={...c&&o.get(c)||{}};delete h.n;const g=o.setValue(h);d.s=g})})}setValues(t,n,s){const i=this._univerInstanceService.getUniverSheetInstance(t);if(!i)return;const r=i?.getSheetBySheetId(n);if(!r)return;const o=i.getStyles(),a=r.getCellMatrix();s.forEach(l=>{l.ranges.forEach(u=>{De.foreach(u,(d,c)=>{const h=r.getCellRaw(d,c);if(h){const g={...o.getStyleByCell(h)||{},n:{pattern:l.pattern}},m=o.setValue(g);h.s=m}else{const g={n:{pattern:l.pattern}},m=o.setValue(g);m&&a.setValue(d,c,{s:m})}})})})}};dm=QE([Jh(0,lu),Jh(1,P),Jh(2,ar)],dm);var KE=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ki=(e,t)=>(n,s)=>t(n,s,e);const xv=[on.id,rn.id,$t.id,an.id],kv=[Wn.id,Ln.id];let Gd=class extends ae{constructor(t,n,s,i,r,o,a,l){super(),E(this,"disposableCollection",new Et),this._selectionProtectionRuleModel=t,this._univerInstanceService=n,this._commandService=s,this._refRangeService=i,this._selectionProtectionRenderModel=r,this._rangeProtectionCache=o,this._sheetInterceptorService=a,this._rangeProtectionRuleModel=l,this._onRefRangeChange(),this._correctPermissionRange(),this._initReBuildCache(),this._initRemoveSheet()}_onRefRangeChange(){const t=(s,i)=>{const r=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!r||!r?.getSheetBySheetId(i))return;this.disposableCollection.dispose();const o=a=>this.refRangeHandle(a,s,i);this._selectionProtectionRuleModel.getSubunitRuleList(s,i).reduce((a,l)=>[...a,...l.ranges],[]).forEach(a=>{this.disposableCollection.add(this._refRangeService.registerRefRange(a,o,s,i))})};this.disposeWithMe(this._commandService.onCommandExecuted(s=>{if(s.id===Iu.id){const i=s.params,r=i.subUnitId,o=i.unitId;if(!r||!o)return;t(o,r)}if(s.id===Kt.id||s.id===Hn.id){const i=s.params,r=i.subUnitId,o=i.unitId;if(!r||!o)return;t(o,r)}}));const n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(n){const s=n.getActiveSheet();if(!s)return;t(n.getUnitId(),s.getSheetId())}}refRangeHandle(t,n,s){switch(t.id){case Qi.id:return this._getRefRangeMutationsByMoveRows(t.params,n,s);case Ki.id:return this._getRefRangeMutationsByMoveCols(t.params,n,s);case bs.id:return this._getRefRangeMutationsByInsertRows(t.params,n,s);case _s.id:return this._getRefRangeMutationsByInsertCols(t.params,n,s);case Pa.id:return this._getRefRangeMutationsByDeleteCols(t.params,n,s);case Ta.id:return this._getRefRangeMutationsByDeleteRows(t.params,n,s)}return{redos:[],undos:[]}}_getRefRangeMutationsByDeleteCols(t,n,s){const i=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(o=>o.ranges.some(a=>z.intersects(a,t.range))),r=t.range;if(i.length){const o=[],a=[];return i.forEach(l=>{const u=Q.deepClone(l),d=u.ranges.reduce((c,h)=>{if(z.intersects(h,r)){const g=Q.deepClone(h),{startColumn:m,endColumn:p}=r;if(m<=g.startColumn&&p>=g.endColumn)return c;m>=g.startColumn&&p<=g.endColumn?g.endColumn-=p-m+1:m<g.startColumn?(g.startColumn=m,g.endColumn-=p-m+1):p>g.endColumn&&(g.endColumn=m-1),this._checkIsRightRange(g)&&c.push(g)}return c},[]);u.ranges=d,u.ranges.length?(o.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:u,ruleId:l.id}}),a.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:l,ruleId:l.id}})):(o.push({id:$n.id,params:{unitId:n,subUnitId:s,ruleIds:[l.id]}}),a.push({id:Hn.id,params:{unitId:n,subUnitId:s,name:"",rules:[l]}}))}),{redos:o,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByDeleteRows(t,n,s){const i=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(o=>o.ranges.some(a=>z.intersects(a,t.range))),r=t.range;if(i.length){const o=[],a=[];return i.forEach(l=>{const u=Q.deepClone(l),d=u.ranges.reduce((c,h)=>{if(z.intersects(h,r)){const g=Q.deepClone(h),{startRow:m,endRow:p}=r;if(m<=g.startRow&&p>=g.endRow)return c;m>=g.startRow&&p<=g.endRow?g.endRow-=p-m+1:m<g.startRow?(g.startRow=m,g.endRow-=p-m+1):p>g.endRow&&(g.endRow=m-1),this._checkIsRightRange(g)&&c.push(g)}return c},[]);u.ranges=d,o.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:u,ruleId:l.id}}),a.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:l,ruleId:l.id}})}),{redos:o,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertCols(t,n,s){const i=t.range.startColumn,r=t.range.endColumn-t.range.startColumn+1,o=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(a=>a.ranges.some(l=>i>l.startColumn&&i<=l.endColumn));if(o.length){const a=[],l=[];return o.forEach(u=>{const d=Q.deepClone(u);let c=!1;d.ranges.forEach(h=>{i>h.startColumn&&i<=h.endColumn&&(h.endColumn+=r,c=!0)}),c&&(a.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:d,ruleId:u.id}}),l.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:u,ruleId:u.id}}))}),{redos:a,undos:l}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertRows(t,n,s){const i=t.range.startRow,r=t.range.endRow-t.range.startRow+1,o=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(a=>a.ranges.some(l=>i>l.startRow&&i<=l.endRow));if(o.length){const a=[],l=[];return o.forEach(u=>{const d=Q.deepClone(u);let c=!1;d.ranges.forEach(h=>{i>h.startRow&&i<=h.endRow&&(h.endRow+=r,c=!0)}),c&&(a.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:d,ruleId:u.id}}),l.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:u,ruleId:u.id}}))}),{redos:a,undos:l}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveRows(t,n,s){const i=t.toRange,r=i.startRow,o=i.endRow-i.startRow+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(l=>l.ranges.some(u=>r>u.startRow&&r<=u.endRow));if(a.length){const l=[],u=[];return a.forEach(d=>{const c=Q.deepClone(d),h=t.fromRange.startRow;let g=!1;c.ranges.forEach(m=>{r>m.startRow&&r<=m.endRow&&(h<m.startRow&&(m.startRow=m.startRow-o,m.endRow=m.endRow-o),m.endRow+=o,g=!0)}),g&&(l.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:c,ruleId:d.id}}),u.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:d,ruleId:d.id}}))}),{redos:l,undos:u}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveCols(t,n,s){const i=t.toRange,r=i.startColumn,o=i.endColumn-i.startColumn+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(n,s).filter(l=>l.ranges.some(u=>r>u.startColumn&&r<=u.endColumn));if(a.length){const l=[],u=[];return a.forEach(d=>{const c=Q.deepClone(d),h=t.fromRange.startColumn;let g=!1;c.ranges.forEach(m=>{r>m.startColumn&&r<=m.endColumn&&(h<m.startColumn&&(m.startColumn=m.startColumn-o,m.endColumn=m.endColumn-o),m.endColumn+=o,g=!0)}),g&&(l.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:c,ruleId:d.id}}),u.push({id:Kt.id,params:{unitId:n,subUnitId:s,rule:d,ruleId:d.id}}))}),{redos:l,undos:u}}return{undos:[],redos:[]}}_correctPermissionRange(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(kv.includes(t.id)){if(!t.params)return;const n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!n)return;const s=n.getSheetBySheetId(t.params.subUnitId);if(!s)return;const{sourceRange:i,targetRange:r}=t.params,o=i.startColumn===r.startColumn&&i.endColumn===r.endColumn,a=o?i.endRow-i.startRow+1:i.endColumn-i.startColumn+1,l=o?i.startRow:i.startColumn,u=o?r.startRow:r.startColumn;this._selectionProtectionRuleModel.getSubunitRuleList(n.getUnitId(),s.getSheetId()).forEach(g=>{g.ranges.forEach(m=>{let{startRow:p,endRow:f,startColumn:v,endColumn:C}=m;z.intersects(m,i)||(o?l<p&&u>f?(p-=a,f-=a):l>f&&u<=p&&(p+=a,f+=a):l<v&&u>C?(v-=a,C-=a):l>C&&u<=v&&(v+=a,C+=a)),this._checkIsRightRange({startRow:p,endRow:f,startColumn:v,endColumn:C})&&(m.startColumn=v,m.endColumn=C,m.startRow=p,m.endRow=f)})}),this.disposableCollection.dispose();const{unitId:d,subUnitId:c}=t.params,h=g=>this.refRangeHandle(g,d,c);this._selectionProtectionRuleModel.getSubunitRuleList(d,c).reduce((g,m)=>[...g,...m.ranges],[]).forEach(g=>{this.disposableCollection.add(this._refRangeService.registerRefRange(g,h,d,c))}),this._selectionProtectionRenderModel.clear()}if(xv.includes(t.id)){const n=this._univerInstanceService.getUniverSheetInstance(t.params.unitId);if(!n)return;const s=n.getSheetBySheetId(t.params.subUnitId);if(!s)return;const i=t.params;if(!i)return;const{range:r}=i,o=t.id.includes("row"),a=t.id.includes("insert"),l=o?r.startRow:r.startColumn,u=o?r.endRow:r.endColumn,d=u-l+1;this._selectionProtectionRuleModel.getSubunitRuleList(n.getUnitId(),s.getSheetId()).forEach(m=>{m.ranges.forEach(p=>{let{startRow:f,endRow:v,startColumn:C,endColumn:w}=p;a?o?l<=f&&(f+=d,v+=d):l<=C&&(C+=d,w+=d):o?u<f&&(f-=d,v-=d):u<C&&(C-=d,w-=d),this._checkIsRightRange({startRow:f,endRow:v,startColumn:C,endColumn:w})&&(p.startColumn=C,p.endColumn=w,p.startRow=f,p.endRow=v)})}),this.disposableCollection.dispose();const{unitId:c,subUnitId:h}=t.params,g=m=>this.refRangeHandle(m,c,h);this._selectionProtectionRuleModel.getSubunitRuleList(c,h).reduce((m,p)=>[...m,...p.ranges],[]).forEach(m=>{this.disposableCollection.add(this._refRangeService.registerRefRange(m,g,c,h))}),this._selectionProtectionRenderModel.clear()}}))}_checkIsRightRange(t){return t.startRow<=t.endRow&&t.startColumn<=t.endColumn}_initReBuildCache(){this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(xv.includes(t.id)||kv.includes(t.id)){const{unitId:n,subUnitId:s}=t.params;this._rangeProtectionCache.reBuildCache(n,s)}}))}_initRemoveSheet(){this._sheetInterceptorService.interceptCommand({getMutations:t=>{const n=[],s=[],i=[],r=[];if(t.id===Wr.id){const o=t.params,a=[],l=[];this._rangeProtectionRuleModel.getSubunitRuleList(o.unitId,o.subUnitId).forEach(u=>{a.push(u.id),l.push(u)}),a.length&&l.length&&(i.push({id:$n.id,params:{unitId:o.unitId,subUnitId:o.subUnitId,ruleIds:a}}),n.push({id:Hn.id,params:{unitId:o.unitId,subUnitId:o.subUnitId,name:"",rules:l}}))}return{redos:s,undos:n,preRedos:i,preUndos:r}}})}};Gd=KE([ki(0,V(We)),ki(1,V(P)),ki(2,U),ki(3,V(Ar)),ki(4,V(Wl)),ki(5,V(Is)),ki(6,V(_e)),ki(7,V(We))],Gd);var $E=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},za=(e,t)=>(n,s)=>t(n,s,e);const JE="SHEET_RANGE_PROTECTION_PLUGIN";let qd=class extends ae{constructor(e,t,n,s,i){super(),this._selectionProtectionRuleModel=e,this._permissionService=t,this._resourceManagerService=n,this._selectionProtectionCache=s,this._univerInstanceService=i,this._initSnapshot(),this._initRuleChange()}_initRuleChange(){this.disposeWithMe(this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":{Zn().forEach(t=>{const n=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(n)});break}case"delete":{Zn().forEach(t=>{const n=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.deletePermissionPoint(n.id)});break}case"set":{e.oldRule.permissionId!==e.rule.permissionId&&Zn().forEach(t=>{const n=new t(e.unitId,e.subUnitId,e.oldRule.permissionId);this._permissionService.deletePermissionPoint(n.id);const s=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(s)});break}}}))}_initSnapshot(){const e=n=>{const s=this._selectionProtectionRuleModel.toObject()[n];return s?JSON.stringify(s):""},t=n=>{if(!n)return{};try{return JSON.parse(n)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:t,pluginName:JE,businesses:[xd.UNIVER_SHEET],onLoad:(n,s)=>{const i=this._selectionProtectionRuleModel.toObject();i[n]=s,this._selectionProtectionRuleModel.fromObject(i);const r=[];Object.keys(s).forEach(o=>{const a=s[o];this._selectionProtectionRuleModel.getSubunitRuleList(n,o).forEach(l=>{r.push({objectID:l.permissionId,unitID:n,objectType:se.SelectRange,actions:Vi})}),a.forEach(l=>{Zn().forEach(u=>{const d=new u(n,o,l.permissionId);d.value=!1,this._permissionService.addPermissionPoint(d)})}),this._selectionProtectionCache.reBuildCache(n,o)})},onUnLoad:n=>{this._selectionProtectionCache.deleteUnit(n)}}))}};qd=$E([za(0,V(We)),za(1,V(Je)),za(2,V(lu)),za(3,V(Is)),za(4,V(P))],qd);var ex=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},tx=(e,t)=>(n,s)=>t(n,s,e);let Ll=class extends ae{constructor(t){super(),this._sheetRangeThemeModel=t}registerRangeTheme(t,n){this._sheetRangeThemeModel.registerRangeThemeStyle(t,n)}removeRangeThemeRule(t,n){this._sheetRangeThemeModel.removeRangeThemeRule(t,n)}getALLRegisterThemes(t){return this._sheetRangeThemeModel.getALLRegisteredTheme(t)}registerRangeThemeStyle(t,n){this._sheetRangeThemeModel.registerRangeThemeRule(t,n)}getAppliedRangeThemeStyle(t){return this._sheetRangeThemeModel.getRegisteredRangeThemeStyle(t)}getRegisteredRangeThemes(){return this._sheetRangeThemeModel.getRegisteredRangeThemes()}};Ll=ex([tx(0,V(Dn))],Ll);var nx=Object.defineProperty,sx=(e,t,n)=>t in e?nx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ix=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Tv=(e,t)=>(n,s)=>t(n,s,e),YS=(e,t,n)=>sx(e,typeof t!="symbol"?t+"":t,n);const rx="SHEET_PLUGIN";let ea=class extends Vm{constructor(e=Sv,t,n){super(),this._config=e,this._injector=t,this._configService=n;const{...s}=Hm({},Sv,this._config);this._configService.setConfig(bu,s),this._initConfig(),this._initDependencies()}_initConfig(){var e,t,n;(e=this._config)!=null&&e.onlyRegisterFormulaRelatedMutations&&this._configService.setConfig(XS,!0),(t=this._config)!=null&&t.isRowStylePrecedeColumnStyle&&this._configService.setConfig(tI,!0),(n=this._config)!=null&&n.autoHeightForMergedCells&&this._configService.setConfig(nI,!0)}_initDependencies(){var e;const t=[[pi],[Hd],[q],[Ar],[Jo],[Xr,{useClass:dm}],[_e],[Ll],[zs],[zd],[Ml],[Yd],[Bd],[jd],[Hl],[Ld],[ft],[_i],[Zd],[Dl],[Yr],[Dn],[Wl],[We],[Is],[Gd],[qd],[um,{useClass:qE,deps:[q]}],[Ua,{useClass:im}],[Vl]];(e=this._config)!=null&&e.notExecuteFormula||t.push([Xd]),_l(this._injector,Dm(t,this._config.override)),Ns(this._injector,[[_e],[qd],[um],[Dl],[Hl]])}onStarting(){var e;Ns(this._injector,[[zd],[Ml],[Jo],[Ld],[Zd],[zs],[Vl]]),(e=this._config)!=null&&e.onlyRegisterFormulaRelatedMutations||this._injector.add([Fd])}onRendered(){Ns(this._injector,[[Xr]])}onReady(){Ns(this._injector,[[Fd],[Xd],[Bd],[jd],[Dn],[Yd],[Wl],[Gd],[Ar],[Yr]])}};YS(ea,"pluginName",rx);YS(ea,"type",A.UNIVER_SHEET);ea=ix([Wm(_0),Tv(1,V(pt)),Tv(2,Lt)],ea);const ox={WorkbookCommentPermission:up,WorkbookCopyPermission:oi,WorkbookCreateProtectPermission:oo,WorkbookCreateSheetPermission:mu,WorkbookDeleteSheetPermission:Jc,WorkbookDuplicatePermission:hp,WorkbookEditablePermission:ne,WorkbookExportPermission:gp,WorkbookHideSheetPermission:ya,WorkbookHistoryPermission:Zw,WorkbookManageCollaboratorPermission:xa,WorkbookMoveSheetPermission:eh,WorkbookPrintPermission:mp,WorkbookRecoverHistoryPermission:pp,WorkbookRenameSheetPermission:ka,WorkbookSharePermission:fp,WorkbookViewHistoryPermission:Cp,WorkbookViewPermission:vp,WorksheetCopyPermission:qi,WorksheetDeleteColumnPermission:th,WorksheetDeleteProtectionPermission:pu,WorksheetDeleteRowPermission:nh,WorksheetEditExtraObjectPermission:wp,WorksheetEditPermission:oe,WorksheetFilterPermission:Sp,WorksheetInsertColumnPermission:ao,WorksheetInsertHyperlinkPermission:bp,WorksheetInsertRowPermission:lo,WorksheetManageCollaboratorPermission:sh,WorksheetPivotTablePermission:_p,WorksheetSetCellStylePermission:mt,WorksheetSetCellValuePermission:nn,WorksheetSetColumnStylePermission:Qn,WorksheetSetRowStylePermission:Kn,WorksheetSortPermission:Ip,WorksheetViewPermission:cr,RangeProtectionPermissionEditPoint:he,RangeProtectionPermissionViewPoint:Gi},PP=(e,t,n,s)=>{const i=e.get(Je),r=e.get(We),o=i.getPermissionPoint(new ne(t).id);if(!(o!=null&&o.value))return!1;const a=i.getPermissionPoint(new oe(t,n).id);if(!(a!=null&&a.value))return!1;const l=r.getSubunitRuleList(t,n).filter(u=>u.ranges.some(d=>s.some(c=>z.intersects(d,c))));return l.length?l.every(u=>{const d=u.permissionId,c=i.getPermissionPoint(new he(t,n,d).id);return!!(c!=null&&c.value)}):!0},ZS=(e,t,n,s=1,i=!0,r=!0)=>{const o=De.transformRange(e,t),{startRow:a,endRow:l}=o;let u=n.startRow-s,d=t.getMergedCell(u,n.startColumn),c=!d||d.startRow===u&&d.startColumn===n.startColumn;for(;!t.getRowVisible(u)||!c;)u--,d=t.getMergedCell(u,n.startColumn),c=!d||d.startRow===u&&d.startColumn===n.startColumn;if(u>=a)return{...n,startRow:u,endRow:u};if(r){const h={...n,startRow:l,endRow:l};return qS(e,t,h,s,i,!1)}},GS=(e,t,n,s=1,i=!0,r=!0)=>{const o=De.transformRange(e,t),{startRow:a,endRow:l}=o;let u=n.endRow+s,d=t.getMergedCell(u,n.startColumn),c=!d||d.startRow===u&&d.startColumn===n.startColumn;for(;!t.getRowVisible(u)||!c;)u++,d=t.getMergedCell(u,n.startColumn),c=!d||d.startRow===u&&d.startColumn===n.startColumn;if(u<=l)return{...n,startRow:u,endRow:u};if(r){const h={...n,startRow:a,endRow:a};return QS(e,t,h,s,i,!1)}},qS=(e,t,n,s=1,i=!0,r=!0)=>{const o=De.transformRange(e,t),{startColumn:a,endColumn:l}=o;let u=n.startColumn-s,d=t.getMergedCell(n.startRow,u),c=!d||d.startRow===n.startRow&&d.startColumn===u;for(;!t.getColVisible(u)||!c;)u--,d=t.getMergedCell(n.startRow,u),c=!d||d.startRow===n.startRow&&d.startColumn===u;if(u>=a)return{...n,startColumn:u,endColumn:u};if(r){const h={...n,startColumn:l,endColumn:l};return ZS(e,t,h,s,i,!1)}},QS=(e,t,n,s=1,i=!0,r=!0)=>{const o=De.transformRange(e,t),{startColumn:a,endColumn:l}=o;let u=n.endColumn+s,d=t.getMergedCell(n.startRow,u),c=!d||d.startRow===n.startRow&&d.startColumn===u;for(;!t.getColVisible(u)||!c;)u++,d=t.getMergedCell(n.startRow,u),c=!d||d.startRow===n.startRow&&d.startColumn===u;if(u<=l)return{...n,endColumn:u,startColumn:u};if(r){const h={...n,startColumn:a,endColumn:a};return GS(e,t,h,s,i,!1)}};function ju(e,t,n){let s=null;return n.getMatrixWithMergedCells(e,t,e,t).forValue((i,r,o)=>(s={actualRow:i,actualColumn:r,startRow:i,startColumn:r,isMerged:o.rowSpan!==void 0||o.colSpan!==void 0,isMergedMainCell:o.rowSpan!==void 0&&o.colSpan!==void 0,endRow:i+(o.rowSpan!==void 0?o.rowSpan-1:0),endColumn:r+(o.colSpan!==void 0?o.colSpan-1:0),rangeType:j.NORMAL},!1)),s||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:j.NORMAL}}const ax=(e,t,n,s,i=1)=>{switch(s){case Z.UP:return ZS(e,t,n,i);case Z.DOWN:return GS(e,t,n,i);case Z.LEFT:return qS(e,t,n,i);case Z.RIGHT:return QS(e,t,n,i)}},lx=(e,t,n)=>{let s,i=-1,r;for(let v=0;v<e.length;v++)if(e[v].primary){s=e[v],i=v,r=s.primary;break}if(i===-1)return null;const o=t===Z.LEFT||t===Z.UP,a=o?i-1>=0?i-1:e.length-1:i+1<e.length?i+1:0,l=e[a];if(!s||!r)return null;const u={...r},{startRow:d,startColumn:c,endRow:h,endColumn:g}=s.range,m=o?u.startRow===d&&u.startColumn===c:u.endRow===h&&u.endColumn===g,p=m&&o;if(!z.equals(s.range,u)){const v=m?l.range:ax(s.range,n,u,t);if(!v)return null;const C=p?ju(v.endRow,v.endColumn,n):ju(v.startRow,v.startColumn,n);return{startRow:C.startRow,startColumn:C.startColumn,endRow:C.endRow,endColumn:C.endColumn}}const f=p?ju(l.range.endRow,l.range.endColumn,n):ju(l.range.startRow,l.range.startColumn,n);return{startRow:f.startRow,startColumn:f.startColumn,endRow:f.endRow,endColumn:f.endColumn}},ux=bn("telemetry.service");var dx=Object.defineProperty,cx=(e,t,n)=>t in e?dx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t,n)=>cx(e,typeof t!="symbol"?t+"":t,n);function of(e,t){if(e==null)return;const n=t.getRenderById(e);if(n==null)return;const{mainComponent:s,scene:i,engine:r,components:o}=n,a=s,l=o.get(H_.BACKGROUND);return{document:a,docBackground:l,scene:i,engine:r}}function af(e){return e.getContextValue(kn)}function ot(e){return e.getContextValue(kn)&&e.getContextValue(ro)&&!e.getContextValue(It)&&!e.getContextValue(Es)}function KS(e){return e.getContextValue(kn)&&e.getContextValue(ro)&&!e.getContextValue(It)&&!e.getContextValue(Vn)&&!e.getContextValue(Es)}function hx(e){return e.getContextValue(kn)&&e.getContextValue(ro)&&e.getContextValue(It)}function lf(e){return e.getContextValue(ro)&&e.getContextValue(It)}function ph(e){return e.getContextValue(Vn)&&e.getContextValue(ro)}function UP(e){return e.getContextValue(kn)&&e.getContextValue(It)&&e.getContextValue(pd)&&e.getContextValue(ro)}function ta(e){return e.getContextValue(kn)&&e.getContextValue(ro)&&e.getContextValue(It)&&!e.getContextValue(pd)&&!e.getContextValue(Lc)}function Zr(e){let t=[],n=[];const s=[];return e.forEach(i=>{t=t.concat(i.rows),n=n.concat(i.cols)}),t=Array.from(new Set(t)).sort((i,r)=>i-r),n=Array.from(new Set(n)).sort((i,r)=>i-r),e.forEach(i=>{s.push({startRow:t.findIndex(r=>r===i.rows[0]),endRow:t.findIndex(r=>r===i.rows[i.rows.length-1]),startColumn:n.findIndex(r=>r===i.cols[0]),endColumn:n.findIndex(r=>r===i.cols[i.cols.length-1])})}),{ranges:s,mapFunc:(i,r)=>({row:t[i],col:n[r]})}}const cm=gn("rangeMovePermissionCheck"),hm=gn("rangeFillPermissionCheck");var $S=(e=>(e[e.FORMULA_EDITOR_SHOW=100]="FORMULA_EDITOR_SHOW",e[e.MARK_SELECTION=1e4]="MARK_SELECTION",e))($S||{});function sr(e){const t=e.getColorFromTheme("primary.600"),n=e.getColorFromTheme("white"),s=new Ls(t).setAlpha(.07).toRgbString();return{strokeWidth:1,stroke:t,fill:s,widgets:{},widgetSize:6,widgetStrokeWidth:1,widgetStroke:n,autofillSize:6,autofillStrokeWidth:1,autofillStroke:n,rowHeaderFill:s,rowHeaderStroke:t,rowHeaderStrokeWidth:1,columnHeaderFill:s,columnHeaderStroke:t,columnHeaderStrokeWidth:1,expandCornerSize:40}}const gm=[10,400],JS="RANGE_SELECTOR_COMPONENT_KEY",uf="EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY";var yt=(e=>(e.MAIN="__SpreadsheetRender__",e.ROW="__SpreadsheetRowHeader__",e.COLUMN="__SpreadsheetColumnHeader__",e.LEFT_TOP="__SpreadsheetLeftTopPlaceholder__",e))(yt||{});const Pv=0,Qd=1,Xs=10,gx=11,Uv=12;class mx{constructor(){y(this,"_startColumn",-1),y(this,"_startRow",-1),y(this,"_endColumn",-1),y(this,"_endRow",-1),y(this,"_startX",0),y(this,"_startY",0),y(this,"_endX",0),y(this,"_endY",0),y(this,"_primary"),y(this,"_rangeType",j.NORMAL)}get startColumn(){return this._startColumn}get startRow(){return this._startRow}get endColumn(){return this._endColumn}get endRow(){return this._endRow}get startX(){return this._startX}get startY(){return this._startY}get endX(){return this._endX}get endY(){return this._endY}get currentCell(){return this._primary}get rangeType(){return this._rangeType}isEqual(t){const{startColumn:n,startRow:s,endColumn:i,endRow:r}=this,{startColumn:o,startRow:a,endColumn:l,endRow:u}=t;return n===o&&s===a&&i===l&&r===u}highlightToSelection(){if(this._primary)return md(this._primary)}getRange(){return{startColumn:this._startColumn,startRow:this._startRow,endColumn:this._endColumn,endRow:this._endRow,startX:this._startX,startY:this._startY,endX:this._endX,endY:this._endY,rangeType:this.rangeType}}getCell(){return this._primary}getRangeType(){return this._rangeType}setRangeType(t){this._rangeType=t}getValue(){return{rangeWithCoord:this.getRange(),primaryWithCoord:this._primary}}setValue(t,n){const{startColumn:s,startRow:i,endColumn:r,endRow:o,startX:a,startY:l,endX:u,endY:d,rangeType:c}=t;this._startColumn=s,this._startRow=i,this._endColumn=r,this._endRow=o,this._startX=a,this._startY=l,this._endX=u,this._endY=d,c!==void 0&&(this._rangeType=c),n!==void 0&&this.setCurrentCell(n)}setCurrentCell(t){this._primary=t}clearCurrentCell(){this._primary=null}}const fh={id:"sheet.command.set-row-header-width",type:H.COMMAND,handler:async(e,t)=>{if(!t)return!1;const n=e.get(ze);if(!n)return!1;const{unitId:s,subUnitId:i,size:r}=t,o=n.getRenderById(s);if(o){n.getRenderById(s).with(Te).setRowHeaderSize(o,i,r);const{components:a}=o,l=a.get(yt.ROW);l&&l.setCustomHeader({headerStyle:{size:r}},i)}return!0}},vh={id:"sheet.command.set-col-header-height",type:H.COMMAND,handler:async(e,t)=>{if(!t)return!1;const n=e.get(ze);if(!n)return!1;const{unitId:s,subUnitId:i,size:r}=t,o=n.getRenderById(s);if(o){n.getRenderById(s).with(Te).setColumnHeaderSize(o,i,r);const{components:a}=o,l=a.get(yt.COLUMN);l&&l.setCustomHeader({headerStyle:{size:r}},i)}return!0}};class px extends r0{render(t,n=!1){const s=Q.now();return super.render(t,n),this._afterRender(s),this}_afterRender(t){this.scene.getEngine().renderFrameTimeMetric$.next(["selectionLayer",Q.now()-t])}}function Bl(e,t){const{startRow:n,startColumn:s,endRow:i,endColumn:r,rangeType:o}=t,a=i<n?i:n,l=i<n?n:i,u=r<s?r:s,d=r<s?s:r,c=e.getNoMergeCellWithCoordByIndex(a,u),h=e.getNoMergeCellWithCoordByIndex(l,d);return{startRow:n,startColumn:s,endRow:i,endColumn:r,rangeType:o,startY:c?.startY||0,endY:h?.endY||0,startX:c?.startX||0,endX:h?.endX||0}}function In(e,t){const{range:n,primary:s,style:i}=e,r=Bl(t,n),o=s&&Kd(t,s);return{rangeWithCoord:r,primaryWithCoord:o,style:i}}function Kd(e,t){const{actualRow:n,actualColumn:s,isMerged:i,isMergedMainCell:r,startRow:o,startColumn:a,endRow:l,endColumn:u}=t,d=e.getNoMergeCellWithCoordByIndex(n,s),c=e.getNoMergeCellWithCoordByIndex(o,a),h=e.getNoMergeCellWithCoordByIndex(l,u);return{actualRow:n,actualColumn:s,isMerged:i,isMergedMainCell:r,startX:d.startX,startY:d.startY,endX:d.endX,endY:d.endY,mergeInfo:{startRow:o,startColumn:a,endRow:l,endColumn:u,startY:c?.startY||0,endY:h?.endY||0,startX:c?.startX||0,endX:h?.endX||0}}}const Zt=bn("univer.sheet.selection-render-service");class eb extends ae{constructor(t,n,s,i,r){super(),y(this,"_downObserver"),y(this,"_scenePointerMoveSub"),y(this,"_scenePointerUpSub"),y(this,"_controlFillConfig$",new xe(null)),y(this,"controlFillConfig$",this._controlFillConfig$.asObservable()),y(this,"_selectionControls",[]),y(this,"_startRangeWhenPointerDown",{startY:0,endY:0,startX:0,endX:0,startRow:-1,endRow:-1,startColumn:-1,endColumn:-1}),y(this,"_activeControlIndex",-1),y(this,"_startViewportPosX",0),y(this,"_startViewportPosY",0),y(this,"_scrollTimer"),y(this,"_cancelDownSubscription"),y(this,"_cancelUpSubscription"),y(this,"_skeleton"),y(this,"_scene"),y(this,"_highlightHeader",!0),y(this,"_rangeType",j.NORMAL),y(this,"_selectionStyle"),y(this,"_remainLastEnabled",!1),y(this,"_skipLastEnabled",!1),y(this,"_singleSelectionEnabled",!1),y(this,"_selectionMoveEnd$",new xe([])),y(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable()),y(this,"_selectionMoving$",new Ve),y(this,"selectionMoving$",this._selectionMoving$.asObservable()),y(this,"_selectionMoveStart$",new Ve),y(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable()),y(this,"_selectionMoving",!1),y(this,"_selectionTheme"),y(this,"_activeViewport"),y(this,"interceptor",new Ci({RANGE_MOVE_PERMISSION_CHECK:cm,RANGE_FILL_PERMISSION_CHECK:hm})),y(this,"_escapeShortcutDisposable",null),this._injector=t,this._themeService=n,this._shortcutService=s,this._sheetSkeletonManagerService=i,this.contextService=r,this._initSelectionThemeFromThemeService(),this._initMoving()}get selectionMoving(){return this._selectionMoving}get _shouldDetectMergedCells(){return this._rangeType===j.NORMAL}_initMoving(){this.disposeWithMe(this._selectionMoving$.subscribe(()=>{this._selectionMoving=!0})),this.disposeWithMe(this._selectionMoveEnd$.subscribe(()=>{this._selectionMoving=!1}))}_setSelectionStyle(t){this._selectionStyle=t}getViewPort(){return this._activeViewport}setSingleSelectionEnabled(t=!1){this._singleSelectionEnabled=t}newSelectionControl(t,n,s){const i=this.getSelectionControls().length,{rowHeaderWidth:r,columnHeaderHeight:o}=n,a=new cf(t,i,this._selectionTheme,{highlightHeader:this._highlightHeader,rowHeaderWidth:r,columnHeaderHeight:o});this._selectionControls.push(a);const l=In(s,n);return a.updateRangeBySelectionWithCoord(l,n),a.setControlExtension({skeleton:n,scene:t,themeService:this._selectionTheme,injector:this._injector,selectionHooks:{selectionMoveEnd:()=>{this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}}}),a}resetSelectionsByModelData(t){const n=this.getSelectionControls(),s=this._skeleton;if(!(!n||!s)){for(let i=0,r=t.length;i<r;i++){const o=t[i],a=In(o,this._skeleton),l=n[i];l?l.updateRangeBySelectionWithCoord(a,s):this.isSelectionEnabled()&&this.newSelectionControl(this._scene,s,o)}t.length<n.length&&n.splice(t.length).forEach(i=>i.dispose())}}refreshSelectionMoveStart(){this._selectionMoveStart$.next(this.getSelectionDataWithStyle())}refreshSelectionMoveEnd(){this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}_initSelectionThemeFromThemeService(){const t=this._themeService.getCurrentTheme();this._selectionTheme=new xn,this._selectionTheme.setTheme(t)}setSelectionTheme(t){this._selectionTheme.setTheme(t)}_changeRuntime(t,n,s){this._skeleton=t,this._scene=n,this._activeViewport=s||n?.getViewports()[0],n.findLayerByZIndex(Qd)||n.addLayer(new px(n,[],Qd))}getSkeleton(){return this._skeleton}getSelectionDataWithStyle(){const t=this._selectionControls;if(this._skeleton.worksheet){const[n,s]=this._skeleton.getLocation();return t.map(i=>{const r=i.getValue();return r.rangeWithCoord.sheetId=s,r.rangeWithCoord.unitId=n,r})}return[]}getSelectionControls(){return this._selectionControls}_addSelectionControlByModelData(t){var n;const s=this._skeleton,i=(n=t.style)!=null?n:sr(this._selectionTheme),r=this._scene;return t.style=i,this.newSelectionControl(r,s,t)}_clearAllSelectionControls(){const t=this._selectionControls;for(const n of t)n.dispose();this._selectionControls.length=0}_getFreeze(){var t;return(t=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:t.skeleton.getWorksheetConfig().freeze}_getViewportByCell(t,n){if(t===void 0||n===void 0)return null;const s=this._getFreeze();if(!s||s.startRow<=0&&s.startColumn<=0)return this._scene.getViewport($.VIEW_MAIN);if(t>s.startRow&&n>s.startColumn)return this._scene.getViewport($.VIEW_MAIN);if(t<=s.startRow&&n<=s.startColumn)return this._scene.getViewport($.VIEW_MAIN_LEFT_TOP);if(t<=s.startRow&&n>s.startColumn)return this._scene.getViewport($.VIEW_MAIN_TOP);if(t>s.startRow&&n<=s.startColumn)return this._scene.getViewport($.VIEW_MAIN_LEFT)}getActiveRange(){const t=this.getSelectionControls(),n=t&&t[t.length-1].model;return n&&{startRow:n.startRow,startColumn:n.startColumn,endRow:n.endRow,endColumn:n.endColumn}}setActiveSelectionIndex(t){this._activeControlIndex=t}resetActiveSelectionIndex(){this._activeControlIndex=-1}getActiveSelectionControl(){const t=this.getSelectionControls();if(t)return this._activeControlIndex<0?t[t.length-1]:t[this._activeControlIndex]}endSelection(){var t;this._clearUpdatingListeners(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),(t=this._escapeShortcutDisposable)==null||t.dispose(),this._escapeShortcutDisposable=null}_reset(){var t;this._clearAllSelectionControls(),(t=this._downObserver)==null||t.unsubscribe(),this._downObserver=null}_setupPointerMoveListener(t,n,s,i=tn.ALL,r,o){var a,l;let u=0,d=0,c=r,h=o;this._scrollTimer=To.create(this._scene,i),this._scrollTimer.startScroll((a=t?.left)!=null?a:0,(l=t?.top)!=null?l:0,t);const g=this._scene,m=g.getActiveViewportByCoord(at.FromArray([r,o]));this._scenePointerMoveSub=g.onPointerMove$.subscribeEvent(p=>{var f,v,C,w,b,I,_,R,M;const{offsetX:x,offsetY:N}=p,{x:T,y:O}=g.getCoordRelativeToViewport(at.FromArray([x,N]));this._movingHandler(T,O,n,s);let k=T,D=O;const B=this.getActiveSelectionControl(),W=this._getFreeze(),F=B?.model,K=(f=g.getActiveViewportByCoord(at.FromArray([x,N])))!=null?f:this._getViewportByCell(F?.endRow,F?.endColumn);if((()=>{if(!m||!K||!t)return!1;const J=[$.VIEW_MAIN,$.VIEW_MAIN_LEFT_TOP,$.VIEW_MAIN_TOP,$.VIEW_MAIN_LEFT];return J.includes(m.viewportKey)&&J.includes(K.viewportKey)})()){if(!m||!K||!t)return!1;const J=c<t.left&&T>t.left||c>t.left&&T<t.left,ee=h<t.top&&O>t.top||h>t.top&&O<t.top;J&&(u+=1),ee&&(d+=1);const we=m.viewportKey,Ge=K.viewportKey;if(we===$.VIEW_ROW_TOP)N<t.top&&((v=F?.endRow)!=null?v:0)<((C=W?.startRow)!=null?C:0)?D=t.top:ee&&d%2===1&&t.scrollToViewportPos({viewportScrollY:0});else if(we===$.VIEW_COLUMN_LEFT)x<t.left&&((w=F?.endColumn)!=null?w:0)<((b=W?.startColumn)!=null?b:0)?k=t.left:J&&u%2===1&&t.scrollToViewportPos({viewportScrollX:0});else if(we===Ge){let Ae=!1,Ze=!1;we===$.VIEW_MAIN_LEFT_TOP?(Ae=!0,Ze=!0):we===$.VIEW_MAIN_TOP?Ze=!0:we===$.VIEW_MAIN_LEFT&&(Ae=!0),((I=F?.endRow)!=null?I:0)>((_=W?.startRow)!=null?_:0)&&(Ze=!1),((R=F?.endColumn)!=null?R:0)>((M=W?.startColumn)!=null?M:0)&&(Ae=!1),Ae&&(k=t.left),Ze&&(D=t.top)}else{const Ae={x:m.scrollX,y:m.scrollY},Ze={x:K.scrollX,y:K.scrollY},ue=Ae.x!==Ze.x&&J&&u%2===1,ge=Ae.y!==Ze.y&&ee&&d%2===1;(ue||ge)&&(t.scrollToBarPos({x:ue?Ae.x:void 0,y:ge?Ae.y:void 0}),ue||(k=t.left),ge||(D=t.top)),(we===$.VIEW_MAIN_LEFT_TOP&&Ge===$.VIEW_MAIN_LEFT||Ge===$.VIEW_MAIN_LEFT_TOP&&we===$.VIEW_MAIN_LEFT)&&(k=t.left),(we===$.VIEW_MAIN_LEFT_TOP&&Ge===$.VIEW_MAIN_TOP||Ge===$.VIEW_MAIN_LEFT_TOP&&we===$.VIEW_MAIN_TOP)&&(D=t.top)}c=T,h=O}this._scrollTimer.scrolling(k,D,()=>{this._movingHandler(T,O,n,s)})})}attachSelectionWithCoord(t){return In(t,this._skeleton)}attachPrimaryWithCoord(t){return Kd(this._skeleton,t)}getSelectionCellByPosition(t,n){return this.getCellWithCoordByOffset(t,n)}getCellWithCoordByOffset(t,n,s){const i=this._scene,r=s??this._skeleton,o=i.getViewportScrollXY(i.getViewport($.VIEW_MAIN)),{scaleX:a,scaleY:l}=i.getAncestorScale();return r.getCellWithCoordByOffset(t-o.x,n-o.y,a,l,o)}_movingHandler(t,n,s,i){var r,o,a,l,u;const d=this._skeleton,c=this._scene,[h,g]=d.getLocation(),m={startRow:(r=s?.model.startRow)!=null?r:-1,endRow:(o=s?.model.endRow)!=null?o:-1,startColumn:(a=s?.model.startColumn)!=null?a:-1,endColumn:(l=s?.model.endColumn)!=null?l:-1},p=c.getViewport($.VIEW_MAIN),f=(u=this._getViewportByCell(m.endRow,m.endColumn))!=null?u:p,v=c.getScrollXYInfoByViewport(at.FromArray([this._startViewportPosX,this._startViewportPosY]),f),{scaleX:C,scaleY:w}=c.getAncestorScale();i===j.ROW?t=Number.POSITIVE_INFINITY:i===j.COLUMN&&(n=Number.POSITIVE_INFINITY);const b=this._skeleton.getCellByOffset(t,n,C,w,v);if(!b)return;let I={startRow:Math.min(b.startRow,this._startRangeWhenPointerDown.startRow),startColumn:Math.min(b.startColumn,this._startRangeWhenPointerDown.startColumn),endRow:Math.max(b.endRow,this._startRangeWhenPointerDown.endRow),endColumn:Math.max(b.endColumn,this._startRangeWhenPointerDown.endColumn)};this._shouldDetectMergedCells&&(I=d.expandRangeByMerge(I,this.inRefSelectionMode()));const _=In({range:I,primary:void 0,style:null},d);_.rangeWithCoord.unitId=h,_.rangeWithCoord.sheetId=g,_.rangeWithCoord.rangeType=i;const R=m.startRow!==I.startRow||m.startColumn!==I.startColumn||m.endRow!==I.endRow||m.endColumn!==I.endColumn;s!=null&&R&&(s.updateRangeBySelectionWithCoord(_),this._selectionMoving$.next(this.getSelectionDataWithStyle()))}_clearUpdatingListeners(){var t,n,s,i,r;this._scene.enableObjectsEvent(),(t=this._scenePointerMoveSub)==null||t.unsubscribe(),this._scenePointerMoveSub=null,(n=this._scenePointerUpSub)==null||n.unsubscribe(),this._scenePointerUpSub=null,(s=this._cancelDownSubscription)==null||s.unsubscribe(),this._cancelDownSubscription=null,(i=this._cancelUpSubscription)==null||i.unsubscribe(),this._cancelUpSubscription=null,(r=this._scrollTimer)==null||r.dispose()}_addEndingListeners(){var t,n,s;const i=this._scene,r=(t=i.getEngine())==null?void 0:t.activeScene;!r||r===i||((n=this._cancelDownSubscription)==null||n.unsubscribe(),this._cancelDownSubscription=null,(s=this._cancelUpSubscription)==null||s.unsubscribe(),this._cancelUpSubscription=null,this._cancelDownSubscription=r.onPointerDown$.subscribeEvent(()=>this._clearUpdatingListeners()),this._cancelUpSubscription=r.onPointerUp$.subscribeEvent(()=>this._clearUpdatingListeners()))}_getSelectionWithCoordByOffset(t,n,s,i,r){const o=this._skeleton;if(o==null)return null;if(this._shouldDetectMergedCells){const p=o?.getCellWithCoordByOffset(t,n,s,i,r,{firstMatch:!0});if(!p)return;const f=md(p);return{primaryWithCoord:p,rangeWithCoord:f}}const{row:a,column:l}=o.getCellIndexByOffset(t,n,s,i,r),u=o.getNoMergeCellWithCoordByIndex(a,l),{startX:d,startY:c,endX:h,endY:g}=u,m={startY:c,endY:g,startX:d,endX:h,startRow:a,endRow:a,startColumn:l,endColumn:l};return{primaryWithCoord:{mergeInfo:m,actualRow:a,actualColumn:l,isMerged:!1,isMergedMainCell:!1,startY:c,endY:g,startX:d,endX:h},rangeWithCoord:m}}_checkClearPreviousControls(t){this.getSelectionControls().length!==0&&(!t.ctrlKey&&!t.shiftKey&&!this._remainLastEnabled||this._singleSelectionEnabled&&!t.shiftKey)&&this._clearAllSelectionControls()}_makeSelectionByTwoCells(t,n,s,i,r){const{actualRow:o,actualColumn:a,mergeInfo:l}=t;this._startRangeWhenPointerDown={...t.mergeInfo};const u=Math.min(o,n.startRow,l.startRow),d=Math.max(o,n.endRow,l.endRow),c=Math.min(a,n.startColumn,l.startColumn),h=Math.max(a,n.endColumn,l.endColumn),g={range:s.expandRangeByMerge({startRow:u,startColumn:c,endRow:d,endColumn:h}),primary:Lw(t),style:null},m=In(g,s);r.updateRangeBySelectionWithCoord(m)}isSelectionEnabled(){return this.contextService.getContextValue(Eo)}isSelectionDisabled(){return this.contextService.getContextValue(Eo)===!1}inRefSelectionMode(){return this.contextService.getContextValue(Fo)}}function tb(e){return{range:{startRow:0,startColumn:0,endRow:e.getRowCount()-1,endColumn:e.getColumnCount()-1,rangeType:j.ALL},primary:df(e).primary,style:null}}function df(e){return fx(e,{startRow:0,startColumn:0,endRow:0,endColumn:0})}function fx(e,t){const n=e.worksheet.getCellInfoInMergeData(t.startRow,t.startColumn),s=e.worksheet.getCellInfoInMergeData(t.endRow,t.endColumn);return{range:{startRow:n.startRow,startColumn:n.startColumn,endRow:s.endRow,endColumn:s.endColumn,rangeType:j.NORMAL},primary:{actualRow:n.startRow,actualColumn:n.startColumn,startRow:n.startRow,startColumn:n.startColumn,endRow:n.endRow,endColumn:n.endColumn,isMerged:n.isMerged,isMergedMainCell:n.isMergedMainCell},style:null}}var vx=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Nv=(e,t)=>(n,s)=>t(n,s,e);let Te=class extends ae{constructor(e,t,n){super(),y(this,"_sheetId",""),y(this,"_sheetSkeletonParamStore",new Map),y(this,"_currentSkeleton$",new xe(null)),y(this,"currentSkeleton$",this._currentSkeleton$.asObservable()),y(this,"_currentSkeletonBefore$",new xe(null)),y(this,"currentSkeletonBefore$",this._currentSkeletonBefore$.asObservable()),this._context=e,this._injector=t,this._sheetSkService=n,this.disposeWithMe(()=>{this._currentSkeletonBefore$.complete(),this._currentSkeleton$.complete(),this._sheetSkeletonParamStore.forEach(s=>this.disposeSkeleton(s.sheetId)),this._sheetSkeletonParamStore.clear()}),this._initRemoveSheet()}_initRemoveSheet(){this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe(e=>{this.disposeSkeleton(e.getSheetId())}))}getCurrentSkeleton(){var e;return(e=this.getCurrentParam())==null?void 0:e.skeleton}getCurrent(){return this.getCurrentParam()}getCurrentParam(){return this._getSkeletonParam(this._sheetId)}getSkeleton(e){return this._getSkeleton(e)}getSkeletonParam(e){return this._getSkeletonParam(e)}getWorksheetSkeleton(e){return this.getSkeletonParam(e)}getUnitSkeleton(e,t){const n=this._getSkeletonParam(t);return n!=null&&(n.unitId=e),n}setCurrent(e){this._setCurrent(e.sheetId)}setSkeletonParam(e,t){this._sheetSkService.setSkeleton(t.unitId,e,t.skeleton),this._sheetSkeletonParamStore.set(e,t)}_setCurrent(e){this._sheetId=e;const t=this._getSkeletonParam(e),n=this._context.unitId;if(t!=null)this.reCalculate(t);else{const i=this._context.unit.getSheetBySheetId(e);if(i==null)return;const r=this._context.scene,o=this._buildSkeleton(i,r);this.setSkeletonParam(e,{unitId:n,sheetId:e,skeleton:o,dirty:!1})}const s=this._getSkeletonParam(e);this._currentSkeletonBefore$.next(s),this._currentSkeleton$.next(s)}reCalculate(e){e||(e=this.getCurrentParam()),e!=null&&(e.dirty&&(e.skeleton.makeDirty(!0),e.dirty=!1),e.skeleton.calculate())}makeDirty(e,t=!0){const n=this._getSkeletonParam(e.sheetId);n!=null&&(n.dirty=t)}getOrCreateSkeleton(e){return this.ensureSkeleton(e.sheetId)}ensureSkeleton(e){const t=this._getSkeletonParam(e);if(t)return t.skeleton;const n=this._context.unit.getSheetBySheetId(e);if(!n)return;const s=this._buildSkeleton(n);return this.setSkeletonParam(e,{unitId:this._context.unitId,sheetId:e,skeleton:s,dirty:!1}),s}disposeSkeleton(e){const t=this.getSkeletonParam(e);t&&(t.skeleton.dispose(),this._sheetSkeletonParamStore.delete(e),this._sheetSkService.deleteSkeleton(t.unitId,e))}attachRangeWithCoord(e){const t=this.getCurrentSkeleton();return t?Bl(t,e):null}_getSkeletonParam(e){return this._sheetSkeletonParamStore.get(e)}_getSkeleton(e){const t=this._getSkeletonParam(e);return t?t.skeleton:null}_buildSkeleton(e,t){return this._injector.createInstance(s0,e,this._context.unit.getStyles())}setColumnHeaderSize(e,t,n){var s;if(!e)return;const i=(s=this.getWorksheetSkeleton(t))==null?void 0:s.skeleton;if(!i)return;i.columnHeaderHeight=n,e.scene.getViewports()[0].top=n,e.scene.getViewport($.VIEW_COLUMN_RIGHT).setViewportSize({height:n}),e.scene.getViewport($.VIEW_COLUMN_LEFT).setViewportSize({height:n}),e.scene.getViewport($.VIEW_ROW_BOTTOM).setViewportSize({top:n}),e.scene.getViewport($.VIEW_ROW_TOP).setViewportSize({top:n}),e.scene.getViewport($.VIEW_LEFT_TOP).setViewportSize({height:n});const r=e?.with(q),o=e?.with(Zt),a=r.getCurrentSelections();o.resetSelectionsByModelData(a);const l=this.getUnitSkeleton(e.unitId,t);l&&(l.commandId=vh.id,this._currentSkeleton$.next(l))}setRowHeaderSize(e,t,n){var s;const i=(s=this.getWorksheetSkeleton(t))==null?void 0:s.skeleton;if(!e||!i)return;i.rowHeaderWidth=n;const r=e.scene.getViewport($.VIEW_LEFT_TOP).width||46,o=n-r,a=e.scene.getViewports()[0].left;e.scene.getViewports()[0].left=a+o,e.scene.getViewport($.VIEW_ROW_BOTTOM).setViewportSize({width:n}),e.scene.getViewport($.VIEW_ROW_TOP).setViewportSize({width:n}),e.scene.getViewport($.VIEW_COLUMN_LEFT).setViewportSize({left:n});const l=e.scene.getViewport($.VIEW_COLUMN_RIGHT).left||0;e.scene.getViewport($.VIEW_COLUMN_RIGHT).setViewportSize({left:l+o}),e.scene.getViewport($.VIEW_LEFT_TOP).setViewportSize({width:n});const u=e?.with(q),d=e?.with(Zt),c=u.getCurrentSelections();d.resetSelectionsByModelData(c);const h=this.getCurrent();h&&(h.commandId=fh.id,this._currentSkeleton$.next(h))}};Te=vx([Nv(1,V(pt)),Nv(2,V(zs))],Te);const Ov="__SpreadsheetHelperSelectionTempRect",Cx=35;class wx{constructor(t,n){y(this,"_startOffsetX",0),y(this,"_startOffsetY",0),y(this,"_relativeSelectionPositionRow",0),y(this,"_relativeSelectionPositionColumn",0),y(this,"_relativeSelectionRowLength",0),y(this,"_relativeSelectionColumnLength",0),y(this,"_scenePointerMoveSub"),y(this,"_scenePointerUpSub"),y(this,"_disabled",!1),y(this,"_helperSelection"),y(this,"_scrollTimer"),y(this,"_activeViewport"),y(this,"_targetSelection",{startY:0,endY:0,startX:0,endX:0,startRow:-1,endRow:-1,startColumn:-1,endColumn:-1}),y(this,"_isInMergeState",!1),y(this,"_fillControlColors",[]),y(this,"_skeleton"),y(this,"_scene"),y(this,"_themeService"),y(this,"_injector"),y(this,"_selectionHooks"),this._control=t,this._skeleton=n.skeleton,this._scene=n.scene,this._themeService=n.themeService,this._injector=n.injector,this._selectionHooks=n.selectionHooks,this._initialControl(),this._initialWidget(),this._initialAutoFill(),this._control.dispose$.subscribe(()=>{this.dispose()})}get isHelperSelection(){return this._control.isHelperSelection}dispose(){var t,n;(t=this._scrollTimer)==null||t.dispose(),this._fillControlColors=[],this._clearObserverEvent(),(n=this._helperSelection)==null||n.dispose()}setDisabled(t){this._disabled=t}_getFreeze(){var t,n;return(n=(t=Gm(A.UNIVER_SHEET,Te,this._injector.get(P),this._injector.get(ze)))==null?void 0:t.getCurrentParam())==null?void 0:n.skeleton.getWorksheetConfig().freeze}_isSelectionInViewport(t,n){const s=this._getFreeze()||{startRow:-1,startColumn:-1};switch(n.viewportKey){case $.VIEW_MAIN:return t.endRow>=s.startRow&&t.endColumn>=s.startColumn;case $.VIEW_MAIN_TOP:case $.VIEW_COLUMN_RIGHT:return t.endColumn>=s.startColumn&&t.startRow<s.startRow;case $.VIEW_MAIN_LEFT:case $.VIEW_ROW_BOTTOM:return t.endRow>=s.startRow&&t.startColumn<s.startColumn;case $.VIEW_MAIN_LEFT_TOP:case $.VIEW_COLUMN_LEFT:case $.VIEW_ROW_TOP:case $.VIEW_LEFT_TOP:return t.startRow<s.startRow&&t.startColumn<s.startColumn}}_clearObserverEvent(){var t,n;(t=this._scenePointerMoveSub)==null||t.unsubscribe(),(n=this._scenePointerUpSub)==null||n.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null}_initialControl(){const{leftControl:t,rightControl:n,topControl:s,bottomControl:i}=this._control;[t,n,s,i].forEach(r=>{r.onPointerEnter$.subscribeEvent(()=>{var o;((o=this._injector.get(Zt,Gg.OPTIONAL))==null?void 0:o.interceptor.fetchThroughInterceptors(cm)(!1,null))!==!1&&r.setCursor(Qe.MOVE)}),r.onPointerLeave$.subscribeEvent(()=>{r.resetCursor()}),r.onPointerDown$.subscribeEvent(this._controlPointerDownHandler.bind(this))})}_controlMoving(t,n){var s;const i=this._scene,r=i.getScrollXYInfoByViewport(at.FromArray([t,n])),{scaleX:o,scaleY:a}=i.getAncestorScale(),l=this._skeleton.getCellIndexByOffset(t,n,o,a,r),{row:u,column:d}=l,c=this._skeleton.getRowCount()-1,h=this._skeleton.getColumnCount()-1;let g=Math.max(0,u+this._relativeSelectionPositionRow),m=g+this._relativeSelectionRowLength;m>c&&(m=c,m-g<this._relativeSelectionRowLength&&(g=m-this._relativeSelectionRowLength));let p=Math.max(0,d+this._relativeSelectionPositionColumn),f=p+this._relativeSelectionColumnLength;f>h&&(f=h,f-p<this._relativeSelectionColumnLength&&(p=f-this._relativeSelectionColumnLength));const v=this._skeleton.worksheet.getCellInfoInMergeData(g,p),C=In({range:{startRow:g,endRow:m,startColumn:p,endColumn:f},primary:v,style:null},this._skeleton),w=this._skeleton.getNoMergeCellWithCoordByIndex(g,p),b=this._skeleton.getNoMergeCellWithCoordByIndex(m,f),I=w?.startY||0,_=b?.endY||0,R=w?.startX||0,M=b?.endX||0;(s=this._helperSelection)==null||s.transformByState({left:R,top:I,width:M-R,height:_-I}),this._targetSelection={...C.rangeWithCoord},this._control.selectionMoving$.next(C.rangeWithCoord)}_controlPointerDownHandler(t){const{offsetX:n,offsetY:s}=t,i=this._scene,r=i.getCoordRelativeToViewport(at.FromArray([n,s])),{x:o,y:a}=r,l=i.getScrollXYInfoByViewport(r),{scaleX:u,scaleY:d}=i.getAncestorScale(),c=this._skeleton.getCellIndexByOffset(o,a,u,d,l);this._startOffsetX=o,this._startOffsetY=a;const{row:h,column:g}=c,{startRow:m,startColumn:p,endRow:f,endColumn:v}=this._control.model;let C=0,w=0;h<m?C-=1:h>f&&(C+=1),g<p?w-=1:g>v&&(w+=1),this._relativeSelectionPositionRow=m-h+C,this._relativeSelectionPositionColumn=p-g+w,this._relativeSelectionRowLength=f-m,this._relativeSelectionColumnLength=v-p;const b=this._control.currentStyle,I=this._getScale();this.isHelperSelection&&(this._helperSelection=new Be(Ov,{stroke:b.stroke,strokeWidth:b.strokeWidth/I}),i.addObject(this._helperSelection));const _=i.getViewport($.VIEW_MAIN),R=To.create(i);this._scrollTimer=R,R.startScroll(o,a,_),i.disableObjectsEvent(),this._scenePointerMoveSub=i.onPointerMove$.subscribeEvent(M=>{var x;if(this._disabled)return;const{offsetX:N,offsetY:T}=M;if(((x=this._injector.get(Zt,Gg.OPTIONAL))==null?void 0:x.interceptor.fetchThroughInterceptors(cm)(!1,null))===!1)return;const{x:O,y:k}=i.getCoordRelativeToViewport(at.FromArray([N,T]));this._controlMoving(O,k),i.setCursor(Qe.MOVE),R.scrolling(O,k,()=>{this._controlMoving(O,k)})}),this._scenePointerUpSub=i.onPointerUp$.subscribeEvent(()=>{var M,x,N,T;(M=this._helperSelection)==null||M.dispose();const O=this._scene;O.resetCursor(),this._clearObserverEvent(),O.enableObjectsEvent(),(x=this._scrollTimer)==null||x.dispose(),this._control.selectionMoveEnd$.next(this._targetSelection),(T=(N=this._selectionHooks).selectionMoveEnd)==null||T.call(N)})}_initialWidget(){const{topLeftWidget:t,topCenterWidget:n,topRightWidget:s,middleLeftWidget:i,middleRightWidget:r,bottomLeftWidget:o,bottomCenterWidget:a,bottomRightWidget:l}=this._control,u=[Qe.NORTH_WEST_RESIZE,Qe.NORTH_RESIZE,Qe.NORTH_EAST_RESIZE,Qe.WEST_RESIZE,Qe.EAST_RESIZE,Qe.SOUTH_WEST_RESIZE,Qe.SOUTH_RESIZE,Qe.SOUTH_EAST_RESIZE];[t,n,s,i,r,o,a,l].forEach((d,c)=>{d.onPointerEnter$.subscribeEvent(()=>{d.setCursor(u[c])}),d.onPointerLeave$.subscribeEvent(()=>{d.resetCursor()}),d.onPointerDown$.subscribeEvent(h=>{this._widgetPointerDownEvent(h,u[c])})})}_widgetPointerDownEvent(t,n){const s=this._scene,{offsetX:i,offsetY:r}=t,o=s.getCoordRelativeToViewport(at.FromArray([i,r])),{x:a,y:l}=o;this._startOffsetX=i,this._startOffsetY=r;const{startRow:u,startColumn:d,endRow:c,endColumn:h}=this._control.model,g=Math.min(u,c),m=Math.min(d,h),p=Math.max(u,c),f=Math.max(d,h);this._relativeSelectionPositionRow=g,this._relativeSelectionPositionColumn=m,this._relativeSelectionRowLength=p-g,this._relativeSelectionColumnLength=f-m,n===Qe.NORTH_WEST_RESIZE?(this._relativeSelectionPositionRow=p,this._relativeSelectionPositionColumn=f):n===Qe.NORTH_RESIZE?this._relativeSelectionPositionRow=p:n===Qe.NORTH_EAST_RESIZE?this._relativeSelectionPositionRow=p:n===Qe.WEST_RESIZE?this._relativeSelectionPositionColumn=f:n===Qe.SOUTH_WEST_RESIZE?this._relativeSelectionPositionColumn=f:n===Qe.SOUTH_RESIZE&&(this._relativeSelectionPositionRow=g);const v=To.create(s),C=s.getViewport($.VIEW_MAIN);v.startScroll(a,l,C),this._scrollTimer=v,s.disableObjectsEvent(),this._scenePointerMoveSub=s.onPointerMove$.subscribeEvent(w=>{const{offsetX:b,offsetY:I}=w,{x:_,y:R}=s.getCoordRelativeToViewport(at.FromArray([b,I]));this._widgetMoving(_,R,n),s.setCursor(n),v.scrolling(_,R,()=>{this._widgetMoving(_,R,n)})}),this._scenePointerUpSub=s.onPointerUp$.subscribeEvent(()=>{var w,b,I;const _=this._scene;_.resetCursor(),this._clearObserverEvent(),_.enableObjectsEvent(),(w=this._scrollTimer)==null||w.dispose(),this._control.selectionScaled$.next(this._targetSelection),(I=(b=this._selectionHooks).selectionMoveEnd)==null||I.call(b)})}_widgetMoving(t,n,s){const i=this._scene,r=i.getScrollXYInfoByViewport(at.FromArray([this._startOffsetX,this._startOffsetY])),{scaleX:o,scaleY:a}=i.getAncestorScale(),l=this._skeleton.getCellIndexByOffset(t,n,o,a,r),{row:u,column:d}=l;let c=this._relativeSelectionPositionRow,h=this._relativeSelectionPositionColumn,g=u,m=d;s===Qe.NORTH_WEST_RESIZE?(c=u,h=d,g=this._relativeSelectionPositionRow,m=this._relativeSelectionPositionColumn):s===Qe.NORTH_RESIZE?(c=u,h=this._relativeSelectionPositionColumn,g=this._relativeSelectionPositionRow,m=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength):s===Qe.NORTH_EAST_RESIZE?(c=u,h=this._relativeSelectionPositionColumn,g=this._relativeSelectionPositionRow,m=d):s===Qe.WEST_RESIZE?(c=this._relativeSelectionPositionRow,h=d,g=this._relativeSelectionPositionRow+this._relativeSelectionRowLength,m=this._relativeSelectionPositionColumn):s===Qe.EAST_RESIZE?g=this._relativeSelectionPositionRow+this._relativeSelectionRowLength:s===Qe.SOUTH_WEST_RESIZE?(c=this._relativeSelectionPositionRow,h=d,g=u,m=this._relativeSelectionPositionColumn):s===Qe.SOUTH_RESIZE&&(c=this._relativeSelectionPositionRow,h=this._relativeSelectionPositionColumn,g=u,m=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength);const p=this._swapPositions(c,h,g,m),f=this._skeleton.getCellWithMergeInfoByIndex(c,h),v=In({range:p,primary:f,style:null},this._skeleton);this._targetSelection={...v.rangeWithCoord},this._control.updateRangeBySelectionWithCoord(v),this._control.selectionScaling$.next(this._targetSelection)}_initialAutoFill(){const{fillControl:t}=this._control;t.onPointerEnter$.subscribeEvent(n=>{this._injector.get(Zt).interceptor.fetchThroughInterceptors(hm)(!1,{x:n.offsetX,y:n.offsetY,skeleton:this._skeleton,scene:this._scene})&&t.setCursor(Qe.CROSSHAIR)}),t.onPointerLeave$.subscribeEvent(()=>{t.resetCursor()}),t.onPointerDown$.subscribeEvent(this._autoFillForPointerdown.bind(this))}_autoFillMoving(t,n){var s,i,r;const o=this._scene,a=o.getViewportScrollXY(this._activeViewport),{scaleX:l,scaleY:u}=o.getAncestorScale(),d=this._skeleton.getCellIndexByOffset(t,n,l,u,a),{row:c,column:h}=d,g=o.getCoordRelativeToViewport(at.FromArray([t,n])),m=this._skeleton.getRowCount()-1,p=this._skeleton.getColumnCount()-1;let f=this._relativeSelectionPositionRow,v=this._relativeSelectionPositionColumn,C=this._relativeSelectionPositionRow+this._relativeSelectionRowLength,w=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength,b=!1,I=!0;if((h<v||h>w)&&c>=f&&c<=C){const k=this._fillRuler(h,v,w,this._relativeSelectionColumnLength,p);v=k.startRowOrColumn,w=k.endRowOrColumn,b=k.isLighten,I=!1}else if((c<f||c>C)&&h>=v&&h<=w){const k=this._fillRuler(c,f,C,this._relativeSelectionRowLength,m);f=k.startRowOrColumn,C=k.endRowOrColumn,b=k.isLighten}else if(Math.abs(this._startOffsetX-g.x-a.x)/2>Math.abs(this._startOffsetY-g.y-a.y)){const k=this._fillRuler(h,v,w,this._relativeSelectionColumnLength,p);v=k.startRowOrColumn,w=k.endRowOrColumn,b=k.isLighten,I=!1}else{const k=this._fillRuler(c,f,C,this._relativeSelectionRowLength,m);f=k.startRowOrColumn,C=k.endRowOrColumn,b=k.isLighten}const _=this._skeleton.getNoMergeCellWithCoordByIndex(f,v),R=this._skeleton.getNoMergeCellWithCoordByIndex(C,w),M=_?.startY||0,x=R?.endY||0,N=_?.startX||0,T=R?.endX||0;b?this._controlHandler((k,D)=>{const B=new Ls(this._fillControlColors[D]).lighten(Cx).toRgbString();k.setProps({fill:B})}):this._controlHandler((k,D)=>{k.setProps({fill:this._fillControlColors[D]})});const O=Md/this._getScale();f===C&&I===!0||v===w&&I===!1?(s=this._helperSelection)==null||s.hide():((i=this._helperSelection)==null||i.transformByState({left:N-O/2,top:M-O/2,width:T-N,height:x-M}),(r=this._helperSelection)==null||r.show()),this._targetSelection={startY:M,endY:x,startX:N,endX:T,startRow:f,endRow:C,startColumn:v,endColumn:w},this._control.selectionFilling$.next(this._targetSelection)}_autoFillForPointerdown(t){const{offsetX:n,offsetY:s}=t,i=this._scene,r=i.getCoordRelativeToViewport(at.FromArray([n,s])),{x:o,y:a}=r;this._startOffsetX=o,this._startOffsetY=a;const{startRow:l,startColumn:u,endRow:d,endColumn:c}=this._control.model;this._isInMergeState=this._hasMergeInRange(l,u,d,c),this._relativeSelectionPositionRow=l,this._relativeSelectionPositionColumn=u,this._relativeSelectionRowLength=d-l,this._relativeSelectionColumnLength=c-u;const h=this._control.currentStyle;let g=h?.stroke,m=h?.strokeWidth;const p=sr(this._themeService);g==null&&(g=p.stroke),m==null&&(m=p.strokeWidth);const f=this._getScale();m/=f;const v=Md/f,C=new Ls(g).darken(2).toRgbString();this.isHelperSelection&&(this._helperSelection=new Be(Ov,{stroke:C,strokeWidth:m+v/2}),i.addObject(this._helperSelection)),this._activeViewport=i.getActiveViewportByCoord(at.FromArray([n,s]));const w=i.getViewport($.VIEW_MAIN),b=To.create(i,this._activeViewport.viewportKey===$.VIEW_MAIN?tn.ALL:tn.NONE);b.startScroll(o,a,w),this._scrollTimer=b,i.disableObjectsEvent(),this._controlHandler(I=>{this._fillControlColors.push(I.fill)}),this._scenePointerMoveSub=i.onPointerMove$.subscribeEvent(I=>{var _;const{offsetX:R,offsetY:M}=I,x=i.getActiveViewportByCoord(at.FromArray([R,M]));if(!this._injector.get(Zt).interceptor.fetchThroughInterceptors(hm)(!1,{x:t.offsetX,y:t.offsetY,skeleton:this._skeleton,scene:this._scene}))return;const{x:N,y:T}=i.getCoordRelativeToViewport(at.FromArray([R,M]));this._autoFillMoving(N,T),i.setCursor(Qe.CROSSHAIR);const O=this._targetSelection;if(w&&x&&((_=this._activeViewport)==null?void 0:_.viewportKey)!==x?.viewportKey){let k;O.startRow!==l?(b.scrollTimerType=tn.Y,k={...O,endRow:O.startRow}):O.endRow!==d?(b.scrollTimerType=tn.Y,k={...O,startRow:O.endRow}):O.startColumn!==u?(b.scrollTimerType=tn.X,k={...O,endColumn:O.startColumn}):(b.scrollTimerType=tn.X,k={...O,startColumn:O.endColumn}),this._isSelectionInViewport(k,x)&&(this._viewportMainScrollBarNeedResetPosition(b.scrollTimerType,this._activeViewport.viewportKey,x.viewportKey)&&w.scrollToBarPos({x:b.scrollTimerType===tn.X?0:void 0,y:b.scrollTimerType===tn.Y?0:void 0}),this._activeViewport=x)}b.scrolling(N,T,()=>{this._autoFillMoving(N,T)})}),this._scenePointerUpSub=i.onPointerUp$.subscribeEvent(()=>{var I,_;(I=this._helperSelection)==null||I.dispose();const R=this._scene;R.resetCursor(),this._clearObserverEvent(),R.enableObjectsEvent(),(_=this._scrollTimer)==null||_.dispose(),this._control.refreshSelectionFilled(this._targetSelection),this._isInMergeState=!1,this._controlHandler((M,x)=>{M.setProps({fill:this._fillControlColors[x]})}),this._fillControlColors=[]})}_viewportMainScrollBarNeedResetPosition(t,n,s){return t===tn.X&&(n===$.VIEW_MAIN_LEFT||n===$.VIEW_MAIN_LEFT_TOP)&&(s===$.VIEW_MAIN||s===$.VIEW_MAIN_TOP)||t===tn.Y&&(n===$.VIEW_MAIN_TOP||n===$.VIEW_MAIN_LEFT_TOP)&&(s===$.VIEW_MAIN||s===$.VIEW_MAIN_LEFT)}_hasMergeInRange(t,n,s,i){return this._skeleton.worksheet.getMergedCellRange(t,n,s,i).length>0}_swapPositions(t,n,s,i){const r=Math.min(t,s),o=Math.min(n,i),a=Math.max(t,s),l=Math.max(n,i);return{startRow:r,startColumn:o,endRow:a,endColumn:l}}_controlHandler(t){const{leftControl:n,rightControl:s,topControl:i,bottomControl:r,backgroundControlTop:o,backgroundControlMiddleLeft:a,backgroundControlMiddleRight:l,backgroundControlBottom:u,fillControl:d}=this._control,c=[n,s,i,r,o,a,l,u,d];for(let h=0,g=c.length;h<g;h++){const m=c[h];t(m,h)}}_fillRuler(t,n,s,i,r){let o=!1;if(t<n)if(this._isInMergeState&&t<n){const a=n-t,l=i+1,u=Math.ceil(a/l);let d=n-u*l;d<0&&(d=n-(u-1)*l),n=d}else n=t;else if(t>=n&&t<=s)o=!0,this._isInMergeState||(s=t);else if(this._isInMergeState&&t>s){const a=t-s,l=i+1,u=Math.ceil(a/l);let d=s+u*l;d>r&&(d=s+(u-1)*l),s=d}else s=t;return{rowOrColumn:t,startRowOrColumn:n,endRowOrColumn:s,isLighten:o}}_getScale(){const{scaleX:t,scaleY:n}=this._scene.getAncestorScale();return Math.max(t,n)}}var mm=(e=>(e.Selection="__SpreadsheetSelectionShape__",e.top="__SpreadsheetSelectionTopControl__",e.bottom="__SpreadsheetSelectionBottomControl__",e.left="__SpreadsheetSelectionShapeLeftControl__",e.right="__SpreadsheetSelectionShapeRightControl__",e.backgroundTop="__SpreadsheetSelectionBackgroundControlTop__",e.backgroundMiddleLeft="__SpreadsheetSelectionBackgroundControlMiddleLeft__",e.backgroundMiddleRight="__SpreadsheetSelectionBackgroundControlMiddleRight__",e.backgroundBottom="__SpreadsheetSelectionBackgroundControlBottom__",e.fill="__SpreadsheetSelectionFillControl__",e.fillTopLeft="__SpreadsheetSelectionFillControlTopLeft__",e.fillBottomRight="__SpreadsheetSelectionFillControlBottomRight__",e.fillTopLeftInner="__SpreadsheetSelectionFillControlTopLeftInner__",e.fillBottomRightInner="__SpreadsheetSelectionFillControlBottomRightInner__",e.lineMain="__SpreadsheetDragLineMainControl__",e.lineContent="__SpreadsheetDragLineContentControl__",e.line="__SpreadsheetDragLineControl__",e.dash="__SpreadsheetDragDashControl__",e.rowHeaderBackground="__SpreadSheetSelectionRowHeaderBackground__",e.rowHeaderBorder="__SpreadSheetSelectionRowHeaderBorder__",e.rowHeaderGroup="__SpreadSheetSelectionRowHeaderGroup__",e.columnHeaderBackground="__SpreadSheetSelectionColumnHeaderBackground__",e.columnHeaderBorder="__SpreadSheetSelectionColumnHeaderBorder__",e.columnHeaderGroup="__SpreadSheetSelectionColumnHeaderGroup__",e.topLeftWidget="__SpreadSheetSelectionTopLeftWidget__",e.topCenterWidget="__SpreadSheetSelectionTopCenterWidget__",e.topRightWidget="__SpreadSheetSelectionTopRightWidget__",e.middleLeftWidget="__SpreadSheetSelectionMiddleLeftWidget__",e.middleRightWidget="__SpreadSheetSelectionMiddleRightWidget__",e.bottomLeftWidget="__SpreadSheetSelectionBottomLeftWidget__",e.bottomCenterWidget="__SpreadSheetSelectionBottomCenterWidget__",e.bottomRightWidget="__SpreadSheetSelectionBottomRightWidget__",e))(mm||{});const Av=.3;class cf extends ae{constructor(t,n,s,i){var r,o,a,l;super(),y(this,"_isHelperSelection",!0),y(this,"_enableAutoFill",!0),y(this,"_showAutoFill",!1),y(this,"_highlightHeader",!0),y(this,"_selectionRenderModel"),y(this,"_leftBorder"),y(this,"_rightBorder"),y(this,"_topBorder"),y(this,"_bottomBorder"),y(this,"_backgroundControlTop"),y(this,"_backgroundControlBottom"),y(this,"_backgroundControlMiddleLeft"),y(this,"_backgroundControlMiddleRight"),y(this,"_autoFillControl"),y(this,"_selectionShapeGroup"),y(this,"_rowHeaderBackground"),y(this,"_rowHeaderBorder"),y(this,"_rowHeaderGroup"),y(this,"_columnHeaderBackground"),y(this,"_columnHeaderBorder"),y(this,"_columnHeaderGroup"),y(this,"_dashedRect"),y(this,"_topLeftWidget"),y(this,"_topCenterWidget"),y(this,"_topRightWidget"),y(this,"_middleLeftWidget"),y(this,"_middleRightWidget"),y(this,"_bottomLeftWidget"),y(this,"_bottomCenterWidget"),y(this,"_bottomRightWidget"),y(this,"_defaultStyle"),y(this,"_currentStyle"),y(this,"_rowHeaderWidth",0),y(this,"_columnHeaderHeight",0),y(this,"_widgetRects",[]),y(this,"_controlExtension"),y(this,"_dispose$",new xe(this)),y(this,"dispose$",this._dispose$.asObservable()),y(this,"selectionMoving$",new Ve),y(this,"selectionMoveEnd$",new Ve),y(this,"selectionScaling$",new Ve),y(this,"selectionScaled$",new Ve),y(this,"selectionFilling$",new Ve),y(this,"_selectionFilled$",new Ve),y(this,"selectionFilled$",this._selectionFilled$.asObservable()),y(this,"_antLineOffset",0),y(this,"_antRequestNewFrame",-1),this._scene=t,this._zIndex=n,this._themeService=s,this._enableAutoFill=(r=i?.enableAutoFill)!=null?r:!0,this._highlightHeader=(o=i?.highlightHeader)!=null?o:!0,this._rowHeaderWidth=(a=i?.rowHeaderWidth)!=null?a:0,this._columnHeaderHeight=(l=i?.columnHeaderHeight)!=null?l:0,this._initializeSheetBody(),this._initialHeader()}_initializeSheetBody(){this._defaultStyle=sr(this._themeService),this._currentStyle=sr(this._themeService),this._selectionRenderModel=new mx;const t=this._zIndex;this._leftBorder=new Be("__SpreadsheetSelectionShapeLeftControl__"+t,{zIndex:t}),this._rightBorder=new Be("__SpreadsheetSelectionShapeRightControl__"+t,{zIndex:t}),this._topBorder=new Be("__SpreadsheetSelectionTopControl__"+t,{zIndex:t}),this._bottomBorder=new Be("__SpreadsheetSelectionBottomControl__"+t,{zIndex:t}),this._backgroundControlTop=new Be("__SpreadsheetSelectionBackgroundControlTop__"+t,{zIndex:t-1,evented:!1}),this._backgroundControlBottom=new Be("__SpreadsheetSelectionBackgroundControlBottom__"+t,{zIndex:t-1,evented:!1}),this._backgroundControlMiddleLeft=new Be("__SpreadsheetSelectionBackgroundControlMiddleLeft__"+t,{zIndex:t-1,evented:!1}),this._backgroundControlMiddleRight=new Be("__SpreadsheetSelectionBackgroundControlMiddleRight__"+t,{zIndex:t-1,evented:!1}),this._autoFillControl=new Be("__SpreadsheetSelectionFillControl__"+t,{zIndex:t+1}),this._autoFillControl.hide(),this._dashedRect=new $I("__SpreadsheetDragDashControl__"+t,{zIndex:t+2,evented:!1,stroke:"#fff"});const n=[this._autoFillControl,this._leftBorder,this._rightBorder,this._topBorder,this._bottomBorder,this._backgroundControlTop,this._backgroundControlMiddleLeft,this._backgroundControlMiddleRight,this._backgroundControlBottom,this._dashedRect];this._widgetRects=this._initialWidget(),this._selectionShapeGroup=new Lh("__SpreadsheetSelectionShape__"+t,...n,...this._widgetRects),this._selectionShapeGroup.hide(),this._selectionShapeGroup.evented=!1,this._selectionShapeGroup.zIndex=t;const s=this.getScene();s.addObject(this._selectionShapeGroup,Qd),this.disposeWithMe(He(s.onTransformChange$.subscribeEvent(i=>{i.type===Kg.scale&&(this._updateLayoutOfSelectionControl(this._currentStyle),this._updateControlCoord())})))}_initialHeader(){const t=this._zIndex;this._rowHeaderBackground=new Be("__SpreadSheetSelectionRowHeaderBackground__"+t,{zIndex:t-1,evented:!1}),this._rowHeaderBorder=new Be("__SpreadSheetSelectionRowHeaderBorder__"+t,{zIndex:t-1,evented:!1}),this._rowHeaderGroup=new Lh("__SpreadSheetSelectionRowHeaderGroup__"+t,this._rowHeaderBackground,this._rowHeaderBorder),this._rowHeaderGroup.hide(),this._rowHeaderGroup.evented=!1,this._rowHeaderGroup.zIndex=t,this._columnHeaderBackground=new Be("__SpreadSheetSelectionColumnHeaderBackground__"+t,{zIndex:t-1,evented:!1}),this._columnHeaderBorder=new Be("__SpreadSheetSelectionColumnHeaderBorder__"+t,{zIndex:t-1,evented:!1}),this._columnHeaderGroup=new Lh("__SpreadSheetSelectionColumnHeaderGroup__"+t,this._columnHeaderBackground,this._columnHeaderBorder),this._columnHeaderGroup.hide(),this._columnHeaderGroup.evented=!1,this._columnHeaderGroup.zIndex=t,this.getScene().addObjects([this._rowHeaderGroup,this._columnHeaderGroup],gx)}_initialWidget(){const t=this._zIndex;return this._topLeftWidget=new Be("__SpreadSheetSelectionTopLeftWidget__"+t,{zIndex:t+1}),this._topCenterWidget=new Be("__SpreadSheetSelectionTopCenterWidget__"+t,{zIndex:t+1}),this._topRightWidget=new Be("__SpreadSheetSelectionTopRightWidget__"+t,{zIndex:t+1}),this._middleLeftWidget=new Be("__SpreadSheetSelectionMiddleLeftWidget__"+t,{zIndex:t+1}),this._middleRightWidget=new Be("__SpreadSheetSelectionMiddleRightWidget__"+t,{zIndex:t+1}),this._bottomLeftWidget=new Be("__SpreadSheetSelectionBottomLeftWidget__"+t,{zIndex:t+1}),this._bottomCenterWidget=new Be("__SpreadSheetSelectionBottomCenterWidget__"+t,{zIndex:t+1}),this._bottomRightWidget=new Be("__SpreadSheetSelectionBottomRightWidget__"+t,{zIndex:t+1}),[this._topLeftWidget,this._topCenterWidget,this._topRightWidget,this._middleLeftWidget,this._middleRightWidget,this._bottomLeftWidget,this._bottomCenterWidget,this._bottomRightWidget]}get zIndex(){return this._zIndex}get leftControl(){return this._leftBorder}get rightControl(){return this._rightBorder}get topControl(){return this._topBorder}get bottomControl(){return this._bottomBorder}get fillControl(){return this._autoFillControl}get backgroundControlTop(){return this._backgroundControlTop}get backgroundControlBottom(){return this._backgroundControlBottom}get backgroundControlMiddleLeft(){return this._backgroundControlMiddleLeft}get backgroundControlMiddleRight(){return this._backgroundControlMiddleRight}get selectionShape(){return this._selectionShapeGroup}get columnHeaderGroup(){return this._columnHeaderGroup}get rowHeaderGroup(){return this._rowHeaderGroup}get selectionShapeGroup(){return this._selectionShapeGroup}get model(){return this._selectionRenderModel}get topLeftWidget(){return this._topLeftWidget}get topCenterWidget(){return this._topCenterWidget}get topRightWidget(){return this._topRightWidget}get middleLeftWidget(){return this._middleLeftWidget}get middleRightWidget(){return this._middleRightWidget}get bottomLeftWidget(){return this._bottomLeftWidget}get bottomCenterWidget(){return this._bottomCenterWidget}get bottomRightWidget(){return this._bottomRightWidget}get themeService(){return this._themeService}get selectionModel(){return this._selectionRenderModel}set selectionModel(t){this._selectionRenderModel=t}get currentStyle(){return this._currentStyle}set currentStyle(t){this._currentStyle=t}get dashedRect(){return this._dashedRect}get isHelperSelection(){return this._isHelperSelection}get rowHeaderWidth(){return this._rowHeaderWidth}set rowHeaderWidth(t){this._rowHeaderWidth=t}get columnHeaderHeight(){return this._columnHeaderHeight}set columnHeaderHeight(t){this._columnHeaderHeight=t}setControlExtension(t){this._controlExtension=new wx(this,t)}setControlExtensionDisable(t){this._controlExtension&&this._controlExtension.setDisabled(t)}setEvent(t){this.leftControl.evented=t,this.rightControl.evented=t,this.topControl.evented=t,this.bottomControl.evented=t}refreshSelectionFilled(t){this._selectionFilled$.next(t)}_updateLayoutOfSelectionControl(t){t&&(this.currentStyle=Object.assign({},this._defaultStyle,t));const n=this.currentStyle,{stroke:s,widgets:i,autofillStroke:r,strokeDash:o,isAnimationDash:a}=n;let l=n.autofillSize,u=n.strokeWidth,d=n.autofillStrokeWidth;const c=this._getScale(),h=(u+Md)/2/c;u/=c,l/=c,d/=c<1?1:c;const g=Md/c,m=o0/c,{startX:p,startY:f,endX:v,endY:C}=this._selectionRenderModel;if(this.leftControl.transformByState({height:C-f,left:-h+m,width:u,strokeWidth:g,top:-g/2+m}),this.leftControl.setProps({fill:s,stroke:Hu}),this.rightControl.transformByState({height:C-f,left:v-p-h+m,width:u,strokeWidth:g,top:-g/2+m}),this.rightControl.setProps({fill:s,stroke:Hu}),this.topControl.transformByState({width:v-p+u,top:-h+m,left:-h+m,height:u,strokeWidth:g}),this.topControl.setProps({fill:s,stroke:Hu}),this.bottomControl.transformByState({width:v-p+u,top:C-f-h+m,height:u,left:-h+m,strokeWidth:g}),this.bottomControl.setProps({fill:s,stroke:Hu}),o==null)this.dashedRect.hide(),this._stopAntLineAnimation();else{const w=n.strokeWidth*2/c;this.dashedRect.transformByState({height:C-f,width:v-p,strokeWidth:w,left:-w/2+m,top:-w/2+m}),this.dashedRect.setProps({strokeDashArray:[0,o/c]}),this._stopAntLineAnimation(),a!==!1&&this._startAntLineAnimation(),this.dashedRect.show()}if(this._showAutoFill=this._showAutoFill&&this._enableAutoFill,this._showAutoFill&&!this._hasWidgets(i)){const w={fill:s,stroke:r,strokeScaleEnabled:!1},b={width:l-d,height:l-d,left:v-p-l/2+d/2-m,top:C-f-l/2+d/2-m,strokeWidth:d};this._autoFillControl.setProps(w),this._autoFillControl.transformByState(b),this._autoFillControl.show()}else this._autoFillControl.hide();this._updateBackgroundControl(n),this._updateHeaderBackground(n),this._updateWidgets(n)}_updateControlCoord(){const{startX:t,startY:n}=this._selectionRenderModel;this.selectionShapeGroup.show(),this.selectionShapeGroup.translate(t,n),this.selectionShapeGroup.makeDirtyNoDebounce(!0)}updateStyle(t){this._updateLayoutOfSelectionControl(t),this._updateControlCoord()}updateRange(t,n){this._selectionRenderModel.setValue(t,n),this._showAutoFill=n!==null,this._updateLayoutOfSelectionControl(),this._updateControlCoord()}updateRangeBySelectionWithCoord(t,n){n&&(this._rowHeaderWidth=n.rowHeaderWidth,this._columnHeaderHeight=n.columnHeaderHeight),this._selectionRenderModel.setValue(t.rangeWithCoord,t.primaryWithCoord),this._showAutoFill=t.primaryWithCoord!==null,this._updateLayoutOfSelectionControl(t.style),this._updateControlCoord()}update(t,n=0,s=0,i,r){this._rowHeaderWidth=n,this._columnHeaderHeight=s,this.updateRangeBySelectionWithCoord({rangeWithCoord:t,primaryWithCoord:r,style:i}),i&&this.updateStyle(i)}updateCurrCell(t){this._showAutoFill=t!==null,this._selectionRenderModel.setCurrentCell(t)}clearHighlight(){this._showAutoFill=!1,this._selectionRenderModel.clearCurrentCell(),this._updateLayoutOfSelectionControl(this._currentStyle)}getScene(){return this._scene}dispose(){var t,n,s,i,r,o,a,l,u,d,c,h,g,m,p,f,v,C,w,b,I,_,R,M,x;(t=this._leftBorder)==null||t.dispose(),(n=this._rightBorder)==null||n.dispose(),(s=this._topBorder)==null||s.dispose(),(i=this._bottomBorder)==null||i.dispose(),(r=this._backgroundControlTop)==null||r.dispose(),(o=this._backgroundControlMiddleLeft)==null||o.dispose(),(a=this._backgroundControlMiddleRight)==null||a.dispose(),(l=this._backgroundControlBottom)==null||l.dispose(),this._autoFillControl.dispose(),(u=this._selectionShapeGroup)==null||u.dispose(),(d=this._rowHeaderBackground)==null||d.dispose(),(c=this._rowHeaderBorder)==null||c.dispose(),(h=this._rowHeaderGroup)==null||h.dispose(),(g=this._rowHeaderBackground)==null||g.dispose(),(m=this._columnHeaderBackground)==null||m.dispose(),(p=this._columnHeaderBorder)==null||p.dispose(),(f=this._columnHeaderGroup)==null||f.dispose(),(v=this._topLeftWidget)==null||v.dispose(),(C=this._topCenterWidget)==null||C.dispose(),(w=this._topRightWidget)==null||w.dispose(),(b=this._middleLeftWidget)==null||b.dispose(),(I=this._middleRightWidget)==null||I.dispose(),(_=this._bottomLeftWidget)==null||_.dispose(),(R=this._bottomCenterWidget)==null||R.dispose(),(M=this._bottomRightWidget)==null||M.dispose(),(x=this._controlExtension)==null||x.dispose(),super.dispose(),this._dispose$.next(this),this._dispose$.complete()}getCurrentCellInfo(){const t=this.model.currentCell;if(t){let n;if(t.isMerged){const s=t.mergeInfo;n={startRow:s.startRow,endRow:s.endRow,startColumn:s.startColumn,endColumn:s.endColumn,startX:s.startX,endX:s.endX,startY:s.startY,endY:s.endY}}else{const{actualRow:s,actualColumn:i,startX:r,endX:o,startY:a,endY:l}=t;n={startRow:s,endRow:s,startColumn:i,endColumn:i,startX:r,endX:o,startY:a,endY:l}}return n}}getValue(){return{...this._selectionRenderModel.getValue(),style:this._currentStyle}}getRange(){return this._selectionRenderModel.getValue().rangeWithCoord}enableHelperSelection(){this._isHelperSelection=!0}disableHelperSelection(){this._isHelperSelection=!1}_updateHeaderBackground(t){const{startX:n,startY:s,endX:i,endY:r,rangeType:o}=this._selectionRenderModel,a=this._currentStyle,l=this._getScale(),{stroke:u,rowHeaderFill:d=a.rowHeaderFill,rowHeaderStroke:c=a.rowHeaderStroke,columnHeaderFill:h=a.columnHeaderFill,columnHeaderStroke:g=a.columnHeaderStroke}=t;let{rowHeaderStrokeWidth:m=a.rowHeaderStrokeWidth,columnHeaderStrokeWidth:p=a.columnHeaderStrokeWidth}=t;m/=l,p/=l;const f=this._rowHeaderWidth,v=this._columnHeaderHeight;if(this._highlightHeader&&v>0){let C=h;o===j.COLUMN&&(C=new Ls(u).setAlpha(Av).toString()),this._columnHeaderBackground.setProps({fill:C}),this._columnHeaderBackground.resize(i-n,v),this._columnHeaderBorder.setProps({fill:g}),this._columnHeaderBorder.transformByState({width:i-n,height:p,top:v-p+1/l}),this._columnHeaderGroup.show(),this._columnHeaderGroup.translate(n,0)}else this._columnHeaderGroup.hide();if(this._columnHeaderGroup.makeDirty(!0),this._highlightHeader&&f>0){let C=d;o===j.ROW&&(C=new Ls(u).setAlpha(Av).toString()),this._rowHeaderBackground.setProps({fill:C}),this._rowHeaderBackground.resize(f,r-s),this._rowHeaderBorder.setProps({fill:c}),this._rowHeaderBorder.transformByState({width:m,height:r-s,left:f-m+1/l}),this._rowHeaderGroup.show(),this._rowHeaderGroup.translate(0,s)}else this._rowHeaderGroup.hide();this._rowHeaderGroup.makeDirty(!0)}_updateBackgroundControl(t){const{startX:n,startY:s,endX:i,endY:r}=this._selectionRenderModel,o=this._getScale(),{fill:a=t.fill}=t;let{strokeWidth:l}=t;l/=o;const u=this._selectionRenderModel.highlightToSelection();if(!u){this._backgroundControlTop.resize(i-n,r-s),this._backgroundControlTop.setProps({fill:a}),this._backgroundControlBottom.resize(0,0),this._backgroundControlMiddleLeft.resize(0,0),this._backgroundControlMiddleRight.resize(0,0);return}const{startX:d,startY:c,endX:h,endY:g}=u,m=l/2,p={left:-m,top:-m,width:i-n+m*2,height:c-s+m};p.height<0&&(p.width=0,p.height=0),this._backgroundControlTop.transformByState(p);const f={left:-m,top:c-s,width:d-n+m,height:g-c};f.width<0&&(f.width=0,f.height=0),this._backgroundControlMiddleLeft.transformByState(f);const v={left:h-n-m,top:c-s,width:i-h+m*2,height:g-c};v.width<0&&(v.width=0,v.height=0),this._backgroundControlMiddleRight.transformByState(v);const C={left:-m,top:g-s,width:i-n+m*2,height:r-g+m};C.height<0&&(C.width=0,C.height=0),this._backgroundControlBottom.transformByState(C),this._backgroundControlTop.setProps({fill:a}),this._backgroundControlMiddleLeft.setProps({fill:a}),this._backgroundControlMiddleRight.setProps({fill:a}),this._backgroundControlBottom.setProps({fill:a})}_updateWidgets(t){const{startX:n,startY:s,endX:i,endY:r}=this._selectionRenderModel,{stroke:o=t.stroke,widgets:a=t.widgets,widgetStroke:l=t.widgetStroke}=t,u=this._getScale();let{widgetSize:d,widgetStrokeWidth:c}=t;d/=u,c/=u;const h={left:-d/2+c/2,center:(i-n)/2-d/2+c/2,right:i-n-d/2+c/2,top:-d/2,middle:(r-s)/2-d/2,bottom:r-s-d/2+c/2},g=d-c;this._widgetRects.forEach(m=>{m.setProps({fill:o,stroke:l})}),a.tl===!0?(this._topLeftWidget.transformByState({height:g,width:g,left:h.left,top:h.top,strokeWidth:c}),this._topLeftWidget.show()):this._topLeftWidget.hide(),a.tc===!0?(this._topCenterWidget.transformByState({height:g,width:g,left:h.center,top:h.top,strokeWidth:c}),this._topCenterWidget.show()):this._topCenterWidget.hide(),a.tr===!0?(this._topRightWidget.transformByState({height:g,width:g,left:h.right,top:h.top,strokeWidth:c}),this._topRightWidget.show()):this._topRightWidget.hide(),a.ml===!0?(this._middleLeftWidget.transformByState({height:g,width:g,left:h.left,top:h.middle,strokeWidth:c}),this._middleLeftWidget.show()):this._middleLeftWidget.hide(),a.mr===!0?(this._middleRightWidget.transformByState({height:g,width:g,left:h.right,top:h.middle,strokeWidth:c}),this._middleRightWidget.show()):this._middleRightWidget.hide(),a.bl===!0?(this._bottomLeftWidget.transformByState({height:g,width:g,left:h.left,top:h.bottom,strokeWidth:c}),this._bottomLeftWidget.show()):this._bottomLeftWidget.hide(),a.bc===!0?(this._bottomCenterWidget.transformByState({height:g,width:g,left:h.center,top:h.bottom,strokeWidth:c}),this._bottomCenterWidget.show()):this._bottomCenterWidget.hide(),a.br===!0?(this._bottomRightWidget.transformByState({height:g,width:g,left:h.right,top:h.bottom,strokeWidth:c}),this._bottomRightWidget.show()):this._bottomRightWidget.hide()}_hasWidgets(t){if(t==null)return!1;const n=Object.keys(t);if(n.length===0)return!1;for(const s of n)if(t[s]===!0)return!0;return!1}_getScale(){const{scaleX:t,scaleY:n}=this._scene.getAncestorScale();return Math.max(t,n)}_stopAntLineAnimation(){this._antLineOffset=0,JI(this._antRequestNewFrame)}_startAntLineAnimation(){const t=this._getScale();this._antLineOffset+=.6/t,this._antLineOffset>160/t&&(this._antLineOffset=0),this.dashedRect.setProps({strokeDashOffset:-this._antLineOffset}),this._antRequestNewFrame=e0(()=>{this._startAntLineAnimation()})}}var Sx=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},eg=(e,t)=>(n,s)=>t(n,s,e);const Vv=$S.MARK_SELECTION,Na=bn("univer.mark-selection-service");let $d=class extends ae{constructor(e,t,n){super(),y(this,"_shapeMap",new Map),this._currentService=e,this._renderManagerService=t,this._themeService=n}addShape(e,t=[],n=Vv){var s;const i=this._currentService.getCurrentUnitForType(A.UNIVER_SHEET),r=(s=i.getActiveSheet())==null?void 0:s.getSheetId();if(!r)return null;const o=hn(),a={selection:e,subUnitId:r,unitId:i.getUnitId(),zIndex:n,control:null,exits:t};return this._shapeMap.set(o,a),this.refreshShapes(),o}addShapeWithNoFresh(e,t=[],n=Vv){var s;const i=this._currentService.getCurrentUnitForType(A.UNIVER_SHEET),r=(s=i.getActiveSheet())==null?void 0:s.getSheetId();if(!r)return null;const o=hn();return this._shapeMap.set(o,{selection:e,subUnitId:r,unitId:i.getUnitId(),zIndex:n,control:null,exits:t}),o}refreshShapes(){var e;const t=this._currentService.getCurrentUnitForType(A.UNIVER_SHEET);if(!t)return;const n=t.getUnitId(),s=(e=t.getActiveSheet())==null?void 0:e.getSheetId();this._shapeMap.forEach(i=>{const{unitId:r,subUnitId:o,selection:a,control:l,zIndex:u}=i;if(l?.dispose(),r!==n||o!==s)return;const d=this._renderManagerService.getRenderById(r);if(!d)return;const c=d.with(Te).getCurrentSkeleton();if(!c)return;const{scene:h}=d,{rowHeaderWidth:g,columnHeaderHeight:m}=c,p=new cf(h,u,this._themeService,{enableAutoFill:!1,highlightHeader:!1,rowHeaderWidth:g,columnHeaderHeight:m}),f=In(a,c);p.updateRangeBySelectionWithCoord(f),i.control=p})}getShapeMap(){return this._shapeMap}removeShape(e){const t=this._shapeMap.get(e);if(!t)return;const{control:n}=t;n?.dispose(),this._shapeMap.delete(e)}removeAllShapes(){for(const e of this._shapeMap.values()){const{control:t}=e;t?.dispose()}this._shapeMap.clear()}};$d=Sx([eg(0,P),eg(1,ze),eg(2,V(xn))],$d);function nb(e){return{strokeWidth:1.5,stroke:e.getColorFromTheme("primary.600"),fill:"rgba(178, 178, 178, 0.10)",widgets:{},strokeDash:8}}function bx(e){if(e==null)return e;const t={};return e.p!==void 0&&(t.p=e.p===null?null:td(e.p)),e.s!==void 0&&(e.s===null||typeof e.s=="string"?t.s=e.s:t.s=td(e.s)),e.v!==void 0&&(t.v=e.v),e.t!==void 0&&(t.t=e.t),e.f!==void 0&&(t.f=e.f),e.ref!==void 0&&(t.ref=e.ref),e.xf!==void 0&&(t.xf=e.xf),e.si!==void 0&&(t.si=e.si),e.custom!==void 0&&(t.custom=e.custom===null?null:td(e.custom)),e.rowSpan!==void 0&&(t.rowSpan=e.rowSpan),e.colSpan!==void 0&&(t.colSpan=e.colSpan),e.plain!==void 0&&(t.plain=e.plain),t}const _x=10,Ix=6;function Rx(){return hn(Ix)}function yx(e){const t=e.match(/data-copy-id="([^\s]+)"/);return t&&t[1]?t[1]:null}class Mx{constructor(){y(this,"_cache",new $C(_x)),y(this,"_lastCopyId$",new xe(null)),y(this,"lastCopyId$",this._lastCopyId$.asObservable())}set(t,n){this._cache.set(t,n),this._lastCopyId$.next(t)}get(t){return this._cache.get(t)}del(t){this._cache.delete(t),this._lastCopyId$.getValue()===t&&this._lastCopyId$.next(null)}clear(){this._cache.clear(),this._lastCopyId$.next(null)}clearWithUnitId(t){this._cache.forEach((n,s)=>{n.unitId===t&&this._cache.delete(s)})}getLastCopyId(){return this._lastCopyId$.getValue()}}function Jd(e,t){const n=t??e.style,s={},i=e.tagName.toLowerCase();switch(i){case"b":case"em":case"strong":{s.bl=pe.TRUE;break}case"s":{s.st={s:pe.TRUE};break}case"u":{s.ul={s:pe.TRUE};break}case"i":{s.it=pe.TRUE;break}case"sub":case"sup":{s.va=i==="sup"?Yf.SUPERSCRIPT:Yf.SUBSCRIPT;break}}return Ex(n,s),s}function Ex(e,t){if(e instanceof CSSStyleDeclaration)for(let n=0;n<e.length;n++){const s=e[n],i=e.getPropertyValue(s);Hv(s,i,t)}else for(const n in e){const s=e[n];Hv(n,s,t)}}function Hv(e,t,n){switch(e){case"font-family":n.ff=t;break;case"font-size":{const s=Number.parseInt(t);Number.isNaN(s)||(t.endsWith("pt")?n.fs=s:t.endsWith("px")&&(n.fs=s*.75));break}case"font-style":t==="italic"&&(n.it=pe.TRUE);break;case"font-weight":{(Number(t)>400||t==="bold")&&(n.bl=pe.TRUE);break}case"text-decoration":{/underline/.test(t)?n.ul={s:pe.TRUE}:/overline/.test(t)?n.ol={s:pe.TRUE}:/line-through/.test(t)&&(n.st={s:pe.TRUE});break}case"color":{try{const s=new Ls(t);s.isValid&&(n.cl={rgb:s.toRgbString()})}catch{}break}case"background-color":{const s=new Ls(t);s.isValid&&(n.bg={rgb:s.toRgbString()});break}}}function sb(e){if(e.nodeType===Node.TEXT_NODE){e.textContent=(e.textContent||"").replace(/\r?\n[\t ]*/g," ");return}e.childNodes.forEach(sb)}function xx(e){const t=document.createElement("body");return t.innerHTML=e,sb(t),t}function ib(e){const t=e.style,n={};for(let s=0;s<t.length;s++){const i=t[s],r=t.getPropertyValue(i);switch(i){case"margin-top":{const o=Number.parseInt(r);n.spaceAbove={v:/pt/.test(r)?ov(o):o};break}case"margin-bottom":{const o=Number.parseInt(r);n.spaceBelow={v:/pt/.test(r)?ov(o):o};break}case"line-height":{const o=Number.parseFloat(r);n.lineSpacing=o;break}}}return Object.getOwnPropertyNames(n).length?n:null}function tg(e,t){const n=[];for(let s=0,i=e.length;s<i;s++)e[s]===SI.PARAGRAPH&&n.push({startIndex:s});return n}function Dv(e,t,n){var s,i,r;const o=t.length,a=((s=n?.length)!=null?s:0)===1&&n[0].st===0&&n[0].ed===o;return e.p?a&&(r=(i=e.p.body)==null?void 0:i.textRuns)!=null&&r.length?(e.p.body.textRuns=[],{...e,s:n[0].ts}):e:a?{...e,s:n[0].ts}:e}const Wv=["color","background","font-size","text-align","vertical-align","font-weight","font-style","font-family","text-decoration","white-space","word-wrap","border-left","border-right","border-top","border-bottom","--data-rotate"];function Lv(e,t){const n=e.tagName.toLowerCase();return typeof t=="string"?n===t:Array.isArray(t)?t.some(s=>s===n):t(e)}const rb=class ob{constructor(t){y(this,"_styleMap",new Map),y(this,"_styleCache",new Map),y(this,"_styleRules",[]),y(this,"_afterProcessRules",[]),y(this,"_dom",null),y(this,"_getCurrentSkeleton"),this._getCurrentSkeleton=t.getCurrentSkeleton}static use(t){if(this._pluginList.includes(t))throw new Error(`Univer paste plugin ${t.name} already added`);this._pluginList.push(t)}convert(t){const n=ob._pluginList.find(p=>p.checkPasteType(t));n&&(this._styleRules=[...n.stylesRules],this._afterProcessRules=[...n.afterProcessRules]);const s=new de;this._dom=xx(t);const i=this._dom.querySelector("style");if(i){const p=document.createElement("div"),f=p.attachShadow({mode:"open"});document.body.appendChild(p),f.appendChild(i);for(const v of i.sheet.cssRules){const C=v,w=C.selectorText,b=C.style;this._styleMap.set(w,b)}i.remove(),p.remove()}const r={dataStream:"",textRuns:[]},o=[],a=[],l=t.match(/<table\b[^>]*>([\s\S]*?)<\/table>/gi),u=[];this.process(null,this._dom.childNodes,r,u);const{paragraphs:d,dataStream:c,textRuns:h,payloads:g,customRanges:m}=r;if(d){const p=d.map(f=>f.startIndex+1);p.unshift(0);for(let f=0;f<p.length;f++){let v;if(f===p.length-1){if(v=`${c.substring(p[f])}\r
`,v===`\r
`)continue}else v=`${c.substring(p[f],p[f+1]-1)}\r
`;const C=[];h?.forEach(_=>{_.st>=p[f]&&_.ed<=p[f+1]&&C.push({st:_.st-p[f],ed:_.ed-p[f],ts:_.ts})});const w=[];m?.forEach(_=>{_.startIndex>=p[f]&&_.endIndex<=p[f+1]&&w.push({..._,startIndex:_.startIndex-p[f],endIndex:_.endIndex-p[f]})});const b=this._generateDocumentDataModelSnapshot({body:{dataStream:v,textRuns:C,paragraphs:tg(v),customRanges:w}}),I=Object.keys(s.getMatrix()).length===0;s.setValue(I?0:s.getLength(),0,{v,p:b}),o.push({})}}else if(c){const p=`${c}\r
`,f={dataStream:p,textRuns:h,paragraphs:tg(p),payloads:g,customRanges:m};if(!(m!=null&&m.length))s.setValue(0,0,Dv({v:c},c,h));else{const v=this._generateDocumentDataModelSnapshot({body:f});s.setValue(0,0,Dv({v:c,p:v},c,h))}o.push({})}return l&&l.forEach((p,f)=>{const v=s.getDataRange().endRow+1,{cellMatrix:C,rowProperties:w,colProperties:b}=this._parseTable(p,f);C&&C.forValue((I,_,R)=>{s.setValue(v+I,_,R)}),b&&a.push(...b),o.push(...w)}),this.dispose(),{rowProperties:o,colProperties:a,cellMatrix:s}}_getStyleBySelectorText(t,n){var s;return((s=this._styleMap.get(t))==null?void 0:s.getPropertyValue(n))||""}_getStyle(t,n){const s=Bv(n),i=t.style;let r="";for(let o=0;o<Wv.length;o++){const a=Wv[o];if(a==="background"){let u="";t.classList.forEach(c=>{u=this._getStyleBySelectorText(`.${c}`,"background-color")||this._getStyleBySelectorText(`.${c}`,a)});const d=i.getPropertyValue("background-color")||u||this._getStyleBySelectorText(`#${t.id}`,"background-color")||this._getStyleBySelectorText(`#${t.id}`,a)||this._getStyleBySelectorText(t.nodeName.toLowerCase(),a)||this._getStyleBySelectorText(t.nodeName,"background-color")||s["background-color"]||"";d&&(r+=`background:${d};`);continue}if(a==="text-decoration"){let u="";t.classList.forEach(c=>{u=this._getStyleBySelectorText(`.${c}`,"text-decoration-line")||this._getStyleBySelectorText(`.${c}`,a)});const d=i.getPropertyValue("text-decoration-line")||i.getPropertyValue("text-decoration")||u||this._getStyleBySelectorText(`#${t.id}`,"text-decoration-line")||this._getStyleBySelectorText(`#${t.id}`,a)||this._getStyleBySelectorText(t.nodeName.toLowerCase(),a)||this._getStyleBySelectorText(t.nodeName,"text-decoration-line")||s["text-decoration-line"]||"";d&&(r+=`text-decoration:${d};`);continue}let l="";t.classList.forEach(u=>{l=this._getStyleBySelectorText(`.${u}`,a)}),l=i.getPropertyValue(a)||this._getStyleBySelectorText(`#${t.id}`,a)||l||this._getStyleBySelectorText(t.nodeName.toLowerCase(),a)||s[a]||"",l&&(r+=`${a}:${l};`)}return r}_parseTable(t,n){var s,i;const r=new de,o=(s=Tx(t))!=null?s:[],{rowProperties:a=[]}=kx(t),l=this._parseTableByHtml(this._dom,n,(i=this._getCurrentSkeleton())==null?void 0:i.skeleton);return l&&l.forValue((u,d,c)=>{var h,g,m,p,f,v,C,w,b,I,_,R,M,x,N,T,O,k,D,B,W,F,K,J;let ee=jI(void 0,c.style);if((p=(m=(g=(h=c?.richTextParma)==null?void 0:h.p)==null?void 0:g.body)==null?void 0:m.textRuns)!=null&&p.length){const Ge=(v=(f=c?.richTextParma)==null?void 0:f.v)==null?void 0:v.length;for(let Ae=0;Ae<((I=(b=(w=(C=c?.richTextParma)==null?void 0:C.p)==null?void 0:w.body)==null?void 0:b.textRuns)==null?void 0:I.length);Ae++){const Ze=(M=(R=(_=c?.richTextParma)==null?void 0:_.p)==null?void 0:R.body)==null?void 0:M.textRuns[Ae];Ze.st===0&&Ze.ed===Ge&&(ee={...Ze.ts,...ee},(T=(N=(x=c?.richTextParma)==null?void 0:x.p)==null?void 0:N.body)==null||T.textRuns.splice(Ae,1),Ae--)}((B=(D=(k=(O=c?.richTextParma)==null?void 0:O.p)==null?void 0:k.body)==null?void 0:D.textRuns)==null?void 0:B.length)===0&&(c.content=(W=c?.richTextParma)==null?void 0:W.v,delete c.richTextParma)}const we=(J=(K=(F=c?.richTextParma)==null?void 0:F.p)==null?void 0:K.body)!=null&&J.textRuns?{v:c.richTextParma.v,p:c.richTextParma.p,s:ee,rowSpan:c.rowSpan,colSpan:c.colSpan}:{v:c.content,s:ee,rowSpan:c.rowSpan,colSpan:c.colSpan};r.setValue(u,d,we)}),{rowProperties:a,colProperties:o,cellMatrix:r}}_parseTableByHtml(t,n,s){var i,r;const o=new de,a=t.querySelectorAll("table")[n];if(!a)return o;const l=this._getStyle(a,""),u=a?.querySelectorAll("tr");for(let d=0;d<u.length;d++){const c=u[d],h=this._getStyle(c,l),g=c.querySelectorAll("td, th");let m=0;for(let p=0;p<g.length;){const f=g[p];let v="";const C=Number(f.getAttribute("rowSpan"))||1,w=Number(f.getAttribute("colSpan"))||1;if(v=this._getStyle(f,h),d>0){const R=o.getValue(d-1,m);if((i=R?.style)!=null&&i.includes("border-bottom")&&v.includes("border-top")){const M=jv(R.style,"border-bottom");M&&sv(M.substr(M.indexOf(":")+1))!=="none"&&(v=v.replace(/border-top:[^;]+;/,""))}}if(p>0){const R=o.getValue(d,m-1);if((r=R?.style)!=null&&r.includes("border-right")&&v.includes("border-left")){const M=jv(R.style,"border-right");M&&sv(M.substr(M.indexOf(":")+1))!=="none"&&(v=v.replace(/border-left:[^;]+;/,""))}}const{cellText:b,cellRichStyle:I}=this._getCellTextAndRichText(f,v,s),_={rowSpan:C,colSpan:w,content:b,style:v,richTextParma:{p:I,v:b}};if(o.getValue(d,m)){m+=1;continue}else C>1||w>1?Ux(o,v,_,{colSpan:w,rowSpan:C,rowIndex:d,colSetValueIndex:m}):o.setValue(d,m,_),m+=w,p++}}return o}_parseCellHtml(t,n,s,i=new Map,r){var o;for(const a of n)if(a.nodeType===Node.TEXT_NODE){const l=(o=a.nodeValue)==null?void 0:o.replace(/[\r\n]/g,"");let u;t&&i.has(t)&&(u=i.get(t)),s.dataStream+=l,u&&Object.getOwnPropertyNames(u).length&&s.textRuns.push({st:s.dataStream.length-l.length,ed:s.dataStream.length,ts:u})}else{if(a.nodeType===Node.COMMENT_NODE||a.nodeName==="STYLE")continue;if(a.nodeName.toLowerCase()==="br")s.paragraphs||(s.paragraphs=[]),s.paragraphs.push({startIndex:s.dataStream.length}),s.dataStream+="\r";else if(a.nodeType===Node.ELEMENT_NODE){const l=this._getStyle(a,r),u=t?i.get(t):{},d=Bv(l),c=Jd(a,d);i.set(a,{...u,...c});const{childNodes:h}=a;this._parseCellHtml(a,h,s,i,l)}}}_getCellTextAndRichText(t,n,s){var i;if(t.innerHTML.includes("mso-spacerun:yes")){const a=t.innerHTML.replace(/<span[^>]*mso-spacerun:yes[^>]*>[\s\S]*?<\/span>/gi,"").replace(/\s/g,""),l=lr(a);if(l&&l.z&&rr(l.v))return{cellText:a,cellRichStyle:void 0}}let r="",o;if(/<[^>]+>/.test(t.innerHTML)&&s){const a={dataStream:"",textRuns:[]};this._parseCellHtml(null,t.childNodes,a,void 0,n);const l=(i=s.getBlankCellDocumentModel())==null?void 0:i.documentModel,u=l?.getSnapshot(),d=`${a.dataStream}\r
`,c={...u,body:{dataStream:d,textRuns:a.textRuns,paragraphs:tg(d)}};l?.reset(c),o=l?.getSnapshot(),r=a.dataStream}else r=Px(t.innerHTML.replace(/[\r\n]/g,""));return{cellText:r,cellRichStyle:o}}_generateDocumentDataModelSnapshot(t){var n;const s=this._getCurrentSkeleton();if(s==null)return null;const{skeleton:i}=s,r=(n=i.getBlankCellDocumentModel())==null?void 0:n.documentModel,o={...r?.getSnapshot(),...t};return r?.reset(o),r?.getSnapshot()}process(t,n,s,i){var r,o,a;for(const l of n)if(l.nodeName.toLowerCase()==="table")i.push({index:((r=s?.paragraphs)==null?void 0:r.length)||0});else if(l.nodeType===Node.TEXT_NODE){if(((o=l.nodeValue)==null?void 0:o.trim())==="")continue;const u=(a=l.nodeValue)==null?void 0:a.replace(/[\r\n]/g,"");let d;t&&this._styleCache.has(t)&&(d=this._styleCache.get(t));const c={dataStream:"",textRuns:[]};s.dataStream+=u,c.dataStream+=u,d&&Object.getOwnPropertyNames(d).length&&(s.textRuns.push({st:s.dataStream.length-u.length,ed:s.dataStream.length,ts:d}),c.textRuns.push({st:s.dataStream.length-u.length,ed:s.dataStream.length,ts:d}))}else{if(fI.includes(l.nodeName.toLowerCase()))continue;if(l.nodeName.toLowerCase()==="br")s.paragraphs||(s.paragraphs=[]),s.paragraphs.push({startIndex:s.dataStream.length}),s.dataStream+="\r";else if(l.nodeType===Node.ELEMENT_NODE){if(l.nodeName==="STYLE")continue;const u=l,d=this._processBeforeLink(u,{body:s}),c=t?this._styleCache.get(t):{},h=this._styleRules.find(({filter:f})=>Lv(l,f)),g=h?h.getStyle(l):Jd(l);this._styleCache.set(l,{...c,...g});const{childNodes:m}=l;this.process(l,m,s,i);const p=this._afterProcessRules.find(({filter:f})=>Lv(l,f));p&&p.handler(s,l),this._processAfterLink(u,{body:s},d)}}}_processBeforeLink(t,n){return n.body.dataStream.length}_processAfterLink(t,n,s){var i,r;const o=n.body,a=t;a.tagName.toUpperCase()==="A"&&(o.customRanges=(i=o.customRanges)!=null?i:[],o.customRanges.push({startIndex:s,endIndex:o.dataStream.length-1,rangeId:(r=a.dataset.rangeid)!=null?r:hn(),rangeType:Bm.HYPERLINK,properties:{url:a.href}}))}dispose(){this._dom=null,this._styleCache.clear(),this._styleMap.clear()}};y(rb,"_pluginList",[]);let Ch=rb;function kx(e){const t=/<tr([\s\S]*?)>([\s\S]*?)<\/tr>/gi,n=e.matchAll(t);if(!n)return{rowProperties:[],rowCount:0};const s=Array.from(n).map(i=>ab(i[1])).map(i=>{if(!i.height){const r=i.style,o=r&&r.match(/height\s*:\s*(\d+(\.\d+)?)px/);i.height=`${o?Number.parseInt(o[1],10):bI}`}return i});return{rowProperties:s,rowCount:s.length}}function Bv(e){const t={};return e.split(";").forEach(n=>{const[s,i]=n.split(":");t[s]=i}),t}function ab(e){if(!e)return{};const t={},n=/([\w-]+)\s*=\s*(?:(['"])([^'"]*)\2|(\S+))/g;let s;for(;(s=n.exec(e))!==null;){const[,i,,r,o]=s,a=r!==void 0?r:o;t[i]=a}return t}function Tx(e){const t=/<colgroup([\s\S]*?)>(.*?)<\/colgroup>/,n=e.match(t),s=/<col([\s\S]*?)>/g;let i;if(n!=null&&n[2]?i=n[2].matchAll(s):i=e.matchAll(s),!i)return null;const r=Array.from(i).map(a=>ab(a[1])),o=[];return r.forEach(a=>{const l=Number(a.span);if(l)for(let u=0;u<l;u++){const d={...a};delete d.span,o.push(d)}else o.push(a)}),o}function Px(e){const t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&nbsp;":" "};return e.replace(/&lt;|&gt;|&amp;|&quot;|&#39;|&nbsp;|<br>/g,n=>t[n])}function jv(e,t){if(!e||!t)return null;const n=new RegExp(`(${t}\\s*:\\s*[^;]+);`,"i"),s=e.match(n);return s?s[1]:null}function Ux(e,t,n,s){const{rowSpan:i,colSpan:r,rowIndex:o,colSetValueIndex:a}=s;for(let l=o;l<o+i;l++)for(let u=a;u<a+r;u++)l===o&&u===a?e.setValue(l,u,{...n,style:t}):e.setValue(l,u,{style:t})}const Nx={name:"univer-doc-paste-plugin-lark",checkPasteType(e){return/lark-record-clipboard/i.test(e)},stylesRules:[{filter:["s"],getStyle(e){const t=Jd(e);return{st:{s:pe.TRUE},...t}}}],afterProcessRules:[{filter(e){return e.tagName==="DIV"&&/ace-line/i.test(e.className)},handler(e){e.paragraphs==null&&(e.paragraphs=[]),e.paragraphs.push({startIndex:e.dataStream.length}),e.dataStream+="\r"}}]},Ox={name:"univer-doc-paste-plugin-univer",checkPasteType(e){return/UniverNormal/i.test(e)},stylesRules:[],afterProcessRules:[{filter(e){return e.tagName==="P"&&/UniverNormal/i.test(e.className)},handler(e,t){e.paragraphs==null&&(e.paragraphs=[]);const n={startIndex:e.dataStream.length},s=ib(t);s&&(n.paragraphStyle=s),e.paragraphs.push(n),e.dataStream+="\r"}}]},Ax={name:"univer-doc-paste-plugin-word",checkPasteType(e){return/word|mso/i.test(e)},stylesRules:[{filter:["b"],getStyle(e){const t=Jd(e);return{bl:pe.TRUE,...t}}}],afterProcessRules:[{filter(e){return e.tagName==="P"&&/mso/i.test(e.className)},handler(e,t){e.paragraphs==null&&(e.paragraphs=[]);const n={startIndex:e.dataStream.length},s=ib(t);s&&(n.paragraphStyle=s),e.paragraphs.push(n),e.dataStream+="\r"}}]};var si=(e=>(e.COPY="COPY",e.CUT="CUT",e))(si||{});function Vx(e,t,n,s,i){const r=n.map(u=>{var d;return(d=u.onCopyRow)==null?void 0:d.call(u,e)}).filter(u=>!!u),o=hf(r),a=gf(o),l=t.map(u=>{if(!i.has(`${e}-${u}`)){const d=s.getValue(e,u);if(d!=null&&d.rowSpan&&d!=null&&d.colSpan)for(let c=e;c<e+d.rowSpan;c++)for(let h=u;h<u+d.colSpan;h++)i.add(`${c}-${h}`);return Hx(e,u,n,s)}return null}).filter(u=>!!u).join("");return`<tr${a}>${l}</tr>`}function Hx(e,t,n,s){const i=s.getValue(e,t),r=n.map(u=>{var d;return(d=u.onCopyCellStyle)==null?void 0:d.call(u,e,t,i?.rowSpan,i?.colSpan)}).filter(u=>!!u),o=hf(r),a=gf(o),l=n.reduce((u,d)=>{var c;return u||((c=d.onCopyCellContent)==null?void 0:c.call(d,e,t))||""},"");return`<td${a}>${l}</td>`}function Dx(e,t){return`<colgroup>${e.map(n=>{const s=t.map(r=>{var o;return(o=r.onCopyColumn)==null?void 0:o.call(r,n)}).filter(r=>!!r),i=hf(s);return`<col ${gf(i)} />`}).join("")}</colgroup>`}function hf(e){return e.reduce((t,n)=>(Object.keys(n).forEach(s=>{t[s]?t[s]+=`;${n[s]}`:t[s]=n[s]}),t),{})}function gf(e){return Object.keys(e).reduce((t,n)=>`${t} ${n}="${e[n]}"`,"")}class Wx{convert(t,n,s,i){const{cols:r,rows:o}=n;if(!r.length)return"";const a=Dx(r,s),l=[],u=new Set;return o.forEach(d=>{l.push(Vx(d,r,s,t,u))}),`<google-sheets-html-origin><table data-copy-id="${i}" xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" cellpadding="0" dir="ltr" style="table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none">${a}
<tbody>${l.join("")}</tbody></table>`}}const NP=(e,t,n=!1)=>{const s=c=>c.endRow-c.startRow+1,i=c=>c.endColumn-c.startColumn+1,r=s(t)%s(e),o=i(t)%i(e),a={startRow:0,endRow:s(e)-1,startColumn:0,endColumn:i(e)-1},l=Math.floor(s(t)/s(e)),u=Math.floor(i(t)/i(e)),d=[];if(!r&&!o)for(let c=1;c<=l;c++)for(let h=1;h<=u;h++){const g=s(e)*(c-1),m=i(e)*(h-1),p={startRow:g+t.startRow,endRow:g+t.startRow,startColumn:m+t.startColumn,endColumn:m+t.startColumn};d.push({repeatRelativeRange:a,startRange:p})}else if(!r&&o&&!n)for(let c=1;c<=l;c++){const h=s(e)*(c-1),g=0,m={startRow:h+t.startRow,endRow:h+t.startRow,startColumn:g+t.startColumn,endColumn:g+t.startColumn};d.push({repeatRelativeRange:a,startRange:m})}else if(r&&!o&&!n)for(let c=1;c<=u;c++){const h=i(e)*(c-1),g={startRow:0+t.startRow,endRow:0+t.startRow,startColumn:h+t.startColumn,endColumn:h+t.startColumn};d.push({repeatRelativeRange:a,startRange:g})}else{const c={startRow:t.startRow,endRow:t.startRow,startColumn:t.startColumn,endColumn:t.startColumn};d.push({startRange:c,repeatRelativeRange:a})}return d};function Fv(e){return e?[/<td[^>]*class=".*?xl.*?"[^>]*>/i,/xmlns:x="urn:schemas-microsoft-com:office:excel"/i,/ProgId="Excel.Sheet"/i,/xmlns:o="urn:schemas-microsoft-com:office:office"/i,/@mso-|mso-excel/i,/<x:ExcelWorkbook>/i].some(t=>t.test(e)):!1}function Lx(e){if(!e)return!1;const t=/<img[^>]*src\s*=\s*["']data:image\/[^;]+;base64,[^"']*["'][^>]*>/i;return(e.match(t)||[]).length>0}function Bx(...e){if(e.length===1)return e[0];const t=new de;return e.forEach(n=>{n&&new de(n).forValue((s,i,r)=>{t.setValue(s,i,{...t.getValue(s,i),...r})})}),t.getMatrix()}function jx(e,t){return e.id===t.id&&e.params.unitId===t.params.unitId&&e.params.subUnitId===t.params.subUnitId}function zv(e){const t=[];for(let n=0;n<e.length;){let s=1;if(e[n].id===le.id){const i=e[n],r=[i];for(;n+s<e.length&&jx(i,e[n+s]);)r.push(e[n+s]),s+=1;const o=Bx(...r.map(a=>a.params.cellValue||{}));t.push({...i,params:{...i.params,cellValue:o}})}else t.push(e[n]);n+=s}return t}function Xv(e,t={}){const{maxCellsPerChunk:n=2500,threshold:s=6e3,maxChunks:i=10}=t;if(e.id!==le.id)return[e];const{cellValue:r}=e.params;if(!r)return[e];const o=new de(r);let a=0,l=1/0,u=-1/0,d=1/0,c=-1/0;if(o.forValue((f,v)=>{a++,l=Math.min(l,f),u=Math.max(u,f),d=Math.min(d,v),c=Math.max(c,v)}),l===1/0||a<=s)return[e];const h=[],g=c-d+1;let m=Math.max(1,Math.floor(n/g));const p=u-l+1;Math.ceil(p/m)>i&&(m=Math.ceil(p/i));for(let f=l;f<=u;f+=m){const v=Math.min(f+m-1,u),C=new de;let w=!1;for(let b=f;b<=v;b++)for(let I=d;I<=c;I++){const _=o.getValue(b,I);_!==void 0&&(C.setValue(b,I,_),w=!0)}w&&h.push({...e,params:{...e.params,cellValue:C.getMatrix(),__splitChunk__:!0}})}return h.length>0?h:[e]}function ng(e,t){const{startRow:n,endRow:s,startColumn:i,endColumn:r}=e;for(let o=n;o<=s;o++)for(let a=i;a<=r;a++)if(t.rows.includes(o)&&t.cols.includes(a))return!0}function Yv(e,t){const{startRow:n,endRow:s,startColumn:i,endColumn:r}=t;for(let o=n;o<=s;o++)if(!e.rows.includes(o))return!1;for(let o=i;o<=r;o++)if(!e.cols.includes(o))return!1;return!0}function Fx(e){const t=e.trim().split(`
`);let n="<table>";return t.forEach(s=>{const i=s.split("	");n+="<tr>",i.forEach(r=>{n+=`<td>${r}</td>`}),n+="</tr>"}),n+="</table>",n}var zx=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Nn=(e,t)=>(n,s)=>t(n,s,e);const yr={DEFAULT_COPY:"default-copy",SPECIAL_COPY_FORMULA_ONLY:"special-copy-formula-only"},_t={DEFAULT_PASTE:"default-paste",DEFAULT_PASTE_ROWS:"default-paste-rows",DEFAULT_PASTE_COLUMNS:"default-paste-columns",SPECIAL_PASTE_VALUE:"special-paste-value",SPECIAL_PASTE_FORMAT:"special-paste-format",SPECIAL_PASTE_COL_WIDTH:"special-paste-col-width",SPECIAL_PASTE_BESIDES_BORDER:"special-paste-besides-border",SPECIAL_PASTE_FORMULA:"special-paste-formula"},OP={...yr,..._t},Xx={[YI]:"png",[XI]:"jpg",[zI]:"webp",[FI]:"bmp"};Ch.use(Ax);Ch.use(Nx);Ch.use(Ox);const hs=bn("sheet.clipboard-service");let ec=class extends ae{constructor(e,t,n,s,i,r,o,a,l,u,d,c,h,g){super(),y(this,"_clipboardHooks",[]),y(this,"_clipboardHooks$",new xe([])),y(this,"clipboardHooks$",this._clipboardHooks$.asObservable()),y(this,"_htmlToUSM"),y(this,"_usmToHtml"),y(this,"_copyContentCache"),y(this,"_copyMarkId",null),y(this,"_pasteOptionsCache$",new xe(null)),y(this,"pasteOptionsCache$",this._pasteOptionsCache$.asObservable()),y(this,"_showMenu$",new xe(!1)),y(this,"showMenu$",this._showMenu$.asObservable()),this._logService=e,this._univerInstanceService=t,this._selectionManagerService=n,this._clipboardInterfaceService=s,this._undoRedoService=i,this._commandService=r,this._markSelectionService=o,this._notificationService=a,this._platformService=l,this._renderManagerService=u,this._themeService=d,this._localeService=c,this._errorService=h,this._injector=g,this._htmlToUSM=new Ch({getCurrentSkeleton:()=>{var m;return(m=Gm(A.UNIVER_SHEET,Te,this._univerInstanceService,this._renderManagerService))==null?void 0:m.getCurrentParam()}}),this._usmToHtml=new Wx,this._copyContentCache=new Mx,this.disposeWithMe(this._htmlToUSM),this._initUnitDisposed()}setShowMenu(e){this._showMenu$.next(e)}getPasteMenuVisible(){return this._showMenu$.getValue()}getPasteOptionsCache(){return this._pasteOptionsCache$.getValue()}copyContentCache(){return this._copyContentCache}generateCopyContent(e,t,n,s){const{copyType:i=si.COPY,copyHookType:r=yr.DEFAULT_COPY}=s||{};let o=this._clipboardHooks;r===yr.SPECIAL_COPY_FORMULA_ONLY&&(o=this._clipboardHooks.filter(l=>l.id===r)),o.forEach(l=>{var u;return(u=l.onBeforeCopy)==null?void 0:u.call(l,e,t,n,i)});const a=this._generateCopyContent(e,t,n,o,r);return o.forEach(l=>{var u;return(u=l.onAfterCopy)==null?void 0:u.call(l)}),a}async copy(e){const t=this._selectionManagerService.getCurrentLastSelection();if(!t)return!1;const n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),s=n?.getActiveSheet();if(!n||!s)return!1;const i=n.getUnitId(),r=s.getSheetId(),{copyType:o=si.COPY,copyHookType:a=yr.DEFAULT_COPY}=e||{},l=this.generateCopyContent(i,r,t.range,{copyType:o,copyHookType:a});if(!l)return!1;const{html:u,plain:d,matrixFragment:c,copyId:h,discreteRange:g}=l;this._copyContentCache.set(h,{unitId:n.getUnitId(),subUnitId:s.getSheetId(),range:g,matrix:c,copyType:o}),await this._clipboardInterfaceService.write(d,u),this._markSelectionService.removeAllShapes();const m=nb(this._themeService);return this._copyMarkId=this._markSelectionService.addShape({...t,style:m}),!0}async cut(){return this.copy({copyType:si.CUT})}async paste(e,t=_t.DEFAULT_PASTE){const n=e.types,s=n.indexOf($f)!==-1?await e.getType($f).then(a=>a&&a.text()):"",i=n.indexOf(Jf)!==-1?await e.getType(Jf).then(a=>a&&a.text()):"",r=n.findIndex(a=>AI.has(a)),o=r===-1||!Lx(i);if(i&&o)return this._platformService.isWindows&&Fv(i)&&this._notificationService.show({type:"warning",title:this._localeService.t("clipboard.shortCutNotify.title"),content:this._localeService.t("clipboard.shortCutNotify.useShortCutInstead")}),this._pasteHTML(i,t);if(r!==-1){const a=n[r],l=await e.getType(a);if(l){const u=Xx[a],d=new File([l],`clipboard-image.${u}`,{type:a});return this._pasteFiles([d],t)}}return s?this._pastePlainText(s,t):(this._logService.error("[SheetClipboardService]","No valid data on clipboard"),!1)}async pasteByCopyId(e,t=_t.DEFAULT_PASTE){return this._pasteInternal(e,t)}async legacyPaste(e,t,n){const s=Fv(e??"");return n&&!s?this._pasteFiles(n,_t.DEFAULT_PASTE):e?this._pasteHTML(e,_t.DEFAULT_PASTE):t?/[\n\t]/.test(t)?this._pasteHTML(Fx(t),_t.DEFAULT_PASTE):this._pastePlainText(t,_t.DEFAULT_PASTE):this._pasteUnrecognized()}rePasteWithPasteType(e){const t=this._pasteOptionsCache$.getValue();if(!t)return!1;const n=this._injector.get(ce),s=n.pitchTopUndoElement();s&&fe(s.undoMutations,this._commandService)&&n.popUndoToRedo();const{cellMatrix:i,rowProperties:r=[],colProperties:o=[],source:a,target:l}=t;return this._pasteUSM({cellMatrix:i,colProperties:o,rowProperties:r},l,_t[e],a),!0}updatePasteOptionsCache(e){this._pasteOptionsCache$.next(e)}addClipboardHook(e){if(this._clipboardHooks.findIndex(n=>n.id===e.id)!==-1)return this._logService.error("[SheetClipboardService]","hook already exists",e.id),{dispose:()=>{}};const t=this._clipboardHooks.findIndex(n=>{const s=n.priority||0;return(e.priority||0)<s});return this._clipboardHooks.splice(t!==-1?t:this._clipboardHooks.length,0,e),this._notifyClipboardHook(),He(()=>{const n=this._clipboardHooks.indexOf(e);n>-1&&(this._clipboardHooks.splice(n,1),this._notifyClipboardHook())})}getClipboardHooks(){return this._clipboardHooks}_generateCopyContent(e,t,n,s,i=yr.DEFAULT_COPY){var r;const o=this._univerInstanceService.getUniverSheetInstance(e),a=o?.getSheetBySheetId(t);if(!o||!a)return null;const l=s.reduce((_,R)=>{var M;const x=(M=R.getFilteredOutRows)==null?void 0:M.call(R,e,t,n);return x?.forEach(N=>_.add(N)),_},new Set),{startColumn:u,startRow:d,endColumn:c,endRow:h}=n;let g=d;const m=a.getMatrixWithMergedCells(d,u,h,c,sw.Both),p=new de,f=new de,v={rows:[],cols:[]},C=i===yr.SPECIAL_COPY_FORMULA_ONLY?s.find(_=>_.handleMatrixOnCell):void 0;for(let _=d;_<=h;_++)if(!l.has(_)){v.rows.push(_);for(let R=u;R<=c;R++){if(C){(r=C.handleMatrixOnCell)==null||r.call(C,_,R,g-d,R-u,m,p,f);continue}const M=m.getValue(_,R);if(M){const x=lI(M);f.setValue(g-d,R-u,{...Ba(),...x}),delete x.displayV,p.setValue(g-d,R-u,{...Ba(),...x})}else f.setValue(g-d,R-u,Ba()),p.setValue(g-d,R-u,Ba()),m.setValue(_,R,Ba())}g+=1}for(let _=u;_<=c;_++)v.cols.push(_);const w=Rx(),b=this._usmToHtml.convert(m,v,s,w),I=Yx(f);return{copyId:w,plain:I,html:b,matrixFragment:p,discreteRange:v}}_notifyClipboardHook(){this._clipboardHooks$.next(this._clipboardHooks)}async _executePaste(e){const t=this._getPastingTarget();if(!t.subUnitId||!t.selection)return!1;const n=this._injector.invoke(d=>cl(t.selection.range,d,t.unitId,t.subUnitId));if(!n)return!1;const{unitId:s,subUnitId:i}=t,r=this._clipboardHooks,o=[];if(r.some(d=>{var c;return o.push(d)&&((c=d.onBeforePaste)==null?void 0:c.call(d,{unitId:s,subUnitId:i,range:n}))===!1}))return o.forEach(d=>{var c;return(c=d.onAfterPaste)==null?void 0:c.call(d,!1)}),!1;const a=[],l=[];o.forEach(d=>{const c=e(d,{unitId:s,subUnitId:i,range:n});c&&(a.push(...c.redos),l.push(...c.undos))});const u=a.every(d=>this._commandService.executeCommand(d.id,d.params));return u&&this._undoRedoService.pushUndoRedo({unitID:this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),undoMutations:l,redoMutations:a}),u}async _pasteFiles(e,t){return this._executePaste((n,s)=>{var i;return(i=n.onPasteFiles)==null?void 0:i.call(n,s,e,{pasteType:t})})}async _pastePlainText(e,t){return this._executePaste((n,s)=>{var i;return(i=n.onPastePlainText)==null?void 0:i.call(n,s,e,{pasteType:t})})}_pasteUnrecognized(){return this._executePaste((e,t)=>{var n;return(n=e.onPasteUnrecognized)==null?void 0:n.call(e,t)})}async _pasteHTML(e,t){const n=yx(e);return n&&this._copyContentCache.get(n)?this._pasteInternal(n,t):this._pasteExternal(e,t)}async _pasteExternal(e,t){var n;const{rowProperties:s,colProperties:i,cellMatrix:r}=this._htmlToUSM.convert(e);if(!r)return!1;const o=this._getPastedRange(r);if(!o)return!1;const a=(n=this._univerInstanceService.getUniverSheetInstance(o.unitId))==null?void 0:n.getSheetBySheetId(o.subUnitId);if(!a)return!1;const l=a?.getMergeData();return l.length&&l.some(u=>ng(u,o.pastedRange)&&!Yv(o.pastedRange,u))?(this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")),!1):this._pasteUSM({rowProperties:s,colProperties:i,cellMatrix:r},o,t)}async _pasteInternal(e,t){var n,s;const i=this._copyContentCache.get(e),{range:r,matrix:o,unitId:a,subUnitId:l}=i||{};if(!o||!i||!r||!a||!l)return!1;const{mapFunc:u}=Zr([r]),d=(n=this._univerInstanceService.getUniverSheetInstance(a))==null?void 0:n.getSheetBySheetId(l),c=new de;o.forValue((_,R,M)=>{const{row:x,col:N}=u(_,R),T=d?.getCellRaw(x,N),O=d?.getComposedCellStyleByCellData(x,N,T),k=bx(M);if(k.s=O,c.setValue(_,R,k),M.colSpan||M.rowSpan)for(let D=0;D<M.rowSpan;D++)for(let B=0;B<M.colSpan;B++){if(D===0&&B===0)continue;const W=_+D,F=R+B;c.setValue(W,F,{s:O})}});const h=this._getPastedRange(c);if(!h)return!1;const g=(s=this._univerInstanceService.getUniverSheetInstance(h.unitId))==null?void 0:s.getSheetBySheetId(h.subUnitId);if(!g)return!1;const m=g?.getMergeData();if(m&&m.some(_=>ng(_,h.pastedRange)&&!Yv(h.pastedRange,_)))return this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")),!1;const p=this._univerInstanceService.getUnit(a);if(!p)return!1;const f=p.getSheetBySheetId(l);if(!f)return!1;const v=f.getColumnManager(),C=f.getRowManager(),w=[],b=[];if(r.cols.forEach(_=>{w.push({width:`${v.getColumnWidth(_)}`})}),r.rows.forEach(_=>{b.push({height:`${C.getRowHeight(_)}`})}),i.copyType===si.CUT){const _=h.pastedRange.rows[0],R=r.rows[r.rows.length-1]-r.rows[0]+_;h.pastedRange.rows=Array.from(new Array(R+1).keys()).slice(_)}const I=this._pasteUSM({cellMatrix:c,colProperties:w,rowProperties:b},h,t,{range:r,unitId:i.unitId,subUnitId:i.subUnitId,copyType:i.copyType,copyId:e});return i.copyType===si.CUT&&(this._copyContentCache.set(e,{...i,matrix:null}),this._copyMarkId&&this._markSelectionService.removeShape(this._copyMarkId),this._copyMarkId=null),I}_pasteUSM(e,t,n,s){const{rowProperties:i,colProperties:r,cellMatrix:o}=e,{unitId:a,subUnitId:l,pastedRange:u}=t,d=this._clipboardHooks,c=[];if(d.some(C=>{var w;return c.push(C)&&((w=C.onBeforePaste)==null?void 0:w.call(C,{unitId:a,subUnitId:l,range:u}))===!1}))return c.forEach(C=>{var w;return(w=C.onAfterPaste)==null?void 0:w.call(C,!1)}),!1;if(!o)return!1;const h=s?{unitId:s.unitId,subUnitId:s.subUnitId,range:s.range}:null,g={copyType:s?.copyType||si.COPY,copyId:s?.copyId,pasteType:n};let m=[],p=[];const f=c.filter(C=>!C.specialPasteInfo&&C.id!==_t.DEFAULT_PASTE||n===C.id);if(f.forEach(C=>{var w,b,I;const _=(w=C.onPasteRows)==null?void 0:w.call(C,{range:u,unitId:a,subUnitId:l});_&&(m.push(..._.redos),p.push(..._.undos));const R=(b=C.onPasteColumns)==null?void 0:b.call(C,{range:u,unitId:a,subUnitId:l},r||[],{pasteType:n});R&&(m.push(...R.redos),p.push(...R.undos));const M=(I=C.onPasteCells)==null?void 0:I.call(C,h,{range:u,unitId:a,subUnitId:l},o,g);M&&(m.push(...M.redos),p.push(...M.undos))}),g.copyType===si.COPY){const C=this._getSetSelectionOperation(a,l,u,o,n);C&&m.push(C)}m=zv(m),p=zv(p),m=m.flatMap(C=>Xv(C,{threshold:2e4,maxCellsPerChunk:1e4})),p=p.flatMap(C=>Xv(C,{threshold:2e4,maxCellsPerChunk:1e4})),p.push({id:lt.id,params:{unitId:t.unitId,subUnitId:t.subUnitId}}),this._logService.log("[SheetClipboardService]","pasting mutations",{undoMutationsInfo:p,redoMutationsInfo:m});const v=m.every(C=>this._commandService.syncExecuteCommand(C.id,C.params));if(v){const C=this._getPastedRangeAutoHeightMutation(a,l,u);C&&(this._commandService.syncExecuteCommand(C.redo.id,C.redo.params),m.push(C.redo),p.unshift(C.undo)),this._undoRedoService.pushUndoRedo({unitID:a,undoMutations:p,redoMutations:m}),this.updatePasteOptionsCache({target:{pastedRange:u,unitId:a,subUnitId:l},cellMatrix:o,rowProperties:i,colProperties:r,pasteType:n,source:s}),this.setShowMenu(!0)}return f.forEach(C=>{var w;return(w=C.onAfterPaste)==null?void 0:w.call(C,v)}),v}_getPastedRangeAutoHeightMutation(e,t,n){var s,i;const r=(s=this._univerInstanceService.getUnit(e,A.UNIVER_SHEET))==null?void 0:s.getSheetBySheetId(t);if(!r)return null;const o=(i=this._renderManagerService.getRenderById(e))==null?void 0:i.with(Te).ensureSkeleton(t);if(!o)return null;const a=r.getRowManager(),l=r.getConfig().defaultRowHeight,{rows:u,cols:d}=n,c=u[0],h=u[u.length-1],g=d[0],m=d[d.length-1],p=[];for(let f=c;f<=h;f++)if(!a.getRow(f)){const v=o.calculateAutoHeightInRange([{startRow:f,endRow:f,startColumn:g,endColumn:m}]).filter(C=>C.autoHeight!==l);p.push(...v)}if(p.length>0){const f={unitId:e,subUnitId:t,rowsAutoHeightInfo:p};return{redo:{id:ds.id,params:f},undo:{id:ds.id,params:op(f,r)}}}return null}_getSetSelectionOperation(e,t,n,s,i){var r;const o=(r=this._univerInstanceService.getUniverSheetInstance(e))==null?void 0:r.getSheetBySheetId(t);if(!o)return null;const{rows:a,cols:l}=n,u=a[0],d=l[0],c=a[a.length-1],h=l[l.length-1],g=Ht({startRow:u,startColumn:d},o),m=s.getValue(0,0),p=m?.rowSpan||1,f=m?.colSpan||1;if((i===_t.DEFAULT_PASTE||i===_t.SPECIAL_PASTE_BESIDES_BORDER||i===_t.SPECIAL_PASTE_FORMAT)&&(p>1||f>1)){const C={startRow:u,endRow:u+p-1,startColumn:d,endColumn:d+f-1};g.startRow=C.startRow,g.endRow=C.endRow,g.startColumn=C.startColumn,g.endColumn=C.endColumn,g.isMerged=!0,g.isMergedMainCell=!0}const v={unitId:e,subUnitId:t,selections:[{range:{startRow:u,endRow:c,startColumn:d,endColumn:h},primary:g,style:null}]};return{id:me.id,params:v}}_getPastingTarget(){const e=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),t=e.getActiveSheet(),n=this._selectionManagerService.getCurrentLastSelection();return{unitId:e.getUnitId(),subUnitId:t?.getSheetId(),selection:n}}_transformPastedData(e,t,n){const s=this._getPastingTarget(),{selection:i,unitId:r,subUnitId:o}=s;if(!o||!i)return null;const a=this._injector.invoke(M=>cl(i.range,M,r,o));if(!a)return null;const{ranges:[l],mapFunc:u}=Zr([a]),{startRow:d,startColumn:c,endRow:h,endColumn:g}=l,m=h-d+1,p=g-c+1,f=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),v=f?.getActiveSheet();if(!v)return null;const C=v.getMergeData().filter(M=>a.rows.includes(M.startRow)&&a.cols.includes(M.startColumn)),w=C[0];let b=0,I=0,_=0,R=0;if(w&&(b=w.startRow,I=w.startColumn,_=w.endRow,R=w.endColumn),m%e===0&&p%t===0)if(C.length>0&&(m!==e||p!==t))if(b===a.rows[0]&&I===a.cols[0]&&_===a.rows[m-1]&&R===a.cols[p-1])if(Qx(n))for(let M=0;M<m;M++)for(let x=0;x<p;x++){const N=n.getValue(M%e,x%t);N&&n.setValue(M,x,N)}else n.forValue((M,x,N)=>{N.s=null,delete N.colSpan,delete N.rowSpan});else for(let M=0;M<m;M++)for(let x=0;x<p;x++){const N=n.getValue(M%e,x%t);N&&n.setValue(M,x,N)}else for(let M=0;M<m;M++)for(let x=0;x<p;x++){const N=n.getValue(M%e,x%t);N&&n.setValue(M,x,N)}else if(C.length>0){const{row:M,col:x}=u(d,c);if(this._topLeftCellsMatch(e,t,{topRow:M,leftCol:x})){const N=this._expandOrShrinkRowsCols(r,o,a,t,e);a.rows=N.rows,a.cols=N.cols}else{if(h>w.endRow||g>w.endColumn)return null;n.forValue((N,T,O)=>{O.s=null,delete O.colSpan,delete O.rowSpan})}}else{const M=this._expandOrShrinkRowsCols(r,o,a,t,e);a.rows=M.rows,a.cols=M.cols}return{pastedRange:a,unitId:r,subUnitId:o}}_getPastedRange(e){var t;const n=this._getPastingTarget(),{selection:s,unitId:i,subUnitId:r}=n;if(!r||!s)return null;const o=this._injector.invoke(C=>cl(s.range,C,i,r));if(!o)return null;const{startColumn:a,endColumn:l,startRow:u,endRow:d}=e.getDataRange(),c=d-u+1,h=l-a+1;if(c<=0||h<=0)return null;const g=o.rows.length,m=o.cols.length,p=(t=this._univerInstanceService.getUniverSheetInstance(i))==null?void 0:t.getSheetBySheetId(r);if(!p)return null;const f=p?.getMergeData();if(g%c===0&&m%h===0&&!f?.some(C=>ng(C,o))){for(let C=0;C<g;C++)for(let w=0;w<m;w++){const b=e.getValue(C%c,w%h);b&&e.setValue(C,w,b)}return{pastedRange:o,unitId:i,subUnitId:r}}const v=this._expandOrShrinkRowsCols(i,r,o,h,c);return o.rows=v.rows,o.cols=v.cols,{pastedRange:o,unitId:i,subUnitId:r}}_expandOrShrinkRowsCols(e,t,n,s,i){const{rows:r,cols:o}=n,a=this._univerInstanceService.getUniverSheetInstance(e),l=a?.getSheetBySheetId(t);let u,d;if(r.length>=i)u=r.slice(0,i);else{u=r.slice(0);let c=r[r.length-1]+1;for(;u.length<i;)l.getRowFiltered(c)||u.push(c),c++}if(o.length>=s)d=o.slice(0,s);else{d=o.slice(0);let c=o[o.length-1]+1;for(;d.length<s;)d.push(c),c++}return{rows:u,cols:d}}_topLeftCellsMatch(e,t,n){const s=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),i=s?.getActiveSheet();if(!i)return!1;const{topRow:r,leftCol:o}=n,a=Gx(r+e-1,o,o+t-1,i),l=qx(o+t-1,r,r+e-1,i);return!a&&!l}removeMarkSelection(){this._copyMarkId&&(this._markSelectionService.removeShape(this._copyMarkId),this._copyMarkId=null)}_initUnitDisposed(){this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(A.UNIVER_SHEET).subscribe(e=>{e&&this.copyContentCache().clearWithUnitId(e.getUnitId())}))}disposePasteOptionsCache(){this.setShowMenu(!1),this.updatePasteOptionsCache(null)}};ec=zx([Nn(0,ar),Nn(1,P),Nn(2,V(q)),Nn(3,zc),Nn(4,ce),Nn(5,U),Nn(6,Na),Nn(7,qI),Nn(8,QI),Nn(9,ze),Nn(10,V(xn)),Nn(11,V(Oe)),Nn(12,V(so)),Nn(13,V(pt))],ec);function Yx(e){let t="";const n=e.getLength();return e.forRow((s,i)=>{const r=[];i.forEach(o=>{const a=e.getValue(s,o);if(a){const l=Zx(a);r.push(l)}}),t+=r.join("	"),s!==n-1&&(t+=`
`)}),t}function Zx(e){return wI(e.displayV)?e.displayV:dw(e)}function Gx(e,t,n,s){return s.getMergeData().some(i=>i.startRow<=e&&e<i.endRow&&t<=i.startColumn&&i.startColumn<=n)}function qx(e,t,n,s){return s.getMergeData().some(i=>i.startColumn<=e&&e<i.endColumn&&t<=i.startRow&&i.startRow<=n)}function Qx(e){let t=0;return e.forValue((n,s,i)=>{if(i&&t++,t>1)return!1}),t>1}const mf=998,Ds={id:kI.id,name:"sheet.command.copy",type:H.COMMAND,multi:!0,priority:mf,preconditions:af,handler:async e=>e.get(hs).copy()},Tr={id:hw.id,name:"sheet.command.cut",type:H.COMMAND,multi:!0,priority:mf,preconditions:af,handler:async e=>e.get(hs).cut()},Ws={id:TI.id,type:H.COMMAND,multi:!0,name:"sheet.command.paste",priority:mf,preconditions:af,handler:async(e,t)=>{const n=e.get(hs),s=e.get(zc);if(s.supportClipboard){const r=await s.read();if(r.length!==0)return n.paste(r[0],t?.value)}const i=n.copyContentCache().getLastCopyId();return i?(console.warn("Since the current environment does not support the Clipboard API, we will use the internal copyId to paste the content."),n.pasteByCopyId(i,t?.value)):!1}},pm={id:PI,type:H.COMMAND,handler:async(e,t)=>{const n=e.get(hs),{htmlContent:s,textContent:i,files:r}=t;return n.legacyPaste(s,i,r),!0}},ml={id:"sheet.command.paste-value",type:H.COMMAND,handler:async e=>e.get(U).executeCommand(Ws.id,{value:_t.SPECIAL_PASTE_VALUE})},pl={id:"sheet.command.paste-format",type:H.COMMAND,handler:async e=>e.get(U).executeCommand(Ws.id,{value:_t.SPECIAL_PASTE_FORMAT})},Ao={id:"sheet.command.paste-col-width",type:H.COMMAND,handler:async e=>e.get(U).executeCommand(Ws.id,{value:_t.SPECIAL_PASTE_COL_WIDTH})},fl={id:"sheet.command.paste-besides-border",type:H.COMMAND,handler:async e=>e.get(U).executeCommand(Ws.id,{value:_t.SPECIAL_PASTE_BESIDES_BORDER})},lb={id:"sheet.command.optional-paste",type:H.COMMAND,handler:async(e,{type:t})=>e.get(hs).rePasteWithPasteType(t)},Ru={type:H.COMMAND,id:"sheet.command.delete-range-move-left-confirm",handler:async e=>{const t=e.get(ys),n=e.get(U),s=e.get(Oe),i=e.get(q),r=e.get(P),o=i.getCurrentSelections();if(!o)return!1;const a=Y(r);if(!a)return!1;const{worksheet:l}=a;let u=o[0].range;if(!u)return!1;u={...u,endColumn:l.getColumnCount()-1};const d=c=>c.endRow-c.startRow;return l.getMergeData().find(c=>{const h=z.getIntersects(c,u);return h?d(c)>d(h):!1})?await t.confirm({id:Ru.id,title:{title:s.t("merge.confirm.warning")},children:{title:s.t("merge.confirm.dismantleMergeCellWarning")},cancelText:s.t("button.cancel"),confirmText:s.t("button.confirm")})?n.executeCommand(Bs.id):!0:n.executeCommand(Bs.id)}},na={type:H.COMMAND,id:"sheet.command.delete-range-move-up-confirm",handler:async e=>{const t=e.get(ys),n=e.get(U),s=e.get(Oe),i=e.get(q),r=e.get(P),o=i.getCurrentSelections();if(!o)return!1;const a=Y(r);if(!a)return!1;const{worksheet:l}=a;let u=o[0].range;if(!u)return!1;u={...u,endRow:l.getRowCount()-1};for(let c=u.startRow;c<=u.endRow;c++)if(l.getRowFiltered(c)&&await t.confirm({id:na.id,title:{title:s.t("filter.confirm.error")},children:{title:s.t("filter.confirm.notAllowedToInsertRange")},confirmText:s.t("button.confirm")}))return!1;const d=c=>c.endColumn-c.startColumn;return l.getMergeData().find(c=>{const h=z.getIntersects(c,u);return h?d(c)>d(h):!1})?await t.confirm({id:na.id,title:{title:s.t("merge.confirm.warning")},children:{title:s.t("merge.confirm.dismantleMergeCellWarning")},cancelText:s.t("button.cancel"),confirmText:s.t("button.confirm")})?n.executeCommand(js.id):!0:n.executeCommand(js.id)}};function Li(e,t,n,s,i=!0,r=1,o=!0){let a={...e};s==null&&(s={startRow:0,endRow:n.getRowCount()-1,startColumn:0,endColumn:n.getColumnCount()-1});let l;switch(t){case Z.UP:for(l=e.startRow-r;l>-1&&!n.getRowVisible(l);)l-=1;l>=s.startRow?(a.startRow=l,a.endRow=l):o&&(a.startRow=s.endRow,a.endRow=s.endRow,i&&(a=Li(a,Z.LEFT,n,s,!1)));break;case Z.DOWN:for(l=e.endRow+r;l<n.getRowCount()&&!n.getRowVisible(l);)l+=1;l<=s.endRow?(a.startRow=l,a.endRow=l):o&&(a.startRow=s.startRow,a.endRow=s.startRow,i&&(a=Li(a,Z.RIGHT,n,s,!1)));break;case Z.LEFT:for(l=e.startColumn-r;l>-1&&!n.getColVisible(l);)l-=1;l>=s.startColumn?(a.startColumn=l,a.endColumn=l):o&&(a.startColumn=s.endColumn,a.endColumn=s.endColumn,i&&(a=Li(a,Z.UP,n,s,!1)));break;case Z.RIGHT:for(l=e.endColumn+r;l<n.getColumnCount()&&!n.getColVisible(l);)l+=1;l<=s.endColumn?(a.startColumn=l,a.endColumn=l):o&&(a.startColumn=s.startColumn,a.endColumn=s.startColumn,i&&(a=Li(a,Z.DOWN,n,s,!1)));break}return a}function pf(e,t,n){const s={...e},{startRow:i,startColumn:r,endRow:o,endColumn:a}=jl(e,t,n);let l=Xa(n,i,r,o,a).hasValue,u=!0,d=!0;for(;d;){if(Z.UP===t){let c=s.startRow-1;for(;c>-1&&!n.getRowVisible(c);)c-=1;if(c===-1){d=!1;break}const{hasValue:h,matrix:g}=Xa(n,c,s.startColumn,c,s.endColumn);if(l&&!h&&!u){d=!1;break}else{if(g.getLength()!==0){let m=c;g.forValue(p=>{m=Math.min(p,m)}),s.startRow=m}else s.startRow=c;if(s.endRow=s.startRow,!l&&h){d=!1;break}l=h,u=!1}}if(Z.DOWN===t){let c=s.endRow+1;for(;c<n.getRowCount()&&!n.getRowVisible(c);)c+=1;if(c===n.getRowCount()){d=!1;break}const{hasValue:h,matrix:g}=Xa(n,c,s.startColumn,c,s.endColumn);if(l&&!h&&!u){d=!1;break}else{if(g.getLength()!==0){let m=c;g.forValue((p,f,v)=>{m=Math.max(p+(v.rowSpan||1)-1,m)}),s.endRow=m}else s.endRow=c;if(s.startRow=s.endRow,!l&&h){d=!1;break}l=h,u=!1}}if(Z.LEFT===t){let c=s.startColumn-1;for(;c>-1&&!n.getColVisible(c);)c-=1;if(c===-1){d=!1;break}const{hasValue:h,matrix:g}=Xa(n,s.startRow,c,s.endRow,c);if(l&&!h&&!u){d=!1;break}else{if(g.getLength()!==0){let m=c;g.forValue((p,f)=>{m=Math.min(f,m)}),s.startColumn=m}else s.startColumn=c;if(s.endColumn=s.startColumn,!l&&h){d=!1;break}l=h,u=!1}}if(Z.RIGHT===t){let c=s.endColumn+1;for(;c<n.getColumnCount()&&!n.getColVisible(c);)c+=1;if(c===n.getColumnCount()){d=!1;break}const{hasValue:h,matrix:g}=Xa(n,s.startRow,c,s.endRow,c);if(l&&!h&&!u){d=!1;break}else{if(g.getLength()!==0){let m=c;g.forValue((p,f,v)=>{m=Math.max(f+(v.colSpan||1)-1,m)}),s.endColumn=m}else s.endColumn=c;if(s.startColumn=s.endColumn,!l&&h){d=!1;break}l=h,u=!1}}}return Yn(s,n,!0)}function ub(e,t,n){return Li(e,t,n,void 0,!1,1,!1)}function Kx(e,t,n){const s=pf(e,t,n);return Yn(z.union(s,e),n,!0)}function $x(e,t,n){const s=ub(e,t,n),i={startRow:Math.min(e.startRow,s.startRow),startColumn:Math.min(e.startColumn,s.startColumn),endRow:Math.max(e.endRow,s.endRow),endColumn:Math.max(e.endColumn,s.endColumn)};return Yn(z.union(e,i),n)}function Jx(e,t,n,s){const i=cw(n),r=pf(jl(e,i,s),n,s);return n===Z.UP&&r.startRow<=e.startRow?Yn({...t,startColumn:e.startColumn,endColumn:e.endColumn},s,!0):n===Z.DOWN&&r.endRow>=e.endRow?Yn({...t,startColumn:e.startColumn,endColumn:e.endColumn},s,!0):n===Z.LEFT&&r.startColumn<=e.startColumn?Yn({...t,startRow:e.startRow,endRow:e.endRow},s,!0):n===Z.RIGHT&&r.endColumn>=e.endColumn?Yn({...t,startRow:e.startRow,endRow:e.endRow},s,!0):z.union(z.clone(t),r)}function ek(e,t,n){const s=cw(t),i=jl(e,s,n),r=jl(e,t,n),o=ub(i,t,n);return Yn(z.union(r,o),n,!1)}function Zv(e){return{startRow:0,startColumn:0,endRow:e.getRowCount()-1,endColumn:e.getColumnCount()-1,rangeType:j.ALL}}function jl(e,t,n){let s;switch(t){case Z.UP:s={startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow,endColumn:e.endColumn,rangeType:j.NORMAL};break;case Z.DOWN:s={startRow:e.endRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn,rangeType:j.NORMAL};break;case Z.LEFT:s={startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.startColumn,rangeType:j.NORMAL};break;case Z.RIGHT:s={startRow:e.startRow,startColumn:e.endColumn,endRow:e.endRow,endColumn:e.endColumn,rangeType:j.NORMAL};break;default:throw new Error("Invalid direction")}return Yn(s,n,!1)}function Xa(e,t,n,s,i){let r=!1;const o=e.getMatrixWithMergedCells(t,n,s,i).forValue((a,l,u)=>{if(nk(u))return r=!0,!1});return{hasValue:r,matrix:o}}function fm(e,t,n){const s=z.clone(e);if(t==null)return s;switch(n){case Z.UP:case Z.DOWN:s.startColumn=s.endColumn=t.actualColumn;break;case Z.LEFT:case Z.RIGHT:s.startRow=s.endRow=t.actualRow;break}return s}function tk(e,t,n){var s,i,r,o;const{primary:a,range:l}=e,u=z.clone(l);switch(t){case Z.UP:case Z.DOWN:u.startRow=(s=a?.startRow)!=null?s:l.startRow,u.endRow=(i=a?.endRow)!=null?i:l.startRow;break;case Z.LEFT:case Z.RIGHT:u.startColumn=(r=a?.startColumn)!=null?r:l.startColumn,u.endColumn=(o=a?.endColumn)!=null?o:l.startColumn;break}const d=jl(u,t,n);switch(t){case Z.DOWN:return l.startRow<d.startRow;case Z.UP:return l.endRow>d.endRow;case Z.LEFT:return d.endColumn<l.endColumn;case Z.RIGHT:return d.startColumn>l.startColumn}}function db(e,t){let n=e[0].startRow,s=e[0].endRow;e.forEach(r=>{const{startRow:o,endRow:a}=r;n=Math.min(n,o),s=Math.max(s,a)});const i=new Array(s-n+1).fill(!1);return t.forEach(r=>{const{startRow:o,endRow:a}=r;for(let l=Math.max(o,n);l<=Math.min(a,s);l++)i[l-n]=!0}),e.every(r=>{const{startRow:o,endRow:a}=r;for(let l=o;l<=a;l++)if(!i[l-n])return!1;return!0})}function cb(e,t){let n=e[0].startColumn,s=e[0].endColumn;e.forEach(r=>{const{startColumn:o,endColumn:a}=r;n=Math.min(n,o),s=Math.max(s,a)});const i=new Array(s-n+1).fill(!1);return t.forEach(r=>{const{startColumn:o,endColumn:a}=r;for(let l=Math.max(o,n);l<=Math.min(a,s);l++)i[l-n]=!0}),e.every(r=>{const{startColumn:o,endColumn:a}=r;for(let l=o;l<=a;l++)if(!i[l-n])return!1;return!0})}function nk(e){return e.v!==void 0&&e.v!==null&&e.v!==""||e.p!==void 0}const wh={id:"sheet.command.hide-row-confirm",type:H.COMMAND,handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(l=>l.range);if(!(n!=null&&n.length))return!1;const s=e.get(U),i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o}=r,a=o.getVisibleRows();if(db(a,n)){const l=e.get(ys),u=e.get(Oe);return await l.confirm({id:"sheet.confirm.hide-row",title:{title:u.t("info.problem")},children:{title:u.t("rightClick.hideAllRowsAlert")},cancelText:u.t("button.cancel"),confirmText:u.t("button.confirm")}),!1}return await s.executeCommand(Br.id),!0}},Sh={id:"sheet.command.hide-col-confirm",type:H.COMMAND,handler:async e=>{var t;const n=(t=e.get(q).getCurrentSelections())==null?void 0:t.map(l=>l.range);if(!(n!=null&&n.length))return!1;const s=e.get(U),i=e.get(P),r=Y(i);if(!r)return!1;const{worksheet:o}=r,a=o.getVisibleCols();if(cb(a,n)){const l=e.get(ys),u=e.get(Oe);return await l.confirm({id:"sheet.confirm.hide-col",title:{title:u.t("info.problem")},children:{title:u.t("rightClick.hideAllColumnsAlert")},cancelText:u.t("button.cancel"),confirmText:u.t("button.confirm")}),!1}return await s.executeCommand(Lr.id),!0}};function hr(e){var t,n;const s=e.get(P),i=e.get(Qm),r=(t=e.get(no).getFocusId())!=null?t:rt,o=s.getUnit(r,A.UNIVER_DOC),a=i.getActiveTextRange();if(o==null||a==null)return null;const l=(n=o.getBody())==null?void 0:n.textRuns;if(l==null)return;const{startOffset:u,endOffset:d}=a;return l.find(({st:c,ed:h})=>u>=c&&d<=h)}const Oa={type:H.COMMAND,id:"sheet.command.set-range-bold",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(y_.id):t.executeCommand(Wp.id)}},Aa={type:H.COMMAND,id:"sheet.command.set-range-italic",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(E_.id):t.executeCommand(Lp.id)}},Va={type:H.COMMAND,id:"sheet.command.set-range-underline",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(P_.id):t.executeCommand(Bp.id)}},Ha={type:H.COMMAND,id:"sheet.command.set-range-stroke",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(x_.id):t.executeCommand(jp.id)}},hb={type:H.COMMAND,id:"sheet.command.set-range-subscript",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(k_.id):!1}},gb={type:H.COMMAND,id:"sheet.command.set-range-superscript",handler:async e=>{const t=e.get(U);return e.get(Ne).getContextValue(It)?t.executeCommand(T_.id):!1}},bh={type:H.COMMAND,id:"sheet.command.set-range-fontsize",handler:async(e,t)=>{const n=e.get(U);return e.get(Ne).getContextValue(It)?n.executeCommand(Om.id,t):n.executeCommand(Cu.id,t)}},ff={type:H.COMMAND,id:"sheet.command.set-range-font-increase",handler:async e=>{var t,n,s,i;const r=e.get(P),o=e.get(U),a=e.get(Ne).getContextValue(It),l=e.get(q),u=hi.fs,d=r.getCurrentUnitOfType(A.UNIVER_SHEET).getActiveSheet(),c=(t=l.getCurrentLastSelection())==null?void 0:t.primary,h={value:u};if(a){const g=hr(e);if(g!=null){const m=(s=(n=g.ts)==null?void 0:n.fs)!=null?s:u;h.value=m>=400?400:m+1}return o.executeCommand(Om.id,h)}if(c!=null){const g=(i=d.getComposedCellStyle(c.startRow,c.startColumn).fs)!=null?i:u;return h.value=g>=400?400:g+1,o.executeCommand(Cu.id,h)}return!1}},vf={type:H.COMMAND,id:"sheet.command.set-range-font-decrease",handler:async e=>{var t,n,s,i;const r=e.get(P),o=e.get(U),a=e.get(Ne).getContextValue(It),l=e.get(q),u=hi.fs,d=r.getCurrentUnitOfType(A.UNIVER_SHEET).getActiveSheet(),c=(t=l.getCurrentLastSelection())==null?void 0:t.primary,h={value:u};if(a){const g=hr(e);if(g!=null){const m=(s=(n=g.ts)==null?void 0:n.fs)!=null?s:u;h.value=m<=6?6:m-1}return o.executeCommand(Om.id,h)}if(c!=null){const g=(i=d.getComposedCellStyle(c.startRow,c.startColumn).fs)!=null?i:u;return h.value=g<=6?6:g-1,o.executeCommand(Cu.id,h)}return!1}},Vo={type:H.COMMAND,id:"sheet.command.set-range-font-family",handler:async(e,t)=>{const n=e.get(U);return e.get(Ne).getContextValue(It)?n.executeCommand(M_.id,t):n.executeCommand(Fp.id,t)}},Fl={type:H.COMMAND,id:"sheet.command.set-range-text-color",handler:async(e,t)=>{const n=e.get(U);return e.get(Ne).getContextValue(It)?n.executeCommand(FC.id,t):n.executeCommand(zp.id,t)}},Cf={type:H.COMMAND,id:"sheet.command.reset-range-text-color",handler:async e=>{const t=e.get(U),n=e.get(Ne).getContextValue(It),s=e.get(xn);return n?t.executeCommand(FC.id,{value:null}):t.executeCommand(zp.id,{value:s.getColorFromTheme("gray.900")})}},sa={type:H.COMMAND,id:"sheet.command.insert-range-move-down-confirm",handler:async e=>{const t=e.get(ys),n=e.get(U),s=e.get(Oe),i=e.get(q),r=e.get(P),o=i.getCurrentSelections();if(!o)return!1;const a=Y(r);if(!a)return!1;const{worksheet:l}=a;let u=o[0].range;if(!u)return!1;u={...u,endRow:l.getRowCount()-1};for(let c=u.startRow;c<=u.endRow;c++)if(l.getRowFiltered(c)&&await t.confirm({id:sa.id,title:{title:s.t("filter.confirm.error")},children:{title:s.t("filter.confirm.notAllowedToInsertRange")},confirmText:s.t("button.confirm")}))return!1;const d=c=>c.endColumn-c.startColumn;return l.getMergeData().find(c=>{const h=z.getIntersects(c,u);return h?d(c)>d(h):!1})?await t.confirm({id:sa.id,title:{title:s.t("merge.confirm.warning")},children:{title:s.t("merge.confirm.dismantleMergeCellWarning")},cancelText:s.t("button.cancel"),confirmText:s.t("button.confirm")})?n.executeCommand(Fs.id):!0:n.executeCommand(Fs.id)}},yu={type:H.COMMAND,id:"sheet.command.insert-range-move-right-confirm",handler:async e=>{const t=e.get(ys),n=e.get(U),s=e.get(Oe),i=e.get(q),r=e.get(P),o=i.getCurrentSelections();if(!o)return!1;const a=Y(r);if(!a)return!1;const{worksheet:l}=a;let u=o[0].range;if(!u)return!1;u={...u,endColumn:l.getColumnCount()-1};const d=c=>c.endRow-c.startRow;return l.getMergeData().find(c=>{const h=z.getIntersects(c,u);return h?d(c)>d(h):!1})?await t.confirm({id:yu.id,title:{title:s.t("merge.confirm.warning")},children:{title:s.t("merge.confirm.dismantleMergeCellWarning")},cancelText:s.t("button.cancel"),confirmText:s.t("button.confirm")})?n.executeCommand(gi.id):!0:n.executeCommand(gi.id)}};var mb=(e=>(e[e.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",e[e.UNIVER_DOC=1]="UNIVER_DOC",e[e.UNIVER_SHEET=2]="UNIVER_SHEET",e[e.UNIVER_SLIDE=3]="UNIVER_SLIDE",e[e.UNIVER_PROJECT=4]="UNIVER_PROJECT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(mb||{}),Ee=(e=>(e[e.View=0]="View",e[e.Edit=1]="Edit",e[e.ManageCollaborator=2]="ManageCollaborator",e[e.Print=3]="Print",e[e.Duplicate=4]="Duplicate",e[e.Comment=5]="Comment",e[e.Copy=6]="Copy",e[e.Share=7]="Share",e[e.Export=8]="Export",e[e.MoveWorksheet=9]="MoveWorksheet",e[e.DeleteWorksheet=10]="DeleteWorksheet",e[e.HideWorksheet=11]="HideWorksheet",e[e.RenameWorksheet=12]="RenameWorksheet",e[e.CreateWorksheet=13]="CreateWorksheet",e[e.SetWorksheetStyle=14]="SetWorksheetStyle",e[e.EditWorksheetCell=15]="EditWorksheetCell",e[e.InsertHyperlink=16]="InsertHyperlink",e[e.Sort=17]="Sort",e[e.Filter=18]="Filter",e[e.PivotTable=19]="PivotTable",e[e.FloatImg=20]="FloatImg",e[e.History=21]="History",e[e.RwHgtClWdt=22]="RwHgtClWdt",e[e.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",e[e.ViewFilter=24]="ViewFilter",e[e.MoveSheet=25]="MoveSheet",e[e.DeleteSheet=26]="DeleteSheet",e[e.HideSheet=27]="HideSheet",e[e.CopySheet=28]="CopySheet",e[e.RenameSheet=29]="RenameSheet",e[e.CreateSheet=30]="CreateSheet",e[e.SelectProtectedCells=31]="SelectProtectedCells",e[e.SelectUnProtectedCells=32]="SelectUnProtectedCells",e[e.SetCellStyle=33]="SetCellStyle",e[e.SetCellValue=34]="SetCellValue",e[e.SetRowStyle=35]="SetRowStyle",e[e.SetColumnStyle=36]="SetColumnStyle",e[e.InsertRow=37]="InsertRow",e[e.InsertColumn=38]="InsertColumn",e[e.DeleteRow=39]="DeleteRow",e[e.DeleteColumn=40]="DeleteColumn",e[e.EditExtraObject=41]="EditExtraObject",e[e.Delete=42]="Delete",e[e.RecoverHistory=43]="RecoverHistory",e[e.ViewHistory=44]="ViewHistory",e[e.CreatePermissionObject=45]="CreatePermissionObject",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Ee||{}),Xn=(e=>(e[e.Reader=0]="Reader",e[e.Editor=1]="Editor",e[e.Owner=2]="Owner",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Xn||{}),ii=(e=>(e[e.Unkonwn=0]="Unkonwn",e[e.Workbook=1]="Workbook",e[e.Worksheet=2]="Worksheet",e[e.SelectRange=3]="SelectRange",e[e.Document=4]="Document",e[e.Slide=5]="Slide",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ii||{}),Us=(e=>(e[e.SomeCollaborator=0]="SomeCollaborator",e[e.AllCollaborator=1]="AllCollaborator",e[e.OneSelf=2]="OneSelf",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Us||{});const zl="UNIVER_SHEET_PERMISSION_PANEL",_h="UNIVER_SHEET_PERMISSION_USER_PART",pb="UNIVER_SHEET_PERMISSION_USER_DIALOG",fb="UNIVER_SHEET_PERMISSION_DIALOG",tc="UNIVER_SHEET_PERMISSION_USER_DIALOG_ID",nc="UNIVER_SHEET_PERMISSION_DIALOG_ID",Fu={[Ee.Copy]:"Copy",[Ee.SetCellStyle]:"SetCellStyle",[Ee.SetCellValue]:"SetCellValue",[Ee.SetRowStyle]:"SetRowStyle",[Ee.SetColumnStyle]:"SetColumnStyle",[Ee.InsertRow]:"InsertRow",[Ee.InsertColumn]:"InsertColumn",[Ee.InsertHyperlink]:"InsertHyperlink",[Ee.DeleteRow]:"DeleteRow",[Ee.DeleteColumn]:"DeleteColumn",[Ee.Sort]:"Sort",[Ee.Filter]:"Filter",[Ee.PivotTable]:"PivotTable",[Ee.EditExtraObject]:"EditExtraObject"},sk=[Ee.Copy,Ee.SetCellStyle,Ee.SetCellValue,Ee.SetRowStyle,Ee.SetColumnStyle,Ee.InsertRow,Ee.InsertColumn,Ee.InsertHyperlink,Ee.DeleteRow,Ee.DeleteColumn,Ee.Sort,Ee.Filter,Ee.PivotTable,Ee.EditExtraObject,Ee.View],vb="sheet-permission-menu-icon",ik="sheet-permission-delete-icon",rk="sheet-permission-edit-icon",ok="sheet-permission-check-icon",Cb="sheet-permission-lock-icon",ak={unitId:"",subUnitId:"",permissionId:"",unitType:se.SelectRange,id:"",ranges:[],viewState:dn.OthersCanView,editState:Ft.OnlyMe};class Gr{constructor(){y(this,"_rule",ak),y(this,"_visible",!1)}setVisible(t){this._visible=t}getVisible(){return this._visible}reset(){this.setVisible(!1)}}class co{constructor(){y(this,"_userList",[]),y(this,"_userList$",new xe(this._userList)),y(this,"userList$",this._userList$.asObservable()),y(this,"_oldCollaboratorList",[]),y(this,"_selectUserList",[]),y(this,"_selectUserList$",new xe(this._selectUserList)),y(this,"selectUserList$",this._selectUserList$.asObservable())}get userList(){return this._userList}setCanEditUserList(t){this._userList=t,this._userList$.next(t)}reset(){this._userList=[],this._oldCollaboratorList=[],this._selectUserList=[],this._selectUserList$.next([])}get oldCollaboratorList(){return this._oldCollaboratorList}setOldCollaboratorList(t){this._oldCollaboratorList=t}get selectUserList(){return this._selectUserList}setSelectUserList(t){this._selectUserList=t,this._selectUserList$.next(t)}}const fi={type:H.OPERATION,id:"sheet-permission.operation.openPanel",async handler(e,t={}){const n=e.get(_a),s=e.get(Gr),i=e.get(co),{showDetail:r=!0,fromSheetBar:o=!1,rule:a,oldRule:l}=t,u={header:{title:"permission.panel.title"},children:{label:zl,showDetail:r,fromSheetBar:o,rule:a,oldRule:l},width:330,onClose:()=>{s.reset(),i.reset()}};return s.setVisible(!0),n.open(u),!0}},Ih={type:H.COMMAND,id:"sheet.command.add-range-protection-from-toolbar",async handler(e){return await e.get(U).executeCommand(fi.id,{showDetail:!0}),!0}},Ho={type:H.COMMAND,id:"sheet.command.add-range-protection-from-context-menu",async handler(e){return await e.get(U).executeCommand(fi.id,{showDetail:!0}),!0}},Do={type:H.COMMAND,id:"sheet.command.view-sheet-permission-from-context-menu",async handler(e){return await e.get(U).executeCommand(fi.id,{showDetail:!1}),!0}},Rh={type:H.COMMAND,id:"sheet.command.add-range-protection-from-sheet-bar",async handler(e){return await e.get(U).executeCommand(fi.id,{fromSheetBar:!0,showDetail:!0}),!0}},yh={type:H.COMMAND,id:"sheet.command.view-sheet-permission-from-sheet-bar",async handler(e){return await e.get(U).executeCommand(fi.id,{showDetail:!1}),!0}},Wo={type:H.COMMAND,id:"sheet.command.delete-range-protection-from-context-menu",async handler(e){var t;const n=e.get(U),s=e.get(P),i=e.get(ce),r=e.get(q),o=e.get(ft),a=s.getCurrentUnitForType(A.UNIVER_SHEET),l=a.getActiveSheet(),u=a.getUnitId(),d=l.getSheetId(),c=o.getRule(u,d);if(c!=null&&c.permissionId)return n.executeCommand(Ul.id,{unitId:u,subUnitId:d,rule:c});{const h=(t=r.getCurrentLastSelection())==null?void 0:t.range;if(!h)return!1;const g=e.get(We).getSubunitRuleList(u,d).find(m=>m.ranges.some(p=>z.intersects(p,h)));if(g){const m={unitId:u,subUnitId:d,ruleIds:[g.id]};return await n.executeCommand($n.id,m)&&i.pushUndoRedo({unitID:u,redoMutations:[{id:$n.id,params:m}],undoMutations:[{id:Hn.id,params:{unitId:u,subUnitId:d,rules:[g]}}]}),!0}else return!1}}},Lo={type:H.COMMAND,id:"sheet.command.set-range-protection-from-context-menu",async handler(e){var t;const n=e.get(U),s=e.get(P),i=e.get(q),r=e.get(ft),o=s.getCurrentUnitForType(A.UNIVER_SHEET),a=o.getActiveSheet(),l=o.getUnitId(),u=a.getSheetId(),d=r.getRule(l,u);if(d!=null&&d.permissionId){const c={...d,unitId:l,subUnitId:u,ranges:[]};return await n.executeCommand(fi.id,{showDetail:!0,rule:Q.deepClone(c),oldRule:Q.deepClone(c)}),!0}else{const c=(t=i.getCurrentLastSelection())==null?void 0:t.range;if(!c)return!1;const h=e.get(We).getSubunitRuleList(l,u).find(g=>{var m;return(m=g?.ranges)==null?void 0:m.some(p=>z.intersects(p,c))});if(h){const g={...h,unitId:l,subUnitId:u};return await n.executeCommand(fi.id,{showDetail:!0,rule:Q.deepClone(g),oldRule:Q.deepClone(g)}),!0}else return!1}}},Xl={id:"sheet.command.remove-row-confirm",type:H.COMMAND,handler:async(e,t)=>{var n;const s=e.get(q);let i=t?.range;if(i||(i=(n=s.getCurrentLastSelection())==null?void 0:n.range),!i)return!1;const r=e.get(U),o=e.get(P),a=Y(o);if(!a)return!1;const{worksheet:l}=a,u=l.getVisibleRows();if(db(u,[i])){const d=e.get(ys),c=e.get(Oe);return await d.confirm({id:"sheet.confirm.remove-row",title:{title:c.t("info.problem")},children:{title:c.t("rightClick.deleteAllRowsAlert")},cancelText:c.t("button.cancel"),confirmText:c.t("button.confirm")}),!1}return await r.executeCommand(Ta.id,{range:i}),!0}},Yl={id:"sheet.command.remove-col-confirm",type:H.COMMAND,handler:async(e,t)=>{var n;const s=e.get(q);let i=t?.range;if(i||(i=(n=s.getCurrentLastSelection())==null?void 0:n.range),!i)return!1;const r=e.get(U),o=e.get(P),a=Y(o);if(!a)return!1;const{worksheet:l}=a,u=l.getVisibleCols();if(cb(u,[i])){const d=e.get(ys),c=e.get(Oe);return await d.confirm({id:"sheet.confirm.remove-col",title:{title:c.t("info.problem")},children:{title:c.t("rightClick.deleteAllColumnsAlert")},cancelText:c.t("button.cancel"),confirmText:c.t("button.confirm")}),!1}return await r.executeCommand(Pa.id,{range:i}),!0}},Mh={id:"sheet.command.remove-sheet-confirm",type:H.COMMAND,handler:async(e,t)=>{const{subUnitId:n}=t,s=e.get(ys),i=e.get(U),r=e.get(Oe),o=e.get(Lt),a=e.get(P),l=Y(a,{subUnitId:n});if(!l)return!1;const{worksheet:u}=l,d=o.getConfig(bu),c={...Zp,...d?.largeSheetOperation},h=rS(u.getCellMatrix())>=c.largeSheetCellCountThreshold;return await s.confirm({id:"sheet.confirm.remove-sheet",title:{title:r.t("sheetConfig.deleteSheet")},children:{title:h?r.t("sheetConfig.deleteLargeSheetContent"):r.t("sheetConfig.deleteSheetContent")},cancelText:r.t("button.cancel"),confirmText:r.t("button.confirm")})?(await i.executeCommand(Wr.id,{subUnitId:n}),!0):!1}};var lk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Co=(e,t)=>(n,s)=>t(n,s,e),ls=(e=>(e[e.OFF=0]="OFF",e[e.ONCE=1]="ONCE",e[e.INFINITE=2]="INFINITE",e))(ls||{});const Ii=bn("univer.format-painter-service");let sc=class extends ae{constructor(e,t,n,s,i,r){super(),y(this,"status$"),y(this,"_selectionFormat"),y(this,"_markId",null),y(this,"_status$"),y(this,"_defaultHook",null),y(this,"_extendHooks",[]),this._selectionManagerService=e,this._themeService=t,this._markSelectionService=n,this._logService=s,this._commandService=i,this._undoRedoService=r,this._status$=new xe(0),this.status$=this._status$.asObservable(),this._selectionFormat={styles:new de,merges:[]}}addHook(e){var t,n,s;e.isDefaultHook&&((t=e.priority)!=null?t:0)>((s=(n=this._defaultHook)==null?void 0:n.priority)!=null?s:-1)?this._defaultHook=e:(this._extendHooks.push(e),this._extendHooks.sort((i,r)=>(i.priority||0)-(r.priority||0)))}getHooks(){return this._defaultHook?[this._defaultHook,...this._extendHooks]:this._extendHooks}setStatus(e){this._updateRangeMark(e),this._status$.next(e),this.getHooks().forEach(t=>{t.onStatusChange!==void 0&&t.onStatusChange(e)})}getStatus(){return this._status$.getValue()}setSelectionFormat(e){this._selectionFormat=e}getSelectionFormat(){return this._selectionFormat}applyFormatPainter(e,t,n){const s=this.getHooks(),i=[],r=[];s.forEach(a=>{if(a.onApply!==void 0){const l=a.onApply(e,t,n,this._selectionFormat);l&&(i.push(...l.redos),r.push(...l.undos))}});for(const a of s)if(a.onBeforeApply!==void 0&&!a.onBeforeApply({unitId:e,subUnitId:t,range:n,redoMutationsInfo:i,format:this._selectionFormat,undoMutationsInfo:r}))return!1;this._logService.log("[FormatPainterService]","apply mutations",{undoMutationsInfo:r,redoMutationsInfo:i});const o=i.every(a=>this._commandService.executeCommand(a.id,a.params));return o&&this._undoRedoService.pushUndoRedo({unitID:e,undoMutations:r,redoMutations:i}),o}_updateRangeMark(e){if(this._markSelectionService.removeAllShapes(),e!==0){const t=this._selectionManagerService.getCurrentLastSelection();if(t){const n=nb(this._themeService);e===2?this._markId=this._markSelectionService.addShape({...t,style:n}):this._markId=this._markSelectionService.addShape({...t,style:n},[le.id])}}}};sc=lk([Co(0,V(q)),Co(1,V(xn)),Co(2,Na),Co(3,ar),Co(4,U),Co(5,ce)],sc);const Eh={id:"sheet.operation.set-format-painter",type:H.OPERATION,handler:(e,t)=>t?(e.get(Ii).setStatus(t.status),!0):!1},wf={type:H.COMMAND,id:"sheet.command.set-infinite-format-painter",handler:async e=>{const t=e.get(Ii).getStatus();let n;return t!==ls.OFF?n=ls.OFF:n=ls.INFINITE,e.get(U).executeCommand(Eh.id,{status:n})}},Mu={type:H.COMMAND,id:"sheet.command.set-once-format-painter",handler:async e=>{const t=e.get(Ii).getStatus();let n;return t!==ls.OFF?n=ls.OFF:n=ls.ONCE,e.get(U).executeCommand(Eh.id,{status:n})}},xh={type:H.COMMAND,id:"sheet.command.apply-format-painter",handler:async(e,t)=>e.get(Ii).applyFormatPainter(t.unitId,t.subUnitId,t.range)};var uk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},dk=(e,t)=>(n,s)=>t(n,s,e);let Sn=class{constructor(e,t){y(this,"_scrollStateMap",new Map),y(this,"_rawScrollInfo$",new xe(null)),y(this,"rawScrollInfo$",this._rawScrollInfo$.asObservable()),y(this,"validViewportScrollInfo$",new xe(null)),y(this,"_searchParamForScroll",null),this._context=e,this._sheetSkeletonManagerService=t}dispose(){this._rawScrollInfo$.complete()}calcViewportScrollFromRowColOffset(e){if(!e)return{viewportScrollX:0,viewportScrollY:0};let{sheetViewStartColumn:t,sheetViewStartRow:n,offsetX:s,offsetY:i}=e;n=n||0,i=i||0;const r=this._sheetSkeletonManagerService.getCurrentSkeleton(),o=r?.rowHeightAccumulation[n-1]||0,a=(r?.columnWidthAccumulation[t-1]||0)+s,l=o+i;return{viewportScrollX:a,viewportScrollY:l}}setSearchParam(e){this._searchParamForScroll=e}getScrollStateByParam(e){return this._getCurrentScroll(e)}getCurrentScrollState(){return this._getCurrentScroll(this._searchParamForScroll)}setValidScrollState(e){this._setScrollState(e)}emitRawScrollParam(e){this._emitRawScroll(e)}setValidScrollStateToCurrSheet(e){if(this._searchParamForScroll==null)return;this._setScrollState({...this._searchParamForScroll,...e});const t=this._searchParamForScroll.sheetId,n=this._sheetSkeletonManagerService.getSkeleton(t);n&&n.setScroll(e.viewportScrollX,e.viewportScrollY)}clear(){this._searchParamForScroll!=null&&this._clearByParamAndNotify(this._searchParamForScroll)}_setScrollState(e){const{unitId:t,sheetId:n,sheetViewStartColumn:s,sheetViewStartRow:i,offsetX:r,offsetY:o}=e;this._scrollStateMap.has(t)||this._scrollStateMap.set(t,new Map);const a=this._scrollStateMap.get(t),l={sheetViewStartRow:i,sheetViewStartColumn:s,offsetX:r,offsetY:o};a.set(n,l)}_clearByParamAndNotify(e){this._setScrollState({...e,sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0}),this._emitRawScroll({sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0})}_getCurrentScroll(e){var t;const n={sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0};if(e==null)return n;const{unitId:s,sheetId:i}=e;return((t=this._scrollStateMap.get(s))==null?void 0:t.get(i))||n}_emitRawScroll(e){this._rawScrollInfo$.next(e)}};Sn=uk([dk(1,V(Te))],Sn);const gr={type:H.COMMAND,id:"sheet.command.set-selection-frozen",handler:async(e,t)=>{var n,s;const{type:i}=t||{},r=e.get(P),o=e.get(ce),a=Y(r);if(!a)return!1;const{unitId:l,subUnitId:u}=a,d=e.get(U),c=e.get(q).getCurrentSelections();if(!c)return!1;const h=e.get(ze).getRenderById(l).with(Sn),{sheetViewStartRow:g=0,sheetViewStartColumn:m=0}=h.getCurrentScrollState()||{};let p,f,v,C;if(i===3)p=g+1,v=1,f=-1,C=0;else if(i===4)p=-1,v=0,f=m+1,C=1;else{const I=c[c?.length-1],{primary:_,range:R}=I;let M=(n=_?.startRow)!=null?n:R.startRow;M===0&&(M=1);let x=(s=_?.startColumn)!=null?s:R.startColumn;x===0&&(x=1);const N=R.rangeType;if(N===j.ROW||i===1)p=M,v=M-g,f=-1,C=0;else if(N===j.COLUMN||i===2)p=-1,v=0,f=x,C=x-m;else if(N===j.NORMAL)p=M,v=M-g,f=x,C=x-m;else return!1}const w={unitId:l,subUnitId:u,startRow:p,startColumn:f,xSplit:f>0?Math.max(1,C):C,ySplit:p>0?Math.max(1,v):v},b=lh(e,w);return d.syncExecuteCommand(wn.id,w)&&o.pushUndoRedo({unitID:l,undoMutations:[{id:wn.id,params:b}],redoMutations:[{id:wn.id,params:w}]}),!0}},Zl={type:H.COMMAND,id:"sheet.command.set-row-frozen",handler:async e=>(e.get(U).executeCommand(gr.id,{type:1}),!0)},Gl={type:H.COMMAND,id:"sheet.command.set-col-frozen",handler:async e=>(e.get(U).executeCommand(gr.id,{type:2}),!0)},ql={type:H.COMMAND,id:"sheet.command.set-first-row-frozen",handler:async e=>(e.get(U).executeCommand(gr.id,{type:3}),!0)},Ql={type:H.COMMAND,id:"sheet.command.set-first-column-frozen",handler:async e=>(e.get(U).executeCommand(gr.id,{type:4}),!0)};class Sf extends ae{constructor(){super(...arguments),y(this,"rangesStack",[]),y(this,"selectedRangeWorksheet","")}}var ck=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Gv=(e,t)=>(n,s)=>t(n,s,e);let ia=class{constructor(e,t){y(this,"_current",null),y(this,"_shortcutParam",[]),this._univerInstanceService=e,this._localeService=t}dispose(){this._shortcutParam=[]}getCurrentBySearch(e){return this._getCurrentBySearch(e)}getCurrent(){return this._getCurrentBySearch(this._current)}addOrUpdate(e){const t=this._getCurrentBySearch({unitId:e.unitId,sheetId:e.sheetId,keycode:e.keycode});if(t!=null){const n=this._shortcutParam.indexOf(t);this._shortcutParam.splice(n,1)}return this._shortcutParam.push(e),t}remove(e){if(e==null)return;const t=this._getCurrentBySearch(e);if(t==null)return;const n=this._shortcutParam.indexOf(t);return this._shortcutParam.splice(n,1)[0]}_getCurrentBySearch(e){return e==null?void 0:this._shortcutParam.find(t=>t.unitId===e.unitId&&t.sheetId===e.sheetId&&t.keycode===e.keycode)}};ia=ck([Gv(0,P),Gv(1,V(Oe))],ia);var Ri=(e=>(e[e.moveStopeOne=0]="moveStopeOne",e[e.moveGap=1]="moveGap",e[e.moveStepPage=2]="moveStepPage",e[e.moveStepEnd=3]="moveStepEnd",e))(Ri||{});const Jn={id:"sheet.command.move-selection",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{workbook:s,worksheet:i}=n,r=Zi(e,t.fromCurrentSelection).getCurrentLastSelection();if(!r)return!1;const{direction:o,jumpOver:a,extra:l}=t;let{range:u,primary:d}=r;if(l==="formula-editor"){if(u.startRow===u.endRow&&u.startColumn===u.endColumn){const f=i.getMergedCell(u.startRow,u.startColumn);f&&(u={...u,...f})}if(!d){const f=Zi(e,t.fromCurrentSelection).getCurrentLastSelectionPrimaryCell();f&&z.contains(u,f)&&(d=f)}}const c=fm(u,d,o),h=a===1?pf(c,o,i):Li(c,o,i),g=id(h.startRow,h.startColumn,i);if(z.equals(g,c))return!1;const m=s.getUnitId();e.get(ia).remove({unitId:m,sheetId:i.getSheetId(),keycode:te.TAB});const p=[{range:z.clone(g),primary:{startRow:g.startRow,startColumn:g.startColumn,endRow:g.endRow,endColumn:g.endColumn,actualRow:h.startRow,actualColumn:h.startColumn,isMerged:g.isMerged,isMergedMainCell:g.startRow===h.startRow&&g.startColumn===h.startColumn}}];return e.get(U).executeCommand(me.id,{unitId:s.getUnitId(),subUnitId:i.getSheetId(),selections:p,type:Ct.MOVE_END,extra:l,reveal:!0})}},yi={id:"sheet.command.move-selection-enter-tab",type:H.COMMAND,handler:(e,t)=>{var n;if(!t)return!1;const s=Y(e.get(P));if(!s)return!1;const{workbook:i,worksheet:r}=s,o=Zi(e),{direction:a,keycode:l}=t,u=a===Z.LEFT||a===Z.UP,d=o.getCurrentSelections().concat(),c=d.findIndex(B=>B.primary),h=d[c];if(!h)return!1;const g=u?-1:1,m=c+g!==d.length?d[c+g]:d[0],p=d.findIndex(B=>B===m),f=i.getUnitId(),v=r.getSheetId();if(!h)return!1;const{range:C}=h,w=h.primary;let b=fm(C,w,a);const I=e.get(ia),_=I.getCurrentBySearch({unitId:f,sheetId:v,keycode:te.TAB});let R;const{startRow:M,endRow:x,startColumn:N,endColumn:T}=C,O=u?w.startRow===M&&w.startColumn===N:w.endRow===x&&w.endColumn===T;if(z.equals(C,w)){if(l===te.TAB)_==null&&I.addOrUpdate({unitId:f,sheetId:v,keycode:te.TAB,selection:h});else{const J=_?.selection;if(J!=null){const{range:ee,primary:we}=J;b=fm(ee,we,a)}I.remove({unitId:f,sheetId:v,keycode:te.TAB})}const B=l===te.ENTER&&a===Z.DOWN&&b.endRow===r.getMaxRows()-1,W=l===te.TAB&&a===Z.RIGHT&&b.endColumn===r.getMaxColumns()-1,F=B||W?b:Li(b,a,r),K=id(F.startRow,F.startColumn,r);if(z.equals(K,b))return!1;R={range:z.clone(K),primary:{startRow:K.startRow,startColumn:K.startColumn,endRow:K.endRow,endColumn:K.endColumn,actualRow:F.startRow,actualColumn:F.startColumn,isMerged:K.isMerged,isMergedMainCell:K.startRow===F.startRow&&K.startColumn===F.startColumn}}}else{I.remove({unitId:f,sheetId:v,keycode:te.TAB});const B=Q.deepClone(w),W=O?m.range:Li({startRow:B.startRow,startColumn:B.startColumn,endRow:B.endRow,endColumn:B.endColumn},a,r,{startRow:M,endRow:x,startColumn:N,endColumn:T}),F=O&&u,K=F?id(W.endRow,W.endColumn,r):id(W.startRow,W.startColumn,r);R={range:O?m.range:z.clone(C),primary:{startRow:K.startRow,startColumn:K.startColumn,endRow:K.endRow,endColumn:K.endColumn,actualRow:F?K.startRow:W.startRow,actualColumn:F?K.startColumn:W.startColumn,isMerged:K.isMerged,isMergedMainCell:K.startRow===W.startRow&&K.startColumn===W.startColumn},style:O?m.style:h.style}}O?(d[c].primary=null,d[p]=R,o.setSelections(f,v,[],Ct.MOVE_END)):d[c]=R;const k=e.get(U).executeCommand(me.id,{unitId:f,subUnitId:v,type:Ct.MOVE_END,selections:d,reveal:!0,extra:t.extra}),D=(n=e.get(ze).getRenderById(f))==null?void 0:n.with(Zt);return D?.refreshSelectionMoveEnd(),k}},gs={id:"sheet.command.expand-selection",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const n=Y(e.get(P));if(!n)return!1;const{worksheet:s,unitId:i,subUnitId:r}=n,o=Zi(e).getCurrentLastSelection();if(!o)return!1;const{jumpOver:a,direction:l,extra:u}=t;let{range:d,primary:c}=o;if(u==="formula-editor"){if(d.startRow===d.endRow&&d.startColumn===d.endColumn){const g=s.getMergedCell(d.startRow,d.startColumn);g&&(d={...d,...g})}if(!c){const g=Zi(e).getCurrentLastSelectionPrimaryCell();g&&z.contains(d,g)&&(c=g)}}const h=tk({range:d,primary:c},l,s)?a===1?Jx(d,{...z.clone(c),rangeType:j.NORMAL},l,s):ek(d,l,s):a===1?Kx(d,l,s):$x(d,l,s);return h.rangeType=o.range.rangeType,z.equals(h,d)?!1:e.get(U).syncExecuteCommand(me.id,{unitId:i,subUnitId:r,type:Ct.MOVE_END,selections:[{range:h,primary:c}],extra:u,reveal:!0})}},kh={id:"sheet.command.select-all",type:H.COMMAND,handler:async(e,t={expandToGapFirst:!0,loop:!1})=>{const n=Y(e.get(P));if(!n)return!1;const s=Zi(e).getCurrentLastSelection();if(!s)return!1;const i=e.get(Sf),{worksheet:r,unitId:o,subUnitId:a}=n,l=`${o}|${a}`;l!==i.selectedRangeWorksheet&&(i.rangesStack=[],i.selectedRangeWorksheet=l);const u=r.getMaxRows(),d=r.getMaxColumns(),{expandToGapFirst:c,loop:h}=t,{range:g,primary:m}=s,p=g.endColumn===d-1&&g.endRow===u-1&&g.startRow===0&&g.startColumn===0;i.rangesStack.some(b=>z.equals(b,g))||(i.rangesStack=[],i.rangesStack.push(g));let f;if(p)if(h){if(i.rangesStack.findIndex(b=>z.equals(b,g))!==i.rangesStack.length-1)return!1;f=i.rangesStack[0]}else return!1;else c?(f=HR(g,{left:!0,right:!0,up:!0,down:!0},r),z.equals(f,g)&&(f=Zv(r))):f=Zv(r);i.rangesStack.some(b=>z.equals(b,f))||i.rangesStack.push(f);const v=[];v.push({id:me.id,params:{unitId:o,subUnitId:a,reveal:!0,selections:[{range:f,primary:m}]}});const C=e.get(_e).onCommandExecute({id:kh.id,params:{range:g}});C.redos.length&&v.push(...C.redos);const w=e.get(U);return fe(v,w),!0}};function hk(e){return typeof e.isMainScene>"u"}function Rs(e,t){const n=e instanceof gI?e:e.getCurrentUnitForType(A.UNIVER_SHEET);if(!n)return null;const s=n.getUnitId();let i,r,o,a;if(hk(t)){const h=t.getRenderById(s);if(h==null)return null;i=h.components,i=h.components,r=h.mainComponent,o=h.scene,a=h.engine}else i=t.components,r=t.mainComponent,o=t.scene,a=t.engine;if(!i||!r)return null;const l=r,u=i.get(yt.ROW),d=i.get(yt.COLUMN),c=i.get(yt.LEFT_TOP);return{spreadsheet:l,spreadsheetRowHeader:u,spreadsheetColumnHeader:d,spreadsheetLeftTopPlaceholder:c,scene:o,engine:a}}function qv(e,t,n,s){const{startX:i,startY:r,endX:o,endY:a}=s.getCellWithCoordByIndex(e,t);return{startX:i,startY:r,endX:o,endY:a}}function vi(e,t,n,s,i,r){const o=n.getCoordRelativeToViewport(at.FromArray([e,t])),{x:a,y:l}=o,u=n.getScrollXYInfoByViewport(o,i),{scaleX:d,scaleY:c}=n.getAncestorScale(),h=s.getCellIndexByOffset(a,l,d,c,u,{closeFirst:r}),{row:g,column:m}=h,p=s.getNoMergeCellWithCoordByIndex(g,m),{startX:f,startY:v,endX:C,endY:w}=p;return{startX:f,startY:v,endX:C,endY:w,row:g,column:m}}function rd(e,t,n,s){const i=n.getCoordRelativeToViewport(at.FromArray([e,t])),r=n.getViewport($.VIEW_MAIN),o=n.getScrollXYInfoByViewport(i,r),{scaleX:a,scaleY:l}=n.getAncestorScale(),{x:u,y:d}=o,c=e/a+u,h=t/l+d;return{x:c,y:h}}var gk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},wo=(e,t)=>(n,s)=>t(n,s,e);Jn.id,yi.id;const mk=3;let ra=class extends ae{constructor(e,t,n,s,i,r,o){super(),this._context=e,this._injector=t,this._sheetSkeletonManagerService=n,this._contextService=s,this._commandService=i,this._renderManagerService=r,this._scrollManagerService=o,this._initCommandListener(),this._wheelEventListener(),this._scrollBarEventListener(),this._initSkeletonListener()}_wheelEventListener(){const{scene:e}=this._context;if(!e)return;const t=e.getViewport($.VIEW_MAIN);t&&this.disposeWithMe(e.onMouseWheel$.subscribeEvent((n,s)=>{if(n.ctrlKey||!this._contextService.getContextValue(kn))return;let i=0,r=0;i=n.deltaX,n.shiftKey?i=(n.deltaY||n.deltaX)*mk:r=n.deltaY,this._commandService.executeCommand(Kl.id,{offsetX:i,offsetY:r}),this._context.scene.makeDirty(!0);const o=t.limitedScroll(t.scrollX+i,t.scrollY+r);o&&!o.isLimitedX&&!o.isLimitedY&&(n.preventDefault(),e.getParent().classType===fw.SCENE_VIEWER&&s.stopPropagation()),t.isWheelPreventDefaultX&&t.isWheelPreventDefaultY&&n.preventDefault()}))}_scrollBarEventListener(){const{scene:e}=this._context;if(e==null)return;const t=e.getViewport($.VIEW_MAIN);t&&(this.disposeWithMe(He(this._scrollManagerService.rawScrollInfo$.subscribe(n=>{var s;const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(!i)return;if(n==null){t.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});return}const{sheetViewStartRow:r,sheetViewStartColumn:o,offsetX:a,offsetY:l,duration:u}=n,{startX:d,startY:c}=i.getCellWithCoordByIndex(r,o,!1),h=d+a,g=c+l;t.scrollAnimationFrameId!==null&&cancelAnimationFrame(t.scrollAnimationFrameId),u?this._smoothScrollToViewportPos({viewportMain:t,viewportScrollX:h,viewportScrollY:g,duration:u}):t.scrollToViewportPos({viewportScrollX:h,viewportScrollY:g})}))),this.disposeWithMe(t.onScrollAfter$.subscribeEvent(n=>{var s;const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(i==null||n.isTrigger===!1)return;const r=this._getSheetObject();if(i==null||r==null)return;const{viewportScrollX:o,viewportScrollY:a,scrollX:l,scrollY:u}=n,{row:d,column:c,rowOffset:h,columnOffset:g}=i.getOffsetRelativeToRowCol(o,a),m={sheetViewStartRow:d,sheetViewStartColumn:c,offsetX:g,offsetY:h,viewportScrollX:o,viewportScrollY:a,scrollX:l,scrollY:u};this._scrollManagerService.setValidScrollStateToCurrSheet(m),this._scrollManagerService.validViewportScrollInfo$.next({...m,viewportScrollX:o,viewportScrollY:a,scrollX:l,scrollY:u})})),this.disposeWithMe(t.onScrollByBar$.subscribeEvent(n=>{var s;const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(i==null||n.isTrigger===!1)return;const r=this._getSheetObject();if(i==null||r==null)return;const{viewportScrollX:o=0,viewportScrollY:a=0}=n;this._getFreeze();const{row:l,column:u,rowOffset:d,columnOffset:c}=i.getOffsetRelativeToRowCol(o,a);this._commandService.executeCommand(Ss.id,{sheetViewStartRow:l,sheetViewStartColumn:u,offsetX:c,offsetY:d})})))}_initSkeletonListener(){this.disposeWithMe(He(this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe(e=>{if(e==null)return;const t={unitId:e.unitId,sheetId:e.sheetId};if(this._scrollManagerService.setSearchParam(t),!this._getSheetObject())return;const n=this._scrollManagerService.getScrollStateByParam(t),{viewportScrollX:s,viewportScrollY:i}=this._scrollManagerService.calcViewportScrollFromRowColOffset(n);n&&this._updateViewportScroll(s,i)})))}_smoothScrollToViewportPos(e){const{viewportMain:t,viewportScrollX:n,viewportScrollY:s,duration:i}=e,r=performance.now(),o=t.viewportScrollX,a=t.viewportScrollY,l=n-o,u=s-a;function d(c){const h=c-r,g=Math.min(h/i,1),m=1-(1-g)**3,p=o+l*m,f=a+u*m;t.scrollToViewportPos({viewportScrollX:p,viewportScrollY:f}),g<1?t.scrollAnimationFrameId=requestAnimationFrame(d):t.scrollAnimationFrameId=null}t.scrollAnimationFrameId=requestAnimationFrame(d)}_updateViewportScroll(e=0,t=0){const n=this._getSheetObject();if(!n)return;const s=n.scene,i=s.getViewport($.VIEW_MAIN),r=s.getViewport($.VIEW_COLUMN_RIGHT),o=s.getViewport($.VIEW_ROW_BOTTOM),a=s.getViewport($.VIEW_MAIN_LEFT),l=s.getViewport($.VIEW_MAIN_TOP);i&&(i.viewportScrollX=e,i.viewportScrollY=t),o&&(o.viewportScrollY=t),r&&(r.viewportScrollX=e),a&&(a.viewportScrollY=t),l&&(l.viewportScrollX=e)}scrollToRange(e,t,n){let{endRow:s,endColumn:i,startColumn:r,startRow:o}=e;const a=this._getViewportBounding();if(e.rangeType===j.ROW?(r=0,i=0):e.rangeType===j.COLUMN&&(o=0,s=0),a&&!t&&!n){const l=a.startRow>s?o:s,u=a.startColumn>i?r:i;return this._scrollToCell(l,u)}else return this._scrollToCell(o,r,t,n)}scrollToCell(e,t,n){const s=this._context.unit.getActiveSheet(),{ySplit:i,xSplit:r}=s.getFreeze();return this._commandService.syncExecuteCommand(Ss.id,{sheetViewStartRow:e-i,sheetViewStartColumn:t-r,offsetX:0,offsetY:0,duration:n})}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{switch(e.id){case me.id:{const t=e.params;t.unitId===this._context.unitId&&t.reveal&&this._scrollToSelection()}break;case mh.id:{const t=e.params;if(t.unitId===this._context.unitId){const n=t.range;this.scrollToRange(n)}}break;case gs.id:{const t=e.params;this._scrollToSelectionForExpand(t)}break}}))}_scrollToSelectionForExpand(e){setTimeout(()=>{const t=this._getSelectionsService().getCurrentLastSelection();if(t==null)return;const{startRow:n,startColumn:s,endRow:i,endColumn:r}=t.range,o=this._getViewportBounding();if(o==null)return;const{startRow:a,startColumn:l,endRow:u,endColumn:d}=o;let c=0,h=0;n>a?c=i:i<u?c=n:c=a,s>l?h=r:r<d?h=s:h=l,e.direction===Z.DOWN?c=i:e.direction===Z.UP?c=n:e.direction===Z.RIGHT?h=r:e.direction===Z.LEFT&&(h=s),this._scrollToCell(c,h)},0)}_getFreeze(){var e;const t=(e=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:e.skeleton.getWorksheetConfig();if(t!=null)return t.freeze}_updateSceneSize(e){var t;if(e==null)return;const{unitId:n}=this._context,{skeleton:s}=e,i=(t=this._renderManagerService.getRenderById(n))==null?void 0:t.scene;if(s==null||i==null)return;const{rowTotalHeight:r,columnTotalWidth:o,rowHeaderWidthAndMarginLeft:a,columnHeaderHeightAndMarginTop:l}=s;this._context.unit.getActiveSheet()&&i?.transformByState({width:a+o,height:l+r})}_getSheetObject(){return Rs(this._context.unit,this._context)}_scrollToSelectionByDirection(e){const t=this._getViewportBounding();if(t==null)return!1;const{startRow:n,startColumn:s,endRow:i,endColumn:r}=t;let o=0,a=0;const{startRow:l,startColumn:u,endRow:d,endColumn:c}=e;l>=n&&(o=d),d<=i&&(o=l),u>=s&&(a=c),c<=r&&(a=u),this._scrollToCell(o,a)}_scrollToSelection(e=!0){var t;const n=this._getSelectionsService().getCurrentLastSelection();if(!n)return;const{startRow:s,startColumn:i,actualRow:r,actualColumn:o}=(t=n.primary)!=null?t:n.range,a=e&&r!=null?r:s,l=e&&o!=null?o:i;this._scrollToCell(a,l)}_getSelectionsService(){return Zi(this._injector)}_getViewportBounding(){var e,t;const n=(e=this._getSheetObject())==null?void 0:e.scene;if(n==null)return;const s=n.getViewport($.VIEW_MAIN);if(s==null)return;const i=(t=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:t.skeleton;if(i==null)return;const r=s.calcViewportInfo();return i.getRangeByViewBound(r.viewBound)}_scrollToCell(e,t,n=!1,s=!1){var i,r,o;const{rowHeightAccumulation:a,columnWidthAccumulation:l}=(i=this._sheetSkeletonManagerService.getCurrentSkeleton())!=null?i:{};if(a==null||l==null)return!1;const u=(r=this._getSheetObject())==null?void 0:r.scene;if(u==null)return!1;const d=u.getViewport($.VIEW_MAIN);if(d==null)return!1;const c=(o=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:o.skeleton;if(c==null)return!1;const h=this._context.unit.getActiveSheet();if(!h)return!1;e=Q.clamp(e,0,a.length-1),t=Q.clamp(t,0,l.length-1);const{startColumn:g,startRow:m,ySplit:p,xSplit:f}=h.getFreeze(),v=this._getViewportBounding();if(v==null)return!1;const{startRow:C,startColumn:w,endRow:b,endColumn:I}=v;let _,R;if(e>=m&&t>=g-p&&(e<=C&&(_=e,n=!0),e>=b)){const O=a[e]-d.height;for(let k=C;k<=e&&(_=k+1,!(a[k]>=O));k++);}if(t>=g&&e>=m-p&&(t<=w&&(R=t,s=!0),t>=I)){const O=l[t]-d.width;for(let k=w;k<=t&&(R=k+1,!(l[k]>=O));k++);}if(_===void 0&&R===void 0)return!1;let{offsetX:M,offsetY:x,sheetViewStartRow:N,sheetViewStartColumn:T}=this._scrollManagerService.getCurrentScrollState()||{};if(_=_?Math.min(_,e):N+p,R=R?Math.min(R,t):T+f,s){M=0,R=t;const O=c.getHiddenColumnsInRange({startColumn:R-f,endColumn:R});R=R-O.length}if(n){x=0,_=e;const O=c.getHiddenRowsInRange({startRow:_-p,endRow:_});_=_-O.length}return this._commandService.syncExecuteCommand(Ss.id,{sheetViewStartRow:Math.max(0,_-p),sheetViewStartColumn:Math.max(0,R-f),offsetX:M,offsetY:x})}};ra=gk([wo(1,V(pt)),wo(2,V(Te)),wo(3,Ne),wo(4,U),wo(5,ze),wo(6,V(Sn))],ra);const mr={id:"sheet.operation.set-scroll",type:H.OPERATION,handler:(e,t)=>{if(!t)return!1;const{unitId:n,sheetId:s,offsetX:i=0,offsetY:r=0,sheetViewStartColumn:o,sheetViewStartRow:a,duration:l,screenRatioX:u,screenRatioY:d}=t,c=e.get(ze),h=c.getRenderById(n).with(Sn),g=c.getRenderById(n);if(!g)return!1;const m=g.engine,p=m.width,f=m.height,v=u!==void 0?p*u+i:i,C=d!==void 0?f*d+r:r;return h.emitRawScrollParam({unitId:n,sheetId:s,offsetX:v,offsetY:C,sheetViewStartRow:a,sheetViewStartColumn:o,duration:l}),!0}},Kl={id:"sheet.command.set-scroll-relative",type:H.COMMAND,handler:async(e,t)=>{const n=e.get(U),s=e.get(P),i=e.get(ze),r=Y(s);if(!r)return!1;const{unitId:o,subUnitId:a}=r,l=i.getRenderById(o).with(Sn).getCurrentScrollState(),{offsetX:u=0,offsetY:d=0}=t||{},{sheetViewStartRow:c=0,sheetViewStartColumn:h=0,offsetX:g=0,offsetY:m=0}=l||{};return n.executeCommand(mr.id,{unitId:o,sheetId:a,sheetViewStartRow:c,sheetViewStartColumn:h,offsetX:g+u,offsetY:m+d})}},Ss={id:"sheet.command.scroll-view",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const n=e.get(P),s=e.get(ze),i=Y(n);if(!i)return!1;const{workbook:r,worksheet:o,unitId:a}=i,l=s.getRenderById(a).with(Sn).getCurrentScrollState();if(!o)return!1;const{sheetViewStartRow:u,sheetViewStartColumn:d,offsetX:c,offsetY:h,duration:g}=t,{sheetViewStartColumn:m,sheetViewStartRow:p,offsetX:f,offsetY:v}=l||{},{xSplit:C,ySplit:w}=i.worksheet.getConfig().freeze;return e.get(U).syncExecuteCommand(mr.id,{unitId:r.getUnitId(),sheetId:o.getSheetId(),sheetViewStartRow:u??p??0+w,sheetViewStartColumn:d??m??0+C,offsetX:c??f,offsetY:h??v,duration:g})}},bf={id:"sheet.command.scroll-to-cell",type:H.COMMAND,handler:(e,t)=>{const n=e.get(P);return e.get(ze).getRenderById(n.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId()).with(ra).scrollToRange(t.range,t.forceTop,t.forceLeft)}},AP={id:"sheet.command.scroll-view-reset",type:H.COMMAND,handler:async e=>{const t=e.get(P),n=Y(t);if(!n)return!1;const{subUnitId:s,unitId:i}=n;return e.get(U).executeCommand(mr.id,{unitId:i,sheetId:s,sheetViewStartRow:0,sheetViewStartColumn:0})}};var pk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Qv=(e,t)=>(n,s)=>t(n,s,e);const fk=(e,t)=>{const{unitId:n,subUnitId:s,ranges:i}=e,r={},o=t.getColumnManager();for(let a=0;a<i.length;a++){const l=i[a];for(let u=l.startColumn;u<l.endColumn+1;u++)r[u]=o.getColumnWidth(u)}return{unitId:n,subUnitId:s,ranges:i,colWidth:r}};let qr=class extends ae{constructor(e,t){super(),this._renderManagerService=e,this._univerInstanceService=t}getUndoRedoParamsOfColWidth(e){const t={redos:[],undos:[]},{_univerInstanceService:n}=this,s=Y(n,e);if(!s)return t;const{unitId:i,subUnitId:r,worksheet:o}=s,a=this._renderManagerService.getRenderById(i).with(Te);if(!a.getCurrentParam())return t;const{skeleton:l}=a.getCurrentParam(),u=l.calculateAutoWidthInRange(e.ranges),d={};for(const{col:g,width:m}of u)d[g]=m;const c={subUnitId:r,unitId:i,ranges:e.ranges,colWidth:d},h=fk(c,o);return{undos:[{id:Cn.id,params:h}],redos:[{id:Cn.id,params:c}]}}};qr=pk([Qv(0,ze),Qv(1,V(P))],qr);const Eu={type:H.COMMAND,id:"sheet.command.set-col-auto-width",handler:(e,t)=>{const n=e.get(U),s=e.get(ce),i=e.get(q),r=e.get(P),o=Y(r,t);if(!o)return!1;const{unitId:a,subUnitId:l}=o;let u=[];if(t!=null&&t.ranges)u=[...t.ranges];else{const g=i.getCurrentSelections();for(let m=0;m<g.length;m++)u.push(g[m].range)}if(!(u!=null&&u.length))return!1;const d={unitId:a,subUnitId:l,ranges:u},{redos:c,undos:h}=e.get(qr).getUndoRedoParamsOfColWidth(d);return fe([...c],n).result?(s.pushUndoRedo({unitID:a,undoMutations:[...h],redoMutations:[...c]}),!0):!1}};var vk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},So=(e,t)=>(n,s)=>t(n,s,e);let ic=class extends ae{constructor(e,t,n,s,i,r){super(),y(this,"_editorUnitId",rt),y(this,"_editorIsDirty",!1),y(this,"_visibleParams",{visible:!1,eventType:bt.Dblclick,unitId:""}),y(this,"_currentEditCell",null),y(this,"_currentEditCellState",null),y(this,"_currentEditCellLayout",null),y(this,"helpFunctionVisible$",new xe(!0)),y(this,"_currentEditCellState$",new xe(null)),y(this,"currentEditCellState$",this._currentEditCellState$.asObservable()),y(this,"_currentEditCellLayout$",new xe(null)),y(this,"currentEditCellLayout$",this._currentEditCellLayout$.asObservable()),y(this,"currentEditCell$",this._currentEditCellState$.pipe($e(o=>this._currentEditCellLayout$.pipe(Se(a=>o&&a?{...o,...a}:null))))),y(this,"_visibleParams$",new xe(this._visibleParams)),y(this,"visible$",this._visibleParams$.asObservable()),y(this,"_afterVisibleParams$",new xe(this._visibleParams)),y(this,"afterVisible$",this._afterVisibleParams$.asObservable()),y(this,"_forceKeepVisible$",new xe(!1)),y(this,"forceKeepVisible$",this._forceKeepVisible$.asObservable()),this._sheetInterceptorService=e,this._renderManagerService=t,this._themeService=n,this._univerInstanceService=s,this._editorService=i,this._contextService=r,this.disposeWithMe(He(()=>{this._currentEditCellState$.complete(),this._currentEditCell=null})),this._univerInstanceService.getTypeOfUnitDisposed$(A.UNIVER_SHEET).subscribe(o=>{var a;o.getUnitId()===((a=this._currentEditCellState)==null?void 0:a.unitId)&&this._clearCurrentEditCellState()})}refreshEditCellState(){const e=this.getLatestEditCellState();if(!e){this._currentEditCellState=null,this._currentEditCellLayout=null,this._currentEditCellState$.next(null),this._currentEditCellLayout$.next(null);return}const{position:t,scaleX:n,scaleY:s,canvasOffset:i,...r}=e;this._currentEditCellState=r,this._currentEditCellLayout={position:t,scaleX:n,scaleY:s,canvasOffset:i},this._currentEditCellState$.next(this._currentEditCellState),this._currentEditCellLayout$.next(this._currentEditCellLayout)}refreshEditCellPosition(e){var t;const n=this._currentEditCell;if(n==null)return;const s=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!s)return;const i=this._renderManagerService.getRenderUnitById(s.getUnitId());if(!i)return;const r=(t=i.with(Te).getSkeletonParam(n.sheetId))==null?void 0:t.skeleton,o=i.with(Zt);if(!r||!this._currentEditCellState)return;const{primary:a,scene:l,engine:u}=n,d=Kd(r,a);if(d==null)return;const c=md(d),h=Bf(u);let{startX:g,startY:m,endX:p,endY:f}=c;const{scaleX:v,scaleY:C}=l.getAncestorScale(),w=l.getViewportScrollXY(o.getViewPort());g=Ro(g,v,w),m=yo(m,C,w),p=Ro(p,v,w),f=yo(f,C,w),e&&this._currentEditCellLayout&&(p=p-g+this._currentEditCellLayout.position.startX,f=f-m+this._currentEditCellLayout.position.startY,g=this._currentEditCellLayout.position.startX,m=this._currentEditCellLayout.position.startY),this._currentEditCellLayout={position:{startX:g,startY:m,endX:p,endY:f},canvasOffset:h,scaleX:v,scaleY:C},this._currentEditCellLayout$.next(this._currentEditCellLayout)}setEditCell(e){this._currentEditCell=e,this._editorService.getFocusEditor()||(this._editorService.focus(rt),this._contextService.setContextValue(It,!1),this._contextService.setContextValue(Lc,!1));const t=this.getLatestEditCellState();if(!t){this._currentEditCellState=t,this._currentEditCellLayout=t,this._currentEditCellState$.next(t),this._currentEditCellLayout$.next(t);return}const{position:n,canvasOffset:s,scaleX:i,scaleY:r,...o}=t;this._currentEditCellState=o,this._currentEditCellLayout={position:n,canvasOffset:s,scaleX:i,scaleY:r},this._currentEditCellState$.next(this._currentEditCellState),this._currentEditCellLayout$.next(this._currentEditCellLayout)}_clearCurrentEditCellState(){this._currentEditCellState=null,this._currentEditCellState$.next(null),this._currentEditCellLayout=null,this._currentEditCellLayout$.next(null)}getEditCellState(){return this._currentEditCellState==null||this._currentEditCellLayout==null?null:{...this._currentEditCellState,...this._currentEditCellLayout}}getEditCellLayout(){return this._currentEditCellLayout}getEditLocation(){return this._currentEditCellState}updateEditLocation(e,t){this._currentEditCellState&&(this._currentEditCellState={...this._currentEditCellState,row:e,column:t})}getLatestEditCellState(){var e,t,n;const s=this._currentEditCell;if(s==null)return;const i=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!i)return;const r=this._renderManagerService.getRenderUnitById(i.getUnitId());if(!r)return;const o=r.with(Te).getCurrentSkeleton(),a=r.with(Zt);if(!o)return;const{primary:l,unitId:u,sheetId:d,scene:c,engine:h}=s,{startRow:g,startColumn:m}=l,p=Kd(o,l);if(p==null)return;const f=md(p),v=Bf(h);let{startX:C,startY:w,endX:b,endY:I}=f;const{scaleX:_,scaleY:R}=c.getAncestorScale(),M=c.getViewportScrollXY(a.getViewPort());C=Ro(C,_,M),w=yo(w,R,M),b=Ro(b,_,M),I=yo(I,R,M);const x=i.getActiveSheet();if(!x)return;const N={workbook:i,worksheet:x,unitId:i.getUnitId(),subUnitId:x.getSheetId(),row:g,col:m,origin:x.getCellRaw(g,m)};let T;const O=this._sheetInterceptorService.writeCellInterceptor.fetchThroughInterceptors(em)(x.getCell(g,m),N);T=O&&x.getCellDocumentModelWithFormula(O,N.row,N.col);const k=(e=T?.documentModel)==null?void 0:e.documentStyle.renderConfig;if(k!=null&&(k.cellValueType=je.STRING),!T||T.documentModel==null){const D=x.getBlankCellDocumentModel(O,N.row,N.col);if(T!=null){const{verticalAlign:B,horizontalAlign:W,wrapStrategy:F,textRotation:K,fill:J}=T,{centerAngle:ee,vertexAngle:we}=Ym(K);D.documentModel.documentStyle.renderConfig={...k,verticalAlign:B,horizontalAlign:W,wrapStrategy:F,background:{rgb:J},centerAngle:ee,vertexAngle:we}}T=D}if(T.fill=T.fill||"#fff",(t=T.documentModel)==null||t.setZoomRatio(Math.max(_,R)),O?.isInArrayFormulaRange===!0){const D=(n=T.documentModel)==null?void 0:n.getBody();D&&(D.textRuns=[{st:0,ed:D.dataStream.length-2,ts:{cl:{rgb:this._themeService.getColorFromTheme("gray.300")}}}])}return{position:{startX:C,startY:w,endX:b,endY:I},scaleX:_,scaleY:R,canvasOffset:v,row:g,column:m,unitId:u,sheetId:d,documentLayoutObject:T,editorUnitId:this._editorUnitId,isInArrayFormulaRange:O?.isInArrayFormulaRange}}getCurrentEditorId(){return this._editorUnitId}changeVisible(e){this._visibleParams=e,e.visible&&(this._editorIsDirty=!1),this._visibleParams$.next(this._visibleParams),this._afterVisibleParams$.next(this._visibleParams)}isVisible(){return this._visibleParams}enableForceKeepVisible(){this._forceKeepVisible$.next(!0)}disableForceKeepVisible(){this._forceKeepVisible$.next(!1)}isForceKeepVisible(){return this._forceKeepVisible$.getValue()}changeEditorDirty(e){this._editorIsDirty=e}getEditorDirty(){return this._editorIsDirty}};ic=vk([So(0,V(_e)),So(1,ze),So(2,V(xn)),So(3,P),So(4,no),So(5,Ne)],ic);const xt=bn("univer.sheet-editor-bridge.service");var Ck=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},zu=(e,t)=>(n,s)=>t(n,s,e);let $l=class extends ae{constructor(e,t,n,s,i){super(),y(this,"_zoom"),this._context=e,this._sheetSkeletonManagerService=t,this._commandService=n,this._contextService=s,this._editorBridgeService=i,this._initSkeletonListener(),this._initZoomEventListener()}updateZoom(e,t){const n=this._context.unit.getSheetBySheetId(e);return n?(n.getConfig().zoomRatio=t,n===this._context.unit.getActiveSheet()&&this._updateViewZoom(t),!0):!1}_initZoomEventListener(){const e=Rs(this._context.unit,this._context).scene;this.disposeWithMe(e.onMouseWheel$.subscribeEvent(t=>{if(!t.ctrlKey||!this._contextService.getContextValue(kn))return;if(this._editorBridgeService){const l=this._editorBridgeService.isVisible();if((l.unitId===this._context.unitId||l.unitId===it)&&l.visible)return}const n=Math.abs(t.deltaX);let s=n<40?.2:n<80?.4:.2;s*=t.deltaY>0?-1:1,e.scaleX<1&&(s/=2);const i=this._context.unit,r=i.getActiveSheet();if(!r)return;const o=r.getZoomRatio();let a=+Number.parseFloat(`${o+s}`).toFixed(1);a=a>=4?4:a<=.1?.1:a,this._commandService.executeCommand(Da.id,{zoomRatio:Math.round(a*10)/10,unitId:i.getUnitId(),subUnitId:r.getSheetId()}),t.preventDefault()}))}_initSkeletonListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{if(e==null)return;const t=this._context.unit.getActiveSheet();if(!t)return;const n=t.getZoomRatio()||1;this._zoom!==n&&this._updateViewZoom(n)}))}_updateViewZoom(e){this._zoom=e;const t=Rs(this._context.unit,this._context);t?.scene.scale(e,e),t?.spreadsheet.makeForceDirty()}};$l=Ck([zu(1,V(Te)),zu(2,U),zu(3,Ne),zu(4,Wc(xt))],$l);const Mi={id:"sheet.operation.set-zoom-ratio",type:H.OPERATION,handler:(e,t)=>{const n=e.get(ze).getRenderById(t.unitId);return n?n.with($l).updateZoom(t.subUnitId,t.zoomRatio):!1}},xu={id:"sheet.command.change-zoom-ratio",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const n=e.get(P),s=Y(n);if(!s)return!1;const{worksheet:i,subUnitId:r,unitId:o}=s,{delta:a,reset:l}=t;let u=l?100:Math.round((i.getConfig().zoomRatio+a)*100);u=Math.max(gm[0],u),u=Math.min(gm[1],u);const d=u/100,c=e.get(xt).isVisible();return(c.unitId===o||c.unitId===it)&&c.visible?!1:e.get(U).executeCommand(Mi.id,{unitId:o,subUnitId:r,zoomRatio:d})}},Da={id:"sheet.command.set-zoom-ratio",type:H.COMMAND,handler:(e,t)=>{if(!t)return!1;const{unitId:n,subUnitId:s,zoomRatio:i}=t,r=e.get(xt).isVisible();return(r.unitId===n||r.unitId===it)&&r.visible?!1:e.get(U).executeCommand(Mi.id,{unitId:n,subUnitId:s,zoomRatio:i})}},ho=bn("univer.sheetbar-service");class wb extends ae{constructor(){super(),y(this,"renameId$"),y(this,"removeId$"),y(this,"scroll$"),y(this,"scrollX$"),y(this,"addSheet$"),y(this,"_renameId$"),y(this,"_removeId$"),y(this,"_scroll$"),y(this,"_scrollX$"),y(this,"_addSheet$"),y(this,"_currentHandler",null),this._renameId$=new Ve,this.renameId$=this._renameId$.asObservable(),this._removeId$=new Ve,this.removeId$=this._removeId$.asObservable(),this._scroll$=new Ve,this.scroll$=this._scroll$.asObservable(),this._scrollX$=new Ve,this.scrollX$=this._scrollX$.asObservable(),this._addSheet$=new Ve,this.addSheet$=this._addSheet$.asObservable()}setRenameId(t){this._renameId$.next(t)}setRemoveId(t){this._removeId$.next(t)}setScroll(t){this._scroll$.next(t)}setScrollX(t){this._scrollX$.next(t)}setAddSheet(t){this._addSheet$.next(t)}triggerSheetBarMenu(){var t;(t=this._currentHandler)==null||t.handleSheetBarMenu()}registerSheetBarMenuHandler(t){if(this._currentHandler)throw new Error("There is already a context menu handler!");return this._currentHandler=t,He(()=>{this._currentHandler=null})}}const Th={id:"ui-sheet.command.show-menu-list",type:H.OPERATION,handler:async e=>(e.get(ho).triggerSheetBarMenu(),!0)},Ph={type:H.COMMAND,id:"sheet.command.delete-worksheet-protection-from-sheet-bar",async handler(e,t){if(!t)return!1;const n=e.get(U),s=e.get(ce),i=e.get(ft),r=e.get(P).getCurrentUnitForType(mb.UNIVER_SHEET),o=r?.getActiveSheet(),a=r.getUnitId();if(!o)return!1;const l=o.getSheetId(),u=i.getRule(a,l);if(await n.executeCommand(Ul.id,{unitId:a,subUnitId:l})){const d=[{id:Ul.id,params:{unitId:a,subUnitId:l}}],c=[{id:Dp.id,params:{unitId:a,rule:u}}];s.pushUndoRedo({unitID:a,redoMutations:d,undoMutations:c})}return!0}},Uh={type:H.COMMAND,id:"sheet.command.change-sheet-protection-from-sheet-bar",async handler(e){return await e.get(U).executeCommand("sheet-permission.operation.openDialog"),!0}},_f={id:"sheet.operation.set-activate-cell-edit",type:H.OPERATION,handler:(e,t)=>(e.get(xt).setEditCell(t),!0)},Jt="sheets-ui.config",rc={formulaBar:!0,statusBarStatistic:!0,protectedRangeShadow:!0,maxAutoHeightCount:1e3};function If(e){return e===!0?"always":e===!1?"none":e||"always"}const At={id:"sheet.operation.set-cell-edit-visible",type:H.OPERATION,handler:(e,t)=>{var n;if(!t||(n=e.get(Lt).getConfig(Jt))!=null&&n.disableEdit&&t.visible)return!1;const{unitId:s}=t,i=e.get(P).getCurrentUnitForType(A.UNIVER_SHEET);return i?(e.get(xt).changeVisible({...t,unitId:s??i.getUnitId()}),!0):!1}},Nh={id:"sheet.operation.set-cell-edit-visible-f2",type:H.OPERATION,handler:(e,t)=>{const n=e.get(U),s=e.get(P).getCurrentUnitForType(A.UNIVER_SHEET);return s?n.syncExecuteCommand(At.id,{...t,unitId:s.getUnitId()}):!1}},oa={id:"sheet.operation.set-cell-edit-visible-arrow",type:H.OPERATION,handler:()=>!0},Oh={id:"sheet.operation.rename-sheet",type:H.OPERATION,handler:async(e,t)=>{const n=e.get(ho);return t&&n.setRenameId(t.subUnitId),!0}},Rf={id:"sheet.operation.scroll-to-range",type:H.OPERATION,handler:(e,t)=>{if(!t)return!1;const n=e.get(P);return e.get(ze).getRenderById(n.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId()).with(ra).scrollToRange(t.range,t.forceTop,t.forceLeft)}},Sb={type:H.OPERATION,id:"sheet-permission.operation.openDialog",async handler(e,t){const n=e.get(uu);return n.close("DESKTOP_FIND_REPLACE_DIALOG"),n.open({id:nc,title:{title:"permission.dialog.allowedPermissionType"},children:{label:fb},width:393,destroyOnClose:!0,onClose:()=>n.close(nc)}),!0}},Jl="DefinedNameContainer",yf={id:"sidebar.operation.defined-name",type:H.COMMAND,handler:async(e,t)=>{const n=e.get(_a);e.get(no);const s=e.get(Oe),i=e.get(P),r=Y(i);if(!r)return!1;const{unitId:o}=r;return t.value==="open"?n.open({id:Jl,header:{title:s.t("definedName.featureTitle")},children:{label:Jl},onClose:()=>{},width:333}):n.close(),!0}};function wk(e,t){if(e.length!==t.length)return!1;const n=e.sort((i,r)=>i.id.localeCompare(r.id)),s=t.sort((i,r)=>i.id.localeCompare(r.id));return n.every((i,r)=>{var o,a;return((o=i.subject)==null?void 0:o.userID)===((a=s[r].subject)==null?void 0:a.userID)&&i.role===s[r].role})}function Sk(e,t){return t.some(n=>bk(e,n))}function bk(e,t){const{startRow:n,startColumn:s,endColumn:i,endRow:r}=t,o=e.getMatrixWithMergedCells(n,s,r,i);let a=!1;return o.forValue((l,u,d)=>{if(d&&(l!==n||u!==s)&&e.cellHasValue(d))return a=!0,!1}),a}function _k(e,t,n,s){const i=n.getActiveViewportByCoord(at.FromArray([e,t]));if(!i)return;const{scaleX:r,scaleY:o}=n.getAncestorScale(),a={x:i.viewportScrollX,y:i.viewportScrollY},l=s.getCellIndexByOffset(e,t,r,o,a),u=s.worksheet.getMergedCell(l.row,l.column);return{actualRow:u?u.startRow:l.row,actualCol:u?u.startColumn:l.column,mergeCell:u,row:l.row,col:l.column}}function Kv(e,t,n,s){const i=s.getFreeze();if(!i||i.startRow<=0&&i.startColumn<=0)return n.getViewport($.VIEW_MAIN);if(e>=i.startRow&&t>=i.startColumn)return n.getViewport($.VIEW_MAIN);if(e<i.startRow&&t<i.startColumn)return n.getViewport($.VIEW_MAIN_LEFT_TOP);if(e<i.startRow&&t>=i.startColumn)return n.getViewport($.VIEW_MAIN_TOP);if(e>=i.startRow&&t<i.startColumn)return n.getViewport($.VIEW_MAIN_LEFT)}function Ik(e,t,n,s){const i=$v(e.left,e.top,t,n,s),r=$v(e.right,e.bottom,t,n,s);return{left:i.x,top:i.y,right:r.x,bottom:r.y}}function $v(e,t,n,s,i){const{scaleX:r,scaleY:o}=n.getAncestorScale(),a=n.getViewport($.VIEW_MAIN);if(!a)return{x:e,y:t};const l=i.getFreeze(),{startColumn:u,startRow:d,xSplit:c,ySplit:h}=l,g=s.getNoMergeCellWithCoordByIndex(d-h,u-c,!1),m=s.getNoMergeCellWithCoordByIndex(d,u,!1),{rowHeaderWidth:p,columnHeaderHeight:f}=s,v=m.startX-g.startX,C=m.startY-g.startY,{top:w,left:b,viewportScrollX:I,viewportScrollY:_}=a;let R;e>b?R=(e-I)*r:R=(v+p-(b-e))*r;let M;return t>w?M=(t-_)*o:M=(C+f-(w-t))*r,{x:R,y:M}}function Rk(e,t,n,s,i){let r=s,o=i;n.overflowCache.forValue((l,u,d)=>{d.startRow<=r&&d.endRow>=r&&d.startColumn<=o&&d.endColumn>=o&&(o=u,r=l)});const a=n.getCellWithCoordByIndex(r,o);return{unitId:e.getUnitId(),subUnitId:t.getSheetId(),workbook:e,worksheet:t,row:a.actualRow,col:a.actualColumn}}function bb(e,t,n,s,i,r){const{scene:o}=e,a=t.getUnitId(),{skeleton:l,sheetId:u}=s,d=_k(i,r,o,l);if(!d)return null;let{actualCol:c,actualRow:h}=d;const g={unitId:a,subUnitId:u,workbook:t,worksheet:n,row:h,col:c};l.overflowCache.forValue((I,_,R)=>{R.startRow<=h&&R.endRow>=h&&R.startColumn<=c&&R.endColumn>=c&&(c=_,h=I)});const m=l.getCellWithCoordByIndex(h,c),p=Rk(t,n,l,h,c);let f;m.mergeInfo?f=m.mergeInfo:f={startRow:p.row,endRow:p.row,startColumn:p.col,endColumn:p.col};const v=o.getActiveViewportByCoord(at.FromArray([i,r]));if(!v)return;const{scaleX:C,scaleY:w}=o.getAncestorScale(),b={x:v.viewportScrollX,y:v.viewportScrollY};return{position:{startX:(l.getOffsetByColumn(f.startColumn-1)-b.x)*C,endX:(l.getOffsetByColumn(f.endColumn)-b.x)*C,startY:(l.getOffsetByRow(f.startRow-1)-b.y)*w,endY:(l.getOffsetByRow(f.endRow)-b.y)*w},location:g,overflowLocation:p}}function go(){const e=G(P),t=zt(()=>e.getCurrentTypeOfUnit$(A.UNIVER_SHEET),void 0,void 0,[]);return t??null}function VP(e){return zt(()=>{var t;return(t=e?.activeSheet$)!=null?t:Re(null)},void 0,void 0,[e])}function HP(){const e=G(P);return zt(()=>Ut([e.getTypeOfUnitAdded$(A.UNIVER_SHEET),e.getTypeOfUnitDisposed$(A.UNIVER_SHEET)]).pipe(Se(()=>e.getAllUnitsForType(A.UNIVER_SHEET)),Nt(e.getAllUnitsForType(A.UNIVER_SHEET))),[],void 0,[e])}const DP="SheetUI";var _b=(e=>(e.FILTER_PANEL_EMBED_POINT="filter-panel-embed-point",e.SHEETS_FOOTER="sheets-footer",e.FORMULA_AUX="formula-aux",e))(_b||{}),yk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Xu=(e,t)=>(n,s)=>t(n,s,e);const Jv="univer-sheet-main-canvas";let ir=class extends Ms{constructor(e,t,n,s){super(),y(this,"_skeletonChangeMutations",new Set),this._contextService=e,this._instanceSrv=t,this._renderManagerService=n,this._themeService=s,Promise.resolve().then(()=>this._init())}registerSkeletonChangingMutations(e){return this._skeletonChangeMutations.has(e)?He(()=>{}):(this._skeletonChangeMutations.add(e),He(()=>this._skeletonChangeMutations.delete(e)))}checkMutationShouldTriggerRerender(e){return this._skeletonChangeMutations.has(e)}_init(){this._initWorkbookListener(),this._initContextListener()}_initWorkbookListener(){this._instanceSrv.getTypeOfUnitAdded$(A.UNIVER_SHEET).pipe(ln(this.dispose$)).subscribe(e=>this._createRenderer(e)),this._instanceSrv.getAllUnitsForType(A.UNIVER_SHEET).forEach(e=>this._createRenderer(e)),this._instanceSrv.getTypeOfUnitDisposed$(A.UNIVER_SHEET).pipe(ln(this.dispose$)).subscribe(e=>this._disposeRenderer(e))}_createRenderer(e){const t=e.getUnitId();this._renderManagerService.created$.subscribe(n=>{n.unitId===t&&(n.engine.getCanvas().setId(`${Jv}_${t}`),n.engine.getCanvas().getContext().setId(`${Jv}_${t}`))}),this._renderManagerService.createRender(t)}_disposeRenderer(e){const t=e.getUnitId();this._renderManagerService.removeRender(t)}_initContextListener(){this.disposeWithMe(this._contextService.subscribeContextValue$(i0).pipe(yn()).subscribe(()=>{this._renderManagerService.getRenderAll().forEach(e=>{e.mainComponent instanceof vw&&e.mainComponent.makeForceDirty(!0)})}))}};ir=yk([Xu(0,Ne),Xu(1,P),Xu(2,ze),Xu(3,V(xn))],ir);var Mk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},pr=(e,t)=>(n,s)=>t(n,s,e);let aa=class extends ae{constructor(e,t,n,s,i,r,o){super(),y(this,"_currentLocation",null),this._univerInstanceService=e,this._commandService=t,this._autoFillService=n,this._autoFillController=s,this._editorBridgeService=i,this._renderManagerService=r,this._sheetsRenderService=o,this._init()}_init(){this._initDefaultHook(),this._initSelectionControlFillChanged(),this._initQuitListener(),this._initSkeletonChange()}_initSkeletonChange(){this.disposeWithMe(this._sheetsRenderService.registerSkeletonChangingMutations(Er.id))}_initDefaultHook(){this.disposeWithMe(this._autoFillService.addHook({id:"default-ui",type:Mr.DEFAULT,priority:0,onBeforeFillData:e=>{this._currentLocation=e}}))}_initQuitListener(){const e=[At.id,Vd.id,An.id,Mi.id,lt.id,Mn.id,an.id,$t.id,rn.id,on.id,Wn.id,Ln.id,Cn.id,os.id,le.id];this.disposeWithMe(this._commandService.onCommandExecuted((t,n)=>{var s,i;const r=n?.fromCollab,o=n?.fromSync,a=n?.fromFormula;e.includes(t.id)&&!r&&!o&&!a&&t.params.trigger!==Er.id&&t.params.trigger!==Gp.id&&this._quit(),t.id===En.id&&t.params.unitId===((s=this._currentLocation)==null?void 0:s.unitId)&&t.params.subUnitId===((i=this._currentLocation)==null?void 0:i.subUnitId)&&this._quit()})),this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe(t=>{var n;t.getUnitId()===((n=this._currentLocation)==null?void 0:n.unitId)&&this._quit()}))}_quit(){this._currentLocation=null,this._autoFillController.quit(),this._autoFillService.setShowMenu(!1)}_initSelectionControlFillChanged(){const e=new Et,t=()=>{e.dispose();const n=du(A.UNIVER_SHEET,this._univerInstanceService,this._renderManagerService);n&&n.with(Zt).getSelectionControls().forEach(s=>{e.add(s.selectionFilled$.subscribe(i=>{if(i==null||i.startColumn===-1||i.startRow===-1||i.endColumn===-1||i.endRow===-1)return;const r={startColumn:s.model.startColumn,endColumn:s.model.endColumn,startRow:s.model.startRow,endRow:s.model.endRow},o={startColumn:i.startColumn,endColumn:i.endColumn,startRow:i.startRow,endRow:i.endRow};this._commandService.executeCommand(Er.id,{sourceRange:r,targetRange:o})})),e.add(s.fillControl.onDblclick$.subscribeEvent(()=>{const i={startColumn:s.model.startColumn,endColumn:s.model.endColumn,startRow:s.model.startRow,endRow:s.model.endRow};this._handleDbClickFill(i)})),e.add(s.fillControl.onPointerDown$.subscribeEvent(()=>{this._editorBridgeService.isVisible().visible&&this._commandService.syncExecuteCommand(At.id,{visible:!1,eventType:bt.PointerDown,unitId:n.unitId})}))})};t(),this.disposeWithMe(this._commandService.onCommandExecuted(n=>{n.id===me.id&&t()})),this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(()=>t()))}_handleDbClickFill(e){const t=this._detectFillRange(e);t.endRow<=e.endRow||this._commandService.executeCommand(Er.id,{sourceRange:e,targetRange:t})}_detectFillRange(e){var t,n,s,i,r,o;const{startRow:a,endRow:l,startColumn:u,endColumn:d}=e,c=(t=this._univerInstanceService.getCurrentUnitOfType(A.UNIVER_SHEET))==null?void 0:t.getActiveSheet();if(!c)return e;const h=c.getCellMatrix(),g=c.getMaxRows(),m=c.getMaxColumns();let p=l+1;if(u>0&&((n=h.getValue(p,u-1))==null?void 0:n.v)!=null)for(;((s=h.getValue(p+1,u-1))==null?void 0:s.v)!=null&&p<g;)p+=1;else if(d<m-1&&((i=h.getValue(p,d+1))==null?void 0:i.v)!=null)for(;((r=h.getValue(p+1,d+1))==null?void 0:r.v)!=null&&p<g;)p+=1;else p=l;for(let f=l+1;f<=p;f++)for(let v=u;v<=d;v++)if(((o=h.getValue(f,v))==null?void 0:o.v)!=null){p=f-1;break}return{startColumn:u,endColumn:d,startRow:a,endRow:p}}};aa=Mk([pr(0,P),pr(1,U),pr(2,Ua),pr(3,V(Vl)),pr(4,xt),pr(5,ze),pr(6,V(ir))],aa);var Ek=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ya=(e,t)=>(n,s)=>t(n,s,e);let la=class extends ae{constructor(e,t,n,s,i){super(),this._renderManagerService=e,this._sheetInterceptorService=t,this._selectionManagerService=n,this._univerInstanceService=s,this._configService=i,this._initialize()}_processLazyAutoHeight(e,t,n,s){if(s!=null&&s.length){const i={id:sf.id,params:{unitId:t,subUnitId:n,ranges:s,id:hn()},options:{onlyLocal:!0}},r={id:rf.id,params:{unitId:t,subUnitId:n,id:i.params.id},options:{onlyLocal:!0}};return{redos:[...e.redos,i],undos:[...e.undos,r]}}return e}getUndoRedoParamsOfAutoHeight(e,t,n){const{_univerInstanceService:s}=this,i=s.getCurrentUnitForType(A.UNIVER_SHEET),r=i.getUnitId();let o=i.getActiveSheet(),a=o.getSheetId();if(t){const h=Y(s,{unitId:r,subUnitId:t});h&&(o=h.worksheet,a=o.getSheetId())}const l=this._renderManagerService.getRenderById(r).with(Te).ensureSkeleton(a);if(!l)return{redos:[],undos:[]};const u=l.calculateAutoHeightInRange(e,n).filter(h=>{const{row:g,autoHeight:m}=h;return!(!m||o.getRowHeight(g)===m)});if(u.length===0)return{redos:[],undos:[]};const d={subUnitId:a,unitId:r,rowsAutoHeightInfo:u},c=op(d,o);return{undos:[{id:ds.id,params:c}],redos:[{id:ds.id,params:d}]}}_initialize(){this.disposeWithMe(this._sheetInterceptorService.interceptAutoHeight({getMutations:e=>{const{unitId:t,subUnitId:n,ranges:s,autoHeightRanges:i,lazyAutoHeightRanges:r,cellHeights:o}=e,a=this.getUndoRedoParamsOfAutoHeight(i??s,n,o);return this._processLazyAutoHeight(a,t,n,r)}}))}};la=Ek([Ya(0,ze),Ya(1,V(_e)),Ya(2,V(q)),Ya(3,V(P)),Ya(4,Lt)],la);var xk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},sg=(e,t)=>(n,s)=>t(n,s,e);let oc=class extends ae{constructor(e,t,n,s){super(),y(this,"_enterActiveRender"),this._context=e,this._sheetSkeletonManagerService=t,this._renderManagerService=n,this._permissionService=s,this._initEventBinding()}_initEventBinding(){const e=new Et,t=this._context.unit,n=s=>{if(e.dispose(),!s)return;const i=this._context.unitId,{skeleton:r}=s,o=this._renderManagerService.getRenderById(i);if(o&&o.mainComponent){const a=o.mainComponent,l=c=>{const{offsetX:h,offsetY:g}=c,m=o.scene,p=t.getActiveSheet();if(!p)return;const f=m.getActiveViewportByCoord(at.FromArray([h,g]));if(!f)return;const{scaleX:v,scaleY:C}=m.getAncestorScale(),w={x:f.viewportScrollX,y:f.viewportScrollY},b=r.getCellIndexByOffset(h,g,v,C,w),I=r.worksheet.getMergedCell(b.row,b.column),_={actualRow:I?I.startRow:b.row,actualCol:I?I.startColumn:b.column,row:b.row,col:b.column};if(!_||!r)return;const R=p.getCell(_.actualRow,_.actualCol);if(!R)return;const M=R.customRender;if(!(M!=null&&M.length))return;const x=_.actualRow,N=_.actualCol,T=M.sort(mI),O=p.getSheetId(),k={data:R,style:r.getStyles().getStyleByCell(R),primaryWithCoord:r.getCellWithCoordByIndex(_.actualRow,_.actualCol),unitId:i,subUnitId:O,row:x,col:N,workbook:t,worksheet:p},D={x:w.x+h/v,y:w.y+g/C},B=T.find(W=>{var F;return(F=W.isHit)==null?void 0:F.call(W,D,k)});if(B)return[B,k]},u=a.onPointerDown$.subscribeEvent(c=>{var h,g,m,p;const f=l(c);if(f){const[v,C]=f,{row:w,col:b,worksheet:I,unitId:_,subUnitId:R}=C;if(!((h=this._permissionService.composePermission([new ne(_).id,new oe(_,R).id]))!=null&&h.every(x=>x.value)))return!1;const M=(m=(g=I.getCell(w,b))==null?void 0:g.selectionProtection)==null?void 0:m[0];if(M?.[X.Edit]===!1)return!1;(p=v.onPointerDown)==null||p.call(v,C,c)}}),d=fd(a.onPointerMove$).pipe(wd(30)).subscribe(c=>{var h,g,m,p,f,v;const C=l(c);if(C){const[w,b]=C;this._enterActiveRender?this._enterActiveRender.render!==w&&((g=(h=this._enterActiveRender.render).onPointerLeave)==null||g.call(h,this._enterActiveRender.cellContext,c),this._enterActiveRender={render:w,cellContext:b},(m=w.onPointerEnter)==null||m.call(w,b,c)):(this._enterActiveRender={render:w,cellContext:b},(p=w.onPointerEnter)==null||p.call(w,b,c))}else this._enterActiveRender&&((v=(f=this._enterActiveRender.render).onPointerLeave)==null||v.call(f,this._enterActiveRender.cellContext,c),this._enterActiveRender=null)});u&&e.add(u),d&&e.add(d)}};this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n)),n(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(e)}};oc=xk([sg(1,V(Te)),sg(2,ze),sg(3,Je)],oc);var kk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},eC=(e,t)=>(n,s)=>t(n,s,e);let eu=class extends ae{constructor(e,t){super(),y(this,"_currentCell$",new Ve),y(this,"currentCell$",this._currentCell$.asObservable().pipe(yn((n,s)=>{var i,r,o,a,l,u,d,c;return((i=n?.location)==null?void 0:i.unitId)===((r=s?.location)==null?void 0:r.unitId)&&((o=n?.location)==null?void 0:o.subUnitId)===((a=s?.location)==null?void 0:a.subUnitId)&&((l=n?.location)==null?void 0:l.row)===((u=s?.location)==null?void 0:u.row)&&((d=n?.location)==null?void 0:d.col)===((c=s?.location)==null?void 0:c.col)}))),y(this,"_endCell$",new Ve),y(this,"endCell$",this._endCell$.asObservable()),this._univerInstanceService=e,this._renderManagerService=t,this._initCellDisposableListener()}dispose(){super.dispose(),this._currentCell$.complete(),this._endCell$.complete()}_initCellDisposableListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(e=>{e||(this._currentCell$.next(null),this._endCell$.next(null))}))}_calcActiveCell(e,t){const n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!n)return null;const s=n.getActiveSheet();if(!s)return;const i=this._renderManagerService.getRenderById(n.getUnitId());if(!i)return;const r=i.with(Te).getCurrentParam(),o=i.with(Sn).getCurrentScrollState();if(!(!r||!o||!i))return bb(i,n,s,r,e,t)}onDragOver(e){const{offsetX:t,offsetY:n,dataTransfer:s}=e,i=this._calcActiveCell(t,n);if(!i){this._currentCell$.next(null);return}const{location:r,position:o}=i;this._currentCell$.next({location:r,position:o,dataTransfer:s})}onDrop(e){const{offsetX:t,offsetY:n,dataTransfer:s}=e,i=this._calcActiveCell(t,n);if(!i){this._endCell$.next(null);return}const{location:r,position:o}=i;this._endCell$.next({location:r,position:o,dataTransfer:s})}};eu=kk([eC(0,P),eC(1,ze)],eu);var Tk=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ig=(e,t)=>(n,s)=>t(n,s,e);let ac=class extends ae{constructor(e,t,n,s){super(),this._context=e,this._renderManagerService=t,this._dragManagerService=n,this._sheetSkeletonManagerService=s,this._initDragEvent()}_initDragEvent(){const e=new Et,t=n=>{if(e.dispose(),!n)return;const{scene:s}=this._context,i=s.onDragOver$.subscribeEvent(o=>{this._dragManagerService.onDragOver(o)}),r=s.onDrop$.subscribeEvent(o=>{this._dragManagerService.onDrop(o)});e.add({dispose(){i.unsubscribe(),r.unsubscribe()}})};t(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n=>{t(n)}))}};ac=Tk([ig(1,ze),ig(2,V(eu)),ig(3,V(Te))],ac);class Ib{constructor(){y(this,"_state",null),y(this,"_rect",null),y(this,"_state$",new xe(null)),y(this,"state$",this._state$.asObservable()),y(this,"_rect$",new xe(null)),y(this,"rect$",this._rect$.asObservable()),y(this,"_focus",!1),y(this,"_focus$",new xe(this._focus)),y(this,"focus$",this._focus$.asObservable())}dispose(){this._state$.complete(),this._state=null,this._rect$.complete(),this._rect=null}setState(t){this._state=t,this._refresh(t)}getRect(){return this._rect}setRect(t){this._rect=t,this._rect$.next(t)}getState(){return this._state}setFocus(t=!1){this._focus=t,this._focus$.next(t)}_refresh(t){this._state$.next(t)}}const ku=bn("univer.sheet-cell-editor-manager.service");function Bt({ref:e,...t}){const{icon:n,id:s,className:i,extend:r,...o}=t,a=`univerjs-icon univerjs-icon-${s} ${i||""}`.trim(),l=L.useRef(`_${Nk()}`);return Rb(n,`${s}`,{defIds:n.defIds,idSuffix:l.current},{ref:e,className:a,...o},r)}function Rb(e,t,n,s,i){return L.createElement(e.tag,{key:t,...Pk(e,n,i),...s},(Uk(e,n).children||[]).map((r,o)=>Rb(r,`${t}-${e.tag}-${o}`,n,void 0,i)))}function Pk(e,t,n){const s={...e.attrs};n!=null&&n.colorChannel1&&s.fill==="colorChannel1"&&(s.fill=n.colorChannel1),e.tag==="mask"&&s.id&&(s.id=s.id+t.idSuffix),Object.entries(s).forEach(([r,o])=>{r==="mask"&&typeof o=="string"&&(s[r]=o.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))});const{defIds:i}=t;return!i||i.length===0||(e.tag==="use"&&s["xlink:href"]&&(s["xlink:href"]=s["xlink:href"]+t.idSuffix),Object.entries(s).forEach(([r,o])=>{typeof o=="string"&&(s[r]=o.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))})),s}function Uk(e,t){var n;const{defIds:s}=t;return!s||s.length===0?e:e.tag==="defs"&&(n=e.children)!=null&&n.length?{...e,children:e.children.map(i=>typeof i.attrs.id=="string"&&s&&s.includes(i.attrs.id)?{...i,attrs:{...i.attrs,id:i.attrs.id+t.idSuffix}}:i)}:e}function Nk(){return Math.random().toString(36).substring(2,8)}Bt.displayName="UniverIcon";const Ok={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",fillRule:"evenodd",clipRule:"evenodd"}}]},mo=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"check-mark-icon",ref:t,icon:Ok}))});mo.displayName="CheckMarkIcon";const Ak={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z"}}]},yb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"close-icon",ref:t,icon:Ak}))});yb.displayName="CloseIcon";const Vk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"g",attrs:{fill:"currentColor",clipPath:"url(#convert-icon_clip0_911_593)"},children:[{tag:"path",attrs:{d:"M2.44766 0.848145C1.564 0.848145 0.847656 1.56449 0.847656 2.44814V6.44814C0.847656 7.3318 1.564 8.04814 2.44766 8.04814H6.44766C7.33131 8.04814 8.04766 7.3318 8.04766 6.44814V2.44814C8.04766 1.56449 7.33131 0.848145 6.44766 0.848145H2.44766ZM2.04766 6.44814V5.04824H3.84775V6.84814H2.44766C2.22674 6.84814 2.04766 6.66906 2.04766 6.44814ZM2.04766 3.84824H3.84775V2.04814H2.44766C2.22674 2.04814 2.04766 2.22723 2.04766 2.44814V3.84824ZM5.04775 6.84814V5.04824H6.84766V6.44814C6.84766 6.66906 6.66857 6.84814 6.44766 6.84814H5.04775ZM5.04775 3.84824H6.84766V2.44814C6.84766 2.22723 6.66857 2.04814 6.44766 2.04814H5.04775V3.84824Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{d:"M9.55215 7.95166C8.66849 7.95166 7.95215 8.668 7.95215 9.55166V13.5517C7.95215 14.4353 8.66849 15.1517 9.55215 15.1517L11.5522 15.1517L13.5521 15.1517C14.4358 15.1517 15.1521 14.4353 15.1521 13.5517L15.1521 11.5518L15.1521 9.55166C15.1521 8.668 14.4358 7.95166 13.5521 7.95166H9.55215ZM13.9521 10.9518V9.55166C13.9521 9.33075 13.7731 9.15166 13.5521 9.15166H12.1522V10.9518H13.9521ZM10.9522 10.9518V9.15166H9.55215C9.33123 9.15166 9.15215 9.33075 9.15215 9.55166V10.9518H10.9522ZM9.15215 12.1518H10.9522V13.9517H9.55215C9.33123 13.9517 9.15215 13.7726 9.15215 13.5517V12.1518ZM12.1522 12.1518H13.9521V13.5517C13.9521 13.7726 13.7731 13.9517 13.5521 13.9517H12.1522V12.1518Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{d:"M9.62158 2.44912C9.62158 2.11775 9.89021 1.84912 10.2216 1.84912H12.7516C13.6352 1.84912 14.3516 2.56547 14.3516 3.44912V5.9791C14.3516 6.31047 14.0829 6.5791 13.7516 6.5791C13.4202 6.5791 13.1516 6.31047 13.1516 5.9791V3.44912C13.1516 3.22821 12.9725 3.04912 12.7516 3.04912H10.2216C9.89021 3.04912 9.62158 2.78049 9.62158 2.44912Z"}},{tag:"path",attrs:{d:"M5.77871 14.1507C6.11008 14.1507 6.37871 13.8821 6.37871 13.5507C6.37871 13.2193 6.11008 12.9507 5.77871 12.9507L3.24873 12.9507C3.02782 12.9507 2.84873 12.7716 2.84873 12.5507L2.84873 10.0207C2.84873 9.68933 2.5801 9.4207 2.24873 9.4207C1.91736 9.4207 1.64873 9.68933 1.64873 10.0207L1.64873 12.5507C1.64873 13.4343 2.36507 14.1507 3.24873 14.1507H5.77871Z"}}]},{tag:"defs",attrs:{},children:[{tag:"clipPath",attrs:{id:"convert-icon_clip0_911_593"},children:[{tag:"path",attrs:{fill:"white",d:"M0 0H16V16H0z"}}]}]}],defIds:["convert-icon_clip0_911_593"]},Mb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"convert-icon",ref:t,icon:Vk}))});Mb.displayName="ConvertIcon";const Hk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Ah=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"delete-icon",ref:t,icon:Hk}))});Ah.displayName="DeleteIcon";const Dk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"}}]},Eb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"dropdown-icon",ref:t,icon:Dk}))});Eb.displayName="DropdownIcon";const Wk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM10.3097 5.69014C10.544 5.92445 10.544 6.30435 10.3097 6.53867L8.84843 7.9999L10.3099 9.46137C10.5442 9.69569 10.5442 10.0756 10.3099 10.3099C10.0756 10.5442 9.69569 10.5442 9.46137 10.3099L7.9999 8.84843L6.53842 10.3099C6.30411 10.5442 5.92421 10.5442 5.6899 10.3099C5.45558 10.0756 5.45558 9.69569 5.6899 9.46137L7.15137 7.9999L5.69014 6.53867C5.45583 6.30435 5.45583 5.92445 5.69014 5.69014C5.92445 5.45583 6.30435 5.45583 6.53867 5.69014L7.9999 7.15137L9.46113 5.69014C9.69544 5.45583 10.0753 5.45583 10.3097 5.69014Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Mf=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"error-icon",ref:t,icon:Wk}))});Mf.displayName="ErrorIcon";const Lk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.28096 4.6541C1.57489 4.50109 1.93721 4.61533 2.09022 4.90926C2.27315 5.26067 2.55999 5.60455 2.94829 5.92278C4.04628 6.82266 5.87505 7.44865 7.99828 7.44865C10.1215 7.44865 11.9503 6.82267 13.0482 5.92279C13.4366 5.60455 13.7234 5.26067 13.9063 4.90927C14.0594 4.61533 14.4217 4.50109 14.7156 4.65409C15.0095 4.8071 15.1238 5.16941 14.9708 5.46334C14.6995 5.98445 14.2981 6.44997 13.8089 6.8509C13.7298 6.91575 13.6481 6.97914 13.564 7.041L15.2245 8.70153C15.4588 8.93585 15.4588 9.31575 15.2245 9.55006C14.9902 9.78438 14.6103 9.78438 14.376 9.55006L12.5041 7.67822C11.8977 7.97568 11.2181 8.21208 10.4884 8.37706L11.0996 10.6581C11.1853 10.9782 10.9954 11.3072 10.6753 11.393C10.3552 11.4787 10.0262 11.2888 9.94045 10.9687L9.29949 8.57652C8.8758 8.62404 8.44081 8.64865 7.99828 8.64865C7.55276 8.64865 7.11487 8.62371 6.68846 8.57555L6.04723 10.9687C5.96147 11.2888 5.63247 11.4788 5.31239 11.393C4.99231 11.3073 4.80236 10.9783 4.88812 10.6582L5.49983 8.37516C4.7743 8.2105 4.09843 7.9752 3.49498 7.67947L1.62436 9.55009C1.39005 9.78441 1.01015 9.78441 0.775835 9.5501C0.54152 9.31578 0.541518 8.93588 0.775832 8.70157L2.43478 7.04261C2.34987 6.98024 2.26746 6.91632 2.18764 6.8509C1.69842 6.44997 1.29706 5.98445 1.0258 5.46335C0.872791 5.16942 0.987031 4.80711 1.28096 4.6541Z"}}]},xb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"eyelash-icon",ref:t,icon:Lk}))});xb.displayName="EyelashIcon";const Bk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 17",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M6.06409 5.53454C5.93592 5.53454 5.84083 5.41567 5.86897 5.29063L5.95442 4.9109C6.05444 4.48178 6.23806 4.11547 6.51182 3.81952C6.81082 3.49628 7.25398 3.35405 7.79738 3.35405C7.99847 3.35405 8.21359 3.37775 8.44188 3.42245C8.46089 3.42617 8.47974 3.43006 8.49846 3.4341C8.7099 3.4798 8.93698 3.38478 9.02031 3.18514L9.24767 2.6404C9.33457 2.43219 9.23178 2.19404 9.01582 2.12874C8.98358 2.11899 8.95028 2.10912 8.91591 2.09914C8.62745 2.01631 8.28392 1.97217 7.88074 1.97217C6.82015 1.97217 6.02714 2.23936 5.4746 2.7444C4.90987 3.26069 4.50889 3.99917 4.28413 4.9762L2.83703 11.1909C2.76126 11.5286 2.666 11.8917 2.54844 12.2812C2.42975 12.6734 2.2873 13.0595 2.12221 13.4373C1.95577 13.8159 1.76813 14.1762 1.55955 14.5171C1.49345 14.6251 1.42515 14.7282 1.35467 14.8263C1.26508 14.9509 1.3347 15.133 1.48655 15.1554C2.13635 15.2509 2.8179 15.0763 3.18197 14.5296C3.32661 14.3124 3.46779 14.0646 3.60509 13.7851C3.96635 13.0497 4.30522 12.0103 4.61867 10.6574L5.469 7.01534C5.49013 6.92483 5.57082 6.86081 5.66376 6.86081H7.62478C7.8097 6.86081 7.97051 6.73405 8.01371 6.55425L8.14014 6.02798C8.20057 5.77642 8.00992 5.53454 7.75121 5.53454H6.06409Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.3211 5.72037L12.5124 7.96963L11.4089 5.77754C11.3422 5.63012 11.1954 5.5354 11.0336 5.5354H10.3129C10.0085 5.5354 9.80921 5.85428 9.9427 6.1279L11.4089 9.05502L8.79783 12.1493C8.56587 12.4158 8.75519 12.8315 9.10855 12.8315H9.68607C9.80672 12.8315 9.9605 12.7822 10.0388 12.6904L12.1108 10.2648L13.1176 12.561C13.1786 12.7231 13.333 12.8315 13.5061 12.8315H14.3C14.5831 12.8315 14.7417 12.6175 14.6426 12.3524L13.1728 9.28628C13.1728 9.28628 15.4009 6.45542 15.6013 6.17892C15.7966 5.90929 15.6023 5.5354 15.2693 5.5354H14.6661C14.5275 5.5354 14.4333 5.58887 14.3211 5.72037Z"}}]},kb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"fx-icon",ref:t,icon:Bk}))});kb.displayName="FxIcon";const jk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"}}]},Ef=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"increase-icon",ref:t,icon:jk}))});Ef.displayName="IncreaseIcon";const Fk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.00016 1.33203C6.68162 1.33203 5.39269 1.72302 4.29636 2.45557C3.20004 3.18811 2.34555 4.2293 1.84097 5.44747C1.33638 6.66565 1.20436 8.00609 1.4616 9.2993C1.71883 10.5925 2.35377 11.7804 3.28612 12.7127C4.21847 13.6451 5.40636 14.28 6.69956 14.5373C7.99277 14.7945 9.33321 14.6625 10.5514 14.1579C11.7696 13.6533 12.8108 12.7988 13.5433 11.7025C14.2758 10.6062 14.6668 9.31724 14.6668 7.9987C14.6649 6.23118 13.9619 4.53662 12.7121 3.2868C11.4622 2.03697 9.76768 1.33397 8.00016 1.33203ZM7.66683 3.9987C7.86461 3.9987 8.05795 4.05735 8.2224 4.16723C8.38685 4.27711 8.51502 4.43329 8.59071 4.61601C8.6664 4.79874 8.6862 4.99981 8.64762 5.19379C8.60903 5.38777 8.51379 5.56595 8.37394 5.7058C8.23409 5.84566 8.0559 5.9409 7.86192 5.97948C7.66794 6.01807 7.46687 5.99826 7.28415 5.92258C7.10142 5.84689 6.94524 5.71872 6.83536 5.55427C6.72548 5.38982 6.66683 5.19648 6.66683 4.9987C6.66683 4.73348 6.77219 4.47913 6.95972 4.29159C7.14726 4.10405 7.40162 3.9987 7.66683 3.9987ZM9.3335 11.332H6.66683C6.49002 11.332 6.32045 11.2618 6.19543 11.1368C6.0704 11.0117 6.00016 10.8422 6.00016 10.6654C6.00016 10.4886 6.0704 10.319 6.19543 10.194C6.32045 10.0689 6.49002 9.9987 6.66683 9.9987H7.3335V7.9987H6.66683C6.49002 7.9987 6.32045 7.92846 6.19543 7.80343C6.0704 7.67841 6.00016 7.50884 6.00016 7.33203C6.00016 7.15522 6.0704 6.98565 6.19543 6.86063C6.32045 6.7356 6.49002 6.66536 6.66683 6.66536H8.00016C8.17698 6.66536 8.34655 6.7356 8.47157 6.86063C8.59659 6.98565 8.66683 7.15522 8.66683 7.33203V9.9987H9.3335C9.51031 9.9987 9.67988 10.0689 9.8049 10.194C9.92993 10.319 10.0002 10.4886 10.0002 10.6654C10.0002 10.8422 9.92993 11.0117 9.8049 11.1368C9.67988 11.2618 9.51031 11.332 9.3335 11.332Z"}}]},Tb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"info-icon",ref:t,icon:Fk}))});Tb.displayName="InfoIcon";const zk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M2.62402 7.72905C2.58427 7.72905 2.55205 7.76127 2.55205 7.80102V13.6782C2.55205 13.7179 2.58427 13.7502 2.62402 13.7502H13.3755C13.4152 13.7502 13.4474 13.7179 13.4474 13.6782V7.80102C13.4474 7.76127 13.4152 7.72905 13.3755 7.72905H2.62402ZM1.35205 7.80102C1.35205 7.09853 1.92153 6.52905 2.62402 6.52905H13.3755C14.0779 6.52905 14.6474 7.09853 14.6474 7.80102V13.6782C14.6474 14.3807 14.0779 14.9502 13.3755 14.9502H2.62402C1.92153 14.9502 1.35205 14.3807 1.35205 13.6782V7.80102Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8 2.25005C6.69847 2.25003 5.64336 3.30513 5.64336 4.60666V7.12895C5.64336 7.46032 5.37473 7.72895 5.04336 7.72895C4.71199 7.72895 4.44336 7.46032 4.44336 7.12895V4.60666C4.44336 2.64239 6.04451 1.05565 8.00879 1.05566M8 2.25005L8.00879 1.05566L8 2.25005ZM8.00879 1.05566L8 2.25005C9.30154 2.25003 10.3567 3.30513 10.3567 4.60666V7.12895C10.3567 7.46032 10.6253 7.72895 10.9567 7.72895C11.288 7.72895 11.5567 7.46032 11.5567 7.12895V4.60666C11.5567 2.64239 9.97306 1.05565 8.00879 1.05566Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.00039 9.4668C8.33176 9.4668 8.60039 9.73543 8.60039 10.0668V12.0827C8.60039 12.4141 8.33176 12.6827 8.00039 12.6827C7.66902 12.6827 7.40039 12.4141 7.40039 12.0827V10.0668C7.40039 9.73543 7.66902 9.4668 8.00039 9.4668Z",fillRule:"evenodd",clipRule:"evenodd"}}]},xf=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"lock-icon",ref:t,icon:zk}))});xf.displayName="LockIcon";const Xk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ua=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"more-down-icon",ref:t,icon:Xk}))});ua.displayName="MoreDownIcon";const Yk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z",fillRule:"evenodd",clipRule:"evenodd"}}]},vm=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"more-icon",ref:t,icon:Yk}))});vm.displayName="MoreIcon";const Zk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.666 2.70571C11.7769 1.76476 10.3295 1.76476 9.4404 2.70571L3.37843 9.12427C3.31779 9.18848 3.27756 9.26409 3.24979 9.3439C3.24809 9.3493 3.24299 9.3529 3.24129 9.3583L2.02912 13.2097C1.96112 13.4251 2.01439 13.6633 2.16626 13.8236C2.27393 13.9382 2.41901 14 2.56692 14C2.62699 14 2.68762 13.9898 2.74599 13.9688L6.3825 12.6846C6.3876 12.6828 6.391 12.678 6.39553 12.6762C6.47147 12.6474 6.54287 12.6042 6.60351 12.54L12.666 6.12202C13.5558 5.18048 13.5558 3.64725 12.666 2.70571ZM8.62832 5.26209L9.04031 5.69836C9.03918 5.69956 9.03748 5.70016 9.03634 5.70136L4.99182 9.9836L4.58096 9.54853L8.62832 5.26209ZM3.46287 12.4512L4.02673 10.6593L5.15446 11.8535L3.46287 12.4512ZM6.20342 11.2672L5.79256 10.8321L9.83709 6.54988C9.83822 6.54868 9.83879 6.54688 9.83992 6.54568L10.2513 6.98135L6.20342 11.2672ZM11.8647 5.27349L11.0532 6.13282L9.42963 4.41356L10.2411 3.55423C10.6888 3.08016 11.417 3.08076 11.8642 3.55423C12.3124 4.0283 12.3124 4.79942 11.8647 5.27349Z"}}]},Pb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"pen-icon",ref:t,icon:Zk}))});Pb.displayName="PenIcon";const Gk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.785 6.77762C5.78908 6.7777 5.79316 6.77774 5.79725 6.77774C5.80134 6.77774 5.80543 6.7777 5.8095 6.77762H10.0184C10.0225 6.7777 10.0266 6.77774 10.0307 6.77774C10.0347 6.77774 10.0388 6.7777 10.0429 6.77762H13.6638V7.63727C13.6638 7.96864 13.9324 8.23727 14.2638 8.23727C14.5951 8.23727 14.8638 7.96864 14.8638 7.63727V3.9999C14.8638 2.56395 13.6997 1.39989 12.2637 1.3999L3.56389 1.39999C2.12797 1.40001 0.96393 2.56405 0.96392 3.99998L0.963867 11.6666C0.963857 13.1025 2.12792 14.2666 3.56387 14.2666H8.0542C8.38557 14.2666 8.6542 13.9979 8.6542 13.6666C8.6542 13.3352 8.38557 13.0666 8.0542 13.0666H3.56387C2.79067 13.0666 2.16386 12.4398 2.16387 11.6666L2.1639 6.77762H5.785ZM6.39725 2.59996L9.43065 2.59993V5.57762H6.39725V2.59996ZM5.19725 5.57762V2.59998L3.56391 2.59999C2.79072 2.6 2.16393 3.22679 2.16392 3.99998L2.16391 5.57762H5.19725ZM13.6638 5.57762V3.9999C13.6638 3.2267 13.037 2.59989 12.2638 2.5999L10.6307 2.59992V5.57762H13.6638Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.1223 10.2333V10.7496C14.7087 10.9869 15.1223 11.5618 15.1223 12.2333V12.8999C15.1223 13.7836 14.406 14.4999 13.5223 14.4999H11.5223C10.6387 14.4999 9.92235 13.7836 9.92235 12.8999V12.2333C9.92235 11.5618 10.336 10.9869 10.9223 10.7496V10.2333C10.9223 9.34961 11.6387 8.63328 12.5223 8.63328C13.406 8.63328 14.1223 9.34961 14.1223 10.2333ZM11.1223 12.2333C11.1223 12.0124 11.3014 11.8333 11.5223 11.8333H13.5223C13.7433 11.8333 13.9223 12.0124 13.9223 12.2333V12.8999C13.9223 13.1209 13.7433 13.2999 13.5223 13.2999H11.5223C11.3014 13.2999 11.1223 13.1209 11.1223 12.8999V12.2333ZM12.9223 10.2333V10.6333H12.1223V10.2333C12.1223 10.0124 12.3014 9.83328 12.5223 9.83328C12.7433 9.83328 12.9223 10.0124 12.9223 10.2333Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Ub=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"protect-icon",ref:t,icon:Gk}))});Ub.displayName="ProtectIcon";const qk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM8.00008 12.3671C8.46031 12.3671 8.83342 11.994 8.83342 11.5338C8.83342 11.0735 8.46031 10.7004 8.00008 10.7004C7.53985 10.7004 7.16675 11.0735 7.16675 11.5338C7.16675 11.994 7.53985 12.3671 8.00008 12.3671ZM8.5999 4.4335C8.5999 4.10213 8.33127 3.8335 7.9999 3.8335C7.66853 3.8335 7.3999 4.10213 7.3999 4.4335V9.36683C7.3999 9.6982 7.66853 9.96683 7.9999 9.96683C8.33127 9.96683 8.5999 9.6982 8.5999 9.36683V4.4335Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Nb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"warning-icon",ref:t,icon:qk}))});Nb.displayName="WarningIcon";const Qk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.6551 1.98906C11.7476 1.08113 10.2757 1.08149 9.3686 1.98987L4.82542 6.53955C4.75087 6.61421 4.69336 6.70411 4.65682 6.80309L3.2461 10.625C3.16506 10.8446 3.21909 11.0912 3.3845 11.2568C3.54991 11.4224 3.79651 11.4767 4.01616 11.3959L7.85031 9.98517C7.94979 9.94856 8.04014 9.89077 8.11508 9.81579L12.6552 5.27327C13.5618 4.36621 13.5618 2.89607 12.6551 1.98906ZM10.2177 2.83779C10.6562 2.39869 11.3677 2.39851 11.8064 2.8374C12.2447 3.27584 12.2447 3.9865 11.8065 4.42497L7.3392 8.89457L4.82213 9.82068L5.74706 7.31487L10.2177 2.83779Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.79238 13.2999C1.46101 13.2999 1.19238 13.5685 1.19238 13.8999C1.19238 14.2313 1.46101 14.4999 1.79238 14.4999H14.4924C14.8238 14.4999 15.0924 14.2313 15.0924 13.8999C15.0924 13.5685 14.8238 13.2999 14.4924 13.2999H1.79238Z"}}]},kf=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"write-icon",ref:t,icon:Qk}))});kf.displayName="WriteIcon";const Kk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Ob=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"autofill-double-icon",ref:t,icon:Kk}))});Ob.displayName="AutofillDoubleIcon";const $k={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M6.4833 1.65005C6.4833 1.31868 6.21467 1.05005 5.8833 1.05005C5.55193 1.05005 5.2833 1.31868 5.2833 1.65005V5.28345H1.65029C1.31892 5.28345 1.05029 5.55208 1.05029 5.88345C1.05029 6.21482 1.31892 6.48345 1.65029 6.48345H5.2833V9.51684H1.65029C1.31892 9.51684 1.05029 9.78547 1.05029 10.1168C1.05029 10.4482 1.31892 10.7168 1.65029 10.7168H5.2833V14.35C5.2833 14.6814 5.55193 14.95 5.8833 14.95C6.21467 14.95 6.4833 14.6814 6.4833 14.35V10.7168H9.5167V14.35C9.5167 14.6814 9.78533 14.95 10.1167 14.95C10.4481 14.95 10.7167 14.6814 10.7167 14.35V10.7168H14.3503C14.6817 10.7168 14.9503 10.4482 14.9503 10.1168C14.9503 9.78547 14.6817 9.51685 14.3503 9.51685H10.7167V6.48345H14.3503C14.6817 6.48345 14.9503 6.21482 14.9503 5.88345C14.9503 5.55208 14.6817 5.28345 14.3503 5.28345H10.7167V1.65005C10.7167 1.31868 10.4481 1.05005 10.1167 1.05005C9.78533 1.05005 9.5167 1.31868 9.5167 1.65005V5.28345L6.4833 5.28345V1.65005ZM6.4833 6.48345V9.51684L9.5167 9.51685V6.48345L6.4833 6.48345Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.0498 3.65005C1.0498 2.21411 2.21386 1.05005 3.6498 1.05005H12.3498C13.7857 1.05005 14.9498 2.21411 14.9498 3.65005V12.3501C14.9498 13.786 13.7857 14.95 12.3498 14.95H3.6498C2.21386 14.95 1.0498 13.786 1.0498 12.35V3.65005ZM3.6498 2.25005C2.87661 2.25005 2.2498 2.87685 2.2498 3.65005V12.35C2.2498 13.1232 2.87661 13.75 3.6498 13.75H12.3498C13.123 13.75 13.7498 13.1232 13.7498 12.3501V3.65005C13.7498 2.87685 13.123 2.25005 12.3498 2.25005H3.6498Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Tf=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"hide-gridlines-double-icon",ref:t,icon:$k}))});Tf.displayName="HideGridlinesDoubleIcon";const Jk={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}}]},Ab=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"paint-bucket-double-icon",ref:t,icon:Jk}))});Ab.displayName="PaintBucketDoubleIcon";const eT={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M7.74692 9.12463C7.74692 9.46018 8.01893 9.73219 8.35448 9.73219H11.4933C11.8288 9.73219 12.1009 9.46018 12.1009 9.12463C12.1009 8.78909 11.8288 8.51707 11.4933 8.51707H8.35448C8.01893 8.51707 7.74692 8.78909 7.74692 9.12463Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M10.8636 10.8523C10.8636 11.1879 10.5915 11.4599 10.256 11.4599H8.35448C8.01893 11.4599 7.74692 11.1879 7.74692 10.8523C7.74692 10.5168 8.01893 10.2447 8.35448 10.2447H10.256C10.5915 10.2447 10.8636 10.5168 10.8636 10.8523Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.4791 1.98268C5.47913 1.71529 5.87912 1.49854 6.37252 1.49854C6.86593 1.49854 7.26592 1.71529 7.26595 1.98268H7.62187C8.22277 1.98268 8.72459 2.39534 8.84412 2.9452H9.39563C10.0856 2.9452 10.6449 3.48923 10.6449 4.16032V6.00569H12.1261C13.161 6.00569 14 6.82174 14 7.82838V11.334C14 11.8174 13.8025 12.281 13.4511 12.6228L12.0693 13.9647C11.7179 14.3065 11.2412 14.4985 10.7442 14.4985H7.91116C7.05024 14.4985 6.32492 14.0431 6.10535 13.2737H3.34925C2.6593 13.2737 2.09998 12.7297 2.09998 12.0586V4.16032C2.09998 3.48923 2.6593 2.9452 3.34925 2.9452H3.90107C4.0206 2.39534 4.52241 1.98268 5.12332 1.98268H5.4791ZM3.97249 4.16032H3.24925L3.24925 12.0586H6.03725V7.82838C6.03725 6.82174 6.87623 6.00569 7.91116 6.00569H9.49563V4.16032H8.7727C8.58289 4.59611 8.13909 4.90183 7.62187 4.90183H5.12332C4.6061 4.90183 4.1623 4.59611 3.97249 4.16032ZM5.12332 2.89403H7.62187C7.79436 2.89403 7.93419 3.03003 7.93419 3.19781V3.68671C7.93419 3.85448 7.79436 3.99049 7.62187 3.99049H5.12332C4.95083 3.99049 4.811 3.85448 4.811 3.68671V3.19781C4.811 3.03003 4.95083 2.89403 5.12332 2.89403ZM7.91116 7.11157C7.56618 7.11157 7.28652 7.38359 7.28652 7.71913V12.7851C7.28652 13.1206 7.56618 13.3927 7.91116 13.3927H10.7442C10.8401 13.3927 10.9337 13.3712 11.0182 13.3311C11.1373 13.2746 11.1859 13.1423 11.1859 13.0134V12.0066C11.1859 11.8724 11.2978 11.7636 11.4358 11.7636H12.4709C12.6034 11.7636 12.7394 11.7163 12.7975 11.6004C12.8388 11.5182 12.8608 11.4272 12.8608 11.334V7.71913C12.8608 7.38359 12.5811 7.11157 12.2362 7.11157H7.91116Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Vb=L.forwardRef(function(e,t){return L.createElement(Bt,Object.assign({},e,{id:"paste-special-double-icon",ref:t,icon:eT}))});Vb.displayName="PasteSpecialDoubleIcon";const tT=()=>{const[,e]=L.useState({});return L.useCallback(()=>e(t=>!t),[])};function nT(){const e=G(U),t=G(P),n=G(ze),s=G(Ua),i=G(Oe),[r,o]=L.useState([]),[a,l]=L.useState(!1),[u,d]=L.useState({row:-1,col:-1}),[c,h]=L.useState(gt.SERIES),[g,m]=L.useState(!1),p=go(),{sheetSkeletonManagerService:f,selectionRenderService:v}=L.useMemo(()=>{if(p){const ee=n.getRenderById(p.getUnitId());return{sheetSkeletonManagerService:ee?.with(Te),selectionRenderService:ee?.with(Zt)}}return{sheetSkeletonManagerService:null,selectionRenderService:null}},[p,n]),C=()=>{m(!0)},w=()=>{m(!1)},b=tT();if(L.useEffect(()=>e.onCommandExecuted((ee,we)=>{ee.id===mr.id&&b()}).dispose,[b,e]),L.useEffect(()=>{const ee=f&&He(f.currentSkeleton$.subscribe(we=>{we&&b()}));return ee?.dispose},[f,b]),L.useEffect(()=>He(s.menu$.subscribe(ee=>{o(ee.map(we=>({...we,index:ee.indexOf(we)})))})).dispose,[s]),L.useEffect(()=>He(s.showMenu$.subscribe(ee=>{const{source:we,target:Ge}=s.autoFillLocation||{source:null,target:null};if(ee&&we&&Ge){const Ae=Math.max(we.rows[we.rows.length-1],Ge.rows[Ge.rows.length-1]),Ze=Math.max(we.cols[we.cols.length-1],Ge.cols[Ge.cols.length-1]);d({row:Ae,col:Ze})}else d({row:-1,col:-1})})).dispose,[s]),L.useEffect(()=>He(s.applyType$.subscribe(ee=>{h(ee)})).dispose,[s]),L.useEffect(()=>{function ee(){l(!1)}return document.addEventListener("wheel",ee),()=>{document.removeEventListener("wheel",ee)}},[a]),u.col<0||u.row<0)return null;const I=Rs(t,n);if(!I||!v)return null;const{scene:_}=I,R=f?.getCurrentSkeleton(),M=v.getViewPort(),x=_?.scaleX,N=_?.scaleY,T=_?.getViewportScrollXY(M);if(!x||!_||!x||!N||!T)return null;const O=R?.getNoMergeCellWithCoordByIndex(u.row,u.col).endX||0,k=R?.getNoMergeCellWithCoordByIndex(u.row,u.col).endY||0,D=Ro(O,x,T),B=yo(k,N,T);if(D==null||B==null)return null;const W=ee=>{l(ee)},F=ee=>{e.executeCommand(Gp.id,{type:ee.value}),l(!1)},K=a||g,J=r.filter(ee=>!ee.disable);return S.jsx("div",{className:"univer-absolute univer-inset-0 univer-z-10 univer-size-0",children:S.jsx("div",{className:"univer-absolute",style:{left:`${D+2}px`,top:`${B+2}px`},onMouseEnter:C,onMouseLeave:w,children:S.jsx(Jm,{align:"start",items:J.map(ee=>({type:"radio",value:c,options:[{label:i.t(ee.label),value:ee.value}],onSelect:()=>F(ee)})),open:a,onOpenChange:W,children:S.jsxs("div",{className:Ke("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",Ra,{"univer-bg-gray-100 dark:!univer-bg-gray-800":a,"univer-bg-white dark:!univer-bg-gray-900":!a}),children:[S.jsx(Ob,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),K&&S.jsx(ua,{className:"dark:!univer-text-white"})]})})})})}function Hb(e,t){const n=G(xt),s=G(U);return L.useMemo(()=>({keyCodes:[{keyCode:te.ENTER},{keyCode:te.ESC},{keyCode:te.TAB}],handler:i=>{(i===te.ENTER||i===te.ESC||i===te.TAB)&&(n.disableForceKeepVisible(),s.syncExecuteCommand(At.id,{visible:!1,eventType:bt.Keyboard,keycode:i,unitId:t}))}}),[s,n,t])}const lc=-1e3,tC={width:0,height:0,top:lc,left:lc},sT=()=>{const[e,t]=L.useState({...tC}),n=G(ku),s=G(no),i=G(Ne),r=G(Tn),o=G(xt),a=zt(o.visible$),l=G(U),u=L.useRef(0),d=zt(()=>i.subscribeContextValue$(tv),!1,void 0,[i,tv]),c=r.get(uf),h=o.getEditLocation();L.useEffect(()=>{const f=n.state$.subscribe(v=>{if(v==null)return;const{startX:C=lc,startY:w=lc,endX:b=0,endY:I=0,show:_=!1}=v;if(!_)t({...tC});else{t({width:b-C,height:I-w,left:C,top:w});const R=s.getEditor(rt);if(R==null)return;const{left:M,top:x,width:N,height:T}=R.getBoundingClientRect();n.setRect({left:M,top:x,width:N,height:T})}});return()=>{f.unsubscribe()}},[]),L.useEffect(()=>{d||n.setFocus(!0)},[d,e]);const g=nv(()=>{o.isVisible().visible&&l.executeCommand(At.id,{visible:!1,eventType:bt.PointerUp,unitId:h?.unitId})});gw(g);const m=Hb(u,h?.unitId),p=nv((f,v)=>{l.executeCommand(oa.id,{keycode:f,visible:!1,eventType:bt.Keyboard,isShift:v===Fe.SHIFT||v===(Fe.CTRL_COMMAND|Fe.SHIFT),unitId:h?.unitId})});return S.jsx("div",{className:"univer-absolute univer-z-10 univer-flex",style:{left:e.left,top:e.top,width:e.width,height:e.height},children:c&&S.jsx(c,{editorId:rt,className:"univer-relative univer-flex univer-size-full [&_canvas]:univer-absolute",initValue:"",onChange:()=>{},isFocus:a?.visible,unitId:h?.unitId,subUnitId:h?.sheetId,keyboardEventConfig:m,onMoveInEditor:p,isSupportAcrossSheet:!0,resetSelectionOnBlur:!1,isSingle:!1,autoScrollbar:!1,onFormulaSelectingChange:(f,v)=>{u.current=f,v&&(f?o.enableForceKeepVisible():o.disableForceKeepVisible())},disableSelectionOnClick:!0,disableContextMenu:!1})})};class Db{constructor(){y(this,"_position",null),y(this,"_position$",new xe(null)),y(this,"position$",this._position$.asObservable()),y(this,"_focus",!1),y(this,"_focus$",new xe(this._focus)),y(this,"focus$",this._focus$.asObservable()),y(this,"_fxBtnClick$",new Ve),y(this,"fxBtnClick$",this._fxBtnClick$.asObservable()),y(this,"_foldBtnStatus$",new Ve),y(this,"foldBtnStatus$",this._foldBtnStatus$.asObservable())}dispose(){this._position$.complete(),this._focus$.complete(),this._position=null,this._focus=!1}setPosition(t){this._position=t,this._refresh(t)}getPosition(){return this._position}setFocus(t=!1){this._focus=t,this._focus$.next(t)}handleFxBtnClick(t){this._fxBtnClick$.next(t)}handleFoldBtnClick(t){this._foldBtnStatus$.next(t)}_refresh(t){this._position$.next(t)}}const Tu=bn("univer.sheet-formula-editor-manager.service");function iT({search:e,isInputEvent:t}){const n=G(U),s=G(Oe),i=G(wi),r=G(P),o=G(_a),a=r.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),l=()=>{const m=i.getDefinedNameMap(a);return m?Array.from(Object.values(m)):[]},[u,d]=L.useState(l());L.useEffect(()=>{const m=i.update$.subscribe(()=>{d(l())});return()=>{m.unsubscribe()}},[]),L.useEffect(()=>{const m=o.sidebarOptions$.subscribe(p=>{p.id===Jl&&(p.visible||setTimeout(()=>{o.sidebarOptions$.next({visible:!1})}))});return()=>{m.unsubscribe()}},[]);const c=L.useMemo(()=>e&&t?u.filter(m=>m.name.toLowerCase().includes(e.toLowerCase())):u,[e,t,u]),h=()=>{n.executeCommand(yf.id,{value:"open"})},g=async m=>{const{formulaOrRefString:p,id:f}=m,v=i.getWorksheetByRef(a,p);v&&(v.isSheetHidden()&&await n.executeCommand(uo.id,{unitId:a,subUnitId:v.getSheetId()}),i.focusRange(a,f))};return S.jsxs("div",{className:"univer-w-[300px]",children:[S.jsx("ul",{className:Ke("univer-m-0 univer-max-h-[360px] univer-list-none univer-overflow-y-auto univer-p-0",cu),children:c.map((m,p)=>S.jsx("li",{className:"univer-cursor-pointer univer-px-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",onClick:()=>{g(m)},children:S.jsxs("div",{className:Ke("univer-flex univer-items-center univer-justify-between univer-gap-2 univer-py-1",$m),children:[S.jsx("div",{className:"univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",title:m.name,children:m.name}),S.jsx("div",{className:"univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-xs univer-text-gray-400",title:m.formulaOrRefString,children:m.formulaOrRefString})]})},p))}),S.jsxs("div",{className:"univer-cursor-pointer univer-p-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",onClick:h,children:[S.jsx("div",{className:"univer-mb-2 univer-text-sm univer-font-semibold univer-text-gray-600 dark:!univer-text-gray-200",children:s.t("definedName.managerTitle")}),S.jsx("div",{className:"univer-text-xs univer-text-gray-400",children:s.t("definedName.managerDescription")})]})]})}function rT({disable:e}){const[t,n]=L.useState(""),[s,i]=L.useState(""),r=G(wi),o=G(U),a=G(P),l=G(q),u=G(Zc),d=a.getCurrentUnitOfType(A.UNIVER_SHEET),c=d?.getUnitId(),h=G(xn),[g,m]=L.useState(!1),[p,f]=L.useState(!1),v=()=>{const O=r.getDefinedNameMap(c);return O?Array.from(Object.values(O)):[]},C=async O=>{const{formulaOrRefString:k,id:D}=O,B=r.getWorksheetByRef(c,k);B&&(B.isSheetHidden()&&await o.executeCommand(uo.id,{unitId:c,subUnitId:B.getSheetId()}),r.focusRange(c,D))},w=O=>{const k=d.getActiveSheet(),D=k.getSheetId();T(k,O).then(B=>{B&&(o.executeCommand(me.id,{unitId:c,subUnitId:D,selections:B}),o.executeCommand(bf.id,{range:B[0].range}))})},[b,I]=L.useState(v());L.useEffect(()=>{const O=r.update$.subscribe(()=>{I(v())});return()=>{O.unsubscribe()}},[]),L.useEffect(()=>{const O=r.currentRange$.subscribe(()=>{var k;const D=l.getCurrentSelections(),B=d.getActiveSheet(),W=(k=D?.map(J=>qc(B.getName(),J.range)))==null?void 0:k.join(","),F=u.convertRefersToAbsolute(W,Cd.ALL,Cd.ALL,B.getName()),K=r.getDefinedNameByRefString(c,F);if(K)n(K.name),i(K.name);else{const J=r.getCurrentRangeForString();n(J),i(J)}});return()=>{O.unsubscribe()}},[]);const _=vd(O=>{const k=b.find(D=>D.name.toLowerCase().includes(O.toLowerCase()));k&&!g?m(!0):!k&&g&&m(!1)},100);function R(O){const k=O.target.value.trim();if(i(k),f(!0),!k){g&&m(!1);return}_(k)}function M(){if(s===t)return;const O=b.find(k=>k.name===s);O?(n(s),C(O)):yw(s)?(n(s),w(s)):N()}function x(O){e||(O.key==="Enter"?(M(),f(!1),m(!1)):O.key==="Escape"&&(O.preventDefault(),f(!1),N()))}function N(){i(t)}async function T(O,k){if(!O)return;const D=hu(k.trim()),B=D.range,{startRow:W,startColumn:F,endRow:K,endColumn:J}=B,ee=Ht({startRow:W,startColumn:F},O),we=[];return we.push({range:D.range,style:sr(h),primary:ee}),we}return S.jsxs("div",{"data-u-comp":"defined-name",className:"univer-relative univer-box-border univer-flex univer-h-full univer-w-24 univer-border-r-gray-200 univer-py-1.5 univer-transition-all",children:[S.jsx("input",{className:Ke("univer-box-border univer-size-full univer-appearance-none univer-pl-1.5 univer-pr-5 univer-text-gray-900 focus:univer-outline-none dark:!univer-border-r-gray-700 dark:!univer-bg-gray-900 dark:!univer-text-white",Km,{"univer-cursor-not-allowed":e}),type:"text",value:s,onChange:R,onKeyDown:x,onBlur:()=>f(!1)}),S.jsx($g,{overlay:S.jsx("div",{className:"univer-z-[1001]",children:S.jsx(iT,{search:s,isInputEvent:p})}),disabled:e,open:g,onOpenChange:m,onOpenAutoFocus:O=>O.preventDefault(),children:S.jsx("a",{className:Ke("univer-absolute univer-right-0 univer-top-0 univer-flex univer-h-full univer-cursor-pointer univer-items-center univer-justify-center univer-px-1 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-800",{"univer-cursor-not-allowed univer-text-gray-300 hover:univer-bg-transparent dark:!univer-text-gray-700":e}),children:S.jsx(ua,{})})})]})}function oT(e){var t,n,s,i;const{className:r,disableDefinedName:o}=e,[a,l]=L.useState(!1),[u,d]=L.useState(0),c=G(Tu),h=G(xt),g=G(ft),m=G(We),p=G(P),f=G(q),v=G(Je),C=G(Is),w=G(U),[b,I]=L.useState({editDisable:!1,viewDisable:!1}),[_,R]=L.useState(!1),M=G(Tn),x=zt(()=>p.getCurrentTypeOfUnit$(A.UNIVER_SHEET),void 0,void 0,[]),N=L.useRef(0),T=zt(h.currentEditCellState$),O=Hb(N,(t=T?.unitId)!=null?t:""),k=M.get(uf),D=UI(_b.FORMULA_AUX),B=G(Ne);zt(L.useMemo(()=>B.subscribeContextValue$(Vn),[B]));const W=B.getContextValue(Vn),F=L.useRef(null),K=G(no),J=ba(Jt),ee=J?.disableEdit;L.useLayoutEffect(()=>{const ut=x.activeSheet$.pipe($e(re=>re?Ut(g.ruleChange$,m.ruleChange$,f.selectionMoveEnd$,f.selectionSet$).pipe($e(()=>{var Ie,Xe;const Pe=x.getUnitId(),st=re.getSheetId();if(!((Ie=f.getCurrentLastSelection())!=null&&Ie.range))return Gf;const vt=(Xe=f.getCurrentLastSelection())==null?void 0:Xe.primary;return vt?Re({unitId:Pe,subUnitId:st,primary:vt}):Re(null)})):Gf)).subscribe(re=>{var Ie,Xe,Pe,st,vt,Mt;if(re){const{unitId:jt,subUnitId:Pn,primary:es}=re;if(g.getRule(jt,Pn)){const ns=!((Xe=(Ie=v.getPermissionPoint(new oe(jt,Pn).id))==null?void 0:Ie.value)==null||Xe),ms=!((st=(Pe=v.getPermissionPoint(new cr(jt,Pn).id))==null?void 0:Pe.value)==null||st);I({viewDisable:ms,editDisable:ns});return}const{actualRow:Un,actualColumn:jn}=es,ts=C.getCellInfo(jt,Pn,Un,jn);I({editDisable:!((vt=ts?.[X.Edit])==null||vt),viewDisable:!((Mt=ts?.[X.View])==null||Mt)})}else I({viewDisable:!1,editDisable:!1})});return()=>{ut.unsubscribe()}},[x]),L.useEffect(()=>{const ut=h.visible$.subscribe(re=>{l(re.visible)});return()=>ut.unsubscribe()},[h.visible$]),L.useEffect(()=>{const ut=h.currentEditCellState$.subscribe(re=>{var Ie,Xe,Pe;(Pe=(Xe=(Ie=re?.documentLayoutObject.documentModel)==null?void 0:Ie.getBody())==null?void 0:Xe.customBlocks)!=null&&Pe.length?R(!0):R(!1)});return()=>ut.unsubscribe()},[h.currentEditCellState$]),L.useEffect(()=>{const ut=()=>{if(!F.current)return;const re=F.current.getBoundingClientRect();c.setPosition(re)};if(F.current){ut();const re=new ResizeObserver(ut);return re.observe(F.current),()=>re.disconnect()}},[c]);function we(){d(u===0?1:0),setTimeout(()=>{c.handleFoldBtnClick(u===1)},150)}function Ge(){h.isVisible().visible&&w.executeCommand(At.id,{visible:!1,eventType:bt.Keyboard,keycode:te.ESC,unitId:T.unitId})}function Ae(){h.isVisible().visible&&w.executeCommand(At.id,{visible:!1,eventType:bt.PointerDown,unitId:T.unitId})}function Ze(){c.handleFxBtnClick(!0)}const{viewDisable:ue,editDisable:ge}=b,be=ge||!!ee,Ue=be||_,Rt=L.useRef(!1),ke=()=>{try{if(h.isVisible().visible===!1&&!w.syncExecuteCommand(At.id,{visible:!0,eventType:bt.PointerDown,unitId:T.unitId})){Rt.current=!0;return}B.setContextValue(Vn,!0)}catch(ut){throw Rt.current=!0,ut}},Ye=()=>{Rt.current&&setTimeout(()=>{K.blur(!0)},30),Rt.current=!1},Ot=((i=(s=(n=T?.documentLayoutObject.documentModel)==null?void 0:n.getDrawingsOrder())==null?void 0:s.length)!=null?i:0)>0||ue;return S.jsxs("div",{"data-u-comp":"formula-bar",className:Ke("univer-box-border univer-flex univer-bg-white univer-transition-[height] univer-ease-linear dark:!univer-bg-gray-900",$m,r,{"univer-h-7":u===0,"univer-h-20":u===1,"univer-pointer-events-none":be}),children:[S.jsx("div",{className:"univer-relative univer-box-border univer-h-full univer-w-[100px]",children:S.jsx(rT,{disable:o??be})}),S.jsxs("div",{className:"univer-flex univer-size-full",children:[S.jsx("div",{className:Ke("univer-py-1.5",{"univer-cursor-not-allowed univer-text-gray-200":Ue}),children:S.jsxs("div",{className:Ke("univer-relative univer-box-border univer-flex univer-h-full univer-w-20 univer-items-center univer-justify-center univer-text-xs",Km),children:[S.jsx("span",{className:Ke("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white",{"univer-cursor-pointer univer-text-red-600 hover:univer-bg-gray-100 dark:!univer-text-green-400 dark:hover:!univer-bg-gray-700":a}),onClick:Ge,children:S.jsx(yb,{})}),S.jsx("span",{className:Ke("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white",{"univer-cursor-pointer univer-text-green-600 hover:univer-bg-gray-100 dark:!univer-text-red-400 dark:hover:!univer-bg-gray-700":a}),onClick:Ae,children:S.jsx(mo,{})}),S.jsx("span",{className:"univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-700",onClick:Ze,children:S.jsx(kb,{})})]})}),S.jsxs("div",{className:"univer-flex univer-w-full univer-flex-1 univer-overflow-hidden univer-pl-3",children:[S.jsxs("div",{ref:F,className:"univer-relative univer-flex-1",onPointerDown:ke,onPointerUp:Ye,style:{pointerEvents:Ot?"none":"auto"},children:[k&&S.jsx(k,{className:"univer-relative univer-size-full univer-break-words univer-outline-none [&>div]:univer-ring-transparent",disableSelectionOnClick:!0,editorId:it,initValue:"",onChange:()=>{},isFocus:W,unitId:T?.unitId,subUnitId:T?.sheetId,isSupportAcrossSheet:!0,resetSelectionOnBlur:!1,isSingle:!1,keyboardEventConfig:O,onFormulaSelectingChange:(ut,re)=>{N.current=ut,re&&(ut?h.enableForceKeepVisible():h.disableForceKeepVisible())},autoScrollbar:!1,disableContextMenu:!1}),Ot&&S.jsx("div",{className:"univer-pointer-events-none univer-relative univer-left-0 univer-top-0 univer-z-[100] univer-size-full univer-cursor-not-allowed univer-bg-white"})]}),S.jsx("div",{className:Ke("univer-flex univer-h-full univer-w-5 univer-cursor-pointer univer-items-center univer-justify-center univer-text-xs univer-text-gray-700 dark:!univer-text-gray-200",{"univer-cursor-not-allowed univer-text-gray-200 dark:!univer-text-gray-700":be}),onClick:we,children:S.jsx(Eb,{className:Ke({"univer-rotate-180":u===1})})})]})]}),S.jsx(NI,{components:D},"formula-aux")]})}function od(e){const{children:t,className:n,style:s,disabled:i=!1,onClick:r,...o}=e;return S.jsx(us,{"data-u-comp":"sheet-bar-append-button",className:n,size:"small",disabled:i,style:s,variant:"text",onClick:a=>{if(i){a.preventDefault();return}r&&r(a)},...o,children:t})}function aT(){const[e,t]=L.useState([]),[n,s]=L.useState(!1),i=G(P),r=G(U),o=G(ho),a=G(ft),l=zt(()=>i.getCurrentTypeOfUnit$(A.UNIVER_SHEET),null,!1,[]),u=p=>{const{sheetId:f}=p;!f||!l||(p.hidden?r.executeCommand(uo.id,{unitId:l.getUnitId(),subUnitId:f,value:f}):p.selected||r.executeCommand(Iu.id,{unitId:l.getUnitId(),subUnitId:f}),s(!1))},d=L.useCallback(()=>{if(!l)return;const p=l.getSheets(),f=l.getActiveSheet(),v=p.map((C,w)=>({label:C.getName(),index:`${w}`,sheetId:C.getSheetId(),hidden:C.isSheetHidden()===pe.TRUE,selected:f===C}));t(v)},[l,a]),c=L.useCallback(()=>r.onCommandExecuted(p=>{switch(p.id){case cn.id:case En.id:case Fr.id:case cs.id:case di.id:case lt.id:d();break}}),[r,d]);function h(){s(!0)}const g=p=>{s(p)};L.useEffect(()=>{d();const p=new Et;return p.add(c()),p.add(o.registerSheetBarMenuHandler({handleSheetBarMenu:h})),()=>p.dispose()},[c,o,d,l]);const m=L.useMemo(()=>e.map(p=>({type:"item",children:S.jsxs("div",{className:"univer-relative univer-box-border univer-overflow-hidden univer-truncate univer-pl-6",children:[(p.selected||p.hidden)&&S.jsxs("span",{className:"univer-absolute univer-left-1 univer-top-0.5",children:[p.selected&&S.jsx(mo,{className:"univer-size-4 univer-text-primary-600"}),p.hidden&&S.jsx(xb,{className:"univer-size-4 univer-text-gray-400"})]}),S.jsx("span",{className:Ke({"univer-text-primary-600":p.selected}),children:p.label})]}),onSelect:()=>{u(p)}})),[e]);return S.jsx(Jm,{className:"univer-max-w-lg",align:"start",items:m,open:n,onOpenChange:g,children:S.jsx("div",{children:S.jsx(od,{children:S.jsx(Mb,{})})})})}function lT(e){const{sheetId:t,label:n,color:s,selected:i}=e,[r,o]=L.useState(i),a=G(xn);L.useEffect(()=>{o(i)},[i]);const l=u=>{const d=a.getColorFromTheme("gray.900"),c=a.getColorFromTheme("white");return new Ls(u).isDark()?c:d};return S.jsx("div",{"data-u-comp":"slide-tab-item","data-id":t,className:Ke("univer-mx-1 univer-box-border univer-flex univer-flex-grow univer-cursor-pointer univer-select-none univer-flex-row univer-items-center univer-rounded univer-text-xs univer-transition-[colors,box-shadow]",{"dark:!univer-text-white":!s||s&&!l(s),"univer-justify-center univer-bg-white univer-font-bold univer-text-primary-700 univer-shadow":r,"dark:!univer-bg-gray-700":r&&!s,"univer-font-medium univer-text-gray-900 hover:univer-bg-gray-100":!r,"dark:hover:!univer-bg-gray-700":!r&&!s}),style:{backgroundColor:!r&&s?s:"",color:!r&&s?l(s):"",boxShadow:r&&s?`0px 0px 8px rgba(0, 0, 0, 0.08), inset 0px -2px 0px 0px ${s}`:""},children:S.jsx("div",{className:"univer-box-border univer-flex univer-max-w-lg univer-items-center univer-gap-1 univer-overflow-hidden univer-whitespace-nowrap univer-rounded univer-border-2 univer-border-solid univer-border-transparent univer-px-1.5 univer-py-1",children:n})},t)}const uT={easeOutStrong(e,t,n,s){return-n*((e=e/s-1)*e*e*e-1)+t},backOut(e,t,n,s,i){return typeof i>"u"&&(i=.7),n*((e=e/s-1)*e*((i+1)*e+i)+1)+t}},dT={loop:!1,begin:0,end:0,duration:300,delay:0,type:"easeOutStrong",receive(e){},success(e){},cancel(e){},complete(e){}};class cT{constructor(t){y(this,"_config"),y(this,"_status",0),y(this,"_start",0),y(this,"_handle",0),y(this,"_delayHandle",null),this._config={...dT,...t},this._config.loop&&(this._config.complete=()=>{},this._config.success=()=>{this.request()})}static success(...t){let n=0;return new Promise(s=>{for(let i=0;i<t.length;i++){const r=t[i],o=r._config,a=o.success;o.loop||(o.success=l=>{n++,a&&a.call(r,l),n===t.length&&s()})}})}request(){this._config.delay===0?(this._status=0,this._start=Date.now(),this._fakeHandle()):(this._delayHandle&&clearTimeout(this._delayHandle),this._delayHandle=setTimeout(()=>{this._status=0,this._start=Date.now(),this._fakeHandle()},this._config.delay))}cancel(){this._status=1,this._delayHandle&&clearTimeout(this._delayHandle),cancelAnimationFrame(this._handle)}_fakeHandle(){let t=Date.now()-this._start;t=t>=this._config.duration?this._config.duration:t;const n=uT[this._config.type](t,this._config.begin,this._config.end-this._config.begin,this._config.duration,.7).toFixed(2);if(this._config.receive(n),this._status===1){this._config.cancel(n),this._config.complete(n);return}if(t===this._config.duration){this._config.success(n),this._config.complete(n);return}this._handle=requestAnimationFrame(()=>{this._fakeHandle()})}}class Pr{constructor(t,n){y(this,"_slideTabItem"),y(this,"_animate"),y(this,"_midline",0),y(this,"_translateX"),y(this,"_scrollbar"),y(this,"_slideTabBar"),y(this,"_editMode"),y(this,"_placeholder"),this._slideTabItem=t,this._animate=null,this._translateX=0,this._editMode=!1,this._slideTabBar=n,this._placeholder=null,this._scrollbar=n.getScrollbar(),this.update()}static midline(t){return t.getBoundingRect().x+t.getBoundingRect().width/2}static leftLine(t){return t.getBoundingRect().x}static rightLine(t){return t.getBoundingRect().x+t.getBoundingRect().width}static make(t,n){const s=[];return t.forEach(i=>s.push(new Pr(i,n))),s}getSlideTabItem(){return this._slideTabItem}getEditor(){return this._slideTabItem.querySelector("span")}focus(){var t;(t=this.getEditor())==null||t.focus()}selectAll(){const t=this.getEditor();t&&ad.keepSelectAll(t)}isEditMode(){return this._editMode}classList(){return this._slideTabItem.classList}translateX(t){return this._translateX=t,this._slideTabItem.style.transform=`translateX(${t}px)`,this.getTranslateXDirection()}setEditor(t){if(!this._slideTabBar.getConfig().onNameChangeCheck())return;let n=!0;if(this._editMode===!1){const s=this._slideTabItem.querySelector("span"),i=d=>{var c;d.preventDefault();const h=(c=d.clipboardData)==null?void 0:c.getData("text/plain");if(h){const g=h.replace(/\s/g,"");document.execCommand("insertText",!1,g)}},r=d=>{if(!this.nameCheck()){if(this._editMode=!1,s&&(s.removeAttribute("contentEditable"),s.removeEventListener("focusout",r),s.removeEventListener("compositionstart",a),s.removeEventListener("compositionend",l),s.removeEventListener("input",u),s.removeEventListener("keydown",o),s.removeEventListener("paste",i)),this._slideTabBar.removeListener(),this._slideTabBar.updateItems(),this._slideTabBar.getConfig().onChangeName){const c=s?.innerText||"",h=this.getId();this._slideTabBar.getConfig().onChangeName(h,c)}t&&t(d)}},o=d=>{s&&(d.stopPropagation(),d.key==="Enter"&&(s.blur(),d.preventDefault()))},a=()=>{n=!1},l=()=>{n=!0},u=d=>{if(!s)return;const c=31;setTimeout(()=>{if(n){const h=s.innerText;h.length>c&&(s.innerText=h.substring(0,c),ad.keepLastIndex(s))}},0)};s&&(s.setAttribute("contentEditable","true"),s.addEventListener("focusout",r),s.addEventListener("compositionstart",a),s.addEventListener("compositionend",l),s.addEventListener("input",u),s.addEventListener("keydown",o),s.addEventListener("paste",i),this._editMode=!0,ad.keepSelectAll(s))}}nameCheck(){const t=this._slideTabItem.querySelector("span");if(!t)return!1;const n=t.innerText;return this._slideTabBar.getConfig().onNameCheckAlert(n)}animate(){return{translateX:t=>{this._translateX!==t&&(this._animate&&(this._animate.cancel(),this._animate=null),this._animate=new cT({begin:this._translateX,end:t,receive:n=>{this._slideTabItem.style.transform=`translateX(${n}px)`}}),this._translateX=t,this._animate.request())},cancel:()=>{this._animate&&(this._animate.cancel(),this._animate=null)}}}after(t){this._slideTabItem.after(t._slideTabItem||t)}update(){this._midline=Pr.midline(this)}disableFixed(){if(this._placeholder){const t=this._slideTabBar.primeval();this._slideTabItem.style.removeProperty("position"),this._slideTabItem.style.removeProperty("left"),this._slideTabItem.style.removeProperty("top"),this._slideTabItem.style.removeProperty("width"),this._slideTabItem.style.removeProperty("height"),this._slideTabItem.style.removeProperty("background"),this._slideTabItem.style.removeProperty("padding"),this._slideTabItem.style.removeProperty("box-sizing"),this._slideTabItem.style.removeProperty("font-size"),this._slideTabItem.style.removeProperty("font-family"),this._slideTabItem.style.removeProperty("font-weight"),this._slideTabItem.style.removeProperty("color"),this._slideTabItem.style.removeProperty("border-radius"),this._placeholder.after(this._slideTabItem),t.removeChild(this._placeholder),this._placeholder=null}}enableFixed(){const t=document.createElement("div"),n=this.getBoundingRect(),s=getComputedStyle(this._slideTabItem),i=this._slideTabItem.querySelector("span");if(this._placeholder=t,this._placeholder.style.width=`${n.width}px`,this._placeholder.style.height=`${n.height}px`,this._placeholder.style.flexShrink="0",this._placeholder.style.margin=s.margin,this._slideTabItem.style.background=s.background,i){const r=getComputedStyle(i).padding;this._slideTabItem.style.padding=r}this._slideTabItem.style.boxSizing=s.boxSizing,this._slideTabItem.style.fontSize=s.fontSize,this._slideTabItem.style.fontFamily=s.fontFamily,this._slideTabItem.style.fontWeight=s.fontWeight,this._slideTabItem.style.color=s.color,this._slideTabItem.style.borderRadius=s.borderRadius,this._slideTabItem.style.left=`${n.x-this.getScrollbar().getScrollX()}px`,this._slideTabItem.style.top=`${n.y}px`,this._slideTabItem.style.width=`${n.width}px`,this._slideTabItem.style.height=`${n.height}px`,this._slideTabItem.style.position="fixed",this._slideTabItem.after(t),document.body.appendChild(this._slideTabItem)}addEventListener(t,n,s){this._slideTabItem.addEventListener(t,n,s)}removeEventListener(t,n,s){this._slideTabItem.removeEventListener(t,n,s)}getScrollbar(){return this._scrollbar}getMidLine(){return this._midline}getBoundingRect(){const t=this._slideTabItem.getBoundingClientRect();return t.x+=this._scrollbar.getScrollX(),t}getWidth(){return this.getBoundingRect().width}getTranslateXDirection(){const t=Pr.midline(this);return t>this._midline?1:t<this._midline?-1:0}equals(t){return t&&t._slideTabItem===this._slideTabItem}getId(){return this._slideTabItem.dataset.id||""}}class hT{constructor(t){y(this,"_slideTabBar"),y(this,"_scrollX");const n=t.primeval();this._scrollX=n.scrollLeft,this._slideTabBar=t}scrollX(t){const n=this._slideTabBar.primeval();n.scrollLeft=t,this._scrollX=n.scrollLeft}scrollRight(){const t=this._slideTabBar.primeval();t.scrollLeft=t.scrollWidth,this._scrollX=t.scrollLeft}getScrollX(){return this._scrollX}}const Cm=class wm{constructor(t){if(y(this,"_activeTabItemIndex",0),y(this,"_slideTabBar"),y(this,"_slideTabItems",[]),y(this,"_config"),y(this,"_downActionX",0),y(this,"_moveActionX",0),y(this,"_compareIndex",0),y(this,"_activeTabItem",null),y(this,"_moveAction"),y(this,"_upAction"),y(this,"_downAction"),y(this,"_wheelAction"),y(this,"_scrollIncremental",0),y(this,"_compareDirection",0),y(this,"_autoScrollTime",null),y(this,"_slideScrollbar"),y(this,"_longPressTimer",null),y(this,"_leftBoundingLine",0),y(this,"_rightBoundingLine",0),y(this,"_leftMoveX",0),y(this,"_rightMoveX",0),t.slideTabBarContainer==null)throw new Error("not found slide-tab-bar root element");const n=t.slideTabBarContainer.querySelector(`${t.slideTabBarSelector}`);if(n==null)throw new Error("not found slide-tab-bar");this._slideTabBar=n,this._slideScrollbar=new hT(this),this._config=t,this._initConfig();let s=0,i=0,r=0;this._downAction=o=>{var a,l,u,d,c,h;if((a=this._activeTabItem)!=null&&a.isEditMode())return;this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null);const g=(u=(l=o.target)==null?void 0:l.closest(`${t.slideTabBarItemSelector}`))==null?void 0:u.getAttribute("data-id"),m=this._slideTabItems.findIndex(T=>T.getId()===g);if(g==null||m===-1)return;if(this._activeTabItemIndex!==m){(d=this._activeTabItem)==null||d.removeEventListener("pointermove",this._moveAction),(c=this._activeTabItem)==null||c.removeEventListener("pointerup",this._upAction),this.removeListener(),this._config.onChangeTab(o,g);return}if(this._compareIndex=m,this._downActionX=o.pageX,this._moveActionX=0,this._scrollIncremental=0,this._activeTabItem=this._slideTabItems[m],!this._activeTabItem){console.error("Not found active slide-tab-item in sheet bar");return}const p=this._activeTabItem.getSlideTabItem();p?.setPointerCapture(o.pointerId),(h=this._activeTabItem)==null||h.addEventListener("pointerup",this._upAction);const{x:f,width:v}=this._activeTabItem.getBoundingRect(),{x:C,width:w}=this.getBoundingRect(),b=this._slideScrollbar.getScrollX();if(this._leftBoundingLine=this._downActionX-(f-b),this._rightBoundingLine=f-b+v-this._downActionX,this._leftMoveX=f-C-b,this._rightMoveX=C+w-(f+v)+b,o.button===2||this._hasEditItem())return;const{pageX:I,pageY:_}=o,R=Date.now(),M=R-r<=wm.DoubleClickDelay,x=Math.abs(I-s)<10,N=Math.abs(_-i)<10;M&&x&&N&&this._activeTabItem.setEditor(),s=I,i=_,r=R,this._longPressTimer=setTimeout(()=>{var T,O,k;!p||(T=this._activeTabItem)!=null&&T.isEditMode()||((O=this._activeTabItem)==null||O.enableFixed(),this._startAutoScroll(),p.setPointerCapture(o.pointerId),p.style.cursor="move",(k=this._activeTabItem)==null||k.addEventListener("pointermove",this._moveAction))},wm.LongPressDelay)},this._upAction=o=>{var a,l,u,d;if((a=this._activeTabItem)!=null&&a.isEditMode()||(this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null),!this._activeTabItem))return;const c=this._autoScrollTime!==null;this._closeAutoScroll(),this._activeTabItem.disableFixed(),this.updateItems();const h=(l=this._activeTabItem)==null?void 0:l.getSlideTabItem();h&&(h.style.cursor="",h.releasePointerCapture(o.pointerId),(u=this._activeTabItem)==null||u.removeEventListener("pointermove",this._moveAction),(d=this._activeTabItem)==null||d.removeEventListener("pointerup",this._upAction),this._config.onSlideEnd&&this._activeTabItemIndex!==this._compareIndex&&c&&(this.removeListener(),this._config.onSlideEnd(o,this._compareIndex||0)),this._scrollIncremental=0,this._downActionX=0,this._moveActionX=0,this._compareIndex=0)},this._moveAction=o=>{this._activeTabItem&&(this._moveActionX=o.pageX-this._downActionX,this._moveActionX<=-this._leftMoveX?this._moveActionX=-this._leftMoveX:this._moveActionX>=this._rightMoveX&&(this._moveActionX=this._rightMoveX),this._scrollIncremental=0,this._scrollLeft(o),this._scrollRight(o))},this._wheelAction=o=>{this.setScroll(o.deltaY)},this.addListener()}static checkedSkipSlide(t){let n=t.target;for(;n!=null&&n!==document.body;){if(n.getAttribute("data-slide-skip"))return!0;n=n.parentElement}return!1}static keepLastIndex(t){setTimeout(()=>{const n=window.getSelection();n&&(n.selectAllChildren(t),n.collapseToEnd())})}static keepSelectAll(t){setTimeout(()=>{const n=window.getSelection();if(!n)return;const s=document.createRange();s.selectNodeContents(t),n.removeAllRanges(),n.addRange(s)})}update(t){this._config.currentIndex=t,this._initConfig(),this.removeListener(),this.addListener(),this.scrollToItem(t)}primeval(){return this._slideTabBar}updateItems(){for(let t=0;t<this._slideTabItems.length;t++)this._slideTabItems[t].animate().cancel(),this._slideTabItems[t].translateX(0),this._slideTabItems[t].update()}getScrollbar(){return this._slideScrollbar}getConfig(){return this._config}getBoundingRect(){return this._slideTabBar.getBoundingClientRect()}getSlideTabItems(){return this._slideTabItems}getActiveItem(){return this._activeTabItem}isLeftEnd(){return this._slideTabBar.scrollLeft===0}isRightEnd(){const t=this._slideTabBar.parentElement;return t?this._slideTabBar.scrollWidth-t.clientWidth===this._slideTabBar.scrollLeft:!1}addListener(){this._slideTabBar.addEventListener("wheel",this._wheelAction),this._slideTabItems.forEach(t=>{t.addEventListener("pointerdown",this._downAction)})}removeListener(){this._slideTabBar.removeEventListener("wheel",this._wheelAction),this._slideTabItems.forEach(t=>{t.removeEventListener("pointerdown",this._downAction)})}setScroll(t){if(this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+t),t>0){const n=this.calculateLeftScrollX();this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+n)}else if(t<0){const n=this.calculateRightScrollX();this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+n)}this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}flipPage(t){if(t>0){const n=this.calculateLeftScrollX(!0);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+n)}else if(t<0){const n=this.calculateRightScrollX(!0);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+n)}this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}scrollToItem(t){if(t=t??this._config.currentIndex,t<0||t>=this._slideTabItems.length){console.error("Index out of bounds");return}const n=this.calculateTabItemScrollX(t);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+n),this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}calculateLeftScrollX(t){let n=0;const s=4;return this._slideTabItems.some(i=>{const r=this._slideTabBar.getBoundingClientRect(),o=r.left+r.width,a=i.getSlideTabItem().getBoundingClientRect(),l=a.left,u=a.width;return l<o&&l+u+s*2>o?(n=t?l-r.left-s:l+u-o+s,!0):!1}),n}calculateRightScrollX(t){let n=0;const s=4;return this._slideTabItems.some(i=>{const r=this._slideTabBar.getBoundingClientRect(),o=r.left,a=i.getSlideTabItem().getBoundingClientRect(),l=a.left,u=a.width;return l-s*2<o&&l+u>o?(n=t?l+u-r.left-r.width+s:l-o-s,!0):!1}),n}calculateTabItemScrollX(t){let n=0;const s=4,i=this._slideTabBar.getBoundingClientRect(),r=i.left,o=i.left+i.width,a=this._slideTabItems[t].getSlideTabItem().getBoundingClientRect(),l=a.left,u=a.width;return l-s*2<r&&(n=l-r-s),l+u+s*2>o&&(n=l+u-o+s),n}calculateActiveTabItemScrollX(){var t;let n=0;const s=4,i=this._slideTabBar.getBoundingClientRect(),r=i.left,o=i.left+i.width,a=(t=this._activeTabItem)==null?void 0:t.getSlideTabItem().getBoundingClientRect();if(!a)return 0;const l=a.left,u=a.width;return l-s*2<r&&l+u>r&&(n=l-r-s),l<o&&l+u+s*2>o&&(n=l+u-o+s),n}destroy(){this.removeListener(),this._downActionX=0,this._moveActionX=0,this._compareDirection=0,this._compareIndex=0,this._slideTabItems=[],this._activeTabItem=null}_hasEditItem(){for(let t=0;t<this._slideTabItems.length;t++)if(this._slideTabItems[t].isEditMode())return!0;return!1}_autoScrollFrame(){if(this._activeTabItem)switch(this._compareDirection=this._activeTabItem.translateX(this._moveActionX),this._compareDirection){case 1:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareRight();break}case 0:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareIndex=this._activeTabItemIndex;break}case-1:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareLeft();break}}this._autoScrollTime=requestAnimationFrame(()=>{this._autoScrollFrame()})}_startAutoScroll(){this._autoScrollTime==null&&this._autoScrollFrame()}_closeAutoScroll(){this._autoScrollTime&&cancelAnimationFrame(this._autoScrollTime),this._autoScrollTime=null}_scrollLeft(t){const n=this.getBoundingRect(),s=t.pageX-n.x;s<this._leftBoundingLine&&(this._scrollIncremental=-Math.min(Math.abs(s-this._leftBoundingLine)*.1,50))}_scrollRight(t){const n=this.getBoundingRect(),s=t.pageX-n.x;s>n.width-this._rightBoundingLine&&(this._scrollIncremental=Math.min(Math.abs(s-(n.width-this._rightBoundingLine))*.1,50))}_sortedItems(){if(this._activeTabItem!=null&&this._activeTabItemIndex!=null&&this._compareIndex!=null&&(this._slideTabItems.splice(this._activeTabItemIndex,1),this._slideTabItems.splice(this._compareIndex,0,this._activeTabItem),this._config.slideTabBarItemAutoSort))for(let t=0;t<this._slideTabItems.length;t++){const n=this._slideTabItems[t],s=this._slideTabItems[t+1];s&&n.after(s)}}_compareLeft(){if(this._activeTabItem&&this._activeTabItemIndex){const t=this._slideTabItems.findIndex(r=>r.equals(this._activeTabItem)),n=this._slideTabItems.length,s=[];for(let r=0;r<t&&!(r>=t);r++)s.push(this._slideTabItems[r]);for(let r=t+1;r<n;r++)this._slideTabItems[r].animate().translateX(0);let i=!0;for(let r=s.length-1;r>=0;r--){const o=s[r];Pr.leftLine(this._activeTabItem)<o.getMidLine()?(o.animate().translateX(this._activeTabItem.getWidth()),this._compareIndex=r,i=!1):(o.animate().translateX(0),i&&(this._compareIndex=this._activeTabItemIndex))}}}_compareRight(){if(this._activeTabItem){const t=this._slideTabItems.findIndex(r=>r.equals(this._activeTabItem)),n=this._slideTabItems.length,s=[];for(let r=t+1;r<n;r++)s.push(this._slideTabItems[r]);for(let r=0;r<t;r++)this._slideTabItems[r].animate().translateX(0);let i=!0;for(let r=0;r<s.length;r++){const o=s[r];Pr.rightLine(this._activeTabItem)>o.getMidLine()?(o.animate().translateX(-this._activeTabItem.getWidth()),this._compareIndex=t+r+1,i=!1):(o.animate().translateX(0),i&&(this._compareIndex=this._activeTabItemIndex))}}}_initConfig(){const t=this._slideTabBar.querySelectorAll(`${this._config.slideTabBarItemSelector}`);this._downActionX=0,this._moveActionX=0,this._compareDirection=0,this._compareIndex=0,this._slideTabItems=Pr.make(t,this),this._activeTabItemIndex=this._config.currentIndex,this._activeTabItem=this._slideTabItems[this._activeTabItemIndex]}};y(Cm,"LongPressDelay",500),y(Cm,"DoubleClickDelay",300);let ad=Cm;function gT(){var e;const[t,n]=L.useState([]),[s,i]=L.useState(""),[r,o]=L.useState(""),[a,l]=L.useState(!1),[u,d]=L.useState([0,0]),c=L.useRef({slideTabBar:null}),h=L.useRef(null),g=G(U),m=G(ho),p=G(Oe),f=G(ys),v=G(xt,Gg.OPTIONAL),C=G(ft),w=G(We),b=zt(C.resetOrder$),I=go(),_=G(Je),R=L.useCallback(()=>{var ue;const ge=((ue=I.getActiveSheet())==null?void 0:ue.getSheetId())||"";i(ge);const be=I.getSheets(),Ue=I.getActiveSheet(),Rt=be.filter(ke=>!ke.isSheetHidden()).map((ke,Ye)=>{var Ot;const ut=C.getRule(I.getUnitId(),ke.getSheetId()),re=w.getSubunitRuleList(I.getUnitId(),ke.getSheetId()).length>0,Ie=ut?.permissionId||re?S.jsxs(S.Fragment,{children:[S.jsx(xf,{className:"univer-shrink-0"}),S.jsx("span",{className:"univer-truncate univer-outline-none",children:ke.getName()})]}):S.jsx("span",{className:"univer-truncate univer-outline-none",children:ke.getName()});return{sheetId:ke.getSheetId(),label:Ie,index:Ye,selected:Ue===ke,color:(Ot=ke.getTabColor())!=null?Ot:void 0}});n(Rt),i(ge)},[w,I,C]);L.useEffect(()=>{R();const{slideTabBar:ue,disconnectResizeObserver:ge}=M(),be=F(),Ue=[K(),J(),ee()];return()=>{be.dispose(),ue.destroy(),Ue.forEach(Rt=>Rt.unsubscribe()),ge&&ge()}},[b,I]),L.useEffect(()=>{t.length>0&&W()},[t]),L.useEffect(()=>{const ue=Ut(C.ruleChange$,w.ruleChange$).subscribe(()=>{R()});return()=>{ue.unsubscribe()}},[C,R]);const M=()=>{const ue=new ad({slideTabBarSelector:"[data-u-comp=slide-tab-bar]",slideTabBarItemSelector:"[data-u-comp=slide-tab-item]",slideTabBarItemAutoSort:!0,slideTabBarContainer:h.current,currentIndex:0,onChangeName:(be,Ue)=>{var Rt;if(((Rt=I.getSheetBySheetId(be))==null?void 0:Rt.getName())===Ue){R();return}g.executeCommand(zr.id,{subUnitId:be,name:Ue})},onSlideEnd:async(be,Ue)=>{await g.executeCommand(hh.id,{order:Ue})},onChangeTab:(be,Ue)=>{g.executeCommand(lt.id,{subUnitId:Ue,unitId:I.getUnitId()}).then(()=>{be.button===2&&Ze(!0)})},onScroll:be=>{m.setScroll(be)},onNameCheckAlert:be=>T(be)||O(be)||k(be),onNameChangeCheck:()=>{var be,Ue,Rt,ke;const Ye=I.getUnitId(),Ot=I?.getActiveSheet();if(!Ot)throw new Error("No active sheet found");const ut=Ot.getSheetId(),re=C.getRule(Ye,ut),Ie=w.getSubunitRuleList(Ye,ut).length>0;return re||Ie?(Ue=(be=_.getPermissionPoint(new xa(Ye).id))==null?void 0:be.value)!=null?Ue:!1:(ke=(Rt=_.getPermissionPoint(new ka(Ye).id))==null?void 0:Rt.value)!=null?ke:!1}});c.current.slideTabBar=ue;const ge=Ae(ue);return{slideTabBar:ue,disconnectResizeObserver:ge}},x=ba(Fc),N=(e=x?.contextMenu)!=null?e:!0,T=ue=>{if(ue.trim()===""){const ge="sheetNameEmptyAlert";return f.open({id:ge,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameCannotIsEmptyError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){D(),f.close(ge)},onConfirm(){D(),f.close(ge)}}),!0}return!1},O=ue=>{if(!pI(ue)){const ge="sheetNameSpecCharAlert";return f.open({id:ge,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameSpecCharError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){D(),f.close(ge)},onConfirm(){D(),f.close(ge)}}),!0}return!1},k=ue=>{const ge=I.getActiveSheet();if(ge?.getName()===ue)return!1;const be=I.checkSheetName(ue);if(be){const Ue="sheetNameRepeatAlert";f.open({id:Ue,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameAlreadyExistsError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){f.close(Ue),D()},onConfirm(){f.close(Ue),D()}})}return be},D=()=>{setTimeout(()=>{var ue;const ge=(ue=c.current.slideTabBar)==null?void 0:ue.getActiveItem();ge&&(ge.focus(),ge.selectAll())},0)},B=()=>{var ue,ge;(ge=(ue=c.current.slideTabBar)==null?void 0:ue.getActiveItem())==null||ge.setEditor()},W=()=>{var ue;const ge=t.findIndex(be=>be.selected);(ue=c.current.slideTabBar)==null||ue.update(ge)},F=()=>g.onCommandExecuted(ue=>{switch(ue.id){case kr.id:case cn.id:case En.id:case Fr.id:case cs.id:case di.id:case lt.id:R();break}}),K=()=>m.scroll$.subscribe(ue=>{we(ue)}),J=()=>m.scrollX$.subscribe(ue=>{var ge;(ge=c.current.slideTabBar)==null||ge.flipPage(ue)}),ee=()=>m.renameId$.subscribe(()=>{B()}),we=ue=>{const{leftEnd:ge,rightEnd:be}=ue;let Ue="";ge&&be?Ue="":ge&&!be?Ue="inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)":!ge&&be?Ue="inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2)":!ge&&!be&&(Ue="inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2), inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)"),o(Ue)},Ge=ue=>{const ge=ue.calculateActiveTabItemScrollX();if(ge){const be=ue.getScrollbar();be.scrollX(be.getScrollX()+ge)}m.setScroll({leftEnd:ue.isLeftEnd(),rightEnd:ue.isRightEnd()})},Ae=ue=>{var ge;const be=(ge=h.current)==null?void 0:ge.querySelector("[data-u-comp=slide-tab-bar]");if(!be)return;const Ue=new ResizeObserver(()=>{Ge(ue)});return Ue.observe(be),()=>Ue.disconnect()},Ze=ue=>{var ge,be,Ue,Rt,ke;if(N&&!(v!=null&&v.isForceKeepVisible())){if(ue){const{left:Ye}=(be=(ge=h.current)==null?void 0:ge.getBoundingClientRect())!=null?be:{},{left:Ot}=(ke=(Rt=(Ue=c.current.slideTabBar)==null?void 0:Ue.getActiveItem())==null?void 0:Rt.getSlideTabItem().getBoundingClientRect())!=null?ke:{};Ye!==void 0&&Ot!==void 0&&d([Ot-Ye,0])}l(ue)}};return S.jsx(u0,{className:"univer-select-none",visible:a,align:{offset:u},trigger:["contextMenu"],overlay:S.jsx(BI,{menuType:un.FOOTER_TABS,onOptionSelect:ue=>{const{label:ge,value:be,commandId:Ue}=ue;g.executeCommand(Ue??ge,{value:be,subUnitId:s}),l(!1)}}),onVisibleChange:Ze,children:S.jsx("div",{className:"univer-max-w-[calc(100%-112px)] univer-overflow-hidden",ref:h,onDragStart:ue=>ue.preventDefault(),onContextMenu:ue=>ue.preventDefault(),children:S.jsx("div",{"data-u-comp":"slide-tab-bar",className:"univer-flex univer-select-none univer-flex-row univer-items-center univer-overflow-hidden univer-px-1.5 univer-py-1",style:{boxShadow:r},children:t.map(ue=>L.createElement(lT,{...ue,key:ue.sheetId,selected:s===ue.sheetId}))})})})}const nC=100,mT=()=>{var e,t;const[n,s]=L.useState(!0),[i,r]=L.useState(!0),o=G(U),a=G(ho),l=G(Je),u=go().getUnitId(),d=zt(l.getPermissionPoint$((e=new ne(u))==null?void 0:e.id)),c=zt(l.getPermissionPoint$((t=new mu(u))==null?void 0:t.id)),h=f=>{const{leftEnd:v,rightEnd:C}=f;s(v),r(C)};L.useEffect(()=>{const f=a.scroll$.subscribe(lw(v=>{h(v)},100));return()=>{f.unsubscribe()}},[]);const g=()=>{o.executeCommand(Go.id),setTimeout(()=>{a.setAddSheet(0)},0)},m=()=>{a.setScrollX(-nC)},p=()=>{a.setScrollX(nC)};return S.jsxs("div",{className:"univer-relative univer-flex univer-h-full univer-min-w-0 univer-flex-1",children:[S.jsxs("div",{className:"univer-flex univer-items-center",children:[S.jsx(od,{className:"univer-mr-2",onClick:g,disabled:!(c!=null&&c.value&&d!=null&&d.value),children:S.jsx(Ef,{})}),S.jsx(aT,{})]}),S.jsx(gT,{}),(!n||!i)&&S.jsxs("div",{className:'univer-relative univer-flex univer-items-center univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',children:[S.jsx(od,{disabled:n,onClick:m,children:S.jsx(vm,{className:"univer-rotate-180"})}),S.jsx(od,{disabled:i,onClick:p,children:S.jsx(vm,{})})]})]})},pT=[50,75,100,125,150,175,200,400];function fT(){const e=G(U),t=G(P),n=go(),s=G(xt),i=zt(s.visible$),r=L.useCallback(()=>{if(!n)return 100;const d=n.getActiveSheet(),c=d&&d.getZoomRatio()*100||100;return Math.round(c)},[n]),[o,a]=L.useState(()=>r());L.useEffect(()=>(a(r()),e.onCommandExecuted(d=>{if(d.id===Mi.id||d.id===lt.id){const c=r();a(c)}}).dispose),[e,r]);function l(d){a(d);const c=t.getCurrentUnitForType(A.UNIVER_SHEET),h=c?.getActiveSheet();if(h==null)return;const g=d/100;e.executeCommand(Da.id,{unitId:c.getUnitId(),subUnitId:h.getSheetId(),zoomRatio:g})}const u=i?.visible&&(i.unitId===n?.getUnitId()||i.unitId===it);return S.jsx(ZI,{disabled:u,min:gm[0],value:o,shortcuts:pT,onChange:l})}function vT(){return S.jsx("section",{className:"univer-flex univer-flex-shrink-0 univer-justify-end",children:S.jsx(fT,{})})}class Wb{constructor(){y(this,"_functions",[{func:wt.MAX,filter:t=>{var n,s,i,r;return((s=(n=t.values.find(o=>o.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1&&((r=(i=t.values.find(o=>o.func===wt.COUNT))==null?void 0:i.value)!=null?r:0)>0}},{func:wt.MIN,filter:t=>{var n,s,i,r;return((s=(n=t.values.find(o=>o.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1&&((r=(i=t.values.find(o=>o.func===wt.COUNT))==null?void 0:i.value)!=null?r:0)>0}},{func:Gc.SUM,filter:t=>{var n,s,i,r;return((s=(n=t.values.find(o=>o.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1&&((r=(i=t.values.find(o=>o.func===wt.COUNT))==null?void 0:i.value)!=null?r:0)>0}},{func:wt.COUNTA,filter:t=>{var n,s;return((s=(n=t.values.find(i=>i.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1}},{func:wt.COUNT,filter:t=>{var n,s,i,r;return((s=(n=t.values.find(o=>o.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1&&((r=(i=t.values.find(o=>o.func===wt.COUNT))==null?void 0:i.value)!=null?r:0)>0}},{func:wt.AVERAGE,filter:t=>{var n,s,i,r;return((s=(n=t.values.find(o=>o.func===wt.COUNTA))==null?void 0:n.value)!=null?s:0)>1&&((r=(i=t.values.find(o=>o.func===wt.COUNT))==null?void 0:i.value)!=null?r:0)>0}}]),y(this,"_state$",new xe(null)),y(this,"state$",this._state$.asObservable())}dispose(){this._state$.complete()}setState(t){var n;const s={values:[],pattern:null};t?.values.forEach(i=>{const r=this._functions.find(o=>o.func===i.func);r&&(r.filter===void 0||r.filter(t))&&s.values.push(i)}),s.pattern=(n=t?.pattern)!=null?n:null,this._state$.next(s)}getState(){return this._state$.getValue()}getFunctions(){return this._functions}addFunctions(t){this._functions.push(...t)}}const Vh=bn("univer.sheet-status-bar.service"),CT=[Gc.SUM,wt.AVERAGE,wt.MIN,wt.MAX],sC={[Gc.SUM]:"statusbar.sum",[wt.AVERAGE]:"statusbar.average",[wt.MIN]:"statusbar.min",[wt.MAX]:"statusbar.max",[wt.COUNT]:"statusbar.count",[wt.COUNTA]:"statusbar.countA",[y0.CONCATENATE]:"concatenate"},wT=e=>{const t=G(Oe),n=G(mw),s=G(zc),i=ST(e),r=async()=>{await s.writeText(e.value.toString()),n.show({type:Sw.Success,content:t.t("statusbar.copied")})};return S.jsx(Hi,{title:t.t("statusbar.clickToCopy"),placement:"top",children:S.jsx("div",{className:"univer-flex univer-cursor-pointer univer-truncate univer-text-center univer-text-xs univer-text-gray-400",onClick:r,children:S.jsx("span",{children:`${t.t(sC?.[e.name]||e.name)}: ${i}`})},e.name)})};function ST(e){const{pattern:t,value:n}=e;return typeof n!="number"?0:n>=1e8?n.toExponential(2):t&&CT.includes(e.name)?bl.format(t,n,{throws:!1}):n.toLocaleString()}const iC=800,bT=3,_T=()=>{var e,t;const n=(t=(e=ba(Jt))==null?void 0:e.statusBarStatistic)!=null?t:!0,[s,i]=L.useState(window.innerWidth<iC),r=G(Vh),o=r.getFunctions().map((h,g)=>({name:h.func,value:0,show:!0,disable:!1,pattern:null})),a=(h,g,m,p)=>{const[f,v]=L.useState(h),[C,w]=L.useState(!0),b=L.useMemo(()=>f.filter(M=>M.show&&!M.disable),[f]),I=L.useMemo(()=>b.find(M=>M.show&&!M.disable),[b]),_=L.useMemo(()=>m&&I?[I]:b,[m,I,b]),R=L.useCallback(M=>{const x=M?.values;if(!(x!=null&&x.length)){w(!1);return}w(!0),v(N=>N.map(T=>{var O,k,D;return{...T,value:(k=(O=x.find(B=>B.func===T.name))==null?void 0:O.value)!=null?k:T.value,disable:!x.some(B=>B.func===T.name),pattern:(D=M?.pattern)!=null?D:null}}))},[]);return L.useEffect(()=>{if(!p)return;const M=g.state$.subscribe(R);return()=>M.unsubscribe()},[p,g,R]),{statistics:f,showList:_,show:C}},{showList:l,show:u}=a(o,r,s,n),d=vd(()=>{const h=window.innerWidth<iC;s!==h&&i(h)},100);L.useEffect(()=>(window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}),[s]);const c=((h,g,m)=>n?L.useMemo(()=>h.length>g?h.reduce((p,f,v)=>(v%2===0&&p.push(h.slice(v,v+2)),p),[]).map((p,f)=>S.jsxs("div",{className:"univer-grid univer-h-full univer-items-center",children:[p[0]&&S.jsx(m,{...p[0]},p[0].name),p[1]&&S.jsx(m,{...p[1]},p[1].name)]},`stat-col-${f}`)):h.map(p=>S.jsx("div",{className:"univer-grid univer-h-full univer-items-center",children:S.jsx(m,{...p})},p.name)),[h,g,m]):null)(l,bT,wT);return u&&S.jsx("div",{className:Ke('univer-relative univer-box-border univer-flex univer-h-full univer-items-center univer-overflow-hidden univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-block after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',{"univer-max-w-32":s,"univer-max-w-fit":!s}),children:S.jsx("div",{className:"univer-flex univer-h-full univer-gap-x-2",children:c})})},Lb=36;function IT(){var e;const t=ba(Jt),n=G(jm),s=(e=t?.footer)!=null?e:!0;if(!go()||!s)return null;const i=n.getMenuByPositionKey(un.FOOTER_MENU),{sheetBar:r=!0,statisticBar:o=!0,menus:a=!0,zoomSlider:l=!0}=t?.footer||{};return!r&&!o&&!a&&!l?null:S.jsxs("section",{className:"univer-box-border univer-grid univer-w-full univer-grid-flow-col univer-grid-cols-[1fr,auto,auto,auto] univer-items-center univer-justify-between univer-bg-white univer-px-5 univer-text-gray-900 dark:!univer-bg-gray-900 dark:!univer-text-gray-200",style:{height:Lb},"data-range-selector":!0,children:[r&&S.jsx(mT,{}),o&&S.jsx(_T,{}),a&&i.length>0&&S.jsx("div",{className:"univer-box-border univer-flex univer-gap-2 univer-px-2",children:i.map(u=>{var d;return(d=u.children)==null?void 0:d.map(c=>c?.item&&S.jsx(OI,{...c.item},c.key))})}),l&&S.jsx(vT,{})]})}function RT(){const e=ba(Jt);return jb()&&e?.formulaBar!==!1?S.jsx(oT,{}):null}function Bb(){const e=ba(Jt),t=jb(),n=G(Tn).get("ShapeTextEditorContainer");return t?S.jsxs(S.Fragment,{children:[n&&S.jsx(n,{}),!(e!=null&&e.disableEdit)&&S.jsx(sT,{}),S.jsx(nT,{})]}):null}function jb(){const e=G(P),t=!!zt(()=>e.getCurrentTypeOfUnit$(A.UNIVER_SHEET),null,!1,[]);return L.useMemo(()=>e.getAllUnitsForType(A.UNIVER_SHEET).length>0,[e,t])}var yT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},bo=(e,t)=>(n,s)=>t(n,s,e);const rC=5,oC=2;let tu=class extends ae{constructor(e,t,n,s,i,r){super(),this._layoutService=e,this._cellEditorManagerService=t,this._editorBridgeService=n,this._renderManagerService=s,this._univerInstanceService=i,this._configService=r}get _currentRenderer(){return du(A.UNIVER_SHEET,this._univerInstanceService,this._renderManagerService)}get _editingUnitId(){var e,t;return(t=(e=this._editorBridgeService.getEditCellState())==null?void 0:e.unitId)!=null?t:""}get _editingRenderer(){return this._renderManagerService.getRenderById(this._editingUnitId)}get _renderer(){var e;const t=(e=this._univerInstanceService.getCurrentUnitOfType(A.UNIVER_SHEET))==null?void 0:e.getUnitId();return this._editingUnitId===t?this._editingRenderer:this._currentRenderer}get _sheetSkeletonManagerService(){var e;return(e=this._renderer)==null?void 0:e.with(Te)}get engine(){var e;return(e=this._renderer)==null?void 0:e.engine}fitTextSize(e){var t,n,s,i;const r=this._editorBridgeService.getEditCellState();if(!r)return;const{position:o,documentLayoutObject:a,canvasOffset:l,scaleX:u,scaleY:d}=r,{startX:c,startY:h,endX:g,endY:m}=o,p=this._univerInstanceService.getUnit(rt,A.UNIVER_DOC);if(p==null)return;const f=this._getEditorSkeleton();if(!f)return;const v=this._predictingSize(o,l,f,a,u,d);if(!v||v.actualWidth<=0)return;let{actualWidth:C,actualHeight:w}=v;const{verticalAlign:b,horizontalAlign:I,paddingData:_,fill:R}=a;C=C+((t=_.l)!=null?t:0)*u+((n=_.r)!=null?n:0)*u,w=w+((s=_.t)!=null?s:0)*d+((i=_.b)!=null?i:0)*d;let M=g-c,x=m-h;M<C&&(M=Math.ceil(C)),x<w&&(x=Math.ceil(w));let N=0;b===vn.MIDDLE?N=(x-w)/2/d:b===vn.TOP?N=_.t||0:N=(x-w)/d;let T=0;I===Pt.CENTER||(I===Pt.RIGHT?T=(M-C)/u:T=_.l||0),N=Math.max(N,_.t||0),T=Math.max(T,_.l||0),p.updateDocumentDataMargin({t:N,l:T}),f.calculate(),this._editAreaProcessing(M,x,o,l,R,u,d,I,e)}_predictingSize(e,t,n,s,i=1,r=1){const{startX:o,endX:a}=e,{textRotation:l,wrapStrategy:u,paddingData:d}=s,c=this._univerInstanceService.getUnit(rt,A.UNIVER_DOC),{vertexAngle:h}=Ym(l);if(u===ws.WRAP&&h===0){c?.updateDocumentDataPageSize((a-o)/i),c?.updateDocumentDataMargin({l:d.l,t:d.t}),n.calculate();const{actualWidth:f,actualHeight:v}=n.getActualSize();return{actualWidth:f*i,actualHeight:v*r}}const g=this._getEditorMaxSize(e,t,s.horizontalAlign);if(!g)return;c?.updateDocumentDataPageSize(g.width/i),n.calculate();const m=n.getActualSize();let p=a-o;return p<m.actualWidth*i+rC*i&&(p=m.actualWidth*i+rC*i),c?.updateDocumentDataPageSize(p/i),c?.updateDocumentRenderConfig({horizontalAlign:Pt.UNSPECIFIED,cellValueType:void 0}),{actualWidth:m.actualWidth*i,actualHeight:m.actualHeight*r}}_getEditorMaxSize(e,t,n){var s,i,r,o;if(this._getEditorObject()==null)return;function a(I){return Number.parseInt(I.replace("px",""))}const l=this.engine;if(!l)return;const u=l.getCanvasElement(),d=u.getBoundingClientRect(),c=a(u.style.width),{width:h}=d,g=h/c,{startX:m,startY:p,endX:f}=e,v=l.width,C=((i=(s=this._configService.getConfig(Fc))==null?void 0:s.footer)==null||i)&&((o=(r=this._configService.getConfig(Jt))==null?void 0:r.footer)==null||o)?Lb:0,w=document.body.clientHeight-p-C-t.top-oC*2;let b=h-m;if(n===Pt.CENTER){const I=v-f,_=m;b=f-m+Math.min(_,I)*2}else n===Pt.RIGHT&&(b=f);return{height:w,width:b-oC,scaleAdjust:g}}_editAreaProcessing(e,t,n,s,i,r=1,o=1,a,l){var u;const d=this._getEditorObject();if(d==null)return;const c=this.engine;if(!c)return;const h=c.getCanvasElement();let{startX:g,startY:m}=n;const{document:p,scene:f,engine:v}=d,C=f.getViewport(gd.VIEW_MAIN),w=this._getEditorMaxSize(n,s,a),{height:b,width:I,scaleAdjust:_}=w;let R=t,M=C?.getScrollBar();R>b?(M==null?C&&new Zm(C,{enableHorizontal:!1,barSize:8}):C?.resetCanvasSizeAndUpdateScroll(),C?.scrollToViewportPos({viewportScrollY:R-b}),R=b):(M=null,(u=C?.getScrollBar())==null||u.dispose()),e+=M?.barSize||0,e>I&&(e=I),this._addBackground(f,e/r,t/o,i);const{scaleX:x,scaleY:N}=f.getPrecisionScale();f.transformByState({width:e*_/r,height:t*_/o,scaleX:r*_,scaleY:o*_}),p.resize(e*_/r,t*_/o),setTimeout(()=>{v.resizeBySize(iv(e,x),iv(R,N)),l?.()},0);const T=this._layoutService.getContentElement().getBoundingClientRect(),O=h.getBoundingClientRect();g=g*_+(O.left-T.left),m=m*_+(O.top-T.top);const k=n.endX-n.startX;a===Pt.RIGHT?g+=(k-e)*_:a===Pt.CENTER&&(g+=(k-e*_)/2),this._cellEditorManagerService.setState({startX:g,startY:m,endX:e*_+g,endY:R*_+m,show:!0})}_addBackground(e,t,n,s){const i="_backgroundRectHelperColor_",r=e.getObject(i);r==null&&s==null||(r==null?e.addObjects([new Be(i,{width:t,height:n,fill:s,evented:!1})],U_):s==null?r.dispose():(r.setProps({fill:s}),r.transformByState({width:t,height:n})))}resizeCellEditor(e){var t,n;const s=this._cellEditorManagerService.getState();if(!s||!this._editorBridgeService.isVisible().visible)return;this._editorBridgeService.refreshEditCellPosition(!0);const i=this._editorBridgeService.getEditCellState();if(!i)return;const r=(n=(t=this._sheetSkeletonManagerService)==null?void 0:t.getSkeletonParam(i.sheetId))==null?void 0:n.skeleton;if(!r)return;const{row:o,column:a,scaleX:l,scaleY:u,position:d,canvasOffset:c,documentLayoutObject:h}=i,{horizontalAlign:g}=h,m=this._getEditorMaxSize(d,c,g);if(!m)return;const{height:p,width:f,scaleAdjust:v}=m,C=r.getCellWithCoordByIndex(o,a),w=Math.min((C.mergeInfo.endY-C.mergeInfo.startY)*u,p)*v,b=Math.min((C.mergeInfo.endX-C.mergeInfo.startX)*l,f)*v,I=s.endY-s.startY,_=s.endX-s.startX;if(I!==w||_!==b){if(this._editorBridgeService.refreshEditCellPosition(!0),!this._getEditorSkeleton())return;this.fitTextSize(e)}}_getEditorObject(){return of(this._editorBridgeService.getCurrentEditorId(),this._renderManagerService)}_getEditorSkeleton(){var e;return(e=this._renderManagerService.getRenderById(rt))==null?void 0:e.with(Fi).getSkeleton()}};tu=yT([bo(0,zm),bo(1,ku),bo(2,xt),bo(3,ze),bo(4,P),bo(5,Lt)],tu);var MT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},fr=(e,t)=>(n,s)=>t(n,s,e);let nu=class extends Ms{constructor(e,t,n,s,i,r,o,a){super(),y(this,"_d"),this._context=e,this._instanceSrv=t,this._commandService=n,this._editorBridgeService=s,this._selectionManagerService=i,this._contextService=r,this._renderManagerService=o,this._sheetSkeletonManagerService=a,this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(l=>{l&&l.getUnitId()===this._context.unitId?this._d=this._init():this._disposeCurrent()}))}_init(){const e=new Et;return this._initSelectionChangeListener(e),this._initEventListener(e),this._commandExecutedListener(e),this._initialKeyboardListener(e),e}_disposeCurrent(){var e;(e=this._d)==null||e.dispose(),this._d=null}_initSelectionChangeListener(e){e.add(Ut(this._selectionManagerService.selectionMoveEnd$,this._selectionManagerService.selectionSet$,this._selectionManagerService.selectionMoveStart$).subscribe(t=>this._updateEditorPosition(t)))}_updateEditorPosition(e){var t,n,s;if(this._editorBridgeService.isVisible().visible)return;const i=(t=e?.[e.length-1])==null?void 0:t.primary;if(i){const r=this._getSheetObject(),{scene:o,engine:a}=r,l=this._context.unitId,u=(n=this._context.unit.getActiveSheet())==null?void 0:n.getSheetId();if(!u)return;const d=(s=this._sheetSkeletonManagerService.getSkeletonParam(u))==null?void 0:s.skeleton.getCellWithCoordByIndex(i.actualRow,i.actualColumn),c=d?{actualRow:d.actualRow,actualColumn:d.actualColumn,isMerged:d.isMerged,startRow:d.mergeInfo.startRow,startColumn:d.mergeInfo.startColumn,endRow:d.mergeInfo.endRow,endColumn:d.mergeInfo.endColumn,isMergedMainCell:d.isMergedMainCell}:i;this._commandService.executeCommand(_f.id,{scene:o,engine:a,primary:c,unitId:l,sheetId:u})}}refreshEditorPosition(){const e=this._selectionManagerService.getWorkbookSelections(this._context.unitId);if(e){const t=e.getCurrentSelections();t&&this._updateEditorPosition([...t])}}_initEventListener(e){const t=this._getSheetObject(),{spreadsheet:n,spreadsheetColumnHeader:s,spreadsheetLeftTopPlaceholder:i,spreadsheetRowHeader:r}=t;e.add(n.onDblclick$.subscribeEvent(o=>{o.button!==2&&this._commandService.executeCommand(At.id,{visible:!0,eventType:bt.Dblclick,unitId:this._context.unitId})})),e.add(n.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),e.add(s.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),e.add(i.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),e.add(r.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1}))}_initialKeyboardListener(e){let t=null;const n=i=>{const r=i.with(Bi);r&&(t=He(r.onInputBefore$.subscribe(o=>{if(!this._isCurrentSheetFocused())return;const a=this._contextService.getContextValue(Vn),l=this._contextService.getContextValue(kn),u=i.unitId;this._editorBridgeService.isVisible().visible||u&&l&&!a&&this._showEditorByKeyboard(o)})),e.add(t))},s=this._renderManagerService.getRenderById(rt);s?n(s):this.disposeWithMe(this._renderManagerService.created$.pipe(Wt(i=>i.unitId===rt)).subscribe(i=>{t?.dispose(),n(i)}))}_commandExecutedListener(e){const t=new Set([Vs.id,Da.id]);e.add(this._commandService.onCommandExecuted(n=>{if(t.has(n.id)){if(this._editorBridgeService.isVisible().visible)return;this._editorBridgeService.refreshEditCellState()}})),e.add(this._commandService.beforeCommandExecuted((n,s)=>{s!=null&&s.fromCollab||n.id===lt.id&&this._tryHideEditor()}))}_showEditorByKeyboard(e){const t=e?.event;e==null||!t.data&&t.inputType!=="InsertParagraph"||this._commandService.syncExecuteCommand(At.id,{visible:!0,eventType:bt.Keyboard,keycode:t.which,unitId:this._context.unitId})}_tryHideEditor(){this._editorBridgeService.isForceKeepVisible()||this._hideEditor()}_hideEditor(){this._editorBridgeService.isVisible().visible===!0&&this._commandService.syncExecuteCommand(At.id,{visible:!1,eventType:bt.PointerDown,unitId:this._context.unitId})}_getSheetObject(){return Rs(this._context.unit,this._context)}_isCurrentSheetFocused(){var e;return((e=this._instanceSrv.getFocusedUnit())==null?void 0:e.getUnitId())===this._context.unitId}};nu=MT([fr(1,P),fr(2,U),fr(3,xt),fr(4,V(q)),fr(5,Ne),fr(6,ze),fr(7,V(Te))],nu);const Fb=[te.ARROW_DOWN,te.ARROW_UP,te.ARROW_LEFT,te.ARROW_RIGHT],ET=[te.ENTER,te.TAB,...Fb];function zb(){const e=[];for(const t of Fb)e.push({id:oa.id,binding:t,preconditions:n=>ta(n),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:t,isShift:!1}}),e.push({id:oa.id,binding:t|Fe.SHIFT,preconditions:n=>ta(n),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:t,isShift:!0}});return e}const Xb={id:Nh.id,binding:te.F2,description:"shortcut.sheet.start-editing",group:"4_sheet-edit",preconditions:ot,staticParameters:{visible:!0,eventType:bt.Keyboard,keycode:te.F2}},Yb={id:At.id,binding:te.ENTER,description:"shortcut.sheet.toggle-editing",group:"4_sheet-edit",preconditions:e=>ta(e),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:te.ENTER}},Zb={id:At.id,binding:te.TAB,preconditions:e=>ta(e),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:te.TAB}},Gb={id:At.id,binding:te.ESC,description:"shortcut.sheet.abort-editing",group:"4_sheet-edit",preconditions:e=>ta(e),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:te.ESC}},qb={id:At.id,binding:te.ENTER|Fe.CTRL_COMMAND,mac:te.ENTER|Fe.MAC_CTRL,preconditions:e=>ta(e),staticParameters:{visible:!1,eventType:bt.Keyboard,keycode:te.ENTER|Fe.CTRL_COMMAND}},Qb={id:A_.id,description:"shortcut.sheet.break-line",group:"4_sheet-edit",preconditions:e=>hx(e),binding:te.ENTER|Fe.ALT},Kb={id:zC.id,preconditions:e=>lf(e)||ph(e),binding:te.BACKSPACE},$b={id:V_.id,preconditions:e=>lf(e)||ph(e),binding:te.DELETE},Jb={id:zC.id,preconditions:e=>lf(e)||ph(e),binding:te.BACKSPACE|Fe.SHIFT},e1={id:At.id,description:"shortcut.sheet.delete-and-start-editing",group:"4_sheet-edit",preconditions:e=>ot(e)&&!ph(e),binding:te.BACKSPACE,staticParameters:{visible:!0,eventType:bt.Keyboard,keycode:te.BACKSPACE}};function xT(e){return e.startsWith("'")}function kT(e){return e.slice(1)}const TT={"":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9",:"A",:"B",:"C",:"D",:"E",:"F",:"G",:"H",:"I",:"J",:"K",:"L",:"M",:"N",:"O",:"P",:"Q",:"R",:"S",:"T",:"U",:"V",:"W",:"X",:"Y",:"Z",:"a",:"b",:"c",:"d",:"e",:"f",:"g",:"h",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"q",:"r",:"s",:"t",:"u",:"v",:"w",:"x",:"y",:"z","":"%","":"-","":".","":":","":"/","":"+","":"@","":"&","":"*","":"#","":"=","":">","":"<","":"$","":'"',"":"'","":"(","":")","":" ","":",","":"!","":"?","":";","":"[","":"]","":"{","":"}"},Sm={true:"TRUE",false:"FALSE"};function PT(e){return[Zf.ZH_CN,Zf.ZH_TW].includes(e)}function UT(e,t,n,s){let i=e;if(PT(n)){if(e.startsWith("")||e.startsWith("'"))return`'${e.slice(1)}`;i=NT(i)}if(i.startsWith("="))return OT(e,i,t,s);const r=i.toLowerCase();return Sm[r]?Sm[r]:lr(i)==null?e:i}function NT(e){const t=/['"].*?['"]/g,n=[],s=e.split(t);e.replace(t,r=>(n.push(r),""));let i=s.join("").split("").map(HT).join("");return n.forEach((r,o)=>{i=i.slice(0,o*2)+r+i.slice((o+1)*2)}),i}function OT(e,t,n,s){const i=n.sequenceNodesBuilder(t);if(!i)return e;let r=t,o=0;return i.forEach((a,l)=>{if(typeof a=="object"){const u=a.token;if(Sm[u.toLowerCase()]){const d=a.startIndex+o+1,c=a.endIndex+o+2;r=_o(u.toLocaleUpperCase(),r,d,c)}else if(a.nodeType===nd.FUNCTION&&AT(u,s,i,l)||a.nodeType===nd.REFERENCE){const d=u.indexOf("!");if(d>-1){const c=u.substring(d+1),h=a.startIndex+o+(d+1)+1,g=a.endIndex+o+2;r=_o(c.toLocaleUpperCase(),r,h,g)}else{const c=a.startIndex+o+1,h=a.endIndex+o+2;r=_o(u.toLocaleUpperCase(),r,c,h)}}else if(u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'")){const d=a.startIndex+o+2,c=a.endIndex+o+1;r=_o(e.slice(d,c),r,d,c)}else if(a.nodeType!==nd.ARRAY){const d=lr(u);if(d==null){const c=a.startIndex+o+1,h=a.endIndex+o+2;r=_o(e.slice(c,h),r,c,h)}else if(typeof d.v=="number"&&(d.z===void 0||!bl.getFormatInfo(d.z).isDate)){const c=`${d.v}`,h=a.startIndex+o+1,g=a.endIndex+o+2,{processedString:m,offset:p}=DT(u,c);r=_o(m,r,h,g),o+=p}}}}),r}function AT(e,t,n,s){const i=t.getDescriptions();return n[s+1]!==_w.OPEN_BRACKET?!1:i.get(VT(e).toLocaleUpperCase())!==void 0}function VT(e){const t=/^@+/;return e.replace(t,"")}function HT(e){return TT[e]||e}function _o(e,t,n,s){return t.substring(0,n)+e+t.substring(s)}function DT(e,t){var n,s;const i=((n=e.match(/^\s*/))==null?void 0:n[0])||"",r=((s=e.match(/\s*$/))==null?void 0:s[0])||"",o=i+t+r,a=o.length-e.length;return{processedString:o,offset:a}}const WT="range_selector",LT=e=>e.includes(WT);var BT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},mn=(e,t)=>(n,s)=>t(n,s,e);const aC=-1e3;let da=class extends ae{constructor(e,t,n,s,i,r,o,a,l,u,d,c,h,g,m,p){super(),y(this,"_cursorChange",0),y(this,"_editingUnit",""),y(this,"_cursorTimeout"),this._undoRedoService=e,this._contextService=t,this._renderManagerService=n,this._editorBridgeService=s,this._cellEditorManagerService=i,this._lexerTreeBuilder=r,this._functionService=o,this._textSelectionManagerService=a,this._commandService=l,this._localService=u,this._editorService=d,this._univerInstanceService=c,this._sheetInterceptorService=h,this._sheetCellEditorResizeService=g,this._selectionManagerService=m,this._configService=p,this.disposeWithMe(this._init()),this._initEditorVisibilityListener()}dispose(){super.dispose()}get _workbookSelections(){return this._selectionManagerService.getWorkbookSelections(this._editingUnit)}_init(){const e=new Et;return this._subscribeToCurrentCell(e),this._initialCursorSync(e),this._listenEditorFocus(e),this._commandExecutedListener(e),this._initSkeletonListener(e),e.add(()=>{clearTimeout(this._cursorTimeout)}),this._cursorTimeout=setTimeout(()=>{this._cursorStateListener(e)},1e3),e}_initEditorVisibilityListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(async e=>{var t;if(this._editingUnit&&!this._editorBridgeService.isForceKeepVisible()&&(!e||e.getUnitId()!==this._editingUnit)){if(this._commandService.syncExecuteCommand(At.id,{visible:!1,eventType:bt.Keyboard,keycode:te.ESC,unitId:this._editingUnit}),!e)return;const n=(t=this._renderManagerService.getRenderById(e.getUnitId()))==null?void 0:t.with(nu);n&&n.refreshEditorPosition()}})),this.disposeWithMe(this._editorBridgeService.visible$.pipe(yn((e,t)=>e.visible===t.visible)).subscribe(async e=>{e.visible?(this._editingUnit=e.unitId,this._handleEditorVisible(e)):this._editingUnit&&(await this._handleEditorInvisible(e),this._editingUnit="")}))}_listenEditorFocus(e){const t=this._getEditorObject();t&&e.add(t.document.onPointerDown$.subscribeEvent(()=>{var n;if(this._editingUnit&&this._editorBridgeService.isVisible()){const s=this._editorBridgeService.getEditCellState(),i=this._editorBridgeService.getCurrentEditorId();if(!s||!i)return;(n=this._sheetCellEditorResizeService)==null||n.fitTextSize()}}))}_initialCursorSync(e){e.add(this._cellEditorManagerService.focus$.pipe(Wt(t=>!!t)).subscribe(()=>{var t;const n=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_DOC);if(!n)return;const s=(t=this._renderManagerService.getRenderById(n?.getUnitId()))==null?void 0:t.with(Bi);s&&s.sync()}))}_initSkeletonListener(e){const t=new Set(ap);t.delete(lt.id),e.add(this._commandService.onCommandExecuted(n=>{var s;if(t.has(n.id)){switch(n.id){case Wn.id:case Ln.id:case $t.id:case an.id:case on.id:case rn.id:{const i=this._editorBridgeService.getEditLocation();if(!i)break;const r={startRow:i.row,startColumn:i.column,endRow:i.row,endColumn:i.column},o=dS(r,n);if(!o)break;const a=o.startRow,l=o.startColumn;this._editorBridgeService.updateEditLocation(a,l);break}}(s=this._sheetCellEditorResizeService)==null||s.resizeCellEditor(()=>{this._textSelectionManagerService.refreshSelection({unitId:rt,subUnitId:rt})})}}))}_subscribeToCurrentCell(e){e.add(this._editorBridgeService.currentEditCellState$.subscribe(t=>{var n,s,i;if((n=this._configService.getConfig(Jt))!=null&&n.disableEdit||t==null||this._editorBridgeService.isForceKeepVisible())return;const r=this._editorBridgeService.getEditCellState();if(r==null)return;const{position:o,documentLayoutObject:a,scaleX:l,editorUnitId:u}=r;if(this._contextService.getContextValue(Lc))return;const d=this._getDocumentDataModel();if(d==null)return;const{startX:c,endX:h}=o,{textRotation:g,wrapStrategy:m,documentModel:p}=a,{vertexAngle:f}=Ym(g);m===ws.WRAP&&f===0&&d.updateDocumentDataPageSize((h-c)/l),this._commandService.syncExecuteCommand(jC.id,{unitId:u,snapshot:p.getSnapshot()}),this._contextService.setContextValue(Zg,!0),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}],{unitId:rt,subUnitId:rt});const v=(s=this._renderManagerService.getRenderById(rt))==null?void 0:s.with(Bi),C=(i=this._renderManagerService.getRenderById(it))==null?void 0:i.with(Bi);(v!=null&&v.canFocusing||C!=null&&C.canFocusing)&&(this._univerInstanceService.setCurrentUnitForType(rt),v?.activate(aC,aC,!0))}))}_commandExecutedListener(e){e.add(this._commandService.onCommandExecuted(n=>{var s;if(n.id===Sd.id){const i=n.params,{unitId:r}=i;if(LT(r)||(this._editorBridgeService.changeEditorDirty(!0),!this._editorBridgeService.isVisible().visible))return;r===rt&&((s=this._sheetCellEditorResizeService)==null||s.fitTextSize())}}));const t=[oa.id];e.add(this._commandService.onCommandExecuted(n=>{if(t.includes(n.id)){const s=n.params,{keycode:i,isShift:r}=s;if(i!=null&&(this._cursorChange===2||this._contextService.getContextValue(Vn))){this._moveInEditor(i,r);return}this._commandService.syncExecuteCommand(At.id,s)}n.id===Nh.id&&(this._cursorChange=2)}))}_handleEditorVisible(e){var t,n,s,i;const{eventType:r,keycode:o}=e;this._cursorChange=r===bt.PointerDown||r===bt.Dblclick?2:1;const a=this._editorBridgeService.getEditLocation();if(a==null)return;this._commandService.syncExecuteCommand(Rf.id,{range:{startRow:a.row,startColumn:a.column,endRow:a.row,endColumn:a.column}}),this._editorBridgeService.refreshEditCellPosition(!1);const{unitId:l,isInArrayFormulaRange:u=!1}=a,d=this._getEditorObject();if(d==null)return;const{document:c,scene:h}=d;this._contextService.setContextValue(It,!0);const g=this._getDocumentDataModel(),m=this._getEditorSkeleton(rt);if(!m||!g)return;(t=this._sheetCellEditorResizeService)==null||t.fitTextSize(()=>{const f=h.getViewport(gd.VIEW_MAIN);f?.scrollToViewportPos({viewportScrollX:Number.POSITIVE_INFINITY,viewportScrollY:Number.POSITIVE_INFINITY})});const p=()=>{this._emptyDocumentDataModel(g.getSnapshot().documentStyle,!!u),c.makeDirty(),(o===te.BACKSPACE||r===bt.Dblclick)&&(m.calculate(),this._editorBridgeService.changeEditorDirty(!0)),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}],{unitId:rt,subUnitId:rt})};if(this._isCellImageData(g.getSnapshot()))p();else if(r===bt.Keyboard&&o===te.F2){c.makeDirty(),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}]);const f=((s=(n=g.getBody())==null?void 0:n.dataStream.length)!=null?s:2)-2;this._textSelectionManagerService.replaceDocRanges([{startOffset:f,endOffset:f}],{unitId:rt,subUnitId:rt})}else if(r===bt.Keyboard||r===bt.Dblclick&&u)p();else if(r===bt.Dblclick){if(this._contextService.getContextValue(pd))return;const f=g.getBody().dataStream.length-2||0;this._textSelectionManagerService.replaceDocRanges([{startOffset:f,endOffset:f}])}(i=this._renderManagerService.getRenderById(l))==null||i.scene.resetCursor()}_refreshCurrentSelections(e){const t=this._workbookSelections.getSelectionsOfWorksheet(e);t&&(this._contextService.setContextValue(Fo,!1),this._commandService.syncExecuteCommand(me.id,{unitId:this._editingUnit,subUnitId:e,selections:t}))}async _handleEditorInvisible(e){var t,n;const s=this._editorBridgeService.getEditCellState(),i=this._univerInstanceService.getUnit(rt),r=Q.deepClone(i?.getSnapshot()),{keycode:o}=e;this._cursorChange=0;const a=(t=s?.unitId)!=null?t:"";if(this._exitInput(e),s==null)return;const l=this._univerInstanceService.getUnit(a,A.UNIVER_SHEET);if(!l)return;const u=l.getActiveSheet(),d=l.getUnitId(),c=u.getSheetId(),{unitId:h,sheetId:g}=s;if(d===h&&g!==c&&await this._commandService.executeCommand(Iu.id,{subUnitId:g,unitId:h}),o===te.ESC){this._editorBridgeService.isForceKeepVisible()&&this._editorBridgeService.disableForceKeepVisible(),this._refreshCurrentSelections(g);return}const m=((n=r?.body)==null?void 0:n.dataStream.length)===2,p=s.documentLayoutObject.documentModel?this._isCellImageData(s.documentLayoutObject.documentModel.getSnapshot()):!1;r&&!(m&&p)&&await this._submitEdit(r,o===(Fe.CTRL_COMMAND|te.ENTER)||o===(Fe.MAC_CTRL|te.ENTER))===!1||o!==void 0&&this._moveSelection(o,a,c)}_getEditorObject(){return of(this._editorBridgeService.getCurrentEditorId(),this._renderManagerService)}_isCellImageData(e){var t,n;return((n=(t=e.drawingsOrder)==null?void 0:t.length)!=null?n:0)>0}submitCellData(e){return this._submitEdit(e.getSnapshot())}async _submitEdit(e,t=!1){var n;const s=this._editorBridgeService.getEditCellState();if(s==null)return!0;const{unitId:i,sheetId:r,row:o,column:a}=s,l=this._univerInstanceService.getUnit(i,A.UNIVER_SHEET);if(!l)return!0;let u=l.getActiveSheet();if(!l.getSheetBySheetId(r))return!0;u=l.getActiveSheet();const d=jT({...u.getCellRaw(o,a)||{}},e,this._lexerTreeBuilder,this._localService,this._functionService,l.getStyles());if(!d)return!0;this._removeComposedCellStyleInCellData(d,u.getComposedCellStyleWithoutSelf(o,a));const c=this._sheetInterceptorService.onWriteCell(l,u,o,a,d);if(Q.diffValue(uC(c),uC(u.getCellRaw(o,a))))return!0;const h=t?(n=this._workbookSelections.getCurrentLastSelection())==null?void 0:n.range:{startRow:o,startColumn:a,endRow:o,endColumn:a},g=hn(6);return this._commandService.syncExecuteCommand(An.id,{subUnitId:r,unitId:i,range:h,value:c,redoUndoId:g})&&await this._sheetInterceptorService.onValidateCell(l,u,o,a)===!1?(this._undoRedoService.rollback(g,i),!1):!0}_removeComposedCellStyleInCellData(e,t){if(!e.s||typeof e.s=="string")return;const n=Object.keys(e.s);for(const s of n)t[s]!==void 0&&Q.diffValue(e.s[s],t[s])&&delete e.s[s]}_exitInput(e){var t,n;this._contextService.setContextValue(pd,!1),this._contextService.setContextValue(It,!1),this._contextService.setContextValue(Zg,!1),this._contextService.setContextValue(Vn,!1),this._cellEditorManagerService.setState({show:e.visible});const s=this._getEditorObject();(t=s?.scene.getViewport(gd.VIEW_MAIN))==null||t.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});const i=this._editorBridgeService.getCurrentEditorId();i==null||!this._editorService.isSheetEditor(i)||(i===rt&&((n=this._getEditorSkeleton(rt))==null||n.resetInitialWidth()),this._undoRedoService.clearUndoRedo(i),this._undoRedoService.clearUndoRedo(it))}_moveSelection(e,t,n){if(e==null||!ET.includes(e)){this._refreshCurrentSelections(n);return}let s=Z.LEFT;switch(e){case te.ENTER:s=Z.DOWN;break;case te.TAB:s=Z.RIGHT;break;case te.ARROW_DOWN:s=Z.DOWN;break;case te.ARROW_UP:s=Z.UP;break;case te.ARROW_LEFT:s=Z.LEFT;break;case te.ARROW_RIGHT:s=Z.RIGHT;break}const i=this._univerInstanceService.getCurrentUnitOfType(A.UNIVER_SHEET);t&&i?.getUnitId()!==t&&this._univerInstanceService.setCurrentUnitForType(t),e===te.ENTER||e===te.TAB?this._commandService.executeCommand(yi.id,{keycode:e,direction:s}):this._commandService.executeCommand(Jn.id,{direction:s})}_cursorStateListener(e){const t=this._getEditorObject();if(!(t!=null&&t.document))return;const{document:n}=t;e.add(He(n.onPointerDown$.subscribeEvent(()=>{this._cursorChange===1&&(this._cursorChange=2)})))}_moveInEditor(e,t){let n=Z.LEFT;e===te.ARROW_DOWN?n=Z.DOWN:e===te.ARROW_UP?n=Z.UP:e===te.ARROW_RIGHT&&(n=Z.RIGHT),t?this._commandService.executeCommand(__.id,{direction:n}):this._commandService.executeCommand(I_.id,{direction:n})}_getDocumentDataModel(){return this._univerInstanceService.getUnit(rt,A.UNIVER_DOC)}_getEditorSkeleton(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(Fi).getSkeleton()}_getEditorViewModel(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(Fi).getViewModel()}_getEditingUnit(){return this._editingUnit?this._univerInstanceService.getUnit(this._editingUnit,A.UNIVER_SHEET):null}_emptyDocumentDataModel(e,t){const n=(r,o)=>{const a=Q.deepClone(r.getSnapshot()),l=this._getEditorViewModel(r.getUnitId());l!=null&&(FT(a.body,t),o&&(a.documentStyle=e),a.drawings={},a.drawingsOrder=[],r.reset(a),l.reset(r))},s=this._getDocumentDataModel();s&&n(s,!0);const i=this._univerInstanceService.getUnit(it,A.UNIVER_DOC);i&&n(i)}};da=BT([mn(0,ce),mn(1,Ne),mn(2,ze),mn(3,xt),mn(4,ku),mn(5,V(Zc)),mn(6,Rw),mn(7,V(Qm)),mn(8,U),mn(9,V(Oe)),mn(10,no),mn(11,P),mn(12,V(_e)),mn(13,V(tu)),mn(14,V(q)),mn(15,Lt)],da);function jT(e,t,n,s,i,r){var o,a,l;if(t?.body==null)return null;const{body:u}=t;e.t=void 0;const d=u.dataStream;let c=d.substring(d.length-2,d.length)===uw?d.substring(0,d.length-2):d;const h=s.getCurrentLocale();if(c=UT(c,n,h,i),(o=t.drawingsOrder)!=null&&o.length)e.v="",e.f=null,e.si=null,e.p=t,e.t=je.STRING;else if(e.s&&Cs((l=(a=r?.get(e.s))==null?void 0:a.n)==null?void 0:l.pattern)){e.v=c,e.f=null,e.si=null,e.p=null,e.t=je.STRING,bm(u)&&u.dataStream!==`\r
`&&(e.p=t);const g=lC(t);g&&(e.s=g)}else if(Am(c)){if(e.f===c)return null;const g=n.checkIfAddBracket(c);for(let m=0;m<g;m++)c+=_w.CLOSE_BRACKET;e.f=c,e.si=null,e.v=null,e.p=null}else if(xT(c)){const g=kT(c);e.v=g,e.f=null,e.si=null,e.p=null,e.t=je.FORCE_STRING}else if(bm(u))u.dataStream===`\r
`?(e.v="",e.f=null,e.si=null,e.p=null):(e.p=t,e.v=null,e.f=null,e.si=null);else{if(c===""&&e.v==null&&e.p==null)return null;e.v=c,e.f=null,e.si=null,e.p=null;const g=lC(t);g&&(e.s=g)}return e}function bm(e){const{textRuns:t=[],paragraphs:n=[],customRanges:s,customBlocks:i=[]}=e,r=e.dataStream.replace(/(\r\n)+$/,""),o=["va"];return t.filter(a=>a.st<r.length).some(a=>{var l;return!!(a.ts&&Object.keys(a.ts).some(u=>o.includes(u)))||Object.keys((l=a.ts)!=null?l:{}).length&&a.ed-a.st<r.length})||n.some(a=>a.bullet)||n.length>=2||!!(s!=null&&s.length)||i.length>0}function lC(e){const{body:t}=e;if(!t)return null;const{textRuns:n=[]}=t;let s={};const i=t.dataStream.replace(`\r
`,"");return n.forEach(r=>{const{st:o,ed:a,ts:l}=r;a-o>=i.length&&(s={...s,...l})}),Object.keys(s).length?s:null}function FT(e,t=!1){e.dataStream=uw,e.textRuns!=null&&(e.textRuns.length===1&&!t?(e.textRuns[0].st=0,e.textRuns[0].ed=1):e.textRuns=void 0),e.paragraphs!=null&&(e.paragraphs=[{startIndex:0}]),e.sectionBreaks!=null&&(e.sectionBreaks=void 0),e.tables!=null&&(e.tables=void 0),e.customRanges!=null&&(e.customRanges=void 0),e.customBlocks!=null&&(e.customBlocks=void 0)}function uC(e){return e&&Object.fromEntries(Object.entries(e).filter(([t,n])=>!(n==null||Array.isArray(n)&&n.length===0||typeof n=="object"&&Object.keys(n).length===0)))}var zT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ks=(e,t)=>(n,s)=>t(n,s,e);let Qr=class extends Ms{constructor(e,t,n,s,i,r,o,a,l){super(),y(this,"_loadedMap",new WeakSet),y(this,"_scheduledCallback",-1),this._univerInstanceService=e,this._renderManagerService=t,this._editorBridgeService=n,this._commandService=s,this._contextService=i,this._formulaEditorManagerService=r,this._undoRedoService=o,this._textSelectionManagerService=a,this._editorService=l,this._initialize()}_initialize(){this._syncEditorSize(),this._listenFxBtnClick(),this._handleContentChange(),this._univerInstanceService.focused$.pipe(ln(this.dispose$)).subscribe(e=>{this._create(e)}),this._create(it),this.disposeWithMe(this._editorService.focus$.subscribe(()=>{var e;((e=this._editorService.getFocusEditor())==null?void 0:e.getEditorId())!==it?this._contextService.setContextValue(Vn,!1):this._contextService.setContextValue(Vn,!0)}))}_handleContentChange(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===Sd.id){const t=e.params,{unitId:n}=t;n===it&&this.autoScroll()}}))}_create(e){if(e!==it)return;const t=this._renderManagerService.getRenderById(e);if(t==null)return;const{mainComponent:n}=t;n!=null&&(this._loadedMap.has(n)||this._loadedMap.add(n))}_listenFxBtnClick(){this._formulaEditorManagerService.fxBtnClick$.pipe(ln(this.dispose$)).subscribe(()=>{var e;if(this._contextService.getContextValue(Zg)&&!this._contextService.getContextValue(It)){this._univerInstanceService.setCurrentUnitForType(it);const t=this._univerInstanceService.getUniverDocInstance(it);this._editorBridgeService.isVisible().visible===!1&&this._commandService.syncExecuteCommand(At.id,{visible:!0,eventType:bt.PointerDown,unitId:it});const n=(e=t?.getBody())==null?void 0:e.dataStream;if(n==null)return;let s=n.startsWith("=")?n:`=${n}`;s=s.replace(/\r\n$/,"");const i=[{startOffset:s.length,endOffset:s.length}],r={unitId:it,body:{dataStream:s},segmentId:"",textRanges:i};this._commandService.syncExecuteCommand(R_.id,r),requestAnimationFrame(()=>{this._textSelectionManagerService.replaceDocRanges([],{unitId:rt,subUnitId:rt}),this._textSelectionManagerService.replaceDocRanges(i,{unitId:it,subUnitId:it}),this._contextService.setContextValue(Vn,!0)})}})}_syncEditorSize(){const e=this._univerInstanceService.unitAdded$.pipe(Wt(t=>t.getUnitId()===it));this.disposeWithMe(dt([this._formulaEditorManagerService.position$,e]).subscribe(([t])=>{if(!t)return this._clearScheduledCallback();const n=of(it,this._renderManagerService),s=this._univerInstanceService.getUniverDocInstance(it);if(n==null||s==null)return this._clearScheduledCallback();const{width:i,height:r}=t;if(i===0||r===0)return this._clearScheduledCallback();const{engine:o}=n;s.updateDocumentDataPageSize(i),this.autoScroll(),this._scheduledCallback=requestIdleCallback(()=>o.resizeBySize(i,r))}))}_clearScheduledCallback(){this._scheduledCallback!==-1&&cancelIdleCallback(this._scheduledCallback),this._scheduledCallback=-1}autoScroll(){var e,t;const n=this._formulaEditorManagerService.getPosition(),s=(e=this._renderManagerService.getRenderById(it))==null?void 0:e.with(Fi).getSkeleton(),i=this._renderManagerService.getRenderById(it),r=this._univerInstanceService.getUniverDocInstance(it);if(s==null||n==null||i==null||r==null)return;const{marginTop:o=0,marginBottom:a=0}=r.getSnapshot().documentStyle,{scene:l,mainComponent:u}=i;let{actualHeight:d}=s.getActualSize();d+=o+a;const{width:c,height:h}=n,g=l.getViewport(gd.VIEW_MAIN);let m=g?.getScrollBar();l.transformByState({width:c,height:d}),u?.resize(c,d),d>h?m==null?g&&new Zm(g,{enableHorizontal:!1,barSize:8}):g?.resetCanvasSizeAndUpdateScroll():(m=null,g?.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0}),(t=g?.getScrollBar())==null||t.dispose())}};Qr=zT([Ks(0,P),Ks(1,ze),Ks(2,xt),Ks(3,U),Ks(4,Ne),Ks(5,Tu),Ks(6,ce),Ks(7,V(Qm)),Ks(8,no)],Qr);const XT="embedding_formula_editor",WP=e=>e.includes(XT),Pf=(e,t)=>{var n,s,i,r,o;const a=t.findNodePositionByCharIndex(e.startOffset,!0,e.segmentId,-1),l=t.getSkeletonData();let u=e.endOffset;if(e.segmentId){const m=(o=Array.from((s=(n=l?.skeFooters.get(e.segmentId))==null?void 0:n.values())!=null?s:[])[0])!=null?o:Array.from((r=(i=l?.skeHeaders.get(e.segmentId))==null?void 0:i.values())!=null?r:[])[0];m&&(u=Math.min(m.ed,u))}const d=t.findNodePositionByCharIndex(u,!0,e.segmentId,-1);if(!d||!a)return;const c={docsLeft:0,docsTop:0,pageMarginLeft:0,pageMarginTop:0},h=new XC(c,t),{borderBoxPointGroup:g}=h.getRangePointData(a,d);return YC(g).map(m=>({top:m.top,bottom:m.bottom,left:m.left,right:m.right}))},YT=(e,t,n=-1)=>{const s=t.findPositionByGlyph(e,n);if(!s)return;const i={...s,isBack:!0},r={docsLeft:0,docsTop:0,pageMarginLeft:0,pageMarginTop:0},o=new XC(r,t),{borderBoxPointGroup:a}=o.getRangePointData(i,i),l=YC(a)[0];return{top:l.top,bottom:l.bottom,left:l.left,right:l.right}},ZT=(e,t,n=0,s=0)=>{const i=Pf({startOffset:t.startIndex,endOffset:t.endIndex+1},e);if(i)return{rects:i.map(r=>({top:r.top+s,bottom:r.bottom+s,left:r.left+n,right:r.right+n})),range:t}},GT=(e,t,n=0,s=0)=>{var i,r,o;const a=e.findNodeByCharIndex(t.startIndex),l=a?.parent,u=l?.parent,d=u?.parent,c=d?.lines.find(m=>m.paragraphStart&&m.paragraphIndex===t.startIndex),h=(o=(r=(i=c?.divides)==null?void 0:i[0])==null?void 0:r.glyphGroup)==null?void 0:o[0];if(!h||!h)return;const g=YT(h,e);if(g)return{rect:{top:g.top+s,bottom:g.bottom+s,left:g.left+n,right:g.right+n},segmentId:void 0,segmentPageIndex:-1,paragraph:t}},qT=(e,t=0,n=0)=>{var s,i,r,o,a,l,u;const d=e.getViewModel().getDataModel(),c=(r=(i=(s=d.getBody())==null?void 0:s.customRanges)==null?void 0:i.filter(m=>m.rangeType===Bm.HYPERLINK))!=null?r:[],h=(l=(a=(o=d.getBody())==null?void 0:o.paragraphs)==null?void 0:a.filter(m=>{var p;return((p=m.bullet)==null?void 0:p.listType.indexOf(hI.CHECK_LIST))===0}))!=null?l:[],g=(u=e.getSkeletonData())==null?void 0:u.pages[0].skeDrawings;return{links:c.map(m=>ZT(e,m,t,n)).filter(Boolean),checkLists:h.map(m=>GT(e,m,t,n)).filter(Boolean),drawings:g?Array.from(g.keys()).map(m=>({drawingId:m,rect:{top:g.get(m).aTop,bottom:g.get(m).aTop+g.get(m).width,left:g.get(m).aLeft,right:g.get(m).aLeft+g.get(m).height},drawing:g.get(m)})):[]}};function t1(e,t,n){var s,i,r,o,a,l;const u=(r=(i=(s=t.documentSkeleton)==null?void 0:s.getSkeletonData())==null?void 0:i.pages[0].height)!=null?r:0,d=(l=(a=(o=t.documentSkeleton)==null?void 0:o.getSkeletonData())==null?void 0:a.pages[0].width)!=null?l:0,c=t.verticalAlign,h=t.horizontalAlign;let g=0;switch(c){case vn.UNSPECIFIED:case vn.BOTTOM:g=e.mergeInfo.endY-e.mergeInfo.startY-u;break;case vn.MIDDLE:g=(e.mergeInfo.endY-e.mergeInfo.startY-u)/2;break}let m=0;switch(h){case Pt.RIGHT:m=e.mergeInfo.endX-e.mergeInfo.startX-d;break;case Pt.CENTER:m=(e.mergeInfo.endX-e.mergeInfo.startX-d)/2;break;case Pt.UNSPECIFIED:{n&&(m=e.mergeInfo.endX-e.mergeInfo.startX-d);break}}return{paddingLeft:m,paddingTop:g}}const LP=(e,t,n,s,i,r)=>{var o,a,l;const u=e.get(P),d=e.get(ze),c=u.getUnit(t,A.UNIVER_SHEET);if(!c)return null;const h=c.getSheetBySheetId(n);if(!h)return null;const g=d.getRenderById(c.getUnitId()),m=g?.with(Te).getSkeletonParam(h.getSheetId()),p=m?.skeleton;if(!p||!g)return;const f=p.getFont(s,i),v=f?.documentSkeleton;if(!v)return null;const C=(a=(o=v.getViewModel().getBody())==null?void 0:o.customRanges)==null?void 0:a.find(D=>D.rangeId===r);if(!C)return null;const w=W_,b=p.getCellWithCoordByIndex(s,i);let{actualColumn:I,actualRow:_}=b;p.overflowCache.forValue((D,B,W)=>{W.startRow<=_&&W.endRow>=_&&W.startColumn<=I&&W.endColumn>=I&&(I=B,_=D)});const R=p.getCellWithCoordByIndex(_,I),M=h.getCell(R.actualRow,R.actualColumn),{topOffset:x=0,leftOffset:N=0}=(l=M?.fontRenderExtension)!=null?l:{},{paddingLeft:T,paddingTop:O}=t1(R,f,!1),k=Pf({startOffset:C.startIndex,endOffset:C.endIndex},v);return{rects:k?.map(D=>({top:D.top+R.mergeInfo.startY+O+x+w,bottom:D.bottom+R.mergeInfo.startY+O+x+w,left:D.left+R.mergeInfo.startX+T+N,right:D.right+R.mergeInfo.startX+T+N})),customRange:C,label:v.getViewModel().getBody().dataStream.slice(C.startIndex,C.endIndex+1)}},BP=(e,t,n,s,i,r)=>{var o,a,l;const u=e.get(xt),d=u.getEditCellState();if(!d||!u.isVisible().visible)return null;const{editorUnitId:c,unitId:h,sheetId:g,row:m,column:p}=d;if(t!==h||n!==g||m!==s||p!==i)return null;const f=e.get(ze),v=f.getRenderById(c),C=f.getRenderById(t);if(!v||!C)return null;const w=v.with(Fi).getSkeleton(),b=(o=C.with(Te).getSkeletonParam(g))==null?void 0:o.skeleton;if(!w||!b)return null;const I=(l=(a=w.getViewModel().getBody())==null?void 0:a.customRanges)==null?void 0:l.find(x=>x.rangeId===r);if(!I)return null;const _=4,R=Pf({startOffset:I.startIndex,endOffset:I.endIndex},w),M=v.engine.getCanvasElement().getBoundingClientRect();return{rects:R?.map(x=>({top:x.top+M.top-_,bottom:x.bottom+M.top+_,left:x.left+M.left,right:x.right+M.left})),customRange:I,label:w.getViewModel().getBody().dataStream.slice(I.startIndex,I.endIndex+1)}};var QT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},dC=(e,t)=>(n,s)=>t(n,s,e);function vr(e){const{workbook:t,worksheet:n,...s}=e;return s}let Kr=class extends ae{constructor(e,t){super(),y(this,"_currentCell$",new xe(null)),y(this,"_currentRichText$",new xe(null)),y(this,"_currentClickedCell$",new Ve),y(this,"_currentDbClickedCell$",new Ve),y(this,"_currentCellWithEvent$",new Ve),y(this,"_currentPointerDownCell$",new Ve),y(this,"_currentPointerUpCell$",new Ve),y(this,"_currentHoveredRowHeader$",new xe(null)),y(this,"_currentHoveredColHeader$",new xe(null)),y(this,"_currentRowHeaderClick$",new Ve),y(this,"_currentColHeaderClick$",new Ve),y(this,"_currentRowHeaderDbClick$",new Ve),y(this,"_currentColHeaderDbClick$",new Ve),y(this,"_currentRowHeaderPointerDown$",new Ve),y(this,"_currentColHeaderPointerDown$",new Ve),y(this,"_currentRowHeaderPointerUp$",new Ve),y(this,"_currentColHeaderPointerUp$",new Ve),y(this,"currentCell$",this._currentCell$.asObservable().pipe(yn((n,s)=>{var i,r,o,a,l,u,d,c;return((i=n?.location)==null?void 0:i.unitId)===((r=s?.location)==null?void 0:r.unitId)&&((o=n?.location)==null?void 0:o.subUnitId)===((a=s?.location)==null?void 0:a.subUnitId)&&((l=n?.location)==null?void 0:l.row)===((u=s?.location)==null?void 0:u.row)&&((d=n?.location)==null?void 0:d.col)===((c=s?.location)==null?void 0:c.col)}))),y(this,"currentRichTextNoDistinct$",this._currentRichText$.pipe(Se(n=>n&&{unitId:n.location.unitId,subUnitId:n.location.subUnitId,row:n.location.row,col:n.location.col,customRange:n.customRange,bullet:n.bullet,rect:n.rect,drawing:n.drawing}))),y(this,"currentRichText$",this._currentRichText$.pipe(yn((n,s)=>{var i,r,o,a,l,u,d,c,h,g,m,p,f,v,C,w,b,I;return((i=n?.location)==null?void 0:i.unitId)===((r=s?.location)==null?void 0:r.unitId)&&((o=n?.location)==null?void 0:o.subUnitId)===((a=s?.location)==null?void 0:a.subUnitId)&&((l=n?.location)==null?void 0:l.row)===((u=s?.location)==null?void 0:u.row)&&((d=n?.location)==null?void 0:d.col)===((c=s?.location)==null?void 0:c.col)&&((h=n?.customRange)==null?void 0:h.rangeId)===((g=s?.customRange)==null?void 0:g.rangeId)&&((m=n?.bullet)==null?void 0:m.startIndex)===((p=s?.bullet)==null?void 0:p.startIndex)&&((f=n?.customRange)==null?void 0:f.startIndex)===((v=s?.customRange)==null?void 0:v.startIndex)&&((C=n?.customRange)==null?void 0:C.endIndex)===((w=s?.customRange)==null?void 0:w.endIndex)&&((b=n?.drawing)==null?void 0:b.drawingId)===((I=s?.drawing)==null?void 0:I.drawingId)}),Se(n=>n&&{unitId:n.location.unitId,subUnitId:n.location.subUnitId,row:n.location.row,col:n.location.col,customRange:n.customRange,bullet:n.bullet,rect:n.rect,drawing:n.drawing}))),y(this,"currentCellPosWithEvent$",this._currentCellWithEvent$.pipe(yn((n,s)=>{var i,r,o,a,l,u,d,c;return((i=n?.location)==null?void 0:i.unitId)===((r=s?.location)==null?void 0:r.unitId)&&((o=n?.location)==null?void 0:o.subUnitId)===((a=s?.location)==null?void 0:a.subUnitId)&&((l=n?.location)==null?void 0:l.row)===((u=s?.location)==null?void 0:u.row)&&((d=n?.location)==null?void 0:d.col)===((c=s?.location)==null?void 0:c.col)}),Se(n=>n&&{unitId:n.location.unitId,subUnitId:n.location.subUnitId,row:n.location.row,col:n.location.col,event:n.event}))),y(this,"currentPosition$",this._currentCell$.asObservable()),y(this,"currentClickedCell$",this._currentClickedCell$.asObservable()),y(this,"currentDbClickedCell$",this._currentDbClickedCell$.asObservable()),y(this,"currentPointerDownCell$",this._currentPointerDownCell$.asObservable()),y(this,"currentPointerUpCell$",this._currentPointerUpCell$.asObservable()),y(this,"currentHoveredRowHeader$",this._currentHoveredRowHeader$.asObservable()),y(this,"currentHoveredColHeader$",this._currentHoveredColHeader$.asObservable()),y(this,"currentRowHeaderClick$",this._currentRowHeaderClick$.asObservable()),y(this,"currentColHeaderClick$",this._currentColHeaderClick$.asObservable()),y(this,"currentRowHeaderDbClick$",this._currentRowHeaderDbClick$.asObservable()),y(this,"currentColHeaderDbClick$",this._currentColHeaderDbClick$.asObservable()),y(this,"currentRowHeaderPointerDown$",this._currentRowHeaderPointerDown$.asObservable()),y(this,"currentColHeaderPointerDown$",this._currentColHeaderPointerDown$.asObservable()),y(this,"currentRowHeaderPointerUp$",this._currentRowHeaderPointerUp$.asObservable()),y(this,"currentColHeaderPointerUp$",this._currentColHeaderPointerUp$.asObservable()),this._univerInstanceService=e,this._renderManagerService=t,this._initCellDisposableListener()}dispose(){super.dispose(),this._currentCell$.complete(),this._currentClickedCell$.complete(),this._currentPointerDownCell$.complete(),this._currentPointerUpCell$.complete(),this._currentCellWithEvent$.complete(),this._currentRichText$.complete(),this._currentDbClickedCell$.complete(),this._currentHoveredRowHeader$.complete(),this._currentHoveredColHeader$.complete(),this._currentRowHeaderClick$.complete(),this._currentColHeaderClick$.complete(),this._currentRowHeaderDbClick$.complete(),this._currentColHeaderDbClick$.complete(),this._currentRowHeaderPointerDown$.complete(),this._currentColHeaderPointerDown$.complete(),this._currentRowHeaderPointerUp$.complete(),this._currentColHeaderPointerUp$.complete(),this.currentCellPosWithEvent$=Re(null),this.currentRichText$=Re(null)}_initCellDisposableListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(e=>{e||this._currentCell$.next(null)})),this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe(e=>{var t,n;((t=this._currentCell$.getValue())==null?void 0:t.location.unitId)===e.getUnitId()&&this._currentCell$.next(null),((n=this._currentRichText$.getValue())==null?void 0:n.location.unitId)===e.getUnitId()&&this._currentRichText$.next(null)}))}_getCalcDeps(e){const t=this._univerInstanceService.getUnit(e,A.UNIVER_SHEET);if(!t)return null;const n=t.getActiveSheet();if(!n)return null;const s=this._renderManagerService.getRenderById(t.getUnitId());if(!s)return null;const i=s.with(Te).getSkeletonParam(n.getSheetId());if(!i)return null;const r=s.with(Sn);if(!(!(r!=null&&r.getCurrentScrollState())||!s))return{currentRender:s,workbook:t,worksheet:n,skeletonParam:i}}_calcActiveCell(e,t,n,s,i,r){var o,a,l;const u=bb(e,t,n,s,i,r),d=s.skeleton;if(!u)return null;const{position:c,overflowLocation:h,location:g}=u,m=d.getFont(h.row,h.col);let p=null,f=null,v=null;const C=d.getCellWithCoordByIndex(h.row,h.col),w=n.getCell(h.row,h.col),{topOffset:b=0,leftOffset:I=0}=(o=w?.fontRenderExtension)!=null?o:{};if(m!=null&&m.documentSkeleton){const{paddingLeft:M,paddingTop:x}=t1(C,m,w?.v!==null&&w?.v!==void 0?!Number.isNaN(+w.v):!1),N=qT(m.documentSkeleton,M,x),T=i-c.startX-I,O=r-c.startY-b;p=N.links.find(k=>k.rects.some(D=>D.left<=T&&T<=D.right&&D.top<=O&&O<=D.bottom)),f=N.checkLists.find(k=>k.rect.left<=T&&T<=k.rect.right&&k.rect.top<=O&&O<=k.rect.bottom),v=N.drawings.find(k=>k.rect.left<=T&&T<=k.rect.right&&k.rect.top<=O&&O<=k.rect.bottom)}const _=(l=(a=p?.rects.pop())!=null?a:f?.rect)!=null?l:v?.rect,R=_&&(()=>{const M=_.top+C.mergeInfo.startY+b,x=_.bottom+C.mergeInfo.startY+b,N=_.left+C.mergeInfo.startX+I,T=_.right+C.mergeInfo.startX+I,O=C.mergeInfo.startY+b,k=C.mergeInfo.endY+b,D=C.mergeInfo.startX+I,B=C.mergeInfo.endX+I,W=Math.min(Math.max(M,O),O),F=Math.min(x,k),K=Math.min(Math.max(N,D),D),J=Math.min(T,B);return{top:W,bottom:F,left:K,right:J}})();return{location:g,position:c,overflowLocation:h,customRange:p?.range,bullet:f?.paragraph,drawing:v,rect:R}}_calcActiveRowHeader(e,t,n){const s=this._getCalcDeps(e);if(!s)return;const{currentRender:i,worksheet:r,skeletonParam:o}=s,{scaleY:a}=i.scene.getAncestorScale(),l=i.scene.getViewports().find(c=>c.isHit(new at(t,n)));if(!l||l.viewportKey!==$.VIEW_ROW_TOP&&l.viewportKey!==$.VIEW_ROW_BOTTOM)return;const u={x:l.viewportScrollX,y:l.viewportScrollY},d=o.skeleton.getRowIndexByOffsetY(n,a,u);return{unitId:e,index:d,subUnitId:r.getSheetId()}}_calcActiveColHeader(e,t,n){const s=this._getCalcDeps(e);if(!s)return;const{currentRender:i,worksheet:r,skeletonParam:o}=s,{scaleX:a}=i.scene.getAncestorScale(),l=i.scene.getViewports().find(c=>c.isHit(new at(t,n)));if(!l||l.viewportKey!==$.VIEW_COLUMN_LEFT&&l.viewportKey!==$.VIEW_COLUMN_RIGHT)return;const u={x:l.viewportScrollX,y:l.viewportScrollY},d=o.skeleton.getColumnIndexByOffsetX(t,a,u);return{unitId:e,index:d,subUnitId:r.getSheetId()}}triggerPointerDown(e,t){const n=this._getCalcDeps(e);if(!n)return;const{currentRender:s,workbook:i,worksheet:r,skeletonParam:o}=n,a=this._calcActiveCell(s,i,r,o,t.offsetX,t.offsetY);if(a&&a.location){const{unitId:l,subUnitId:u,row:d,col:c}=vr(a.location);this._currentPointerDownCell$.next({unitId:l,subUnitId:u,row:d,col:c,event:t})}}triggerPointerUp(e,t){const n=this._getCalcDeps(e);if(!n)return;const{currentRender:s,workbook:i,worksheet:r,skeletonParam:o}=n,a=this._calcActiveCell(s,i,r,o,t.offsetX,t.offsetY);if(a){const l=vr(a.location);this._currentPointerUpCell$.next({...l,event:t})}}triggerMouseMove(e,t){const n=this._getCalcDeps(e);if(!n)return;const{currentRender:s,workbook:i,worksheet:r,skeletonParam:o}=n,a=this._calcActiveCell(s,i,r,o,t.offsetX,t.offsetY);this._currentCell$.next(a&&{location:vr(a.location),position:a.position}),this._currentRichText$.next(a&&{...a,location:vr(a.overflowLocation)}),this._currentCellWithEvent$.next(a&&{...a,location:vr(a.location),event:t})}triggerClick(e,t,n){const s=this._getCalcDeps(e);if(!s)return;const{currentRender:i,workbook:r,worksheet:o,skeletonParam:a}=s,l=this._calcActiveCell(i,r,o,a,t,n);l&&this._currentClickedCell$.next({...l,location:vr(l.location)})}triggerDbClick(e,t,n){const s=this._getCalcDeps(e);if(!s)return;const{currentRender:i,workbook:r,worksheet:o,skeletonParam:a}=s,l=this._calcActiveCell(i,r,o,a,t,n);l&&this._currentDbClickedCell$.next({...l,location:vr(l.location)})}triggerScroll(){this._currentCell$.next(null)}triggerRowHeaderClick(e,t,n){const s=this._calcActiveRowHeader(e,t,n);s&&this._currentRowHeaderClick$.next(s)}triggerColHeaderClick(e,t,n){const s=this._calcActiveColHeader(e,t,n);s&&this._currentColHeaderClick$.next(s)}triggerRowHeaderDbClick(e,t,n){const s=this._calcActiveRowHeader(e,t,n);s&&this._currentRowHeaderDbClick$.next(s)}triggerColHeaderDbClick(e,t,n){const s=this._calcActiveColHeader(e,t,n);s&&this._currentColHeaderDbClick$.next(s)}triggerRowHeaderMouseMove(e,t,n){this._currentHoveredRowHeader$.next(this._calcActiveRowHeader(e,t,n))}triggerColHeaderMouseMove(e,t,n){this._currentHoveredColHeader$.next(this._calcActiveColHeader(e,t,n))}triggerRowHeaderPoniterDown(e,t,n){const s=this._calcActiveRowHeader(e,t,n);s&&this._currentRowHeaderPointerDown$.next(s)}triggerColHeaderPoniterDown(e,t,n){const s=this._calcActiveColHeader(e,t,n);s&&this._currentColHeaderPointerDown$.next(s)}triggerRowHeaderPoniterUp(e,t,n){const s=this._calcActiveRowHeader(e,t,n);s&&this._currentRowHeaderPointerUp$.next(s)}triggerColHeaderPoniterUp(e,t,n){const s=this._calcActiveColHeader(e,t,n);s&&this._currentColHeaderPointerUp$.next(s)}};Kr=QT([dC(0,P),dC(1,ze)],Kr);var KT=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},rg=(e,t)=>(n,s)=>t(n,s,e);let uc=class extends ae{constructor(e,t,n,s){super(),y(this,"_active",!1),this._context=e,this._hoverManagerService=t,this._sheetSkeletonManagerService=n,this._scrollManagerService=s,this._initPointerEvent(),this._initScrollEvent()}get active(){return this._active}_initPointerEvent(){const e=new Et,t=n=>{if(e.dispose(),!n)return;const{mainComponent:s,unitId:i,components:r}=this._context;if(!s)return;e.add(s.onPointerEnter$.subscribeEvent(l=>{this._active=!0})),e.add(fd(s.onPointerMove$).subscribe(l=>{this._active=!0,this._hoverManagerService.triggerMouseMove(i,l)})),e.add(s.onPointerDown$.subscribeEvent(l=>{this._hoverManagerService.triggerPointerDown(i,l)})),e.add(s.onPointerUp$.subscribeEvent(l=>{this._hoverManagerService.triggerPointerUp(i,l)})),e.add(s.onClick$.subscribeEvent(l=>{this._hoverManagerService.triggerClick(i,l.offsetX,l.offsetY)})),e.add(s.onDblclick$.subscribeEvent(l=>{this._hoverManagerService.triggerDbClick(i,l.offsetX,l.offsetY)})),e.add(s.onPointerLeave$.subscribeEvent(()=>{this._active=!1}));const o=r.get(yt.ROW),a=r.get(yt.COLUMN);o&&(e.add(o.onPointerMove$.subscribeEvent(l=>{this._hoverManagerService.triggerRowHeaderMouseMove(i,l.offsetX,l.offsetY)})),e.add(o.onPointerDown$.subscribeEvent(l=>{this._hoverManagerService.triggerRowHeaderPoniterDown(i,l.offsetX,l.offsetY)})),e.add(o.onPointerUp$.subscribeEvent(l=>{this._hoverManagerService.triggerRowHeaderPoniterUp(i,l.offsetX,l.offsetY),this._hoverManagerService.triggerRowHeaderClick(i,l.offsetX,l.offsetY)})),e.add(o.onDblclick$.subscribeEvent(l=>{this._hoverManagerService.triggerRowHeaderDbClick(i,l.offsetX,l.offsetY)}))),a&&(e.add(a.onPointerMove$.subscribeEvent(l=>{this._hoverManagerService.triggerColHeaderMouseMove(i,l.offsetX,l.offsetY)})),e.add(a.onPointerDown$.subscribeEvent(l=>{this._hoverManagerService.triggerColHeaderPoniterDown(i,l.offsetX,l.offsetY)})),e.add(a.onPointerUp$.subscribeEvent(l=>{this._hoverManagerService.triggerColHeaderPoniterUp(i,l.offsetX,l.offsetY),this._hoverManagerService.triggerColHeaderClick(i,l.offsetX,l.offsetY)})),e.add(a.onDblclick$.subscribeEvent(l=>{this._hoverManagerService.triggerColHeaderDbClick(i,l.offsetX,l.offsetY)})))};t(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n=>{t(n)}))}_initScrollEvent(){this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(()=>this._hoverManagerService.triggerScroll()))}};uc=KT([rg(1,V(Kr)),rg(2,V(Te)),rg(3,V(Sn))],uc);const Uf="UI_PLUGIN_SHEETS",Nf=`${Uf}_BORDER_PANEL_COMPONENT`,n1=[{label:"borderLine.borderTop",icon:"UpBorderDoubleIcon",value:"top"},{label:"borderLine.borderBottom",icon:"DownBorderDoubleIcon",value:"bottom"},{label:"borderLine.borderLeft",icon:"LeftBorderDoubleIcon",value:"left"},{label:"borderLine.borderRight",icon:"RightBorderDoubleIcon",value:"right"},{label:"borderLine.borderNone",icon:"NoBorderIcon",value:"none"},{label:"borderLine.borderAll",icon:"AllBorderIcon",value:"all"},{label:"borderLine.borderOutside",icon:"OuterBorderDoubleIcon",value:"outside"},{label:"borderLine.borderInside",icon:"InnerBorderDoubleIcon",value:"inside"},{label:"borderLine.borderHorizontal",icon:"HorizontalBorderDoubleIcon",value:"horizontal"},{label:"borderLine.borderVertical",icon:"VerticalBorderDoubleIcon",value:"vertical"},{label:"borderLine.borderTlbr",icon:"BackSlashDoubleIcon",value:"tlbr"},{label:"borderLine.borderTlbcTlmr",icon:"LeftDoubleDiagonalDoubleIcon",value:"tlbc_tlmr"},{label:"borderLine.borderTlbrTlbcTlmr",icon:"LeftTridiagonalDoubleIcon",value:"tlbr_tlbc_tlmr"},{label:"borderLine.borderBlTr",icon:"SlashDoubleIcon",value:"bltr"},{label:"borderLine.borderMltrBctr",icon:"RightDoubleDiagonalDoubleIcon",value:"mltr_bctr"}];function $T(e){return e.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe($e(t=>t?t.activeSheet$.pipe(Se(n=>n?{workbook:t,worksheet:n}:null)):Re(null)))}function qt(e,t,n){return $T(e).pipe($e(s=>s?n(s):Re(t)))}function JT(e,t){const n=e.get(P),s=e.get(um),i=e.get(q);return n.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe($e(r=>r?dt([i.selectionMoveEnd$,r.activeSheet$]).pipe($e(([o,a])=>{if(!a)return Re(!1);if(o.length===0)return Re(!1);const l=s.getInterestGroupId(o);if(t){const u=l.filter(d=>t.has(d));return Re(u.length>0)}else return Re(l.length>0)})):Re(!1)))}function Ei(e,t,n){return dt([t,JT(e,n)]).pipe(Se(([s,i])=>s||i))}function Me(e,t={},n=!1){var s;const i=e.get(P).getCurrentTypeOfUnit$(A.UNIVER_SHEET),r=e.get(Bn),o=e.has(xt)?e.get(xt):null,a=e.get(Ne),l=((s=o?.visible$)!=null?s:Re(null)).pipe(Nt(null),Rn(1)),u=a.subscribeContextValue$(Vn).pipe(Nt(!1),Rn(1)),d=a.subscribeContextValue$(io).pipe(Nt(!1),Rn(1));return dt([r.currentUser$,i,l,u,d]).pipe($e(([c,h,g,m,p])=>!h||g!=null&&g.visible&&g.unitId===h.getUnitId()&&!n||m&&!n?Re(!0):h.activeSheet$.pipe($e(f=>{if(!f)return Re(!0);const v=e.get(q),C=e.get(We),w=e.get(ft),b=e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1));return dt([v.selectionMoveEnd$,b]).pipe($e(([I,_])=>{if(_&&!p)return Re(!0);const R=h.getUnitId(),M=f.getSheetId(),x=e.get(Je),{workbookTypes:N=[ne],worksheetTypes:T,rangeTypes:O}=t,k=[];if(N?.forEach(W=>{k.push(new W(R).id)}),T?.forEach(W=>{k.push(new W(R,M).id)}),w.getRule(R,M))return x.composePermission$(k).pipe(Se(W=>W.some(F=>F.value===!1)));const D=I?.map(W=>W.range),B=C.getSubunitRuleList(R,M).filter(W=>D?.some(F=>W.ranges.some(K=>z.intersects(F,K))));return O?.forEach(W=>{B.forEach(F=>{k.push(new W(R,M,F.permissionId).id)})}),x.composePermission$(k).pipe(Se(W=>W.some(F=>F.value===!1)))}))}))))}function Wa(e){const t=e.get(P),n=e.get(q),s=e.get(We),i=e.get(Je);return Ut(n.selectionMoveEnd$,i.permissionPointUpdate$.pipe(Bc(100))).pipe(Se(()=>{var r;const o=(r=n.getCurrentLastSelection())==null?void 0:r.range;if(!o)return!0;const a=t.getCurrentUnitForType(A.UNIVER_SHEET),l=a?.getActiveSheet();if(!a||!l)return!0;const u=a.getUnitId(),d=l.getSheetId(),c=[new ne(u).id,new oe(u,d).id];return s.getSubunitRuleList(u,d).filter(h=>h.ranges.some(g=>z.intersects(o,g))).forEach(h=>{c.push(new he(u,d,h.permissionId).id)}),i.composePermission(c).some(h=>h.value===!1)}))}function s1(e,t){const n=e.get(P),s=e.get(q),i=e.get(We),r=e.get(Je);return Ut(s.selectionMoveEnd$,r.permissionPointUpdate$.pipe(Bc(100))).pipe(Se(()=>{var o;const a=(o=s.getCurrentLastSelection())==null?void 0:o.range;if(!a)return!0;const l=n.getCurrentUnitForType(A.UNIVER_SHEET),u=l?.getActiveSheet();if(!l||!u)return!0;const d=l.getUnitId(),c=u.getSheetId(),h=[new ne(d).id,new oe(d,c).id];return i.getSubunitRuleList(d,c).filter(g=>t==="row"?g.ranges.some(m=>a.startRow>m.startRow&&a.startRow<=m.endRow):g.ranges.some(m=>a.startColumn>m.startColumn&&a.startColumn<=m.endColumn)).forEach(g=>{h.push(new he(d,c,g.permissionId).id)}),r.composePermission(h).some(g=>g.value===!1)}))}function i1(e,t){const n=e.get(P),s=e.get(q),i=e.get(We),r=e.get(Je);return Ut(s.selectionMoveEnd$,r.permissionPointUpdate$.pipe(Bc(100))).pipe(Se(()=>{var o;const a=(o=s.getCurrentLastSelection())==null?void 0:o.range;if(!a)return!0;const l=n.getCurrentUnitForType(A.UNIVER_SHEET),u=l?.getActiveSheet();if(!l||!u)return!0;const d=l.getUnitId(),c=u.getSheetId(),h=[new ne(d).id,new oe(d,c).id],g=Q.deepClone(a);return t==="row"?(g.startColumn=0,g.endColumn=u.getColumnCount()-1):(g.startRow=0,g.endRow=u.getRowCount()-1),i.getSubunitRuleList(d,c).filter(m=>m.ranges.some(p=>z.intersects(g,p))).forEach(m=>{h.push(new he(d,c,m.permissionId).id)}),r.composePermission(h).some(m=>m.value===!1)}))}function Hh(e,t){const n=e.get(P),s=e.get(q),i=e.get(We),r=e.get(Je);return Ut(s.selectionMoveEnd$,r.permissionPointUpdate$.pipe(Bc(100))).pipe(Se(()=>{var o;const a=(o=s.getCurrentLastSelection())==null?void 0:o.range;if(!a)return!0;const l=n.getCurrentUnitForType(A.UNIVER_SHEET),u=l?.getActiveSheet();if(!l||!u)return!0;const d=l.getUnitId(),c=u.getSheetId(),h=[new ne(d).id,new oe(d,c).id],g=Q.deepClone(a);return t==="row"?g.endRow=u.getRowCount()-1:g.endColumn=u.getColumnCount()-1,i.getSubunitRuleList(d,c).filter(m=>m.ranges.some(p=>z.intersects(g,p))).forEach(m=>{h.push(new he(d,c,m.permissionId).id)}),r.composePermission(h).some(m=>m.value===!1)}))}function La(e,t){const n=e.get(P).getCurrentTypeOfUnit$(A.UNIVER_SHEET),s=e.get(ft),i=e.get(We),r=e.get(Je),o=e.get(Bn);return dt([o.currentUser$,n]).pipe($e(([a,l])=>l?l.activeSheet$.pipe($e(u=>{if(!u)return Re(!0);const d=l.getUnitId(),c=[];return t.forEach(h=>c.push(new h(d).id)),r.composePermission$(c).pipe(Se(h=>h.every(g=>g.value===!0))).pipe(Se(h=>{if(!h)return!0;const g=u.getSheetId(),m=s.getRule(d,g),p=i.getSubunitRuleList(d,g);return!!(m||p.length)}))})):Re(!0)))}function e2(e){const t=e.get(pi),n=Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]});return{id:Ol.id,icon:new ct(s=>{const i="AllBorderIcon",r=e.get(pi),o=e.get(U).onCommandExecuted(a=>{var l;if(a.id!==Ol.id)return;const{type:u}=r.getBorderInfo(),d=n1.find(h=>h.value===u),c=(l=d?.icon)!=null?l:i;s.next(c)});return s.next(i),o.dispose}),tooltip:"toolbar.border.main",type:ie.BUTTON_SELECTOR,slot:!0,selections:[{label:{name:Nf,hoverable:!1,selectable:!1},value$:t.borderInfo$}],value$:t.borderInfo$,hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([s,i])=>s||i)),disabled$:n}}const ld="sheet.menu.clear-selection";function og(e){return{id:ld,type:ie.SUBITEMS,icon:"ClearFormatDoubleIcon",title:"rightClick.clearSelection",hidden$:Ce(e,A.UNIVER_SHEET)}}function ag(e){return{id:as.id,type:ie.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearContent",disabled$:Ei(e,Me(e,{workbookTypes:[ne],worksheetTypes:[oe,nn],rangeTypes:[he]})),hidden$:Ce(e,A.UNIVER_SHEET)}}function lg(e){return{id:Vs.id,type:ie.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearFormat",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function Yu(e){return{id:Os.id,type:ie.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearAll",tooltip:"rightClick.clearAll",disabled$:Ei(e,Me(e,{workbookTypes:[ne],worksheetTypes:[oe,nn,mt],rangeTypes:[he]})),hidden$:Ce(e,A.UNIVER_SHEET)}}const r1="sheet.menu.delete";function t2(e){return{id:r1,type:ie.SUBITEMS,title:"rightClick.delete",icon:"ReduceDoubleIcon",hidden$:Ei(e,Wa(e)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe]})}}function cC(e){return{id:Yl.id,type:ie.BUTTON,icon:"DeleteColumnDoubleIcon",title:"rightClick.deleteSelectedColumn",hidden$:i1(e,"col"),disabled$:Me(e,{workbookTypes:[ne,dp],worksheetTypes:[oe,th]})}}function hC(e){return{id:Xl.id,type:ie.BUTTON,icon:"DeleteRowDoubleIcon",title:"rightClick.deleteSelectedRow",disabled$:Me(e,{workbookTypes:[ne,cp],worksheetTypes:[oe,nh]}),hidden$:i1(e,"row")}}function n2(e){return{id:Ru.id,type:ie.BUTTON,title:"rightClick.moveLeft",icon:"DeleteCellShiftLeftDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe],rangeTypes:[he]}),hidden$:Hh(e,"col")}}function s2(e){return{id:na.id,type:ie.BUTTON,title:"rightClick.moveUp",icon:"DeleteCellShiftUpDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe],rangeTypes:[he]}),hidden$:Hh(e,"row")}}function i2(e,t){const n=e.get(q),s=e.get(P),i=e.get(U),r=e.get(Ne);return qt(s,t,({worksheet:o})=>new ct(a=>{const l=()=>{var c;let h=t;const g=(c=n.getCurrentLastSelection())==null?void 0:c.primary;if(g!=null){const m=o.getComposedCellStyle(g.startRow,g.startColumn);m.fs&&(h=m.fs)}a.next(h)},u=()=>{var c,h;const g=hr(e);if(g!=null){const m=(h=(c=g.ts)==null?void 0:c.fs)!=null?h:t;a.next(m)}},d=i.onCommandExecuted(c=>{const h=c.id;(h===le.id||h===me.id||h===lt.id)&&l(),(h===Ia.id||h===Sa.id)&&r.getContextValue(It)&&(r.getContextValue(kn)||r.getContextValue(io))&&u()});return l(),d.dispose}))}function r2(e){const t=hi.fs,n=Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0);return{id:bh.id,type:ie.SELECTOR,tooltip:"toolbar.fontSize",label:{name:DI,props:{min:6,max:400,disabled$:n}},selections:HI,disabled$:n,value$:i2(e,t),hidden$:Ce(e,A.UNIVER_SHEET)}}function o2(e){const t=Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0);return{id:ff.id,type:ie.BUTTON,icon:"FontSizeIncreaseIcon",tooltip:"toolbar.fontSizeIncrease",disabled$:t,hidden$:Ce(e,A.UNIVER_SHEET)}}function a2(e){const t=Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0);return{id:vf.id,type:ie.BUTTON,icon:"FontSizeReduceIcon",tooltip:"toolbar.fontSizeDecrease",disabled$:t,hidden$:Ce(e,A.UNIVER_SHEET)}}const Pu=`${Uf}_MENU_ITEM_FROZEN_COMPONENT`,l2={row:"1",col:"A"},o1=e=>{const{type:t}=e,n=G(Oe),s=G(Xc),i=G(q),[r,o]=L.useState(l2),a=l=>{var u,d;if(!l)return;const{primary:c,range:h}=l,g=(u=c?.startRow)!=null?u:h.startRow,m=(d=c?.startColumn)!=null?d:h.startColumn;o({row:g===0?"1":String(g),col:m===0?"A":Q.chatAtABC(m-1)})};return L.useEffect(()=>{s.visible&&a(i.getCurrentLastSelection())},[s.visible]),S.jsxs(S.Fragment,{children:[t==="row"&&n.t("rightClick.freezeRow",r.row),t==="col"&&n.t("rightClick.freezeCol",r.col),t==="all"&&n.t("rightClick.freezeCell",r.row,r.col)]})},Of=(e,t)=>{const n=e.get(q);return new ct(s=>{const i=o=>{var a,l;if(!o)return s.next(!0);const{primary:u,range:d}=o,c=(a=u?.startRow)!=null?a:d.startRow,h=(l=u?.startColumn)!=null?l:d.startColumn;if(t==="row"&&c<=0||t==="col"&&h<=0)return s.next(!0);s.next(!1)},r=n.selectionChanged$.subscribe(o=>{if(!o||o.length===0)return s.next(!0);i(o[o.length-1])});return i(n.getCurrentLastSelection()),()=>r.unsubscribe()})},a1="sheet.menu.sheet-frozen";function u2(e){return{id:a1,type:ie.SUBITEMS,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}const l1="sheet.column-header-menu.sheet-frozen";function d2(e){return{id:l1,type:ie.SUBITEMS,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}const u1="sheet.row-header-menu.sheet-frozen";function c2(e){return{id:u1,type:ie.SUBITEMS,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function h2(e){return{id:gr.id,type:ie.BUTTON,icon:"FreezeToSelectedIcon",label:{name:Pu,props:{type:"all"}},hidden$:dt([Ce(e,A.UNIVER_SHEET),Of(e,"all")]).pipe(Se(([t,n])=>t||n))}}function gC(e){return{id:Zl.id,type:ie.BUTTON,icon:"FreezeRowIcon",label:{name:Pu,props:{type:"row"}},hidden$:dt([Ce(e,A.UNIVER_SHEET),Of(e,"row")]).pipe(Se(([t,n])=>t||n))}}function mC(e){return{id:Gl.id,type:ie.BUTTON,icon:"FreezeColumnIcon",label:{name:Pu,props:{type:"col"}},hidden$:dt([Ce(e,A.UNIVER_SHEET),Of(e,"col")]).pipe(Se(([t,n])=>t||n))}}function pC(e){return{id:ql.id,type:ie.BUTTON,title:"rightClick.freezeFirstRow",icon:"FreezeRowIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function fC(e){return{id:Ql.id,type:ie.BUTTON,title:"rightClick.freezeFirstCol",icon:"FreezeColumnIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function ug(e){return{id:No.id,type:ie.BUTTON,title:"rightClick.cancelFreeze",icon:"CancelFreezeIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function g2(e){const t=e.get(U),n=e.get(P);return{id:$o.id,type:ie.BUTTON,tooltip:"toolbar.toggleGridlines",icon:"HideGridlinesDoubleIcon",activated$:new ct(s=>{const i=()=>{const o=n.getCurrentUnitForType(A.UNIVER_SHEET);return o?o.getActiveSheet().getConfig().showGridlines===pe.TRUE:!1},r=new Et;return r.add(t.onCommandExecuted(o=>{(o.id===Uo.id||o.id===lt.id)&&s.next(i())})),r.add(n.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(()=>{s.next(i())})),s.next(i()),()=>r.dispose()}),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe]})}}const Zs=`${Uf}_MENU_ITEM_INPUT_COMPONENT`,d1=e=>{const{prefix:t,suffix:n,value:s,min:i=Number.MIN_SAFE_INTEGER,max:r=Number.MAX_SAFE_INTEGER,disabled$:o,onChange:a}=e,l=G(Oe),u=G(Xc),[d,c]=L.useState(!1),[h,g]=L.useState(),m=f=>{if(!f){g(i.toString());return}const v=f.toString();g(v),a(v)};L.useEffect(()=>{if(!o)return;const f=o.subscribe(v=>{c(v)});return()=>{f.unsubscribe()}},[]),L.useEffect(()=>{u.visible||g(s)},[u.visible]),L.useEffect(()=>{+s<i?g(i.toString()):+s>r?g(r.toString()):g(s)},[s]);function p(){h&&a(h)}return S.jsxs("div",{className:"univer-inline-flex univer-items-center univer-gap-1",children:[l.t(t),S.jsx("div",{className:"univer-w-16",onClick:f=>f.stopPropagation(),children:S.jsx(g0,{value:Number(h),size:"mini",precision:0,min:i,max:r,disabled:d,onPressEnter:p,onChange:m})}),l.t(n)]})},c1="sheet.menu.cell-insert";function m2(e){return{id:c1,type:ie.SUBITEMS,title:"rightClick.insert",icon:"InsertDoubleIcon",hidden$:Ei(e,Wa(e)),disabled$:Me(e,{workbookTypes:[ne,Ma,Ea],worksheetTypes:[ao,lo,oe],rangeTypes:[he]})}}function p2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ea],worksheetTypes:[lo,oe],rangeTypes:[he]});return{id:yp.id,type:ie.BUTTON,icon:"InsertRowAboveDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertRowsAbove",min:1,max:1e3,suffix:"rightClick.insertRowsAboveSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endRow-d?.startRow+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:s1(e,"row")}}function f2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ma],worksheetTypes:[ao,oe],rangeTypes:[he]});return{id:xp.id,type:ie.BUTTON,icon:"LeftInsertColumnDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertColsLeft",min:1,max:1e3,suffix:"rightClick.insertColsLeftSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endColumn-d?.startColumn+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:s1(e,"col")}}function v2(e){return{id:yu.id,type:ie.BUTTON,title:"rightClick.moveRight",icon:"InsertCellShiftRightDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe],rangeTypes:[he]}),hidden$:Hh(e,"col")}}function C2(e){return{id:sa.id,type:ie.BUTTON,title:"rightClick.moveDown",icon:"InsertCellDownDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe],rangeTypes:[he]}),hidden$:Hh(e,"row")}}function w2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ea],worksheetTypes:[lo,oe],rangeTypes:[he]});return{id:Ep.id,type:ie.BUTTON,icon:"InsertRowBelowDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertRowsAfter",min:1,max:1e3,suffix:"rightClick.insertRowsAfterSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endRow-d?.startRow+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:Wa(e)}}function S2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ea],worksheetTypes:[lo,oe],rangeTypes:[he]});return{id:Mp.id,type:ie.BUTTON,icon:"InsertRowAboveDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertRowsAbove",min:1,max:1e3,suffix:"rightClick.insertRowsAboveSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endRow-d?.startRow+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:Wa(e)}}function b2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ma],worksheetTypes:[ao,oe],rangeTypes:[he]});return{id:kp.id,type:ie.BUTTON,icon:"LeftInsertColumnDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertColsLeft",min:1,max:1e3,suffix:"rightClick.insertColsLeftSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endColumn-d?.startColumn+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:Wa(e)}}function _2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=1,r=Me(e,{workbookTypes:[ne,Ma],worksheetTypes:[ao,oe],rangeTypes:[he]});return{id:Tp.id,type:ie.BUTTON,icon:"RightInsertColumnDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.insertColsRight",min:1,max:1e3,suffix:"rightClick.insertColsRightSuffix",disabled$:r}},value$:qt(t,i,()=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentLastSelection())==null?void 0:u.range;let c=i;d&&(c=d?.endColumn-d?.startColumn+1),o.next(c)}const l=s.onCommandExecuted(u=>{if(u.id===me.id)return a()});return a(),l.dispose})),disabled$:r,hidden$:Wa(e)}}var I2=(e=>(e.ROW_HEADER_CONTEXT_MENU="ROW_HEADER_CONTEXT_MENU",e.COL_HEADER_CONTEXT_MENU="COL_HEADER_CONTEXT_MENU",e.SHEET_BAR="SHEET_BAR",e.SHEET_FOOTER="SHEET_FOOTER",e))(I2||{});function R2(e){const t=e.get(Ii);return{id:Mu.id,subId:wf.id,type:ie.BUTTON,icon:"BrushIcon",title:"Format Painter",tooltip:"toolbar.formatPainter",activated$:new ct(n=>{let s=!1;const i=t.status$.subscribe(r=>{s=r!==ls.OFF,n.next(s)});return n.next(s),()=>{i.unsubscribe()}}),hidden$:Ce(e,A.UNIVER_SHEET),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[qi,oe],rangeTypes:[he]},!0)}}function y2(e){const t=e.get(U),n=e.get(P),s=e.get(Ne),i=e.get(q);return{id:Oa.id,type:ie.BUTTON,icon:"BoldIcon",title:"Set bold",tooltip:"toolbar.bold",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0),activated$:qt(n,!1,({worksheet:r})=>new ct(o=>{var a;const l=t.onCommandExecuted(c=>{var h,g;const m=c.id;if(m===le.id||m===me.id||m===lt.id){const p=(h=i.getCurrentLastSelection())==null?void 0:h.primary;let f=nl.NORMAL;if(p!=null){const v=r.getRange(p.startRow,p.startColumn);f=v?.getFontWeight()}o.next(f===nl.BOLD)}if((m===Ia.id||m===Sa.id)&&s.getContextValue(It)&&(s.getContextValue(kn)||s.getContextValue(io))){const p=hr(e);if(p==null)return;const f=(g=p.ts)==null?void 0:g.bl;o.next(f===pe.TRUE)}}),u=(a=i.getCurrentLastSelection())==null?void 0:a.primary;if(!r){o.next(!1);return}let d=nl.NORMAL;if(u!=null){const c=r.getRange(u.startRow,u.startColumn);d=c?.getFontWeight()}return o.next(d===nl.BOLD),l.dispose})),hidden$:Ce(e,A.UNIVER_SHEET)}}function M2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=e.get(Ne);return{id:Aa.id,type:ie.BUTTON,icon:"ItalicIcon",title:"Set italic",tooltip:"toolbar.italic",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0),activated$:qt(n,!1,({worksheet:r})=>new ct(o=>{var a;const l=t.onCommandExecuted(c=>{var h,g;const m=c.id;if(m===le.id||m===me.id||m===lt.id){const p=(h=s.getCurrentLastSelection())==null?void 0:h.primary;let f=sl.NORMAL;if(p!=null){const v=r.getRange(p.startRow,p.startColumn);f=v?.getFontStyle()}o.next(f===sl.ITALIC)}if((m===Ia.id||m===Sa.id)&&i.getContextValue(It)&&(i.getContextValue(kn)||i.getContextValue(io))){const p=hr(e);if(p==null)return;const f=(g=p.ts)==null?void 0:g.it;o.next(f===pe.TRUE)}}),u=(a=s.getCurrentLastSelection())==null?void 0:a.primary;let d=sl.NORMAL;if(u!=null){const c=r.getRange(u.startRow,u.startColumn);d=c?.getFontStyle()}return o.next(d===sl.ITALIC),l.dispose})),hidden$:Ce(e,A.UNIVER_SHEET)}}function E2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=e.get(Ne);return{id:Va.id,type:ie.BUTTON,icon:"UnderlineIcon",title:"Set underline",tooltip:"toolbar.underline",activated$:qt(n,!1,({worksheet:r})=>new ct(o=>{var a;const l=t.onCommandExecuted(c=>{var h,g;const m=c.id;if(m===le.id||m===me.id||m===lt.id){const p=(h=s.getCurrentLastSelection())==null?void 0:h.primary;let f;if(p!=null){const v=r.getRange(p.startRow,p.startColumn);f=v?.getUnderline()}o.next(!!(f&&f.s))}if((m===Ia.id||m===Sa.id)&&i.getContextValue(It)&&(i.getContextValue(kn)||i.getContextValue(io))){const p=hr(e);if(p==null)return;const f=(g=p.ts)==null?void 0:g.ul;o.next(f?.s===pe.TRUE)}}),u=(a=s.getCurrentLastSelection())==null?void 0:a.primary;let d;if(u!=null){const c=r.getRange(u.startRow,u.startColumn);d=c?.getUnderline()}return o.next(!!(d&&d.s)),l.dispose})),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0),hidden$:Ce(e,A.UNIVER_SHEET)}}function x2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=e.get(Ne);return{id:Ha.id,type:ie.BUTTON,icon:"StrikethroughIcon",title:"Set strike through",tooltip:"toolbar.strikethrough",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0),activated$:qt(n,!1,({worksheet:r})=>new ct(o=>{var a;const l=t.onCommandExecuted(c=>{var h,g;const m=c.id;if(m===le.id||m===me.id||m===lt.id){const p=(h=s.getCurrentLastSelection())==null?void 0:h.primary;let f;if(p!=null){const v=r.getRange(p.startRow,p.startColumn);f=v?.getStrikeThrough()}o.next(!!(f&&f.s))}if((m===Ia.id||m===Sa.id)&&i.getContextValue(It)&&(i.getContextValue(kn)||i.getContextValue(io))){const p=hr(e);if(p==null)return;const f=(g=p.ts)==null?void 0:g.st;o.next(f?.s===pe.TRUE)}}),u=(a=s.getCurrentLastSelection())==null?void 0:a.primary;let d;if(u!=null){const c=r.getRange(u.startRow,u.startColumn);d=c?.getStrikeThrough()}return o.next(!!(d&&d.s)),l.dispose})),hidden$:Ce(e,A.UNIVER_SHEET)}}function k2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=hi.ff,r=Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0);return{id:Vo.id,tooltip:"toolbar.font",type:ie.SELECTOR,label:{name:LI,props:{id:Vo.id,disabled$:r}},selections:[{label:{name:WI,hoverable:!1,selectable:!1,props:{id:Vo.id}}}],disabled$:r,value$:qt(n,i,({worksheet:o})=>new ct(a=>{const l=()=>{var d;let c=i;const h=(d=s.getCurrentLastSelection())==null?void 0:d.primary;if(h!=null){const g=o.getCellStyle(h.startRow,h.startColumn),m=o.getDefaultCellStyleInternal(),p=o.getRowStyle(h.startRow),f=o.getColumnStyle(h.startColumn),v=yI(m,p,f,g);v.ff&&(c=v.ff)}a.next(c)},u=t.onCommandExecuted(d=>{var c,h;const g=d.id;if((g===le.id||g===me.id||g===lt.id)&&l(),(g===Ia.id||g===Sa.id)&&e.get(Ne).getContextValue(It)&&(e.get(Ne).getContextValue(kn)||e.get(Ne).getContextValue(io))){const m=hr(e);if(m!=null){const p=(h=(c=m.ts)==null?void 0:c.ff)!=null?h:i;a.next(p)}}});return l(),u.dispose})),hidden$:Ce(e,A.UNIVER_SHEET)}}function T2(e){return{id:Cf.id,type:ie.BUTTON,title:"toolbar.resetColor",icon:"NoColorDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0),hidden$:Ce(e,A.UNIVER_SHEET)}}function P2(e){const t=e.get(U),n=e.get(xn),s=e.get(q);return{id:Fl.id,icon:"FontColorDoubleIcon",tooltip:"toolbar.textColor.main",type:ie.BUTTON_SELECTOR,selections:[{label:{name:Fm,hoverable:!1,selectable:!1},value$:new ct(i=>{var r;const o=hi.cl.rgb,{isAllValuesSame:a,value:l}=s.getCellStylesProperty("cl");a?i.next((r=l?.rgb)!=null?r:o):i.next(o)})}],value$:new ct(i=>{const r=n.getColorFromTheme("gray.900"),o=t.onCommandExecuted(a=>{if(a.id===Fl.id){const l=a.params.value;i.next(l??r)}});return i.next(r),o.dispose}),hidden$:Ce(e,A.UNIVER_SHEET),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]},!0)}}function U2(e){return{id:Xp.id,type:ie.BUTTON,title:"toolbar.resetColor",icon:"NoColorDoubleIcon",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}function N2(e){const t=e.get(U),n=e.get(xn),s=e.get(q);return{id:El.id,tooltip:"toolbar.fillColor.main",type:ie.BUTTON_SELECTOR,icon:"PaintBucketDoubleIcon",selections:[{label:{name:Fm,hoverable:!1,selectable:!1},value$:new ct(i=>{var r;const o=hi.bg.rgb,{isAllValuesSame:a,value:l}=s.getCellStylesProperty("bg");a?i.next((r=l?.rgb)!=null?r:o):i.next(o)})}],value$:new ct(i=>{const r=n.getColorFromTheme("primary.600"),o=t.onCommandExecuted(a=>{if(a.id===El.id){const l=a.params.value;i.next(l??r)}});return i.next(r),o.dispose}),hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([i,r])=>i||r)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}const vC=[{label:"align.left",icon:"LeftJustifyingIcon",value:Pt.LEFT},{label:"align.center",icon:"HorizontallyIcon",value:Pt.CENTER},{label:"align.right",icon:"RightJustifyingIcon",value:Pt.RIGHT}];function O2(e){var t,n;const s=e.get(P),i=e.get(q),r=s.getCurrentUnitOfType(A.UNIVER_SHEET),o=r?.getActiveSheet().getDefaultCellStyleInternal(),a=(t=o?.ht)!=null?t:Pt.LEFT;return{id:kl.id,icon:(n=vC.find(l=>l.value===a))==null?void 0:n.icon,tooltip:"toolbar.horizontalAlignMode.main",type:ie.SELECTOR,selections:vC,value$:qt(s,a,({worksheet:l})=>new ct(u=>{var d,c;const h=e.get(U).onCommandExecuted(p=>{var f,v;const C=p.id;if(C!==kl.id&&C!==me.id&&C!==lt.id)return;const w=(f=i.getCurrentLastSelection())==null?void 0:f.primary;let b;if(w!=null){const I=l.getRange(w.startRow,w.startColumn),_=r?.getActiveSheet().getComposedCellStyle(w.startRow,w.startColumn);b=(v=_?.ht)!=null?v:I?.getHorizontalAlignment()}u.next(b??a)}),g=(d=i.getCurrentLastSelection())==null?void 0:d.primary;let m;if(g!=null){const p=l.getRange(g.startRow,g.startColumn),f=r?.getActiveSheet().getComposedCellStyle(g.startRow,g.startColumn);m=(c=f?.ht)!=null?c:p?.getHorizontalAlignment()}return u.next(m??a),h.dispose})),hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([l,u])=>l||u)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}const CC=[{label:"align.top",icon:"AlignTopIcon",value:vn.TOP},{label:"align.middle",icon:"VerticalCenterIcon",value:vn.MIDDLE},{label:"align.bottom",icon:"AlignBottomIcon",value:vn.BOTTOM}];function A2(e){var t,n;const s=e.get(P),i=e.get(q),r=s.getCurrentUnitOfType(A.UNIVER_SHEET),o=r?.getActiveSheet().getDefaultCellStyleInternal(),a=(t=o?.vt)!=null?t:vn.BOTTOM;return{id:xl.id,icon:(n=CC.find(l=>l.value===a))==null?void 0:n.icon,tooltip:"toolbar.verticalAlignMode.main",type:ie.SELECTOR,selections:CC,value$:qt(s,a,({worksheet:l})=>new ct(u=>{var d,c;const h=e.get(U).onCommandExecuted(p=>{var f,v;const C=p.id;if(C!==xl.id&&C!==me.id&&C!==lt.id)return;const w=(f=i.getCurrentLastSelection())==null?void 0:f.primary;let b;if(w!=null){const I=l.getRange(w.startRow,w.startColumn),_=r?.getActiveSheet().getComposedCellStyle(w.startRow,w.startColumn);b=(v=_?.vt)!=null?v:I?.getVerticalAlignment()}u.next(b??a)}),g=(d=i.getCurrentLastSelection())==null?void 0:d.primary;let m;if(g!=null){const p=l.getRange(g.startRow,g.startColumn),f=r?.getActiveSheet().getComposedCellStyle(g.startRow,g.startColumn);m=(c=f?.vt)!=null?c:p?.getVerticalAlignment()}return u.next(m??a),h.dispose})),hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([l,u])=>l||u)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}const wC=[{label:"textWrap.overflow",icon:"OverflowIcon",value:ws.OVERFLOW},{label:"textWrap.wrap",icon:"AutowrapIcon",value:ws.WRAP},{label:"textWrap.clip",icon:"TruncationIcon",value:ws.CLIP}];function V2(e){var t,n;const s=e.get(q),i=e.get(P),r=i.getCurrentUnitOfType(A.UNIVER_SHEET),o=r?.getActiveSheet().getDefaultCellStyleInternal(),a=(t=o?.tb)!=null?t:ws.OVERFLOW;return{id:Dr.id,tooltip:"toolbar.textWrapMode.main",icon:(n=wC.find(l=>l.value===a))==null?void 0:n.icon,type:ie.SELECTOR,selections:wC,value$:qt(i,a,({worksheet:l})=>new ct(u=>{var d,c;const h=e.get(U).onCommandExecuted(p=>{var f,v;const C=p.id;if(C!==Dr.id&&C!==me.id&&C!==lt.id)return;const w=(f=s.getCurrentLastSelection())==null?void 0:f.primary;let b;if(w!=null){const I=l.getRange(w.startRow,w.startColumn),_=r?.getActiveSheet().getComposedCellStyle(w.startRow,w.startColumn);b=(v=_?.tb)!=null?v:I?.getWrapStrategy()}u.next(b??a)}),g=(d=s.getCurrentLastSelection())==null?void 0:d.primary;let m;if(g!=null){const p=l.getRange(g.startRow,g.startColumn),f=r?.getActiveSheet().getComposedCellStyle(g.startRow,g.startColumn);m=(c=f?.tb)!=null?c:p?.getWrapStrategy()}return u.next(m??a),h.dispose})),hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([l,u])=>l||u)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}const SC=[{label:"textRotate.none",icon:"NoRotationIcon",value:0},{label:"textRotate.angleUp",icon:"LeftRotationFortyFiveDegreesIcon",value:-45},{label:"textRotate.angleDown",icon:"RightRotationFortyFiveDegreesIcon",value:45},{label:"textRotate.vertical",icon:"VerticalTextIcon",value:"v"},{label:"textRotate.rotationUp",icon:"LeftRotationNinetyDegreesIcon",value:-90},{label:"textRotate.rotationDown",icon:"RightRotationNinetyDegreesIcon",value:90}];function H2(e){const t=e.get(q),n=e.get(P),s=0;return{id:Tl.id,tooltip:"toolbar.textRotateMode.main",icon:SC[0].icon,type:ie.SELECTOR,selections:SC,value$:qt(n,s,({worksheet:i})=>new ct(r=>{var o,a;const l=e.get(U).onCommandExecuted(c=>{var h,g;const m=c.id;if(m!==Tl.id&&m!==me.id&&m!==lt.id)return;const p=(h=t.getCurrentLastSelection())==null?void 0:h.primary;let f;if(p!=null){const v=i.getRange(p.startRow,p.startColumn);f=v?.getTextRotation()}f?.v===pe.TRUE?r.next("v"):r.next((g=f&&f.a)!=null?g:s)}),u=(o=t.getCurrentLastSelection())==null?void 0:o.primary;let d;if(u!=null){const c=i.getRange(u.startRow,u.startColumn);d=c?.getTextRotation()}return d?.v===pe.TRUE?r.next("v"):r.next((a=d&&d.a)!=null?a:s),l.dispose})),hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([i,r])=>i||r)),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,mt],rangeTypes:[he]})}}function Uu(e){return new ct(t=>{const n=e.get(zc).supportClipboard,s=e.get(hs).copyContentCache().lastCopyId$.subscribe(i=>{t.next(!n&&!i)});return t.next(!n),()=>s.unsubscribe()})}function Bo(e){return{id:Ds.name,commandId:Ds.id,type:ie.BUTTON,title:"rightClick.copy",icon:"CopyDoubleIcon",disabled$:Me(e,{workbookTypes:[oi],worksheetTypes:[qi],rangeTypes:[Gi]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function dg(e){return{id:Tr.name,commandId:hw.id,type:ie.BUTTON,title:"rightClick.cut",icon:"CutIcon",disabled$:Me(e,{workbookTypes:[oi,ne],worksheetTypes:[qi,oe],rangeTypes:[Gi,he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function cg(e){return{id:Ws.name,commandId:Ws.id,type:ie.BUTTON,title:"rightClick.paste",icon:"PasteSpecialDoubleIcon",disabled$:Uu(e).pipe(ur(Me(e,{rangeTypes:[he],worksheetTypes:[oe,mt,nn],workbookTypes:[ne]})),Se(([t,n])=>t||n)),hidden$:Ce(e,A.UNIVER_SHEET)}}const ud="sheet.menu.copy-special";function hg(e){return{id:ud,type:ie.SUBITEMS,icon:"CopyDoubleIcon",title:"rightClick.copySpecial",hidden$:Ei(e,Ce(e,A.UNIVER_SHEET))}}const dd="sheet.menu.paste-special";function gg(e){return{id:dd,type:ie.SUBITEMS,icon:"PasteSpecialDoubleIcon",title:"rightClick.pasteSpecial",hidden$:Ei(e,Ce(e,A.UNIVER_SHEET))}}function mg(e){return{id:ml.id,type:ie.BUTTON,title:"rightClick.pasteValue",disabled$:Uu(e).pipe(ur(Me(e,{rangeTypes:[he],worksheetTypes:[nn,oe],workbookTypes:[ne]})),Se(([t,n])=>t||n)),hidden$:Ce(e,A.UNIVER_SHEET)}}function pg(e){return{id:pl.id,type:ie.BUTTON,title:"rightClick.pasteFormat",disabled$:Uu(e).pipe(ur(Me(e,{rangeTypes:[he],worksheetTypes:[mt,oe],workbookTypes:[ne]})),Se(([t,n])=>t||n)),hidden$:Ce(e,A.UNIVER_SHEET)}}function fg(e){return{id:Ao.id,type:ie.BUTTON,title:"rightClick.pasteColWidth",disabled$:Uu(e).pipe(ur(Me(e,{rangeTypes:[he],worksheetTypes:[Qn,oe],workbookTypes:[ne]})),Se(([t,n])=>t||n))}}function vg(e){return{id:fl.id,type:ie.BUTTON,title:"rightClick.pasteBesidesBorder",disabled$:Uu(e).pipe(ur(Me(e,{rangeTypes:[he],worksheetTypes:[oe,mt,nn,Kn,Qn],workbookTypes:[ne]})),Se(([t,n])=>t||n)),hidden$:Ce(e,A.UNIVER_SHEET)}}function D2(e){return{id:ci.id,type:ie.BUTTON,icon:"AutoHeightDoubleIcon",title:"rightClick.fitContent",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[Kn,oe],rangeTypes:[he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function W2(e){return{id:Eu.id,type:ie.BUTTON,icon:"AutoWidthDoubleIcon",title:"rightClick.fitContent",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[Kn,oe],rangeTypes:[he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function L2(e){return{id:wh.id,type:ie.BUTTON,icon:"HideDoubleIcon",title:"rightClick.hideSelectedRow",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[Kn,oe],rangeTypes:[he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function B2(e){return{id:Sh.id,type:ie.BUTTON,icon:"HideDoubleIcon",title:"rightClick.hideSelectedColumn",disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,Qn],rangeTypes:[he]}),hidden$:Ce(e,A.UNIVER_SHEET)}}function j2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=[me,Yi,Xi].map(r=>r.id);return{id:uh.id,type:ie.BUTTON,icon:"EyeOutlineIcon",title:"rightClick.showHideRow",hidden$:qt(t,!0,({worksheet:r})=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentSelections())==null?void 0:u.map(c=>c.range).filter(c=>c.rangeType===j.ROW);return!!(d!=null&&d.some(c=>{for(let h=c.startRow;h<=c.endRow;h++)if(!r.getRowRawVisible(h))return!0;return!1}))}const l=s.onCommandExecuted(u=>{i.findIndex(d=>d===u.id)!==-1&&o.next(!a())});return o.next(!a()),()=>l.dispose()})),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,Kn],rangeTypes:[he]})}}function F2(e){const t=e.get(P),n=e.get(q),s=e.get(U),i=[me,Ur,Nr].map(r=>r.id);return{id:ah.id,type:ie.BUTTON,icon:"EyeOutlineIcon",title:"rightClick.showHideColumn",hidden$:qt(t,!0,({worksheet:r})=>new ct(o=>{function a(){var u;const d=(u=n.getCurrentSelections())==null?void 0:u.map(c=>c.range).filter(c=>c.rangeType===j.COLUMN);return!d||d.length===0?!1:!!d.some(c=>{for(let h=c.startColumn;h<=c.endColumn;h++)if(!r.getColVisible(h))return!0;return!1})}const l=s.onCommandExecuted(u=>{i.findIndex(d=>d===u.id)!==-1&&o.next(!a())});return o.next(!a()),()=>l.dispose()})),disabled$:Me(e,{workbookTypes:[ne],worksheetTypes:[Qn,oe],rangeTypes:[he]})}}function z2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=2;return{id:tr.id,type:ie.BUTTON,icon:"AdjustHeightDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.rowHeight",suffix:"px",min:i,max:1e3}},value$:qt(n,i,({worksheet:r})=>new ct(o=>{function a(){var u;const d=(u=s.getCurrentLastSelection())==null?void 0:u.primary,c=d?r.getRowHeight(d.startRow):r.getConfig().defaultRowHeight;o.next(c)}const l=t.onCommandExecuted(u=>{const d=u.id;if(d===le.id||d===me.id||d===qn.id)return a()});return a(),l.dispose})),hidden$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,Kn],rangeTypes:[he]})}}function X2(e){const t=e.get(U),n=e.get(P),s=e.get(q),i=2;return{id:jr.id,type:ie.BUTTON,icon:"AdjustWidthDoubleIcon",label:{name:Zs,props:{prefix:"rightClick.columnWidth",suffix:"px",min:i,max:1e3}},value$:qt(n,i,({worksheet:r})=>new ct(o=>{function a(){var u;const d=(u=s.getCurrentLastSelection())==null?void 0:u.primary,c=d?r.getColumnWidth(d.startColumn):r.getConfig().defaultColumnWidth;o.next(c)}const l=t.onCommandExecuted(u=>{const d=u.id;if(d===le.id||d===me.id||d===Cn.id)return a()});return a(),l.dispose})),hidden$:Me(e,{workbookTypes:[ne],worksheetTypes:[oe,Qn],rangeTypes:[he]})}}function Y2(e){const t=e.get(q),n=e.get(We),s=e.get(P),i=e.get(Ml),r=s.getCurrentTypeOfUnit$(A.UNIVER_SHEET);return dt([t.selectionMoveEnd$,r.pipe(Se(o=>{var a;return(a=o?.getUnitId())!=null?a:""})),r.pipe($e(o=>{var a;return(a=o?.activeSheet$)!=null?a:Re(null)}))]).pipe(Se(([o,a,l])=>{if(!l||!o||o.length===0)return!1;const u=l.getSheetId(),d=o.map(h=>h.range);if(i.interceptor.fetchThroughInterceptors(hS)(!1,d))return!0;const c=n.getSubunitRuleList(a,u).map(h=>h.ranges).flat();if(o.length<2){const h=o[0].range;return c.some(g=>z.intersects(g,h)&&!z.contains(g,h))}for(let h=0;h<o.length;h++)for(let g=h+1;g<o.length;g++)if(z.intersects(o[h].range,o[g].range))return!0;return!1}))}function h1(e,t){return!!dc(e,t,j.ROW)}function g1(e,t){return!!dc(e,t,j.COLUMN)}function dc(e,t,n){return e.find(s=>{const i=s.range,{startRow:r,endRow:o,startColumn:a,endColumn:l,rangeType:u}=i;return u===j.ALL||u===j.NORMAL?!1:u===n&&(n===j.COLUMN&&a<=t&&t<=l||n===j.ROW&&r<=t&&t<=o)})}function Z2(e){const t=Ei(e,Me(e,{workbookTypes:[ne],worksheetTypes:[oe,nn,mt],rangeTypes:[he]})),n=Y2(e);return{id:bi.id,icon:"MergeAllIcon",tooltip:"toolbar.mergeCell.main",type:ie.SUBITEMS,hidden$:dt([Ce(e,A.UNIVER_SHEET),e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1))]).pipe(Se(([s,i])=>s||i)),disabled$:t.pipe(ur(n),Se(([s,i])=>s||i))}}function G2(e){return{id:Op.id,type:ie.BUTTON,title:"merge.all",icon:"MergeAllIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function q2(e){return{id:Ap.id,type:ie.BUTTON,title:"merge.vertical",icon:"VerticalIntegrationIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function Q2(e){return{id:Vp.id,type:ie.BUTTON,title:"merge.horizontal",icon:"HorizontalMergeIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function K2(e){return{id:vu.id,type:ie.BUTTON,title:"merge.cancel",icon:"CancelMergeIcon",hidden$:Ce(e,A.UNIVER_SHEET)}}function $2(e){const t=e.get(P).getCurrentTypeOfUnit$(A.UNIVER_SHEET),n=e.get(Bn);return dt([t,n.currentUser$]).pipe($e(([s,i])=>s?s.activeSheet$.pipe($e(r=>{if(!r)return Re(!0);const o=e.get(We),a=e.get(ft),l=e.get(q);return Ut(l.selectionMoveEnd$,o.ruleChange$,a.ruleChange$).pipe(Se(()=>{const u=s.getUnitId(),d=r.getSheetId(),c=o.getSubunitRuleList(u,d),h=l.getCurrentSelections(),g=h?.map(f=>f.range),m=c.map(f=>f.ranges).flat();if(!g)return!1;const p=a.getRule(u,d);return p!=null&&p.permissionId?!0:g?.some(f=>m.some(v=>z.intersects(f,v)))}))})):Re(!0)))}function J2(e){const t=e.get(P),n=e.get(We),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{if(!a)return Re(!0);const l=e.get(We),u=e.get(ft),d=e.get(Je),c=e.get(q);return Ut(c.selectionMoveEnd$,l.ruleChange$,u.ruleChange$).pipe(Se(()=>{var h,g;const m=r.getUnitId(),p=a.getSheetId(),f=n.getSubunitRuleList(m,p),v=(h=c.getCurrentSelections())==null?void 0:h.map(x=>x.range);if(f.map(x=>x.ranges).flat(),!(v!=null&&v.length)||v.length>1)return!0;const C=v[0];if(C?.rangeType===j.ALL||C?.rangeType===j.COLUMN||C?.rangeType===j.ROW)return!0;const w=u.getRule(m,p);if(w!=null&&w.permissionId)return((g=d.getPermissionPoint(new sh(m,p).id))==null?void 0:g.value)===!1;if(f.filter(x=>x.ranges.some(N=>z.intersects(N,C))).length!==1)return!0;const{startRow:b,endRow:I,startColumn:_,endColumn:R}=C,M=e.get(Is);for(let x=b;x<=I;x++)for(let N=_;N<=R;N++){const T=M.getCellInfo(m,p,x,N);if(T)return T[X.ManageCollaborator]===!1}return!1}))})):Re(!0)))}function e5(e){const t=e.get(P),n=e.get(Je),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{var l;if(!a)return Re(!0);const u=r.getUnitId(),d=e.get(q),c=e.get(We),h=e.get(ft),g=(l=n.composePermission$([new ne(u).id]).pipe(Se(p=>p.every(f=>f.value))))!=null?l:Re(!1),m=Ut(c.ruleChange$,h.ruleChange$).pipe(Nt(null));return dt([g,m,d.selectionMoveEnd$]).pipe(Se(([p,f,v])=>{if(!p)return!0;const C=d.getCurrentSelections(),w=C?.map(b=>b.range);return w!=null&&w.length?w.length>1:!1}))})):Re(!0)))}function m1(e){var t;const n=e.get(P),s=e.get(Je),i=n.getCurrentTypeOfUnit$(A.UNIVER_SHEET),r=e.get(Bn),o=e.has(xt)?e.get(xt):null,a=e.get(Ne).subscribeContextValue$(Vn).pipe(Nt(!1),Rn(1)),l=(t=o?.visible$.pipe(Nt(null),Rn(1)))!=null?t:Re(null);return dt([i,r.currentUser$,l,a]).pipe($e(([u,d,c,h])=>!u||c!=null&&c.visible&&c.unitId===u.getUnitId()||h?Re(!0):u.activeSheet$.pipe($e(g=>{var m;if(!g)return Re(!0);const p=e.get(Ne).subscribeContextValue$(Es).pipe(Nt(!1)),f=u.getUnitId(),v=g.getSheetId(),C=e.get(We),w=e.get(ft),b=e.get(q),I=(m=s.composePermission$([new oo(f).id]).pipe(Se(R=>R.every(M=>M.value))))!=null?m:Re(!1),_=Ut(C.ruleChange$,w.ruleChange$).pipe(Nt(null));return dt([I,_,b.selectionMoveEnd$,p]).pipe(Se(([R,M,x,N])=>{if(!R||N)return!0;const T=b.getCurrentSelections(),O=T?.map(B=>B.range);if(!(O!=null&&O.length))return!0;const k=w.getRule(f,v);if(k!=null&&k.permissionId)return!0;const D=C.getSubunitRuleList(f,v);return O?.some(B=>D.some(W=>W.ranges.some(F=>z.intersects(B,F))))}))}))))}function t5(e){const t=e.get(P),n=e.get(Je),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{var l;if(!a)return Re(!0);const u=r.getUnitId(),d=a.getSheetId(),c=e.get(We),h=e.get(ft),g=(l=n.composePermission$([new oo(u).id]).pipe(Se(p=>p.every(f=>f.value))))!=null?l:Re(!1),m=Ut(c.ruleChange$,h.ruleChange$).pipe(Nt(null));return dt([g,m]).pipe(Se(([p,f])=>{var v;if(!p)return!0;const C=h.getRule(u,d);return C!=null&&C.permissionId?!0:((v=c.getSubunitRuleList(u,d))==null?void 0:v.filter(w=>w?.permissionId)).length>0}))})):Re(!0)))}function n5(e){const t=e.get(P),n=e.get(Je),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{if(!a)return Re(!0);const l=r.getUnitId(),u=a.getSheetId(),d=e.get(ft);return d.ruleChange$.pipe(Nt(null)).pipe(Se(()=>{var c;return d.getRule(l,u)?((c=n.getPermissionPoint(new pu(l,u).id))==null?void 0:c.value)===!1:!0}))})):Re(!0)))}function s5(e){const t=e.get(P),n=e.get(Je),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{var l;if(!a)return Re(!0);const u=r.getUnitId(),d=e.get(We),c=e.get(ft),h=(l=n.composePermission$([new oo(u).id,new xa(u).id]).pipe(Se(p=>p.every(f=>f.value))))!=null?l:Re(!1),g=c.ruleChange$.pipe(Nt(null)),m=d.ruleChange$.pipe(Nt(null));return dt([h,g,m]).pipe(Se(([p,f,v])=>{if(!p)return!0;const C=a.getSheetId(),w=c.getRule(u,C),b=d.getSubunitRuleList(u,C);return!(w||b.length)}))})):Re(!0)))}function i5(e){const t=e.get(P),n=e.get(Je),s=t.getCurrentTypeOfUnit$(A.UNIVER_SHEET),i=e.get(Bn);return dt([s,i.currentUser$]).pipe($e(([r,o])=>r?r.activeSheet$.pipe($e(a=>{if(!a)return Re(!0);const l=r.getUnitId(),u=a.getSheetId(),d=e.get(q),c=e.get(We),h=e.get(ft),g=Ut(c.ruleChange$,h.ruleChange$,d.selectionMoveEnd$).pipe(Nt(null));return dt([g]).pipe(Se(([m])=>{var p;const f=e.get(q).getCurrentSelections(),v=f?.map(x=>x.range);if(!(v!=null&&v.length)||v.length>1)return!0;const C=v[0];if(C?.rangeType===j.ALL||C?.rangeType===j.COLUMN||C?.rangeType===j.ROW)return!0;const w=h.getRule(l,u);if(w!=null&&w.permissionId)return((p=n.getPermissionPoint(new pu(l,u).id))==null?void 0:p.value)===!1;if(c.getSubunitRuleList(l,u).filter(x=>x.ranges.some(N=>z.intersects(N,C))).length!==1)return!0;const{startRow:b,endRow:I,startColumn:_,endColumn:R}=C,M=e.get(Is);for(let x=b;x<=I;x++)for(let N=_;N<=R;N++){const T=M.getCellInfo(l,u,x,N);if(T)return T[X.Delete]===!1}return!1}))})):Re(!0)))}function p1(e){var t;const n=e.get(P),s=e.get(Je),i=n.getCurrentTypeOfUnit$(A.UNIVER_SHEET),r=e.get(Bn),o=e.has(xt)?e.get(xt):null,a=e.get(Ne).subscribeContextValue$(Vn),l=(t=o?.visible$)!=null?t:Re(null);return dt([i,r.currentUser$,l,a]).pipe($e(([u,d,c,h])=>!u||c!=null&&c.visible&&c.unitId===u.getUnitId()||h?Re(!0):u.activeSheet$.pipe($e(g=>{var m,p;if(!g)return Re(!0);const f=u.getUnitId();return((p=(m=s.getPermissionPoint$(new ne(f).id))==null?void 0:m.pipe(Se(v=>!!v.value)))!=null?p:Re(!1)).pipe(Se(v=>!v))}))))}const cd="sheet.contextMenu.permission";function r5(e){return{id:Ih.id,type:ie.BUTTON,icon:vb,tooltip:"permission.toolbarMenu",hidden$:Ce(e,A.UNIVER_SHEET),disabled$:m1(e)}}function Cg(e){return{id:cd,type:ie.SUBITEMS,title:"rightClick.protectRange",icon:Cb,hidden$:Ce(e,A.UNIVER_SHEET)}}function wg(e){return{id:Ho.id,type:ie.BUTTON,title:"rightClick.turnOnProtectRange",hidden$:$2(e),disabled$:m1(e)}}function Sg(e){return{id:Lo.id,type:ie.BUTTON,title:"rightClick.editProtectRange",disabled$:e5(e),hidden$:J2(e)}}function bg(e){return{id:Wo.id,type:ie.BUTTON,title:"rightClick.removeProtectRange",disabled$:i5(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function _g(e){return{id:Do.id,type:ie.BUTTON,title:"rightClick.viewAllProtectArea",disabled$:p1(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function o5(e){return{id:Rh.id,type:ie.BUTTON,title:"sheetConfig.addProtectSheet",disabled$:t5(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function a5(e){return{id:Ph.id,type:ie.BUTTON,title:"sheetConfig.removeProtectSheet",disabled$:n5(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function l5(e){return{id:Uh.id,type:ie.BUTTON,title:"sheetConfig.changeSheetPermission",disabled$:s5(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function u5(e){return{id:yh.id,type:ie.BUTTON,title:"sheetConfig.viewAllProtectArea",disabled$:p1(e),hidden$:Ce(e,A.UNIVER_SHEET)}}function d5(e){const t=e.get(P),n=e.get(U),s=new ct(r=>{const o=n.onCommandExecuted(a=>{const l=a.id;(l===En.id||l===cs.id||l===cn.id)&&cc(t,r)});return cc(t,r),o.dispose}),i=La(e,[ne,Jc]);return{id:Mh.id,type:ie.BUTTON,title:"sheetConfig.delete",disabled$:dt([s,i]).pipe(Se(([r,o])=>r||o)),hidden$:Ce(e,A.UNIVER_SHEET)}}function c5(e){return{id:rh.id,type:ie.BUTTON,title:"sheetConfig.copy",disabled$:La(e,[ne,mu]),hidden$:Ce(e,A.UNIVER_SHEET)}}function h5(e){return{id:Oh.id,type:ie.BUTTON,title:"sheetConfig.rename",disabled$:La(e,[ne,ka]),hidden$:Ce(e,A.UNIVER_SHEET)}}function g5(e){return{id:dh.id,title:"sheetConfig.changeColor",type:ie.SELECTOR,selections:[{label:{name:Fm,hoverable:!1}}],hidden$:La(e,[ne])}}function m5(e){const t=e.get(P),n=e.get(U);return{id:ch.id,type:ie.BUTTON,title:"sheetConfig.hide",disabled$:new ct(s=>{const i=n.onCommandExecuted(r=>{const o=r.id;(o===En.id||o===cs.id||o===cn.id)&&cc(t,s)});return cc(t,s),i.dispose}).pipe(ur(La(e,[ne,ya])),Se(([s,i])=>s||i)),hidden$:Ce(e,A.UNIVER_SHEET)}}function p5(e){const t=e.get(P),n=e.get(U);return{id:Th.id,type:ie.BUTTON,title:"sheetConfig.unhide",disabled$:new ct(s=>{function i(){const o=t.getCurrentUnitForType(A.UNIVER_SHEET).getWorksheets(),a=Array.from(o.values());s.next(a.length===1)}const r=n.onCommandExecuted(o=>{const a=o.id;(a===En.id||a===cs.id||a===cn.id)&&i()});return i(),r.dispose}).pipe(ur(La(e,[ne,ya])),Se(([s,i])=>s||i)),hidden$:Ce(e,A.UNIVER_SHEET)}}function cc(e,t){const n=e.getCurrentUnitForType(A.UNIVER_SHEET).getWorksheets(),s=Array.from(n.values()).filter(i=>i.getConfig().hidden===pe.FALSE);t.next(s.length===1)}const f5=e=>{var t;const n=e.get(q),s=(t=e.get(P).getCurrentUnitOfType(A.UNIVER_SHEET))==null?void 0:t.getActiveSheet();return new ct(i=>{const r=a=>{var l,u,d,c;if(!s||!a||a.length===0)return i.next(!0);for(let h=0;h<a.length;h++){const{range:g}=a[h];for(let m=g.startRow;m<=g.endRow;m++)for(let p=g.startColumn;p<=g.endColumn;p++){const f=s.getCellRaw(m,p),v=typeof f?.s=="string"?(u=(l=s.getStyleDataByHash(f.s))==null?void 0:l.n)==null?void 0:u.pattern:(c=(d=f?.s)==null?void 0:d.n)==null?void 0:c.pattern;if(f&&f.v&&(f.t!==je.NUMBER||Cs(v))&&rr(f.v))return i.next(!1)}}i.next(!0)},o=n.selectionChanged$.subscribe(a=>{if(!a||a.length===0)return i.next(!0);r(a)});return r(n.getCurrentSelections()),()=>o.unsubscribe()})},f1="sheet.toolbar.text-to-number";function v5(e){return{id:f1,commandId:nf.id,type:ie.BUTTON,title:"toolbar.textToNumber",disabled$:Ei(e,Me(e,{workbookTypes:[ne],worksheetTypes:[oe,nn],rangeTypes:[he]})),hidden$:Ce(e,A.UNIVER_SHEET)}}const hd="sheet.contextMenu.text-to-number";function Ig(e){return{id:hd,commandId:nf.id,type:ie.BUTTON,title:"rightClick.textToNumber",icon:"PipingIcon",disabled$:Ei(e,Me(e,{workbookTypes:[ne],worksheetTypes:[oe,nn],rangeTypes:[he]})),hidden$:dt([Ce(e,A.UNIVER_SHEET),f5(e)]).pipe(Se(([t,n])=>t||n))}}const C5={[ev.START]:{[Vu.HISTORY]:{[Mu.id]:{order:2,menuItemFactory:R2},[Os.id]:{order:3,menuItemFactory:Yu}},[Vu.FORMAT]:{[Vo.id]:{order:1,menuItemFactory:k2},[bh.id]:{order:2,menuItemFactory:r2},[ff.id]:{order:2.1,menuItemFactory:o2},[vf.id]:{order:2.2,menuItemFactory:a2},[Oa.id]:{order:5,menuItemFactory:y2},[Aa.id]:{order:6,menuItemFactory:M2},[Va.id]:{order:7,menuItemFactory:E2},[Ha.id]:{order:8,menuItemFactory:x2},[Fl.id]:{order:9,menuItemFactory:P2,[vS.id]:{order:0,menuItemFactory:T2}},[El.id]:{order:10,menuItemFactory:N2,[Xp.id]:{order:0,menuItemFactory:U2}},[Ol.id]:{order:11,menuItemFactory:e2}},[Vu.LAYOUT]:{[kl.id]:{order:0,menuItemFactory:O2},[xl.id]:{order:3,menuItemFactory:A2},[Dr.id]:{order:6,menuItemFactory:V2},[Tl.id]:{order:7,menuItemFactory:H2},[bi.id]:{order:8,menuItemFactory:Z2,[Op.id]:{order:0,menuItemFactory:G2},[Ap.id]:{order:1,menuItemFactory:q2},[Vp.id]:{order:2,menuItemFactory:Q2},[vu.id]:{order:3,menuItemFactory:K2}}},[Vu.OTHERS]:{[Ih.id]:{order:0,menuItemFactory:r5}}},[ev.DATA]:{[VI.OTHERS]:{[f1]:{order:0,menuItemFactory:v5}}},[un.MAIN_AREA]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo},[Tr.name]:{order:1,menuItemFactory:dg},[Ws.name]:{order:2,menuItemFactory:cg},[ud]:{order:2.5,menuItemFactory:hg},[dd]:{order:3,menuItemFactory:gg,[ml.id]:{order:0,menuItemFactory:mg},[pl.id]:{order:1,menuItemFactory:pg},[Ao.id]:{order:2,menuItemFactory:fg},[fl.id]:{order:3,menuItemFactory:vg}},[ld]:{order:4,menuItemFactory:og,[as.id]:{order:0,menuItemFactory:ag},[Vs.id]:{order:1,menuItemFactory:lg},[Os.id]:{order:2,menuItemFactory:Yu}},[hd]:{order:5,menuItemFactory:Ig}},[kt.LAYOUT]:{order:1,[c1]:{order:0,menuItemFactory:m2,[yp.id]:{order:0,menuItemFactory:p2},[xp.id]:{order:1,menuItemFactory:f2},[yu.id]:{order:2,menuItemFactory:v2},[sa.id]:{order:3,menuItemFactory:C2}},[r1]:{order:0,menuItemFactory:t2,[Yl.id]:{order:0,menuItemFactory:cC},[Xl.id]:{order:1,menuItemFactory:hC},[Ru.id]:{order:2,menuItemFactory:n2},[na.id]:{order:3,menuItemFactory:s2}},[a1]:{order:2,menuItemFactory:u2,[gr.id]:{order:0,menuItemFactory:h2},[Zl.id]:{order:1,menuItemFactory:gC},[Gl.id]:{order:2,menuItemFactory:mC},[ql.id]:{order:3,menuItemFactory:pC},[Ql.id]:{order:4,menuItemFactory:fC},[No.id]:{order:5,menuItemFactory:ug}},[cd]:{order:3,menuItemFactory:Cg,[Ho.id]:{order:0,menuItemFactory:wg},[Lo.id]:{order:1,menuItemFactory:Sg},[Wo.id]:{order:2,menuItemFactory:bg},[Do.id]:{order:3,menuItemFactory:_g}}},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}},[un.COL_HEADER]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo},[Tr.name]:{order:1,menuItemFactory:dg},[Ws.name]:{order:2,menuItemFactory:cg},[ud]:{order:2.5,menuItemFactory:hg},[dd]:{order:3,menuItemFactory:gg,[ml.id]:{order:0,menuItemFactory:mg},[pl.id]:{order:1,menuItemFactory:pg},[Ao.id]:{order:2,menuItemFactory:fg},[fl.id]:{order:3,menuItemFactory:vg}},[ld]:{order:4,menuItemFactory:og,[as.id]:{order:0,menuItemFactory:ag},[Vs.id]:{order:1,menuItemFactory:lg},[Os.id]:{order:2,menuItemFactory:Yu}},[hd]:{order:5,menuItemFactory:Ig}},[kt.LAYOUT]:{order:1,[kp.id]:{order:0,menuItemFactory:b2},[Tp.id]:{order:0,menuItemFactory:_2},[Sh.id]:{order:1,menuItemFactory:B2},[ah.id]:{order:2,menuItemFactory:F2},[Yl.id]:{order:2,menuItemFactory:cC},[jr.id]:{order:3,menuItemFactory:X2},[Eu.id]:{order:4,menuItemFactory:W2},[l1]:{order:5,menuItemFactory:d2,[Gl.id]:{order:2,menuItemFactory:mC},[Ql.id]:{order:4,menuItemFactory:fC},[No.id]:{order:5,menuItemFactory:ug}},[cd]:{order:6,menuItemFactory:Cg,[Ho.id]:{order:0,menuItemFactory:wg},[Lo.id]:{order:1,menuItemFactory:Sg},[Wo.id]:{order:2,menuItemFactory:bg},[Do.id]:{order:3,menuItemFactory:_g}}},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}},[un.ROW_HEADER]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo},[Tr.name]:{order:1,menuItemFactory:dg},[Ws.name]:{order:2,menuItemFactory:cg},[ud]:{order:2.5,menuItemFactory:hg},[dd]:{order:3,menuItemFactory:gg,[ml.id]:{order:0,menuItemFactory:mg},[pl.id]:{order:1,menuItemFactory:pg},[Ao.id]:{order:2,menuItemFactory:fg},[fl.id]:{order:3,menuItemFactory:vg}},[ld]:{order:4,menuItemFactory:og,[as.id]:{order:0,menuItemFactory:ag},[Vs.id]:{order:1,menuItemFactory:lg},[Os.id]:{order:2,menuItemFactory:Yu}},[hd]:{order:5,menuItemFactory:Ig}},[kt.LAYOUT]:{order:1,[Mp.id]:{order:0,menuItemFactory:S2},[Ep.id]:{order:1,menuItemFactory:w2},[Xl.id]:{order:1,menuItemFactory:hC},[wh.id]:{order:2,menuItemFactory:L2},[uh.id]:{order:2,menuItemFactory:j2},[tr.id]:{order:3,menuItemFactory:z2},[ci.id]:{order:4,menuItemFactory:D2},[u1]:{order:5,menuItemFactory:c2,[Zl.id]:{order:1,menuItemFactory:gC},[ql.id]:{order:3,menuItemFactory:pC},[No.id]:{order:5,menuItemFactory:ug}},[cd]:{order:6,menuItemFactory:Cg,[Ho.id]:{order:0,menuItemFactory:wg},[Lo.id]:{order:1,menuItemFactory:Sg},[Wo.id]:{order:2,menuItemFactory:bg},[Do.id]:{order:3,menuItemFactory:_g}}},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}},[un.FOOTER_TABS]:{[kt.OTHERS]:{order:0,[Mh.id]:{order:0,menuItemFactory:d5},[rh.id]:{order:1,menuItemFactory:c5},[Oh.id]:{order:2,menuItemFactory:h5},[dh.id]:{order:3,menuItemFactory:g5},[ch.id]:{order:4,menuItemFactory:m5},[Th.id]:{order:6,menuItemFactory:p5},[Rh.id]:{order:7,menuItemFactory:o5},[Ph.id]:{order:8,menuItemFactory:a5},[Uh.id]:{order:9,menuItemFactory:l5},[yh.id]:{order:10,menuItemFactory:u5}}},[un.FOOTER_MENU]:{[kt.OTHERS]:{[$o.id]:{order:1,menuItemFactory:g2}}}},Rg="UNIVER_SHEET_PERMISSION_ALERT_DIALOG_ID",v1="UNIVER_SHEET_PERMISSION_ALERT_DIALOG";var w5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ti=(e,t)=>(n,s)=>t(n,s,e);let ca=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),y(this,"disposableCollection",new Et),this._commandService=e,this._univerInstanceService=t,this._permissionService=n,this._dialogService=s,this._rangeProtectionRuleModel=i,this._localeService=r,this._contextService=o,this._sheetPermissionCheckController=a,this._initialize(),this._initUIEvent()}_initUIEvent(){this.disposeWithMe(this._sheetPermissionCheckController.triggerPermissionUIEvent$.subscribe(e=>{this._haveNotPermissionHandle(e)}))}_haveNotPermissionHandle(e){const t={id:Rg,title:{title:"permission.dialog.alert"},children:{label:v1,errorMsg:e},width:320,destroyOnClose:!0,showOk:!0,onClose:()=>{this._dialogService.close(Rg)},onOk:()=>{this._dialogService.close(Rg)},className:"sheet-permission-user-dialog"};this._permissionService.getShowComponents()&&this._dialogService.open(t)}_getPermissionCheck(e,t){var n,s;let i=!0,r="";switch(e){case O_.id:case N_.id:if(this._contextService.getContextValue(Lc)===!0||this._contextService.getContextValue(uI)===!0)break;i=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[nn,oe]}),r=this._localeService.t("permission.dialog.editErr");break;case At.id:if(t.visible===!1)break;i=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[nn,oe]}),r=this._localeService.t("permission.dialog.editErr");break;case Ao.id:i=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,Qn]}),r=this._localeService.t("permission.dialog.pasteErr");break;case pm.id:i=this._permissionCheckByPaste(t),r=this._localeService.t("permission.dialog.pasteErr");break;case xh.id:i=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe,nn,mt]}),r=this._localeService.t("permission.dialog.commonErr");break;case El.id:case Oa.id:case Aa.id:case Va.id:case Ha.id:i=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[mt,oe]}),r=this._localeService.t("permission.dialog.setStyleErr");break;case Ds.id:i=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[oi],rangeTypes:[Gi],worksheetTypes:[qi]}),r=this._localeService.t("permission.dialog.copyErr"),(n=this._permissionService.getPermissionPoint(new oi(this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId()).id))!=null&&n.value||(r=this._localeService.t("permission.dialog.workbookCopyErr"));break;case Tr.id:i=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[oi,ne],rangeTypes:[Gi,he],worksheetTypes:[qi,oe]}),r=this._localeService.t("permission.dialog.copyErr"),(s=this._permissionService.getPermissionPoint(new oi(this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId()).id))!=null&&s.value||(r=this._localeService.t("permission.dialog.workbookCopyErr"));break}i||this._sheetPermissionCheckController.blockExecuteWithoutPermission(r)}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{this._getPermissionCheck(e.id,e?.params)}))}_permissionCheckByPaste(e){return e.value===_t.SPECIAL_PASTE_VALUE||e.value===_t.SPECIAL_PASTE_FORMULA?this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[mt,oe]}):e.value===_t.SPECIAL_PASTE_FORMAT?this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[mt,oe]}):this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[nn,mt,oe]})}};ca=w5([Ti(0,U),Ti(1,P),Ti(2,Je),Ti(3,uu),Ti(4,V(We)),Ti(5,V(Oe)),Ti(6,Ne),Ti(7,V(Yr))],ca);var S5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Cr=(e,t)=>(n,s)=>t(n,s,e);const b5="__SpreadsheetFreezeRowMainName__",_5="__SpreadsheetFreezeRowHeaderName__",I5="__SpreadsheetFreezeColumnMainName__",R5="__SpreadsheetFreezeColumnHeaderName__",yg=2,y5=.01,Za=gn("freezePermissionCheck");let su=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),y(this,"_rowFreezeHeaderRect"),y(this,"_rowFreezeMainRect"),y(this,"_columnFreezeHeaderRect"),y(this,"_columnFreezeMainRect"),y(this,"_freezeDownSubs"),y(this,"_freezePointerEnterSubs"),y(this,"_freezePointerLeaveSubs"),y(this,"_scenePointerMoveSub"),y(this,"_scenePointerUpSub"),y(this,"_changeToRow",-1),y(this,"_changeToColumn",-1),y(this,"_changeToOffsetX",0),y(this,"_changeToOffsetY",0),y(this,"_activeViewport",null),y(this,"_freezeNormalHeaderColor",""),y(this,"_freezeNormalMainColor",""),y(this,"_freezeActiveColor",""),y(this,"_freezeHoverColor",""),y(this,"_lastFreeze"),y(this,"interceptor",new Ci({FREEZE_PERMISSION_CHECK:Za})),this._context=e,this._sheetSkeletonManagerService=t,this._commandService=n,this._selectionManagerService=s,this._scrollManagerService=i,this._themeService=r,this._sheetInterceptorService=o,this._injector=a,this._initialize()}dispose(){super.dispose()}_initialize(){this._skeletonListener(),this._commandExecutedListener(),this._themeChangeListener(),this._interceptorCommands(),this._bindViewportScroll(),this._zoomRefresh()}_createFreeze(e=0,t){var n;const s=t??this._getFreeze();if(s==null)return null;const i=(n=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:n.skeleton,{startRow:r,startColumn:o}=s,a=this._getPositionByIndex(r,o);if(a==null||i==null)return null;const l=this._getSheetObject(),u=l.engine,d=u?.width||0,c=u?.height||0,h=l.scene,{startX:g,startY:m}=a,{rowTotalHeight:p,columnTotalWidth:f,rowHeaderWidthAndMarginLeft:v,columnHeaderHeightAndMarginTop:C}=i,w=d>f+v?d:f+C,b=c>p+C?c:p+C;this._changeToRow=r,this._changeToColumn=o,this._changeToOffsetX=g,this._changeToOffsetY=m;const I=Math.max(h.scaleX,h.scaleY);let _=yg/Math.max(1,I);if(e===0){(r===-1||r===0)&&(_=_*2);const R=_;this._rowFreezeHeaderRect=new Be(_5,{fill:this._freezeNormalHeaderColor,width:v,height:_,left:0,top:m-R,zIndex:3});let M=this._freezeNormalHeaderColor;(r===-1||r===0)&&(M=this._freezeNormalMainColor),this._rowFreezeMainRect=new Be(b5,{fill:M,width:w*2/I,height:_,left:v,top:m-R,zIndex:3}),h.addObjects([this._rowFreezeHeaderRect,this._rowFreezeMainRect],Xs)}else{(o===-1||o===0)&&(_=_*2);const R=_;this._columnFreezeHeaderRect=new Be(R5,{fill:this._freezeNormalHeaderColor,width:_,height:C,left:g-R,top:0,zIndex:3});let M=this._freezeNormalHeaderColor;(o===-1||o===0)&&(M=this._freezeNormalMainColor),this._columnFreezeMainRect=new Be(I5,{fill:M,width:_,height:b*2/I,left:g-R,top:C,zIndex:3}),h.addObjects([this._columnFreezeHeaderRect,this._columnFreezeMainRect],Xs)}this._eventBinding(e)}_eventBinding(e=0){let t=this._rowFreezeHeaderRect,n=this._rowFreezeMainRect;e===1&&(t=this._columnFreezeHeaderRect,n=this._columnFreezeMainRect);const s=this._getSheetObject();if(s==null)return;const{scene:i}=s;if(this._freezePointerEnterSubs=new ji,this._freezePointerLeaveSubs=new ji,this._freezeDownSubs=new ji,n){const a=n.onPointerEnter$.subscribeEvent(()=>{if(!this.interceptor.fetchThroughInterceptors(Za)(!0,null))return!1;t?.setProps({fill:this._freezeHoverColor,zIndex:4}),i.setCursor(Qe.GRAB)});this._freezePointerEnterSubs.add(a);const l=n.onPointerLeave$.subscribeEvent(()=>{t?.setProps({fill:this._freezeNormalHeaderColor,zIndex:3}),i.resetCursor()});this._freezePointerLeaveSubs.add(l)}if(t){const a=t.onPointerEnter$.subscribeEvent(()=>{if(!this.interceptor.fetchThroughInterceptors(Za)(!0,null))return!1;t?.setProps({fill:this._freezeHoverColor,zIndex:4}),i.setCursor(Qe.GRAB)});this._freezePointerEnterSubs.add(a);const l=t.onPointerLeave$.subscribeEvent(()=>{t?.setProps({fill:this._freezeNormalHeaderColor,zIndex:3}),i.resetCursor()});this._freezePointerLeaveSubs.add(l)}const r=t?.onPointerDown$.subscribeEvent(a=>{this._freezeDown(a,t,n,e)});r&&this._freezeDownSubs.add(r);const o=n?.onPointerDown$.subscribeEvent(a=>{this._freezeDown(a,t,n,e)});o&&this._freezeDownSubs.add(o)}_getCurrentLastVisible(){var e,t,n,s,i,r,o;const a=this._getSheetObject();if(a==null)return;const l=(e=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:e.skeleton;if(l==null)return;const u=a.scene,d=Math.max(u.scaleX,u.scaleY),c=this._scrollManagerService.getCurrentScrollState(),h=(a.engine.height-l.columnHeaderHeight)/d,g=(a.engine.width-l.rowHeaderWidth)/d,m=(t=c?.sheetViewStartRow)!=null?t:0,p=m===0?-((n=c?.offsetY)!=null?n:0):l.rowHeightAccumulation[m-1]-((s=c?.offsetY)!=null?s:0);let f=0,v=!1;for(let _=m,R=l.rowHeightAccumulation.length;_<R;_++)if(l.rowHeightAccumulation[_]-p>h){f=_,v=!0;break}v||(f=l.rowHeightAccumulation.length-1);const C=(i=c?.sheetViewStartColumn)!=null?i:0,w=C===0?-((r=c?.offsetX)!=null?r:0):l.columnWidthAccumulation[C-1]-((o=c?.offsetX)!=null?o:0);let b=0,I=!1;for(let _=C,R=l.columnWidthAccumulation.length;_<R;_++)if(l.columnWidthAccumulation[_]-w>g){b=_,I=!0;break}return I||(b=l.columnWidthAccumulation.length-1),{lastRow:f,lastColumn:b}}_getActiveViewport(e){var t;const n=(t=this._getSheetObject())==null?void 0:t.scene.getViewports();return n&&n.find(s=>s.isHit(new at(e.offsetX,e.offsetY)))||null}_freezeDown(e,t,n,s=0){var i;const r=(i=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:i.skeleton;if(r==null)return;const o=this._getSheetObject();if(o==null)return;if(!this.interceptor.fetchThroughInterceptors(Za)(!0,null))return!1;const{scene:a}=o;a.setCursor(Qe.GRABBING),a.disableObjectsEvent();const l=this._getCurrentLastVisible(),u=l===void 0?Number.POSITIVE_INFINITY:r.rowHeightAccumulation[l.lastRow],d=l===void 0?Number.POSITIVE_INFINITY:r.columnWidthAccumulation[l.lastColumn-1]+r.rowHeaderWidth;this._activeViewport=null;const c=this._getFreeze();c&&(this._changeToColumn=c.startColumn,this._changeToRow=c.startRow),this._scenePointerMoveSub=a.onPointerMove$.subscribeEvent(h=>{var g,m,p,f;const v=this._getActiveViewport(h),{startX:C,startY:w,row:b,column:I}=vi(h.offsetX,h.offsetY,a,r,v||void 0,!0);if(!this.interceptor.fetchThroughInterceptors(Za)(!0,null))return!1;a.setCursor(Qe.GRABBING);const _=yg/Math.max(a.scaleX,a.scaleY);s===0?((g=t.transformByState({top:Math.min(w,u)-_/2}))==null||g.setProps({fill:this._freezeActiveColor}),(m=n.transformByState({top:Math.min(w,u)-_/2}))==null||m.setProps({fill:this._freezeNormalHeaderColor}),this._changeToRow=l===void 0?b:Math.min(b,l.lastRow),this._changeToOffsetY=Math.min(w,u),this._activeViewport=v):((p=t.transformByState({left:Math.min(C,d)-_/2}))==null||p.setProps({fill:this._freezeActiveColor}),(f=n.transformByState({left:Math.min(C,d)-_/2}))==null||f.setProps({fill:this._freezeNormalHeaderColor}),this._changeToColumn=l===void 0?I:Math.min(I,l.lastColumn),this._changeToOffsetX=C,this._activeViewport=v)}),this._scenePointerUpSub=a.onPointerUp$.subscribeEvent(()=>{var h,g;a.resetCursor(),a.enableObjectsEvent(),this._clearObserverEvent();const{rowHeaderWidthAndMarginLeft:m,columnHeaderHeightAndMarginTop:p}=r;s===0&&(this._changeToRow===0||this._changeToRow===-1)||s===1&&(this._changeToColumn===0||this._changeToColumn===-1)?(t.setProps({fill:this._freezeNormalHeaderColor}),n.setProps({fill:this._freezeNormalMainColor})):(t?.setProps({fill:this._freezeNormalHeaderColor}),n?.setProps({fill:this._freezeNormalHeaderColor}));const f=yg/Math.max(a.scaleX,a.scaleY);s===0?(this._changeToRow===0||this._changeToRow===-1)&&(t.transformByState({top:p-f}),n.transformByState({top:p-f})):(this._changeToColumn===0||this._changeToColumn===-1)&&(t.transformByState({left:m-f}),n.transformByState({left:m-f}));const v=this._scrollManagerService.getCurrentScrollState()||{sheetViewStartRow:0,sheetViewStartColumn:0},{sheetViewStartRow:C,sheetViewStartColumn:w}=v;if(w==null||C==null)return;const b=this._context.unit,I=b.getActiveSheet();if(!I)return;const _=(h=I.getConfig())==null?void 0:h.freeze;let R=_?.xSplit||0,M=_?.ySplit||0;const x=(g=this._activeViewport)==null?void 0:g.viewportKey;s===0&&(!x||x===$.VIEW_LEFT_TOP||x===$.VIEW_MAIN_LEFT_TOP||x===$.VIEW_MAIN_TOP||x===$.VIEW_ROW_TOP?M=this._changeToRow-(_.startRow-_.ySplit):M=this._changeToRow-C,M=M<0?0:M),s===1&&(!x||x===$.VIEW_LEFT_TOP||x===$.VIEW_MAIN_LEFT_TOP||x===$.VIEW_MAIN_LEFT||x===$.VIEW_COLUMN_LEFT?R=this._changeToColumn-(_.startColumn-_.xSplit):R=this._changeToColumn-w,R=R<0?0:R),this._commandService.executeCommand(gl.id,{startRow:M===0?-1:this._changeToRow,startColumn:R===0?-1:this._changeToColumn,ySplit:M,xSplit:R,unitId:b.getUnitId(),subUnitId:I.getSheetId()})})}_getViewports(){const e=this._getSheetObject();if(e==null)return;const{scene:t}=e,n=t.getViewport($.VIEW_COLUMN_LEFT),s=t.getViewport($.VIEW_COLUMN_RIGHT),i=t.getViewport($.VIEW_ROW_TOP),r=t.getViewport($.VIEW_ROW_BOTTOM),o=t.getViewport($.VIEW_LEFT_TOP),a=t.getViewport($.VIEW_MAIN),l=t.getViewport($.VIEW_MAIN_LEFT_TOP),u=t.getViewport($.VIEW_MAIN_LEFT),d=t.getViewport($.VIEW_MAIN_TOP);if(!(n==null||s==null||i==null||r==null||o==null||a==null||l==null||u==null||d==null))return{viewMain:a,viewMainLeftTop:l,viewMainLeft:u,viewMainTop:d,viewColumnLeft:n,viewColumnRight:s,viewRowTop:i,viewRowBottom:r,viewLeftTop:o}}_bindViewportScroll(){const e=this._getViewports();if(!e)return;const{viewRowBottom:t,viewColumnRight:n,viewMainLeft:s,viewMainTop:i}=e;this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(r=>{if(!r)return;const{scrollX:o,scrollY:a,viewportScrollX:l,viewportScrollY:u}=r;t.isActive&&t.updateScrollVal({scrollY:a,viewportScrollY:u}),n.isActive&&n.updateScrollVal({scrollX:o,viewportScrollX:l}),s.isActive&&s.updateScrollVal({scrollY:a,viewportScrollY:u}),i.isActive&&i.updateScrollVal({scrollX:o,viewportScrollX:l})}))}_updateViewport(e=-1,t=-1,n=0,s=0,i=3){var r;const o=(r=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:r.skeleton;if(o==null)return;const{rowHeaderWidthAndMarginLeft:a,columnHeaderHeightAndMarginTop:l}=o,u=this._getViewports();if(!u)return;const{viewMain:d,viewMainLeftTop:c,viewMainLeft:h,viewMainTop:g,viewColumnLeft:m,viewColumnRight:p,viewRowTop:f,viewRowBottom:v,viewLeftTop:C}=u;p.resizeWhenFreezeChange({left:a,top:0,height:l+1,right:0}),v.resizeWhenFreezeChange({left:0,top:l,bottom:0,width:a+1}),C.resizeWhenFreezeChange({left:0,top:0,width:a+1,height:l});let w=!0,b=!0;c.enable(),(e===-1||e===0)&&(w=!1),(t===-1||t===0)&&(b=!1);const I=o.getNoMergeCellWithCoordByIndex(e-n,t-s,!1),_=o.getNoMergeCellWithCoordByIndex(e,t,!1);if(c.disable(),g.disable(),h.disable(),f.disable(),m.disable(),c.resetPadding(),g.resetPadding(),h.resetPadding(),f.resetPadding(),m.resetPadding(),w===!1&&b===!1)d.resizeWhenFreezeChange({left:a,top:l,bottom:0,right:0}),d.resetPadding(),h.resizeWhenFreezeChange({left:a,top:l,bottom:0,width:0}),g.resizeWhenFreezeChange({left:a,top:l,height:0,right:0}),c.resizeWhenFreezeChange({left:a,top:l,width:0,height:0}),f.resizeWhenFreezeChange({left:0,top:l,width:a+1,height:0}),m.resizeWhenFreezeChange({left:0,top:0,height:l+1,width:0});else if(w===!0&&b===!1){const R=_.startY-I.startY;d.resizeWhenFreezeChange({left:a,top:l+R,bottom:0,right:0}),d.setPadding({startY:I.startY,endY:_.startY,startX:0,endX:0}),i&2&&this._commandService.executeCommand(Ss.id,{sheetViewStartRow:0,offsetY:0}),g.resizeWhenFreezeChange({left:a,top:l,height:R,right:0}),g.updateScrollVal({viewportScrollY:I.startY,rawScrollX:d.scrollX,viewportScrollX:d.viewportScrollX}),f.resizeWhenFreezeChange({left:0,top:l,width:a+1,height:R}),f.updateScrollVal({viewportScrollY:I.startY}),v.resizeWhenFreezeChange({left:0,top:l+R,bottom:0,width:a+1}),g.enable(),f.enable()}else if(w===!1&&b===!0){const R=_.startX-I.startX;d.resizeWhenFreezeChange({left:a+R,top:l,bottom:0,right:0}),d.setPadding({startX:I.startX,endX:_.startX,startY:0,endY:0}),i&1&&this._commandService.executeCommand(Ss.id,{sheetViewStartColumn:0,offsetX:0}),h.resizeWhenFreezeChange({left:a,top:l,width:R,bottom:0,right:0}),h.updateScrollVal({viewportScrollX:I.startX,rawScrollY:d.scrollY,viewportScrollY:d.viewportScrollY}),m.resizeWhenFreezeChange({left:a,top:0,width:R,height:l+1}),m.updateScrollVal({viewportScrollX:I.startX}),p.resizeWhenFreezeChange({left:a+R,top:0,height:l+1,right:0}),h.enable(),m.enable()}else{const R=_.startX-I.startX,M=_.startY-I.startY;d.resizeWhenFreezeChange({left:a+R,top:l+M,bottom:0,right:0}),d.setPadding({startY:I.startY,endY:_.startY,startX:I.startX,endX:_.startX}),i&&this._commandService.executeCommand(Ss.id,{...i&1?{sheetViewStartColumn:0,offsetX:0}:null,...i&2?{sheetViewStartRow:0,offsetY:0}:null}),h.resizeWhenFreezeChange({left:a,top:l+M,width:R,bottom:0}),h.updateScrollVal({viewportScrollX:I.startX,rawScrollY:d.scrollY,viewportScrollY:d.viewportScrollY}),g.resizeWhenFreezeChange({left:a+R,top:l,height:M,right:0}),g.updateScrollVal({viewportScrollY:I.startY,rawScrollX:d.scrollX,viewportScrollX:d.viewportScrollX}),c.resizeWhenFreezeChange({left:a,top:l,width:R,height:M}),c.updateScrollVal({viewportScrollX:I.startX,viewportScrollY:I.startY}),f.resizeWhenFreezeChange({left:0,top:l,width:a+1,height:M}),f.updateScrollVal({viewportScrollY:I.startY}),v.resizeWhenFreezeChange({left:0,top:l+M,bottom:0,width:a+1}),m.resizeWhenFreezeChange({left:a,top:0,width:R,height:l+1}),m.updateScrollVal({viewportScrollX:I.startX}),p.resizeWhenFreezeChange({left:a+R,top:0,height:l+1,right:0}),c.enable(),g.enable(),h.enable(),f.enable(),m.enable()}}_skeletonListener(){this.disposeWithMe(He(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{[lt.id,Fs.id,gi.id].includes(e?.commandId||"")&&this._refreshCurrent()})))}_refreshCurrent(){const e=this._context.unit.getActiveSheet();if(!e)return;const t=e.getConfig().freeze,{startRow:n=-1,startColumn:s=-1,ySplit:i=0,xSplit:r=0}=t;this._refreshFreeze(n,s,i,r,0)}_themeChangeListener(){this._themeChange(this._themeService.getCurrentTheme()),this.disposeWithMe(this._themeService.currentTheme$.subscribe(e=>{this._clearFreeze(),this._themeChange(e),this._refreshCurrent()}))}_themeChange(e){this._freezeNormalHeaderColor=Wh(e,"gray.300"),this._freezeNormalMainColor=new Ls(this._freezeNormalHeaderColor).setAlpha(y5).toRgbString(),this._freezeActiveColor=Wh(e,"primary.600"),this._freezeHoverColor=Wh(e,"gray.500")}_interceptorCommands(){this.disposeWithMe(this._sheetInterceptorService.interceptCommand({getMutations:e=>{const t={redos:[],undos:[]},n=this._getFreeze();if(!n)return t;const s=i=>{const r=this._context.unit,o=r.getUnitId(),a=r.getActiveSheet();if(!a)return t;const l=a.getSheetId();this._refreshFreeze(i.startRow,i.startColumn,i.ySplit,i.xSplit,0);const u={...i,unitId:o,subUnitId:l,resetScroll:!1},d=lh(this._injector,u);return{undos:[{id:wn.id,params:d}],redos:[{id:wn.id,params:u}]}};if(e.id===bs.id){const i=e.params,{range:r,direction:o}=i,a=r.endRow-r.startRow+1;if(r.startRow<n.startRow||r.startRow+1===n.startRow&&o===Z.UP){const l={...n,startRow:Math.max(1,n.startRow+a),ySplit:Math.max(1,n.ySplit+a)};return s(l)}}if(e.id===_s.id){const i=e.params,{range:r,direction:o}=i,a=r.endColumn-r.startColumn+1;if(r.startColumn<n.startColumn||r.startColumn+1===n.startColumn&&o===Z.LEFT){const l={...n,startColumn:Math.max(1,n.startColumn+a),xSplit:Math.max(1,n.xSplit+a)};return s(l)}}if(e.id===Ki.id){const i=this._selectionManagerService.getCurrentSelections(),{fromRange:{startColumn:r},toRange:{startColumn:o}}=e.params,a=i?.filter(p=>p.range.rangeType===j.COLUMN&&p.range.startColumn<=r&&r<=p.range.endColumn);if(!(a!=null&&a.length))return t;const l=a[0].range,u={...l,startColumn:o,endColumn:o+l.endColumn-l.startColumn};if(!n||n.startColumn<=0||l.startColumn>=n.startColumn&&u.startColumn>=n.startColumn||l.startColumn===u.startColumn||l.endColumn<n.startColumn&&u.startColumn<n.startColumn)return t;const d=l.endColumn-l.startColumn+1,c=Math.max(Math.min(n.startColumn,l.endColumn+1)-l.startColumn,0);let h,g;u.startColumn>=n.startColumn?(h=Math.max(n.startColumn-c,1),g=Math.max(n.xSplit-c,1)):(h=n.startColumn+d-c,g=n.xSplit+d-c);const m={...n,startColumn:h,xSplit:g};return s(m)}if(e.id===Qi.id){const i=this._selectionManagerService.getCurrentSelections(),{fromRange:{startRow:r},toRange:{startRow:o}}=e.params,a=i?.filter(p=>p.range.rangeType===j.ROW&&p.range.startRow<=r&&r<=p.range.endRow);if(!(a!=null&&a.length))return t;const l=a[0].range,u={...l,startRow:o,endRow:o+l.endRow-l.startRow};if(!n||n.startRow<=0||l.startRow>=n.startRow&&u.startRow>=n.startRow||l.startRow===u.startRow||l.endRow<n.startRow&&u.startRow<n.startRow)return t;const d=l.endRow-l.startRow+1,c=Math.max(Math.min(n.startRow,l.endRow+1)-l.startRow,0);let h,g;u.startRow>=n.startRow?(h=Math.max(n.startRow-c,1),g=Math.max(n.ySplit-c,1)):(h=n.startRow+d-c,g=n.ySplit+d-c);const m={...n,startRow:h,ySplit:g};return s(m)}if(e.id===Pa.id||e.id===Ta.id){const i=e.params,r=i.range;if(r.rangeType===j.COLUMN&&r.startColumn<n.startColumn){const o=Math.min(n.startColumn,r.endColumn+1)-r.startColumn,a={...n,startColumn:Math.max(1,n.startColumn-o),xSplit:Math.max(1,n.xSplit-o)};return s(a)}if(i.range.rangeType===j.ROW&&r.startRow<n.startRow){const o=Math.min(n.startRow,r.endRow+1)-r.startRow,a={...n,startRow:Math.max(1,n.startRow-o),ySplit:Math.max(1,n.ySplit-o)};return s(a)}}return t}}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{switch(e.id){case wn.id:case Mi.id:{const t=this._lastFreeze,n=this._context.unit,s=n.getActiveSheet(),i=e.params,{unitId:r,subUnitId:o}=i;if(!(r===n.getUnitId()&&o===s?.getSheetId()))return;const a=s.getConfig().freeze;if(this._lastFreeze=a,a==null)return;let l=0;const{startRow:u=-1,startColumn:d=-1,ySplit:c=0,xSplit:h=0}=a;(!t||t.startRow!==u||t.ySplit!==c)&&(l|=2),(!t||t.startColumn!==d||t.xSplit!==h)&&(l|=1),i.resetScroll===!1&&(l=0),this._refreshFreeze(u,d,c,h,l)}break;case os.id:{const t=this._getFreeze(),n=t&&e.params.ranges.some(s=>s.startRow<t.startRow);e.params&&n&&this._refreshCurrent()}break;case Cn.id:{const t=this._getFreeze();e.params&&t&&e.params.ranges.some(n=>n.startColumn<t.startColumn)&&this._refreshCurrent()}break;case ds.id:{const t=e.params,n=this._getFreeze();if(n&&n.startRow>-1&&t.rowsAutoHeightInfo.some(s=>s.row<n.startRow)){const s=this._sheetSkeletonManagerService.currentSkeleton$.subscribe(()=>{this._refreshCurrent(),setTimeout(()=>{s.unsubscribe()})})}}break;case Ur.id:case Nr.id:{const t=e.params,n=this._getFreeze(),s=t.ranges;n&&n.startColumn>-1&&s.some(i=>i.startColumn<n.startColumn)&&this._refreshCurrent()}break;case Yi.id:case Xi.id:{const t=e.params,n=this._getFreeze(),s=t.ranges;n&&n.startRow>-1&&s.some(i=>i.startRow<n.startRow)&&this._refreshCurrent()}break;case fh.id:case vh.id:this._refreshCurrent()}}))}_zoomRefresh(){const e=this._getSheetObject();if(e==null)return;const{scene:t}=e;this.disposeWithMe(t.onTransformChange$.subscribeEvent(n=>{[Kg.scale,Kg.all].includes(n.type)&&this._refreshCurrent()}))}_clearObserverEvent(){var e,t;this._getSheetObject()!=null&&((e=this._scenePointerMoveSub)==null||e.unsubscribe(),(t=this._scenePointerUpSub)==null||t.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null)}_clearFreeze(){var e,t,n,s,i,r;(e=this._rowFreezeHeaderRect)==null||e.dispose(),(t=this._rowFreezeMainRect)==null||t.dispose(),(n=this._columnFreezeHeaderRect)==null||n.dispose(),(s=this._columnFreezeMainRect)==null||s.dispose(),this._getSheetObject()!=null&&([this._freezeDownSubs,this._freezePointerEnterSubs,this._freezePointerLeaveSubs].forEach(o=>{o?.unsubscribe()}),this._freezeDownSubs=null,this._freezePointerEnterSubs=null,this._freezePointerLeaveSubs=null,(i=this._scenePointerMoveSub)==null||i.unsubscribe(),(r=this._scenePointerUpSub)==null||r.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null)}_getPositionByIndex(e,t){var n;if(this._getSheetObject()==null)return;const s=(n=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:n.skeleton,i=s?.getNoMergeCellWithCoordByIndex(e,t);if(s==null)return;if(i!=null&&(!isNaN(i.endX)||!isNaN(i.endY)))return i;const{rowHeaderWidthAndMarginLeft:r,columnHeaderHeightAndMarginTop:o}=s;return{startX:r,endX:r,startY:o,endY:o}}_getFreeze(){var e;const t=(e=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:e.skeleton.getWorksheetConfig();if(t!=null)return t.freeze}_getSheetObject(){return Rs(this._context.unit,this._context)}_refreshFreeze(e,t,n,s,i){var r;const o={startRow:e,startColumn:t,ySplit:n,xSplit:s};this._clearFreeze(),this._createFreeze(0,o),this._createFreeze(1,o),this._updateViewport(e,t,n,s,i),(r=this._getSheetObject())==null||r.spreadsheet.makeForceDirty()}};su=S5([Cr(1,V(Te)),Cr(2,U),Cr(3,V(q)),Cr(4,V(Sn)),Cr(5,V(xn)),Cr(6,V(_e)),Cr(7,V(pt))],su);var M5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Mg=(e,t)=>(n,s)=>t(n,s,e);const E5="__SpreadsheetHeaderMoveControllerBackground__",x5="__SpreadsheetHeaderMoveControllerShapeLine__",k5="rgba(0, 0, 0, 0.1)",T5="rgb(119, 119, 119)",P5=4,Eg=gn("headerMovePermissionCheck");let iu=class extends ae{constructor(e,t,n,s){super(),y(this,"_startOffsetX",Number.NEGATIVE_INFINITY),y(this,"_startOffsetY",Number.NEGATIVE_INFINITY),y(this,"_moveHelperBackgroundShape"),y(this,"_moveHelperLineShape"),y(this,"_headerPointerDownSubs"),y(this,"_headerPointerMoveSubs"),y(this,"_headerPointerLeaveSubs"),y(this,"_dragHeaderMoveSub"),y(this,"_scenePointerUpSub"),y(this,"_scrollTimer"),y(this,"_changeFromColumn",-1),y(this,"_changeFromRow",-1),y(this,"_changeToColumn",-1),y(this,"_changeToRow",-1),y(this,"interceptor",new Ci({HEADER_MOVE_PERMISSION_CHECK:Eg})),y(this,"_workbookSelections"),this._context=e,this._sheetSkeletonManagerService=n,this._commandService=s,this._workbookSelections=t.getWorkbookSelections(this._context.unitId),this._init()}dispose(){var e,t,n,s,i,r,o,a;(e=this._moveHelperBackgroundShape)==null||e.dispose(),(t=this._moveHelperLineShape)==null||t.dispose(),(n=this._headerPointerMoveSubs)==null||n.unsubscribe(),(s=this._headerPointerLeaveSubs)==null||s.unsubscribe(),(i=this._headerPointerDownSubs)==null||i.unsubscribe(),this._headerPointerMoveSubs=null,this._headerPointerLeaveSubs=null,this._headerPointerDownSubs=null,(r=this._dragHeaderMoveSub)==null||r.unsubscribe(),(o=this._scenePointerUpSub)==null||o.unsubscribe(),this._dragHeaderMoveSub=null,this._scenePointerUpSub=null,(a=this._scrollTimer)==null||a.dispose()}_init(){this._initialRowOrColumn(j.ROW),this._initialRowOrColumn(j.COLUMN)}_initialRowOrColumn(e=j.ROW){const t=this._context.components.get(yt.COLUMN),n=this._context.components.get(yt.ROW),s=this._context.scene,i=e===j.ROW?n:t,r=l=>{var u,d;const c=(u=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:u.skeleton;if(c==null)return;const h=(d=this._workbookSelections.getCurrentLastSelection())==null?void 0:d.range;if(!h||!this.interceptor.fetchThroughInterceptors(Eg)(!1,h))return;const g=this._workbookSelections.getCurrentSelections(),{row:m,column:p}=vi(l.offsetX,l.offsetY,s,c);if(!dc(g,e===j.ROW?m:p,e)){s.resetCursor();return}s.setCursor(Qe.GRAB)},o=()=>{var l,u;(l=this._moveHelperBackgroundShape)==null||l.hide(),(u=this._moveHelperLineShape)==null||u.hide(),s.resetCursor()},a=(l,u)=>{var d,c;if(u.isStopPropagation)return;const h=(d=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:d.skeleton;if(h==null)return;const g=(c=this._workbookSelections.getCurrentLastSelection())==null?void 0:c.range;if(!g||!this.interceptor.fetchThroughInterceptors(Eg)(!1,g))return;const{offsetX:m,offsetY:p}=l,f=s.getCoordRelativeToViewport(at.FromArray([m,p])),{x:v,y:C}=f;this._startOffsetX=v,this._startOffsetY=C;const{row:w,column:b}=vi(l.offsetX,l.offsetY,s,h);let I;e===j.ROW?(this._changeFromRow=w,I=tn.Y):(this._changeFromColumn=b,I=tn.X);const _=this._workbookSelections.getCurrentSelections(),R=dc(_,e===j.ROW?w:b,e);if(!R)return;const M=s.getScrollXYInfoByViewport(at.FromArray([this._startOffsetX,this._startOffsetY]));this._newBackgroundAndLine(),s.setCursor(Qe.GRABBING),s.disableObjectsEvent();let x=!1,N;const T=()=>{if(x)return;N=To.create(s,I),this._scrollTimer=N;const O=s.getViewport($.VIEW_MAIN);N.startScroll(v,C,O),x=!0};this._dragHeaderMoveSub=s.onPointerMove$.subscribeEvent(O=>{T();const{offsetX:k,offsetY:D}=O,{x:B,y:W}=s.getCoordRelativeToViewport(at.FromArray([k,D]));this._rowColumnMoving(B,W,R,M,e),N.scrolling(B,W,()=>{this._rowColumnMoving(B,W,R,M,e)})}),this._scenePointerUpSub=s.onPointerUp$.subscribeEvent(()=>{var O,k,D;this._disposeBackgroundAndLine(),s.resetCursor(),s.enableObjectsEvent(),this._clearObserverEvent(),(O=this._scrollTimer)==null||O.dispose();const B=this._workbookSelections.getCurrentSelections();if(e===j.ROW){if(this._changeFromRow!==this._changeToRow&&this._changeToRow!==-1){const W=(k=(B?.filter(F=>F.range.rangeType===j.ROW&&F.range.startRow<=this._changeFromRow&&this._changeFromRow<=F.range.endRow)||[])[0])==null?void 0:k.range;W&&this._commandService.executeCommand(Qi.id,{fromRange:W,toRange:{...W,startRow:this._changeToRow,endRow:this._changeToRow+W.endRow-W.startRow}})}this._changeToRow=this._changeFromRow=-1}else{if(this._changeFromColumn!==this._changeToColumn&&this._changeToColumn!==-1){const W=(D=(B?.filter(F=>F.range.rangeType===j.COLUMN&&F.range.startColumn<=this._changeFromColumn&&this._changeFromColumn<=F.range.endColumn)||[])[0])==null?void 0:D.range;W&&this._commandService.executeCommand(Ki.id,{fromRange:W,toRange:{...W,startColumn:this._changeToColumn,endColumn:this._changeToColumn+W.endColumn-W.startColumn}})}this._changeToColumn=this._changeFromColumn=-1}})};this._headerPointerMoveSubs=new ji,this._headerPointerMoveSubs.add(i.onPointerMove$.subscribeEvent(r)),this._headerPointerLeaveSubs=new ji,this._headerPointerLeaveSubs.add(i?.onPointerLeave$.subscribeEvent(o)),this._headerPointerDownSubs=new ji,this._headerPointerDownSubs.add(i?.onPointerDown$.subscribeEvent(a))}_rowColumnMoving(e,t,n,s,i){var r,o,a,l,u,d,c;const h=this._context.scene,g=(r=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:r.skeleton;if(g==null)return;const{rowHeaderWidth:m,columnHeaderHeight:p,rowTotalHeight:f,columnTotalWidth:v}=g,C=h.getViewportScrollXY(h.getViewport($.VIEW_MAIN)),{scaleX:w,scaleY:b}=h.getAncestorScale(),I=g.getCellIndexByOffset(e,t,w,b,C),{row:_,column:R}=I,M=g.getNoMergeCellWithCoordByIndex(_,R),{startX:x,startY:N,endX:T,endY:O}=M,k=this._sheetSkeletonManagerService.attachRangeWithCoord(n.range);if(k==null)return;const D=Math.max(w,w),{startX:B,endX:W,startY:F,endY:K,startRow:J,startColumn:ee,endRow:we,endColumn:Ge}=k;i===j.ROW?(o=this._moveHelperBackgroundShape)==null||o.transformByState({height:K-F,width:v+m,left:0,top:F+(t-this._startOffsetY)/D+C.y-s.y}):(a=this._moveHelperBackgroundShape)==null||a.transformByState({height:f+p,width:W-B,left:B+(e-this._startOffsetX)/D+C.x-s.x,top:0}),(l=this._moveHelperBackgroundShape)==null||l.show();const Ae=P5/D;if(i===j.ROW){let Ze=0;if(_<=J)Ze=N-Ae/2,this._changeToRow=_;else if(_>we)Ze=O-Ae/2,this._changeToRow=_+1;else return;(u=this._moveHelperLineShape)==null||u.transformByState({height:Ae,width:v,left:m,top:Ze})}else{let Ze=0;if(R<=ee)Ze=x-Ae/2,this._changeToColumn=R;else if(R>Ge)Ze=T-Ae/2,this._changeToColumn=R+1;else return;(d=this._moveHelperLineShape)==null||d.transformByState({height:f,width:Ae,left:Ze,top:p})}(c=this._moveHelperLineShape)==null||c.show()}_clearObserverEvent(){var e,t;(e=this._dragHeaderMoveSub)==null||e.unsubscribe(),(t=this._scenePointerUpSub)==null||t.unsubscribe(),this._dragHeaderMoveSub=null,this._scenePointerUpSub=null}_newBackgroundAndLine(){const e=this._context.scene;this._moveHelperBackgroundShape=new Be(E5,{fill:k5,evented:!1,zIndex:100}),this._moveHelperLineShape=new Be(x5,{fill:T5,evented:!1,zIndex:100}),e.addObjects([this._moveHelperBackgroundShape,this._moveHelperLineShape],Xs)}_disposeBackgroundAndLine(){var e,t;(e=this._moveHelperBackgroundShape)==null||e.dispose(),(t=this._moveHelperLineShape)==null||t.dispose()}};iu=M5([Mg(1,V(q)),Mg(2,V(Te)),Mg(3,U)],iu);var ru=(e=>(e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e))(ru||{});const U5="rgba(120, 120, 120, 0.01)",xg="rgb(68, 71, 70)",ai=12,C1=44,ou=4;class hc extends qm{constructor(t,n){super(t,n),y(this,"_size",ai),y(this,"_color",xg),y(this,"_mode",0),this.setShapeProps(n)}get size(){return this._size}get mode(){return this._mode}get color(){return this._color}_draw(t){const n=this.getScene();if(!n)return;const{scaleX:s,scaleY:i}=n.getAncestorScale(),r=Math.max(s,i),o=ai/r,a=ou/r;let{width:l,height:u}=this,d=0,c=0;this.mode===0?(l=a,d=o-a):(u=a,c=o-a),Be.drawWith(t,{width:this.width,height:this.height,left:0,top:0,fill:U5}),Be.drawWith(t,{width:l,height:u,fill:xg,radius:a}),t.save(),t.transform(1,0,0,1,d,c),Be.drawWith(t,{width:l,height:u,fill:xg,radius:a}),t.restore()}setShapeProps(t){return t!=null&&t.size&&(this._size=t.size),t!=null&&t.mode&&(this._mode=t.mode),t!=null&&t.color&&(this._color=t.color),this.mode===0?this.transformByState({width:ai,height:this.size}):this.transformByState({width:this.size,height:ai}),this}}var N5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},kg=(e,t)=>(n,s)=>t(n,s,e);const O5="__SpreadsheetHeaderResizeControllerShapeRow__",A5="__SpreadsheetHeaderResizeControllerShapeColumn__",bC="__SpreadsheetHeaderResizeControllerShapeHelper__",_C="rgb(199, 199, 199)",V5=2,Tg=gn("headerResizePermissionCheck");let gc=class extends ae{constructor(e,t,n,s){super(),y(this,"_currentRow",0),y(this,"_currentColumn",0),y(this,"_rowResizeRect"),y(this,"_columnResizeRect"),y(this,"_headerPointerSubs"),y(this,"_scenePointerMoveSub"),y(this,"_scenePointerUpSub"),y(this,"_resizeHelperShape"),y(this,"_startOffsetX",Number.POSITIVE_INFINITY),y(this,"_startOffsetY",Number.POSITIVE_INFINITY),y(this,"interceptor",new Ci({HEADER_RESIZE_PERMISSION_CHECK:Tg})),this._context=e,this._sheetSkeletonManagerService=t,this._selectionManagerService=n,this._commandService=s,this._init()}dispose(){var e,t,n;(e=this._rowResizeRect)==null||e.dispose(),this._rowResizeRect=null,(t=this._columnResizeRect)==null||t.dispose(),this._columnResizeRect=null,(n=this._headerPointerSubs)==null||n.unsubscribe(),this._headerPointerSubs=null}_init(){const e=this._context.scene;this._rowResizeRect=new hc(O5,{visible:!1,mode:ru.HORIZONTAL,zIndex:100}),this._columnResizeRect=new hc(A5,{visible:!1,mode:ru.VERTICAL,zIndex:100}),e.addObjects([this._rowResizeRect,this._columnResizeRect],Xs),this._initialHover(0),this._initialHover(1),this._initialHoverResize(0),this._initialHoverResize(1)}_initialHover(e=0){const t=this._context.components.get(yt.COLUMN),n=this._context.components.get(yt.ROW),s=this._context.scene,i=e===0?n:t,r=(a,l)=>{var u,d;(u=this._rowResizeRect)==null||u.hide(),(d=this._columnResizeRect)==null||d.hide()},o=(a,l)=>{var u;const d=(u=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:u.skeleton;if(d==null||this._rowResizeRect==null||this._columnResizeRect==null)return;const{rowHeaderWidth:c,columnHeaderHeight:h}=d,{startX:g,startY:m,endX:p,endY:f,row:v,column:C}=vi(a.offsetX,a.offsetY,s,d),w=rd(a.offsetX,a.offsetY,s),{scaleX:b,scaleY:I}=s.getAncestorScale(),_=Math.max(b,I),R=ai/_;if(e===0){let M=m-R/2;if(w.y<=m+R/2&&w.y>=m)this._currentRow=v-1;else if(w.y>=f-R/2&&w.y<=f)this._currentRow=v,M=f-R/2;else{this._rowResizeRect.hide();return}if(this._currentRow===-1)return;if(!this.interceptor.fetchThroughInterceptors(Tg)(null,{row:this._currentRow}))return!1;const x=Math.min(C1,c/3);this._rowResizeRect.transformByState({left:c/2-x/2,top:M}),this._rowResizeRect.setShapeProps({size:x}),this._rowResizeRect.show()}else{let M=g-R/2;if(w.x<=g+R/2&&w.x>=g)this._currentColumn=C-1;else if(w.x>=p-R/2&&w.x<=p)this._currentColumn=C,M=p-R/2;else{this._columnResizeRect.hide();return}if(this._currentColumn===-1)return;if(!this.interceptor.fetchThroughInterceptors(Tg)(null,{col:this._currentColumn}))return!1;const x=h*.7;this._columnResizeRect.transformByState({left:M,top:h/2-x/2}),this._columnResizeRect.setShapeProps({size:x}),this._columnResizeRect.show()}};this._headerPointerSubs=new ji,this._headerPointerSubs.add(i?.onPointerMove$.subscribeEvent(o)),this._headerPointerSubs.add(i?.onPointerLeave$.subscribeEvent(r))}_initialHoverResize(e=0){const t=this._context.scene,n=e===0?this._rowResizeRect:this._columnResizeRect;n!=null&&(this.disposeWithMe(n.onPointerEnter$.subscribeEvent(()=>{n!=null&&(n.show(),t.setCursor(e===0?Qe.ROW_RESIZE:Qe.COLUMN_RESIZE))})),this.disposeWithMe(n.onPointerLeave$.subscribeEvent(()=>{n!=null&&(n.hide(),t.resetCursor())})),this.disposeWithMe(n.onPointerDown$.subscribeEvent(s=>{var i,r,o,a,l,u,d;const c=(i=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:i.skeleton;if(c==null)return;const h=this._context.scene,g=h.getEngine(),m=g?.height||0,p=g?.width||0,f=h.getViewport($.VIEW_MAIN),v=(((o=(r=f?.getScrollBar())==null?void 0:r.horizonScrollTrack)==null?void 0:o.height)||0)+10,C=(((l=(a=f?.getScrollBar())==null?void 0:a.verticalScrollTrack)==null?void 0:l.width)||0)+10,w=rd(s.offsetX,s.offsetY,h),{scaleX:b,scaleY:I}=h.getAncestorScale();this._startOffsetX=w.x,this._startOffsetY=w.y;const _=c.getOffsetByColumn(this._currentColumn),R=c.getOffsetByRow(this._currentRow),M=c.getNoMergeCellWithCoordByIndex(this._currentRow,this._currentColumn);let x=!1,N=0,T=0;const{columnTotalWidth:O,rowHeaderWidth:k,rowTotalHeight:D,columnHeaderHeight:B}=c,W=p>O+k?p:O+k,F=m>D+B?m:D+B,K=Math.max(b,I),J=ou/K;e===0?this._resizeHelperShape=new Be(bC,{width:W,height:J,fill:_C,left:0,top:R-J/2}):this._resizeHelperShape=new Be(bC,{width:J,height:F,fill:_C,left:_-J/2,top:0});const ee=((u=this._columnResizeRect)==null?void 0:u.left)||0,we=((d=this._rowResizeRect)==null?void 0:d.top)||0;h.addObject(this._resizeHelperShape,Xs),h.disableObjectsEvent(),this._scenePointerMoveSub=h.onPointerMove$.subscribeEvent(Ge=>{var Ae,Ze,ue,ge,be,Ue;const Rt=h.getCoordRelativeToViewport(at.FromArray([this._startOffsetX,this._startOffsetY])),ke=h.getScrollXYInfoByViewport(Rt,f),Ye=rd(Ge.offsetX,Ge.offsetY,h),{x:Ot,y:ut}=Ye,{scaleX:re,scaleY:Ie}=h.getAncestorScale(),Xe=Math.max(re,Ie),Pe=ou/Xe;N=Ot-this._startOffsetX-Pe/2,T=ut-this._startOffsetY-Pe/2,Math.abs(e===0?T:N)>=V5&&(x=!0),e===0?(T>m-v+ke.y-M.startY&&(T=m-v+ke.y-M.startY),T<-(M.endY-M.startY)+2&&(T=-(M.endY-M.startY)+2),x&&((Ae=this._resizeHelperShape)==null||Ae.transformByState({top:R+T}),(Ze=this._rowResizeRect)==null||Ze.transformByState({top:we+T+Pe/2}),(ue=this._rowResizeRect)==null||ue.show(),h.setCursor(Qe.ROW_RESIZE))):(N>p-C+ke.x-M.startX&&(N=p-C+ke.x-M.startX),N<-(M.endX-M.startX)+2&&(N=-(M.endX-M.startX)+2),x&&((ge=this._resizeHelperShape)==null||ge.transformByState({left:_+N}),(be=this._columnResizeRect)==null||be.transformByState({left:ee+N+Pe/2}),(Ue=this._columnResizeRect)==null||Ue.show(),h.setCursor(Qe.COLUMN_RESIZE)))}),this._scenePointerUpSub=h.onPointerUp$.subscribeEvent(Ge=>{var Ae,Ze,ue;const ge=this._context.scene;this._clearObserverEvent(),(Ae=this._resizeHelperShape)==null||Ae.dispose(),this._resizeHelperShape=null,ge.enableObjectsEvent(),x&&(ge.resetCursor(),(Ze=this._rowResizeRect)==null||Ze.hide(),(ue=this._columnResizeRect)==null||ue.hide(),e===0?this._commandService.executeCommand(Ko.id,{deltaY:T,anchorRow:this._currentRow}):this._commandService.executeCommand(Qo.id,{deltaX:N,anchorCol:this._currentColumn}))})})),this.disposeWithMe(n.onDblclick$.subscribeEvent(()=>{var s,i,r;this._context.scene.resetCursor();const o=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(!o)return;const a=0,l=0,u=o.worksheet.getRowCount()-1||0,d=o.worksheet.getColumnCount()-1||0;switch(e){case 1:{const c=this._selectionManagerService.getCurrentSelections(),h=[];for(let g=0;g<c.length;g++){const m=c[g];m.range.rangeType===j.COLUMN&&this._currentColumn<=m.range.endColumn&&this._currentColumn>=m.range.startColumn&&h.push({startColumn:m.range.startColumn,endColumn:m.range.endColumn,startRow:a,endRow:u})}h.length===0&&h.push({startColumn:this._currentColumn,endColumn:this._currentColumn,startRow:a,endRow:u}),this._commandService.executeCommand(Eu.id,{ranges:h}),(i=this._columnResizeRect)==null||i.hide();break}case 0:this._commandService.executeCommand(ci.id,{ranges:[{startRow:this._currentRow,endRow:this._currentRow,startColumn:l,endColumn:d}]}),(r=this._rowResizeRect)==null||r.hide();break}})))}_clearObserverEvent(){var e,t;(e=this._scenePointerMoveSub)==null||e.unsubscribe(),(t=this._scenePointerUpSub)==null||t.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null}};gc=N5([kg(1,V(Te)),kg(2,V(q)),kg(3,U)],gc);var H5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ga=(e,t)=>(n,s)=>t(n,s,e);const D5=60;let mc=class extends Ms{constructor(e,t,n,s,i,r){super(),y(this,"_renderMetric$",new Ve),y(this,"renderMetric$",this._renderMetric$.asObservable()),y(this,"_renderFrameTimeMetric",null),y(this,"_renderFrameTags",{}),y(this,"_afterRenderMetric$",new Ve),this._context=e,this._configService=t,this._sheetSkeletonManagerService=n,this._sheetRenderService=s,this._commandService=i,this._telemetryService=r,this._addNewRender(),this._initRenderMetricSubscriber()}_addNewRender(){const{scene:e,engine:t,unit:n}=this._context;this._addComponent(n),this._initRerenderScheduler(),this._initCommandListener();const s=this._context.unit.getActiveSheet();if(!s)throw new Error("No active sheet found");const i=s.getSheetId();this._sheetSkeletonManagerService.setCurrent({sheetId:i});const r=()=>e.render();this.disposeWithMe(this._context.activated$.subscribe(o=>{o?t.runRenderLoop(r):t.stopRenderLoop(r)}))}_initRenderMetricSubscriber(){const{engine:e}=this._context;e.beginFrame$.subscribe(()=>{this._renderFrameTimeMetric=null,this._renderFrameTags={}}),e.endFrame$.subscribe(()=>{this._renderFrameTimeMetric&&Object.keys(this._renderFrameTimeMetric).filter(n=>n.startsWith(rv)).length>0&&this._afterRenderMetric$.next({frameTimeMetric:this._renderFrameTimeMetric,tags:this._renderFrameTags})}),e.renderFrameTimeMetric$.subscribe(([n,s])=>{this._renderFrameTimeMetric||(this._renderFrameTimeMetric={}),this._renderFrameTimeMetric[n]||(this._renderFrameTimeMetric[n]=[]),this._renderFrameTimeMetric[n].push(Math.round(s*100)/100)}),e.renderFrameTags$.subscribe(([n,s])=>{this._renderFrameTags[n]=s});const t=[];this._afterRenderMetric$.pipe(P0(e.endFrame$)).subscribe(([n,s])=>{t.push({FPS:s.FPS,elapsedTime:s.elapsedTime,frameTime:Math.round(s.frameTime*100)/100,...n.frameTimeMetric,...n.tags}),t.length>D5&&(this._captureRenderMetric(t),t.length=0)})}_captureRenderMetric(e){var t;const n=e;if(n.length===0)return;const s=d=>{let c=0;const h=Object.entries(d).filter(([g,m])=>Array.isArray(m)).map(([g])=>g).reduce((g,m)=>{const p=d[m].reduce((f,v)=>f+v,0);return g[m]=p,g},{});return Object.keys(d).filter(g=>g.startsWith(rv)).forEach(g=>{c+=h[g]}),{...h,extensionTotal:c}},i=e.map(d=>({...d,...s(d)})),r=(d=>Object.entries(d[0]).filter(([c,h])=>!["elapsedTime"].includes(c)).filter(([c,h])=>typeof h=="number").map(([c])=>c).reduce((c,h)=>{const g=d.map(v=>v[h]),m=Math.max(...g),p=Math.min(...g),f=g.reduce((v,C)=>v+C,0)/g.length;return c[h]={max:Math.round(m*100)/100,min:Math.round(p*100)/100,avg:Math.round(f*100)/100},c},{}))(i),o=n[n.length-1].elapsedTime,a=this._context.unit.getActiveSheet().getSheetId(),l=this._context.unit.getUnitId(),u={sheetId:a,unitId:l,elapsedTimeToStart:o,...r};this._renderMetric$.next(u),(t=this._telemetryService)==null||t.capture("sheet_render_cost",u)}_addComponent(e){const{scene:t,components:n}=this._context,s=e.getActiveSheet(),i=new vw(yt.MAIN);this._addViewport(s);const r=new t0(yt.ROW),o=new n0(yt.COLUMN),a=new Be(yt.LEFT_TOP,{zIndex:2,left:-1,top:-1,fill:"rgb(248, 249, 250)",stroke:"rgb(217, 217, 217)",strokeWidth:1});this._context.mainComponent=i,n.set(yt.MAIN,i),n.set(yt.ROW,r),n.set(yt.COLUMN,o),n.set(yt.LEFT_TOP,a),t.addObjects([i],Pv),t.addObjects([r,o,a],Xs),t.enableLayerCache(Pv,Xs)}_initViewports(e,t,n){const s=new Qs($.VIEW_MAIN,e,{left:t.width,top:n.height,bottom:0,right:0,isWheelPreventDefaultX:!0,allowCache:!0,bufferEdgeX:100,bufferEdgeY:100}),i=new Qs($.VIEW_MAIN_LEFT_TOP,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:0,bufferEdgeY:0}),r=new Qs($.VIEW_MAIN_LEFT,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:0,bufferEdgeY:100}),o=new Qs($.VIEW_MAIN_TOP,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:100,bufferEdgeY:0}),a=new Qs($.VIEW_ROW_TOP,e,{active:!1,isWheelPreventDefaultX:!0}),l=new Qs($.VIEW_ROW_BOTTOM,e,{left:0,top:n.height,bottom:0,width:t.width+1,isWheelPreventDefaultX:!0}),u=new Qs($.VIEW_COLUMN_LEFT,e,{active:!1,isWheelPreventDefaultX:!0}),d=new Qs($.VIEW_COLUMN_RIGHT,e,{left:t.width,top:0,height:n.height+1,right:0,isWheelPreventDefaultX:!0}),c=new Qs($.VIEW_LEFT_TOP,e,{left:0,top:0,width:t.width,height:n.height,isWheelPreventDefaultX:!0});return{viewMain:s,viewLeftTop:c,viewMainLeftTop:i,viewMainLeft:r,viewMainTop:o,viewColumnLeft:u,viewRowTop:a,viewRowBottom:l,viewColumnRight:d}}_addViewport(e){const t=this._context.scene,{rowHeader:n,columnHeader:s}=e.getConfig(),{viewMain:i}=this._initViewports(t,n,s),r=this._configService.getConfig(Jt),o=r?.scrollConfig;return new Zm(i,o),t.attachControl(),i}_initRerenderScheduler(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{if(!e)return null;const{skeleton:t,sheetId:n}=e,s=this._context.unit,i=s?.getSheetBySheetId(n);if(s==null||i==null)return;const{mainComponent:r,components:o}=this._context,a=r,l=o.get(yt.ROW),u=o.get(yt.COLUMN),d=o.get(yt.LEFT_TOP),{rowHeaderWidth:c,columnHeaderHeight:h}=t;a?.updateSkeleton(t),l?.updateSkeleton(t),u?.updateSkeleton(t),d?.transformByState({width:c,height:h})}))}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{const{unit:t}=this._context,{id:n}=e;if(ap.includes(n)||this._sheetRenderService.checkMutationShouldTriggerRerender(n)){const s=e.params,{unitId:i,subUnitId:r}=s,o=t.getActiveSheet();if(!o)return;const a=this._context.unitId,l=o.getSheetId();if(i!==a||r!==l)return;this._sheetSkeletonManagerService.makeDirty({sheetId:l,commandId:n},!0),this._sheetSkeletonManagerService.setCurrent({sheetId:l,commandId:n})}else Vw.includes(n)&&this._sheetSkeletonManagerService.reCalculate();e.type===H.MUTATION&&this._markUnitDirty(e)}))}_markUnitDirty(e){if(e.id.substring(0,3)==="doc")return;const{mainComponent:t,scene:n}=this._context;if(e.id===R0.id&&e.params.stageInfo!=null||(t&&t.makeDirty(),n.makeDirty(),!e.params))return;const s=e.params,i=this._spreadsheetViewports(n);if(e.id===le.id&&s.cellValue){const r=this._cellValueToRange(s.cellValue),o=this._rangeToBounds([r]);this._markViewportDirty(i,o),t.setDirtyArea(o)}if(e.id===Mn.id&&s.from&&s.to){const r=s.fromRange||this._cellValueToRange(s.from.value),o=s.toRange||this._cellValueToRange(s.to.value),a=this._rangeToBounds([r,o]);this._markViewportDirty(i,a),t.setDirtyArea(a)}}_cellValueToRange(e){let t=0,n=0,s=0,i=0;for(const[r,o]of Object.entries(e)){for(const a in o)t>Number(a)&&(t=Number(a)),n<Number(a)&&(n=Number(a));s>Number(r)&&(s=Number(r)),i<Number(r)&&(i=Number(r))}return{startRow:s,endRow:i,startColumn:t,endColumn:n}}_rangeToBounds(e){const t=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{rowHeightAccumulation:n,columnWidthAccumulation:s,rowHeaderWidth:i,columnHeaderHeight:r}=t,o=[];for(const a of e){const{startRow:l,endRow:u,startColumn:d,endColumn:c}=a,h=l===0?0:n[l-1]+r,g=n[u]+r,m=d===0?0:s[d-1]+i,p=s[c]+i;o.push({top:h,left:m,bottom:g,right:p,width:p-m,height:g-h})}return o}_markViewportDirty(e,t){const n=e.filter(s=>s.isActive&&s.cacheBound);for(const s of n)for(const i of t)z.hasIntersectionBetweenTwoRect(s.cacheBound,i)&&s.markDirty(!0)}_spreadsheetViewports(e){return e.getViewports().filter(t=>["viewMain","viewMainLeftTop","viewMainTop","viewMainLeft"].includes(t.viewportKey))}};mc=H5([Ga(1,V(Lt)),Ga(2,V(Te)),Ga(3,V(ir)),Ga(4,U),Ga(5,Wc(ux))],mc);const W5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M0.98999 1.08218H-0.0100098V0.0821838H0.98999V1.08218Z"}),S.jsx("path",{d:"M5.78992 1.08218H2.78992V0.0821838H5.78992V1.08218Z"}),S.jsx("path",{d:"M7.58984 1.08218H8.58984V0.0821838H7.58984V1.08218Z"}),S.jsx("path",{d:"M14.9152 1.08218H13.9152V0.0821838H14.9152V1.08218Z"}),S.jsx("path",{d:"M16.7151 1.08218H19.7151V0.0821838H16.7151V1.08218Z"}),S.jsx("path",{d:"M22.515 1.08218H21.515V0.0821838H22.515V1.08218Z"}),S.jsx("path",{d:"M27.8405 1.08218H28.8405V0.0821838H27.8405V1.08218Z"}),S.jsx("path",{d:"M33.6404 1.08218H30.6404V0.0821838H33.6404V1.08218Z"}),S.jsx("path",{d:"M35.4403 1.08218H36.4403V0.0821838H35.4403V1.08218Z"}),S.jsx("path",{d:"M42.7657 1.08218H41.7657V0.0821838H42.7657V1.08218Z"}),S.jsx("path",{d:"M44.5657 1.08218H47.5657V0.0821838H44.5657V1.08218Z"}),S.jsx("path",{d:"M50.3656 1.08218H49.3656V0.0821838H50.3656V1.08218Z"}),S.jsx("path",{d:"M55.691 1.08218H56.691V0.0821838H55.691V1.08218Z"}),S.jsx("path",{d:"M61.491 1.08218H58.491V0.0821838H61.491V1.08218Z"}),S.jsx("path",{d:"M63.2909 1.08218H64.2909V0.0821838H63.2909V1.08218Z"}),S.jsx("path",{d:"M70.6163 1.08218H69.6163V0.0821838H70.6163V1.08218Z"}),S.jsx("path",{d:"M72.4163 1.08218H75.4163V0.0821838H72.4163V1.08218Z"}),S.jsx("path",{d:"M78.2162 1.08218H77.2162V0.0821838H78.2162V1.08218Z"}),S.jsx("path",{d:"M83.5416 1.08218H84.5416V0.0821838H83.5416V1.08218Z"}),S.jsx("path",{d:"M89.3416 1.08218H86.3416V0.0821838H89.3416V1.08218Z"}),S.jsx("path",{d:"M91.1415 1.08218H92.1415V0.0821838H91.1415V1.08218Z"}),S.jsx("path",{d:"M98.4669 1.08218H97.4669V0.0821838H98.4669V1.08218Z"}),S.jsx("path",{d:"M100.267 1.08218H103.267V0.0821838H100.267V1.08218Z"}),S.jsx("path",{d:"M106.067 1.08218H105.067V0.0821838H106.067V1.08218Z"}),S.jsx("path",{d:"M111.392 1.08218H112.392V0.0821838H111.392V1.08218Z"}),S.jsx("path",{d:"M117.192 1.08218H114.192V0.0821838H117.192V1.08218Z"}),S.jsx("path",{d:"M118.992 1.08218H119.992V0.0821838H118.992V1.08218Z"})]}),L5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.0100098 1.15771H0.98999V0.157715H-0.0100098V1.15771Z"}),S.jsx("path",{d:"M2.78992 1.15771H5.78992V0.157715H2.78992V1.15771Z"}),S.jsx("path",{d:"M8.58984 1.15771H7.58984V0.157715H8.58984V1.15771Z"}),S.jsx("path",{d:"M10.3899 1.15771H11.3899V0.157715H10.3899V1.15771Z"}),S.jsx("path",{d:"M19.0903 1.15771H18.0903V0.157715H19.0903V1.15771Z"}),S.jsx("path",{d:"M20.8903 1.15771H23.8903V0.157715H20.8903V1.15771Z"}),S.jsx("path",{d:"M26.6902 1.15771H25.6902V0.157715H26.6902V1.15771Z"}),S.jsx("path",{d:"M28.4902 1.15771H29.4902V0.157715H28.4902V1.15771Z"}),S.jsx("path",{d:"M37.1907 1.15771H36.1907V0.157715H37.1907V1.15771Z"}),S.jsx("path",{d:"M38.9906 1.15771H41.9906V0.157715H38.9906V1.15771Z"}),S.jsx("path",{d:"M44.7905 1.15771H43.7905V0.157715H44.7905V1.15771Z"}),S.jsx("path",{d:"M46.5906 1.15771H47.5906V0.157715H46.5906V1.15771Z"}),S.jsx("path",{d:"M55.291 1.15771H54.291V0.157715H55.291V1.15771Z"}),S.jsx("path",{d:"M57.0909 1.15771H60.0909V0.157715H57.0909V1.15771Z"}),S.jsx("path",{d:"M62.8909 1.15771H61.8909V0.157715H62.8909V1.15771Z"}),S.jsx("path",{d:"M64.6909 1.15771H65.6909V0.157715H64.6909V1.15771Z"}),S.jsx("path",{d:"M73.3914 1.15771H72.3914V0.157715H73.3914V1.15771Z"}),S.jsx("path",{d:"M75.1913 1.15771H78.1913V0.157715H75.1913V1.15771Z"}),S.jsx("path",{d:"M80.9912 1.15771H79.9912V0.157715H80.9912V1.15771Z"}),S.jsx("path",{d:"M82.7913 1.15771H83.7913V0.157715H82.7913V1.15771Z"}),S.jsx("path",{d:"M91.4917 1.15771H90.4917V0.157715H91.4917V1.15771Z"}),S.jsx("path",{d:"M93.2916 1.15771H96.2916V0.157715H93.2916V1.15771Z"}),S.jsx("path",{d:"M99.0916 1.15771H98.0916V0.157715H99.0916V1.15771Z"}),S.jsx("path",{d:"M100.892 1.15771H101.892V0.157715H100.892V1.15771Z"}),S.jsx("path",{d:"M109.592 1.15771H108.592V0.157715H109.592V1.15771Z"}),S.jsx("path",{d:"M111.392 1.15771H114.392V0.157715H111.392V1.15771Z"}),S.jsx("path",{d:"M117.192 1.15771H116.192V0.157715H117.192V1.15771Z"}),S.jsx("path",{d:"M118.992 1.15771H119.992V0.157715H118.992V1.15771Z"})]}),B5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.00842285 1.22449H2.99158V0.224487H-0.00842285V1.22449Z"}),S.jsx("path",{d:"M6.14941 1.22449H9.14941V0.224487H6.14941V1.22449Z"}),S.jsx("path",{d:"M15.3073 1.22449H12.3073V0.224487H15.3073V1.22449Z"}),S.jsx("path",{d:"M18.4651 1.22449H21.4651V0.224487H18.4651V1.22449Z"}),S.jsx("path",{d:"M27.6229 1.22449H24.6229V0.224487H27.6229V1.22449Z"}),S.jsx("path",{d:"M30.7808 1.22449H33.7808V0.224487H30.7808V1.22449Z"}),S.jsx("path",{d:"M39.9386 1.22449H36.9386V0.224487H39.9386V1.22449Z"}),S.jsx("path",{d:"M43.0964 1.22449H46.0964V0.224487H43.0964V1.22449Z"}),S.jsx("path",{d:"M52.2543 1.22449H49.2543V0.224487H52.2543V1.22449Z"}),S.jsx("path",{d:"M55.4121 1.22449H58.4121V0.224487H55.4121V1.22449Z"}),S.jsx("path",{d:"M64.5699 1.22449H61.5699V0.224487H64.5699V1.22449Z"}),S.jsx("path",{d:"M67.7278 1.22449H70.7278V0.224487H67.7278V1.22449Z"}),S.jsx("path",{d:"M76.8856 1.22449H73.8856V0.224487H76.8856V1.22449Z"}),S.jsx("path",{d:"M80.0435 1.22449H83.0435V0.224487H80.0435V1.22449Z"}),S.jsx("path",{d:"M89.2013 1.22449H86.2013V0.224487H89.2013V1.22449Z"}),S.jsx("path",{d:"M92.3591 1.22449H95.3591V0.224487H92.3591V1.22449Z"}),S.jsx("path",{d:"M101.517 1.22449H98.517V0.224487H101.517V1.22449Z"}),S.jsx("path",{d:"M104.675 1.22449H107.675V0.224487H104.675V1.22449Z"}),S.jsx("path",{d:"M113.833 1.22449H110.833V0.224487H113.833V1.22449Z"}),S.jsx("path",{d:"M116.99 1.22449H119.99V0.224487H116.99V1.22449Z"})]}),j5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"8",viewBox:"0 0 120 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 2.06215H-0.0090332V0.862152H119.991V1.86215Z"}),S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 6.66215H-0.0090332V5.86215H119.991V6.86215Z"})]}),F5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.00976562 1.65707H0.990234V0.657074H-0.00976562V1.65707Z"}),S.jsx("path",{d:"M2.32361 1.65707H3.32361V0.657074H2.32361V1.65707Z"}),S.jsx("path",{d:"M5.65698 1.65707H4.65698V0.657074H5.65698V1.65707Z"}),S.jsx("path",{d:"M6.99036 1.65707H7.99036V0.657074H6.99036V1.65707Z"}),S.jsx("path",{d:"M10.3237 1.65707H9.32373V0.657074H10.3237V1.65707Z"}),S.jsx("path",{d:"M11.6571 1.65707H12.6571V0.657074H11.6571V1.65707Z"}),S.jsx("path",{d:"M14.9905 1.65707H13.9905V0.657074H14.9905V1.65707Z"}),S.jsx("path",{d:"M16.3239 1.65707H17.3239V0.657074H16.3239V1.65707Z"}),S.jsx("path",{d:"M19.6572 1.65707H18.6572V0.657074H19.6572V1.65707Z"}),S.jsx("path",{d:"M20.9906 1.65707H21.9906V0.657074H20.9906V1.65707Z"}),S.jsx("path",{d:"M24.324 1.65707H23.324V0.657074H24.324V1.65707Z"}),S.jsx("path",{d:"M25.6573 1.65707H26.6573V0.657074H25.6573V1.65707Z"}),S.jsx("path",{d:"M28.9907 1.65707H27.9907V0.657074H28.9907V1.65707Z"}),S.jsx("path",{d:"M30.3241 1.65707H31.3241V0.657074H30.3241V1.65707Z"}),S.jsx("path",{d:"M33.6575 1.65707H32.6575V0.657074H33.6575V1.65707Z"}),S.jsx("path",{d:"M34.9908 1.65707H35.9908V0.657074H34.9908V1.65707Z"}),S.jsx("path",{d:"M38.3242 1.65707H37.3242V0.657074H38.3242V1.65707Z"}),S.jsx("path",{d:"M39.6576 1.65707H40.6576V0.657074H39.6576V1.65707Z"}),S.jsx("path",{d:"M42.991 1.65707H41.991V0.657074H42.991V1.65707Z"}),S.jsx("path",{d:"M44.3243 1.65707H45.3243V0.657074H44.3243V1.65707Z"}),S.jsx("path",{d:"M47.6577 1.65707H46.6577V0.657074H47.6577V1.65707Z"}),S.jsx("path",{d:"M48.9911 1.65707H49.9911V0.657074H48.9911V1.65707Z"}),S.jsx("path",{d:"M52.3245 1.65707H51.3245V0.657074H52.3245V1.65707Z"}),S.jsx("path",{d:"M53.6578 1.65707H54.6578V0.657074H53.6578V1.65707Z"}),S.jsx("path",{d:"M56.9912 1.65707H55.9912V0.657074H56.9912V1.65707Z"}),S.jsx("path",{d:"M58.3246 1.65707H59.3246V0.657074H58.3246V1.65707Z"}),S.jsx("path",{d:"M61.658 1.65707H60.658V0.657074H61.658V1.65707Z"}),S.jsx("path",{d:"M62.9913 1.65707H63.9913V0.657074H62.9913V1.65707Z"}),S.jsx("path",{d:"M66.3247 1.65707H65.3247V0.657074H66.3247V1.65707Z"}),S.jsx("path",{d:"M67.6581 1.65707H68.6581V0.657074H67.6581V1.65707Z"}),S.jsx("path",{d:"M70.9915 1.65707H69.9915V0.657074H70.9915V1.65707Z"}),S.jsx("path",{d:"M72.3248 1.65707H73.3248V0.657074H72.3248V1.65707Z"}),S.jsx("path",{d:"M75.6582 1.65707H74.6582V0.657074H75.6582V1.65707Z"}),S.jsx("path",{d:"M76.9916 1.65707H77.9916V0.657074H76.9916V1.65707Z"}),S.jsx("path",{d:"M80.325 1.65707H79.325V0.657074H80.325V1.65707Z"}),S.jsx("path",{d:"M81.6583 1.65707H82.6583V0.657074H81.6583V1.65707Z"}),S.jsx("path",{d:"M84.9917 1.65707H83.9917V0.657074H84.9917V1.65707Z"}),S.jsx("path",{d:"M86.3251 1.65707H87.3251V0.657074H86.3251V1.65707Z"}),S.jsx("path",{d:"M89.6584 1.65707H88.6584V0.657074H89.6584V1.65707Z"}),S.jsx("path",{d:"M90.9918 1.65707H91.9918V0.657074H90.9918V1.65707Z"}),S.jsx("path",{d:"M94.3252 1.65707H93.3252V0.657074H94.3252V1.65707Z"}),S.jsx("path",{d:"M95.6586 1.65707H96.6586V0.657074H95.6586V1.65707Z"}),S.jsx("path",{d:"M98.9919 1.65707H97.9919V0.657074H98.9919V1.65707Z"}),S.jsx("path",{d:"M100.325 1.65707H101.325V0.657074H100.325V1.65707Z"}),S.jsx("path",{d:"M103.659 1.65707H102.659V0.657074H103.659V1.65707Z"}),S.jsx("path",{d:"M104.992 1.65707H105.992V0.657074H104.992V1.65707Z"}),S.jsx("path",{d:"M108.325 1.65707H107.325V0.657074H108.325V1.65707Z"}),S.jsx("path",{d:"M109.659 1.65707H110.659V0.657074H109.659V1.65707Z"}),S.jsx("path",{d:"M112.992 1.65707H111.992V0.657074H112.992V1.65707Z"}),S.jsx("path",{d:"M114.325 1.65707H115.325V0.657074H114.325V1.65707Z"}),S.jsx("path",{d:"M117.659 1.65707H116.659V0.657074H117.659V1.65707Z"}),S.jsx("path",{d:"M118.992 1.65707H119.992V0.657074H118.992V1.65707Z"})]}),z5=({className:e})=>S.jsx("svg",{className:e,width:"120",height:"3",viewBox:"0 0 120 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 2.42035H-0.0090332V0.420349H119.991V2.42035Z"})}),X5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"3",viewBox:"0 0 120 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.0100098 2.47614H1.98999V0.476135H-0.0100098V2.47614Z"}),S.jsx("path",{d:"M3.99014 2.47614H9.99014V0.476135H3.99014V2.47614Z"}),S.jsx("path",{d:"M13.9901 2.47614H11.9901V0.476135H13.9901V2.47614Z"}),S.jsx("path",{d:"M21.1904 2.47614H23.1904V0.476135H21.1904V2.47614Z"}),S.jsx("path",{d:"M31.1906 2.47614H25.1906V0.476135H31.1906V2.47614Z"}),S.jsx("path",{d:"M33.1906 2.47614H35.1906V0.476135H33.1906V2.47614Z"}),S.jsx("path",{d:"M44.3909 2.47614H42.3909V0.476135H44.3909V2.47614Z"}),S.jsx("path",{d:"M46.391 2.47614H52.391V0.476135H46.391V2.47614Z"}),S.jsx("path",{d:"M56.391 2.47614H54.391V0.476135H56.391V2.47614Z"}),S.jsx("path",{d:"M63.5913 2.47614H65.5913V0.476135H63.5913V2.47614Z"}),S.jsx("path",{d:"M73.5915 2.47614H67.5915V0.476135H73.5915V2.47614Z"}),S.jsx("path",{d:"M75.5915 2.47614H77.5915V0.476135H75.5915V2.47614Z"}),S.jsx("path",{d:"M86.7917 2.47614H84.7917V0.476135H86.7917V2.47614Z"}),S.jsx("path",{d:"M88.7919 2.47614H94.7919V0.476135H88.7919V2.47614Z"}),S.jsx("path",{d:"M98.7919 2.47614H96.7919V0.476135H98.7919V2.47614Z"}),S.jsx("path",{d:"M105.992 2.47614H107.992V0.476135H105.992V2.47614Z"}),S.jsx("path",{d:"M115.992 2.47614H109.992V0.476135H115.992V2.47614Z"}),S.jsx("path",{d:"M117.992 2.47614H119.992V0.476135H117.992V2.47614Z"})]}),Y5=({className:e})=>S.jsxs("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.0100098 2.00415H1.98999V0.00415039H-0.0100098V2.00415Z"}),S.jsx("path",{d:"M3.99014 2.00415H9.99014V0.00415039H3.99014V2.00415Z"}),S.jsx("path",{d:"M13.9901 2.00415H11.9901V0.00415039H13.9901V2.00415Z"}),S.jsx("path",{d:"M15.9901 2.00415H17.9901V0.00415039H15.9901V2.00415Z"}),S.jsx("path",{d:"M27.4905 2.00415H25.4905V0.00415039H27.4905V2.00415Z"}),S.jsx("path",{d:"M29.4906 2.00415H35.4906V0.00415039H29.4906V2.00415Z"}),S.jsx("path",{d:"M39.4906 2.00415H37.4906V0.00415039H39.4906V2.00415Z"}),S.jsx("path",{d:"M41.4906 2.00415H43.4906V0.00415039H41.4906V2.00415Z"}),S.jsx("path",{d:"M52.991 2.00415H50.991V0.00415039H52.991V2.00415Z"}),S.jsx("path",{d:"M54.9911 2.00415H60.9911V0.00415039H54.9911V2.00415Z"}),S.jsx("path",{d:"M64.9911 2.00415H62.9911V0.00415039H64.9911V2.00415Z"}),S.jsx("path",{d:"M66.9911 2.00415H68.9911V0.00415039H66.9911V2.00415Z"}),S.jsx("path",{d:"M78.4915 2.00415H76.4915V0.00415039H78.4915V2.00415Z"}),S.jsx("path",{d:"M80.4916 2.00415H86.4916V0.00415039H80.4916V2.00415Z"}),S.jsx("path",{d:"M90.4916 2.00415H88.4916V0.00415039H90.4916V2.00415Z"}),S.jsx("path",{d:"M92.4916 2.00415H94.4916V0.00415039H92.4916V2.00415Z"}),S.jsx("path",{d:"M103.992 2.00415H101.992V0.00415039H103.992V2.00415Z"}),S.jsx("path",{d:"M105.992 2.00415H111.992V0.00415039H105.992V2.00415Z"}),S.jsx("path",{d:"M115.992 2.00415H113.992V0.00415039H115.992V2.00415Z"}),S.jsx("path",{d:"M117.992 2.00415H119.992V0.00415039H117.992V2.00415Z"})]}),Z5=({className:e})=>S.jsxs("svg",{className:e,width:"118",height:"3",viewBox:"0 0 118 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[S.jsx("path",{d:"M-0.00854492 2.94815H1.99146V0.948151H-0.00854492V2.94815Z"}),S.jsx("path",{d:"M6.09668 2.94815H8.09668V0.948151H6.09668V2.94815Z"}),S.jsx("path",{d:"M14.2019 2.94815H12.2019V0.948151H14.2019V2.94815Z"}),S.jsx("path",{d:"M18.3071 2.94815H20.3071V0.948151H18.3071V2.94815Z"}),S.jsx("path",{d:"M26.4124 2.94815H24.4124V0.948151H26.4124V2.94815Z"}),S.jsx("path",{d:"M30.5176 2.94815H32.5176V0.948151H30.5176V2.94815Z"}),S.jsx("path",{d:"M38.6228 2.94815H36.6228V0.948151H38.6228V2.94815Z"}),S.jsx("path",{d:"M42.728 2.94815H44.728V0.948151H42.728V2.94815Z"}),S.jsx("path",{d:"M50.8333 2.94815H48.8333V0.948151H50.8333V2.94815Z"}),S.jsx("path",{d:"M54.9385 2.94815H56.9385V0.948151H54.9385V2.94815Z"}),S.jsx("path",{d:"M63.0437 2.94815H61.0437V0.948151H63.0437V2.94815Z"}),S.jsx("path",{d:"M67.1489 2.94815H69.1489V0.948151H67.1489V2.94815Z"}),S.jsx("path",{d:"M75.2542 2.94815H73.2542V0.948151H75.2542V2.94815Z"}),S.jsx("path",{d:"M79.3594 2.94815H81.3594V0.948151H79.3594V2.94815Z"}),S.jsx("path",{d:"M87.4645 2.94815H85.4645V0.948151H87.4645V2.94815Z"}),S.jsx("path",{d:"M91.5697 2.94815H93.5697V0.948151H91.5697V2.94815Z"}),S.jsx("path",{d:"M99.6749 2.94815H97.6749V0.948151H99.6749V2.94815Z"}),S.jsx("path",{d:"M103.78 2.94815H105.78V0.948151H103.78V2.94815Z"}),S.jsx("path",{d:"M111.885 2.94815H109.885V0.948151H111.885V2.94815Z"}),S.jsx("path",{d:"M115.991 2.94815H117.991V0.948151H115.991V2.94815Z"})]}),G5=({className:e})=>S.jsx("svg",{className:e,width:"120",height:"4",viewBox:"0 0 120 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 3.86215H-0.0090332V0.862152H119.991V3.86215Z"})}),q5=({className:e})=>S.jsx("svg",{className:e,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:S.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 1.15668H-0.0090332V0.156677H119.991V1.15668Z"})});function IC(e){const{type:t=tt.THIN,className:n}=e;switch(t){case tt.DASH_DOT:return S.jsx(W5,{className:n});case tt.DASH_DOT_DOT:return S.jsx(L5,{className:n});case tt.DASHED:return S.jsx(B5,{className:n});case tt.HAIR:return S.jsx(F5,{className:n});case tt.MEDIUM:return S.jsx(z5,{className:n});case tt.MEDIUM_DASH_DOT:return S.jsx(X5,{className:n});case tt.MEDIUM_DASH_DOT_DOT:return S.jsx(Y5,{className:n});case tt.MEDIUM_DASHED:return S.jsx(Z5,{className:n});case tt.THICK:return S.jsx(G5,{className:n});case tt.DOUBLE:return S.jsx(j5,{className:n});case tt.THIN:default:return S.jsx(q5,{className:n})}}const Q5=[{label:tt.THIN,value:tt.THIN},{label:tt.HAIR,value:tt.HAIR},{label:tt.DOTTED,value:tt.DOTTED},{label:tt.DASHED,value:tt.DASHED},{label:tt.DASH_DOT,value:tt.DASH_DOT},{label:tt.DASH_DOT_DOT,value:tt.DASH_DOT_DOT},{label:tt.MEDIUM,value:tt.MEDIUM},{label:tt.MEDIUM_DASHED,value:tt.MEDIUM_DASHED},{label:tt.MEDIUM_DASH_DOT,value:tt.MEDIUM_DASH_DOT},{label:tt.MEDIUM_DASH_DOT_DOT,value:tt.MEDIUM_DASH_DOT_DOT},{label:tt.THICK,value:tt.THICK},{label:tt.DOUBLE,value:tt.DOUBLE}];function K5(e){var t;if(e)for(const n in e){const s=e[n];if((t=s?.cl)!=null&&t.rgb)return s.cl.rgb}}function $5(e){var t;if(e)for(const n in e){const s=e[n];if((t=s?.cl)!=null&&t.rgb)return s.s}}function w1(e){var t;const n=G(Tn),s=G(pi),i=G(q),{isAllValuesSame:r,value:o}=i.getCellStylesProperty("bd"),a=r?K5(o):void 0,l=r?$5(o):void 0,{onChange:u,value:d}=e;function c(g,m){u?.({...d,[m]:g})}function h(g){const m=n.get(g);return m&&S.jsx(m,{className:"univer-fill-primary-600"})}return S.jsxs("section",{className:"univer-box-border univer-grid univer-gap-2 univer-p-1.5",children:[S.jsx("div",{className:"univer-box-border univer-grid univer-grid-cols-5 univer-gap-2 univer-text-gray-600 dark:!univer-text-gray-200",children:n1.map(g=>S.jsx("a",{className:Ke("univer-flex univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-justify-self-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",{"univer-bg-gray-200 dark:!univer-bg-gray-600":s.getBorderInfo().type===g.value}),onClick:m=>{m.stopPropagation(),c(g.value,"type")},children:h(g.icon)},g.value))}),S.jsx(m0,{}),S.jsxs("div",{className:"univer-flex univer-items-center univer-gap-2",children:[S.jsx("div",{children:S.jsx($g,{overlay:S.jsx("div",{className:"univer-rounded-lg univer-p-4",children:S.jsx(ww,{value:a,onChange:g=>c(g,"color")})}),children:S.jsxs("button",{className:"univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",type:"button",children:[S.jsx(Ab,{className:"univer-fill-primary-600 dark:!univer-text-white",extend:{colorChannel1:(t=d?.color)!=null?t:""}}),S.jsx(ua,{className:"dark:!univer-text-white"})]})})}),S.jsx("div",{children:S.jsx($g,{overlay:S.jsx("section",{className:"univer-rounded-lg univer-p-1.5",children:S.jsx("ul",{className:"univer-m-0 univer-grid univer-list-none univer-gap-1 univer-p-0",children:Q5.map(g=>S.jsxs("li",{className:"univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-px-1 univer-py-3 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",onClick:()=>c(g.value,"style"),children:[g.value===l&&S.jsx(mo,{className:"univer-absolute univer-left-3 univer-text-primary-600"}),S.jsx(IC,{className:"univer-ml-6 univer-fill-gray-900 dark:!univer-fill-white",type:g.value})]},g.value))})}),children:S.jsxs("button",{className:"univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",type:"button",children:[S.jsx(IC,{className:"univer-fill-gray-900 dark:!univer-fill-white",type:l??tt.THIN}),S.jsx(ua,{className:"dark:!univer-text-white"})]})})})]})]})}const Af="sheets.component.cell-popup";var J5=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},wr=(e,t)=>(n,s)=>t(n,s,e);let ha=class extends ae{constructor(e,t,n,s,i,r,o){super(),y(this,"_popupMenuFeatureMap",new Map),y(this,"_popupMenuOffsetMap",new Map),y(this,"_isSelectionMoving",!1),this._globalPopupManagerService=e,this._renderManagerService=t,this._univerInstanceService=n,this._refRangeService=s,this._commandService=i,this._refSelectionsService=r,this._selectionManagerService=o,this._initMoving()}_initMoving(){this.disposeWithMe(this._refSelectionsService.selectionMoving$.subscribe(()=>{this._isSelectionMoving=!0})),this.disposeWithMe(this._refSelectionsService.selectionMoveEnd$.subscribe(()=>{this._isSelectionMoving=!1})),this.disposeWithMe(this._selectionManagerService.selectionMoving$.subscribe(()=>{this._isSelectionMoving=!0})),this.disposeWithMe(this._selectionManagerService.selectionMoveEnd$.subscribe(()=>{this._isSelectionMoving=!1}))}registerFeatureMenu(e,t){this._popupMenuFeatureMap.set(e,t)}registerFeatureMenuOffset(e,t,n){this._popupMenuOffsetMap.set(e,{offsetX:t,offsetY:n})}getFeatureMenu(e,t,n,s){const i=this._popupMenuFeatureMap.get(s);if(i)return i(e,t,n,s)}dispose(){super.dispose(),this._popupMenuFeatureMap.clear(),this._popupMenuOffsetMap.clear()}_createHiddenRectObserver(e){const{row:t,column:n,worksheet:s,skeleton:i,currentRender:r}=e,o=()=>{var d,c;const h=s.getFreeze(),{startRow:g,startColumn:m,xSplit:p,ySplit:f}=h,v=g-f,C=m-p,{rowHeightAccumulation:w,columnWidthAccumulation:b,rowHeaderWidth:I,columnHeaderHeight:_}=i,R=I+(C===-1?0:b[C+p-1]-((d=b[C-1])!=null?d:0)),M=_+(v===-1?0:w[v+f-1]-((c=w[v])!=null?c:0)),x=r.engine.getCanvasElement(),N=x.getBoundingClientRect(),T=Pg(x.style.width),O=N.width/T,k=r.scene.getAncestorScale().scaleX,D=R*O*k,B=M*O*k,W={left:-1/0,top:-1/0,right:N.left+D,bottom:N.top+B},F={left:N.left+D,top:-1/0,right:1/0,bottom:N.top+B},K={left:-1/0,top:N.top+B,right:N.left+D,bottom:1/0};return t<g&&n<m?[]:t<g?[W]:n<m?[W]:[W,F,K]},a=o(),l=new xe(a),u=new Et;return u.add(this._commandService.onCommandExecuted(d=>{d.id===wn.id&&l.next(o())})),u.add(fd(r.engine.onTransformChange$).pipe(wd(16)).subscribe(()=>{l.next(o())})),{rects$:l,disposable:u}}_createPositionObserver(e,t,n,s){const i=()=>{const{scene:l}=t,u=Ik(e,l,n,s),d=t.engine.getCanvasElement(),c=d.getBoundingClientRect(),h=Pg(d.style.width),g=c.width/h;return{left:u.left*g+c.left,right:u.right*g+c.left,top:u.top*g+c.top,bottom:u.bottom*g+c.top}},r=i(),o=new xe(r),a=new Et;return a.add(this._commandService.onCommandExecuted(l=>{Ug(l.id)&&o.next(i())})),{position:r,position$:o,disposable:a}}attachPopupToObject(e,t){var n;const s=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),i=s.getActiveSheet();if(!i||this._isSelectionMoving&&!t.showOnSelectionMoving)return{dispose:()=>{},canDispose:()=>!0};const r=s.getUnitId(),o=i.getSheetId(),a=(n=this._renderManagerService.getRenderById(r))==null?void 0:n.with(Te).ensureSkeleton(o),l=this._renderManagerService.getRenderById(r);if(!l||!a)return{dispose:()=>{},canDispose:()=>!0};const{left:u,top:d,width:c,height:h}=e;let g=0,m=0,p;if(e.classType===fw.SHAPE&&(p=e.getPropByKey("drawingType")),p!==void 0&&this._popupMenuOffsetMap.has(p)){const I=this._popupMenuOffsetMap.get(p);g=I.offsetX,m=I.offsetY}const f={left:u,right:u+c+g,top:d+m,bottom:d+h},{position:v,position$:C,disposable:w}=this._createPositionObserver(f,l,a,i),b=this._globalPopupManagerService.addPopup({...t,unitId:r,subUnitId:o,anchorRect:v,anchorRect$:C,canvasElement:l.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(b),C.complete(),w.dispose()},canDispose:()=>this._globalPopupManagerService.activePopupId!==b}}attachPopupByPosition(e,t,n){var s;let i=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),r=i.getActiveSheet();if(!r)return null;const o=i.getUnitId(),a=r.getSheetId();if(o!==n.unitId||n.subUnitId!==a)return null;if(this._isSelectionMoving&&!t.showOnSelectionMoving)return;const l=(s=this._renderManagerService.getRenderById(o))==null?void 0:s.with(Te).getOrCreateSkeleton({sheetId:a}),u=this._renderManagerService.getRenderById(o);if(!u||!l)return null;const{position:d,position$:c,disposable:h}=this._createPositionObserver(e,u,l,r),{rects$:g,disposable:m}=this._createHiddenRectObserver({row:n.row,column:n.col,worksheet:r,skeleton:l,currentRender:u}),p=this._globalPopupManagerService.addPopup({...t,unitId:o,subUnitId:a,anchorRect:d,anchorRect$:c,hiddenRects$:g,canvasElement:u.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(p),c.complete(),h.dispose(),m.dispose(),i=null,r=null},canDispose:()=>this._globalPopupManagerService.activePopupId!==p}}attachPopupToAbsolutePosition(e,t,n,s){var i;const r=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),o=r.getActiveSheet();if(!o)return null;const a=r.getUnitId(),l=o.getSheetId();if(n&&a!==n||s&&s!==l)return null;const u=(i=this._renderManagerService.getRenderById(a))==null?void 0:i.with(Te).ensureSkeleton(l),d=this._renderManagerService.getRenderById(a);if(!d||!u)return null;if(this._isSelectionMoving&&!t.showOnSelectionMoving)return;const c=new xe(e),h=this._globalPopupManagerService.addPopup({...t,unitId:a,subUnitId:l,anchorRect:e,anchorRect$:c.asObservable(),canvasElement:d.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(h),c.complete()},canDispose:()=>this._globalPopupManagerService.activePopupId!==h}}attachPopupToCell(e,t,n,s,i,r){let o=s?this._univerInstanceService.getUnit(s):this._univerInstanceService.getCurrentUnitOfType(A.UNIVER_SHEET);if(!o)return null;let a=i?o.getSheetBySheetId(i):o.getActiveSheet();if(!a)return null;const l=o.getUnitId(),u=a.getSheetId(),d=this._renderManagerService.getRenderById(l),c=d?.with(Te).ensureSkeleton(u),h=d?.with(Zt);if(!d||!c||!h)return null;if(this._isSelectionMoving&&!n.showOnSelectionMoving)return;const g=r??Kv(e,t,d.scene,a);if(!g)return null;const{position:m,position$:p,disposable:f,updateRowCol:v}=this._createCellPositionObserver(e,t,d,c,g),{rects$:C,disposable:w}=this._createHiddenRectObserver({row:e,column:t,worksheet:a,skeleton:c,currentRender:d}),b=this._globalPopupManagerService.addPopup({...n,unitId:l,subUnitId:u,anchorRect:m,anchorRect$:p,canvasElement:d.engine.getCanvasElement(),hiddenRects$:C}),I=new Et;I.add(f),I.add(He(()=>{this._globalPopupManagerService.removePopup(b),p.complete()})),I.add(w);const _={startRow:e,endRow:e,startColumn:t,endColumn:t};return I.add(this._refRangeService.watchRange(l,u,_,(R,M)=>{M?v(M.startRow,M.startColumn):I.dispose()})),{dispose(){I.dispose(),a=null,o=null},canDispose:()=>this._globalPopupManagerService.activePopupId!==b}}attachRangePopup(e,t,n,s,i,r=!1){const o=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),a=o.getActiveSheet();if(!a)return null;const l=o.getUnitId(),u=a.getSheetId();if(n&&l!==n||s&&u!==s)return null;const d=this._renderManagerService.getRenderById(l),c=d?.with(Te).getOrCreateSkeleton({sheetId:u}),h=d?.with(Zt);if(!d||!c||!h)return null;if(h.selectionMoving&&!r)return;const g=i??Kv(e.startRow,e.startColumn,d.scene,a);if(!g)return null;const{position:m,position$:p,disposable:f,updateRange:v,topLeftPos$:C,rightBottomPos$:w}=this._createRangePositionObserver(e,d,c,g),{rects$:b,disposable:I}=this._createHiddenRectObserver({row:e.startRow,column:e.startColumn,worksheet:a,skeleton:c,currentRender:d}),_=this._globalPopupManagerService.addPopup({...t,unitId:l,subUnitId:u,anchorRect:m,anchorRect$:p,canvasElement:d.engine.getCanvasElement(),hiddenRects$:b}),R=new Et;R.add(f),R.add(He(()=>{this._globalPopupManagerService.removePopup(_),C.complete(),w.complete()})),R.add(I);const M={...e};return R.add(this._refRangeService.watchRange(l,u,M,(x,N)=>{N?v(N):R.dispose()})),{dispose(){R.dispose()},canDispose:()=>this._globalPopupManagerService.activePopupId!==_}}_createCellPositionObserver(e,t,n,s,i){let r=e,o=t;const a=this._calcCellPositionByCell(r,o,n,s,i),l=new xe(a),u=()=>l.next(this._calcCellPositionByCell(r,o,n,s,i)),d=new Et;return d.add(n.engine.clientRect$.subscribe(()=>u())),d.add(fd(n.engine.onTransformChange$).pipe(wd(16)).subscribe(()=>u())),d.add(this._commandService.onCommandExecuted(c=>{if(c.id===ds.id&&c.params.rowsAutoHeightInfo.findIndex(h=>h.row===r)>-1){u();return}Ug(c.id)&&u()})),{position$:l,disposable:d,position:a,updateRowCol:(c,h)=>{r=c,o=h,u()}}}_calcCellPositionByCell(e,t,n,s,i){const{scene:r,engine:o}=n;if(s._disposed||r._disposed)return{left:0,right:0,top:0,bottom:0};const a=s.getCellWithCoordByIndex(e,t),l=a.isMergedMainCell?a.mergeInfo:a,{scaleX:u,scaleY:d}=r.getAncestorScale(),c={x:i.viewportScrollX,y:i.viewportScrollY},h=o.getCanvasElement();if(!h)return{left:0,right:0,top:0,bottom:0};const g=h.getBoundingClientRect(),m=Pg(h.style.width),{top:p,left:f,width:v}=g,C=v/m;return{left:(l.startX-c.x)*C*u+f,right:(l.endX-c.x)*C*u+f,top:(l.startY-c.y)*C*d+p,bottom:(l.endY-c.y)*C*d+p}}_createRangePositionObserver(e,t,n,s){let{startRow:i,startColumn:r,endRow:o,endColumn:a}=e;const l=this._calcCellPositionByCell(i,r,t,n,s),u=new xe(l),d=this._calcCellPositionByCell(o,a,t,n,s),c=new xe(d),h=()=>{const v=this._calcCellPositionByCell(i,r,t,n,s),C=this._calcCellPositionByCell(o,a,t,n,s);u.next(v),c.next(C)},g=new Et;g.add(t.engine.clientRect$.subscribe(()=>h())),g.add(this._commandService.onCommandExecuted(v=>{if(v.id===ds.id&&v.params.rowsAutoHeightInfo.findIndex(C=>C.row===i)>-1){h();return}Ug(v.id)&&h()}));const m=v=>{i=v.startRow,r=v.startColumn,o=v.endRow,a=v.endColumn,h()},p=u.pipe(Se(v=>{const C=this._calcCellPositionByCell(o,a,t,n,s);return{top:v.top,left:v.left,right:C.right,bottom:C.bottom}})),f={top:l.top,left:l.left,right:d.right,bottom:d.bottom};return{position$:p,position:f,updateRange:m,topLeftPos$:u,rightBottomPos$:c,disposable:g}}};ha=J5([wr(0,V(KI)),wr(1,ze),wr(2,P),wr(3,V(Ar)),wr(4,U),wr(5,$c),wr(6,V(q))],ha);function Pg(e){return Number.parseInt(e.replace("px",""))}const e3=new Set([mr.id,Mi.id,me.id]);function Ug(e){return e3.has(e)||ap.includes(e)}var t3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},n3=(e,t)=>(n,s)=>t(n,s,e);let $r=class extends ae{constructor(e){super(),y(this,"_cellPopupMap",new Map),y(this,"_change$",new Ve),y(this,"change$",this._change$.asObservable()),this._sheetCanvasPopManagerService=e}_ensureCellPopupMap(e,t){let n=this._cellPopupMap.get(e);n||(n=new Map,this._cellPopupMap.set(e,n));let s=n.get(t);return s||(s=new de,n.set(t,s)),s}showPopup(e,t){var n,s;const{direction:i="horizontal"}=t,{unitId:r,subUnitId:o,row:a,col:l}=e,u=this._ensureCellPopupMap(r,o),d=(n=u.getValue(a,l))==null?void 0:n[i];t.id=(s=t.id)!=null?s:hn();const c=()=>{var h;const g=u.getValue(a,l);if(!g)return;const m=g[i];if(!m)return;const p=m?.popups.findIndex(f=>f.id===t.id&&f.componentKey===t.componentKey);m?.popups.splice(p,1),m.popups.length===0&&((h=m.disposable)==null||h.dispose(),g[i]=void 0),this._change$.next({...e,direction:i})};if(d)d.popups.push(t),d.popups.sort((h,g)=>h.priority-g.priority);else{const h=this._sheetCanvasPopManagerService.attachPopupToCell(a,l,{...t,direction:i,componentKey:Af,extraProps:{...e,direction:i},noPushMinimumGap:!0,autoRelayout:!1,zIndex:90},r,o);u.setValue(a,l,{...u.getValue(a,l),[i]:{disposable:h,popups:[t]}})}return this._change$.next({...e,direction:i}),He(c)}getPopups(e,t,n,s,i){var r,o;return((o=(r=this._ensureCellPopupMap(e,t).getValue(n,s))==null?void 0:r[i])==null?void 0:o.popups)||[]}hidePopup(e,t,n,s){var i,r;const o=this._ensureCellPopupMap(e,t),a=o.getValue(n,s);a&&(a.horizontal&&((i=a.horizontal.disposable)==null||i.dispose(),a.horizontal=void 0,this._change$.next({unitId:e,subUnitId:t,row:n,col:s,direction:"horizontal"})),a.vertical&&((r=a.vertical.disposable)==null||r.dispose(),a.vertical=void 0,this._change$.next({unitId:e,subUnitId:t,row:n,col:s,direction:"vertical"})),!a.horizontal&&!a.vertical&&o.realDeleteValue(n,s))}};$r=t3([n3(0,V(ha))],$r);const S1=e=>{const{popup:t}=e,n=t.extraProps,{row:s,col:i,direction:r,unitId:o,subUnitId:a}=n,l=G($r);zt(L.useMemo(()=>l.change$.pipe(Wt(c=>c.row===s&&c.col===i&&c.direction===r)),[l,s,i,r]));const u=l.getPopups(o,a,s,i,r),d=G(Tn);return S.jsx("div",{"data-u-comp":"cell-popup",className:"univer-ml-px univer-flex univer-flex-col",children:u.map(c=>{var h;const g=d.get(c.componentKey);return g?S.jsx(g,{popup:c},(h=c.id)!=null?h:c.componentKey):null})})},RC=e=>{const{inputId:t,state:n=!1,type:s="range",confirm:i,cancel:r,name:o,formulaOrRefString:a,comment:l="",localSheetId:u=nr,hidden:d=!1,id:c}=e,h=G(P).getCurrentUnitForType(A.UNIVER_SHEET),g=G(Oe),m=G(wi),p=G(M0),f=G(Rw),v=G(Zc),C=G(Tn),w=L.useMemo(()=>C.get(JS),[]),b=L.useMemo(()=>C.get(uf),[]);if(h==null)return;const I=L.useMemo(()=>h.getUnitId(),[]),_=L.useMemo(()=>h.getActiveSheet().getSheetId(),[]),[R,M]=L.useState(o),[x,N]=L.useState(a),[T,O]=L.useState(l),[k,D]=L.useState(u),[B,W]=L.useState(""),[F,K]=L.useState(s),[J,ee]=L.useState(!0),we=[{label:g.t("definedName.scopeWorkbook"),value:nr}],Ge=ke=>!Iw(ke);L.useEffect(()=>{ee(!0),M(o),O(l),D(u);let ke=a;a.substring(0,1)===Ir.EQUALS?K("formula"):Ge(a)?(K("formula"),ke=Ir.EQUALS+a):K("range"),N(ke),W("")},[n]),h.getSheetOrders().forEach(ke=>{const Ye=h.getSheetBySheetId(ke);we.push({label:Ye?.getName()||"",value:ke})});const Ae=ke=>{N(ke)},Ze=ke=>{N(ke||"")},ue=()=>{if(R.length===0){W(g.t("definedName.nameEmpty"));return}if((m.getValueByName(I,R)||p.hasTable(I,R))&&(c==null||c.length===0)){W(g.t("definedName.nameDuplicate"));return}if(!Q.isValidParameter(R)||yw(R)||!Q.isStartValidPosition(R)&&!a0(R.substring(0,1))){W(g.t("definedName.nameInvalid"));return}if(h.getSheetOrders().map(Ye=>{var Ot;return((Ot=h.getSheetBySheetId(Ye))==null?void 0:Ot.getName())||""}).includes(R)){W(g.t("definedName.nameSheetConflict"));return}if(x.length===0){W(g.t("definedName.formulaOrRefStringEmpty"));return}if(!J){W(g.t("definedName.formulaOrRefStringInvalid"));return}if(f.hasExecutor(R.toUpperCase())){W(g.t("definedName.nameConflict"));return}const ke=h.getActiveSheet().getName();i&&i({id:c||"",name:R,formulaOrRefString:v.convertRefersToAbsolute(x,Cd.ALL,Cd.ALL,ke),comment:T,localSheetId:k})},ge=ke=>{const Ye=ke;Ye==="formula"?a[0]===Ir.EQUALS?N(a):N(`${Ir.EQUALS}`):a[0]===Ir.EQUALS?N(""):N(a),K(Ye)},be=L.useRef(null),[Ue,Rt]=L.useState(!1);return gw(ke=>{var Ye;(Ye=be.current)!=null&&Ye.isClickOutSide(ke)&&Rt(!1)}),S.jsxs("div",{className:Ke("univer-grid univer-space-y-2 univer-pb-1",$m,{"univer-hidden":!n}),children:[S.jsx("div",{children:S.jsx(_d,{className:"univer-w-full",placeholder:g.t("definedName.inputNamePlaceholder"),value:R,allowClear:!0,onChange:M})}),S.jsx("div",{children:S.jsxs(Jg,{value:F,onChange:ge,children:[S.jsx(Mo,{value:"range",children:g.t("definedName.ratioRange")}),S.jsx(Mo,{value:"formula",children:g.t("definedName.ratioFormula")})]})}),F==="range"?w&&S.jsx(w,{unitId:I,subUnitId:_,initialValue:x,onChange:(ke,Ye)=>Ae(Ye),supportAcrossSheet:!0}):b&&S.jsx("div",{className:"univer-relative univer-mt-4 univer-h-full",children:S.jsx("div",{className:"univer-relative univer-h-8 univer-select-none",children:S.jsx(b,{ref:be,className:Ke("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",Ra),initValue:x,unitId:I,subUnitId:_,isFocus:Ue,isSupportAcrossSheet:!0,onChange:(ke="")=>{Ze(ke||"")},onVerify:ke=>{ee(ke)},onFocus:()=>Rt(!0)})})}),S.jsx("div",{children:S.jsx(bw,{className:"univer-w-full",value:k,options:we,onChange:D})}),S.jsx("div",{children:S.jsx(_d,{className:"univer-w-full",placeholder:g.t("definedName.inputCommentPlaceholder"),value:T,onChange:O,allowClear:!0})}),S.jsxs("div",{className:Ke("univer-items-center univer-gap-1 univer-text-sm univer-text-red-500",{"univer-hidden":B.length===0,"univer-flex":B.length!==0}),children:[S.jsx("span",{children:B}),S.jsx(Mf,{})]}),S.jsxs("div",{className:"univer-flex univer-gap-2",children:[S.jsx(us,{onClick:()=>{r?.()},children:g.t("definedName.cancel")}),S.jsx(us,{variant:"primary",onClick:ue,children:g.t("definedName.confirm")})]})]})},b1=()=>{const e=G(U),t=G(P),n=G(Oe),s=G(wi),i=G(q),r=t.getCurrentUnitOfType(A.UNIVER_SHEET),o=r?.getUnitId(),a=()=>{if(!o)return[];const T=s.getDefinedNameMap(o);return T?Array.from(Object.values(T)):[]},[l,u]=L.useState(!1),[d,c]=L.useState([]),[h,g]=L.useState(null),[m,p]=L.useState();if(L.useEffect(()=>{c(a());const T=s.update$.subscribe(()=>{c(a())});return()=>{T.unsubscribe()}},[]),!r||!o)return;const f=T=>{const{name:O,formulaOrRefString:k,comment:D,localSheetId:B,hidden:W}=T;let F=T.id;if(F==null||F.length===0)F=hn(10),e.executeCommand(PS.id,{id:F,unitId:o,name:O,formulaOrRefString:k,comment:D,localSheetId:B,hidden:W});else{const K={id:F,unitId:o,name:O,formulaOrRefString:k,comment:D,localSheetId:B,hidden:W};e.executeCommand(qo.id,K)}u(!1),g(null)},v=T=>{p(T)};function C(){p(null)}function w(T){if(!o)return;const O=s.getValueById(o,T);e.executeCommand(oh.id,{...O,unitId:o}),p(null)}const b=async T=>{const{formulaOrRefString:O,id:k}=T,D=s.getWorksheetByRef(o,O);D&&(D.isSheetHidden()&&await e.executeCommand(uo.id,{unitId:o,subUnitId:D.getSheetId()}),s.focusRange(o,k))},I=()=>{const T=d.length+1,O=n.t("definedName.defaultName")+T;if(s.getValueByName(o,O)==null)return O;let k=T+1;for(;;){const D=n.t("definedName.defaultName")+k;if(s.getValueByName(o,D)==null)return D;k++}},_=()=>{var T;const O=(T=r.getActiveSheet())==null?void 0:T.getName();if(!O)return"";const k=i.getCurrentSelections();return k==null?"":k.map(D=>qc(O,D.range)).join(",")},R=()=>{u(!1),g(null)},M=()=>{u(!0),g(null)},x=T=>{u(!1),g(T)},N=T=>{const O=r.getSheetBySheetId(T);return O==null?"":O.getName()};return S.jsx("div",{"data-u-comp":"defined-name-container",className:"univer-relative univer-box-border univer-w-full",children:S.jsxs("div",{className:Ke("univer-w-full univer-overflow-hidden univer-overflow-y-auto",cu),children:[S.jsxs("div",{className:"univer-mb-4",children:[S.jsxs(us,{className:Ke("univer-w-full",{"univer-hidden":l}),onClick:M,children:[S.jsx(Ef,{}),S.jsx("span",{className:"univer-ml-1",children:n.t("definedName.addButton")})]}),l&&S.jsx(RC,{confirm:f,cancel:R,state:l,inputId:"insertDefinedName",name:I(),formulaOrRefString:_()})]},"insertDefinedName"),d.map((T,O)=>S.jsxs("div",{className:"univer-relative univer-w-full univer-divide-x-0 univer-divide-y univer-divide-solid univer-divide-gray-200 dark:!univer-divide-gray-600",children:[S.jsxs("div",{className:Ke("univer-group univer-relative univer-flex univer-w-full univer-cursor-default univer-select-none univer-items-center univer-justify-between univer-rounded-md univer-p-2 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",{"univer-hidden":T.id===h}),onClick:()=>{b(T)},children:[S.jsxs("div",{title:T.comment,children:[S.jsxs("div",{className:"univer-my-1 univer-max-h-[100px] univer-max-w-[190px] univer-truncate univer-text-sm univer-font-medium univer-text-gray-900 dark:!univer-text-white",children:[T.name,S.jsx("span",{className:"univer-text-xxs univer-ml-1 univer-text-gray-400",children:T.localSheetId===nr||T.localSheetId==null?"":N(T.localSheetId)})]}),S.jsx("div",{className:"univer-my-1 univer-max-h-[100px] univer-w-full univer-max-w-[190px] univer-truncate univer-text-xs univer-text-gray-500",title:T.formulaOrRefString,children:T.formulaOrRefString})]}),S.jsxs("div",{className:"univer-absolute univer-right-5 univer-top-1/2 univer-hidden -univer-translate-y-1/2 univer-cursor-pointer univer-items-center univer-justify-end univer-gap-7 univer-text-xs univer-text-primary-600 group-hover:univer-flex dark:hover:!univer-bg-gray-600",children:[S.jsx(Hi,{title:n.t("definedName.updateButton"),placement:"top",children:S.jsx("a",{className:"univer-rounded univer-p-1 hover:univer-bg-gray-100",onClick:k=>{k.stopPropagation(),x(T.id)},children:S.jsx(Pb,{})})}),S.jsx(Hi,{title:n.t("definedName.deleteButton"),placement:"top",children:S.jsx("a",{className:"univer-rounded univer-p-1 univer-text-red-600 hover:univer-bg-gray-100",onClick:k=>{k.stopPropagation(),v(T.id)},children:S.jsx(Ah,{})})})]})]}),S.jsx(p0,{visible:m===T.id,onClose:C,onConfirm:()=>{w(T.id)},children:n.t("definedName.deleteConfirmText")}),T.id===h&&S.jsx(RC,{confirm:f,cancel:R,state:T.id===h,id:T.id,inputId:T.id+O,name:T.name,formulaOrRefString:T.formulaOrRefString,comment:T.comment,localSheetId:T.localSheetId})]},O))]})})},_1={id:Br.id,preconditions:e=>ot(e),binding:te.Digit9|Fe.CTRL_COMMAND},I1={id:Lr.id,preconditions:e=>ot(e),binding:te.Digit0|Fe.CTRL_COMMAND|Fe.SHIFT},R1={id:Jn.id,description:"shortcut.sheet.select-below-cell",group:"3_sheet-view",binding:te.ARROW_DOWN,priority:100,preconditions:ot,staticParameters:{direction:Z.DOWN}},y1={id:Jn.id,description:"shortcut.sheet.select-up-cell",group:"3_sheet-view",binding:te.ARROW_UP,priority:100,preconditions:ot,staticParameters:{direction:Z.UP}},M1={id:Jn.id,description:"shortcut.sheet.select-left-cell",group:"3_sheet-view",binding:te.ARROW_LEFT,priority:100,preconditions:KS,staticParameters:{direction:Z.LEFT}},E1={id:Jn.id,description:"shortcut.sheet.select-right-cell",group:"3_sheet-view",binding:te.ARROW_RIGHT,priority:100,preconditions:KS,staticParameters:{direction:Z.RIGHT}},x1={id:yi.id,description:"shortcut.sheet.select-next-cell",group:"3_sheet-view",binding:te.TAB,priority:100,preconditions:ot,staticParameters:{direction:Z.RIGHT,keycode:te.TAB}},k1={id:yi.id,description:"shortcut.sheet.select-previous-cell",group:"3_sheet-view",binding:te.TAB|Fe.SHIFT,priority:100,preconditions:ot,staticParameters:{direction:Z.LEFT,keycode:te.TAB}},T1={id:yi.id,description:"shortcut.sheet.select-below-cell",group:"3_sheet-view",binding:te.ENTER,priority:100,preconditions:ot,staticParameters:{direction:Z.DOWN,keycode:te.ENTER}},P1={id:yi.id,description:"shortcut.sheet.select-up-cell",group:"3_sheet-view",binding:te.ENTER|Fe.SHIFT,priority:100,preconditions:ot,staticParameters:{direction:Z.UP,keycode:te.ENTER}},U1={id:Jn.id,description:"shortcut.sheet.select-below-value-cell",group:"3_sheet-view",binding:te.ARROW_DOWN|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.DOWN,jumpOver:Ri.moveGap}},N1={id:Jn.id,description:"shortcut.sheet.select-up-value-cell",group:"3_sheet-view",binding:te.ARROW_UP|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.UP,jumpOver:Ri.moveGap}},O1={id:Jn.id,description:"shortcut.sheet.select-left-value-cell",group:"3_sheet-view",binding:te.ARROW_LEFT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.LEFT,jumpOver:Ri.moveGap}},A1={id:Jn.id,description:"shortcut.sheet.select-right-value-cell",group:"3_sheet-view",binding:te.ARROW_RIGHT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.RIGHT,jumpOver:Ri.moveGap}},V1={id:gs.id,description:"shortcut.sheet.expand-selection-down",group:"3_sheet-view",binding:te.ARROW_DOWN|Fe.SHIFT,preconditions:ot,staticParameters:{direction:Z.DOWN}},H1={id:gs.id,description:"shortcut.sheet.expand-selection-up",group:"3_sheet-view",binding:te.ARROW_UP|Fe.SHIFT,preconditions:ot,staticParameters:{direction:Z.UP}},D1={id:gs.id,description:"shortcut.sheet.expand-selection-left",group:"3_sheet-view",binding:te.ARROW_LEFT|Fe.SHIFT,preconditions:ot,staticParameters:{direction:Z.LEFT}},W1={id:gs.id,description:"shortcut.sheet.expand-selection-right",group:"3_sheet-view",binding:te.ARROW_RIGHT|Fe.SHIFT,preconditions:ot,staticParameters:{direction:Z.RIGHT}},L1={id:gs.id,description:"shortcut.sheet.expand-selection-to-below-gap",group:"3_sheet-view",binding:te.ARROW_DOWN|Fe.SHIFT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.DOWN,jumpOver:Ri.moveGap}},B1={id:gs.id,description:"shortcut.sheet.expand-selection-to-up-gap",group:"3_sheet-view",binding:te.ARROW_UP|Fe.SHIFT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.UP,jumpOver:Ri.moveGap}},j1={id:gs.id,description:"shortcut.sheet.expand-selection-to-left-gap",group:"3_sheet-view",binding:te.ARROW_LEFT|Fe.SHIFT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.LEFT,jumpOver:Ri.moveGap}},F1={id:gs.id,description:"shortcut.sheet.expand-selection-to-right-gap",group:"3_sheet-view",binding:te.ARROW_RIGHT|Fe.SHIFT|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{direction:Z.RIGHT,jumpOver:Ri.moveGap}},z1={id:kh.id,description:"shortcut.sheet.select-all",group:"3_sheet-view",binding:te.A|Fe.CTRL_COMMAND,preconditions:ot,staticParameters:{expandToGapFirst:!0,loop:!0}},X1={id:Oa.id,description:"shortcut.sheet.set-bold",group:"4_sheet-edit",preconditions:e=>ot(e),binding:te.B|Fe.CTRL_COMMAND},Y1={id:Aa.id,description:"shortcut.sheet.set-italic",group:"4_sheet-edit",preconditions:e=>ot(e),binding:te.I|Fe.CTRL_COMMAND},Z1={id:Va.id,description:"shortcut.sheet.set-underline",group:"4_sheet-edit",preconditions:e=>ot(e),binding:te.U|Fe.CTRL_COMMAND},G1={id:Ha.id,description:"shortcut.sheet.set-strike-through",group:"4_sheet-edit",preconditions:e=>ot(e),binding:te.X|Fe.SHIFT|Fe.CTRL_COMMAND},q1={id:as.id,preconditions:e=>ot(e),binding:te.DELETE,mac:te.BACKSPACE},Q1={id:as.id,preconditions:e=>ot(e),mac:te.DELETE},K1={id:as.id,preconditions:e=>ot(e),binding:Fe.SHIFT+te.BACKSPACE},$1={id:Tr.id,preconditions:e=>ot(e),binding:Fe.SHIFT+te.DELETE},J1={id:xu.id,description:"shortcut.sheet.zoom-in",binding:te.EQUAL|Fe.CTRL_COMMAND,group:"3_sheet-view",preconditions:ot,priority:1,staticParameters:{delta:.2}},e_={id:Lm.id,binding:te.EQUAL|Fe.CTRL_COMMAND},t_={id:xu.id,description:"shortcut.sheet.zoom-out",binding:te.MINUS|Fe.CTRL_COMMAND,group:"3_sheet-view",preconditions:ot,priority:1,staticParameters:{delta:-.2}},n_={id:Lm.id,binding:te.MINUS|Fe.CTRL_COMMAND},s_={id:xu.id,description:"shortcut.sheet.reset-zoom",binding:te.Digit0|Fe.CTRL_COMMAND,preconditions:ot,group:"3_sheet-view",priority:1,staticParameters:{reset:!0}},i_={id:Lm.id,binding:te.Digit0|Fe.CTRL_COMMAND};var s3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Pi=(e,t)=>(n,s)=>t(n,s,e);let pc=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),this._injector=e,this._componentManager=t,this._layoutService=n,this._commandService=s,this._shortcutService=i,this._menuManagerService=r,this._uiPartsService=o,this._configService=a,this._init()}_init(){this._initComponents(),this._initCommands(),this._initMenus(),this._initShortcuts(),this._initWorkbenchParts(),this._initFocusHandler()}_initComponents(){const e=this._componentManager;this.disposeWithMe(e.register(Zs,d1)),this.disposeWithMe(e.register(Pu,o1)),this.disposeWithMe(e.register(Nf,w1)),this.disposeWithMe(e.register(Jl,b1)),this.disposeWithMe(e.register(Af,S1)),this.disposeWithMe(e.register("HideGridlinesDoubleIcon",Tf))}_initCommands(){[xu,gs,Jn,yi,Oh,Mh,Xl,Yl,wh,Sh,Ss,bf,kh,_f,Wp,oa,At,Nh,Oa,Aa,Va,Ha,hb,gb,bh,ff,vf,Vo,Fl,Cf,Lp,jp,Fp,Cu,Eh,wf,Mu,xh,mr,Kl,gr,Zl,Gl,ql,Ql,Rf,Bp,Da,Mi,Th,sa,na,yu,Ru,yf,fi,Sb,Ih,Ho,Do,Rh,yh,Uh,Wo,Lo,Ph,Eu,fh,vh].forEach(e=>{this.disposeWithMe(this._commandService.registerCommand(e))})}_initMenus(){this._menuManagerService.mergeMenu(C5)}_initShortcuts(){[R1,y1,M1,E1,x1,k1,T1,P1,U1,N1,O1,A1,V1,H1,D1,W1,L1,B1,j1,F1,z1,J1,t_,s_,i_,e_,n_,X1,Y1,Z1,G1,q1,Q1,K1,$1,...zb(),Yb,Xb,Zb,Qb,Kb,$b,e1,Gb,qb,Jb,_1,I1].forEach(e=>{this.disposeWithMe(this._shortcutService.registerShortcut(e))})}_initWorkbenchParts(){const e=this._uiPartsService,t=this._injector;this.disposeWithMe(e.registerComponent(xo.HEADER,()=>ko(RT,t))),this.disposeWithMe(e.registerComponent(xo.FOOTER,()=>ko(IT,t))),this.disposeWithMe(e.registerComponent(xo.CONTENT,()=>ko(Bb,t)))}_initFocusHandler(){this.disposeWithMe(this._layoutService.registerFocusHandler(A.UNIVER_SHEET,e=>{const t=this._injector.get(ze),n=this._injector.get(P),s=du(A.UNIVER_DOC,n,t),i=s?.with(Bi);i?.focus()}))}};pc=s3([Pi(0,V(pt)),Pi(1,V(Tn)),Pi(2,zm),Pi(3,U),Pi(4,Yc),Pi(5,jm),Pi(6,Xm),Pi(7,Lt)],pc);var i3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Io=(e,t)=>(n,s)=>t(n,s,e);const r3=gn("statusBarPermissionCorrect");class o3{constructor(){y(this,"_sum",0),y(this,"_count",0),y(this,"_countNumber",0),y(this,"_min",Number.POSITIVE_INFINITY),y(this,"_max",Number.NEGATIVE_INFINITY)}add(t,n,s){if(!Q.isDefine(t?.v))return;const i=t?.t;let{v:r}=t;const o=l=>{this._sum+=l,this._countNumber++,this._min=Math.min(this._min,l),this._max=Math.max(this._max,l)},a=(l,u,d)=>{var c;if(!((c=l?.n)!=null&&c.pattern))return;const{pattern:h}=l.n;d[h]||(d[h]=bl.getFormatInfo(h)),d[h].isDate&&o(u)};if(typeof r=="string"&&i===je.NUMBER){const l=Number(r);Number.isNaN(l)||(r=l)}if(typeof r=="number"&&i!==je.STRING)o(r);else if(i===je.NUMBER&&t.s){const l=n.get(t.s);a(l,r,s)}this._count++}getResults(){return{sum:this._sum,count:this._countNumber,countA:this._count,min:this._min,max:this._max}}}function a3(e){const{sum:t,count:n,countA:s,min:i,max:r}=e.getResults();return[{func:wt.MAX,value:r},{func:wt.MIN,value:i},{func:Gc.SUM,value:t},{func:wt.COUNTA,value:s},{func:wt.COUNT,value:n},{func:wt.AVERAGE,value:t/n}]}let Jr=class extends ae{constructor(e,t,n,s,i,r){super(),y(this,"interceptor",new Ci({STATUS_BAR_PERMISSION_CORRECT:r3})),this._univerInstanceService=e,this._selectionManagerService=t,this._statusBarService=n,this._commandService=s,this._numfmtService=i,this._formulaDataModel=r,this._init()}_init(){this._registerSelectionListener()}_registerSelectionListener(){const e=vd(n=>{var s;const i=(s=n[n.length-1])==null?void 0:s.primary;this._calculateSelection(n.map(r=>r.range),i)},100),t=vd(n=>{var s;const i=(s=n[n.length-1])==null?void 0:s.primary;this._calculateSelection(n.map(r=>r.range),i)},500);this.disposeWithMe(He(this._selectionManagerService.selectionMoving$.subscribe(n=>{n&&t(n)}))),this.disposeWithMe(He(this._selectionManagerService.selectionMoveEnd$.subscribe(n=>{n&&e(n)}))),this.disposeWithMe(He(this._selectionManagerService.selectionSet$.subscribe(n=>{n&&e(n)}))),this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(n.id===le.id){const s=this._selectionManagerService.getCurrentSelections(),{cellValue:i}=n.params;if(s&&s.length>0&&i){const r=new de(i);let o=!1;r.forValue((a,l)=>{if(s.some(u=>{const d=u.range;return a>=d.startRow&&a<=d.endRow&&l>=d.startColumn&&l<=d.endColumn}))return o=!0,!1}),o&&e(s)}}}))}_clearResult(){this._statusBarService.setState(null)}getRangeStartEndInfo(e,t){return e.rangeType===j.ALL?{startRow:0,startColumn:0,endRow:t.getRowCount()-1,endColumn:t.getColumnCount()-1}:e.rangeType===j.COLUMN?{startRow:0,startColumn:e.startColumn,endRow:t.getRowCount()-1,endColumn:e.endColumn}:e.rangeType===j.ROW?{startRow:e.startRow,startColumn:0,endRow:e.endRow,endColumn:t.getColumnCount()-1}:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}_getCellValue(e,t,n,s){var i,r,o,a;const l=n.getCellRaw(e,t),u=(i=s?.[e])==null?void 0:i[t];return u?{t:(r=u.t)!=null?r:l?.t,v:(o=u.v)!=null?o:l?.v,s:(a=u.s)!=null?a:l?.s}:l}_calculateSelection(e,t){var n,s;const i=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!i)return this._clearResult();const r=i.getUnitId(),o=i.getActiveSheet(),a=o?.getSheetId();if(!a)return this._clearResult();const l={};if(this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getSheets().forEach(u=>{const d=u.getConfig();l[u.getSheetId()]={cellData:new de(d.cellData),rowCount:d.rowCount,columnCount:d.columnCount,rowData:d.rowData,columnData:d.columnData}}),e!=null&&e.length){const u=[];e.forEach(w=>{const{startRow:b,endRow:I}=w;let _=null;for(let R=b;R<=I;R++)o.getRowVisible(R)?_===null&&(_=R):_!==null&&(u.push({...w,startRow:_,endRow:R-1}),_=null);_!==null&&u.push({...w,startRow:_,endRow:I})});const d=cI(u),c=new o3,h=i.getStyles(),g={},m=this._formulaDataModel.getArrayFormulaCellData(),p=(n=m?.[r])==null?void 0:n[a];for(const w of d){const{startRow:b,startColumn:I,endColumn:_,endRow:R}=this.getRangeStartEndInfo(w,o);for(let M=b;M<=R;M++)for(let x=I;x<=_;x++){const N=this._getCellValue(M,x,o,p);c.add(N,h,g)}}const f=a3(c);if(f.every(w=>w===void 0))return;let v=null;if(t){const{actualRow:w,actualColumn:b}=t;v=(s=this._numfmtService.getValue(r,a,w,b))==null?void 0:s.pattern}const C={values:f.filter(w=>w!==void 0),pattern:v};this._statusBarService.setState(C)}else this._clearResult()}};Jr=i3([Io(0,P),Io(1,V(q)),Io(2,Vh),Io(3,U),Io(4,V(Xr)),Io(5,V(Mw))],Jr);const l3=(e=[])=>{const t=G(Na);L.useEffect(()=>{const n=e.map(s=>t.addShape({range:s,style:{fill:"rgba(73, 184, 17, 0.05)",strokeWidth:1,stroke:"#49B811",widgets:{}},primary:null}));return()=>{n.forEach(s=>{s&&t.removeShape(s)})}},[e])};var u3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},yC=(e,t)=>(n,s)=>t(n,s,e),vl=(e=>(e[e.INFO=0]="INFO",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR",e))(vl||{});let au=class extends ae{constructor(e,t){super(),y(this,"_currentAlert$",new Ve),y(this,"_currentAlert",new Map),y(this,"currentAlert$",this._currentAlert$.asObservable()),this._renderManagerService=e,this._cellPopupManagerService=t,this.disposeWithMe(()=>{this._currentAlert$.complete()})}get currentAlert(){return this._currentAlert}showAlert(e){var t;let n=this._currentAlert.get(e.key);n&&n.dispose.dispose(),n?n.dispose.dispose():(n={alert:e,dispose:{dispose(){}}},this._currentAlert.set(e.key,n));const{location:s}=e,{row:i,col:r,unitId:o,subUnitId:a}=s;if(!this._renderManagerService.getRenderById(o))return;const l=this._cellPopupManagerService.showPopup({unitId:o,subUnitId:a,row:i,col:r},{componentKey:r_,direction:"horizontal",extraProps:{alert:e},priority:1});l&&(n&&((t=n.dispose)==null||t.dispose()),n.dispose=l),this._currentAlert$.next(Array.from(this._currentAlert.entries()))}removeAlert(e){const t=this._currentAlert.get(e);t&&(this._currentAlert.delete(e),t?.dispose.dispose(),this._currentAlert$.next(Array.from(this._currentAlert.entries())))}clearAlert(){this._currentAlert.forEach(e=>{e.dispose.dispose()}),this._currentAlert.clear(),this._currentAlert$.next(Array.from(this._currentAlert.entries()))}};au=u3([yC(0,ze),yC(1,V($r))],au);function d3({popup:e}){var t;const n=(t=e.extraProps)==null?void 0:t.alert;if(!n)return null;const{type:s,title:i,message:r}=n,o={[vl.ERROR]:S.jsx(Mf,{className:"univer-mr-1.5 univer-text-red-500"}),[vl.INFO]:S.jsx(Tb,{className:"univer-mr-1.5 univer-text-blue-500"}),[vl.WARNING]:S.jsx(Nb,{className:"univer-mr-1.5 univer-text-yellow-500"})};return S.jsxs("div",{className:"univer-z-[100] univer-box-border univer-w-[156px] univer-rounded-lg univer-bg-white univer-px-2 univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",children:[S.jsxs("div",{className:"univer-mb-1.5 univer-flex univer-h-5 univer-flex-row univer-items-center univer-text-sm univer-font-medium",children:[s?o[s]:null,i]}),S.jsx("div",{className:"univer-text-sm",children:r})]})}const r_="univer.sheet.cell-alert";var c3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},h3=(e,t)=>(n,s)=>t(n,s,e);let fc=class extends ae{constructor(e,t){super(),this._context=e,this._componentManager=t,this._initComponent()}_initComponent(){this.disposeWithMe(this._componentManager.register(r_,d3))}};fc=c3([h3(1,V(Tn))],fc);var g3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},MC=(e,t)=>(n,s)=>t(n,s,e);let vc=class extends ae{constructor(e,t,n){super(),this._context=e,this._editorBridgeService=t,this._cellPopupManagerService=n,this._initEditorVisibleListener()}_initEditorVisibleListener(){this.disposeWithMe(this._editorBridgeService.visible$.pipe(Wt(e=>e.visible)).subscribe(()=>{const e=this._editorBridgeService.getEditLocation();e&&this._cellPopupManagerService.hidePopup(e.unitId,e.sheetId,e.row,e.column)}))}};vc=g3([MC(1,xt),MC(2,V($r))],vc);var m3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Zu=(e,t)=>(n,s)=>t(n,s,e);let ga=class extends ae{constructor(e,t,n,s){super(),y(this,"_isPointer",!1),this._hoverManagerService=e,this._instanceService=t,this._commandService=n,this._renderManagerService=s,this._initPointerEvent(),this._initHover()}get _mainComponent(){var e;return(e=du(A.UNIVER_SHEET,this._instanceService,this._renderManagerService))==null?void 0:e.mainComponent}_initHover(){this.disposeWithMe(this._hoverManagerService.currentRichText$.subscribe(e=>{var t,n;e!=null&&e.bullet?(this._isPointer||(t=this._mainComponent)==null||t.setCursor(Qe.POINTER),this._isPointer=!0):(this._isPointer&&((n=this._mainComponent)==null||n.setCursor(Qe.AUTO)),this._isPointer=!1)}))}_initPointerEvent(){this.disposeWithMe(this._hoverManagerService.currentClickedCell$.subscribe(e=>{const{location:t,bullet:n}=e;n&&this._commandService.executeCommand(jS.id,{unitId:t.unitId,subUnitId:t.subUnitId,row:t.row,col:t.col,paragraphIndex:n.startIndex})}))}};ga=m3([Zu(0,V(Kr)),Zu(1,P),Zu(2,U),Zu(3,ze)],ga);const EC=2,p3=[{value:"DEFAULT_PASTE",label:"rightClick.paste"},{value:"SPECIAL_PASTE_VALUE",label:"rightClick.pasteValue"},{value:"SPECIAL_PASTE_FORMAT",label:"rightClick.pasteFormat"},{value:"SPECIAL_PASTE_COL_WIDTH",label:"rightClick.pasteColWidth"},{value:"SPECIAL_PASTE_BESIDES_BORDER",label:"rightClick.pasteBesidesBorder"},{value:"SPECIAL_PASTE_FORMULA",label:"formula.operation.pasteFormula"}],f3=e=>{var t,n,s,i,r;const o=G(P),a=G(ze),l=go();if(!e||!l)return null;const u={startRow:e.rows[0],startCol:e.cols[0],endRow:e.rows[e.rows.length-1],endCol:e.cols[e.cols.length-1]};if(u.endRow<0||u.endCol<0)return null;const d=a.getRenderById(l.getUnitId()),c=d?.with(Te),h=d?.with(Zt),g=Rs(o,a);if(!g||!h)return null;const{scene:m}=g,p=c?.getCurrentSkeleton(),f=h.getViewPort(),v=m?.scaleX,C=m?.scaleY,w=m?.getViewportScrollXY(f),b=(t=m.getEngine())==null?void 0:t.getCanvas();if(!v||!m||!v||!C||!w)return null;const I=p?.getNoMergeCellPositionByIndex(u.endRow,u.endCol),_=(n=I?.endX)!=null?n:0,R=(s=I?.endY)!=null?s:0,M=(i=Ro(_,v,w))!=null?i:-9999,x=(r=yo(R,C,w))!=null?r:-9999,N=b?.getWidth(),T=b?.getHeight();if(!N||!T)return null;const O=M+50<=N,k=x+50<=T;let D=M,B=x;return O||(D=N-100),k||(B=T-100),{positionX:D,positionY:B}},v3=()=>{const e=G(hs),t=zt(e.showMenu$,!1),n=zt(e.pasteOptionsCache$,null),s=G(Oe),i=G(U),[r,o]=L.useState(!1),[a,l]=L.useState(!1),u=n?.target.pastedRange,d=f3(u);if(!d||!t||d.positionX<50||d.positionY<30)return null;const c=r||a,h=g=>{l(!1),i.executeCommand(lb.id,{type:g})};return S.jsx("div",{className:"univer-absolute univer-inset-0 univer-z-10 univer-size-0",children:S.jsx("div",{className:"univer-absolute",style:{left:d.positionX+EC,top:d.positionY+EC},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:S.jsx(Jm,{align:"start",items:p3.map(g=>({type:"checkbox",value:g.value,label:s.t(g.label),checked:n?.pasteType===_t[g.value],onSelect:()=>h(g.value)})),open:a,onOpenChange:l,children:S.jsxs("div",{className:Ke("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",Ra,{"univer-bg-gray-100 dark:!univer-bg-gray-800":a,"univer-bg-white dark:!univer-bg-gray-900":!a}),children:[S.jsx(Vb,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),c&&S.jsx(ua,{className:"dark:!univer-text-white"})]})})})})},C3=[At.id,An.id,Mi.id,Mn.id,an.id,$t.id,rn.id,on.id,Wn.id,Ln.id,Cn.id,os.id,me.id,CI];function w3(e,t,n,s,i){const r=[],o=[];if(s.copyType===si.CUT){const{undos:a,redos:l}=S3(e,t,i);r.push(...l),o.push(...a)}else{const{undos:a,redos:l}=l_(t,n,i);r.push(...l),o.push(...a);const{undos:u,redos:d}=b3(t,n,i);r.push(...d),o.push(...u);const{undos:c,redos:h}=o_(t,e,n,i);r.push(...h),o.push(...c);const{undos:g,redos:m}=a_(t,e,n,i,!0);r.push(...m),o.push(...g);const{undos:p,redos:f}=_m(t,n,i);r.push(...f),o.push(...p)}return{undos:o,redos:r}}function S3(e,t,n){let s=[],i=[];const{range:r,subUnitId:o,unitId:a}=e,{range:l,subUnitId:u}=t,d=l?Or(l):null,c=r?Or(r):null;if(c&&d){const h=n.get(P),g=n.get(_e),m=h.getUniverSheetInstance(a),p=m?.getSheetBySheetId(o),f=m?.getSheetBySheetId(u);if(p&&f){const v=new de,C=new de,w=p.getCellMatrix(),b=f.getCellMatrix();De.foreach(c,(W,F)=>{v.setValue(W,F,qg(w.getValue(W,F))),C.setValue(W,F,null)});const I=new de;De.foreach(d,(W,F)=>{I.setValue(W,F,qg(b.getValue(W,F)))});const _=new de;De.foreach(c,(W,F)=>{const K=Dc(W,F),J=z.getRelativeRange(K,c),ee=z.getPositionRange(J,d);_.setValue(ee.startRow,ee.startColumn,w.getValue(W,F))});const R={fromRange:c,toRange:d,from:{value:C.getMatrix(),subUnitId:o},to:{value:_.getMatrix(),subUnitId:u},unitId:a},M={fromRange:d,toRange:c,from:{value:v.getMatrix(),subUnitId:o},to:{value:I.getMatrix(),subUnitId:u},unitId:a},x=g.onCommandExecute({id:zi.id,params:{toRange:d,fromRange:c}}),N=p.getMergeData(),T=f.getMergeData(),O=N.filter(W=>z.intersects(W,c)),k=T.filter(W=>z.intersects(W,d)),D=[],B=[];if(O.length>0||k.length>0){const W=O.map(K=>z.getRelativeRange(K,c)).map(K=>z.getPositionRange(K,d)),F=Vr(W);O.length>0&&(D.push({id:et.id,params:{unitId:a,subUnitId:o,ranges:O}}),B.push({id:qe.id,params:{unitId:a,subUnitId:o,ranges:O}})),k.length>0&&(D.push({id:et.id,params:{unitId:a,subUnitId:o,ranges:k}}),B.push({id:qe.id,params:{unitId:a,subUnitId:u,ranges:k}})),D.push({id:qe.id,params:{unitId:a,subUnitId:u,ranges:F}}),B.unshift({id:et.id,params:{unitId:a,subUnitId:u,ranges:F}})}s=[{id:Mn.id,params:R},...x.redos,...D,{id:me.id,params:{unitId:a,subUnitId:u,selections:[{range:d,primary:Ht(d,f)}],type:Ct.MOVE_END}}],i=[{id:Mn.id,params:M},...x.undos,...B,{id:me.id,params:{unitId:a,subUnitId:o,type:Ct.MOVE_END,selections:[{range:c,primary:Ht(c,p)}]}}]}}return{undos:i,redos:s}}function o_(e,t,n,s){var i;const{unitId:r,subUnitId:o,range:a}=e,l=(i=s.get(P).getUniverSheetInstance(r))==null?void 0:i.getSheetBySheetId(o),u=[],d=[],{mapFunc:c}=Zr([a]),h=new de;n.forValue((p,f,v)=>{var C,w;const{row:b,col:I}=c(p,f),_={v:v.v,t:v.t};if(!v.p&&v.v&&!t){const R=l?.getCellStyle(b,I);if(Cs((C=R?.n)==null?void 0:C.pattern))_.t=je.STRING;else{const M=String(v.v).trim(),x=lr(M);x?.v!==void 0&&typeof x.v=="number"&&(!x.z&&tw(M)?_.t=je.FORCE_STRING:_.v=x.v)}}if((w=v.p)!=null&&w.body&&bm(v.p.body)){const R={p:td(v.p),v:v.v};h.setValue(b,I,R)}else h.setValue(b,I,_&&qg(_))});const g={unitId:r,subUnitId:o,cellValue:jc(h.getMatrix())};u.push({id:le.id,params:g});const m=Vt(s,g);return d.push({id:le.id,params:m}),{undos:d,redos:u}}function a_(e,t,n,s,i=!1){var r;const o=[],a=[],{unitId:l,subUnitId:u,range:d}=e,c=(r=s.get(P).getUniverSheetInstance(l))==null?void 0:r.getSheetBySheetId(u),h=new de,{mapFunc:g}=Zr([d]);n.forValue((f,v,C)=>{var w,b;const I={s:Object.assign({},{...hi,pd:l0,bg:null,cl:null},C.s)},_=I.s.bd;_&&(Object.keys(_).length>0||(I.s.bd={b:null,l:null,r:null,t:null}));const{row:R,col:M}=g(f,v),x=c?.getCellStyle(R,M);if(C.v&&!t&&Cs((w=x?.n)==null?void 0:w.pattern))I.s||(I.s={}),I.s.n=x?.n;else{const N=String(C.v).trim(),T=lr(N);T!=null&&T.z&&(I.s||(I.s={}),typeof I.s=="object"&&((b=I.s)!=null&&b.n?I.s.n.pattern=T.z:I.s.n={pattern:T.z}))}h.setValue(R,M,I)});const m={unitId:l,subUnitId:u,cellValue:jc(h.getMatrix())};o.push({id:le.id,params:m});const p=Vt(s,m);return a.push({id:le.id,params:p}),{undos:a,redos:o}}function l_(e,t,n){const s=[],i=[],r=new de,{unitId:o,subUnitId:a,range:l}=e,{mapFunc:u}=Zr([l]);if(t.forEach((d,c)=>{Object.keys(c).forEach(h=>{const g=Number(h),{row:m,col:p}=u(d,g);r.setValue(m,p,{s:null})})}),r.getLength()>0){const d={subUnitId:a,unitId:o,cellValue:jc(r.getMatrix())};s.push({id:le.id,params:d});const c=Vt(n,d);i.push({id:le.id,params:c})}return{undos:i,redos:s}}function b3(e,t,n){const s=[],i=[],r=new de,{unitId:o,subUnitId:a,range:l}=e,{mapFunc:u}=Zr([l]);if(t.forValue((d,c,h)=>{const{row:g,col:m}=u(d,c);r.setValue(g,m,{v:null,p:null})}),r.getLength()>0){const d={subUnitId:a,unitId:o,cellValue:jc(r.getMatrix())};s.push({id:le.id,params:d});const c=Vt(n,d);i.push({id:le.id,params:c})}return{undos:i,redos:s}}function _m(e,t,n){const s=[],i=[],{unitId:r,subUnitId:o,range:a}=e,{startColumn:l,startRow:u,endColumn:d,endRow:c}=Or(a),h=[];t.forValue((m,p,f)=>{if(f.rowSpan&&f.rowSpan>1){const v=f.colSpan||1,C={startRow:u+m,endRow:u+m+f.rowSpan-1,startColumn:l+p,endColumn:l+p+v-1};h.push(C)}else if(f.colSpan&&f.colSpan>1){const v=f.rowSpan||1,C={startRow:u+m,endRow:u+m+v-1,startColumn:l+p,endColumn:l+p+f.colSpan-1};h.push(C)}});const g=Y(n.get(P),{unitId:r,subUnitId:o});if(g&&g.worksheet){const m=g.worksheet.getMergeData().filter(p=>z.intersects({startRow:u,startColumn:l,endRow:c,endColumn:d},p));if(m.length>0){const p={unitId:r,subUnitId:o,ranges:m};s.push({id:et.id,params:p});const f=pn(n,p);i.push({id:qe.id,params:f})}}if(h.length>0){const m={unitId:r,subUnitId:o,ranges:h};s.push({id:qe.id,params:m});const p=On(n,m);i.unshift({id:et.id,params:p})}return{redos:s,undos:i}}function _3(e){if(!e.includes("\r")&&Q.isLegalUrl(e)){const s=hn(),i=`${e}`,r={startIndex:0,endIndex:i.length-1,rangeId:s,rangeType:Bm.HYPERLINK,properties:{url:e}};return{dataStream:`${i}\r
`,paragraphs:[{startIndex:i.length}],customRanges:[r]}}let t=e.replace(/(\r\n|\n)/g,"\r");t.endsWith(`\r
`)||(t+=`\r
`);const n=[];for(let s=0;s<t.length;s++)t[s]==="\r"&&n.push({startIndex:s});return{dataStream:t,paragraphs:n,sectionBreaks:[{startIndex:t.indexOf(`
`)}]}}var I3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ps=(e,t)=>(n,s)=>t(n,s,e);const R3=[on.id,rn.id,$t.id,an.id,Mn.id,Wn.id,Ln.id];let eo=class extends Ms{constructor(e,t,n,s,i,r,o,a,l,u){super(),y(this,"_refreshOptionalPaste$",new Ve),y(this,"refreshOptionalPaste$",this._refreshOptionalPaste$.asObservable()),this._injector=e,this._instanceService=t,this._renderManagerService=n,this._commandService=s,this._contextService=i,this._configService=r,this._sheetClipboardService=o,this._messageService=a,this._localService=l,this._uiPartsService=u,this._init(),this._initCommandListener(),this._initUIComponents(),this._pasteWithDoc()}refreshOptionalPaste(){this._refreshOptionalPaste$.next(Math.random())}_pasteWithDoc(){var e;const t=s=>{s.onPaste$.pipe(ln(this.dispose$)).subscribe(i=>{var r,o;if(!ot(this._contextService))return;i.event.preventDefault();const a=i.event,l=(r=a.clipboardData)==null?void 0:r.getData("text/html"),u=(o=a.clipboardData)==null?void 0:o.getData("text/plain"),d=this._resolveClipboardFiles(a.clipboardData);this._commandService.executeCommand(pm.id,{htmlContent:l,textContent:u,files:d})}),s?.onKeydown$.subscribe(i=>{i.event.key==="Escape"&&this._sheetClipboardService.removeMarkSelection()})};let n=(e=this._renderManagerService.getRenderById(rt))==null?void 0:e.with(Bi);n&&t(n),this._renderManagerService.created$.subscribe(s=>{var i;s.unitId===rt&&(n=(i=this._renderManagerService.getRenderById(rt))==null?void 0:i.with(Bi),n&&t(n))})}_resolveClipboardFiles(e){if(!e)return;const t=Array.from(e.items).map(n=>n.kind==="file"?n.getAsFile():void 0).filter(Boolean);return t.length>0?t:void 0}_init(){[Ds,Tr,Ws].forEach(t=>this.disposeWithMe(this._commandService.registerMultipleCommand(t))),[ml,pl,Ao,fl,pm,lb].forEach(t=>this.disposeWithMe(this._commandService.registerCommand(t))),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initCopyingHooks())),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingRowsHook())),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingColumnsHook())),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingHook()));const e=this._initSpecialPasteHooks().map(t=>this._sheetClipboardService.addClipboardHook(t));this.disposeWithMe({dispose:()=>e.forEach(t=>t.dispose())})}_initCopyingHooks(){const e=this;let t=null;return{id:yr.DEFAULT_COPY,isDefaultHook:!0,onBeforeCopy(n,s){t=e._getWorksheet(n,s)},onCopyCellContent(n,s){var i,r,o,a;const l=t.getCell(n,s);return(r=(i=l?.p)==null?void 0:i.body)!=null&&r.paragraphs||(a=(o=l?.p)==null?void 0:o.body)!=null&&a.textRuns?D_(l.p):l?dw(l):""},onCopyCellStyle:(n,s,i,r)=>{const o={};(i||r)&&(o.rowspan=`${i||1}`,o.colspan=`${r||1}`);const a=t.getMergedCell(n,s),l=t.getComposedCellStyle(n,s);let u="";if(l&&(u=Xf(l)),a){const d=a.endRow,c=a.endColumn,h=t.getRange(d,c).getTextStyle();if(h){const g=Xf(h);u?u+=g?`;${g}`:"":u=g}}return u&&(o.style=u),Object.keys(o).length?o:null},onCopyColumn(n){return{width:`${t.getColumnWidth(n)}`}},onCopyRow(n){return{style:`height: ${t.getRowHeight(n)}px;`}},onAfterCopy(){t=null},getFilteredOutRows(n,s,i){const r=e._getWorksheet(n,s);if(!r)return[];const{startRow:o,endRow:a}=i,l=[];for(let u=o;u<=a;u++)r.getRowFiltered(u)&&l.push(u);return l}}}_initPastingHook(){const e=this;return{id:_t.DEFAULT_PASTE,isDefaultHook:!0,onBeforePaste({range:t}){const n=e._configService.getConfig(zS),s=t.rows[t.rows.length-1],i=t.cols[t.cols.length-1];return n&&s*i>n?(e._messageService.show({type:Sw.Error,content:e._localService.t("clipboard.paste.exceedMaxCells")}),!1):!0},onPastePlainText(t,n,s){return e._onPastePlainText(t,n,s)},onPasteCells(t,n,s,i){return e._onPasteCells(t,n,s,i)}}}_initPastingRowsHook(){const e=this;return{id:_t.DEFAULT_PASTE_ROWS,isDefaultHook:!0,onPasteRows(t){const n=[],s=[],{range:i,unitId:r,subUnitId:o}=t,{rows:a,cols:l}=i;if(!a||!l||a.length===0||l.length===0)return{redos:n,undos:s};const u=e._getWorksheet(r,o).getMaxRows()-1,d=a[a.length-1],c=l[0],h=l[l.length-1];if(d-u>0){const g={unitId:r,subUnitId:o,range:{startRow:u+1,endRow:d,startColumn:c,endColumn:h}};n.push({id:rn.id,params:g}),s.push({id:an.id,params:g})}return{redos:n,undos:s}}}}_initPastingColumnsHook(){const e=this;return{id:_t.DEFAULT_PASTE_COLUMNS,isDefaultHook:!0,onPasteColumns(t){const n=[],s=[],{range:i,unitId:r,subUnitId:o}=t,{rows:a,cols:l}=i;if(!a||!l||a.length===0||l.length===0)return{redos:n,undos:s};const u=e._getWorksheet(r,o).getMaxColumns()-1,d=a[0],c=a[a.length-1],h=l[l.length-1];if(h-u>0){const g={unitId:r,subUnitId:o,range:{startRow:d,endRow:c,startColumn:u+1,endColumn:h}};n.push({id:on.id,params:g}),s.push({id:$t.id,params:g})}return{redos:n,undos:s}}}}_generateDocumentDataModelSnapshot(e){var t,n;const s=(t=Gm(A.UNIVER_SHEET,Te,this._instanceService,this._renderManagerService))==null?void 0:t.getCurrentParam();if(s==null)return null;const{skeleton:i}=s,r=(n=i.getBlankCellDocumentModel())==null?void 0:n.documentModel,o={...r?.getSnapshot(),...e};return r?.reset(o),r?.getSnapshot()}_onPastePlainText(e,t,n){const{range:s,unitId:i,subUnitId:r}=e;let o;if(/\r|\n/.test(t)||Q.isLegalUrl(t)){const l=_3(t),u=this._generateDocumentDataModelSnapshot({body:l});o={[s.rows[0]]:{[s.cols[0]]:{p:u,v:null,f:null}}}}else if(Am(t))o={[s.rows[0]]:{[s.cols[0]]:{f:t,v:null,p:null}}};else{const l=lr(t);l!=null&&l.z?o={[s.rows[0]]:{[s.cols[0]]:{v:l.v,s:{n:{pattern:l.z}},f:null}}}:o={[s.rows[0]]:{[s.cols[0]]:{v:t,f:null}}}}const a={unitId:i,subUnitId:r,cellValue:o};return{redos:[{id:le.id,params:a}],undos:[{id:le.id,params:Vt(this._injector,a)}]}}_onPasteCells(e,t,n,s){return this._injector.invoke(i=>w3(e,t,n,s,i))}_initSpecialPasteHooks(){const e=this,t={id:_t.SPECIAL_PASTE_VALUE,specialPasteInfo:{label:"specialPaste.value"},onPasteCells:(r,o,a)=>this._injector.invoke(l=>o_(o,r,a,l))},n={id:_t.SPECIAL_PASTE_FORMAT,specialPasteInfo:{label:"specialPaste.format"},onPasteCells:(r,o,a)=>{const l=[],u=[],{undos:d,redos:c}=this._injector.invoke(f=>l_(o,a,f));l.push(...c),u.push(...d);const{undos:h,redos:g}=this._injector.invoke(f=>_m(o,a,f));l.push(...g),u.push(...h);const{undos:m,redos:p}=this._injector.invoke(f=>a_(o,r,a,f));return l.push(...p),u.push(...m),{undos:u,redos:l}}},s={id:_t.SPECIAL_PASTE_COL_WIDTH,specialPasteInfo:{label:"specialPaste.colWidth"},onPasteCells(){return{undos:[],redos:[]}},onPasteColumns(r,o,a){var l;const u=[],d=[];if(a.pasteType!==_t.SPECIAL_PASTE_COL_WIDTH)return{redos:u,undos:d};const{range:c,unitId:h,subUnitId:g}=r,{rows:m,cols:p}=c;if(!m||!p||m.length===0||p.length===0)return{redos:u,undos:d};const f=e._getWorksheet(h,g),v=(l=e._configService.getConfig(_I))!=null?l:II,C=m[0],w=m[m.length-1],b=p[0],I=p[p.length-1],_=o.length;if(_>0){const R={};for(let x=b;x<=I;x++){const N=(x-b)%_,T=o[N];T.width&&Number(T.width)!==v&&(R[x]=Number(T.width))}const M={unitId:h,subUnitId:g,ranges:[{startRow:C,endRow:w,startColumn:b,endColumn:I}],colWidth:R};u.push({id:Cn.id,params:M}),d.unshift({id:Cn.id,params:ip(M,f)})}return{redos:u,undos:d}}},i={id:_t.SPECIAL_PASTE_BESIDES_BORDER,specialPasteInfo:{label:"specialPaste.besidesBorder"},onPasteCells:(r,o,a,l)=>{e._instanceService.getCurrentUnitForType(A.UNIVER_SHEET);const u=[],d=[],{range:c,unitId:h,subUnitId:g}=o,m=new de;a.forValue((w,b,I)=>{const _=I.s;if(typeof _=="object"){const R=Q.deepClone(I);R.s&&(R.s={..._,bd:null}),m.setValue(c.rows[w],c.cols[b],R)}});const p={unitId:h,subUnitId:g,cellValue:m.getData()};u.push({id:le.id,params:p});const f=this._injector.invoke(Vt,p);d.push({id:le.id,params:f});const{undos:v,redos:C}=this._injector.invoke(w=>_m(o,a,w));return d.push(...v),u.push(...C),{redos:u,undos:d}}};return[t,n,s,i]}_getWorksheet(e,t){var n;const s=(n=this._instanceService.getUniverSheetInstance(e))==null?void 0:n.getSheetBySheetId(t);if(!s)throw new Error(`[SheetClipboardController]: cannot find a worksheet with unitId ${e} and subUnitId ${t}.`);return s}_initCommandListener(){var e;this.disposeWithMe(this._commandService.onCommandExecuted(n=>{n.id===bi.id?this._sheetClipboardService.removeMarkSelection():R3.includes(n.id)&&this._sheetClipboardService.removeMarkSelection()}));const t=this._configService.getConfig(Jt);(e=t?.clipboardConfig)!=null&&e.hidePasteOptions||(this.disposeWithMe(this._commandService.onCommandExecuted(n=>{C3.includes(n.id)&&this._sheetClipboardService.disposePasteOptionsCache()})),this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(n.id===mr.id){if(!this._sheetClipboardService.getPasteMenuVisible())return;const s=n.params.unitId,i=this._sheetClipboardService.getPasteOptionsCache(),r=i?.target.unitId;s===r&&this._refreshOptionalPaste$.next(Math.random())}})))}_initUIComponents(){var e;const t=this._configService.getConfig(Jt);(e=t?.clipboardConfig)!=null&&e.hidePasteOptions||this.disposeWithMe(this._uiPartsService.registerComponent(xo.CONTENT,()=>ko(v3,this._injector)))}};eo=I3([Ps(0,V(pt)),Ps(1,P),Ps(2,ze),Ps(3,U),Ps(4,Ne),Ps(5,Lt),Ps(6,hs),Ps(7,mw),Ps(8,V(Oe)),Ps(9,Xm)],eo);var y3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},qa=(e,t)=>(n,s)=>t(n,s,e);let ma=class extends ae{constructor(e,t,n,s,i){super(),this._selectionManagerService=e,this._themeService=t,this._instanceSrv=n,this._cmdSrv=s,this._definedNamesService=i,this._init()}_init(){this.disposeWithMe(Ut(this._selectionManagerService.selectionMoveStart$,this._selectionManagerService.selectionMoving$,this._selectionManagerService.selectionMoveEnd$,this._selectionManagerService.selectionSet$).pipe(Wt(e=>!!e)).subscribe(e=>{this._syncDefinedNameRange(e)})),this.disposeWithMe(this._definedNamesService.focusRange$.subscribe(async e=>{if(e==null)return;const{unitId:t}=e;let{formulaOrRefString:n}=e;if(n.substring(0,1)===Ir.EQUALS&&(n=n.substring(1)),!Iw(n))return;const s=this._instanceSrv.getUnit(t),i=await this._getSelections(s,t,n);this._selectionManagerService.setSelections(i),this._cmdSrv.executeCommand(mh.id,{unitId:t,range:i[0].range})}))}_syncDefinedNameRange(e){if(e.length===0)return;const t=e[e.length-1],n=this._instanceSrv.getCurrentUnitForType(A.UNIVER_SHEET),s=n?.getActiveSheet();s&&this._definedNamesService.setCurrentRange({range:t.range,unitId:n.getUnitId(),sheetId:s.getSheetId()})}async _getSelections(e,t,n){const s=n.split(",");let i=e.getActiveSheet();if(!i)return[];const r=[];for(let o=0;o<s.length;o++){const a=s[o].trim(),l=hu(a.trim());if(o===0){const d=e.getSheetBySheetName(l.sheetName);d&&i.getSheetId()!==d.getSheetId()&&(i=d,await this._cmdSrv.executeCommand(Iu.id,{subUnitId:i.getSheetId(),unitId:t}))}if(i.getName()!==l.sheetName)continue;let u=null;if(o===s.length-1){const d=l.range,{startRow:c,startColumn:h,endRow:g,endColumn:m}=d;u=Ht({startRow:c,startColumn:h},i)}r.push({range:l.range,style:sr(this._themeService),primary:u})}return r}};ma=y3([qa(0,V(q)),qa(1,V(xn)),qa(2,P),qa(3,U),qa(4,wi)],ma);var M3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ui=(e,t)=>(n,s)=>t(n,s,e);const E3={pageSize:{width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},documentFlavor:vI.UNSPECIFIED,marginTop:5,marginBottom:5,marginRight:0,marginLeft:0,paragraphLineGapDefault:0,renderConfig:{horizontalAlign:Pt.UNSPECIFIED,verticalAlign:vn.TOP,centerAngle:0,vertexAngle:0,wrapStrategy:ws.WRAP,isRenderStyle:pe.FALSE}};let pa=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),this._univerInstanceService=e,this._renderManagerService=t,this._editorBridgeService=n,this._commandService=s,this._rangeProtectionRuleModel=i,this._worksheetProtectionRuleModel=r,this._formulaEditorController=o,this._formulaEditorManagerService=a,this._initialize()}_initialize(){this._syncFormulaEditorContent(),this._commandExecutedListener()}_getEditorViewModel(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(Fi).getViewModel()}_syncFormulaEditorContent(){this.disposeWithMe(this._editorBridgeService.currentEditCellState$.subscribe(e=>{e==null||this._editorBridgeService.isForceKeepVisible()||!this._rangeProtectionRuleModel.getRangeRuleInitState()||!this._worksheetProtectionRuleModel.getSheetRuleInitState()||this._editorSyncHandler(e)}))}_editorSyncHandler(e){var t,n,s;let i=Q.deepClone((t=e.documentLayoutObject.documentModel)==null?void 0:t.getBody());const r=Q.deepClone((n=e.documentLayoutObject.documentModel)==null?void 0:n.drawings),o=Q.deepClone((s=e.documentLayoutObject.documentModel)==null?void 0:s.getDrawingsOrder());(!i||e.isInArrayFormulaRange===!0&&this._editorBridgeService.isVisible().eventType===bt.Dblclick)&&(i={dataStream:`\r
`,paragraphs:[{startIndex:0}],textRuns:[]}),this._syncContentAndRender(it,i,r,o)}_commandExecutedListener(){const e=[rt,it];this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(n.id===Sd.id){const s=n.params,{unitId:i,trigger:r,isSync:o}=s;if(o||r===jC.id)return;if(e.includes(i)){const a=this._univerInstanceService.getUnit(i,A.UNIVER_DOC),l=i===it?rt:it;this._checkAndSetRenderStyleConfig(a),this._syncActionsAndRender(l,s)}}}));const t=[le.id,Mn.id];this.disposeWithMe(this._commandService.onCommandExecuted(n=>{var s,i,r,o,a,l,u;if(t.includes(n.id)){const d=this._editorBridgeService.getLatestEditCellState();if(d==null)return;let c=!1;const{row:h,column:g}=d;if(n.id===le.id&&n.params?(i=(s=n.params.cellValue)==null?void 0:s[h])!=null&&i[g]&&(c=!0):n.id===Mn.id&&n.params&&(o=(r=n.params.to.value)==null?void 0:r[h])!=null&&o[g]&&(c=!0),c){const m=Q.deepClone((a=d.documentLayoutObject.documentModel)==null?void 0:a.getBody()),p=Q.deepClone((l=d.documentLayoutObject.documentModel)==null?void 0:l.drawings),f=Q.deepClone((u=d.documentLayoutObject.documentModel)==null?void 0:u.getDrawingsOrder());if(m==null)return;this._syncContentAndRender(it,m,p,f)}}}))}_syncActionsAndRender(e,t){var n;const s=[rt,it],i=this._renderManagerService.getRenderById(e);if(i==null)return;const r=i.with(Fi).getSkeleton(),o=this._univerInstanceService.getUnit(e,A.UNIVER_DOC),a=this._getEditorViewModel(e);o==null||a==null||(this._commandService.syncExecuteCommand(Sd.id,{...t,textRanges:null,isSync:!0,unitId:e,syncer:t.unitId}),a.reset(o),r.calculate(),s.includes(e)&&((n=i.mainComponent)==null||n.makeDirty()))}_syncContentAndRender(e,t,n,s){var i,r;e===it&&t.paragraphs&&(t.paragraphs=this._clearParagraph(t.paragraphs));const o=[rt,it],a=(i=this._renderManagerService.getRenderById(e))==null?void 0:i.with(Fi).getSkeleton(),l=this._univerInstanceService.getUnit(e,A.UNIVER_DOC),u=this._getEditorViewModel(e);if(l==null||u==null||a==null)return;l.getSnapshot().body=t,l.getSnapshot().drawings=n??{},l.getSnapshot().drawingsOrder=s??[],this._checkAndSetRenderStyleConfig(l),u.reset(l);const d=this._renderManagerService.getRenderById(e);d!=null&&(a.calculate(),o.includes(e)&&((r=d.mainComponent)==null||r.makeDirty()),e===it&&this._formulaEditorController.autoScroll())}_checkAndSetRenderStyleConfig(e){var t;const n=e.getSnapshot(),{body:s}=n;if(n.id!==it)return;n.documentStyle=E3;let i=n.documentStyle.renderConfig;i==null&&(i={},n.documentStyle.renderConfig=i);const r=this._formulaEditorManagerService.getPosition();if(r){const o=r.width;n.documentStyle.pageSize={width:o,height:1/0}}((t=s?.dataStream)!=null?t:"").startsWith("=")?i.isRenderStyle=pe.TRUE:i.isRenderStyle=pe.FALSE}_clearParagraph(e){const t=Q.deepClone(e);for(const n of t)n.paragraphStyle&&(n.paragraphStyle.horizontalAlign=Pt.UNSPECIFIED);return t}};pa=M3([Ui(0,P),Ui(1,ze),Ui(2,xt),Ui(3,U),Ui(4,V(We)),Ui(5,V(ft)),Ui(6,V(Qr)),Ui(7,Tu)],pa);var x3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Qa=(e,t)=>(n,s)=>t(n,s,e);const Ng="SHEET_FORCE_STRING_ALERT";let Cc=class extends ae{constructor(e,t,n,s,i,r){super(),this._context=e,this._hoverManagerService=t,this._cellAlertManagerService=n,this._localeService=s,this._zenZoneService=i,this._configService=r,this._init()}_init(){this._initCellAlertPopup(),this._initZenService()}_initCellAlertPopup(){this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe(e=>{var t,n;if(e){const s=e.location,i=this._context.unit,r=i.getActiveSheet();if(!r)return this._hideAlert();const o=r.getCell(s.row,s.col);if(!o||o.v===null||o.v===void 0)return this._hideAlert();let a;if(o!=null&&o.s){const l=i.getStyles().get(o.s);l!=null&&l.n&&(a=l.n)}if(Cs(a?.pattern)){this._hideAlert();return}if((o.t===je.FORCE_STRING||o.t===je.STRING)&&(rr(o.v)||typeof o.v=="string"&&lr(o.v))){if((t=this._configService.getConfig(Jt))!=null&&t.disableForceStringAlert)return;const l=this._cellAlertManagerService.currentAlert.get(Ng),u=(n=l?.alert)==null?void 0:n.location;if(u&&u.row===e.location.row&&u.col===e.location.col&&u.subUnitId===e.location.subUnitId&&u.unitId===e.location.unitId){this._hideAlert();return}this._cellAlertManagerService.showAlert({type:vl.ERROR,title:this._localeService.t("info.error"),message:this._localeService.t("info.forceStringInfo"),location:s,width:200,height:74,key:Ng});return}}this._hideAlert()}))}_initZenService(){this.disposeWithMe(this._zenZoneService.visible$.subscribe(e=>{e&&this._hideAlert()}))}_hideAlert(){this._cellAlertManagerService.removeAlert(Ng)}};Cc=x3([Qa(1,V(Kr)),Qa(2,V(au)),Qa(3,V(Oe)),Qa(4,pw),Qa(5,Lt)],Cc);var k3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Og=(e,t)=>(n,s)=>t(n,s,e);let wc=class extends Ms{constructor(e,t,n,s){super(),this._context=e,this._sheetSkeletonManagerService=t,this._sheetInterceptorService=n,this._configService=s,this._initViewModelIntercept()}_initViewModelIntercept(){const e={tl:{size:6,color:"#409f11"}};this.disposeWithMe(this._sheetInterceptorService.intercept(ri.CELL_CONTENT,{priority:10,effect:Yt.Style,handler:(t,n,s)=>{var i,r,o;if(!((i=this._sheetSkeletonManagerService.getCurrentParam())!=null&&i.skeleton))return s(t);const a=n.rawData;if(!a||a.v===null||a.v===void 0)return s(t);if((t?.t===je.FORCE_STRING||t?.t===je.STRING)&&(rr(a.v)||typeof a.v=="string"&&lr(a.v))){const l=n.workbook.getStyles().get(a.s);return Cs((r=l?.n)==null?void 0:r.pattern)||(o=this._configService.getConfig(Jt))!=null&&o.disableForceStringMark||(t===a&&(t={...a}),t.markers={...t?.markers,...e}),s(t)}return s(t)}}))}};wc=k3([Og(1,V(Te)),Og(2,V(_e)),Og(3,Lt)],wc);var T3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Sr=(e,t)=>(n,s)=>t(n,s,e);let fa=class extends ae{constructor(e,t,n,s,i,r,o){super(),this._commandService=e,this._formatPainterService=t,this._univerInstanceService=n,this._renderManagerService=s,this._selectionManagerService=i,this._sheetInterceptorService=r,this._injector=o,this._initialize()}_initialize(){this._addDefaultHook()}_addDefaultHook(){const e={id:"default-format-painter",priority:0,isDefaultHook:!0,onStatusChange:t=>{if(t!==ls.OFF){const n=this._collectSelectionRangeFormat();n&&this._formatPainterService.setSelectionFormat(n)}},onApply:(t,n,s,i)=>this._getUndoRedoMutationInfo(t,n,s,i)};this._formatPainterService.addHook(e)}_collectSelectionRangeFormat(){const e=this._selectionManagerService.getCurrentLastSelection(),t=e?.range;if(!t)return null;const{startRow:n,endRow:s,startColumn:i,endColumn:r}=t,o=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),a=o?.getActiveSheet();if(!a)return null;const l=a.getCellMatrix(),u=o.getStyles(),d=new de,c=[];for(let h=n;h<=s;h++)for(let g=i;g<=r;g++){const m=l.getValue(h,g);d.setValue(h,g,u.getStyleByCell(m)||{});const{isMergedMainCell:p,...f}=a.getCellInfoInMergeData(h,g);p&&c.push({startRow:f.startRow,startColumn:f.startColumn,endRow:f.endRow,endColumn:f.endColumn})}return{styles:d,merges:c}}_getUndoRedoMutationInfo(e,t,n,s){const i=this._sheetInterceptorService,r=this._univerInstanceService,{merges:o,styles:a}=s;if(!a)return{undos:[],redos:[]};const{startRow:l,startColumn:u,endRow:d,endColumn:c}=a.getDataRange(),h=d-l+1,g=c-u+1,m=n.startRow===n.endRow&&n.startColumn===n.endColumn?{startRow:n.startRow,startColumn:n.startColumn,endRow:n.startRow+h-1,endColumn:n.startColumn+g-1}:n,p=Array.from({length:m.endRow-m.startRow+1},()=>Array.from({length:m.endColumn-m.startColumn+1},()=>({}))),f=[];p.forEach((k,D)=>{k.forEach((B,W)=>{const F=D%h+l,K=W%g+u,J=a.getValue(F,K);J&&(p[D][W].s=Object.keys(J).length>0?J:null)})});let v=0,C=0;o.forEach(k=>{k.startRow===l&&k.startColumn===u&&(v=k.endRow-k.startRow,C=k.endColumn-k.startColumn);const D={startRow:k.startRow-l,startColumn:k.startColumn-u,endRow:k.endRow-l,endColumn:k.endColumn-u},B=Math.max(1,Math.floor((m.endRow-m.startRow+1)/h)),W=Math.max(1,Math.floor((m.endColumn-m.startColumn+1)/g));for(let F=0;F<B;F++)for(let K=0;K<W;K++)f.push({startRow:D.startRow+F*h+m.startRow,startColumn:D.startColumn+K*g+m.startColumn,endRow:D.endRow+F*h+m.startRow,endColumn:D.endColumn+K*g+m.startColumn})});const w=[m],b=new de,I=new de;if(Q.isArray(p))for(let k=0;k<w.length;k++){const{startRow:D,startColumn:B,endRow:W,endColumn:F}=w[k];for(let K=0;K<=W-D;K++)for(let J=0;J<=F-B;J++)b.setValue(K+D,J+B,{s:null}),I.setValue(K+D,J+B,p[K][J])}const _={subUnitId:t,unitId:e,cellValue:b.getMatrix()},R={subUnitId:t,unitId:e,cellValue:I.getMatrix()},M=this._injector.invoke(Vt,_),{undos:x,redos:N}=i.onCommandExecute({id:An.id,params:{...R,range:w}}),T=[],O=[];if(f.length>0){const k=Vr(f),D=r.getUnit(e).getSheetBySheetId(t),B=Sk(D,k),W={unitId:e,subUnitId:t,ranges:k},F={unitId:e,subUnitId:t,ranges:k};T.push({id:et.id,params:W}),T.push({id:qe.id,params:F});const K=this._injector.invoke(pn,W),J=this._injector.invoke(On,F);if(O.push({id:et.id,params:J}),O.push({id:qe.id,params:K}),B){const ee=this._injector.invoke(we=>gS(we,e,D,k));T.unshift(...ee.redos),O.push(...ee.undos)}}if(!z.equals(m,n)){const k={actualRow:m.startRow,actualColumn:m.startColumn,rangeType:j.NORMAL,isMerged:v>0||C>0,isMergedMainCell:!1,startRow:m.startRow,startColumn:m.startColumn,endRow:m.startRow+v,endColumn:m.startColumn+C};T.push({id:me.id,params:{unitId:e,subUnitId:t,type:Ct.ONLY_SET,selections:[{range:m,primary:k,style:null}]}}),O.unshift({id:me.id,params:{unitId:e,subUnitId:t,type:Ct.ONLY_SET,selections:[{range:n,primary:k,style:null}]}})}return{undos:[{id:le.id,params:_},{id:le.id,params:M},...x,...O],redos:[{id:le.id,params:_},{id:le.id,params:R},...N,...T]}}};fa=T3([Sr(0,U),Sr(1,Ii),Sr(2,P),Sr(3,ze),Sr(4,V(q)),Sr(5,V(_e)),Sr(6,V(pt))],fa);var P3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ag=(e,t)=>(n,s)=>t(n,s,e);let Sc=class extends ae{constructor(e,t,n,s){super(),this._context=e,this._markSelectionService=t,this._commandService=n,this._sheetSkeletonManagerService=s,this._initListeners()}_initListeners(){this._addRemoveListener(),this._addRefreshListener()}_addRemoveListener(){const e=[At.id];this.disposeWithMe(this._commandService.onCommandExecuted(t=>{e.includes(t.id)?this._markSelectionService.removeAllShapes():this._markSelectionService.getShapeMap().forEach((n,s)=>{n.exits.includes(t.id)&&this._markSelectionService.removeShape(s)})}))}_addRefreshListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{e&&this._markSelectionService.refreshShapes()}))}};Sc=P3([Ag(1,V(Na)),Ag(2,U),Ag(3,V(Te))],Sc);function U3(){const e=go();return e?S.jsx(N3,{workbook:e}):null}function N3(e){const{workbook:t}=e,[n,s]=L.useState([]),[i,r]=L.useState(""),o=L.useRef(new Map),a=L.useRef(null),l=G(U),u=L.useCallback(()=>{const c=t.getActiveSheet().getSheetId(),h=t.getSheets(),g=t.getActiveSheet(),m=h.filter(p=>!p.isSheetHidden()).map((p,f)=>{var v;return{sheetId:p.getSheetId(),label:p.getName(),index:f,selected:g===p,color:(v=p.getTabColor())!=null?v:void 0}});if(s(m),r(c),o.current.has(c)){const p=o.current.get(c);if(p&&a.current){const f=a.current.clientWidth,v=p.clientWidth,C=p.offsetLeft-(f-v)/2;a.current.scrollTo({left:Math.max(0,C),behavior:"smooth"})}}o.current.clear()},[t]);L.useEffect(()=>u(),[u]);const d=L.useCallback(c=>{l.executeCommand(lt.id,{unitId:t.getUnitId(),subUnitId:c})},[t]);return L.useEffect(()=>{const c=l.onCommandExecuted(h=>{switch(h.id){case cn.id:case En.id:case Fr.id:case cs.id:case di.id:case lt.id:u();break}});return()=>c.dispose()},[u]),S.jsx("div",{ref:a,className:Ke(`
                  univer-h-10 univer-w-full univer-overflow-x-auto univer-overflow-y-hidden univer-border-b
                  univer-border-gray-200 univer-bg-gradient-to-b univer-from-gray-50 univer-to-gray-100
                  dark:!univer-border-gray-700 dark:!univer-from-gray-800 dark:!univer-to-gray-900
                `,cu),role:"tablist","aria-label":"Sheet tabs",children:S.jsx("div",{className:"univer-flex univer-h-full univer-flex-nowrap univer-items-center",children:n.map(c=>S.jsxs("div",{ref:h=>{o.current.set(c.sheetId,h)},className:Ke("univer-relative univer-box-border univer-flex univer-h-full univer-max-w-36 univer-shrink-0 univer-cursor-pointer univer-select-none univer-items-center univer-justify-center univer-truncate univer-px-1 univer-py-0.5 univer-text-sm univer-font-medium univer-leading-6 univer-transition-all",Km,{"univer-bg-white univer-text-blue-600 dark:!univer-bg-gray-700 dark:!univer-text-blue-400":c.sheetId===i,"univer-text-gray-600 hover:univer-bg-gray-50 active:univer-bg-gray-100 dark:!univer-text-gray-300 dark:hover:!univer-bg-gray-700":c.sheetId!==i}),role:"tab","aria-selected":c.sheetId===i,"aria-controls":`sheet-${c.sheetId}`,tabIndex:c.sheetId===i?0:-1,onClick:()=>d(c.sheetId),children:[S.jsx("span",{className:"univer-truncate",children:c.label}),c.sheetId===i&&S.jsx("div",{className:Ke(`
                                  univer-absolute univer-left-0 univer-right-0 univer-top-0 univer-h-1
                                  univer-bg-blue-600 univer-transition-all
                                  dark:!univer-bg-blue-400
                                `),style:c.color?{backgroundColor:c.color}:void 0,"aria-hidden":"true"})]},c.sheetId))})})}const O3={[un.MAIN_AREA]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo}},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}},[un.COL_HEADER]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo}},[kt.LAYOUT]:{order:1},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}},[un.ROW_HEADER]:{[kt.FORMAT]:{[Ds.name]:{order:0,menuItemFactory:Bo}},[kt.LAYOUT]:{order:1},[kt.DATA]:{order:2},[kt.OTHERS]:{order:3}}};var A3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ni=(e,t)=>(n,s)=>t(n,s,e);let bc=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),this._injector=e,this._componentManager=t,this._layoutService=n,this._commandService=s,this._shortcutService=i,this._menuManagerService=r,this._uiPartsService=o,this._configService=a,this._init()}_init(){this._initComponents(),this._initCommands(),this._initMenus(),this._initShortcuts(),this._initWorkbenchParts(),this._initFocusHandler()}_initComponents(){const e=this._componentManager;this.disposeWithMe(e.register(Zs,d1)),this.disposeWithMe(e.register(Pu,o1)),this.disposeWithMe(e.register(Nf,w1)),this.disposeWithMe(e.register(Jl,b1)),this.disposeWithMe(e.register(Af,S1)),this.disposeWithMe(e.register("HideGridlinesDoubleIcon",Tf))}_initCommands(){[xu,gs,Jn,yi,Oh,Mh,Xl,Yl,wh,Sh,Ss,bf,kh,_f,Wp,oa,At,Nh,Oa,Aa,Va,Ha,hb,gb,bh,Vo,Fl,Cf,Lp,jp,Fp,Cu,Eh,wf,Mu,xh,mr,Kl,gr,Zl,Gl,ql,Ql,Rf,Bp,Da,Mi,Th,sa,na,yu,Ru,yf,fi,Sb,Ih,Ho,Do,Rh,yh,Uh,Wo,Lo,Ph,Eu,fh,vh].forEach(e=>{this.disposeWithMe(this._commandService.registerCommand(e))})}_initMenus(){this._menuManagerService.mergeMenu(O3)}_initShortcuts(){[R1,y1,M1,E1,x1,k1,T1,P1,U1,N1,O1,A1,V1,H1,D1,W1,L1,B1,j1,F1,z1,J1,t_,s_,i_,e_,n_,X1,Y1,Z1,G1,q1,Q1,K1,$1,...zb(),Yb,Xb,Zb,Qb,Kb,$b,e1,Gb,qb,Jb,_1,I1].forEach(e=>{this.disposeWithMe(this._shortcutService.registerShortcut(e))})}_initWorkbenchParts(){const e=this._uiPartsService,t=this._injector;this.disposeWithMe(e.registerComponent(xo.HEADER,()=>ko(U3,t))),this.disposeWithMe(e.registerComponent(xo.CONTENT,()=>ko(Bb,t)))}_initFocusHandler(){this.disposeWithMe(this._layoutService.registerFocusHandler(A.UNIVER_SHEET,e=>{const t=this._injector.get(ze),n=this._injector.get(P),s=du(A.UNIVER_DOC,n,t),i=s?.with(Bi);i?.focus()}))}};bc=A3([Ni(0,V(pt)),Ni(1,V(Tn)),Ni(2,zm),Ni(3,U),Ni(4,Yc),Ni(5,jm),Ni(6,Xm),Ni(7,Lt)],bc);var V3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Vg=(e,t)=>(n,s)=>t(n,s,e);let _c=class extends ae{constructor(e,t,n,s){super(),y(this,"_disposableCollection",new Et),y(this,"_initialize",()=>{const i=this._disposableCollection;this.disposeWithMe(this._selectionManagerService.selectionMoveEnd$.subscribe(()=>{i.dispose(),this._selectionRenderService.getSelectionControls().forEach(r=>{i.add(He(r.selectionMoveEnd$.subscribe(o=>{if(!o)return;const a=r.model.getRange(),l={startRow:a.startRow,startColumn:a.startColumn,endRow:a.endRow,endColumn:a.endColumn,rangeType:a.rangeType},u={startRow:o.startRow,startColumn:o.startColumn,endRow:o.endRow,endColumn:o.endColumn,rangeType:a.rangeType};if(l.startRow===u.startRow&&l.startColumn===u.startColumn||u.startRow<0||u.startColumn<0)return;const d={fromRange:l,toRange:u};this._commandService.executeCommand(zi.id,d)})))})}))}),this._context=e,this._selectionRenderService=t,this._selectionManagerService=n,this._commandService=s,this._initialize()}dispose(){var e;super.dispose(),(e=this._disposableCollection)==null||e.dispose()}};_c=V3([Vg(1,V(Zt)),Vg(2,V(q)),Vg(3,V(U))],_c);var H3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},D3=(e,t)=>(n,s)=>t(n,s,e);let va=class extends ae{constructor(e){super(),this._sheetPermissionInitController=e,this._initPermission()}_initPermission(){this._sheetPermissionInitController.initPermission()}};va=H3([D3(0,V(Dl))],va);var W3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},$s=(e,t)=>(n,s)=>t(n,s,e);let Ic=class extends Ms{constructor(e,t,n,s,i,r,o,a,l,u){super(),y(this,"disposableCollection",new Et),this._context=e,this._univerInstanceService=t,this._permissionService=n,this._selectionManagerService=s,this._rangeProtectionRuleModel=i,this._headerMoveRenderController=r,this._selectionRenderService=o,this._headerFreezeRenderController=a,this._rangeProtectionCache=l,this._headerResizeRenderController=u,this._initHeaderMovePermissionInterceptor(),this._initHeaderResizePermissionInterceptor(),this._initRangeFillPermissionInterceptor(),this._initRangeMovePermissionInterceptor()}_initHeaderMovePermissionInterceptor(){const e=this._headerMoveRenderController.interceptor.getInterceptPoints().HEADER_MOVE_PERMISSION_CHECK;this.disposeWithMe(this._headerMoveRenderController.interceptor.intercept(e,{handler:(t,n)=>{const s=Y(this._univerInstanceService);if(!s)return!1;const{unitId:i,subUnitId:r}=s;if(!this._permissionService.composePermission([new ne(i).id,new oe(i,r).id]).every(o=>o.value))return!1;if(!n)return!0;if(n.rangeType!==j.ROW&&n.rangeType!==j.COLUMN)return t;if(n.rangeType===j.ROW){for(let o=n.startRow;o<=n.endRow;o++)if(this._rangeProtectionCache.getRowPermissionInfo(i,r,o,[Ee.Edit])===!1)return!1}else for(let o=n.startColumn;o<=n.endColumn;o++)if(this._rangeProtectionCache.getColPermissionInfo(i,r,o,[Ee.Edit])===!1)return!1;return!0}}))}_initHeaderResizePermissionInterceptor(){this._headerResizeRenderController&&this.disposeWithMe(this._headerResizeRenderController.interceptor.intercept(this._headerResizeRenderController.interceptor.getInterceptPoints().HEADER_RESIZE_PERMISSION_CHECK,{handler:(e,t)=>{var n,s,i,r;const o=Y(this._univerInstanceService);if(!o)return!1;const{unitId:a,subUnitId:l}=o;if(t.row){if(((s=(n=this._permissionService.getPermissionPoint(new Kn(a,l).id))==null?void 0:n.value)!=null?s:!1)===!1)return!1}else if(t.col&&((r=(i=this._permissionService.getPermissionPoint(new Qn(a,l).id))==null?void 0:i.value)!=null?r:!1)===!1)return!1;return!0}}))}_initRangeFillPermissionInterceptor(){this.disposeWithMe(this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_FILL_PERMISSION_CHECK,{handler:(e,t)=>{var n,s,i;const r=Y(this._univerInstanceService);if(!r)return!1;const{worksheet:o,unitId:a,subUnitId:l}=r;if(!this._permissionService.composePermission([new ne(a).id,new oe(a,l).id,new nn(a,l).id,new mt(a,l).id]).every(p=>p.value))return!1;const u=(n=this._selectionManagerService.getCurrentSelections())==null?void 0:n.map(p=>p.range),d=u?.find(p=>{const f=rd(t.x,t.y,t.scene,t.skeleton),v=t.skeleton.getCellWithCoordByIndex(p.endRow,p.endColumn),C=Math.abs(v.endX-f.x),w=Math.abs(v.endY-f.y);return C<=5&&w<=5});if(!d)return!0;const{startRow:c,endRow:h,startColumn:g,endColumn:m}=d;for(let p=c;p<=h;p++)for(let f=g;f<=m;f++){const v=(i=(s=o.getCell(p,f))==null?void 0:s.selectionProtection)==null?void 0:i[0];if(v?.[Ee.Edit]===!1||v?.[Ee.View]===!1)return!1}return!0}}))}_initRangeMovePermissionInterceptor(){this.disposeWithMe(this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_MOVE_PERMISSION_CHECK,{handler:(e,t)=>{var n;const s=Y(this._univerInstanceService);if(!s)return!1;const{worksheet:i,unitId:r,subUnitId:o}=s;if(!this._permissionService.composePermission([new ne(r).id,new oe(r,o).id]).every(d=>d.value))return!1;const a=(n=this._selectionManagerService.getCurrentSelections())==null?void 0:n.map(d=>d.range),l=this._rangeProtectionRuleModel.getSubunitRuleList(r,o).reduce((d,c)=>[...d,...c.ranges],[]),u=a?.filter(d=>l.some(c=>z.intersects(c,d)));return!u?.some(d=>{var c,h;const{startRow:g,startColumn:m,endRow:p,endColumn:f}=d;for(let v=g;v<=p;v++)for(let C=m;C<=f;C++){const w=(h=(c=i.getCell(v,C))==null?void 0:c.selectionProtection)==null?void 0:h[0];if(w?.[Ee.Edit]===!1)return!0}return!1})}}))}_initFreezePermissionInterceptor(){this.disposeWithMe(this._headerFreezeRenderController.interceptor.intercept(this._headerFreezeRenderController.interceptor.getInterceptPoints().FREEZE_PERMISSION_CHECK,{handler:(e,t)=>{var n,s;const i=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);return!i?.getActiveSheet()||!i?!1:(s=(n=this._permissionService.getPermissionPoint(new ne(i.getUnitId()).id))==null?void 0:n.value)!=null?s:!1}}))}};Ic=W3([$s(1,P),$s(2,Je),$s(3,V(q)),$s(4,V(We)),$s(5,V(iu)),$s(6,Zt),$s(7,V(su)),$s(8,V(Is)),$s(9,Wc(gc))],Ic);var L3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ka=(e,t)=>(n,s)=>t(n,s,e);const B3="SHEET_PERMISSION_PASTE_PLUGIN";let Ca=class extends ae{constructor(e,t,n,s,i){super(),y(this,"disposableCollection",new Et),this._univerInstanceService=e,this._selectionManagerService=t,this._localService=n,this._sheetClipboardService=s,this._sheetPermissionCheckController=i,this._initClipboardHook()}_initClipboardHook(){this.disposeWithMe(this._sheetClipboardService.addClipboardHook({id:B3,onBeforePaste:e=>{var t,n,s;const[i]=Zr([e.range]).ranges,r=(t=this._selectionManagerService.getCurrentLastSelection())==null?void 0:t.range;if(!r)return!1;const o={startRow:r.startRow+i.startRow,endRow:r.startRow+i.endRow,startColumn:r.startColumn+i.startColumn,endColumn:r.startColumn+i.endColumn},a=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet();if(!a)return!1;const{startRow:l,endRow:u,startColumn:d,endColumn:c}=o;let h=!0;for(let g=l;g<=u;g++)for(let m=d;m<=c;m++){const p=(s=(n=a.getCell(g,m))==null?void 0:n.selectionProtection)==null?void 0:s[0];if(p?.[Ee.Edit]===!1){h=!1;break}}return h||this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localService.t("permission.dialog.pasteErr")),h}}))}};Ca=L3([Ka(0,P),Ka(1,V(q)),Ka(2,V(Oe)),Ka(3,V(hs)),Ka(4,V(Yr))],Ca);var j3=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Gu=(e,t)=>(n,s)=>t(n,s,e);let Rc=class extends Ms{constructor(e,t,n,s,i){super(),y(this,"disposableCollection",new Et),this._context=e,this._univerInstanceService=t,this._permissionService=n,this._statusBarController=s,this._rangeProtectionCache=i,this._initStatusBarPermissionInterceptor()}_initStatusBarPermissionInterceptor(){this.disposeWithMe(this._statusBarController.interceptor.intercept(this._statusBarController.interceptor.getInterceptPoints().STATUS_BAR_PERMISSION_CORRECT,{priority:100,handler:(e,t)=>{var n;const s=Y(this._univerInstanceService);if(!s)return e??[];const{worksheet:i,unitId:r,subUnitId:o}=s;return((n=this._permissionService.getPermissionPoint(new cr(r,o).id))==null?void 0:n.value)===!1?t.forEach(a=>{const l=a.getArrayValue();l.forEach((u,d)=>{u.forEach((c,h)=>{l[d][h]=av.create()})})}):t.forEach(a=>{const l=a.getArrayValue(),u=a.getCurrentRow(),d=a.getCurrentColumn();l.forEach((c,h)=>{c.forEach((g,m)=>{var p;if(((p=i.getCellRaw(h+u,m+d))==null?void 0:p.v)===void 0)return;const f=this._rangeProtectionCache.getCellInfo(r,o,h+u,m+d);f?.[Ee.View]===!1&&(l[h][m]=av.create())})})}),t}}))}};Rc=j3([Gu(1,P),Gu(2,Je),Gu(3,V(Jr)),Gu(4,V(Is))],Rc);const u_=(e,t,n,s,i)=>{const r=e.get(Oe),o=e.get(ft),a=e.get(We);let l="";if(t.length===0)l=r.t("permission.panel.emptyRangeError");else if(t.length>1){let u=!1;for(let d=0;d<t.length;d++){for(let c=d+1;c<t.length;c++)if(z.intersects(t[d],t[c])){u=!0;break}if(u)break}u&&(l=r.t("permission.panel.rangeOverlapError"))}if(!l){if(o.getRule(s,i)&&!n)return l=r.t("permission.panel.rangeOverlapOverPermissionError"),l;const u=a.getSubunitRuleList(s,i).filter(d=>d.permissionId!==n).find(d=>d.ranges.some(c=>t.some(h=>z.intersects(c,h))));u!=null&&u.ranges.find(d=>t.some(c=>z.intersects(d,c)))&&(l=r.t("permission.panel.rangeOverlapOverPermissionError"))}return l===""?void 0:l},F3=(e,t)=>{if(e.length!==1)return!1;const n=e[0],s=t.getRowCount(),i=t.getColumnCount(),{startRow:r,endRow:o,startColumn:a,endColumn:l}=n;return r===0&&a===0&&o===s-1&&l===i-1},z3=(e,t)=>{var n,s;const i=e.get(P),r=e.get(q),o=i.getCurrentUnitForType(A.UNIVER_SHEET),a=o.getActiveSheet();let l=se.SelectRange,u=(s=(n=r.getCurrentSelections())==null?void 0:n.map(d=>d.range))!=null?s:[];return t&&(l=se.Worksheet,u=[{startRow:0,startColumn:0,endRow:a.getRowCount()-1,endColumn:a.getColumnCount()-1,rangeType:j.ALL}]),{unitId:o.getUnitId(),subUnitId:a.getSheetId(),permissionId:"",unitType:l,description:"",id:"",ranges:u,editState:Ft.OnlyMe,viewState:dn.OthersCanView}},X3=(e,t)=>{const n=e.get(P).getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet(),{unitType:s}=t;return s===se.Worksheet?{...t,ranges:[{startRow:0,startColumn:0,endRow:n.getRowCount()-1,endColumn:n.getColumnCount()-1,rangeType:j.ALL}]}:t},Y3=e=>{const{viewState:t,editState:n,permissionId:s,ranges:i,rangesErrMsg:r,desc:o,oldRule:a,id:l}=e,u=G(Gr),d=G(_a),c=G(Ys),h=G(Oe),g=G(U),m=G(co),p=G(P).getCurrentUnitForType(A.UNIVER_SHEET),f=p?.getActiveSheet();if(!p||!f)return null;const v=p.getUnitId(),C=f.getSheetId();return S.jsxs("div",{className:"univer-mt-auto univer-flex univer-flex-row-reverse univer-gap-2 univer-py-5",children:[S.jsx(us,{variant:"primary",onClick:async()=>{if(r)return;const w={unitId:v,subUnitId:C,permissionId:s,id:l,viewState:t,editState:n,unitType:se.SelectRange,ranges:i,description:o};F3(i,f)&&(w.unitType=se.Worksheet,w.ranges=[]);let b=m.selectUserList;w.editState===Ft.OnlyMe&&(b=[],m.setSelectUserList([]));const I={read:w.viewState===dn.OthersCanView?Us.AllCollaborator:Us.SomeCollaborator,edit:w.editState===Ft.DesignedUserCanEdit?Us.SomeCollaborator:Us.OneSelf};if(w.editState===Ft.DesignedUserCanEdit&&b.length===0&&(b=[],I.edit=Us.OneSelf),w.permissionId){const R=wk(b.filter(O=>O.role===Xn.Editor),m.oldCollaboratorList.filter(O=>O.role===Xn.Editor)),M=a?.viewState===w.viewState,x=a?.editState===w.editState,N=w.unitType===a?.unitType&&w.description===a.description&&w.ranges===a.ranges,T=!R||!M||!x;if(N&&T)await c.update({objectType:w.unitType,objectID:w.permissionId,unitID:w.unitId,share:void 0,name:"",strategies:[],scope:I,collaborators:{collaborators:b}});else{let O=w.permissionId;T&&(w.unitType===se.Worksheet?O=await c.create({worksheetObject:{collaborators:b,unitID:w.unitId,name:"",strategies:[{role:Xn.Editor,action:Ee.Edit},{role:Xn.Reader,action:Ee.View}],scope:I},objectType:se.Worksheet}):O=await c.create({selectRangeObject:{collaborators:b,unitID:w.unitId,name:"",scope:I},objectType:se.SelectRange})),g.executeCommand(OS.id,{rule:{...w,permissionId:O},oldRule:a})}}else if(w.unitType===se.Worksheet){const R=await c.create({worksheetObject:{collaborators:b,unitID:w.unitId,name:"",strategies:[{role:Xn.Editor,action:Ee.Edit},{role:Xn.Reader,action:Ee.View}],scope:I},objectType:se.Worksheet}),{ranges:M=[],...x}=w;x.permissionId=R,g.executeCommand(Dp.id,{rule:x,unitId:w.unitId})}else if(w.unitType===se.SelectRange){const R=await c.create({selectRangeObject:{collaborators:b,unitID:w.unitId,name:"",scope:I},objectType:se.SelectRange});g.executeCommand(zw.id,{rule:w,permissionId:R})}const _={header:{title:`${h.t("permission.panel.title")}`},children:{label:zl,showDetail:!1},width:330};d.open(_)},children:h.t("permission.button.confirm")}),S.jsx(us,{onClick:()=>{u.reset(),m.reset(),d.close()},children:h.t("permission.button.cancel")})]})},Z3=e=>{const{ranges:t,onRangesChange:n,desc:s,onDescChange:i,rangesErrMsg:r,permissionId:o}=e,a=G(Tn),l=L.useMemo(()=>a.get(JS),[]),u=G(P),d=G(Oe),c=G(pt),h=u.getCurrentUnitForType(A.UNIVER_SHEET),g=h?.getActiveSheet();if(!h||!g)return null;const m=h.getUnitId(),p=g.getSheetId(),f=v=>{const C=v.split(",").map(hu).map(x=>x.range);if(C.some(x=>!RI(x)||x.endColumn<x.startColumn||x.endRow<x.startRow))return;const w=u.getCurrentUnitForType(A.UNIVER_SHEET),b=w?.getActiveSheet();if(!w||!b)return;const I=w.getUnitId(),_=b.getSheetId(),R=C.map(x=>{const N=b.getRowCount(),T=b.getColumnCount();return ey(x,N,T),x}),M=u_(c,R,o,I,_);n(R,M)};return S.jsxs(S.Fragment,{children:[S.jsx(Id,{className:"univer-font-medium",label:d.t("permission.panel.protectedRange"),error:r,children:l&&S.jsx(l,{unitId:m,subUnitId:p,initialValue:t?.map(v=>gu(v)).join(","),onChange:(v,C)=>f(C)})}),S.jsx(Id,{className:"univer-font-medium",label:d.t("permission.panel.permissionDirection"),children:S.jsx(_d,{value:s,onChange:v=>i(v),placeholder:d.t("permission.panel.permissionDirectionPlaceholder")})})]})},d_="data:image/png;base64,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",G3=e=>{const{editState:t,onEditStateChange:n,viewState:s,onViewStateChange:i,permissionId:r}=e,o=G(Oe),a=G(uu),l=G(Ys),u=G(co),d=G(Bn),c=G(P),h=zt(u.selectUserList$,u.selectUserList),g=c.getCurrentUnitForType(A.UNIVER_SHEET),m=g?.getActiveSheet();if(!g||!m)return null;const p=g.getUnitId(),f=async()=>{const v=await l.listCollaborators({objectID:p,unitID:p}),C=d.getCurrentUser();u.setCanEditUserList(v.filter(w=>{var b;return((b=w.subject)==null?void 0:b.userID)!==C.userID})),a.open({id:tc,title:{title:""},children:{label:pb},width:280,destroyOnClose:!0,closable:!1,onClose:()=>a.close(tc),className:"sheet-permission-user-dialog"})};return L.useEffect(()=>{r?(async()=>{const v=(await l.listCollaborators({objectID:r,unitID:p})).filter(C=>C.role===Xn.Editor);v.length>0&&n(Ft.DesignedUserCanEdit),u.setSelectUserList(v),u.setOldCollaboratorList(v)})():(u.setSelectUserList([]),u.setOldCollaboratorList([]))},[]),S.jsxs(S.Fragment,{children:[S.jsx(Id,{className:"univer-font-medium",label:o.t("permission.panel.editPermission"),children:S.jsxs(Jg,{value:t,onChange:v=>n(v),className:"univer-flex univer-flex-col",children:[S.jsx(Mo,{value:Ft.OnlyMe,children:S.jsx("span",{children:o.t("permission.panel.onlyICanEdit")})}),S.jsx(Mo,{value:Ft.DesignedUserCanEdit,children:S.jsx("span",{children:o.t("permission.panel.designedUserCanEdit")})})]})}),t===Ft.DesignedUserCanEdit&&S.jsxs("div",{className:Ke("univer-mb-2 univer-flex univer-h-[270px] univer-flex-col univer-overflow-y-auto univer-rounded-lg univer-p-3",Ra),children:[S.jsxs("div",{className:"univer-flex univer-items-center univer-justify-between univer-text-sm",children:[S.jsx("span",{children:o.t("permission.panel.designedPerson")}),S.jsx("span",{className:"univer-cursor-pointer univer-text-primary-600",onClick:f,children:o.t("permission.panel.addPerson")})]}),S.jsx("div",{className:"univer-my-2 univer-h-px univer-bg-gray-200"}),S.jsx("div",{className:"univer-flex-1",children:h?.length>0?h.map(v=>{var C,w,b;return S.jsxs("div",{className:"univer-mb-3 univer-flex univer-h-7 univer-items-center univer-leading-7 last:univer-mb-0",children:[S.jsx(ep,{size:24,src:(C=v.subject)==null?void 0:C.avatar}),S.jsx("span",{className:"univer-ml-1.5 univer-w-[130px] univer-truncate univer-text-gray-900 dark:!univer-text-white",children:(w=v.subject)==null?void 0:w.name}),S.jsx(bw,{className:"!univer-w-[90px] univer-min-w-0 univer-cursor-pointer",borderless:!0,value:"edit",options:[{label:`${o.t("permission.panel.canEdit")}`,value:"edit"},{label:`${o.t("permission.panel.delete")}`,value:"delete"}],onChange:I=>{I==="delete"&&u.setSelectUserList(h.filter(_=>{var R,M;return((R=_.subject)==null?void 0:R.userID)!==((M=v.subject)==null?void 0:M.userID)}))}})]},(b=v.subject)==null?void 0:b.userID)}):S.jsxs("div",{className:"univer-flex univer-h-full univer-flex-col univer-items-center univer-justify-center",children:[S.jsx("img",{width:240,height:120,src:d_,alt:""}),S.jsx("p",{className:"univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",children:o.t("permission.dialog.userEmpty")})]})})]}),S.jsx(Id,{className:"univer-font-medium",label:o.t("permission.panel.viewPermission"),children:S.jsxs(Jg,{value:s,onChange:v=>i(v),className:"univer-flex univer-flex-col last:univer-mb-0",children:[S.jsx(Mo,{value:dn.OthersCanView,children:S.jsx("span",{children:o.t("permission.panel.othersCanView")})}),S.jsx(Mo,{value:dn.NoOneElseCanView,children:S.jsx("span",{children:o.t("permission.panel.noOneElseCanView")})})]})})]})},q3=e=>{var t,n;const{fromSheetBar:s,rule:i,oldRule:r}=e,o=G(pt),a=G(Tn),l=i?X3(o,i):z3(o,s),[u,d]=L.useState(l.ranges),[c,h]=L.useState(()=>u_(o,l.ranges,l.permissionId,l.unitId,l.subUnitId)),[g,m]=L.useState(l.description),[p,f]=L.useState((t=l.editState)!=null?t:Ft.OnlyMe),[v,C]=L.useState((n=l.viewState)!=null?n:dn.OthersCanView),w=a.get(_h),b=w??G3;return L.useEffect(()=>{const I=o.get(P),_=o.get(_a),R=I.getCurrentUnitOfType(A.UNIVER_SHEET);if(!R)return;const M=R.getActiveSheet().getSheetId(),x=R.activeSheet$.subscribe(N=>{N?.getSheetId()!==M&&_.close()});return()=>{x.unsubscribe()}},[]),S.jsxs("div",{className:"univer-mt-4 univer-flex univer-h-[calc(100%-16px)] univer-flex-col",children:[S.jsx(Z3,{permissionId:l.permissionId,ranges:u,onRangesChange:(I,_)=>{d(I),h(_)},rangesErrMsg:c,desc:g,onDescChange:I=>m(I)}),S.jsx(b,{editState:p,onEditStateChange:I=>f(I),viewState:v,onViewStateChange:I=>C(I),permissionId:l.permissionId}),S.jsx(Y3,{permissionId:l.permissionId,id:l.id,ranges:u,rangesErrMsg:c,desc:g,viewState:v,editState:p,oldRule:r})]})},Q3="data:image/png;base64,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";function K3(){var e;const[t,n]=L.useState(!0),[s,i]=L.useState(!1),[r,o]=L.useState([]),a=G(Oe),l=G(We),u=G(ft),d=G(P),c=G(U),h=G(_a),g=G(Ys),m=G(Je),p=G(Bn).getCurrentUser(),f=G(co),v=zt(u.ruleRefresh$,""),C=zt(l.ruleRefresh$,""),w=d.getCurrentUnitOfType(A.UNIVER_SHEET);if(!w)return null;const b=w.getUnitId(),I=L.useCallback(async k=>{var D;const B=w.getActiveSheet(),W=w.getUnitId(),F=B.getSheetId(),K=[],J=[];w.getSheets().forEach(ue=>{const ge=ue.getSheetId();l.getSubunitRuleList(W,ge).forEach(Ue=>{Ue.permissionId&&K.push(Ue.permissionId)});const be=u.getRule(W,ge);be!=null&&be.permissionId&&J.push(be.permissionId)});const ee=[...K,...J],we=await g.list({objectIDs:ee,unitID:W,actions:Vi}),Ge=l.getSubunitRuleList(W,F).map(ue=>ue.permissionId),Ae=(D=u.getRule(W,F))==null?void 0:D.permissionId;Ae&&Ge.push(Ae);const Ze=we.filter(ue=>{var ge;return Ge.includes(ue.objectID)||ue.objectID===((ge=u.getRule(W,F))==null?void 0:ge.permissionId)});return k?Ze:we},[]),[_,R]=L.useState([]);L.useEffect(()=>{const k=Ut(l.ruleChange$,u.ruleChange$).subscribe(async()=>{const D=await I(t);R(D)});return()=>{k.unsubscribe()}},[t]),L.useEffect(()=>{const k=w.activeSheet$.pipe(yn((D,B)=>D?.getSheetId()===B?.getSheetId())).subscribe(async()=>{const D=await I(t);R(D)});return()=>{k.unsubscribe()}},[t]),L.useEffect(()=>{(async()=>{if(v||C){const k=await I(!0);R(k)}})()},[v,C]);function M(k){const{unitId:D,subUnitId:B,unitType:W}=k;let F;W===ii.Worksheet?F=c.executeCommand(Ul.id,{unitId:D,subUnitId:B,rule:k}):W===ii.SelectRange&&(F=c.executeCommand(kS.id,{unitId:D,subUnitId:B,rule:k})),F&&(i(!s),k.ranges===r&&o([]))}L.useEffect(()=>{f.reset()},[]),l3(r);const x=L.useMemo(()=>{const k=new Map;return w.getSheets().forEach(D=>{const B=D.getSheetId();l.getSubunitRuleList(b,B).forEach(F=>{k.set(F.permissionId,F)});const W=u.getRule(b,B);W&&k.set(W?.permissionId,W)}),k},[b,w,l,u]),N=k=>{k.subUnitId!==w.getActiveSheet().getSheetId()&&c.executeCommand(lt.id,{unitId:k.unitId,subUnitId:k.subUnitId});const D={header:{title:"permission.panel.title"},children:{label:zl,showDetail:!0,rule:Q.deepClone(k),oldRule:Q.deepClone(k)},width:330};h.open(D)},T=k=>{n(k)},O=(e=m.getPermissionPoint(new oo(b).id))==null?void 0:e.value;return S.jsxs("div",{className:"univer-mt-2 univer-flex univer-h-[calc(100%-8px)] univer-flex-col",children:[S.jsxs("div",{className:"univer-flex univer-h-[30px] univer-py-2",children:[S.jsxs("div",{className:"univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center",onClick:()=>T(!0),children:[S.jsxs("div",{className:Ke("univer-h-6 univer-text-base univer-font-medium univer-leading-6",{"univer-text-blue-500":t}),children:[" ",a.t("permission.panel.currentSheet")]}),S.jsx("div",{className:Ke("univer-mt-1 univer-h-0.5 univer-w-6",{"univer-bg-blue-500":t})})]}),S.jsxs("div",{className:"univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center",onClick:()=>T(!1),children:[S.jsx("div",{className:Ke("univer-h-6 univer-text-base univer-font-medium univer-leading-6",{"univer-text-blue-500":!t}),children:a.t("permission.panel.allSheet")}),S.jsx("div",{className:Ke("univer-mt-1 univer-h-0.5 univer-w-6",{"univer-bg-blue-500":!t})})]})]}),_?.length>0?S.jsx("div",{children:_?.map(k=>{var D,B,W,F,K;const J=x.get(k.objectID);if(!J)return null;const ee=k.actions.find(Ye=>Ye.action===Ee.Edit),we=ee?.allowed,Ge=k.actions.find(Ye=>Ye.action===Ee.View),Ae=Ge?.allowed,Ze=k.actions.find(Ye=>Ye.action===Ee.ManageCollaborator),ue=k.actions.find(Ye=>Ye.action===Ee.Delete),ge=Ze?.allowed||p.userID===((D=k.creator)==null?void 0:D.userID),be=ue?.allowed||p.userID===((B=k.creator)==null?void 0:B.userID);let Ue="";const Rt=w.getSheetBySheetId(J.subUnitId),ke=Rt?.getName();if(J.unitType===ii.SelectRange){const Ye=J.ranges,Ot=Ye!=null&&Ye.length?Ye.map(ut=>{const re=gu(ut);return re==="NaN"?"":re}).filter(ut=>!!ut).join(","):"";Ue=`${ke}(${Ot})`}else J.unitType===ii.Worksheet&&(Ue=ke||"");return S.jsxs("div",{className:Ke("univer-mt-3 univer-rounded-lg univer-p-3 hover:univer-bg-gray-50",Ra),onMouseMove:()=>{const{subUnitId:Ye,unitType:Ot}=J,ut=w.getActiveSheet();if(!ut)return!1;const re=ut.getSheetId();if(Ye!==re)return!1;if(Ot===ii.SelectRange){const Ie=J.ranges||[];Ie!==r&&o(Ie)}else if(Ot===ii.Worksheet){const Ie=[{startRow:0,endRow:ut.getRowCount()-1,startColumn:0,endColumn:ut.getColumnCount()-1}];Ie!==r&&o(Ie)}},onMouseLeave:()=>o([]),children:[S.jsxs("div",{className:"univer-flex univer-h-5 univer-justify-between univer-leading-5",children:[S.jsx(Hi,{title:Ue,children:S.jsx("div",{className:"univer-max-w-[200px] univer-truncate univer-text-sm univer-font-medium",children:Ue})}),(ge||be)&&S.jsxs("div",{className:"univer-flex univer-items-center",children:[ge&&S.jsx(Hi,{title:a.t("permission.panel.edit"),children:S.jsx("div",{className:"univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",onClick:()=>N(J),children:S.jsx(kf,{})})}),be&&S.jsx(Hi,{title:a.t("permission.panel.delete"),children:S.jsx("div",{className:"univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",onClick:()=>M(J),children:S.jsx(Ah,{})})})]})]}),S.jsx("div",{className:"univer-my-2 univer-h-px univer-bg-gray-200"}),S.jsxs("div",{children:[S.jsxs("div",{className:"univer-flex univer-items-center",children:[S.jsx(Hi,{title:(F=(W=k.creator)==null?void 0:W.name)!=null?F:"",children:S.jsx("div",{children:S.jsx(ep,{src:(K=k.creator)==null?void 0:K.avatar,className:"univer-mr-1.5",size:24})})}),S.jsx("span",{className:"univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:a.t("permission.panel.created")}),S.jsx("span",{className:"univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:we?`${a.t("permission.panel.iCanEdit")}`:`${a.t("permission.panel.iCanNotEdit")}`})]}),S.jsxs("div",{className:"univer-mt-2 univer-flex univer-items-center",children:[S.jsx("span",{className:"univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:a.t("permission.panel.viewPermission")}),S.jsx("span",{className:"univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:Ae?`${a.t("permission.panel.iCanView")}`:`${a.t("permission.panel.iCanNotView")}`})]}),J.description&&S.jsx(Hi,{title:J.description,children:S.jsx("div",{className:"univer-text-3 univer-mt-2 univer-max-w-64 univer-truncate univer-text-sm univer-text-gray-400",children:J.description})})]})]},k.objectID)})}):S.jsxs("div",{className:"univer-flex univer-flex-1 univer-flex-col univer-items-center univer-justify-center",children:[S.jsx("img",{width:240,height:120,src:Q3,alt:"",draggable:!1}),S.jsx("p",{className:"univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",children:a.t("permission.dialog.listEmpty")})]}),O&&S.jsx("div",{className:"univer-mt-auto univer-py-5",children:S.jsxs(us,{className:"univer-w-full",variant:"primary",onClick:()=>{const k={header:{title:`${a.t("permission.panel.title")}`},children:{label:zl,showDetail:!0},width:330};h.open(k)},children:[S.jsx("div",{children:"+ "}),a.t("permission.button.addNewPermission")]})})]})}const $3=({showDetail:e,fromSheetBar:t,rule:n,oldRule:s})=>{var i;const r=G(P),o=G(q);if(!G(Gr).getVisible())return null;const a=Y(r);if(!a)return null;const{worksheet:l}=a,u=((i=o.getCurrentSelections())==null?void 0:i.map(d=>d.range)).reduce((d,c)=>d+qc(l.getName(),c),"");return e?S.jsx(q3,{fromSheetBar:t,rule:n,oldRule:s},t?"sheet-bar":"normal"):S.jsx(K3,{},u)},J3=({loading:e,children:t})=>S.jsxs("div",{className:"univer-relative univer-size-full",children:[e&&S.jsx("div",{className:"univer-absolute -univer-bottom-0.5 -univer-left-0.5 -univer-right-0.5 -univer-top-0.5 univer-z-10 univer-flex univer-items-center univer-justify-center univer-bg-white univer-backdrop-blur dark:!univer-bg-black",children:S.jsx("div",{className:"univer-size-10 univer-animate-spin univer-rounded-full univer-border-4 univer-border-solid univer-border-gray-100 univer-border-t-primary-500"})}),S.jsx("div",{className:e?"univer-pointer-events-none univer-blur-sm":"",children:t})]}),e9=()=>{const e=G(Oe),t=G(P),n=G(Ys),s=G(_i),i=G(uu),r=G(Je),o=t.getCurrentUnitForType(A.UNIVER_SHEET),a=o.getActiveSheet();if(!a)throw new Error("No active sheet found");const[l,u]=L.useState([]),d=G(U),[c,h]=L.useState(()=>!!s.getRule(o.getUnitId(),a.getSheetId())),[g,m]=L.useState(()=>Object.keys(Fu).reduce((f,v)=>(f[v]={text:e.t(`permission.panel.${Fu[Number(v)]}`),allowed:!0},f),{}));L.useEffect(()=>{(async()=>{const f=o.getUnitId(),v=await n.listCollaborators({objectID:f,unitID:f});u(v)})()},[]),L.useEffect(()=>{(async()=>{const f=o.getUnitId(),v=s.getRule(f,a.getSheetId());if(!v)return;h(!0);const C=(await n.list({unitID:o.getUnitId(),objectIDs:[v.permissionId],actions:sk}))[0].strategies.reduce((w,b)=>(Fu[b.action]&&(w[b.action]={text:e.t(`permission.panel.${Fu[b.action]}`),allowed:b.role!==Xn.Owner}),w),{});m(C),setTimeout(()=>{h(!1)},100)})()},[]);const p=async()=>{const f=t.getCurrentUnitForType(A.UNIVER_SHEET),v=f?.getActiveSheet();if(!v)throw new Error("No active sheet found");const C=f.getUnitId(),w=v.getSheetId(),b=s.getRule(C,w),I=Object.keys(g).map(R=>({action:Number(R),role:g[R].allowed?Xn.Editor:Xn.Owner}));let _=b?.permissionId;_?n.update({objectType:ii.Worksheet,objectID:_,unitID:C,strategies:I,share:void 0,name:"",scope:{read:Us.AllCollaborator,edit:Us.AllCollaborator},collaborators:void 0}).then(()=>{_n().forEach(R=>{const M=new R(C,w),x=M.subType,N=I.find(T=>T.action===x);N&&r.updatePermissionPoint(M.id,N.role===Xn.Editor)})}):(_=await n.create({objectType:ii.Worksheet,worksheetObject:{unitID:C,collaborators:l,name:"",strategies:I,scope:{read:Us.AllCollaborator,edit:Us.AllCollaborator}}}),d.executeCommand(WS.id,{rule:{permissionId:_,unitId:C,subUnitId:w}}))};return S.jsx(J3,{loading:c,children:S.jsxs("div",{className:Ke("univer-flex univer-flex-col",bd),children:[Object.keys(g).map(f=>{const v=g[f],{text:C,allowed:w}=v;return S.jsxs("div",{className:"univer-my-1.5 univer-flex univer-h-5 univer-items-center univer-justify-between univer-leading-5",children:[S.jsx("div",{children:C}),S.jsx(f0,{defaultChecked:w,onChange:()=>{m({...g,[f]:{...v,allowed:!w}})}})]},C)}),S.jsxs("div",{className:Ke("univer-flex univer-h-9 univer-items-center univer-justify-end univer-gap-2 univer-pt-2",bd),children:[S.jsx(us,{onClick:()=>{i.close(nc)},children:e.t("permission.button.cancel")}),S.jsx(us,{variant:"primary",onClick:()=>{p(),i.close(nc)},children:e.t("permission.button.confirm")})]})]})})},t9=()=>{var e;const[t,n]=L.useState(""),s=G(Oe),i=G(uu),r=G(co),o=zt(r.userList$,r.userList),a=(e=o?.filter(c=>{var h;return((h=c.subject)==null?void 0:h.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()))&&c.role===Xn.Editor}))!=null?e:[],[l,u]=L.useState(r.selectUserList),d=c=>{if(l?.findIndex(h=>{var g,m;return((g=h.subject)==null?void 0:g.userID)===((m=c.subject)==null?void 0:m.userID)})===-1){const h={...c};u([...l,h])}else{const h=l.filter(g=>{var m,p;return((m=g.subject)==null?void 0:m.userID)!==((p=c.subject)==null?void 0:p.userID)});u(h)}};return S.jsxs("div",{children:[S.jsx("div",{children:S.jsx(_d,{className:"univer-w-full",placeholder:s.t("permission.dialog.search"),value:t,onChange:c=>n(c)})}),S.jsx("div",{className:Ke("univer-h-60 univer-overflow-y-auto",cu),children:a?.length>0?a?.map(c=>{var h,g,m;return S.jsxs("div",{className:"univer-my-2 univer-flex univer-items-center univer-rounded-md hover:univer-bg-gray-50",onClick:()=>d(c),children:[S.jsx(ep,{src:(h=c.subject)==null?void 0:h.avatar,size:24}),S.jsx("div",{className:"univer-ml-1.5 univer-flex-1",children:(g=c.subject)==null?void 0:g.name}),l?.findIndex(p=>{var f,v;return((f=p.subject)==null?void 0:f.userID)===((v=c.subject)==null?void 0:v.userID)})!==-1&&S.jsx("div",{children:S.jsx(mo,{})})]},(m=c.subject)==null?void 0:m.userID)}):S.jsxs("div",{className:"univer-flex univer-h-full univer-flex-col univer-items-center",children:[S.jsx("img",{className:"univer-w-full",src:d_,alt:"empty list",draggable:!1}),S.jsx("p",{className:"univer-text-sm univer-text-gray-400",children:s.t("permission.dialog.userEmpty")})]})}),S.jsx("div",{className:"univer-h-px univer-w-full univer-bg-gray-200"}),S.jsxs("div",{className:"univer-flex univer-items-center univer-justify-end univer-gap-1 univer-py-2",children:[S.jsx(us,{onClick:()=>i.close(tc),children:s.t("permission.button.cancel")}),S.jsx(us,{variant:"primary",onClick:()=>{r.setSelectUserList(l),i.close(tc)},children:s.t("permission.button.confirm")})]})]})},n9=({errorMsg:e})=>{const t=G(Oe);return S.jsx("div",{children:S.jsx("p",{className:"univer-m-0",children:e||t.t("permission.dialog.alertContent")})})},c_="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNCIgaGVpZ2h0PSI0IiB2aWV3Qm94PSIwIDAgNCA0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8bWFzayBpZD0ibWFzazBfNzU5XzExMDgiIHN0eWxlPSJtYXNrLXR5cGU6YWxwaGEiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAiIHk9IjAiIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjRDZEOEQ5Ii8+CjwvbWFzaz4KPGcgbWFzaz0idXJsKCNtYXNrMF83NTlfMTEwOCkiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTS0zLjY0MDAyIDMuNDQxNDFMMi4wNzM5NyAtMi4yNzI1OEwyLjc4MTA4IC0xLjU2NTQ4TC0yLjkzMjkxIDQuMTQ4NTJMLTMuNjQwMDIgMy40NDE0MVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0tMS41MTg2OCA1LjU2Mjc1TDQuMTk1MzEgLTAuMTUxMjQ1TDQuOTAyNDIgMC41NTU4NjJMLTAuODExNTc1IDYuMjY5ODZMLTEuNTE4NjggNS41NjI3NVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wLjYwMjY1NiA3LjY4NDAzTDYuMzE2NjUgMS45NzAwM0w3LjAyMzc2IDIuNjc3MTRMMS4zMDk3NiA4LjM5MTEzTDAuNjAyNjU2IDcuNjg0MDNaIiBmaWxsPSIjRDZEOERCIi8+CjwvZz4KPC9zdmc+",Vf="RANGE_PROTECTION_CAN_VIEW_RENDER_EXTENSION_KEY",Hf="RANGE_PROTECTION_CAN_NOT_VIEW_RENDER_EXTENSION_KEY",s9=25,i9=80;class h_ extends Cw{constructor(t){super(),y(this,"_pattern",null),y(this,"_img",new Image),y(this,"renderCache",new Set),y(this,"_shadowStrategy","always"),this._img.src=c_,t&&(this._shadowStrategy=t)}clearCache(){this.renderCache.clear()}setShadowStrategy(t){this._shadowStrategy=t,this.clearCache()}getShadowStrategy(){return this._shadowStrategy}draw(t,n,s){const{worksheet:i}=s;i&&(t.save(),this._pattern||(this._pattern=t.createPattern(this._img,"repeat")),this.renderCache.clear(),De.foreach(s.rowColumnSegment,(r,o)=>{if(!i.getRowVisible(r)||!i.getColVisible(o))return;const{selectionProtection:a=[]}=i.getCell(r,o)||{};this._pattern&&(t.fillStyle=this._pattern,a.forEach(l=>{if(l.ruleId&&this.shouldRender(l)){if(this.renderCache.has(l.ruleId))return;this.renderCache.add(l.ruleId),l.ranges.forEach(u=>{const d=s.getCellWithCoordByIndex(u.startRow,u.startColumn,!1),c=s.getCellWithCoordByIndex(u.endRow,u.endColumn,!1);t.fillRect(d.startX,d.startY,c.endX-d.startX,c.endY-d.startY)})}}))}),t.restore())}}class r9 extends h_{constructor(t){super(t),y(this,"uKey",Vf),y(this,"Z_INDEX",s9)}shouldRender(t){return this._shadowStrategy==="none"?!1:this._shadowStrategy==="non-editable"?t?.[Ee.View]!==!1&&t?.[Ee.Edit]===!1:this._shadowStrategy==="non-viewable"?t?.[Ee.View]===!1:t?.[Ee.View]!==!1}}class o9 extends h_{constructor(t){super(t),y(this,"uKey",Hf),y(this,"Z_INDEX",i9)}shouldRender(t){return this._shadowStrategy==="none"?!1:t?.[Ee.View]===!1}}const Df="worksheet-protection",xC=25,a9=80;class l9 extends Cw{constructor(t){super(),y(this,"uKey",Df),y(this,"Z_INDEX",xC),y(this,"_pattern"),y(this,"_img",new Image),y(this,"_shadowStrategy","always"),this._img.src=c_,t&&(this._shadowStrategy=t)}draw(t,n,s){const{worksheet:i}=s;if(!i)return!1;t.save(),this._pattern||(this._pattern=t.createPattern(this._img,"repeat"));const{startRow:r,startColumn:o,endRow:a,endColumn:l}=s.rowColumnSegment,u=s.getCellWithCoordByIndex(r,o,!1),d=s.getCellWithCoordByIndex(a,l,!1),{hasWorksheetRule:c=!1,selectionProtection:h=[]}=i.getCell(r,o)||{};if(!this._pattern)return;if(h.length>0){const m=h[0];m?.[Ee.View]?this.setZIndex(xC):this.setZIndex(a9)}t.fillStyle=this._pattern;let g=c;if(this._shadowStrategy==="none")g=!1;else if(c&&h.length>0){const m=h[0];this._shadowStrategy==="non-editable"?g=m?.[Ee.Edit]===!1:this._shadowStrategy==="non-viewable"&&(g=m?.[Ee.View]===!1)}g&&t.fillRect(u.startX,u.startY,d.endX-u.startX,d.endY-u.startY),t.restore()}setShadowStrategy(t){this._shadowStrategy=t}getShadowStrategy(){return this._shadowStrategy}setZIndex(t){this.Z_INDEX=t}}var Wf=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},As=(e,t)=>(n,s)=>t(n,s,e);let wa=class extends ae{constructor(e,t){super(),this._injector=e,this._componentManager=t,this._init()}_init(){this._initComponents(),this._initUiPartComponents()}_initComponents(){[[vb,Ub],[ik,Ah],[rk,kf],[ok,mo],[Cb,xf],[zl,$3],[pb,t9],[fb,e9],[v1,n9]].forEach(([e,t])=>{this.disposeWithMe(this._componentManager.register(e,t))})}_initUiPartComponents(){const e=this._injector.get(Lt).getConfig(Jt);if(e!=null&&e.protectedRangeUserSelector){const{component:t,framework:n}=e.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(_h,t,{framework:n}))}}};wa=Wf([As(0,V(pt)),As(1,V(Tn))],wa);let yc=class extends ae{constructor(e,t,n,s,i){super(),y(this,"_rangeProtectionCanViewRenderExtension"),y(this,"_rangeProtectionCanNotViewRenderExtension"),this._context=e,this._rangeProtectionRuleModel=t,this._sheetSkeletonManagerService=n,this._permissionService=s,this._configService=i;const r=this._configService.getConfig(Jt),o=If(r?.protectedRangeShadow);this._rangeProtectionCanViewRenderExtension=new r9(o),this._rangeProtectionCanNotViewRenderExtension=new o9(o),this._initSkeleton(),this._initRender(),this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe(a=>{var l,u;((l=a.oldRule)!=null&&l.id&&this._rangeProtectionCanViewRenderExtension.renderCache.has(a.oldRule.id)||this._rangeProtectionCanViewRenderExtension.renderCache.has(a.rule.id))&&this._rangeProtectionCanViewRenderExtension.clearCache(),((u=a.oldRule)!=null&&u.id&&this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a.oldRule.id)||this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a.rule.id))&&this._rangeProtectionCanNotViewRenderExtension.clearCache()}))}_initRender(){const e=this._context.mainComponent;e&&(e.getExtensionByKey(Vf)||e.register(this._rangeProtectionCanViewRenderExtension),e.getExtensionByKey(Hf)||e.register(this._rangeProtectionCanNotViewRenderExtension))}_initSkeleton(){const e=()=>{var t;this._sheetSkeletonManagerService.reCalculate(),(t=this._context.mainComponent)==null||t.makeDirty()};this.disposeWithMe(Ut(this._permissionService.permissionPointUpdate$.pipe(wd(300,void 0,{trailing:!0})),this._rangeProtectionRuleModel.rangeRuleInitStateChange$,this._rangeProtectionRuleModel.ruleChange$).pipe().subscribe(e))}};yc=Wf([As(1,V(We)),As(2,V(Te)),As(3,Je),As(4,Lt)],yc);let Mc=class extends ae{constructor(e,t,n,s,i){super(),y(this,"_worksheetProtectionRenderExtension"),this._context=e,this._renderManagerService=t,this._sheetSkeletonManagerService=n,this._worksheetProtectionRuleModel=s,this._configService=i;const r=this._configService.getConfig(Jt),o=If(r?.protectedRangeShadow);this._worksheetProtectionRenderExtension=new l9(o),this._initSkeleton(),o!=="none"&&this._initRender()}_initRender(){const e=this._context.unitId,t=e&&this._renderManagerService.getRenderById(e),n=t&&t.mainComponent;n&&(n.getExtensionByKey(Df)||n.register(this._worksheetProtectionRenderExtension))}_initSkeleton(){const e=()=>{var t;this._sheetSkeletonManagerService.reCalculate(),(t=this._context.mainComponent)==null||t.makeDirty()};this.disposeWithMe(Ut(this._worksheetProtectionRuleModel.worksheetRuleInitStateChange$).pipe().subscribe(e))}};Mc=Wf([As(1,V(ze)),As(2,V(Te)),As(3,V(ft)),As(4,V(Lt))],Mc);var u9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Hg=(e,t)=>(n,s)=>t(n,s,e);let Ec=class extends ae{constructor(e,t,n,s){super(),this._context=e,this._sheetSkeletonManagerService=t,this._sheetClipboardService=n,this._sheetClipboardController=s,this._initialize()}_initialize(){this.disposeWithMe(He(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{if(!(e!=null&&e.unitId)||!this._sheetClipboardService.getPasteMenuVisible())return;const t=this._sheetClipboardService.getPasteOptionsCache(),n=t?.target.unitId;e.unitId===n&&this._sheetClipboardController.refreshOptionalPaste()})))}};Ec=u9([Hg(1,V(Te)),Hg(2,hs),Hg(3,V(eo))],Ec);var d9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Dg=(e,t)=>(n,s)=>t(n,s,e);let xc=class extends ae{constructor(e,t,n,s){super(),this._context=e,this._formatPainterService=t,this._selectionRenderService=n,this._commandService=s,this._initialize()}_initialize(){this._bindFormatPainterStatus(),this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._selectionRenderService.selectionMoveEnd$.subscribe(e=>{var t;if(this._formatPainterService.getStatus()!==ls.OFF){const{rangeWithCoord:n}=e[e.length-1];this._commandService.executeCommand(xh.id,{unitId:this._context.unitId,subUnitId:((t=this._context.unit.getActiveSheet())==null?void 0:t.getSheetId())||"",range:{startRow:n.startRow,startColumn:n.startColumn,endRow:n.endRow,endColumn:n.endColumn}}),this._formatPainterService.getStatus()===ls.ONCE&&this._commandService.executeCommand(Mu.id)}}))}_bindFormatPainterStatus(){this.disposeWithMe(He(this._formatPainterService.status$.subscribe(e=>{const t=this._context.scene;t&&(e!==ls.OFF?t.setDefaultCursor(Qe.CELL):t.setDefaultCursor(Qe.DEFAULT))})))}};xc=d9([Dg(1,Ii),Dg(2,Zt),Dg(3,U)],xc);var Im=(e=>(e[e.NORMAL=0]="NORMAL",e[e.HIGHLIGHT=1]="HIGHLIGHT",e))(Im||{});const c9="rgba(0, 0, 0, 0.15)",ni="rgb(0, 0, 0)",qu="rgb(255, 255, 255, 1)";class h9 extends qm{constructor(t,n){super(t,n),y(this,"_size",12),y(this,"_iconRatio",.4),y(this,"_mode",0),this.setShapeProps(n)}setShapeProps(t){t!=null&&t.size&&(this._size=t.size),t!=null&&t.mode&&(this._mode=t.mode),this.transformByState({width:this._size,height:this._size})}_draw(t){this._mode===1&&Be.drawWith(t,{width:this._size,height:this._size,radius:this._size,fill:c9});const n=this._size*.5*this._iconRatio,s=Math.PI/180*60,i=n*Math.sin(s),r=n*Math.cos(s);il.drawWith(t,{pointsGroup:[[{x:-i+this._size/2,y:-r+this._size/2},{x:i+this._size/2,y:-r+this._size/2},{x:this._size/2,y:n+this._size/2}]],fill:ni})}}var g9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Qu=(e,t)=>(n,s)=>t(n,s,e);const m9="__SpreadsheetHeaderMenuSHAPEControllerShape__",p9="__SpreadsheetHeaderMenuMAINControllerShape__",f9="rgba(0, 0, 0, 0.1)";let kc=class extends ae{constructor(e,t,n,s,i){super(),y(this,"_hoverRect"),y(this,"_hoverMenu"),y(this,"_currentColumn",Number.POSITIVE_INFINITY),y(this,"_headerPointerSubs"),y(this,"_colHeaderPointerSubs"),this._context=e,this._sheetSkeletonManagerService=t,this._contextMenuService=n,this._commandService=s,this._selectionManagerService=i,this._initialize()}dispose(){var e,t,n;(e=this._hoverRect)==null||e.dispose(),(t=this._hoverMenu)==null||t.dispose(),(n=this._headerPointerSubs)==null||n.unsubscribe(),this._headerPointerSubs=null}_initialize(){const e=this._context.scene;this._hoverRect=new Be(m9,{fill:f9,evented:!1}),this._hoverMenu=new h9(p9,{zIndex:100,visible:!1}),e.addObjects([this._hoverRect,this._hoverMenu],Xs),this._initialHover(0),this._initialHover(1),this._initialHoverMenu()}_initialHover(e=0){var t,n,s;const i=this._context.components.get(yt.COLUMN),r=this._context.components.get(yt.ROW),o=e===0?r:i,a=g=>{var m,p,f;const v=(m=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:m.skeleton;if(v==null)return;const{rowHeaderWidth:C,columnHeaderHeight:w}=v,{startX:b,startY:I,endX:_,endY:R,column:M}=vi(g.offsetX,g.offsetY,this._context.scene,v);if(e===0)(p=this._hoverRect)==null||p.transformByState({width:C,height:R-I,left:0,top:I});else{if(this._currentColumn=M,(f=this._hoverRect)==null||f.transformByState({width:_-b,height:w,left:b,top:0}),this._hoverMenu==null)return;if(_-b<w*2){this._hoverMenu.hide();return}const x=w*.8;this._hoverMenu.transformByState({left:_-w,top:w/2-x/2}),this._hoverMenu.setShapeProps({size:x}),this._hoverMenu.show()}},l=()=>{var g;(g=this._hoverRect)==null||g.show()},u=()=>{var g,m;(g=this._hoverRect)==null||g.hide(),(m=this._hoverMenu)==null||m.hide()};this._headerPointerSubs=new ji;const d=o.onPointerMove$.subscribeEvent(a),c=o.onPointerEnter$.subscribeEvent(l),h=o.onPointerLeave$.subscribeEvent(u);(t=this._headerPointerSubs)==null||t.add(d),(n=this._headerPointerSubs)==null||n.add(c),(s=this._headerPointerSubs)==null||s.add(h)}_initialHoverMenu(){this._hoverMenu!=null&&(this._hoverMenu.onPointerEnter$.subscribeEvent(()=>{this._hoverMenu!=null&&(this._hoverMenu.setProps({mode:Im.HIGHLIGHT,visible:!0}),this._context.scene.setCursor(Qe.POINTER))}),this._hoverMenu.onPointerLeave$.subscribeEvent(()=>{this._hoverMenu!=null&&(this._hoverMenu.setProps({mode:Im.NORMAL,visible:!1}),this._context.scene.resetCursor())}),this._hoverMenu.onPointerDown$.subscribeEvent(e=>{var t;const n=this._currentColumn,s=(t=this._selectionManagerService.getCurrentSelections())==null?void 0:t.map(i=>i.range);if(!(s!=null&&s.filter(i=>i.rangeType===j.COLUMN).find(i=>{const{startColumn:r,endColumn:o}=i;return n>=r&&n<=o}))){const i=this._getSelectionOnColumn(n);this._commandService.syncExecuteCommand(me.id,i)}e.stopPropagation(),e.preventDefault(),this._contextMenuService.triggerContextMenu(e,un.COL_HEADER)}))}_getSelectionOnColumn(e){const t=this._context.unit,n=t.getActiveSheet();if(!n)throw new Error("No active worksheet");return{unitId:t.getUnitId(),subUnitId:n.getSheetId(),selections:[{range:{startRow:0,startColumn:e,endRow:n.getRowCount()-1,endColumn:e,rangeType:j.COLUMN},primary:{startRow:0,startColumn:e,endRow:0,endColumn:e,actualRow:0,actualColumn:e,isMerged:!1,isMergedMainCell:!1},style:null}]}}};kc=g9([Qu(1,V(Te)),Qu(2,Xc),Qu(3,U),Qu(4,V(q))],kc);var Rm=(e=>(e[e.ROW=0]="ROW",e[e.COLUMN=1]="COLUMN",e))(Rm||{});const rl=12,v9=.4;class kC extends qm{constructor(t,n,s){super(t,n),y(this,"_size",rl),y(this,"_iconRatio",v9),y(this,"_hovered",!0),y(this,"_hasPrevious",!0),y(this,"_hasNext",!0),y(this,"_unhideType"),n&&this.setShapeProps(n),this.onPointerEnter$.subscribeEvent(()=>this.setShapeProps({hovered:!0})),this.onPointerLeave$.subscribeEvent(()=>this.setShapeProps({hovered:!1})),this.onPointerDown$.subscribeEvent(()=>s?.())}setShapeProps(t){t.type!==void 0&&(this._unhideType=t.type),t.hovered!==void 0&&(this._hovered=t.hovered),t.hasPrevious!==void 0&&(this._hasPrevious=t.hasPrevious),t.hasNext!==void 0&&(this._hasNext=t.hasNext),this.transformByState({width:this._size*(this._unhideType===1?2:1),height:this._size*(this._unhideType===0?2:1)})}_draw(t){this._unhideType===0?this._drawOnRow(t):this._drawOnCol(t)}_drawOnRow(t){this._hovered&&(!this._hasNext||!this._hasPrevious?Be.drawWith(t,{width:this._size,height:this._size,stroke:ni,fill:qu}):Be.drawWith(t,{width:this._size,height:2*this._size,stroke:ni,fill:qu}));const n=this._size*.5*this._iconRatio,s=Math.PI/3,i=n*Math.cos(s),r=n*Math.sin(s);if(this._hasPrevious&&il.drawWith(t,{pointsGroup:[[{x:this._size/2,y:this._size/2-r},{x:this._size/2-r,y:this._size/2+i},{x:this._size/2+r,y:this._size/2+i}]],fill:ni}),this._hasNext){const o=this._hasPrevious?3:1;il.drawWith(t,{pointsGroup:[[{x:this._size/2,y:this._size*o/2+r},{x:this._size/2-r,y:this._size*o/2-i},{x:this._size/2+r,y:this._size*o/2-i}]],fill:ni})}}_drawOnCol(t){this._hovered&&(!this._hasNext||!this._hasPrevious?Be.drawWith(t,{width:this._size,height:this._size,stroke:ni,fill:qu}):Be.drawWith(t,{width:2*this._size,height:this._size,stroke:ni,fill:qu}));const n=this._size*.5*this._iconRatio,s=Math.PI/3,i=n*Math.cos(s),r=n*Math.sin(s);if(this._hasPrevious&&il.drawWith(t,{pointsGroup:[[{x:-i+this._size/2,y:this._size/2},{x:this._size/2+r,y:this._size/2-r},{x:this._size/2+r,y:this._size/2+r}]],fill:ni}),this._hasNext){const o=this._hasPrevious?3:1;il.drawWith(t,{pointsGroup:[[{x:i+this._size*o/2,y:this._size/2},{x:-r+this._size*o/2,y:this._size/2-r},{x:-r+this._size*o/2,y:this._size/2+r}]],fill:ni})}}}var C9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},TC=(e,t)=>(n,s)=>t(n,s,e);const PC="__SpreadsheetHeaderUnhideSHAPEControllerShape__";let Tc=class extends Ms{constructor(e,t,n){super(),y(this,"_shapes",{cols:[],rows:[]}),this._context=e,this._sheetSkeletonManagerService=t,this._commandService=n,this._init()}get _workbook(){return this._context.unit}dispose(){super.dispose(),this._clearShapes()}_init(){let e="";this._context.unit.activeSheet$.pipe(ln(this.dispose$)).subscribe(t=>{if(this._clearShapes(),!t){e="";return}e=t.getSheetId(),this._update(this._workbook,t)}),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(t=>{if(t){const{unitId:n,sheetId:s}=t;if(n===this._workbook.getUnitId()&&s===e){const i=this._workbook.getSheetBySheetId(s);i&&this._update(this._workbook,i)}}}))}_update(e,t){var n;const s=(n=this._sheetSkeletonManagerService.getSkeletonParam(t.getSheetId()))==null?void 0:n.skeleton;if(!s)return;const i=t.getHiddenRows(),r=t.getHiddenCols(),o=this._getSheetObject(),{scene:a}=o,l=t.getRowCount(),u=i.map(h=>{const{startRow:g,endRow:m}=h,p=qv(g,0,a,s),f=g!==0,v=m!==l-1;return new kC(PC,{type:Rm.ROW,hovered:!1,hasPrevious:f,hasNext:v,top:p.startY-(f?rl:0),left:p.startX-rl},()=>this._commandService.executeCommand(er.id,{unitId:e.getUnitId(),subUnitId:t.getSheetId(),ranges:[h]}))}),d=t.getColumnCount(),c=r.map(h=>{const{startColumn:g,endColumn:m}=h,p=qv(0,g,a,s),f=g!==0,v=m!==d-1;return new kC(PC,{type:Rm.COLUMN,hovered:!1,hasPrevious:f,hasNext:v,top:20-rl,left:p.startX-(f?rl:0)},()=>this._commandService.executeCommand(Ji.id,{unitId:e.getUnitId(),subUnitId:t.getSheetId(),ranges:[h]}))});a.addObjects(c,Uv),a.addObjects(u,Uv),this._clearShapes(),this._shapes={cols:c,rows:u}}_clearShapes(){this._shapes.cols.forEach(e=>e.dispose()),this._shapes.rows.forEach(e=>e.dispose()),this._shapes={cols:[],rows:[]}}_getSheetObject(){return Rs(this._workbook,this._context)}};Tc=C9([TC(1,V(Te)),TC(2,U)],Tc);const li="MOBILE_PINCH_ZOOMING",jo="MOBILE_EXPANDING_SELECTION";var w9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},$a=(e,t)=>(n,s)=>t(n,s,e);const S9="__MobileHeaderResizeControllerShapeRow__",b9="__MobileHeaderResizeControllerShapeColumn__",UC="__MobileHeaderResizeControllerShapeHelper__",NC="rgb(199, 199, 199)",OC=2;let ym=class extends ae{constructor(e,t,n,s,i,r){super(),y(this,"_currentRow",-1),y(this,"_currentColumn",-1),y(this,"_rowResizeButton"),y(this,"_columnResizeButton"),y(this,"_resizeHelperShape"),y(this,"_isDragging",!1),y(this,"_touchStartX",0),y(this,"_touchStartY",0),y(this,"_touchMoveHandler"),y(this,"_touchEndHandler"),y(this,"_selectionSubscription"),y(this,"_scrollSubscription"),this._context=e,this._sheetSkeletonManagerService=t,this._selectionManagerService=n,this._commandService=s,this._contextService=i,this._scrollManagerService=r,this._init()}dispose(){var e,t,n,s,i;(e=this._rowResizeButton)==null||e.dispose(),this._rowResizeButton=null,(t=this._columnResizeButton)==null||t.dispose(),this._columnResizeButton=null,(n=this._resizeHelperShape)==null||n.dispose(),this._resizeHelperShape=null,(s=this._selectionSubscription)==null||s.unsubscribe(),this._selectionSubscription=null,(i=this._scrollSubscription)==null||i.unsubscribe(),this._scrollSubscription=null,this._cleanupTouchHandlers(),super.dispose()}_init(){this._initResizeShapes(),this._initSelectionListener(),this._initScrollListener()}_initResizeShapes(){const e=this._context.scene;this._rowResizeButton=new hc(S9,{visible:!1,mode:ru.HORIZONTAL,zIndex:100}),this._columnResizeButton=new hc(b9,{visible:!1,mode:ru.VERTICAL,zIndex:100}),e.addObjects([this._rowResizeButton,this._columnResizeButton],Xs),this._bindTouchEventsToButton(this._rowResizeButton,"row"),this._bindTouchEventsToButton(this._columnResizeButton,"column")}_initSelectionListener(){this._selectionSubscription=this._selectionManagerService.selectionMoveEnd$.subscribe(e=>{this._handleSelectionChange(e)}),this.disposeWithMe(this._selectionSubscription)}_initScrollListener(){this._scrollSubscription=this._scrollManagerService.validViewportScrollInfo$.subscribe(e=>{e&&this._updateButtonPositionOnScroll()}),this.disposeWithMe(this._scrollSubscription)}_handleSelectionChange(e){var t,n;if((t=this._rowResizeButton)==null||t.hide(),(n=this._columnResizeButton)==null||n.hide(),this._currentRow=-1,this._currentColumn=-1,!e||e.length===0)return;const s=e[0],i=s.range.rangeType;i===j.ROW?this._showRowResizeButton(s):i===j.COLUMN&&this._showColumnResizeButton(s)}_showRowResizeButton(e){const t=this._sheetSkeletonManagerService.getCurrentSkeleton();if(!t||!this._rowResizeButton)return;const{scene:n}=this._context,s=In(e,t),{endRow:i}=s.rangeWithCoord,r=t.getOffsetByRow(i),{rowHeaderWidth:o}=t,{scaleX:a,scaleY:l}=n.getAncestorScale(),u=Math.max(a,l),d=ai/u;this._rowResizeButton.transformByState({left:o/2-d/2,top:r-d/2}),this._rowResizeButton.setShapeProps({size:Math.min(C1,o/3)}),this._currentRow=i,this._rowResizeButton.show()}_showColumnResizeButton(e){const t=this._sheetSkeletonManagerService.getCurrentSkeleton();if(!t||!this._columnResizeButton)return;const{scene:n}=this._context,s=In(e,t),{endColumn:i}=s.rangeWithCoord,r=t.getOffsetByColumn(i),{columnHeaderHeight:o}=t,{scaleX:a,scaleY:l}=n.getAncestorScale(),u=Math.max(a,l),d=ai/u;this._columnResizeButton.transformByState({left:r-d/2,top:o/2-d/2}),this._columnResizeButton.setShapeProps({size:o*.7}),this._currentColumn=i,this._columnResizeButton.show()}_updateButtonPositionOnScroll(){var e,t;const n=this._sheetSkeletonManagerService.getCurrentSkeleton();if(!n)return;const{scene:s}=this._context,{scaleX:i,scaleY:r}=s.getAncestorScale(),o=Math.max(i,r),a=ai/o;if((e=this._rowResizeButton)!=null&&e.visible&&this._currentRow>=0){const l=n.getOffsetByRow(this._currentRow),{rowHeaderWidth:u}=n;this._rowResizeButton.transformByState({left:u/2-a/2,top:l-a/2})}if((t=this._columnResizeButton)!=null&&t.visible&&this._currentColumn>=0){const l=n.getOffsetByColumn(this._currentColumn),{columnHeaderHeight:u}=n;this._columnResizeButton.transformByState({left:l-a/2,top:u/2-a/2})}}_bindTouchEventsToButton(e,t){e.onPointerDown$.subscribeEvent(n=>{this._contextService.getContextValue(li)||this._contextService.getContextValue(jo)||this._startResize(n,t)})}_startResize(e,t){const n=this._sheetSkeletonManagerService.getCurrentSkeleton();if(!n)return;const s=this._context.scene,i=s.getEngine(),r=i?.getCanvasElement();if(!r)return;this._touchStartX=e.offsetX,this._touchStartY=e.offsetY,this._isDragging=!1;const o=t==="row"?n.getOffsetByRow(this._currentRow):n.getOffsetByColumn(this._currentColumn);this._createResizeHelper(t,o,n),s.disableObjectsEvent(),this._setupTouchHandlers(r,t,o)}_setupTouchHandlers(e,t,n){if(!this._sheetSkeletonManagerService.getCurrentSkeleton())return;const s=this._context.scene,i=this._context.unit.getActiveSheet(),r=i?.getZoomRatio()||1;let o=0;this._touchMoveHandler=a=>{if(this._contextService.getContextValue(li)){this._cancelResize();return}if(a.touches.length!==1)return;const l=a.touches[0],u=e.getBoundingClientRect(),d=l.clientX-u.left,c=l.clientY-u.top,h=(t==="row"?c-this._touchStartY:d-this._touchStartX)/r;Math.abs(h)>=OC&&(this._isDragging=!0),this._isDragging&&(o=h,this._updateResizeHelper(t,n+h),this._updateResizeButton(t,n+h)),a.preventDefault()},this._touchEndHandler=a=>{s.enableObjectsEvent(),this._isDragging&&Math.abs(o)>=OC&&(t==="row"?this._commandService.executeCommand(Ko.id,{deltaY:o,anchorRow:this._currentRow}):this._commandService.executeCommand(Qo.id,{deltaX:o,anchorCol:this._currentColumn})),this._cleanupResize(),this._touchMoveHandler&&e.removeEventListener("touchmove",this._touchMoveHandler),this._touchEndHandler&&(e.removeEventListener("touchend",this._touchEndHandler),e.removeEventListener("touchcancel",this._touchEndHandler)),a.preventDefault()},e.addEventListener("touchmove",this._touchMoveHandler,{passive:!1}),e.addEventListener("touchend",this._touchEndHandler,{passive:!1}),e.addEventListener("touchcancel",this._touchEndHandler,{passive:!1}),this.disposeWithMe(He(()=>{this._touchMoveHandler&&e.removeEventListener("touchmove",this._touchMoveHandler),this._touchEndHandler&&(e.removeEventListener("touchend",this._touchEndHandler),e.removeEventListener("touchcancel",this._touchEndHandler))}))}_createResizeHelper(e,t,n){const s=this._context.scene,{scaleX:i,scaleY:r}=s.getAncestorScale(),o=Math.max(i,r),a=ou/o,l=s.getEngine(),u=l?.width||0,d=l?.height||0;e==="row"?this._resizeHelperShape=new Be(UC,{width:Math.max(u,n.columnTotalWidth+n.rowHeaderWidth),height:a,fill:NC,left:0,top:t-a/2}):this._resizeHelperShape=new Be(UC,{width:a,height:Math.max(d,n.rowTotalHeight+n.columnHeaderHeight),fill:NC,left:t-a/2,top:0}),s.addObject(this._resizeHelperShape,Xs)}_updateResizeHelper(e,t){if(!this._resizeHelperShape)return;const n=this._context.scene,{scaleX:s,scaleY:i}=n.getAncestorScale(),r=Math.max(s,i),o=ou/r;e==="row"?this._resizeHelperShape.transformByState({top:t-o/2}):this._resizeHelperShape.transformByState({left:t-o/2})}_updateResizeButton(e,t){const n=e==="row"?this._rowResizeButton:this._columnResizeButton;if(!n)return;const s=this._context.scene,{scaleX:i,scaleY:r}=s.getAncestorScale(),o=Math.max(i,r),a=ai/o;e==="row"?n.transformByState({top:t-a/2}):n.transformByState({left:t-a/2})}_cleanupResize(){var e;(e=this._resizeHelperShape)==null||e.dispose(),this._resizeHelperShape=null,this._isDragging=!1}_cleanupTouchHandlers(){const e=this._context.scene.getEngine(),t=e?.getCanvasElement();t&&(this._touchMoveHandler&&(t.removeEventListener("touchmove",this._touchMoveHandler),this._touchMoveHandler=null),this._touchEndHandler&&(t.removeEventListener("touchend",this._touchEndHandler),t.removeEventListener("touchcancel",this._touchEndHandler),this._touchEndHandler=null))}_cancelResize(){this._context.scene.enableObjectsEvent(),this._cleanupResize(),this._cleanupTouchHandlers()}};ym=w9([$a(1,V(Te)),$a(2,V(q)),$a(3,U),$a(4,Ne),$a(5,V(Sn))],ym);var _9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},br=(e,t)=>(n,s)=>t(n,s,e);const I9=[Jn.id,yi.id];let Mm=class extends ae{constructor(e,t,n,s,i,r,o,a){super(),this._context=e,this._sheetSkeletonManagerService=t,this._commandService=n,this._renderManagerService=s,this._selectionManagerService=i,this._scrollManagerService=r,this._univerInstanceService=o,this._contextService=a,this._init()}scrollToRange(e){let{endRow:t,endColumn:n,startColumn:s,startRow:i}=e;const r=this._getViewportBounding();if(e.rangeType===j.ROW?(s=0,n=0):e.rangeType===j.COLUMN&&(i=0,t=0),r){const o=r.startRow>t?i:t,a=r.startColumn>n?s:n;return this._scrollToCell(o,a)}else return this._scrollToCell(i,s)}_init(){this._initCommandListener(),this._initScrollEventListener(),this._initPointerScrollEvent(),this._initSkeletonListener()}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(I9.includes(e.id))this._scrollToSelection();else if(e.id===mh.id){const t=e.params.range;this.scrollToRange(t)}else if(e.id===gs.id){const t=e.params;this._scrollToSelectionForExpand(t)}}))}_scrollToSelectionForExpand(e){setTimeout(()=>{const t=this._selectionManagerService.getCurrentLastSelection();if(t==null)return;const{startRow:n,startColumn:s,endRow:i,endColumn:r}=t.range,o=this._getViewportBounding();if(o==null)return;const{startRow:a,startColumn:l,endRow:u,endColumn:d}=o;let c=0,h=0;n>a?c=i:i<u?c=n:c=a,s>l?h=r:r<d?h=s:h=l,e.direction===Z.DOWN?c=i:e.direction===Z.UP?c=n:e.direction===Z.RIGHT?h=r:e.direction===Z.LEFT&&(h=s),this._scrollToCell(c,h)},0)}_getFreeze(){var e;const t=(e=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:e.skeleton.getWorksheetConfig();if(t!=null)return t.freeze}_initScrollEventListener(){const{scene:e}=this._context;if(e==null)return;const t=e.getViewport($.VIEW_MAIN);t&&(this.disposeWithMe(He(this._scrollManagerService.rawScrollInfo$.subscribe(n=>{var s;if(n==null){t.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});return}const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(!i)return;const{sheetViewStartRow:r,sheetViewStartColumn:o,offsetX:a,offsetY:l}=n,{startX:u,startY:d}=i.getCellWithCoordByIndex(r,o,!1),c=u+a,h=d+l;t.scrollToViewportPos({viewportScrollX:c,viewportScrollY:h})}))),this.disposeWithMe(t.onScrollAfter$.subscribeEvent(n=>{var s;if(!n)return;const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(i==null)return;const r=this._getSheetObject();if(i==null||r==null)return;const{viewportScrollX:o,viewportScrollY:a,scrollX:l,scrollY:u}=n,{row:d,column:c,rowOffset:h,columnOffset:g}=i.getOffsetRelativeToRowCol(o,a),m={sheetViewStartRow:d,sheetViewStartColumn:c,offsetX:g,offsetY:h,viewportScrollX:o,viewportScrollY:a,scrollX:l,scrollY:u};this._scrollManagerService.setValidScrollStateToCurrSheet(m),this._scrollManagerService.validViewportScrollInfo$.next({...m,scrollX:l,scrollY:u,viewportScrollX:o,viewportScrollY:a})})),this.disposeWithMe(t.onScrollByBar$.subscribeEvent(n=>{var s;const i=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(i==null||n.isTrigger===!1)return;const r=this._getSheetObject();if(i==null||r==null)return;const{viewportScrollX:o=0,viewportScrollY:a=0}=n,l=this._getFreeze(),{row:u,column:d,rowOffset:c,columnOffset:h}=i.getOffsetRelativeToRowCol(o,a);this._commandService.executeCommand(Ss.id,{sheetViewStartRow:u+(l?.ySplit||0),sheetViewStartColumn:d+(l?.xSplit||0),offsetX:h,offsetY:c})})))}_initSkeletonListener(){this.disposeWithMe(He(this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe(e=>{if(e==null)return;const t={unitId:e.unitId,sheetId:e.sheetId};this._scrollManagerService.setSearchParam(t);const n=this._getSheetObject();if(!n)return;const s=n.scene.getViewport($.VIEW_MAIN),i=this._scrollManagerService.getScrollStateByParam(t),{viewportScrollX:r,viewportScrollY:o}=this._scrollManagerService.calcViewportScrollFromRowColOffset(i);s&&(i?(s.viewportScrollX=r,s.viewportScrollY=o):(s.viewportScrollX=0,s.viewportScrollY=0),this._updateSceneSize(e))})))}_initPointerScrollEvent(){const e=this._getSheetObject();if(!e)return;const t=e.scene,n=e.spreadsheet,s=t.getViewport($.VIEW_MAIN),i={x:0,y:0};let r=!1;const o={x:0,y:0};let a=null;const l=5,u=[];let d=0,c=0,h={x:0,y:0},g=null;const m=8,p=.992,f=.22,v=12,C=240,w=30,b=.05,I=.26,_=()=>{const re=this._context.unit.getActiveSheet();return re?.getZoomRatio()||1},R=()=>({decelerationRate:p,minVelocityThreshold:f,maxVelocity:v}),M=(re,Ie,Xe)=>{const Pe=re>0?Ie/re:0,st=re<C&&Ie>w;let vt;if(st){const Mt=Math.min(Pe/2,1);vt=b+(I-b)*Mt,re<150&&Math.abs(Xe)>3&&(vt*=1.3)}else{const Mt=Math.min(Math.abs(Xe)/5,1);vt=b*(.5+Mt*.5)}return Math.max(b*.5,Math.min(I*1.5,vt))},x=()=>{if(u.length===0)return{x:0,y:0};let re=0,Ie=0,Xe=0;for(let Pe=0;Pe<u.length;Pe++){const st=(Pe+1)*(Pe+1);Ie+=u[Pe].x*st,Xe+=u[Pe].y*st,re+=st}return{x:Ie/re,y:Xe/re}};let N=0,T=!1,O=0,k=1,D={x:0,y:0};const B=()=>{a!==null&&(cancelAnimationFrame(a),a=null),N=0,o.x=0,o.y=0},W=re=>{if(!s)return;if(T){B();return}if(N===0){N=re,a=requestAnimationFrame(W);return}const Ie=re-N;N=re;const{decelerationRate:Xe,minVelocityThreshold:Pe}=R(),st=Xe**Ie;o.x*=st,o.y*=st;const vt=-Math.log(Xe),Mt=o.x*(1-st)/vt,jt=o.y*(1-st)/vt;(Math.abs(Mt)>.01||Math.abs(jt)>.01)&&this._commandService.executeCommand(Kl.id,{offsetY:jt,offsetX:Mt}),Math.sqrt(o.x*o.x+o.y*o.y)>Pe?a=requestAnimationFrame(W):(a=null,N=0)},F=t.getEngine(),K=F?.getCanvasElement();if(!K)return;let J=null,ee=null,we=null;const Ge=this._createZoomIndicator(K),Ae=re=>{const Ie=K.getBoundingClientRect();return{offsetX:re.clientX-Ie.left,offsetY:re.clientY-Ie.top}},Ze=(re,Ie)=>{const Xe=re.clientX-Ie.clientX,Pe=re.clientY-Ie.clientY;return Math.sqrt(Xe*Xe+Pe*Pe)},ue=(re,Ie)=>{const Xe=Ae(re),Pe=Ae(Ie);return{x:(Xe.offsetX+Pe.offsetX)/2,y:(Xe.offsetY+Pe.offsetY)/2}},ge=(re,Ie)=>{var Xe;const Pe=(Xe=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:Xe.skeleton;if(!Pe)return!1;const{rowHeaderWidthAndMarginLeft:st,columnHeaderHeightAndMarginTop:vt}=Pe;return re>st&&Ie>vt},be=(re,Ie,Xe)=>{var Pe;const st=(Pe=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:Pe.skeleton;if(!st||!s)return null;const{rowHeaderWidthAndMarginLeft:vt,columnHeaderHeightAndMarginTop:Mt}=st,jt=s.viewportScrollX||0,Pn=s.viewportScrollY||0,es=(re-vt)/Xe+jt,Un=(Ie-Mt)/Xe+Pn,{row:jn,column:ts,rowOffset:ns,columnOffset:ms}=st.getOffsetRelativeToRowCol(Math.max(0,es),Math.max(0,Un)),po=st.getCellWithCoordByIndex(jn,ts,!1);return{row:jn,column:ts,rowOffset:ns,columnOffset:ms,cellStartX:po.startX,cellStartY:po.startY}},Ue=(re,Ie)=>{var Xe;if(!s)return;const Pe=(Xe=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:Xe.skeleton;if(!Pe)return;const{rowHeaderWidthAndMarginLeft:st,columnHeaderHeightAndMarginTop:vt}=Pe,Mt=s.viewportScrollX||0,jt=s.viewportScrollY||0,Pn=D.x-st,es=D.y-vt;let Un,jn;if(we)Un=we.x-Pn/re,jn=we.y-es/re;else if(J){const Ou=J.cellStartX+J.columnOffset,b_=J.cellStartY+J.rowOffset;Un=Ou-Pn/re,jn=b_-es/re}else{const Ou=re/Ie;Un=Mt/Ou,jn=jt/Ou}Un<0&&(Un=0),jn<0&&(jn=0);const ts=this._context.unit,ns=ts.getActiveSheet();if(!ns)return;this._commandService.executeCommand(Da.id,{zoomRatio:re,unitId:ts.getUnitId(),subUnitId:ns.getSheetId()});const{row:ms,column:po,rowOffset:Gs,columnOffset:Nu}=Pe.getOffsetRelativeToRowCol(Un,jn);this._commandService.executeCommand(Ss.id,{sheetViewStartRow:ms,sheetViewStartColumn:po,offsetX:Nu,offsetY:Gs})};n.onPointerDown$.subscribeEvent((re,Ie)=>{B(),Ie.stopPropagation()});const Rt=(re,Ie)=>{var Xe;if(T=!0,this._contextService.setContextValue(li,!0),O=Ze(re,Ie),k=_(),D=ue(re,Ie),J=be(D.x,D.y,k),s){const Pe=(Xe=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:Xe.skeleton;if(Pe){const{rowHeaderWidthAndMarginLeft:st,columnHeaderHeightAndMarginTop:vt}=Pe;ee={x:s.viewportScrollX||0,y:s.viewportScrollY||0};const Mt=D.x-st,jt=D.y-vt;we={x:ee.x+Mt/k,y:ee.y+jt/k}}}},ke=re=>{if(B(),re.touches.length===2){const st=re.touches[0],vt=re.touches[1],Mt=Ae(st),jt=Ae(vt);if(!ge(Mt.offsetX,Mt.offsetY)||!ge(jt.offsetX,jt.offsetY))return;r=!1,Rt(st,vt),this._showZoomIndicator(Ge,Math.round(k*100)),re.preventDefault();return}if(re.touches.length!==1||T||this._contextService.getContextValue(jo))return;const Ie=re.touches[0],{offsetX:Xe,offsetY:Pe}=Ae(Ie);ge(Xe,Pe)&&(i.x=Xe,i.y=Pe,d=performance.now(),c=d,h={x:0,y:0},g=null,u.length=0,r=!0,re.preventDefault())},Ye=re=>{if(T&&re.touches.length===2){a!==null&&B();const ns=re.touches[0],ms=re.touches[1],po=Ze(ns,ms)/O;let Gs=k*po;Gs=Math.max(.2,Math.min(2,Gs)),Gs=Math.round(Gs*10)/10;const Nu=_();Math.abs(Gs-Nu)>=.05&&(D=ue(ns,ms),Ue(Gs,Nu),this._showZoomIndicator(Ge,Math.round(Gs*100))),re.preventDefault();return}if(!r||re.touches.length!==1||!s||this._contextService.getContextValue(jo))return;const Ie=re.touches[0],{offsetX:Xe,offsetY:Pe}=Ae(Ie),st=performance.now(),vt=st-d;if(vt<=0)return;const Mt=-(Xe-i.x),jt=-(Pe-i.y),Pn=_(),es=Mt/Pn,Un=jt/Pn;if(h.x+=Math.abs(Mt),h.y+=Math.abs(jt),g===null){const ns=h.x,ms=h.y;(ns>m||ms>m)&&(g=ns>ms?"x":"y")}const jn=es/vt*16,ts=Un/vt*16;for(u.push({x:jn,y:ts,time:st});u.length>l;)u.shift();(es!==0||Un!==0)&&this._commandService.executeCommand(Kl.id,{offsetY:Un,offsetX:es}),i.x=Xe,i.y=Pe,d=st,re.preventDefault()},Ot=re=>{if(T){re.touches.length<2&&(T=!1,this._contextService.setContextValue(li,!1),J=null,ee=null,we=null,B(),u.length=0,this._hideZoomIndicator(Ge));return}if(!r)return;r=!1;const Ie=x(),Xe=performance.now()-c,Pe=Math.sqrt(h.x*h.x+h.y*h.y),st=Math.sqrt(Ie.x*Ie.x+Ie.y*Ie.y),vt=M(Xe,Pe,st),{maxVelocity:Mt,minVelocityThreshold:jt}=R(),Pn=Math.max(-Mt,Math.min(Mt,Ie.x*vt)),es=Math.max(-Mt,Math.min(Mt,Ie.y*vt));o.x=g==="y"?0:Pn,o.y=g==="x"?0:es,Math.sqrt(o.x*o.x+o.y*o.y)>jt*2&&(N=0,a=requestAnimationFrame(W)),u.length=0},ut=()=>{T&&(T=!1,this._contextService.setContextValue(li,!1),J=null,ee=null,we=null,this._hideZoomIndicator(Ge)),r&&(r=!1,u.length=0),B()};K.addEventListener("touchstart",ke,{passive:!1}),K.addEventListener("touchmove",Ye,{passive:!1}),K.addEventListener("touchend",Ot,{passive:!1}),K.addEventListener("touchcancel",ut,{passive:!1}),this.disposeWithMe(He(()=>{K.removeEventListener("touchstart",ke),K.removeEventListener("touchmove",Ye),K.removeEventListener("touchend",Ot),K.removeEventListener("touchcancel",ut),Ge&&Ge.parentElement&&Ge.parentElement.removeChild(Ge)}))}_createZoomIndicator(e){const t=e.parentElement;if(!t){const s=document.createElement("div");return s.style.display="none",s}const n=document.createElement("div");return n.style.cssText=`
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease-in-out;
            z-index: 10000;
            user-select: none;
            -webkit-user-select: none;
        `,window.getComputedStyle(t).position==="static"&&(t.style.position="relative"),t.appendChild(n),n}_showZoomIndicator(e,t){e.textContent=`${t}%`,e.style.opacity="1"}_hideZoomIndicator(e){setTimeout(()=>{e.style.opacity="0"},300)}_updateSceneSize(e){var t;if(e==null)return;const{unitId:n}=this._context,{skeleton:s}=e,i=(t=this._renderManagerService.getRenderById(n))==null?void 0:t.scene;if(s==null||i==null)return;const{rowTotalHeight:r,columnTotalWidth:o,rowHeaderWidthAndMarginLeft:a,columnHeaderHeightAndMarginTop:l}=s;i?.transformByState({width:a+o,height:l+r})}_getSheetObject(){return Rs(this._context.unit,this._context)}_scrollToSelection(e=!0){const t=this._selectionManagerService.getCurrentLastSelection();if(t==null)return;const{startRow:n,startColumn:s,actualRow:i,actualColumn:r}=t.primary,o=e?i:n,a=e?r:s;this._scrollToCell(o,a)}_getViewportBounding(){var e,t;const n=(e=this._getSheetObject())==null?void 0:e.scene;if(n==null)return;const s=n.getViewport($.VIEW_MAIN);if(s==null)return;const i=(t=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:t.skeleton;if(i!=null)return i.getRangeByViewport(s.calcViewportInfo())}_scrollToCell(e,t){var n,s,i,r;const{rowHeightAccumulation:o,columnWidthAccumulation:a}=(s=(n=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:n.skeleton)!=null?s:{};if(o==null||a==null)return!1;const l=(i=this._getSheetObject())==null?void 0:i.scene;if(l==null)return!1;const u=l.getViewport($.VIEW_MAIN);if(u==null||((r=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:r.skeleton)==null)return!1;const d=this._context.unit.getActiveSheet();if(!d)return!1;const{startColumn:c,startRow:h,ySplit:g,xSplit:m}=d.getFreeze(),p=this._getViewportBounding();if(p==null)return!1;const{startRow:f,startColumn:v,endRow:C,endColumn:w}=p;let b,I;if(e>=h&&t>=c-m&&(e<=f&&(b=e),e>=C)){const M=o[e]-u.height;for(let x=f;x<=e;x++)if(o[x]>=M){b=x+1;break}}if(t>=c&&e>=h-g&&(t<=v&&(I=t),t>=w)){const M=a[t]-u.width;for(let x=v;x<=t;x++)if(a[x]>=M){I=x+1;break}}if(b===void 0&&I===void 0)return!1;const{offsetX:_,offsetY:R}=this._scrollManagerService.getCurrentScrollState()||{};return this._commandService.syncExecuteCommand(Ss.id,{sheetViewStartRow:b,sheetViewStartColumn:I,offsetX:I===void 0?_:0,offsetY:b===void 0?R:0})}};Mm=_9([br(1,V(Te)),br(2,U),br(3,ze),br(4,V(q)),br(5,V(Sn)),br(6,P),br(7,Ne)],Mm);var R9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},AC=(e,t)=>(n,s)=>t(n,s,e);let Pc=class extends ae{constructor(e,t,n){super(),this._context=e,this._sheetSkeletonManagerService=t,this._renderManagerService=n,this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe(s=>{this._sheetSkeletonManagerService.disposeSkeleton(s.getSheetId())})),this._sheetSkeletonManagerService.currentSkeleton$.subscribe(s=>{this._updateSceneSize(s)})}_updateSceneSize(e){var t;if(e==null)return;const{unitId:n}=this._context,{skeleton:s}=e,i=(t=this._renderManagerService.getRenderById(n))==null?void 0:t.scene;if(s==null||i==null)return;const{rowTotalHeight:r,columnTotalWidth:o,rowHeaderWidthAndMarginLeft:a,columnHeaderHeightAndMarginTop:l}=s;this._context.unit.getActiveSheet()&&i?.transformByState({width:a+o,height:l+r})}};Pc=R9([AC(1,V(Te)),AC(2,ze)],Pc);var y9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},VC=(e,t)=>(n,s)=>t(n,s,e);bn("sheets-ui.services.auto-height");function M9(e,t){const n=[],s=[...e];let i=t;for(;s.length>0;){const r=s.shift();if(!r)break;const o=r.endRow-r.startRow+1;if(o>i){n.push({...r,startRow:r.startRow,endRow:r.startRow+i-1}),s.unshift({...r,startRow:r.startRow+i});break}else n.push(r),i-=o}return{result:n,lasts:s}}const E9=500;let Uc=class extends ae{constructor(e,t,n){super(),y(this,"_autoHeightTasks",[]),y(this,"_calculateLoopId",null),this._context=e,this._sheetSkeletonManagerService=t,this._commandService=n,this._initMarkDirty()}_initMarkDirty(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===sf.id){const t=e.params,{unitId:n,subUnitId:s,ranges:i,id:r}=t;if(n!==this._context.unitId)return;this.startAutoHeightTask({ranges:i,sheetId:s,id:r,maxTime:1e4})}if(e.id===rf.id){const t=e.params,{unitId:n,id:s}=t;if(n!==this._context.unitId)return;this.cancelTask(s)}}))}_loopTask(e){const t=e.skeleton;let n=[],s=[];if(e.maxTime&&e.maxTime+e.startTime<=Date.now())n=e.ranges;else{const r=M9(e.ranges,E9);n=r.result,s=r.lasts}const i=t.calculateAutoHeightInRange(n).filter(r=>{const{row:o,autoHeight:a}=r;return!(!a||t.getRowHeight(o)===a)});if(s.length&&(e.ranges=s,this._autoHeightTasks.unshift(e)),i.length){const r={unitId:this._context.unitId,subUnitId:e.sheetId,rowsAutoHeightInfo:i};this._commandService.syncExecuteCommand(ds.id,r)}}_calculateLoop(e){for(;this._autoHeightTasks.length&&!(e.timeRemaining()<=0);){const t=this._autoHeightTasks.shift();if(!t){this._calculateLoopId=null;return}this._loopTask(t)}this._calculateLoopId=requestIdleCallback(t=>{this._calculateLoop(t)})}_initialCalculateLoop(){this._calculateLoopId===null&&(this._calculateLoopId=requestIdleCallback(e=>{this._calculateLoop(e)}))}startAutoHeightTask(e){const t=this._sheetSkeletonManagerService.getSkeleton(e.sheetId);if(!t)return;e.ranges=z.mergeRanges(e.ranges.map(s=>({...s,startColumn:0,endColumn:0})));const n=z.subtractMulti(e.ranges,this._autoHeightTasks.filter(s=>s.sheetId===e.sheetId).map(s=>s.ranges).flat());n.length&&(this._autoHeightTasks.push({...e,startTime:Date.now(),skeleton:t,ranges:n}),this._initialCalculateLoop())}cancelTask(e){const t=this._autoHeightTasks.findIndex(n=>n.id===e);t!==-1&&this._autoHeightTasks.splice(t,1)}};Uc=y9([VC(1,V(Te)),VC(2,U)],Uc);function g_(e){const{popup:t}=e,{extraProps:n}=t,{options:s,defaultValue:i,onChange:r}=n,[o,a]=L.useState(i??[]);return S.jsx(d0,{options:s,value:o,onChange:r})}g_.componentKey="sheets.dropdown.cascader";function m_(e){const{popup:t}=e,{extraProps:n}=t,{defaultValue:s,onChange:i}=n;return S.jsx(ww,{value:s,onChange:i})}m_.componentKey="sheets.dropdown.color";function p_(e){const{popup:t}=e,{extraProps:n}=t,{hideFn:s,patternType:i,defaultValue:r,onChange:o,showTime:a}=n,[l,u]=L.useState(r),d=L.useMemo(()=>i!=="time"?Au():Au("1900-01-01 00:00:00"),[]),c=l&&l.isValid()?l:d,h=G(Oe),g=async()=>{c&&await o?.(c)&&s()};return S.jsxs("div",{className:"univer-rounded univer-bg-white univer-p-2 univer-shadow-lg dark:!univer-bg-black",children:[i==="time"?S.jsx(c0,{value:c.toDate(),onValueChange:m=>{u(Au(m))}}):S.jsx(h0,{value:c.toDate(),showTime:a??i==="datetime",onValueChange:m=>{u(Au(m))}}),S.jsx("footer",{className:Ke("univer-mt-2 univer-flex univer-justify-end univer-pt-2",bd),children:S.jsx(us,{size:"small",variant:"primary",onClick:g,disabled:!c||!c.isValid(),children:h.t("dataValidation.alert.ok")})})]})}p_.componentKey="sheets.dropdown.date";function x9(e){return e.filter(Boolean).join(",")}function k9(e){return e.split(",").filter(Boolean)}function T9(e){const{value:t,onChange:n,multiple:s,options:i,title:r,onEdit:o,style:a,location:l,showEdit:u,showSearch:d}=e,c=G(Oe),{row:h,col:g,unitId:m,subUnitId:p}=l,f=L.useRef(null);L.useEffect(()=>{let R=null;return d&&(R=setTimeout(()=>{var M;(M=f.current)==null||M.focus()},0)),()=>{R&&clearTimeout(R)}},[d]);const[v,C]=L.useState(""),w=L.useMemo(()=>i.filter(R=>v?R.label.toLowerCase().includes(v):!0),[i,v]),b=R=>{C(R.target.value.toLowerCase())},I=G(Yr),_=L.useMemo(()=>I.permissionCheckWithRanges({workbookTypes:[ne],rangeTypes:[he],worksheetTypes:[oe]},[{startColumn:g,startRow:h,endColumn:g,endRow:h}],m,p),[I,g,h,m,p]);return S.jsxs("div",{"data-u-comp":"sheets-dropdown-list",className:Ke("univer-box-border univer-rounded-lg univer-bg-white univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",Ra),style:a,children:[d&&S.jsx("div",{className:"univer-box-border univer-flex univer-w-full univer-px-2",children:S.jsx("input",{ref:f,className:"univer-w-full univer-rounded-md univer-border univer-border-[rgba(13,13,13,0.12)] univer-px-2 univer-py-1 univer-text-sm focus:univer-border-primary-500 focus:univer-outline-none dark:!univer-text-white",type:"text",value:v,autoFocus:!0,onChange:b})}),S.jsx("div",{className:"univer-px-3.5 univer-py-1 univer-pt-2 univer-text-xs",children:r}),S.jsx("div",{className:Ke("univer-flex univer-max-h-52 univer-flex-col univer-gap-1 univer-overflow-y-auto univer-px-2 univer-py-1",cu),children:w.map((R,M)=>{const x=t.indexOf(R.value)>-1,N=()=>{let k;x?k=new Set(t.filter(B=>B!==R.value)):k=new Set(s?[...t,R.value]:[R.value]);const D=[];i.forEach(B=>{k.has(B.value)&&D.push(B.value)}),n(D)},T=R.label.toLocaleLowerCase().indexOf(v),O=new Ls(R.color).isDark();return S.jsxs("div",{className:"univer-flex univer-cursor-pointer univer-flex-row univer-items-center univer-justify-between univer-rounded-md univer-px-1.5 univer-py-1 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",onClick:N,children:[S.jsx("div",{className:Ke("univer-inline-flex univer-h-4 univer-w-fit univer-items-center univer-truncate univer-rounded-full univer-px-1.5 univer-text-xs",{"univer-text-gray-900":!O,"univer-text-white":O}),style:{background:R.color},children:v&&R.label.toLowerCase().includes(v)?S.jsxs(S.Fragment,{children:[S.jsx("span",{children:R.label.substring(0,T)}),S.jsx("span",{className:"univer-font-semibold",children:R.label.substring(T,T+v.length)}),S.jsx("span",{children:R.label.substring(T+v.length)})]}):R.label}),S.jsx("div",{className:"univer-ml-3 univer-size-4 univer-flex-shrink-0 univer-flex-grow-0 univer-text-base univer-text-primary-500",children:x&&S.jsx(mo,{className:"univer-text-primary-600"})})]},M)})},v),u&&_&&S.jsx("div",{className:Ke("univer-box-border univer-px-2 univer-pt-1",bd),children:S.jsx("a",{className:"univer-block univer-cursor-pointer univer-rounded univer-px-1.5 univer-py-1 univer-text-xs hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",onClick:o,children:c.t("dataValidation.list.edit")})})]})}function f_(e){var t,n;const{popup:{extraProps:s,anchorRect:i}}=e,{location:r,hideFn:o,onChange:a,onEdit:l,options:u,defaultValue:d,multiple:c,showSearch:h,showEdit:g}=s,{worksheet:m}=r;if(!m)return null;const p=G(Oe),[f,v]=L.useState(d),C=((t=i?.right)!=null?t:0)-((n=i?.left)!=null?n:0);return S.jsx(T9,{style:{minWidth:C,maxWidth:Math.max(C,200)},title:c?p.t("dataValidation.listMultiple.dropdown"):p.t("dataValidation.list.dropdown"),value:k9(f??""),multiple:c,onChange:async w=>{const b=x9(w);v(b),await a?.(w)!==!1&&o()},options:u,onEdit:l,location:r,showEdit:g,showSearch:h})}f_.componentKey="sheets.dropdown.list";const HC={datepicker:p_,list:f_,color:m_,cascader:g_};var P9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ku=(e,t)=>(n,s)=>t(n,s,e);const v_=bn("ICellDropdownManagerService");let Nc=class extends ae{constructor(e,t,n,s){super(),this._canvasPopupManagerService=e,this._zenZoneService=t,this._renderManagerService=n,this._componentManager=s,Object.values(HC).forEach(i=>{this.disposeWithMe(this._componentManager.register(i.componentKey,i))})}showDropdown(e){const{location:t,onHide:n,closeOnOutSide:s=!0}=e,{row:i,col:r,unitId:o,subUnitId:a}=t;if(this._zenZoneService.visible)throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown when zen mode is visible");const l=HC[e.type],u=this._renderManagerService.getRenderById(it),d=new Et,c=this._canvasPopupManagerService.attachPopupToCell(i,r,{componentKey:l.componentKey,onClickOutside:()=>{s&&d.dispose()},offset:[0,3],excludeOutside:[u?.engine.getCanvasElement()].filter(Boolean),extraProps:{...e,...e.props,hideFn:()=>{d.dispose()}}},o,a);if(!c)throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown");return d.add(c),d.add({dispose:()=>{n?.()}}),d}};Nc=P9([Ku(0,V(ha)),Ku(1,pw),Ku(2,ze),Ku(3,V(Tn))],Nc);const U9=gn("PRINTING_RANGE"),N9=gn("PRINTING_COMPONENT_COLLECT"),O9=gn("PRINTING_DOM_COLLECT");class C_ extends ae{constructor(){super(),y(this,"_printComponentMap",new Map),y(this,"interceptor",new Ci({PRINTING_RANGE:U9,PRINTING_COMPONENT_COLLECT:N9,PRINTING_DOM_COLLECT:O9})),this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_RANGE,{priority:-1,handler:t=>t})),this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{priority:-1,handler:t=>t})),this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT,{priority:-1,handler:t=>t}))}registerPrintComponent(t,n){this._printComponentMap.set(t,n)}getPrintComponent(t){return this._printComponentMap.get(t)}}class A9 extends cf{constructor(t,n,s,i){super(t,n,s,i),y(this,"_fillControlTopLeft"),y(this,"_fillControlBottomRight"),y(this,"_rangeType",j.NORMAL),this._scene=t,this._zIndex=n,this._themeService=s,this._rangeType=i?.rangeType||j.NORMAL,this.initControlPoints()}initControlPoints(){const t=this.currentStyle,n=t.expandCornerSize||0,s=(t.expandCornerSize||0)/4,i=t.autofillStrokeWidth||0,r=t.stroke,o=t.autofillStroke,a=this.zIndex;this._fillControlTopLeft=new Be(mm.fillTopLeft+a,{zIndex:a+2,width:n,height:n,radius:n/2,visualWidth:s,visualHeight:s,strokeWidth:i}),this._fillControlBottomRight=new Be(mm.fillBottomRight+a,{zIndex:a+2,width:n,height:n,radius:n/2,visualHeight:s,visualWidth:s,strokeWidth:i});const l={fill:r,stroke:o,strokeScaleEnabled:!1};this._fillControlTopLeft.setProps({...l}),this._fillControlBottomRight.setProps({...l});const u=[this._fillControlTopLeft,this._fillControlBottomRight];switch(this._rangeType){case j.ROW:this.rowHeaderGroup.addObjects(...u);break;case j.COLUMN:this.columnHeaderGroup.addObjects(...u);break;case j.NORMAL:this.selectionShapeGroup.addObjects(...u)}this.getScene().addObjects(u,Qd)}get fillControlTopLeft(){return this._fillControlTopLeft}set fillControlTopLeft(t){this._fillControlTopLeft=t}get fillControlBottomRight(){return this._fillControlBottomRight}set fillControlBottomRight(t){this._fillControlBottomRight=t}get rangeType(){return this._rangeType}set rangeType(t){this._rangeType=t}dispose(){var t,n;(t=this._fillControlBottomRight)==null||t.dispose(),(n=this._fillControlTopLeft)==null||n.dispose(),super.dispose()}_updateLayoutOfSelectionControl(t){var n,s;super._updateLayoutOfSelectionControl(t);const i=this.currentStyle;t==null&&(t=i);const{widgets:r=i.widgets}=t;if(this.currentStyle=t,this._enableAutoFill===!0&&!super._hasWidgets(r)){const{viewportScrollX:o,viewportScrollY:a}=this.getViewportMainScrollInfo(),{endX:l,endY:u}=this.selectionModel;this.transformControlPoint(o,a,l,u),this.fillControlTopLeft.show(),this.fillControlBottomRight.show()}else(n=this.fillControlTopLeft)==null||n.hide(),(s=this.fillControlBottomRight)==null||s.hide()}getViewportMainScrollInfo(){const t=this.getScene().getViewport($.VIEW_MAIN);return{viewportScrollX:t?.viewportScrollX||0,viewportScrollY:t?.viewportScrollY||0,width:t?.width||0,height:t?.height||0}}transformControlPoint(t=0,n=0,s=0,i=0){const r=this.currentStyle,o=this.selectionModel.rangeType,a=r.expandCornerSize,{startX:l,startY:u,endX:d,endY:c}=this.selectionModel,h=this.getViewportMainScrollInfo(),g=h.width,m=h.height;switch(o){case j.NORMAL:this.fillControlTopLeft.transformByState({left:-a/2,top:-a/2}),this.fillControlBottomRight.transformByState({left:d-l-a/2,top:c-u-a/2});break;case j.ROW:{const p=Math.min(g/2+t,s),f=-a/2+p;this.fillControlTopLeft.transformByState({left:f,top:-a/2}),this.fillControlBottomRight.transformByState({left:f,top:-a/2+c-u})}break;case j.COLUMN:{const p=Math.min(+m/2+n,i),f=-a/2+p;this.fillControlTopLeft.transformByState({left:-a/2,top:f}),this.fillControlBottomRight.transformByState({left:-a/2+d-l,top:f})}break;default:console.error("unknown range type")}}}var V9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Js=(e,t)=>(n,s)=>t(n,s,e);let Em=class extends eb{constructor(e,t,n,s,i,r,o,a,l,u){super(t,n,s,r,l),y(this,"_workbookSelections"),y(this,"_renderDisposable",null),y(this,"_expandingSelection",!1),y(this,"_selectionControls",[]),y(this,"expandingControlMode","bottom-right"),y(this,"_anchorCellForExpanding",null),this._context=e,this._logService=o,this._commandService=a,this._contextService=l,this._scrollManagerService=u,this._workbookSelections=i.getWorkbookSelections(this._context.unitId),this._init()}_init(){const e=this._getSheetObject();this._initEventListeners(e),this._initSelectionChangeListener(),this._initSkeletonChangeListener(),this._initUserActionSyncListener(),this._updateControlPointWhenScrolling()}_initSkeletonChangeListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{var t,n;if(e==null){this._logService.error("[SelectionRenderService]: should not receive null!");return}const s=this._context.unitId,{sheetId:i,skeleton:r}=e,{scene:o}=this._context,a=o.getViewport($.VIEW_MAIN),l=(n=(t=this._skeleton)==null?void 0:t.worksheet)==null?void 0:n.getSheetId();if(this._changeRuntime(r,o,a),l!==r.worksheet.getSheetId()){const d=this._workbookSelections.getCurrentSelections();this._commandService.syncExecuteCommand(me.id,{unitId:s,subUnitId:i,selections:d.length!==0?d:[df(r)]})}const u=this._workbookSelections.getCurrentSelections();u!=null&&this.resetSelectionsByModelData(u)}))}_initSelectionChangeListener(){this.disposeWithMe(Ut(this._workbookSelections.selectionMoveEnd$,this._workbookSelections.selectionSet$).subscribe(e=>{e&&this.resetSelectionsByModelData(e)}))}_initEventListeners(e){const{spreadsheetRowHeader:t,spreadsheetColumnHeader:n,spreadsheet:s,spreadsheetLeftTopPlaceholder:i}=e,{scene:r}=this._context;this._initSpreadsheetEvent(e),this.disposeWithMe(t?.onPointerDown$.subscribeEvent((o,a)=>{if(this._normalSelectionDisabled())return;const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{row:u}=vi(o.offsetX,o.offsetY,r,l);h1(this._workbookSelections.getCurrentSelections(),u)||(this.createNewSelection(o,(s.zIndex||1)+1,j.ROW,this._getActiveViewport(o)),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()))})),this.disposeWithMe(n?.onPointerDown$.subscribeEvent((o,a)=>{if(this._normalSelectionDisabled())return;const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{column:u}=vi(o.offsetX,o.offsetY,r,l);g1(this._workbookSelections.getCurrentSelections(),u)||(this.createNewSelection(o,(s.zIndex||1)+1,j.COLUMN,this._getActiveViewport(o)),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()))})),this.disposeWithMe(i?.onPointerDown$.subscribeEvent((o,a)=>{if(this._normalSelectionDisabled())return;this._reset();const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,u=tb(l);this._addSelectionControlByModelData(u),this.refreshSelectionMoveStart(),a.stopPropagation(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}))}_initSpreadsheetEvent(e){const{spreadsheet:t}=e;let n;const s=500,i={x:0,y:0},r=()=>{clearTimeout(n)},o=(u,d)=>{this._contextService.getContextValue(li)||(this.createNewSelection(u,t.zIndex+1,j.NORMAL,this._getActiveViewport(u)),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()))};t?.onPointerMove$.subscribeEvent((u,d)=>{(Math.abs(u.offsetX-i.x)>10||Math.abs(u.offsetY-i.y)>10)&&r()});const a=t?.onPointerDown$.subscribeEvent((u,d)=>{this._contextService.getContextValue(li)||(i.x=u.offsetX,i.y=u.offsetY,n=setTimeout(()=>{o(u)},s),d.stopPropagation())}),l=t?.onPointerUp$.subscribeEvent((u,d)=>{if(this._normalSelectionDisabled()||this._contextService.getContextValue(li))return;clearTimeout(n);const c=10;Math.abs(u.offsetX-i.x)>c||Math.abs(u.offsetY-i.y)>c||(o(u),d.stopPropagation())});this.disposeWithMe(He(a)),this.disposeWithMe(He(l))}_initUserActionSyncListener(){this.disposeWithMe(this.selectionMoveStart$.subscribe(e=>this._updateSelections(e,Ct.MOVE_START))),this.disposeWithMe(this.selectionMoving$.subscribe(e=>this._updateSelections(e,Ct.MOVING))),this.disposeWithMe(this._contextService.subscribeContextValue$(Fo).pipe(Nt(!1),yn()).subscribe(e=>{var t;e?((t=this._renderDisposable)==null||t.dispose(),this._renderDisposable=null,this._reset()):this._renderDisposable=He(this.selectionMoveEnd$.subscribe(n=>this._updateSelections(n,Ct.MOVE_END)))}))}_updateSelections(e,t){const n=this._context.unit,s=n.getUnitId(),i=n.getActiveSheet().getSheetId();e.length!==0&&this._commandService.executeCommand(me.id,{unitId:s,subUnitId:i,type:t,selections:e.map(r=>Ww(r))})}createNewSelection(e,t=0,n=j.NORMAL,s){this._rangeType=n;const i=this._skeleton,r=this._scene;if(!r||!i)return;s&&(this._activeViewport=s);const{offsetX:o,offsetY:a}=e,l=r.getCoordRelativeToViewport(at.FromArray([o,a])),{x:u,y:d}=l;this._startViewportPosX=u,this._startViewportPosY=d;const c=r.getScrollXYInfoByViewport(l),{scaleX:h,scaleY:g}=r.getAncestorScale(),m=this._skeleton.getCellByOffset(u,d,h,g,c);if(!m)return;switch(n){case j.NORMAL:break;case j.ROW:m.startColumn=0,m.endColumn=this._skeleton.getColumnCount()-1;break;case j.COLUMN:m.startRow=0,m.endRow=this._skeleton.getRowCount()-1;break;case j.ALL:m.startRow=0,m.startColumn=0,m.endRow=this._skeleton.getRowCount()-1,m.endColumn=this._skeleton.getColumnCount()-1}const p={range:m,primary:m,style:null};p.range.rangeType=n;const f=In(p,this._skeleton);this._startRangeWhenPointerDown={...f.rangeWithCoord};let v=this.getActiveSelectionControl();const C={...f.rangeWithCoord};for(const w of this.getSelectionControls())if(w.model.isEqual(C)){v=w;break}v?.model.rangeType!==n?(this._clearAllSelectionControls(),v=this.newSelectionControl(r,i,p)):v.updateRangeBySelectionWithCoord(f),this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._clearUpdatingListeners(),this._expandingSelection=!1}newSelectionControl(e,t,n){const s=this.getSelectionControls(),{rowHeaderWidth:i,columnHeaderHeight:r}=t,o=n.range.rangeType,a=new A9(e,s.length,this._themeService,{highlightHeader:this._highlightHeader,rowHeaderWidth:i,columnHeaderHeight:r,rangeType:o}),l=In(n,t);a.updateRangeBySelectionWithCoord(l),this._selectionControls.push(a);const{expandingModeForTopLeft:u,expandingModeForBottomRight:d}=(()=>{switch(o){case j.NORMAL:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"};case j.ROW:return{expandingModeForTopLeft:"top",expandingModeForBottomRight:"bottom"};case j.COLUMN:return{expandingModeForTopLeft:"left",expandingModeForBottomRight:"right"};case j.ALL:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"};default:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"}}})();return a.fillControlTopLeft.onPointerDown$.subscribeEvent(c=>{this._expandingSelection=!0,this._contextService.setContextValue(jo,!0),this.expandingControlMode=u,this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._fillControlPointerDownHandler(c,o,this._activeViewport)}),a.fillControlBottomRight.onPointerDown$.subscribeEvent(c=>{this._expandingSelection=!0,this._contextService.setContextValue(jo,!0),this.expandingControlMode=d,this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._fillControlPointerDownHandler(c,o,this._activeViewport)}),(o===j.ROW||o===j.COLUMN)&&e.getViewport($.VIEW_MAIN),a}_getActiveViewport(e){const t=this._getSheetObject();return t?.scene.getActiveViewportByCoord(at.FromArray([e.offsetX,e.offsetY]))}_getSheetObject(){return Rs(this._context.unit,this._context)}_normalSelectionDisabled(){return this._contextService.getContextValue(Fo)}getSelectionControls(){return this._selectionControls}_fillControlPointerDownHandler(e,t=j.NORMAL,n,s=tn.ALL){var i;const r=this._skeleton,o=this._scene;if(!o||!r)return;n&&(this._activeViewport=n);const a=o.getViewport($.VIEW_MAIN),l=this.getActiveSelectionControl();if(!l)return;const u=this._changeCurrCellWhenControlPointerDown();this._anchorCellForExpanding=u,this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._clearUpdatingListeners(),this._addEndingListeners(),(i=o.getTransformer())==null||i.clearSelectedObjects();const d=o.getCoordRelativeToViewport(at.FromArray([e.offsetX,e.offsetY]));this._setupPointerMoveListener(a,l,t,s,d.x,d.y);const c=this._shortcutService.forceEscape();this._scenePointerUpSub=o.onPointerUp$.subscribeEvent(h=>{this.endSelection(),this._expandingSelection=!1,this._contextService.setContextValue(jo,!1),this.expandingControlMode="bottom-right",this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),c.dispose()})}_changeCurrCellWhenControlPointerDown(){const e=this.getActiveSelectionControl(),t=this._skeleton;let n;const{startRow:s,startColumn:i,endRow:r,endColumn:o}=e.model;switch(this.expandingControlMode){case"top-left":n=t.getCellWithCoordByIndex(r,o);break;case"bottom-right":n=t.getCellWithCoordByIndex(s,i);break;case"left":n=t.getCellWithCoordByIndex(s,o),n.isMerged=!1,n.isMergedMainCell=!1;break;case"right":n=t.getCellWithCoordByIndex(s,i),n.isMerged=!1,n.isMergedMainCell=!1;break;case"top":n=t.getCellWithCoordByIndex(r,i),n.isMerged=!1,n.isMergedMainCell=!1;break;case"bottom":n=t.getCellWithCoordByIndex(s,i),n.isMerged=!1,n.isMergedMainCell=!1;break;default:n=t.getCellWithCoordByIndex(s,i)}return e.updateCurrCell(n),n}_setupPointerMoveListener(e,t,n,s=tn.ALL,i,r){var o,a;this._scrollTimer=To.create(this._scene,s),this._scrollTimer.startScroll((o=e?.left)!=null?o:0,(a=e?.top)!=null?a:0,e);const l=this._scene;this._scenePointerMoveSub=l.onPointerMove$.subscribeEvent(u=>{if(this._contextService.getContextValue(li))return;const{offsetX:d,offsetY:c}=u,{x:h,y:g}=l.getCoordRelativeToViewport(at.FromArray([d,c]));this._movingHandler(h,g,t,n);const m=h,p=g;this._scrollTimer.scrolling(m,p,()=>{this._movingHandler(h,g,t,n)})})}_movingHandler(e,t,n,s){var i,r,o,a,l,u,d,c,h,g,m,p,f,v;this._rangeType=s;const C=this._skeleton,w=this._scene,b={startRow:n.model.startRow,endRow:n.model.endRow,startColumn:n.model.startColumn,endColumn:n.model.endColumn},I=w.getViewport($.VIEW_MAIN),_=(i=this._getViewportByCell(b.endRow,b.endColumn))!=null?i:I,R=w.getScrollXYInfoByViewport(at.FromArray([this._startViewportPosX,this._startViewportPosY]),_),{scaleX:M,scaleY:x}=w.getAncestorScale();s===j.ROW?e=Number.POSITIVE_INFINITY:s===j.COLUMN&&(t=Number.POSITIVE_INFINITY);const N=this._getSelectionWithCoordByOffset(e,t,M,x,R);if(!N)return!1;const{rangeWithCoord:T}=N,O=(r=this._anchorCellForExpanding)!=null?r:n.model.currentCell,k=(l=(a=(o=O?.mergeInfo)==null?void 0:o.startRow)!=null?a:O?.actualRow)!=null?l:-1,D=(c=(d=(u=O?.mergeInfo)==null?void 0:u.endRow)!=null?d:O?.actualRow)!=null?c:-1,B=(m=(g=(h=O?.mergeInfo)==null?void 0:h.startColumn)!=null?g:O?.actualColumn)!=null?m:-1,W=(v=(f=(p=O?.mergeInfo)==null?void 0:p.endColumn)!=null?f:O?.actualColumn)!=null?v:-1;let F=Math.min(T.startRow,k);k===-1&&(F=T.startRow);let K=Math.min(T.startColumn,B);B===-1&&(K=T.startColumn);let J={startRow:F,startColumn:K,endRow:Math.max(T.endRow,D),endColumn:Math.max(T.endColumn,W)};if(s===j.NORMAL?J=C.expandRangeByMerge(J):s===j.COLUMN?J={startRow:0,startColumn:Math.min(T.startColumn,B),endRow:C.getRowCount()-1,endColumn:Math.max(T.endColumn,W)}:s===j.ROW&&(J={startRow:Math.min(T.startRow,k),startColumn:0,endRow:Math.max(T.endRow,D),endColumn:C.getColumnCount()-1}),!J)return!1;const ee=In({range:J,style:null,primary:null},C);(b.startRow!==J.startRow||b.startColumn!==J.startColumn||b.endRow!==J.endRow||b.endColumn!==J.endColumn)&&n&&(n.updateRangeBySelectionWithCoord(ee),this._selectionMoving$.next(this.getSelectionDataWithStyle()))}_updateControlPointWhenScrolling(){const{scene:e}=this._context;if(!e.getViewport($.VIEW_MAIN))return;const t=this._scrollManagerService.validViewportScrollInfo$.subscribe(n=>{var s;if(n==null)return;const{viewportScrollX:i,viewportScrollY:r}=n,o=this.getActiveSelectionControl();if(o==null)return;const a=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton,l=a?.rowTotalHeight,u=a?.columnTotalWidth,d=o.rangeType;d===j.COLUMN?o.transformControlPoint(0,r,u,l):d===j.ROW&&o.transformControlPoint(i,0,u,l)});this.disposeWithMe(He(t))}};Em=V9([Js(1,V(pt)),Js(2,V(xn)),Js(3,Yc),Js(4,V(q)),Js(5,V(Te)),Js(6,ar),Js(7,U),Js(8,Ne),Js(9,V(Sn))],Em);var H9=Object.defineProperty,D9=(e,t,n)=>t in e?H9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ja=(e,t)=>(n,s)=>t(n,s,e),w_=(e,t,n)=>D9(e,typeof t!="symbol"?t+"":t,n);let Oc=class extends Vm{constructor(e=rc,t,n,s,i,r){super(),this._config=e,this._injector=t,this._renderManagerService=n,this._configService=s,this._univerInstanceService=i,this._componentManager=r;const{menu:o,...a}=Hm({},rc,this._config);if(a.protectedRangeUserSelector){const{component:l,framework:u}=a.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(_h,l,{framework:u}))}o&&this._configService.setConfig("menu",o,{merge:!0}),this._configService.setConfig(Jt,{...a})}onStarting(){_l(this._injector,Dm([[ia],[xt,{useClass:ic}],[hs,{useClass:ec}],[ho,{useClass:wb}],[Ii,{useClass:sc}],[ku,{useClass:Ib}],[Tu,{useClass:Db}],[$c,{useClass:Ed}],[C_],[Vh,{useClass:Wb}],[Na,{useClass:$d}],[Kr],[eu],[ha],[$r],[au],[Sf],[v_,{useClass:Nc}],[tu],[la],[qr],[Qr],[ir],[bc],[Jr],[aa],[fa],[ma],[pa],[ga],[da],[Gr],[va],[co],[Ca],[ca],[wa]],this._config.override))}onReady(){this._config.disableAutoFocus||this._initAutoFocus(),_l(this._injector,[[eo]]),this._registerRenderBasics(),Ns(this._injector,[[bc],[ir],[ca],[va]])}onRendered(){this._registerRenderModules(),Ns(this._injector,[[wa],[Gr],[eo],[Qr],[ma],[Jr],[la],[qr],[pa],[ga],[da]])}onSteady(){Ns(this._injector,[[fa],[aa],[Ca]])}_registerRenderBasics(){[[Te],[Pc],[mc],[Zt,{useClass:Em}],[Sn],[Uc]].forEach(e=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(A.UNIVER_SHEET,e))})}_registerRenderModules(){var e;const t=[[iu],[Tc],[ra],[Mm],[su],[$l],[xc],[Ec],[fc],[vc],[Cc],[Sc],[uc],[ac],[wc],[oc],[ym],[_c],[nu],[Ic],[Rc],[yc],[Mc]],n=this._configService.getConfig(Fc);((e=n?.contextMenu)==null||e)&&t.push([kc]),t.forEach(s=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(A.UNIVER_SHEET,s))})}_initAutoFocus(){const e=this._univerInstanceService;this.disposeWithMe(e.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe(Wt(t=>!!t)).subscribe(t=>e.focusUnit(t.getUnitId())))}};w_(Oc,"pluginName","SHEET_UI_PLUGIN");w_(Oc,"type",A.UNIVER_SHEET);Oc=W9([Wm(ea,GI),Ja(1,V(pt)),Ja(2,ze),Ja(3,Lt),Ja(4,P),Ja(5,V(Tn))],Oc);var L9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Wg=(e,t)=>(n,s)=>t(n,s,e);let xm=class extends ae{constructor(e,t,n,s){super(),this._context=e,this._contextMenuService=t,this._selectionManagerService=n,this._selectionRenderService=s,this._init()}_init(){var e,t;const n=((t=(e=this._context)==null?void 0:e.mainComponent)==null?void 0:t.onPointerDown$).subscribeEvent(o=>{if(o.button===2){const a=this._selectionManagerService.getCurrentSelections(),l=a?.[0];if(!l)return;const u=l.range.rangeType,d=this._selectionRenderService.getSkeleton(),c=In(l,d).rangeWithCoord,h=()=>{if(!c)return!1;const m=o.offsetX,p=o.offsetY;switch(u){case j.ROW:return c.startY<=p&&c.endY>=p;case j.COLUMN:return c.startX<=m&&c.endX>=m;default:return c.startX<=m&&c.endX>=m&&c.startY<=p&&c.endY>=p}},g=m=>{this._contextMenuService.triggerContextMenu(o,m)};h()?u===j.COLUMN?g(un.COL_HEADER):u===j.ROW?g(un.ROW_HEADER):g(un.MAIN_AREA):g(un.MAIN_AREA)}});this.disposeWithMe(n);const s=this._context.components.get(yt.COLUMN),i=this._context.components.get(yt.ROW).onPointerDown$.subscribeEvent(o=>{o.button===2&&this._contextMenuService.triggerContextMenu(o,un.ROW_HEADER)});this.disposeWithMe(i);const r=s.onPointerDown$.subscribeEvent(o=>{o.button===2&&this._contextMenuService.triggerContextMenu(o,un.COL_HEADER)});this.disposeWithMe(r)}};xm=L9([Wg(1,Xc),Wg(2,V(q)),Wg(3,Zt)],xm);var B9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},DC=(e,t)=>(n,s)=>t(n,s,e);function j9(e){return typeof e.setShadowStrategy=="function"}let km=class extends ae{constructor(e,t){super(),y(this,"_currentStrategy"),y(this,"_strategySubject"),this._configService=e,this._renderManagerService=t;const n=this._configService.getConfig(Jt);this._currentStrategy=If(n?.protectedRangeShadow),this._strategySubject=new xe(this._currentStrategy),this.disposeWithMe({dispose:()=>{this._strategySubject.complete()}})}_updateAllWorkbooks(e){this._renderManagerService.getRenderAll().forEach(t=>{const n=t.mainComponent;if(!n)return;const s=[{key:Vf},{key:Hf},{key:Df}];let i=!1;for(const{key:r}of s){const o=n.getExtensionByKey(r);o&&j9(o)&&(o.setShadowStrategy(e),i=!0)}i&&n.makeDirty(!0)})}setProtectedRangeShadowStrategy(e){this._currentStrategy=e,this._strategySubject.next(e),this._updateAllWorkbooks(e)}getProtectedRangeShadowStrategy(){return this._currentStrategy}getProtectedRangeShadowStrategy$(){return this._strategySubject.asObservable()}dispose(){super.dispose(),this._strategySubject.complete()}};km=B9([DC(0,Lt),DC(1,ze)],km);var F9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Oi=(e,t)=>(n,s)=>t(n,s,e);let Tm=class extends eb{constructor(e,t,n,s,i,r,o,a,l){super(t,n,s,r,l),y(this,"_workbookSelections"),y(this,"_renderDisposable",null),this._context=e,this._logService=o,this._commandService=a,this._contextService=l,this._workbookSelections=i.getWorkbookSelections(this._context.unitId),this._init()}_init(){const e=this._getSheetObject();this._contextService.setContextValue(Eo,!0),this._initEventListeners(e),this._initSelectionModelChangeListener(),this._initThemeChangeListener(),this._initSkeletonChangeListener(),this._initUserActionSyncListener()}dispose(){var e;super.dispose(),(e=this._renderDisposable)==null||e.dispose()}_initEventListeners(e){const{spreadsheetRowHeader:t,spreadsheetColumnHeader:n,spreadsheet:s,spreadsheetLeftTopPlaceholder:i}=e,{scene:r}=this._context;this.disposeWithMe(s?.onPointerDown$.subscribeEvent((o,a)=>{this.isSelectionDisabled()||this.inRefSelectionMode()||(this._onPointerDown(o,s.zIndex+1,j.NORMAL,this._getActiveViewport(o)),o.button!==2&&a.stopPropagation())})),this.disposeWithMe(t?.onPointerDown$.subscribeEvent((o,a)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{row:u}=vi(o.offsetX,o.offsetY,r,l);h1(this._workbookSelections.getCurrentSelections(),u)||(this._onPointerDown(o,(s.zIndex||1)+1,j.ROW,this._getActiveViewport(o),tn.Y),o.button!==2&&a.stopPropagation())})),this.disposeWithMe(n?.onPointerDown$.subscribeEvent((o,a)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{column:u}=vi(o.offsetX,o.offsetY,r,l);g1(this._workbookSelections.getCurrentSelections(),u)||(this._onPointerDown(o,(s.zIndex||1)+1,j.COLUMN,this._getActiveViewport(o),tn.X),o.button!==2&&a.stopPropagation())})),this.disposeWithMe(i?.onPointerDown$.subscribeEvent((o,a)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;this._reset();const l=this._sheetSkeletonManagerService.getCurrentParam().skeleton,u=tb(l);this._addSelectionControlByModelData(u),this.refreshSelectionMoveEnd(),o.button!==2&&a.stopPropagation()}))}_initThemeChangeListener(){this.disposeWithMe(this._themeService.currentTheme$.subscribe(()=>{this._initSelectionThemeFromThemeService();const e=this._workbookSelections.getCurrentSelections();e&&this.resetSelectionsByModelData(e)}))}_initSelectionModelChangeListener(){this.disposeWithMe(Ut(this._workbookSelections.selectionMoveEnd$,this._workbookSelections.selectionSet$).subscribe(e=>{this.resetSelectionsByModelData(e)}))}disableSelection(){this._contextService.setContextValue(Eo,!1)}enableSelection(){this._contextService.setContextValue(Eo,!0)}transparentSelection(){const e=this._themeService.getCurrentTheme(),t=dI(e,"primary.600","transparent");this.setSelectionTheme(t);const n=this._workbookSelections.getCurrentSelections();for(let s=0;s<n.length;s++){const i=n[s];i.style=sr(this._selectionTheme)}this.resetSelectionsByModelData(n)}showSelection(){const e=this._themeService.getCurrentTheme();this.setSelectionTheme(e);const t=this._workbookSelections.getCurrentSelections();for(let n=0;n<t.length;n++){const s=t[n];s.style&&(s.style=sr(this._selectionTheme))}this.resetSelectionsByModelData(t)}_initUserActionSyncListener(){this.disposeWithMe(this.selectionMoveStart$.subscribe(e=>this._updateSelections(e,Ct.MOVE_START))),this.disposeWithMe(this.selectionMoving$.subscribe(e=>this._updateSelections(e,Ct.MOVING))),this.disposeWithMe(this._contextService.subscribeContextValue$(Fo).pipe(Nt(!1),yn()).subscribe(e=>{e&&this._reset()})),this.disposeWithMe(this._contextService.subscribeContextValue$(Eo).pipe(Nt(!0),yn()).subscribe(e=>{var t;e?this._renderDisposable=He(this.selectionMoveEnd$.subscribe(n=>{this._updateSelections(n,Ct.MOVE_END)})):((t=this._renderDisposable)==null||t.dispose(),this._renderDisposable=null,this._reset())}))}_updateSelections(e,t){const n=this._context.unit,s=n.getUnitId(),i=n.getActiveSheet().getSheetId();if(e.length===0)return;const r=e.map(o=>Ww(o));this._commandService.executeCommand(me.id,{unitId:s,subUnitId:i,type:t,selections:r})}_initSkeletonChangeListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{var t,n;if(e==null){this._logService.error("[SelectionRenderService]: should not receive null!");return}const s=this._context.unitId,{sheetId:i,skeleton:r}=e,{scene:o}=this._context,a=o.getViewport($.VIEW_MAIN),l=(n=(t=this._skeleton)==null?void 0:t.worksheet)==null?void 0:n.getSheetId();if(this._changeRuntime(r,o,a),l!==r.worksheet.getSheetId()){const d=this._workbookSelections.getCurrentSelections();this._commandService.syncExecuteCommand(me.id,{unitId:s,subUnitId:i,selections:d.length!==0?d:[df(r)]})}const u=this._workbookSelections.getCurrentSelections();u!=null&&this.resetSelectionsByModelData(u)}))}_getActiveViewport(e){const t=this._getSheetObject();return t?.scene.getActiveViewportByCoord(at.FromArray([e.offsetX,e.offsetY]))}_getSheetObject(){return Rs(this._context.unit,this._context)}_onPointerDown(e,t=0,n=j.NORMAL,s,i=tn.ALL){var r,o;this._rangeType=n;const a=this._skeleton,l=this._scene;if(!l||!a)return;s&&(this._activeViewport=s);const{offsetX:u,offsetY:d}=e,c=l.getViewport($.VIEW_MAIN);if(!c)return;const h=l.getCoordRelativeToViewport(at.FromArray([u,d])),{x:g,y:m}=h;this._startViewportPosX=g,this._startViewportPosY=m;const p=l.getScrollXYInfoByViewport(h),{scaleX:f,scaleY:v}=l.getAncestorScale(),C=this._skeleton.getCellByOffset(g,m,f,v,p);if(!C)return;switch(n){case j.NORMAL:break;case j.ROW:C.startColumn=0,C.endColumn=this._skeleton.getColumnCount()-1,C.startRow=C.actualRow,C.endRow=C.actualRow;break;case j.COLUMN:C.startRow=0,C.endRow=this._skeleton.getRowCount()-1,C.startColumn=C.actualColumn,C.endColumn=C.actualColumn;break;case j.ALL:C.startRow=0,C.startColumn=0,C.endRow=this._skeleton.getRowCount()-1,C.endColumn=this._skeleton.getColumnCount()-1}const w={range:C,primary:C,style:null};w.range.rangeType=n;const b=In(w,this._skeleton);this._startRangeWhenPointerDown={...b.rangeWithCoord};let I=this.getActiveSelectionControl();const _={...b.rangeWithCoord,rangeType:n},R=this.getSelectionControls();for(const T of R)if(e.button===2&&z.contains(T.model,_)){I=T;return}this._checkClearPreviousControls(e);const M=I?.model.currentCell,x=e.shiftKey&&M,N=this._remainLastEnabled&&!e.ctrlKey&&!e.shiftKey&&!this._skipLastEnabled&&!this._singleSelectionEnabled;x?this._makeSelectionByTwoCells(M,_,a,n,I):N&&I?I.updateRangeBySelectionWithCoord(b):I=this.newSelectionControl(l,a,w);for(let T=0;T<this.getSelectionControls().length-1;T++)this.getSelectionControls()[T].clearHighlight();l.disableObjectsEvent(),this._clearUpdatingListeners(),this._addEndingListeners(),(r=l.getTransformer())==null||r.clearSelectedObjects(),this._setupPointerMoveListener(c,I,n,i,g,m),this._escapeShortcutDisposable=this._shortcutService.forceEscape(),this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._scenePointerUpSub=l.onPointerUp$.subscribeEvent(()=>{var T;this._clearUpdatingListeners(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),(T=this._escapeShortcutDisposable)==null||T.dispose(),this._escapeShortcutDisposable=null}),(o=this._scene.getEngine())==null||o.setCapture()}};Tm=F9([Oi(1,V(pt)),Oi(2,V(xn)),Oi(3,Yc),Oi(4,V(q)),Oi(5,V(Te)),Oi(6,ar),Oi(7,U),Oi(8,Ne)],Tm);var z9=Object.defineProperty,X9=(e,t,n)=>t in e?z9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Y9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},el=(e,t)=>(n,s)=>t(n,s,e),S_=(e,t,n)=>X9(e,typeof t!="symbol"?t+"":t,n);let Ac=class extends Vm{constructor(e=rc,t,n,s,i,r){super(),this._config=e,this._injector=t,this._renderManagerService=n,this._configService=s,this._univerInstanceService=i,this._componentManager=r;const{menu:o,...a}=Hm({},rc,this._config);if(a.protectedRangeUserSelector){const{component:l,framework:u}=a.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(_h,l,{framework:u}))}o&&this._configService.setConfig("menu",o,{merge:!0}),this._configService.setConfig(Jt,{...a})}onStarting(){_l(this._injector,Dm([[ia],[xt,{useClass:ic}],[hs,{useClass:ec}],[ho,{useClass:wb}],[Ii,{useClass:sc}],[ku,{useClass:Ib}],[Tu,{useClass:Db}],[$c,{useClass:Ed}],[C_],[Vh,{useClass:Wb}],[Na,{useClass:$d}],[Kr],[eu],[ha],[$r],[au],[Sf],[v_,{useClass:Nc}],[tu],[la],[qr],[Qr],[ir],[pc],[Jr],[aa],[fa],[ma],[pa],[ga],[da],[Gr],[va],[co],[km],[Ca],[ca],[wa]],this._config.override))}onReady(){this._config.disableAutoFocus||this._initAutoFocus(),_l(this._injector,[[eo]]),this._registerRenderBasics(),Ns(this._injector,[[pc],[ir],[ca],[va]])}onRendered(){this._registerRenderModules(),Ns(this._injector,[[wa],[Gr],[eo],[Qr],[ma],[Jr],[la],[qr],[pa],[ga],[da]])}onSteady(){Ns(this._injector,[[fa],[aa],[Ca]])}_registerRenderBasics(){[[Te],[Pc],[mc],[Zt,{useClass:Tm}],[Uc]].forEach(e=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(A.UNIVER_SHEET,e))})}_registerRenderModules(){var e;const t=[[iu],[Tc],[gc],[Sn],[ra],[su],[$l],[xc],[Ec],[fc],[vc],[Cc],[Sc],[uc],[ac],[wc],[oc],[xm],[_c],[nu],[Ic],[Rc],[yc],[Mc]],n=this._configService.getConfig(Fc);((e=n?.contextMenu)==null||e)&&t.push([kc]),t.forEach(s=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(A.UNIVER_SHEET,s))})}_initAutoFocus(){const e=this._univerInstanceService;this.disposeWithMe(e.getCurrentTypeOfUnit$(A.UNIVER_SHEET).pipe(Wt(t=>!!t)).subscribe(t=>e.focusUnit(t.getUnitId())))}};S_(Ac,"pluginName","SHEET_UI_PLUGIN");S_(Ac,"type",A.UNIVER_SHEET);Ac=Y9([Wm(ea),el(1,V(pt)),el(2,ze),el(3,Lt),el(4,P),el(5,V(Tn))],Ac);function jP(e,t,n,s){const{from:i,to:r}=n,{column:o,columnOffset:a,row:l,rowOffset:u}=i,{column:d,columnOffset:c,row:h,rowOffset:g}=r,m=s.ensureSkeleton(t);if(m==null)throw new Error("No current skeleton");const p=Bl(m,{startColumn:o,endColumn:o,startRow:l,endRow:l}),f=Bl(m,{startColumn:d,endColumn:d,startRow:h,endRow:h}),{startX:v,startY:C}=p,{startX:w,startY:b}=f,I=Di(v+a,1),_=Di(C+u,1);let R=Di(w+c-I,1),M=Di(b+g-_,1);return p.startX===f.endX&&(R=0),p.startY===f.endY&&(M=0),{unitId:e,subUnitId:t,left:I,top:_,width:R,height:M}}function FP(e,t,n,s,i,r,o){const{column:a,columnOffset:l,row:u,rowOffset:d}=n,c=o.ensureSkeleton(t);if(c==null)throw new Error("No current skeleton");const h=Bl(c,{startColumn:a,endColumn:a,startRow:u,endRow:u}),{startX:g,startY:m}=h,p=Di(g+l,1),f=Di(m+d,1),v=r.getCellWithCoordByOffset(p+s,f+i,c);if(v==null)throw new Error("No end selection cell");const C={column:v.actualColumn,columnOffset:Di(p+s-v.startX,1),row:v.actualRow,rowOffset:Di(f+i-v.startY,1)};return{unitId:e,subUnitId:t,sheetTransform:{from:{column:a,columnOffset:l,row:u,rowOffset:d},to:C},transform:{left:p,top:f,width:s,height:i}}}var Z9=Object.defineProperty,G9=(e,t,n)=>t in e?Z9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,St=(e,t,n)=>G9(e,typeof t!="symbol"?t+"":t,n),q9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ei=(e,t)=>(n,s)=>t(n,s,e);function Q9(e,t,n){const s=n.getDefinedNameMap(e);if(s==null)return t.t("definedName.defaultName")+1;const i=Array.from(Object.values(s)).length+1,r=t.t("definedName.defaultName")+i;if(n.getValueByName(e,r)==null)return r;let o=i+1;for(;;){const a=t.t("definedName.defaultName")+o;if(n.getValueByName(e,a)==null)return a;o++}}class Dh{constructor(){St(this,"_definedNameParam"),this._definedNameParam={id:hn(10),unitId:"",name:"",formulaOrRefString:"",localSheetId:nr}}setName(t){return this._definedNameParam.name=t,this}setFormula(t){return this._definedNameParam.formulaOrRefString=`=${t}`,this}setRef(t){return this._definedNameParam.formulaOrRefString=t,this}setRefByRange(t,n,s,i){return this._definedNameParam.formulaOrRefString=gu({startRow:t,endRow:t+(s??1)-1,startColumn:n,endColumn:n+(i??1)-1}),this}setComment(t){return this._definedNameParam.comment=t,this}setScopeToWorksheet(t){return this._definedNameParam.localSheetId=t.getSheetId(),this}setScopeToWorkbook(){return this._definedNameParam.localSheetId=nr,this}setHidden(t){return this._definedNameParam.hidden=t,this}build(){return this._definedNameParam}load(t){return this._definedNameParam=t,this}}let Vc=class extends np{constructor(e,t,n,s,i,r,o,a,l,u){super(),this._definedNameParam=e,this._injector=t,this._commandService=n,this._permissionService=s,this._worksheetProtectionRuleModel=i,this._rangeProtectionRuleModel=r,this._worksheetProtectionPointRuleModel=o,this._authzIoService=a,this._localeService=l,this._definedNamesService=u}_apply(){this._definedNameParam.name===""&&(this._definedNameParam.name=Q9(this._definedNameParam.unitId,this._localeService,this._definedNamesService)),this._commandService.syncExecuteCommand(qo.id,this._definedNameParam)}getName(){return this._definedNameParam.name}setName(e){this._definedNameParam.name=e,this._apply()}setFormula(e){this._definedNameParam.formulaOrRefString=`=${e}`,this._apply()}setRef(e){this._definedNameParam.formulaOrRefString=e,this._apply()}getFormulaOrRefString(){return this._definedNameParam.formulaOrRefString}setRefByRange(e,t,n,s){this._definedNameParam.formulaOrRefString=gu({startRow:e,endRow:e+(n??1)-1,startColumn:t,endColumn:t+(s??1)-1}),this._apply()}getComment(){return this._definedNameParam.comment}setComment(e){this._definedNameParam.comment=e,this._apply()}setScopeToWorksheet(e){this._definedNameParam.localSheetId=e.getSheetId(),this._apply()}setScopeToWorkbook(){this._definedNameParam.localSheetId=nr,this._apply()}setHidden(e){this._definedNameParam.hidden=e,this._apply()}delete(){this._commandService.syncExecuteCommand(oh.id,this._definedNameParam)}getLocalSheetId(){return this._definedNameParam.localSheetId}isWorkbookScope(){return this._definedNameParam.localSheetId===nr}toBuilder(){const e=this._injector.createInstance(Dh);return e.load(this._definedNameParam),e}};Vc=q9([ei(1,V(pt)),ei(2,U),ei(3,Je),ei(4,V(ft)),ei(5,V(We)),ei(6,V(_i)),ei(7,V(Ys)),ei(8,V(Oe)),ei(9,wi)],Vc);var xr=(e=>(e[e.Reader=0]="Reader",e[e.Editor=1]="Editor",e[e.Owner=2]="Owner",e))(xr||{}),ye=(e=>(e.Edit="WorkbookEdit",e.View="WorkbookView",e.Print="WorkbookPrint",e.Export="WorkbookExport",e.Share="WorkbookShare",e.CopyContent="WorkbookCopy",e.DuplicateFile="WorkbookDuplicate",e.Comment="WorkbookComment",e.ManageCollaborator="WorkbookManageCollaborator",e.CreateSheet="WorkbookCreateSheet",e.DeleteSheet="WorkbookDeleteSheet",e.RenameSheet="WorkbookRenameSheet",e.MoveSheet="WorkbookMoveSheet",e.HideSheet="WorkbookHideSheet",e.ViewHistory="WorkbookViewHistory",e.ManageHistory="WorkbookHistory",e.RecoverHistory="WorkbookRecoverHistory",e.CreateProtection="WorkbookCreateProtect",e.InsertRow="WorkbookInsertRow",e.InsertColumn="WorkbookInsertColumn",e.DeleteRow="WorkbookDeleteRow",e.DeleteColumn="WorkbookDeleteColumn",e.CopySheet="WorkbookCopySheet",e))(ye||{}),ht=(e=>(e.Edit="WorksheetEdit",e.View="WorksheetView",e.Copy="WorksheetCopy",e.SetCellValue="WorksheetSetCellValue",e.SetCellStyle="WorksheetSetCellStyle",e.SetRowStyle="WorksheetSetRowStyle",e.SetColumnStyle="WorksheetSetColumnStyle",e.InsertRow="WorksheetInsertRow",e.InsertColumn="WorksheetInsertColumn",e.DeleteRow="WorksheetDeleteRow",e.DeleteColumn="WorksheetDeleteColumn",e.Sort="WorksheetSort",e.Filter="WorksheetFilter",e.PivotTable="WorksheetPivotTable",e.InsertHyperlink="WorksheetInsertHyperlink",e.EditExtraObject="WorksheetEditExtraObject",e.ManageCollaborator="WorksheetManageCollaborator",e.DeleteProtection="WorksheetDeleteProtection",e.SelectProtectedCells="WorksheetSelectProtectedCells",e.SelectUnProtectedCells="WorksheetSelectUnProtectedCells",e))(ht||{}),fn=(e=>(e.Edit="RangeEdit",e.View="RangeView",e.ManageCollaborator="RangeManageCollaborator",e.Delete="RangeDeleteProtection",e))(fn||{}),K9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Ai=(e,t)=>(n,s)=>t(n,s,e);let to=class extends np{constructor(e,t,n,s,i,r,o,a){super(),St(this,"permissionPointsDefinition",ox),St(this,"rangeRuleChangedAfterAuth$"),St(this,"sheetRuleChangedAfterAuth$"),St(this,"unitPermissionInitStateChange$"),this._injector=e,this._commandService=t,this._permissionService=n,this._worksheetProtectionRuleModel=s,this._rangeProtectionRuleModel=i,this._worksheetProtectionPointRuleModel=r,this._workbookPermissionService=o,this._authzIoService=a,this.rangeRuleChangedAfterAuth$=this._rangeProtectionRuleModel.ruleRefresh$,this.sheetRuleChangedAfterAuth$=this._worksheetProtectionRuleModel.ruleRefresh$,this.unitPermissionInitStateChange$=this._workbookPermissionService.unitPermissionInitStateChange$}setWorkbookPermissionPoint(e,t,n){const s=new t(e);this._permissionService.getPermissionPoint(s.id)||this._permissionService.addPermissionPoint(s),this._permissionService.updatePermissionPoint(s.id,n)}checkWorkbookPermissionPoint(e,t){const n=new t(e),s=this._permissionService.getPermissionPoint(n.id);if(s)return s.value}setWorkbookEditPermission(e,t){this.setWorkbookPermissionPoint(e,ne,t)}async addWorksheetBasePermission(e,t,n){let s=[];if(n!=null&&n.allowedUsers){const r=await this._authzIoService.listCollaborators({objectID:e,unitID:e}),o=new Set(n.allowedUsers);s=r.filter(l=>{var u;return o.has(((u=l.subject)==null?void 0:u.userID)||l.id)}).map(l=>({id:l.id,role:xr.Editor,subject:l.subject}));const a=new Set(s.map(l=>{var u;return((u=l.subject)==null?void 0:u.userID)||l.id}));n.allowedUsers.forEach(l=>{a.has(l)||console.error(`User ${l} not found in collaborators list`)})}const i=await this._authzIoService.create({objectType:se.Worksheet,worksheetObject:{collaborators:s,unitID:e,strategies:[],name:n?.name||"",scope:void 0}});if(this._commandService.syncExecuteCommand($i.id,{unitId:e,subUnitId:t,rule:{permissionId:i,unitType:se.Worksheet,unitId:e,subUnitId:t}}))return i}removeWorksheetPermission(e,t){this._commandService.syncExecuteCommand(Hr.id,{unitId:e,subUnitId:t}),[..._n(),...zn()].forEach(n=>{const s=new n(e,t);this._permissionService.updatePermissionPoint(s.id,!0)}),this._worksheetProtectionPointRuleModel.deleteRule(e,t)}async setWorksheetPermissionPoint(e,t,n,s){const i=this._worksheetProtectionRuleModel.getRule(e,t);let r;if(n===oe||n===cr)i?r=i.permissionId:r=await this.addWorksheetBasePermission(e,t);else{const a=this._worksheetProtectionPointRuleModel.getRule(e,t);a?r=a.permissionId:(r=await this._authzIoService.create({objectType:se.Worksheet,worksheetObject:{collaborators:[],unitID:e,strategies:[],name:"",scope:void 0}}),this._commandService.syncExecuteCommand(gh.id,{unitId:e,subUnitId:t,rule:{unitId:e,subUnitId:t,permissionId:r}}))}const o=new n(e,t);if(this._permissionService.getPermissionPoint(o.id)||this._permissionService.addPermissionPoint(o),r){const a=o.subType;await this._authzIoService.update({objectType:se.Worksheet,objectID:r,strategies:[{action:a,role:s?xr.Owner:xr.Reader}],unitID:e,share:void 0,name:"",scope:void 0,collaborators:void 0})}return this._permissionService.updatePermissionPoint(o.id,s),r}checkWorksheetPermissionPoint(e,t,n){const s=new n(e,t),i=this._permissionService.getPermissionPoint(s.id);if(i)return i.value}async addRangeBaseProtection(e,t,n,s){let i=[];if(s!=null&&s.allowedUsers){const d=await this._authzIoService.listCollaborators({objectID:e,unitID:e}),c=new Set(s.allowedUsers);i=d.filter(g=>{var m;return c.has(((m=g.subject)==null?void 0:m.userID)||g.id)}).map(g=>({id:g.id,role:xr.Editor,subject:g.subject}));const h=new Set(i.map(g=>{var m;return((m=g.subject)==null?void 0:m.userID)||g.id}));s.allowedUsers.forEach(g=>{h.has(g)||console.error(`User ${g} not found in collaborators list`)})}const r=await this._authzIoService.create({objectType:se.SelectRange,selectRangeObject:{collaborators:i,unitID:e,name:s?.name||"",scope:void 0}}),o=`ruleId_${hn(6)}`;if(this._rangeProtectionRuleModel.getSubunitRuleList(e,t).some(d=>d.ranges.some(c=>n.some(h=>z.intersects(h.getRange(),c)))))throw new Error("range protection cannot intersect");const a=this._determineRangeViewState(s),l=this._determineRangeEditState(s),u={unitId:e,subUnitId:t,rules:[{permissionId:r,unitType:se.SelectRange,unitId:e,subUnitId:t,ranges:n.map(d=>d.getRange()),id:o,description:s?.name,viewState:a,editState:l}]};if(this._commandService.syncExecuteCommand(Hn.id,u))return{permissionId:r,ruleId:o}}_determineRangeViewState(e){return e?.allowViewByOthers===!1?dn.NoOneElseCanView:dn.OthersCanView}_determineRangeEditState(e){var t;return e?.allowEdit===!0&&(t=e?.allowedUsers)!=null&&t.length?Ft.DesignedUserCanEdit:Ft.OnlyMe}removeRangeProtection(e,t,n){this._commandService.syncExecuteCommand($n.id,{unitId:e,subUnitId:t,ruleIds:n})&&this._rangeProtectionRuleModel.getSubunitRuleList(e,t).length===0&&(this._worksheetProtectionPointRuleModel.deleteRule(e,t),[...zn()].forEach(s=>{const i=new s(e,t);this._permissionService.updatePermissionPoint(i.id,i.value)}))}setRangeProtectionPermissionPoint(e,t,n,s,i){const r=new s(e,t,n);this._permissionService.getPermissionPoint(r.id)||this._permissionService.addPermissionPoint(r),this._permissionService.updatePermissionPoint(r.id,i)}setRangeProtectionRanges(e,t,n,s){const i=this._rangeProtectionRuleModel.getRule(e,t,n);if(i){if(this._rangeProtectionRuleModel.getSubunitRuleList(e,t).filter(r=>r.id!==n).some(r=>r.ranges.some(o=>s.some(a=>z.intersects(a.getRange(),o)))))throw new Error("range protection cannot intersect");this._commandService.syncExecuteCommand(Kt.id,{unitId:e,subUnitId:t,ruleId:n,rule:{...i,ranges:s.map(r=>r.getRange())}})}}getPermissionInfoWithCell(e,t,n,s){const i=Dc(n,s),r=this._rangeProtectionRuleModel.getSubunitRuleList(e,t).find(o=>o.ranges.some(a=>z.intersects(i,a)));if(r)return{permissionId:r.permissionId,ruleId:r.id}}};to=K9([Ai(0,V(pt)),Ai(1,U),Ai(2,Je),Ai(3,V(ft)),Ai(4,V(We)),Ai(5,V(_i)),Ai(6,V(Jo)),Ai(7,V(Ys))],to);var $9=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},J9=(e,t)=>(n,s)=>t(n,s,e);let Hc=class{constructor(e,t,n,s){this._workbook=e,this._worksheet=t,this._selections=n,this._injector=s}getActiveRange(){const e=this._selections.find(t=>!!t.primary);return e?this._injector.createInstance(Gn,this._workbook,this._worksheet,e.range):null}getActiveRangeList(){return this._selections.map(e=>this._injector.createInstance(Gn,this._workbook,this._worksheet,e.range))}getCurrentCell(){const e=this._selections.find(t=>!!t.primary);return e?e.primary:null}getActiveSheet(){const e=this._injector.createInstance(vs,this._workbook);return this._injector.createInstance(Fn,e,this._workbook,this._worksheet)}updatePrimaryCell(e){const t=this._injector.get(U);let n=[],s=!1;for(const{range:r,style:o}of this._selections)z.contains(r,e.getRange())?(n.push({range:r,primary:Ht(e.getRange(),this._worksheet),style:o}),s=!0):n.push({range:r,primary:null,style:o});s||(n=[{range:e.getRange(),primary:Ht(e.getRange(),this._worksheet)}]);const i={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),selections:n};return t.syncExecuteCommand(me.id,i),new Hc(this._workbook,this._worksheet,n,this._injector)}getNextDataRange(e){if(!this._selections.find(n=>!!n.primary))return null;const t=lx(this._selections.concat(),e,this._worksheet);return t?this._injector.createInstance(Gn,this._workbook,this._worksheet,t):null}};Hc=$9([J9(3,V(pt))],Hc);var Lf=(e=>(e[e.Reader=0]="Reader",e[e.Editor=1]="Editor",e[e.Owner=2]="Owner",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(Lf||{}),e6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Lg=(e,t)=>(n,s)=>t(n,s,e);let ui=class{constructor(e,t,n,s,i,r,o,a,l){this._unitId=e,this._subUnitId=t,this._ruleId=n,this._permissionId=s,this._ranges=i,this._options=r,this._injector=o,this._commandService=a,this._rangeProtectionRuleModel=l}get id(){return this._ruleId}get ranges(){return this._ranges}get options(){return{...this._options}}async updateRanges(e){if(!e||e.length===0)throw new Error("Ranges cannot be empty");const t=this._rangeProtectionRuleModel.getRule(this._unitId,this._subUnitId,this._ruleId);if(!t)throw new Error(`Rule ${this._ruleId} not found`);if(this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId).filter(n=>n.id!==this._ruleId).some(n=>n.ranges.some(s=>e.some(i=>{const r=i.getRange();return this._rangesIntersect(r,s)}))))throw new Error("Range protection cannot intersect with other protection rules");await this._commandService.executeCommand(Kt.id,{unitId:this._unitId,subUnitId:this._subUnitId,ruleId:this._ruleId,rule:{...t,ranges:e.map(n=>n.getRange())}}),this._ranges.length=0,this._ranges.push(...e)}async remove(){await this._commandService.executeCommand($n.id,{unitId:this._unitId,subUnitId:this._subUnitId,ruleIds:[this._ruleId]})}_rangesIntersect(e,t){return!(e.endRow<t.startRow||e.startRow>t.endRow||e.endColumn<t.startColumn||e.startColumn>t.endColumn)}};ui=e6([Lg(6,V(pt)),Lg(7,V(U)),Lg(8,V(We))],ui);const $u={[ye.Edit]:ne,[ye.View]:vp,[ye.Print]:mp,[ye.Export]:gp,[ye.Share]:fp,[ye.CopyContent]:oi,[ye.DuplicateFile]:hp,[ye.Comment]:up,[ye.ManageCollaborator]:xa,[ye.CreateSheet]:mu,[ye.DeleteSheet]:Jc,[ye.RenameSheet]:ka,[ye.MoveSheet]:eh,[ye.HideSheet]:ya,[ye.ViewHistory]:Cp,[ye.ManageHistory]:Zw,[ye.RecoverHistory]:pp,[ye.CreateProtection]:oo,[ye.InsertRow]:Ea,[ye.InsertColumn]:Ma,[ye.DeleteRow]:cp,[ye.DeleteColumn]:dp,[ye.CopySheet]:Yw},Ju={[ht.Edit]:oe,[ht.View]:cr,[ht.Copy]:qi,[ht.SetCellValue]:nn,[ht.SetCellStyle]:mt,[ht.SetRowStyle]:Kn,[ht.SetColumnStyle]:Qn,[ht.InsertRow]:lo,[ht.InsertColumn]:ao,[ht.DeleteRow]:nh,[ht.DeleteColumn]:th,[ht.Sort]:Ip,[ht.Filter]:Sp,[ht.PivotTable]:_p,[ht.InsertHyperlink]:bp,[ht.EditExtraObject]:wp,[ht.ManageCollaborator]:sh,[ht.DeleteProtection]:pu,[ht.SelectProtectedCells]:oy,[ht.SelectUnProtectedCells]:ay},Cl={[fn.Edit]:he,[fn.View]:Gi,[fn.ManageCollaborator]:Jp,[fn.Delete]:$p};var t6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},_r=(e,t)=>(n,s)=>t(n,s,e);let Pm=class{constructor(e,t,n,s,i,r,o,a){St(this,"_permissionSubject"),St(this,"_rangeRulesSubject"),St(this,"permission$"),St(this,"pointChange$"),St(this,"rangeProtectionChange$"),St(this,"rangeProtectionRules$"),St(this,"_unitId"),St(this,"_subUnitId"),St(this,"_subscriptions",[]),St(this,"_fPermission"),this._worksheet=e,this._injector=t,this._permissionService=n,this._authzIoService=s,this._commandService=i,this._rangeProtectionRuleModel=r,this._worksheetProtectionPointModel=o,this._worksheetProtectionRuleModel=a,this._unitId=this._worksheet.getWorkbook().getUnitId(),this._subUnitId=this._worksheet.getSheetId(),this._fPermission=this._injector.createInstance(to),this._permissionSubject=new xe(this._buildSnapshot()),this._rangeRulesSubject=new xe(this._buildRangeProtectionRules()),this.permission$=this._createPermissionStream(),this.pointChange$=this._createPointChangeStream(),this.rangeProtectionChange$=this._createRangeProtectionChangeStream(),this.rangeProtectionRules$=this._createRangeProtectionRulesStream()}_createPermissionStream(){const e=this._permissionService.permissionPointUpdate$.pipe(Wt(t=>t.id.includes(this._unitId)&&t.id.includes(this._subUnitId))).subscribe(()=>{this._permissionSubject.next(this._buildSnapshot())});return this._subscriptions.push(e),this._permissionSubject.asObservable().pipe(yn((t,n)=>JSON.stringify(t)===JSON.stringify(n)),Rn({bufferSize:1,refCount:!0}))}_createPointChangeStream(){return this._permissionService.permissionPointUpdate$.pipe(Wt(e=>e.id.includes(this._unitId)&&e.id.includes(this._subUnitId)),Se(e=>{var t,n;const s=this._extractWorksheetPointType(e.id);return s?{point:s,value:(t=e.value)!=null?t:!1,oldValue:!((n=e.value)!=null&&n)}:null}),Wt(e=>e!==null),Rn({bufferSize:1,refCount:!0}))}_createRangeProtectionChangeStream(){return this._rangeProtectionRuleModel.ruleChange$.pipe(Wt(e=>e.unitId===this._unitId&&e.subUnitId===this._subUnitId),Se(e=>{const t=this._buildRangeProtectionRules();return{type:e.type==="delete"?"delete":e.type==="set"?"update":"add",rules:t}}),Rn({bufferSize:1,refCount:!0}))}_createRangeProtectionRulesStream(){const e=this._rangeProtectionRuleModel.ruleChange$.pipe(Wt(t=>t.unitId===this._unitId&&t.subUnitId===this._subUnitId)).subscribe(()=>{this._rangeRulesSubject.next(this._buildRangeProtectionRules())});return this._subscriptions.push(e),this._rangeRulesSubject.asObservable().pipe(yn((t,n)=>t.length!==n.length?!1:t.every((s,i)=>s.id===n[i].id)),Rn({bufferSize:1,refCount:!0}))}_extractWorksheetPointType(e){for(const[t,n]of Object.entries(Ju))if(new n(this._unitId,this._subUnitId).id===e)return t;return null}_getRuleEditPermission(e){var t;const n=Cl[fn.Edit];if(!n)return!1;const s=new n(this._unitId,this._subUnitId,e.permissionId),i=this._permissionService.getPermissionPoint(s.id);return(t=i?.value)!=null?t:!1}_buildSnapshot(){const e={};for(const t in ht){const n=ht[t];e[n]=this.getPoint(n)}return e}_buildRangeProtectionRules(){return this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId).map(e=>{const t=e.ranges.map(n=>this._worksheet.getRange(n.startRow,n.startColumn,n.endRow-n.startRow+1,n.endColumn-n.startColumn+1));return this._injector.createInstance(ui,this._unitId,this._subUnitId,e.id,e.permissionId,t,{name:e.description||"",allowEdit:this._getRuleEditPermission(e)})})}_buildProtectionRule(e){const t=e.ranges.map(s=>this._worksheet.getRange(s)),n={name:e.description||"",allowViewByOthers:e.viewState!==dn.NoOneElseCanView};return e.editState===Ft.DesignedUserCanEdit?n.allowEdit=!0:n.allowEdit=!1,this._injector.createInstance(ui,this._unitId,this._subUnitId,e.id,e.permissionId,t,n)}debugCellPermission(e,t){const n=this._fPermission.getPermissionInfoWithCell(this._unitId,this._subUnitId,e,t);if(!n)return;const{ruleId:s}=n,i=this._rangeProtectionRuleModel.getRule(this._unitId,this._subUnitId,s);if(i)return this._buildProtectionRule(i)}async protect(e){if(this.isProtected())throw new Error("Worksheet is already protected. Call unprotect() first.");const t=await this._fPermission.addWorksheetBasePermission(this._unitId,this._subUnitId,e);if(!t)throw new Error("Failed to create worksheet protection");return t}async unprotect(){if(!this.isProtected())return;this._fPermission.removeWorksheetPermission(this._unitId,this._subUnitId);const e=this._buildSnapshot();this._permissionSubject.next(e)}isProtected(){return!!this._worksheetProtectionRuleModel.getRule(this._unitId,this._subUnitId)}async setMode(e){const t=this._getModePermissions(e);await this._batchSetPermissionPoints(t)}_getModePermissions(e){const t={};switch(Object.values(ht).forEach(n=>{t[n]=!1}),e){case"editable":Object.values(ht).forEach(n=>{t[n]=!0});break;case"readOnly":t[ht.View]=!0;break;case"filterOnly":t[ht.View]=!0,t[ht.Sort]=!0,t[ht.Filter]=!0;break}return t}async _batchSetPermissionPoints(e){const t=[];for(const[n,s]of Object.entries(e)){const i=n,r=Ju[i];if(!r)throw new Error(`Unknown worksheet permission point: ${i}`);const o=this.getPoint(i);o!==s&&(await this._fPermission.setWorksheetPermissionPoint(this._unitId,this._subUnitId,r,s),t.push({point:i,value:s,oldValue:o}))}if(t.length>0){const n=this._buildSnapshot();this._permissionSubject.next(n)}}async setReadOnly(){await this.setMode("readOnly")}async setEditable(){await this.setMode("editable")}canEdit(){return this.getPoint(ht.Edit)}canEditCell(e,t){if(!this.canEdit())return!1;const n=this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId);for(const s of n)for(const i of s.ranges)if(e>=i.startRow&&e<=i.endRow&&t>=i.startColumn&&t<=i.endColumn)return this._getRuleEditPermission(s);return!0}canViewCell(e,t){return this.getPoint(ht.View)}async setPoint(e,t){const n=Ju[e];if(!n)throw new Error(`Unknown worksheet permission point: ${e}`);if(this.getPoint(e)===t)return;await this._fPermission.setWorksheetPermissionPoint(this._unitId,this._subUnitId,n,t);const s=this._buildSnapshot();this._permissionSubject.next(s)}getPoint(e){var t;const n=Ju[e];if(!n)throw new Error(`Unknown worksheet permission point: ${e}`);const s=new n(this._unitId,this._subUnitId),i=this._permissionService.getPermissionPoint(s.id);return(t=i?.value)!=null?t:!0}getSnapshot(){return this._buildSnapshot()}async applyConfig(e){if(e.mode&&await this.setMode(e.mode),e.points)for(const[t,n]of Object.entries(e.points))typeof n=="boolean"&&await this.setPoint(t,n);if(e.rangeProtections&&e.rangeProtections.length>0){const t=e.rangeProtections.map(n=>({ranges:n.rangeRefs.map(s=>this._worksheet.getRange(s)),options:n.options}));await this.protectRanges(t)}}async protectRanges(e){if(!e||e.length===0)throw new Error("Configs cannot be empty");let t=[];e.some(i=>{var r,o;return(o=(r=i.options)==null?void 0:r.allowedUsers)==null?void 0:o.length})&&(t=await this._authzIoService.listCollaborators({objectID:this._unitId,unitID:this._unitId}));const n=await Promise.all(e.map(i=>{var r,o;let a=[];if((r=i.options)!=null&&r.allowedUsers){const l=new Set(i.options.allowedUsers);a=t.filter(d=>{var c;return l.has(((c=d.subject)==null?void 0:c.userID)||d.id)}).map(d=>({id:d.id,role:Lf.Editor,subject:d.subject}));const u=new Set(a.map(d=>{var c;return((c=d.subject)==null?void 0:c.userID)||d.id}));i.options.allowedUsers.forEach(d=>{u.has(d)||console.error(`User ${d} not found in collaborators list`)})}return this._authzIoService.create({objectType:se.SelectRange,selectRangeObject:{collaborators:a,unitID:this._unitId,name:((o=i.options)==null?void 0:o.name)||"",scope:void 0}})})),s=e.map((i,r)=>{var o;const a=this._determineViewState(i.options),l=this._determineEditState(i.options);return{permissionId:n[r],unitType:se.SelectRange,unitId:this._unitId,subUnitId:this._subUnitId,ranges:i.ranges.map(u=>u.getRange()),id:this._rangeProtectionRuleModel.createRuleId(this._unitId,this._subUnitId),description:((o=i.options)==null?void 0:o.name)||"",viewState:a,editState:l}});if(!await this._commandService.executeCommand(Hn.id,{unitId:this._unitId,subUnitId:this._subUnitId,rules:s}))throw new Error("Failed to create range protection rules");return await Promise.all(e.map((i,r)=>this._setPermissionPoints(n[r],i.options))),s.map((i,r)=>this._injector.createInstance(ui,this._unitId,this._subUnitId,i.id,i.permissionId,e[r].ranges,e[r].options||{}))}_determineViewState(e){return e?.allowViewByOthers===!1?dn.NoOneElseCanView:dn.OthersCanView}_determineEditState(e){var t;return e?.allowEdit===!0&&(t=e?.allowedUsers)!=null&&t.length?Ft.DesignedUserCanEdit:Ft.OnlyMe}async _setPermissionPoints(e,t){if(!t)return;const n=(s,i)=>s===void 0?i:typeof s=="boolean"?s:!0;await this._setPermissionPoint(e,fn.Edit,n(t.allowEdit,!1)),await this._setPermissionPoint(e,fn.View,n(t.allowViewByOthers,!0))}async _setPermissionPoint(e,t,n){const s=Cl[t];s&&this._fPermission.setRangeProtectionPermissionPoint(this._unitId,this._subUnitId,e,s,n)}async unprotectRules(e){!e||e.length===0||this._fPermission.removeRangeProtection(this._unitId,this._subUnitId,e)}async listRangeProtectionRules(){return this._buildRangeProtectionRules()}subscribe(e){const t=this.permission$.subscribe(e);return()=>t.unsubscribe()}dispose(){this._subscriptions.forEach(e=>e.unsubscribe()),this._permissionSubject.complete(),this._rangeRulesSubject.complete()}};Pm=t6([_r(1,V(pt)),_r(2,Je),_r(3,Ys),_r(4,U),_r(5,V(We)),_r(6,V(_i)),_r(7,V(ft))],Pm);function n6(e){switch(e){case"left":return Pt.LEFT;case"center":return Pt.CENTER;case"normal":return Pt.RIGHT;default:throw new Error(`Invalid horizontal alignment: ${e}`)}}function WC(e){switch(e){case Pt.LEFT:return"left";case Pt.CENTER:return"center";case Pt.RIGHT:return"normal";default:return"general"}}function s6(e){switch(e){case"top":return vn.TOP;case"middle":return vn.MIDDLE;case"bottom":return vn.BOTTOM;default:throw new Error(`Invalid vertical alignment: ${e}`)}}function LC(e){switch(e){case vn.TOP:return"top";case vn.MIDDLE:return"middle";case vn.BOTTOM:return"bottom";default:return"general"}}function Bg(e,t){return{startRow:e.startRow,endRow:e.endRow,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:j.ROW}}function jg(e,t){return{startRow:0,endRow:t.getRowCount()-1,startColumn:e.startColumn,endColumn:e.endColumn,rangeType:j.COLUMN}}var i6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ed=(e,t)=>(n,s)=>t(n,s,e);let Fn=class extends tp{constructor(e,t,n,s,i,r,o){super(s),St(this,"setActiveSelection",this.setActiveRange),this._fWorkbook=e,this._workbook=t,this._worksheet=n,this._injector=s,this._selectionManagerService=i,this._logService=r,this._commandService=o}dispose(){super.dispose(),delete this._fWorkbook,delete this._workbook,delete this._worksheet}getSheet(){return this._worksheet}getInject(){return this._injector}getWorkbook(){return this._workbook}getSheetId(){return this._worksheet.getSheetId()}getSheetName(){return this._worksheet.getName()}getSelection(){const e=this._selectionManagerService.getCurrentSelections();return e?this._injector.createInstance(Hc,this._workbook,this._worksheet,e):null}getDefaultStyle(){return this._worksheet.getDefaultCellStyle()}getRowDefaultStyle(e,t=!1){return t?this._worksheet.getRowStyle(e,t):this._worksheet.getRowStyle(e)}getColumnDefaultStyle(e,t=!1){return t?this._worksheet.getColumnStyle(e,t):this._worksheet.getColumnStyle(e)}setDefaultStyle(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId();return this._commandService.syncExecuteCommand(Po.id,{unitId:t,subUnitId:n,defaultStyle:e}),this._worksheet.setDefaultCellStyle(e),this}setColumnDefaultStyle(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={unitId:n,subUnitId:s,columnData:{[e]:{s:t}}};return this._commandService.syncExecuteCommand(rm.id,i),this}setRowDefaultStyle(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={unitId:n,subUnitId:s,rowData:{[e]:{s:t}}};return this._commandService.syncExecuteCommand(am.id,i),this}getRange(e,t,n,s){let i,r;if(typeof e=="object")i=e,r=this._worksheet;else if(typeof e=="string"){const{range:o,sheetName:a}=hu(e),l=a?this._workbook.getSheetBySheetName(a):this._worksheet;if(!l)throw new Error("Range not found");r=l,i={...o,unitId:this._workbook.getUnitId(),sheetId:r.getSheetId(),rangeType:j.NORMAL,startRow:o.rangeType===j.COLUMN?0:o.startRow,endRow:o.rangeType===j.COLUMN?r.getMaxRows()-1:o.endRow,startColumn:o.rangeType===j.ROW?0:o.startColumn,endColumn:o.rangeType===j.ROW?r.getMaxColumns()-1:o.endColumn}}else if(typeof e=="number"&&t!==void 0)r=this._worksheet,i={startRow:e,endRow:e+(n??1)-1,startColumn:t,endColumn:t+(s??1)-1,unitId:this._workbook.getUnitId(),sheetId:this._worksheet.getSheetId()};else throw new Error("Invalid range specification");return this._injector.createInstance(Gn,this._workbook,r,i)}getMaxColumns(){return this._worksheet.getMaxColumns()}getMaxRows(){return this._worksheet.getMaxRows()}insertRowAfter(e){return this.insertRowsAfter(e,1)}insertRowBefore(e){return this.insertRowsBefore(e,1)}insertRows(e,t=1){return this.insertRowsBefore(e,t)}insertRowsAfter(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=Z.DOWN,r=e+1,o=e+t,a=0,l=this._worksheet.getColumnCount()-1,u=ss(this._worksheet,r,o,a,l,!0,e);return this._commandService.syncExecuteCommand(kd.id,{unitId:n,subUnitId:s,direction:i,range:{startRow:r,endRow:o,startColumn:a,endColumn:l},cellValue:u}),this}insertRowsBefore(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=Z.UP,r=e,o=e+t-1,a=0,l=this._worksheet.getColumnCount()-1,u=ss(this._worksheet,r,o,a,l,!0,e-1);return this._commandService.syncExecuteCommand(kd.id,{unitId:n,subUnitId:s,direction:i,range:{startRow:r,endRow:o,startColumn:a,endColumn:l},cellValue:u}),this}deleteRow(e){return this.deleteRows(e,1)}deleteRows(e,t){const n={startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1};return this._commandService.syncExecuteCommand(Pp.id,{range:n,unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}deleteRowsByPoints(e){return qf(e).reverse().forEach(t=>{this.deleteRows(t[0],t[1]-t[0]+1)}),this}moveRows(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=Bg(e.getRange(),this._worksheet),r=i,o={startRow:t,endRow:t,startColumn:i.startColumn,endColumn:i.endColumn};return this._commandService.syncExecuteCommand(Qi.id,{unitId:n,subUnitId:s,range:i,fromRange:r,toRange:o}),this}hideRow(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s=Bg(e.getRange(),this._worksheet);return this._commandService.syncExecuteCommand(Br.id,{unitId:t,subUnitId:n,ranges:[s]}),this}hideRows(e,t=1){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1,rangeType:j.ROW};return this._commandService.syncExecuteCommand(Br.id,{unitId:n,subUnitId:s,ranges:[i]}),this}unhideRow(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s=Bg(e.getRange(),this._worksheet);return this._commandService.syncExecuteCommand(er.id,{unitId:t,subUnitId:n,ranges:[s]}),this}showRows(e,t=1){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1,rangeType:j.ROW};return this._commandService.syncExecuteCommand(er.id,{unitId:n,subUnitId:s,ranges:[i]}),this}setRowHeight(e,t){return this.setRowHeights(e,1,t)}autoFitRow(e,t=pe.TRUE){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=[{startRow:e,endRow:e,startColumn:0,endColumn:this._worksheet.getColumnCount()-1}];return this._commandService.syncExecuteCommand(Dr.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:i[0],value:ws.WRAP}),this._commandService.syncExecuteCommand(qn.id,{unitId:n,subUnitId:s,ranges:i,autoHeightInfo:t}),this}setRowHeights(e,t,n){var s;const i=this._workbook.getUnitId(),r=this._worksheet.getSheetId(),o=this._worksheet.getRowManager(),a=[],l=[];for(let u=e;u<e+t;u++){const d=((s=o.getRow(u))==null?void 0:s.ah)||this._worksheet.getConfig().defaultRowHeight,c={startRow:u,endRow:u,startColumn:0,endColumn:this._worksheet.getColumnCount()-1};n<=d?a.push(c):l.push(c)}return l.length>0&&this._commandService.syncExecuteCommand(tr.id,{unitId:i,subUnitId:r,ranges:l,value:n}),a.length>0&&this._commandService.syncExecuteCommand(ci.id,{unitId:i,subUnitId:r,ranges:a}),this}getRowHeight(e){return this._worksheet.getRowHeight(e)}setRowAutoHeight(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=[{startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1}];return this._commandService.syncExecuteCommand(ci.id,{unitId:n,subUnitId:s,ranges:i}),this}setRangesAutoHeight(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId();return this._commandService.syncExecuteCommand(ci.id,{unitId:t,subUnitId:n,ranges:e}),this}setRowHeightsForced(e,t,n){const s=this._workbook.getUnitId(),i=this._worksheet.getSheetId(),r=[{startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1}];return this._commandService.syncExecuteCommand(tr.id,{unitId:s,subUnitId:i,ranges:r,value:n}),this}setRowCustom(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s={};for(const[r,o]of Object.entries(e))s[Number(r)]={custom:o};const i={unitId:t,subUnitId:n,rowData:s};return this._commandService.syncExecuteCommand(am.id,i),this}insertColumnAfter(e){return this.insertColumnsAfter(e,1)}insertColumnBefore(e){return this.insertColumnsBefore(e,1)}insertColumns(e,t=1){return this.insertColumnsBefore(e,t)}insertColumnsAfter(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=Z.RIGHT,r=0,o=this._worksheet.getRowCount()-1,a=e+1,l=e+t,u=ss(this._worksheet,r,o,a,l,!1,e);return this._commandService.syncExecuteCommand(Td.id,{unitId:n,subUnitId:s,direction:i,range:{startRow:r,endRow:o,startColumn:a,endColumn:l},cellValue:u}),this}insertColumnsBefore(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=Z.LEFT,r=0,o=this._worksheet.getRowCount()-1,a=e,l=e+t-1,u=ss(this._worksheet,r,o,a,l,!1,e-1);return this._commandService.syncExecuteCommand(Td.id,{unitId:n,subUnitId:s,direction:i,range:{startRow:r,endRow:o,startColumn:a,endColumn:l},cellValue:u}),this}deleteColumn(e){return this.deleteColumns(e,1)}deleteColumns(e,t){const n={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:e,endColumn:e+t-1};return this._commandService.syncExecuteCommand(Up.id,{range:n,unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}deleteColumnsByPoints(e){return qf(e).reverse().forEach(t=>{this.deleteColumns(t[0],t[1]-t[0]+1)}),this}moveColumns(e,t){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i=jg(e.getRange(),this._worksheet),r=i,o={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:t,endColumn:t};return this._commandService.syncExecuteCommand(Ki.id,{unitId:n,subUnitId:s,range:i,fromRange:r,toRange:o}),this}hideColumn(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s=jg(e.getRange(),this._worksheet);return this._commandService.syncExecuteCommand(Lr.id,{unitId:t,subUnitId:n,ranges:[s]}),this}hideColumns(e,t=1){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:e,endColumn:e+t-1,rangeType:j.COLUMN};return this._commandService.syncExecuteCommand(Lr.id,{unitId:n,subUnitId:s,ranges:[i]}),this}unhideColumn(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s=jg(e.getRange(),this._worksheet);return this._commandService.syncExecuteCommand(Ji.id,{unitId:t,subUnitId:n,ranges:[s]}),this}showColumns(e,t=1){const n=this._workbook.getUnitId(),s=this._worksheet.getSheetId(),i={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:e,endColumn:e+t-1,rangeType:j.COLUMN};return this._commandService.syncExecuteCommand(Ji.id,{unitId:n,subUnitId:s,ranges:[i]}),this}setColumnWidth(e,t){return this.setColumnWidths(e,1,t)}setColumnWidths(e,t,n){const s=this._workbook.getUnitId(),i=this._worksheet.getSheetId(),r=[{startColumn:e,endColumn:e+t-1,startRow:0,endRow:this._worksheet.getRowCount()-1}];return this._commandService.syncExecuteCommand(jr.id,{unitId:s,subUnitId:i,ranges:r,value:n}),this}getColumnWidth(e){return this._worksheet.getColumnWidth(e)}setColumnCustom(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s={};for(const[r,o]of Object.entries(e))s[Number(r)]={custom:o};const i={unitId:t,subUnitId:n,columnData:s};return this._commandService.syncExecuteCommand(rm.id,i),this}getMergeData(){return this._worksheet.getMergeData().map(e=>this._injector.createInstance(Gn,this._workbook,this._worksheet,e))}getMergedRanges(){return this._worksheet.getSnapshot().mergeData.map(e=>this._injector.createInstance(Gn,this._workbook,this._worksheet,e))}getCellMergeData(e,t){const n=this._worksheet.getMergedCell(e,t);if(n)return this._injector.createInstance(Gn,this._workbook,this._worksheet,n)}getActiveRange(){return this._fWorkbook.getActiveRange()}setActiveRange(e){const{unitId:t,sheetId:n}=e.getRange();if(t!==this._workbook.getUnitId()||n!==this._worksheet.getSheetId())throw new Error("Specified range must be part of the sheet.");return this._fWorkbook.setActiveRange(e),this}getActiveCell(){return this._fWorkbook.getActiveCell()}setFreeze(e){return this._logService.warn("setFreeze is deprecated, use setFrozenRows and setFrozenColumns instead"),this._commandService.syncExecuteCommand(gl.id,{...e,unitId:this._workbook.getUnitId(),subUnitId:this.getSheetId()}),this}cancelFreeze(){return this._commandService.syncExecuteCommand(No.id,{unitId:this._workbook.getUnitId(),subUnitId:this.getSheetId()}),this}getFreeze(){return this._worksheet.getFreeze()}setFrozenColumns(...e){const t=this.getFreeze();if(arguments.length===1){const n=e[0];this.setFreeze({...t,startColumn:n>0?n:-1,xSplit:n})}else if(arguments.length===2){let[n=0,s=0]=e;n>s&&([n,s]=[s,n]),this._commandService.syncExecuteCommand(gl.id,{startColumn:s+1,xSplit:s-n+1,startRow:t.startRow,ySplit:t.ySplit,unitId:this._workbook.getUnitId(),subUnitId:this.getSheetId()})}return this}setFrozenRows(...e){const t=this.getFreeze();if(arguments.length===1){const n=e[0];this.setFreeze({...t,startRow:n>0?n:-1,ySplit:n})}else if(arguments.length===2){let[n=0,s=0]=e;n>s&&([n,s]=[s,n]),this._commandService.syncExecuteCommand(gl.id,{startRow:s+1,ySplit:s-n+1,startColumn:t.startColumn,xSplit:t.xSplit,unitId:this._workbook.getUnitId(),subUnitId:this.getSheetId()})}return this}getFrozenColumns(){const e=this.getFreeze();return e.startColumn===-1?0:e.startColumn}getFrozenRows(){const e=this.getFreeze();return e.startRow===-1?0:e.startRow}getFrozenRowRange(){const e=this._worksheet.getFreeze();return{startRow:e.startRow-e.ySplit,endRow:e.startRow-1}}getFrozenColumnRange(){const e=this._worksheet.getFreeze();return{startColumn:e.startColumn-e.xSplit,endColumn:e.startColumn-1}}hasHiddenGridLines(){return this._worksheet.getConfig().showGridlines===pe.FALSE}setHiddenGridlines(e){return this._commandService.syncExecuteCommand($o.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),showGridlines:e?pe.FALSE:pe.TRUE}),this}setGridLinesColor(e){return this._commandService.syncExecuteCommand(Wd.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),color:e}),this}getGridLinesColor(){return this._worksheet.getGridlinesColor()}setTabColor(e){return this._commandService.syncExecuteCommand(dh.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),value:e}),this}getTabColor(){return this._worksheet.getTabColor()}onCellDataChange(e){return this._injector.get(U).onCommandExecuted(t=>{if(t.id===le.id){const n=t.params;n.unitId===this._workbook.getUnitId()&&n.subUnitId===this._worksheet.getSheetId()&&n.cellValue&&e(new de(n.cellValue))}})}onBeforeCellDataChange(e){return this._injector.get(U).beforeCommandExecuted(t=>{if(t.id===le.id){const n=t.params;n.unitId===this._workbook.getUnitId()&&n.subUnitId===this._worksheet.getSheetId()&&n.cellValue&&e(new de(n.cellValue))}})}hideSheet(){const e=this._injector.get(U);if(this._workbook.getSheets().filter(t=>t.isSheetHidden()!==pe.TRUE).length<=1)throw new Error("Cannot hide the only visible sheet");return e.syncExecuteCommand(ch.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}showSheet(){return this._injector.get(U).syncExecuteCommand(uo.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId()}),this}isSheetHidden(){return this._worksheet.isSheetHidden()===pe.TRUE}setName(e){return this._commandService.syncExecuteCommand(zr.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),name:e}),this}activate(){return this._fWorkbook.setActiveSheet(this),this}getIndex(){return this._workbook.getSheetIndex(this._worksheet)}clear(e){if(e&&e.contentsOnly&&!e.formatOnly)return this.clearContents();if(e&&e.formatOnly&&!e.contentsOnly)return this.clearFormats();const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId(),s=this._injector.get(U),i={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1};return s.syncExecuteCommand(Os.id,{unitId:t,subUnitId:n,ranges:[i],options:e}),this}clearContents(){const e=this._workbook.getUnitId(),t=this._worksheet.getSheetId(),n=this._injector.get(U),s={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1};return n.syncExecuteCommand(as.id,{unitId:e,subUnitId:t,ranges:[s]}),this}clearFormats(){const e=this._workbook.getUnitId(),t=this._worksheet.getSheetId(),n=this._injector.get(U),s={startRow:0,endRow:this._worksheet.getRowCount()-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1};return n.syncExecuteCommand(Vs.id,{unitId:e,subUnitId:t,ranges:[s]}),this}getDataRange(){const{startRow:e,endRow:t,startColumn:n,endColumn:s}=this._worksheet.getDataRealRange();return this.getRange(e,n,t-e+1,s-n+1)}getLastColumns(){return this._worksheet.getLastColumnWithContent()}getLastColumn(){return this._worksheet.getLastColumnWithContent()}getLastRows(){return this._worksheet.getLastRowWithContent()}getLastRow(){return this._worksheet.getLastRowWithContent()}equalTo(e){return e instanceof Fn?this._worksheet.getSheetId()===e.getSheetId()&&this._workbook.getUnitId()===e.getWorkbook().getUnitId():!1}insertDefinedName(e,t){const n=this._injector.createInstance(Dh).setName(e).setRef(t).build();n.localSheetId=this.getSheetId(),this._fWorkbook.insertDefinedNameBuilder(n)}getDefinedNames(){return this._fWorkbook.getDefinedNames().filter(e=>e.getLocalSheetId()===this.getSheetId())}setCustomMetadata(e){return this._worksheet.setCustomMetadata(e),this}getCustomMetadata(){return this._worksheet.getCustomMetadata()}setRowCustomMetadata(e,t){return this._worksheet.getRowManager().setCustomMetadata(e,t),this}setColumnCustomMetadata(e,t){return this._worksheet.getColumnManager().setCustomMetadata(e,t),this}getRowCustomMetadata(e){return this._worksheet.getRowManager().getCustomMetadata(e)}getColumnCustomMetadata(e){return this._worksheet.getColumnManager().getCustomMetadata(e)}appendRow(e){const t=this._worksheet.getCellMatrix().hasValue(),n=this._worksheet.getLastRowWithContent(),s=this._worksheet.getRowCount(),i=this._worksheet.getColumnCount(),r=t?n+1:n,o=new de;for(let a=0;a<e.length;a++)o.setValue(r,a,Qg(e[a]));return this._commandService.syncExecuteCommand(pS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),cellValue:o.getMatrix(),insertRowNums:r>s-1?1:0,insertColumnNums:e.length>i?e.length-i:0,maxRows:s,maxColumns:i}),this}setRowCount(e){return this._commandService.syncExecuteCommand(LS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),rowCount:e}),this}setColumnCount(e){return this._commandService.syncExecuteCommand(HS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),columnCount:e}),this}getWorksheetPermission(){return this._injector.createInstance(Pm,this)}};Fn=i6([ed(3,V(pt)),ed(4,V(q)),ed(5,V(ar)),ed(6,U)],Fn);var r6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},tl=(e,t)=>(n,s)=>t(n,s,e);let Um=class{constructor(e,t,n,s,i,r,o,a,l){St(this,"_permissionSubject"),St(this,"_subscriptions",[]),St(this,"_fPermission"),St(this,"permission$"),St(this,"protectionChange$"),this._unitId=e,this._subUnitId=t,this._range=n,this._worksheet=s,this._injector=i,this._permissionService=r,this._authzIoService=o,this._commandService=a,this._rangeProtectionRuleModel=l,this._fPermission=this._injector.createInstance(to),this._permissionSubject=new xe(this._buildSnapshot()),this.permission$=this._createPermissionStream(),this.protectionChange$=this._createProtectionChangeStream()}_createPermissionStream(){const e=this._permissionService.permissionPointUpdate$.pipe(Wt(t=>{const n=t.id;return n.includes(this._unitId)&&n.includes(this._subUnitId)})).subscribe(()=>{this._permissionSubject.next(this._buildSnapshot())});return this._subscriptions.push(e),this._permissionSubject.asObservable().pipe(yn((t,n)=>JSON.stringify(t)===JSON.stringify(n)),Rn({bufferSize:1,refCount:!0}))}_createProtectionChangeStream(){return this._rangeProtectionRuleModel.ruleChange$.pipe(Wt(e=>e.unitId!==this._unitId||e.subUnitId!==this._subUnitId?!1:e.type==="delete"?this._rangeMatches(e.rule):e.type==="add"?this._rangeMatches(e.rule):!1),Se(e=>(this._permissionSubject.next(this._buildSnapshot()),e.type==="delete"?{type:"unprotected",ruleId:e.rule.id}:{type:"protected",rule:this._createFacadeRule(e.rule)})),Rn({bufferSize:1,refCount:!0}))}_rangeMatches(e){const t=this._range.getRange();return e.ranges.some(n=>t.startRow===n.startRow&&t.startColumn===n.startColumn&&t.endRow===n.endRow&&t.endColumn===n.endColumn)}_createFacadeRule(e){const t=e.ranges.map(s=>this._worksheet.getRange(s.startRow,s.startColumn,s.endRow-s.startRow+1,s.endColumn-s.startColumn+1)),n={name:e.description||"",allowViewByOthers:e.viewState!==dn.NoOneElseCanView,allowEdit:e.editState===Ft.DesignedUserCanEdit};return this._injector.createInstance(ui,this._unitId,this._subUnitId,e.id,e.permissionId,t,n)}getPoint(e){const t=Cl[e];if(!t)return console.warn(`Unknown permission point: ${e}`),!1;const n=this._getProtectionRule();if(n){const s=new t(this._unitId,this._subUnitId,n.permissionId),i=this._permissionService.getPermissionPoint(s.id);if(i)return i.value}return!0}getSnapshot(){return this._buildSnapshot()}isProtected(){return this._getProtectionRule()!==null}canEdit(){return this.getPoint(fn.Edit)}canView(){return this.getPoint(fn.View)}canManageCollaborator(){return this.getPoint(fn.ManageCollaborator)}canDelete(){return this.getPoint(fn.Delete)}async setPoint(e,t){const n=Cl[e];if(!n)throw new Error(`Unknown permission point: ${e}`);const s=this._getProtectionRule();if(!s)throw new Error("Cannot set permission point: No protection rule exists for this range. Call protect() first.");if(this.getPoint(e)===t)return;const i=s.permissionId;this._fPermission.setRangeProtectionPermissionPoint(this._unitId,this._subUnitId,i,n,t),this._permissionSubject.next(this._buildSnapshot())}async protect(e){if(this.isProtected())throw new Error("Range is already protected");const t=await this._fPermission.addRangeBaseProtection(this._unitId,this._subUnitId,[this._range],e);if(!t)throw new Error("Failed to create range protection");const{permissionId:n,ruleId:s}=t;return await this._setPermissionPoints(n,e),this._injector.createInstance(ui,this._unitId,this._subUnitId,s,n,[this._range],e||{})}_determineViewState(e){return e?.allowViewByOthers===!1?dn.NoOneElseCanView:dn.OthersCanView}_determineEditState(e){var t;return e?.allowEdit===!0&&(t=e?.allowedUsers)!=null&&t.length?Ft.DesignedUserCanEdit:Ft.OnlyMe}async _setPermissionPoints(e,t){if(!t)return;const n=(s,i)=>s===void 0?i:typeof s=="boolean"?s:!0;await this._setPermissionPoint(e,fn.Edit,n(t.allowEdit,!1)),await this._setPermissionPoint(e,fn.View,n(t.allowViewByOthers,!0))}async _setPermissionPoint(e,t,n){const s=Cl[t];s&&this._fPermission.setRangeProtectionPermissionPoint(this._unitId,this._subUnitId,e,s,n)}async unprotect(){const e=this._getProtectionRule();if(!e)return;const t=e.id;this._fPermission.removeRangeProtection(this._unitId,this._subUnitId,[t])}async listRules(){return await this._buildProtectionRulesAsync()}subscribe(e){const t=this.permission$.subscribe(e);return()=>t.unsubscribe()}_getProtectionRule(){const e=this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId),t=this._range.getRange();for(const n of e)for(const s of n.ranges)if(t.startRow===s.startRow&&t.startColumn===s.startColumn&&t.endRow===s.endRow&&t.endColumn===s.endColumn)return n;return null}_buildProtectionRules(){return this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId).map(e=>{const t=e.ranges.map(s=>this._worksheet.getRange(s.startRow,s.startColumn,s.endRow-s.startRow+1,s.endColumn-s.startColumn+1)),n={name:e.description||"",allowViewByOthers:e.viewState!==dn.NoOneElseCanView};return e.editState===Ft.DesignedUserCanEdit?n.allowEdit=!0:n.allowEdit=!1,this._injector.createInstance(ui,this._unitId,this._subUnitId,e.id,e.permissionId,t,n)})}async _buildProtectionRulesAsync(){const e=this._rangeProtectionRuleModel.getSubunitRuleList(this._unitId,this._subUnitId);return(await Promise.all(e.map(async t=>{const n=t.ranges.map(i=>this._worksheet.getRange(i.startRow,i.startColumn,i.endRow-i.startRow+1,i.endColumn-i.startColumn+1)),s={name:t.description||"",allowViewByOthers:t.viewState!==dn.NoOneElseCanView};if(t.editState===Ft.DesignedUserCanEdit)try{const i=(await this._authzIoService.listCollaborators({objectID:t.permissionId,unitID:this._unitId})).filter(r=>r.role===Lf.Editor).map(r=>{var o;return((o=r.subject)==null?void 0:o.userID)||r.id});s.allowEdit=i.length>0}catch(i){console.warn(`Failed to fetch collaborators for rule ${t.id}:`,i),s.allowEdit=!1}else s.allowEdit=!1;return{rule:t,ranges:n,options:s}}))).map(({rule:t,ranges:n,options:s})=>this._injector.createInstance(ui,this._unitId,this._subUnitId,t.id,t.permissionId,n,s))}_buildSnapshot(){const e={};return Object.values(fn).forEach(t=>{e[t]=this.getPoint(t)}),e}dispose(){this._subscriptions.forEach(e=>e.unsubscribe()),this._permissionSubject.complete()}};Um=r6([tl(4,V(pt)),tl(5,V(Je)),tl(6,V(Ys)),tl(7,V(U)),tl(8,V(We))],Um);var o6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Fg=(e,t)=>(n,s)=>t(n,s,e),zg;let Gn=(zg=class extends tp{constructor(e,t,n,s,i,r){super(s),this._workbook=e,this._worksheet=t,this._range=n,this._injector=s,this._commandService=i,this._formulaDataModel=r;const o=this._worksheet.getRowCount(),a=this._worksheet.getColumnCount();if(this._range.startRow<0||this._range.startColumn<0||this._range.endRow>=o||this._range.endColumn>=a)throw new Error(`Range is out of bounds. Max rows: ${o}, Max columns: ${a}, Given range: ${JSON.stringify(this._range)}`);this._runInitializers(this._injector,this._workbook,this._worksheet,this._range,this._commandService,this._formulaDataModel)}getUnitId(){return this._workbook.getUnitId()}getSheetName(){return this._worksheet.getName()}getSheetId(){return this._worksheet.getSheetId()}getRange(){return this._range}getRow(){return this._range.startRow}getLastRow(){return this._range.endRow}getColumn(){return this._range.startColumn}getLastColumn(){return this._range.endColumn}getWidth(){return this._range.endColumn-this._range.startColumn+1}getHeight(){return this._range.endRow-this._range.startRow+1}isMerged(){const{startColumn:e,startRow:t,endColumn:n,endRow:s}=this._range;return this._worksheet.getMergedCellRange(t,e,s,n).some(i=>z.equals(i,this._range))}getCellStyleData(e="row"){return e!=="cell"?this._worksheet.getComposedCellStyle(this._range.startRow,this._range.startColumn,e==="row"):this._worksheet.getCellStyle(this._range.startRow,this._range.startColumn)}getFontFamily(e="row"){var t,n;return(n=(t=this.getCellStyleData(e))==null?void 0:t.ff)!=null?n:null}getFontSize(e="row"){var t,n;return(n=(t=this.getCellStyleData(e))==null?void 0:t.fs)!=null?n:null}getCellStyle(e="row"){const t=this.getCellStyleData(e);return t?Qf.create(t):null}getCellStyles(e="row"){return this.getCellDatas().map((t,n)=>t.map((s,i)=>{if(!s)return null;const r=e!=="cell"?this._worksheet.getComposedCellStyle(n+this._range.startRow,i+this._range.startColumn,e==="row"):this._worksheet.getCellStyle(n+this._range.startRow,i+this._range.startColumn);return r?Qf.create(r):null}))}getValue(e){var t,n;return e?this.getValueAndRichTextValue():(n=(t=this._worksheet.getCell(this._range.startRow,this._range.startColumn))==null?void 0:t.v)!=null?n:null}getRawValue(){var e,t;const n=this._worksheet.getCellMatrix().getValue(this._range.startRow,this._range.startColumn);return n!=null&&n.p&&(e=n.p.body)!=null&&e.dataStream?n.p.body.dataStream:(t=n?.v)!=null?t:null}getDisplayValue(){var e,t,n;const s=this._worksheet.getCell(this._range.startRow,this._range.startColumn);return s!=null&&s.p&&(e=s.p.body)!=null&&e.dataStream?s.p.body.dataStream:(n=(t=s?.v)==null?void 0:t.toString())!=null?n:""}getValues(e){var t,n;if(e)return this.getValueAndRichTextValues();const{startRow:s,endRow:i,startColumn:r,endColumn:o}=this._range,a=[];for(let l=s;l<=i;l++){const u=[];for(let d=r;d<=o;d++)u.push((n=(t=this._worksheet.getCell(l,d))==null?void 0:t.v)!=null?n:null);a.push(u)}return a}getRawValues(){var e,t;const n=this._worksheet.getCellMatrix(),{startRow:s,endRow:i,startColumn:r,endColumn:o}=this._range,a=[];for(let l=s;l<=i;l++){const u=[];for(let d=r;d<=o;d++){const c=n.getValue(l,d);c!=null&&c.p&&(e=c.p.body)!=null&&e.dataStream?u.push(c.p.body.dataStream):u.push((t=c?.v)!=null?t:null)}a.push(u)}return a}getDisplayValues(){var e,t,n;const{startRow:s,endRow:i,startColumn:r,endColumn:o}=this._range,a=[];for(let l=s;l<=i;l++){const u=[];for(let d=r;d<=o;d++){const c=this._worksheet.getCell(l,d);c!=null&&c.p&&(e=c.p.body)!=null&&e.dataStream?u.push(c.p.body.dataStream):u.push((n=(t=c?.v)==null?void 0:t.toString())!=null?n:"")}a.push(u)}return a}getCellData(){var e;return(e=this._worksheet.getCell(this._range.startRow,this._range.startColumn))!=null?e:null}getCellDatas(){return this.getCellDataGrid()}getCellDataGrid(){const{startRow:e,endRow:t,startColumn:n,endColumn:s}=this._range,i=[];for(let r=e;r<=t;r++){const o=[];for(let a=n;a<=s;a++)o.push(this._worksheet.getCellRaw(r,a));i.push(o)}return i}getRichTextValue(){const e=this.getCellData();return e!=null&&e.p?new fo(e.p):null}getRichTextValues(){return this.getCellDataGrid().map(e=>e.map(t=>t!=null&&t.p?new fo(t.p):null))}getValueAndRichTextValue(){const e=this.getCellData();return e!=null&&e.p?new fo(e.p):e?.v}getValueAndRichTextValues(){return this.getCellDatas().map(e=>e.map(t=>t!=null&&t.p?new fo(t.p):t?.v))}getFormula(){var e;return(e=this._formulaDataModel.getFormulaStringByCell(this._range.startRow,this._range.startColumn,this._worksheet.getSheetId(),this._workbook.getUnitId()))!=null?e:""}getFormulas(){const e=[],{startRow:t,endRow:n,startColumn:s,endColumn:i}=this._range,r=this._worksheet.getSheetId(),o=this._workbook.getUnitId();for(let a=t;a<=n;a++){const l=[];for(let u=s;u<=i;u++){const d=this._formulaDataModel.getFormulaStringByCell(a,u,r,o);l.push(d||"")}e.push(l)}return e}getWrap(){return this._worksheet.getRange(this._range).getWrap()===pe.TRUE}getWraps(){const e=this.getCellDatas(),t=this._workbook.getStyles();return e.map(n=>n.map(s=>{var i;return((i=t.getStyleByCell(s))==null?void 0:i.tb)===ws.WRAP}))}getWrapStrategy(){return this._worksheet.getRange(this._range).getWrapStrategy()}getHorizontalAlignment(){const e=this._worksheet.getRange(this._range).getHorizontalAlignment();return WC(e)}getHorizontalAlignments(){return this._worksheet.getRange(this._range).getHorizontalAlignments().map(e=>e.map(t=>WC(t)))}getVerticalAlignment(){return LC(this._worksheet.getRange(this._range).getVerticalAlignment())}getVerticalAlignments(){return this._worksheet.getRange(this._range).getVerticalAlignments().map(e=>e.map(t=>LC(t)))}setCustomMetaData(e){const t={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,customMetadata:{custom:e}};return this._commandService.syncExecuteCommand(om.id,t),this}setCustomMetaDatas(e){const t={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,customMetadata:e.map(n=>n.map(s=>({custom:s})))};return this._commandService.syncExecuteCommand(om.id,t),this}getCustomMetaData(){var e;const t=this.getCellData();return(e=t?.custom)!=null?e:null}getCustomMetaDatas(){return this.getCellDataGrid().map(e=>e.map(t=>{var n;return(n=t?.custom)!=null?n:null}))}setBorder(e,t,n){return this._commandService.syncExecuteCommand(Ol.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),ranges:[this._range],value:{type:e,style:t,color:n}}),this}getBackground(){var e,t;const n=this.getCellStyle();return(t=(e=n?.background)==null?void 0:e.rgb)!=null?t:hi.bg.rgb}getBackgrounds(){return this.getCellStyles().map(e=>e.map(t=>{var n,s;return(s=(n=t?.background)==null?void 0:n.rgb)!=null?s:hi.bg.rgb}))}setBackgroundColor(e){return this._commandService.syncExecuteCommand(Tt.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:{type:"bg",value:{rgb:e}}}),this}setBackground(e){return this.setBackgroundColor(e),this}setTextRotation(e){return this._commandService.syncExecuteCommand(Tl.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:e}),this}setValue(e){const t=Qg(e);if(!t)throw new Error("Invalid value");return this._commandService.syncExecuteCommand(An.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:t}),this}setValueForCell(e){const t=Qg(e);if(!t)throw new Error("Invalid value");return this._commandService.syncExecuteCommand(An.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:{startColumn:this._range.startColumn,startRow:this._range.startRow,endColumn:this._range.startColumn,endRow:this._range.startRow},value:t}),this}setRichTextValueForCell(e){const t=e instanceof fo?e.getData():e,n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:{startColumn:this._range.startColumn,startRow:this._range.startRow,endColumn:this._range.startColumn,endRow:this._range.startRow},value:{p:t}};return this._commandService.syncExecuteCommand(An.id,n),this}setRichTextValues(e){const t=e.map(i=>i.map(r=>r&&{p:r instanceof fo?r.getData():r})),n=Kf(t,this._range),s={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:n};return this._commandService.syncExecuteCommand(An.id,s),this}setWrap(e){return this._commandService.syncExecuteCommand(Dr.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:e?ws.WRAP:ws.UNSPECIFIED}),this}setWrapStrategy(e){return this._commandService.syncExecuteCommand(Dr.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:e}),this}setVerticalAlignment(e){return this._commandService.syncExecuteCommand(xl.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:s6(e)}),this}setHorizontalAlignment(e){return this._commandService.syncExecuteCommand(kl.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:n6(e)}),this}setValues(e){const t=Kf(e,this._range);return this._commandService.syncExecuteCommand(An.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,value:t}),this}setFontWeight(e){let t;if(e==="bold")t=pe.TRUE;else if(e==="normal")t=pe.FALSE;else if(e===null)t=null;else throw new Error("Invalid fontWeight");const n={type:"bl",value:t},s={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:n};return this._commandService.syncExecuteCommand(Tt.id,s),this}setFontStyle(e){let t;if(e==="italic")t=pe.TRUE;else if(e==="normal")t=pe.FALSE;else if(e===null)t=null;else throw new Error("Invalid fontStyle");const n={type:"it",value:t},s={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:n};return this._commandService.syncExecuteCommand(Tt.id,s),this}setFontLine(e){if(e==="underline")this._setFontUnderline({s:pe.TRUE});else if(e==="line-through")this._setFontStrikethrough({s:pe.TRUE});else if(e==="none")this._setFontUnderline({s:pe.FALSE}),this._setFontStrikethrough({s:pe.FALSE});else if(e===null)this._setFontUnderline(null),this._setFontStrikethrough(null);else throw new Error("Invalid fontLine");return this}_setFontUnderline(e){const t={type:"ul",value:e},n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:t};this._commandService.syncExecuteCommand(Tt.id,n)}_setFontStrikethrough(e){const t={type:"st",value:e},n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:t};this._commandService.syncExecuteCommand(Tt.id,n)}setFontFamily(e){const t={type:"ff",value:e},n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:t};return this._commandService.syncExecuteCommand(Tt.id,n),this}setFontSize(e){const t={type:"fs",value:e},n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:t};return this._commandService.syncExecuteCommand(Tt.id,n),this}setFontColor(e){const t={type:"cl",value:e===null?null:{rgb:e}},n={unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,style:t};return this._commandService.syncExecuteCommand(Tt.id,n),this}merge(e){const t=this._workbook.getUnitId(),n=this._worksheet.getSheetId();return zh(this._injector,t,n,[this._range],e),this}mergeAcross(e){const t=Vr([this._range],Dt.ROWS),n=this._workbook.getUnitId(),s=this._worksheet.getSheetId();return zh(this._injector,n,s,t,e),this}mergeVertically(e){const t=Vr([this._range],Dt.COLUMNS),n=this._workbook.getUnitId(),s=this._worksheet.getSheetId();return zh(this._injector,n,s,t,e),this}isPartOfMerge(){const{startRow:e,startColumn:t,endRow:n,endColumn:s}=this._range;return this._worksheet.getMergedCellRange(e,t,n,s).length>0}breakApart(){return this._commandService.syncExecuteCommand(vu.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),ranges:[this._range]}),this}forEach(e){const{startColumn:t,startRow:n,endColumn:s,endRow:i}=this._range;this._worksheet.getMatrixWithMergedCells(n,t,i,s).forValue((r,o,a)=>{e(r,o,a)})}getA1Notation(e,t,n){const s={...this._range,startAbsoluteRefType:t,endAbsoluteRefType:n};return e?qc(this._worksheet.getName(),s):gu(s)}activate(){return this._injector.createInstance(vs,this._workbook).setActiveRange(this),this}activateAsCurrentCell(){const e=this._worksheet.getMergedCell(this._range.startRow,this._range.startColumn);if(e&&z.equals(e,this._range)||!e&&this._range.startRow===this._range.endRow&&this._range.startColumn===this._range.endColumn){const t=this._injector.createInstance(vs,this._workbook).getActiveRange();if(!t||t.getUnitId()!==this.getUnitId()||t.getSheetId()!==this.getSheetId())return this.activate();if(z.contains(t.getRange(),this._range)){const n={unitId:this.getUnitId(),subUnitId:this.getSheetId(),selections:[{range:t.getRange(),primary:Ht(this.getRange(),this._worksheet),style:null}]};return this._commandService.syncExecuteCommand(me.id,n),this}return this.activate()}else throw new Error("The range is not a single cell")}splitTextToColumns(e,t,n){this._commandService.syncExecuteCommand(BS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,delimiter:t,customDelimiter:n,treatMultipleDelimitersAsOne:e})}useThemeStyle(e){if(e==null){const t=this.getUsedThemeStyle();t&&this.removeThemeStyle(t)}else this._commandService.syncExecuteCommand(mS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,themeName:e})}removeThemeStyle(e){this._commandService.syncExecuteCommand(TS.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range,themeName:e})}getUsedThemeStyle(){return this._injector.get(Ll).getAppliedRangeThemeStyle({unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),range:this._range})}clear(e){return e&&e.contentsOnly&&!e.formatOnly?this.clearContent():e&&e.formatOnly&&!e.contentsOnly?this.clearFormat():(this._commandService.syncExecuteCommand(Os.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),ranges:[this._range],options:e}),this)}clearContent(){return this._commandService.syncExecuteCommand(as.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),ranges:[this._range]}),this}clearFormat(){return this._commandService.syncExecuteCommand(Vs.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),ranges:[this._range]}),this}insertCells(e){e===Dt.ROWS?this._commandService.executeCommand(Fs.id,{range:this._range}):this._commandService.executeCommand(gi.id,{range:this._range})}deleteCells(e){e===Dt.ROWS?this._commandService.executeCommand(js.id,{range:this._range}):this._commandService.executeCommand(Bs.id,{range:this._range})}getDataRegion(e){const{startRow:t,startColumn:n,endRow:s,endColumn:i}=this._range,r=this._worksheet.getMaxRows(),o=this._worksheet.getMaxColumns(),a=this._worksheet.getCellMatrix();let l=t,u=n,d=s,c=i;if(e!==Dt.COLUMNS){let h=!1,g=!1;for(let m=n;m<=i&&(t>0&&!ja(a.getValue(t-1,m))&&(h=!0),s<r-1&&!ja(a.getValue(s+1,m))&&(g=!0),!(h&&g));m++);h&&(l=t-1),g&&(d=s+1)}if(e!==Dt.ROWS){let h=!1,g=!1;for(let m=t;m<=s&&(n>0&&!ja(a.getValue(m,n-1))&&(h=!0),i<o-1&&!ja(a.getValue(m,i+1))&&(g=!0),!(h&&g));m++);h&&(u=n-1),g&&(c=i+1)}return this._injector.createInstance(Gn,this._workbook,this._worksheet,{startRow:l,startColumn:u,endRow:d,endColumn:c})}isBlank(){const e=this._worksheet.getCellMatrix(),{startRow:t,startColumn:n,endRow:s,endColumn:i}=this._range;let r=!0;for(let o=t;o<=s;o++){for(let a=n;a<=i;a++)if(!ja(e.getValue(o,a))){r=!1;break}if(!r)break}return r}offset(e,t,n,s){const{startRow:i,startColumn:r,endRow:o,endColumn:a}=this._range,l=i+e,u=r+t,d=n?l+n-1:o+e,c=s?u+s-1:a+t;if(l<0||u<0||d<0||c<0)throw new Error("The row or column index is out of range");return this._injector.createInstance(Gn,this._workbook,this._worksheet,{startRow:l,startColumn:u,endRow:d,endColumn:c})}setFormula(e){return this.setValue({f:e})}setFormulas(e){return this.setValues(e.map(t=>t.map(n=>({f:n}))))}getRangePermission(){const e=this._injector.createInstance(Fn,this._injector.createInstance(vs,this._workbook),this._workbook,this._worksheet);return this._injector.createInstance(Um,this._workbook.getUnitId(),this._worksheet.getSheetId(),this,e)}autoFill(e,t){const n=this.getRange(),s=e.getRange();if(!z.contains(s,n))throw new Error("AutoFill target range must contain source range");const{startRow:i,startColumn:r,endRow:o,endColumn:a}=n,{startRow:l,startColumn:u,endRow:d,endColumn:c}=s;if(o-i!==d-l&&a-r!==c-u)throw new Error("AutoFill can only fill in one direction");if(o-i===d-l&&r!==u&&a!==c)throw new Error("AutoFill can only fill in one direction");if(a-r===c-u&&i!==l&&o!==d)throw new Error("AutoFill can only fill in one direction");return this._commandService.executeCommand(Er.id,{sourceRange:n,targetRange:s,unitId:this.getUnitId(),subUnitId:this.getSheetId(),applyType:t})}},zg._enableManualInit(),zg);Gn=o6([Fg(3,V(pt)),Fg(4,U),Fg(5,V(Mw))],Gn);var a6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},Xg=(e,t)=>(n,s)=>t(n,s,e);let Nm=class{constructor(e,t,n,s){St(this,"_permissionSubject"),St(this,"_collaboratorChangeSubject",new Ve),St(this,"permission$"),St(this,"pointChange$"),St(this,"collaboratorChange$"),St(this,"_subscriptions",[]),St(this,"_fPermission"),this._unitId=e,this._injector=t,this._permissionService=n,this._authzIoService=s,this._fPermission=this._injector.createInstance(to),this._permissionSubject=new xe(this._buildSnapshot()),this.permission$=this._createPermissionStream(),this.pointChange$=this._createPointChangeStream(),this.collaboratorChange$=this._collaboratorChangeSubject.asObservable().pipe(Rn({bufferSize:1,refCount:!0}))}_createPermissionStream(){const e=this._permissionService.permissionPointUpdate$.pipe(Wt(t=>t.id.includes(this._unitId))).subscribe(()=>{this._permissionSubject.next(this._buildSnapshot())});return this._subscriptions.push(e),this._permissionSubject.asObservable().pipe(yn((t,n)=>JSON.stringify(t)===JSON.stringify(n)),Rn({bufferSize:1,refCount:!0}))}_createPointChangeStream(){const e=new Map;for(const t in ye){const n=ye[t];e.set(n,this.getPoint(n))}return this._permissionService.permissionPointUpdate$.pipe(Wt(t=>t.id.includes(this._unitId)),Se(t=>{const n=this._extractWorkbookPointType(t.id);if(!n)return null;const s=!!t.value,i=e.get(n);return e.set(n,s),i===s?null:{point:n,value:s,oldValue:i}}),Wt(t=>t!==null),Rn({bufferSize:1,refCount:!0}))}_extractWorkbookPointType(e){for(const t in ye){const n=ye[t],s=$u[n];if(s&&new s(this._unitId).id===e)return n}return null}_buildSnapshot(){const e={};for(const t in ye){const n=ye[t];e[n]=this.getPoint(n)}return e}async setMode(e){const t=this._getModePermissions(e);await this._batchSetPermissionPoints(t)}_getModePermissions(e){const t={};switch(Object.values(ye).forEach(n=>{t[n]=!1}),e){case"owner":Object.values(ye).forEach(n=>{t[n]=!0});break;case"editor":t[ye.Edit]=!0,t[ye.View]=!0,t[ye.Print]=!0,t[ye.Export]=!0,t[ye.CopyContent]=!0,t[ye.Comment]=!0,t[ye.CreateSheet]=!0,t[ye.DeleteSheet]=!0,t[ye.RenameSheet]=!0,t[ye.MoveSheet]=!0,t[ye.HideSheet]=!0,t[ye.InsertRow]=!0,t[ye.InsertColumn]=!0,t[ye.DeleteRow]=!0,t[ye.DeleteColumn]=!0,t[ye.CopySheet]=!0,t[ye.CreateProtection]=!0;break;case"viewer":t[ye.View]=!0,t[ye.Print]=!0;break;case"commenter":t[ye.View]=!0,t[ye.Comment]=!0,t[ye.Print]=!0;break}return t}async _batchSetPermissionPoints(e){const t=[];for(const[n,s]of Object.entries(e)){const i=n,r=$u[i];if(!r)throw new Error(`Unknown workbook permission point: ${i}`);const o=this.getPoint(i);o!==s&&(this._fPermission.setWorkbookPermissionPoint(this._unitId,r,s),t.push({point:i,value:s,oldValue:o}))}if(t.length>0){const n=this._buildSnapshot();this._permissionSubject.next(n)}}async setReadOnly(){await this.setMode("viewer")}async setEditable(){await this.setMode("editor")}canEdit(){return this.getPoint(ye.Edit)}async setPoint(e,t){const n=$u[e];if(!n)throw new Error(`Unknown workbook permission point: ${e}`);if(this.getPoint(e)===t)return;this._fPermission.setWorkbookPermissionPoint(this._unitId,n,t);const s=this._buildSnapshot();this._permissionSubject.next(s)}getPoint(e){var t;const n=$u[e];if(!n)throw new Error(`Unknown workbook permission point: ${e}`);const s=new n(this._unitId),i=this._permissionService.getPermissionPoint(s.id);return(t=i?.value)!=null?t:!0}getSnapshot(){return this._buildSnapshot()}async setCollaborators(e){const t=e.map(n=>({id:n.user.userID,subject:n.user,role:n.role}));await this._authzIoService.putCollaborators({objectID:this._unitId,unitID:this._unitId,collaborators:t}),e.forEach(n=>{this._collaboratorChangeSubject.next({type:"add",collaborator:{user:{id:n.user.userID},role:n.role}})})}async addCollaborator(e,t){await this._authzIoService.createCollaborator({objectID:this._unitId,unitID:this._unitId,collaborators:[{id:e.userID,subject:e,role:t}]}),this._collaboratorChangeSubject.next({type:"add",collaborator:{user:{id:e.userID},role:t}})}async updateCollaborator(e,t){await this._authzIoService.updateCollaborator({objectID:this._unitId,unitID:this._unitId,collaborator:{id:e.userID,subject:e,role:t}}),this._collaboratorChangeSubject.next({type:"update",collaborator:{user:{id:e.userID},role:t}})}async removeCollaborator(e){await this._authzIoService.deleteCollaborator({objectID:this._unitId,unitID:this._unitId,collaboratorID:e}),this._collaboratorChangeSubject.next({type:"delete",collaborator:{user:{id:e},role:xr.Reader}})}async removeCollaborators(e){for(const t of e)await this.removeCollaborator(t)}async listCollaborators(){return(await this._authzIoService.listCollaborators({objectID:this._unitId,unitID:this._unitId})).map(e=>{var t,n;return{user:{id:((t=e.subject)==null?void 0:t.userID)||e.id,displayName:((n=e.subject)==null?void 0:n.name)||""},role:e.role}})}subscribe(e){const t=this.permission$.subscribe(e);return()=>t.unsubscribe()}dispose(){this._subscriptions.forEach(e=>e.unsubscribe()),this._permissionSubject.complete(),this._collaboratorChangeSubject.complete()}};Nm=a6([Xg(1,V(pt)),Xg(2,Je),Xg(3,Ys)],Nm);var l6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},ti=(e,t)=>(n,s)=>t(n,s,e);let vs=class extends tp{constructor(e,t,n,s,i,r,o,a,l,u){super(t),St(this,"id"),this._workbook=e,this._injector=t,this._resourceLoaderService=n,this._selectionManagerService=s,this._univerInstanceService=i,this._commandService=r,this._permissionService=o,this._logService=a,this._localeService=l,this._definedNamesService=u,this.id=this._workbook.getUnitId()}getWorkbook(){return this._workbook}dispose(){super.dispose(),this._workbook=null}getId(){return this.id}getName(){return this._workbook.name}setName(e){return this._commandService.syncExecuteCommand(Kp.id,{unitId:this._workbook.getUnitId(),name:e}),this}save(){return this._resourceLoaderService.saveUnit(this._workbook.getUnitId())}getSnapshot(){return this._logService.warn("use 'save' instead of 'getSnapshot'"),this.save()}getActiveSheet(){const e=this._workbook.getActiveSheet();return this._injector.createInstance(Fn,this,this._workbook,e)}getSheets(){return this._workbook.getSheets().map(e=>this._injector.createInstance(Fn,this,this._workbook,e))}create(e,t,n,s){var i,r,o;const a=Yg(Q.deepClone((i=s?.sheet)!=null?i:{}));a.name=this._workbook.uniqueSheetName(e),a.rowCount=t,a.columnCount=n,a.id=(r=s?.sheet)==null?void 0:r.id;const l=(o=s?.index)!=null?o:this._workbook.getSheets().length;this._commandService.syncExecuteCommand(Go.id,{unitId:this.id,index:l,sheet:a}),this._commandService.syncExecuteCommand(lt.id,{unitId:this.id,subUnitId:this._workbook.getSheets()[l].getSheetId()});const u=this._workbook.getActiveSheet();if(!u)throw new Error("No active sheet found");return this._injector.createInstance(Fn,this,this._workbook,u)}getSheetBySheetId(e){const t=this._workbook.getSheetBySheetId(e);return t?this._injector.createInstance(Fn,this,this._workbook,t):null}getSheetByName(e){const t=this._workbook.getSheetBySheetName(e);return t?this._injector.createInstance(Fn,this,this._workbook,t):null}setActiveSheet(e){return this._commandService.syncExecuteCommand(lt.id,{unitId:this.id,subUnitId:typeof e=="string"?e:e.getSheetId()}),typeof e=="string"?this.getSheetBySheetId(e):e}insertSheet(e,t){var n,s,i;const r=Yg(Q.deepClone((n=t?.sheet)!=null?n:{}));r.name=this._workbook.uniqueSheetName(e),r.id=(s=t?.sheet)==null?void 0:s.id;const o=(i=t?.index)!=null?i:this._workbook.getSheets().length;this._commandService.syncExecuteCommand(Go.id,{unitId:this.id,index:o,sheet:r}),this._commandService.syncExecuteCommand(lt.id,{unitId:this.id,subUnitId:this._workbook.getSheets()[o].getSheetId()});const a=this._workbook.getActiveSheet();if(!a)throw new Error("No active sheet found");return this._injector.createInstance(Fn,this,this._workbook,a)}deleteSheet(e){const t=this.id,n=typeof e=="string"?e:e.getSheetId();return this._commandService.syncExecuteCommand(Wr.id,{unitId:t,subUnitId:n})}undo(){return this._univerInstanceService.focusUnit(this.id),this._commandService.syncExecuteCommand(MI.id),this}redo(){return this._univerInstanceService.focusUnit(this.id),this._commandService.syncExecuteCommand(EI.id),this}onBeforeCommandExecute(e){return this._commandService.beforeCommandExecuted(t=>{var n;((n=t.params)==null?void 0:n.unitId)===this.id&&e(t)})}onCommandExecuted(e){return this._commandService.onCommandExecuted(t=>{var n;((n=t.params)==null?void 0:n.unitId)===this.id&&e(t)})}onSelectionChange(e){return He(this._selectionManagerService.selectionMoveEnd$.subscribe(t=>{this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId()===this.id&&(t!=null&&t.length?e(t.map(n=>n.range)):e([]))}))}setEditable(e){const t=new ne(this._workbook.getUnitId());return this._permissionService.getPermissionPoint(t.id)||this._permissionService.addPermissionPoint(t),this._permissionService.updatePermissionPoint(t.id,e),this}setActiveRange(e){const t=this.getActiveSheet(),n=e.getRange().sheetId||t.getSheetId(),s=n?this._workbook.getSheetBySheetId(n):this._workbook.getActiveSheet(!0);if(!s)throw new Error("No active sheet found");s.getSheetId()!==t.getSheetId()&&this.setActiveSheet(this._injector.createInstance(Fn,this,this._workbook,s));const i={unitId:this.getId(),subUnitId:n,selections:[e].map(r=>({range:r.getRange(),primary:Ht(r.getRange(),s),style:null}))};return this._commandService.syncExecuteCommand(me.id,i),this}getActiveRange(){const e=this._workbook.getActiveSheet(),t=this._selectionManagerService.getCurrentSelections().find(n=>!!n.primary);return t?this._injector.createInstance(Gn,this._workbook,e,t.range):null}getActiveCell(){const e=this._workbook.getActiveSheet(),t=this._selectionManagerService.getCurrentSelections().find(s=>!!s.primary);if(!t)return null;const n={...t.primary,rangeType:j.NORMAL};return this._injector.createInstance(Gn,this._workbook,e,n)}deleteActiveSheet(){const e=this.getActiveSheet();return this.deleteSheet(e)}duplicateSheet(e){return this._commandService.syncExecuteCommand(rh.id,{unitId:e.getWorkbook().getUnitId(),subUnitId:e.getSheetId()}),this._injector.createInstance(Fn,this,this._workbook,this._workbook.getActiveSheet())}duplicateActiveSheet(){const e=this.getActiveSheet();return this.duplicateSheet(e)}getNumSheets(){return this._workbook.getSheets().length}getLocale(){return this._localeService.getCurrentLocale()}setLocale(e){this._localeService.setLocale(e)}setSpreadsheetLocale(e){return this._localeService.setLocale(e),this}getUrl(){return location.href}moveSheet(e,t){let n=t;return n<0?n=0:n>this._workbook.getSheets().length-1&&(n=this._workbook.getSheets().length-1),this._commandService.syncExecuteCommand(hh.id,{unitId:e.getWorkbook().getUnitId(),order:n,subUnitId:e.getSheetId()}),this}moveActiveSheet(e){const t=this.getActiveSheet();return this.moveSheet(t,e)}getPermission(){return this._injector.createInstance(to)}getWorkbookPermission(){return this._injector.createInstance(Nm,this._workbook.getUnitId())}getDefinedName(e){const t=this._definedNamesService.getValueByName(this.id,e);return t?this._injector.createInstance(Vc,{...t,unitId:this.id}):null}getDefinedNames(){const e=this._definedNamesService.getDefinedNameMap(this.id);return e?Object.values(e).map(t=>this._injector.createInstance(Vc,{...t,unitId:this.id})):[]}insertDefinedName(e,t){const n=this._injector.createInstance(Dh).setName(e).setRef(t).build();return n.localSheetId=nr,this.insertDefinedNameBuilder(n),this}deleteDefinedName(e){const t=this.getDefinedName(e);return t?(t.delete(),!0):!1}insertDefinedNameBuilder(e){e.unitId=this.getId(),this._commandService.syncExecuteCommand(qo.id,e)}updateDefinedNameBuilder(e){this._commandService.syncExecuteCommand(qo.id,e)}getRegisteredRangeThemes(){return this._injector.get(Ll).getRegisteredRangeThemes()}registerRangeTheme(e){this._commandService.syncExecuteCommand(US.id,{unitId:this.getId(),rangeThemeStyle:e})}unregisterRangeTheme(e){this._commandService.syncExecuteCommand(FS.id,{unitId:this.getId(),themeName:e})}createRangeThemeStyle(e,t){return new Si(e,t)}setCustomMetadata(e){return this._workbook.setCustomMetadata(e),this}getCustomMetadata(){return this._workbook.getCustomMetadata()}addStyles(e){this._workbook.addStyles(e)}removeStyles(e){this._workbook.removeStyles(e)}};vs=l6([ti(1,V(pt)),ti(2,V(xI)),ti(3,V(q)),ti(4,P),ti(5,U),ti(6,Je),ti(7,ar),ti(8,V(Oe)),ti(9,wi)],vs);class u6 extends Ew{getCommandSheetTarget(t){var n;const s=t.params;if(!s)return this.getActiveSheet();const i=s.unitId?this.getUniverSheet(s.unitId):(n=this.getActiveWorkbook)==null?void 0:n.call(this);if(!i)return;const r=i.getSheetBySheetId(s.subUnitId||s.sheetId)||i.getActiveSheet();if(r)return{workbook:i,worksheet:r}}getSheetTarget(t,n){const s=this.getUniverSheet(t);if(!s)return;const i=s.getSheetBySheetId(n);if(i)return{workbook:s,worksheet:i}}_initWorkbookEvent(t){const n=t.get(P);this.disposeWithMe(this.registerEventHandler(this.Event.WorkbookDisposed,()=>n.unitDisposed$.subscribe(s=>{s.type===A.UNIVER_SHEET&&this.fireEvent(this.Event.WorkbookDisposed,{unitId:s.getUnitId(),unitType:s.type,snapshot:s.getSnapshot()})}))),this.disposeWithMe(this.registerEventHandler(this.Event.WorkbookCreated,()=>n.unitAdded$.subscribe(s=>{if(s.type===A.UNIVER_SHEET){const i=s,r=t.createInstance(vs,i);this.fireEvent(this.Event.WorkbookCreated,{unitId:s.getUnitId(),type:s.type,workbook:r,unit:r})}})))}_initialize(t){const n=t.get(P),s=t.get(U);this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetCreate,()=>s.beforeCommandExecuted(i=>{var r;if(i.id===Go.id){const o=i.params,{unitId:a,index:l,sheet:u}=o||{},d=a?this.getUniverSheet(a):(r=this.getActiveWorkbook)==null?void 0:r.call(this);if(!d)return;const c={workbook:d,index:l,sheet:u};if(this.fireEvent(this.Event.BeforeSheetCreate,c),c.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeActiveSheetChange,()=>s.beforeCommandExecuted(i=>{var r;if(i.id===lt.id){const{subUnitId:o,unitId:a}=i.params,l=a?this.getUniverSheet(a):(r=this.getActiveWorkbook)==null?void 0:r.call(this);if(!l||!o)return;const u=l.getSheetBySheetId(o),d=l.getActiveSheet();if(!u||!d)return;const c={workbook:l,activeSheet:u,oldActiveSheet:d};if(this.fireEvent(this.Event.BeforeActiveSheetChange,c),c.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetDelete,()=>s.beforeCommandExecuted(i=>{if(i.id===Wr.id){const r=this.getCommandSheetTarget(i);if(!r)return;const{workbook:o,worksheet:a}=r,l={workbook:o,worksheet:a};if(this.fireEvent(this.Event.BeforeSheetDelete,l),l.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetMove,()=>s.beforeCommandExecuted(i=>{if(i.id===di.id){const{fromOrder:r,toOrder:o}=i.params,a=this.getCommandSheetTarget(i);if(!a)return;const l={workbook:a.workbook,worksheet:a.worksheet,newIndex:o,oldIndex:r};if(this.fireEvent(this.Event.BeforeSheetMove,l),l.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetNameChange,()=>s.beforeCommandExecuted(i=>{if(i.id===zr.id){const{name:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;const a={workbook:o.workbook,worksheet:o.worksheet,newName:r,oldName:o.worksheet.getSheetName()};if(this.fireEvent(this.Event.BeforeSheetNameChange,a),a.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetTabColorChange,()=>s.beforeCommandExecuted(i=>{if(i.id===kr.id){const{color:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;const a={workbook:o.workbook,worksheet:o.worksheet,newColor:r,oldColor:o.worksheet.getTabColor()};if(this.fireEvent(this.Event.BeforeSheetTabColorChange,a),a.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetHideChange,()=>s.beforeCommandExecuted(i=>{if(i.id===cn.id){const{hidden:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;const a={workbook:o.workbook,worksheet:o.worksheet,hidden:!!r};if(this.fireEvent(this.Event.BeforeSheetHideChange,a),a.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeGridlineColorChange,()=>s.beforeCommandExecuted(i=>{var r;if(i.id===Wd.id){const o=this.getCommandSheetTarget(i);if(!o)return;const a={...o,color:(r=i.params)==null?void 0:r.color};if(this.fireEvent(this.Event.BeforeGridlineColorChange,a),a.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeGridlineEnableChange,()=>s.beforeCommandExecuted(i=>{var r;if(i.id===$o.id){const o=this.getCommandSheetTarget(i);if(!o)return;const a={...o,enabled:!!((r=i.params)!=null&&r.showGridlines)};if(this.fireEvent(this.Event.BeforeGridlineEnableChange,a),a.cancel)throw new qs}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetValueChanged,()=>s.onCommandExecuted(i=>{if(Vw.indexOf(i.id)>-1){if(!this.getActiveSheet())return;const r=TR(n,i).map(o=>{var a,l;return(l=(a=this.getWorkbook(o.unitId))==null?void 0:a.getSheetBySheetId(o.subUnitId))==null?void 0:l.getRange(o.range)}).filter(Boolean);if(!r.length)return;this.fireEvent(this.Event.SheetValueChanged,{payload:i,effectedRanges:r})}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetCreated,()=>s.onCommandExecuted(i=>{var r;if(i.id===Go.id){const o=i.params,{unitId:a}=o||{},l=a?this.getUniverSheet(a):(r=this.getActiveWorkbook)==null?void 0:r.call(this);if(!l)return;const u=l.getActiveSheet();if(!u)return;const d={workbook:l,worksheet:u};this.fireEvent(this.Event.SheetCreated,d)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.ActiveSheetChanged,()=>s.onCommandExecuted(i=>{if(i.id===lt.id){const r=this.getActiveSheet();if(!r)return;const{workbook:o,worksheet:a}=r;this._fireActiveSheetChanged(o,a)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetDeleted,()=>s.onCommandExecuted(i=>{var r;if(i.id===Wr.id){const{subUnitId:o,unitId:a}=i.params,l=a?this.getUniverSheet(a):(r=this.getActiveWorkbook)==null?void 0:r.call(this);if(!l||!o)return;this._fireSheetDeleted(l,o)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetMoved,()=>s.onCommandExecuted(i=>{if(i.id===di.id){const{toOrder:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;this._fireSheetMoved(o.workbook,o.worksheet,r)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetNameChanged,()=>s.onCommandExecuted(i=>{if(i.id===zr.id){const{name:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;this._fireSheetNameChanged(o.workbook,o.worksheet,r)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetTabColorChanged,()=>s.onCommandExecuted(i=>{if(i.id===kr.id){const{color:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;this._fireSheetTabColorChanged(o.workbook,o.worksheet,r)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetHideChanged,()=>s.onCommandExecuted(i=>{if(i.id===cn.id){const{hidden:r}=i.params,o=this.getCommandSheetTarget(i);if(!o)return;this._fireSheetHideChanged(o.workbook,o.worksheet,!!r)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.GridlineChanged,()=>s.onCommandExecuted(i=>{if(i.id===Wd.id||i.id===$o.id){const r=this.getCommandSheetTarget(i);if(!r)return;this.fireEvent(this.Event.GridlineChanged,{...r,enabled:!r.worksheet.hasHiddenGridLines(),color:r.worksheet.getGridLinesColor()})}}))),this._initWorkbookEvent(t)}createUniverSheet(t,n){const s=this._injector.get(P).createUnit(A.UNIVER_SHEET,t,n);return this._injector.createInstance(vs,s)}createWorkbook(t,n){return this.createUniverSheet(t,n)}getActiveWorkbook(){const t=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);return t?this._injector.createInstance(vs,t):null}getActiveUniverSheet(){return this.getActiveWorkbook()}getUniverSheet(t){const n=this._univerInstanceService.getUnit(t,A.UNIVER_SHEET);return n?this._injector.createInstance(vs,n):null}getWorkbook(t){return this.getUniverSheet(t)}getPermission(){return this._injector.createInstance(to)}onUniverSheetCreated(t){const n=this._univerInstanceService.getTypeOfUnitAdded$(A.UNIVER_SHEET).subscribe(s=>{const i=this._injector.createInstance(vs,s);t(i)});return He(n)}newDefinedName(){return this._injector.createInstance(Dh)}getActiveSheet(){const t=this.getActiveWorkbook();if(!t)return null;const n=t.getActiveSheet();return n?{workbook:t,worksheet:n}:null}setFreezeSync(t){this._injector.get(Hl).setEnabled(t)}_fireActiveSheetChanged(t,n){this.fireEvent(this.Event.ActiveSheetChanged,{workbook:t,activeSheet:n})}_fireSheetDeleted(t,n){this.fireEvent(this.Event.SheetDeleted,{workbook:t,sheetId:n})}_fireSheetMoved(t,n,s){this.fireEvent(this.Event.SheetMoved,{workbook:t,worksheet:n,newIndex:s})}_fireSheetNameChanged(t,n,s){this.fireEvent(this.Event.SheetNameChanged,{workbook:t,worksheet:n,newName:s})}_fireSheetTabColorChanged(t,n,s){this.fireEvent(this.Event.SheetTabColorChanged,{workbook:t,worksheet:n,newColor:s})}_fireSheetHideChanged(t,n,s){this.fireEvent(this.Event.SheetHideChanged,{workbook:t,worksheet:n,hidden:s})}}Ew.extend(u6);class d6{get SheetValueChangeType(){return Aw}get SheetSkeletonChangeType(){return Ow}get SplitDelimiterType(){return Bw}get UnitRole(){return xr}get WorkbookPermissionPoint(){return ye}get WorksheetPermissionPoint(){return ht}get RangePermissionPoint(){return fn}}E0.extend(d6);class c6{get SheetCreated(){return"SheetCreated"}get BeforeSheetCreate(){return"BeforeSheetCreate"}get WorkbookCreated(){return"WorkbookCreated"}get WorkbookDisposed(){return"WorkbookDisposed"}get GridlineChanged(){return"GridlineChanged"}get BeforeGridlineEnableChange(){return"BeforeGridlineEnableChange"}get BeforeGridlineColorChange(){return"BeforeGridlineColorChange"}get BeforeActiveSheetChange(){return"BeforeActiveSheetChange"}get ActiveSheetChanged(){return"ActiveSheetChanged"}get SheetDeleted(){return"SheetDeleted"}get BeforeSheetDelete(){return"BeforeSheetDelete"}get SheetMoved(){return"SheetMoved"}get BeforeSheetMove(){return"BeforeSheetMove"}get SheetNameChanged(){return"SheetNameChanged"}get BeforeSheetNameChange(){return"BeforeSheetNameChange"}get SheetTabColorChanged(){return"SheetTabColorChanged"}get BeforeSheetTabColorChange(){return"BeforeSheetTabColorChange"}get SheetHideChanged(){return"SheetHideChanged"}get BeforeSheetHideChange(){return"BeforeSheetHideChange"}get SheetValueChanged(){return"SheetValueChanged"}}x0.extend(c6);var h6=(e,t,n,s)=>{for(var i=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(i=o(i)||i);return i},g6=(e,t)=>(n,s)=>t(n,s,e);let BC=class extends np{constructor(e){super(),this._injector=e}};BC=h6([g6(0,V(pt))],BC);export{ne as $,On as A,Ih as B,bE as C,tf as D,vs as E,Op as F,bi as G,Vp as H,qt as I,Hn as J,q as K,qe as L,Ap as M,An as N,ef as O,Dp as P,Qy as Q,ri as R,pS as S,$i as T,xh as U,Bh as V,Vd as W,le as X,_e as Y,Er as Z,Vl as _,T0 as a,uc as a$,yS as a0,im as a1,RS as a2,aa as a3,la as a4,qr as a5,eb as a6,pi as a7,ap as a8,Vw as a9,TS as aA,yl as aB,iR as aC,Qo as aD,Ko as aE,eu as aF,ac as aG,XT as aH,uf as aI,Ft as aJ,da as aK,ic as aL,ve as aM,_E as aN,qE as aO,gs as aP,N6 as aQ,U6 as aR,mP as aS,ls as aT,oT as aU,Qr as aV,su as aW,iu as aX,gc as aY,Sh as aZ,wh as a_,ud as aa,si as ab,No as ac,rf as ad,oc as ae,Ib as af,$r as ag,Uh as ah,xu as ai,Os as aj,as as ak,Vs as al,rh as am,MS as an,A6 as ao,Bd as ap,Bs as aq,Ru as ar,js as as,na as at,kS as au,Wo as av,$n as aw,Ul as ax,Ph as ay,Hr as az,he as b,E6 as b$,Ua as b0,ku as b1,um as b2,Ii as b3,Tu as b4,Na as b5,$c as b6,v_ as b7,hs as b8,Zt as b9,Ri as bA,zS as bB,hS as bC,sf as bD,$d as bE,Ml as bF,U3 as bG,Ki as bH,Ln as bI,oR as bJ,zi as bK,Mn as bL,Qi as bM,Wn as bN,rR as bO,Jn as bP,yi as bQ,dm as bR,nt as bS,dd as bT,OP as bU,yr as bV,_t as bW,ox as bX,JS as bY,WT as bZ,Fo as b_,Vh as ba,uy as bb,xp as bc,Td as bd,_s as be,on as bf,Qc as bg,PS as bh,kp as bi,Tp as bj,Mp as bk,Ep as bl,Fs as bm,sa as bn,gi as bo,yu as bp,ly as bq,yp as br,kd as bs,bs as bt,rn as bu,sp as bv,Go as bw,cs as bx,ES as by,D0 as bz,Kr as c,iE as c$,Is as c0,$p as c1,Jp as c2,Gi as c3,Gd as c4,Wl as c5,We as c6,qd as c7,Si as c8,Ar as c9,yd as cA,uR as cB,Xp as cC,Cf as cD,AP as cE,vS as cF,nr as cG,Eo as cH,Hu as cI,Md as cJ,$S as cK,bu as cL,DP as cM,yt as cN,Ss as cO,bf as cP,mh as cQ,Rf as cR,kh as cS,iy as cT,cf as cU,Ct as cV,wx as cW,_f as cX,El as cY,Wp as cZ,Ol as c_,Ed as ca,Gp as cb,US as cc,Nl as cd,Up as ce,Pa as cf,Yl as cg,$t as ch,oh as ci,pn as cj,IE as ck,Pp as cl,Ta as cm,Xl as cn,an as co,Wr as cp,Mh as cq,En as cr,dy as cs,vu as ct,et as cu,Oh as cv,Bb as cw,IT as cx,RT as cy,tm as cz,CP as d,me as d$,_u as d0,nE as d1,sE as d2,oa as d3,At as d4,Nh as d5,rm as d6,ol as d7,hR as d8,Lr as d9,Vo as dA,ff as dB,bh as dC,Aa as dD,Lo as dE,Kt as dF,Ha as dG,hb as dH,gb as dI,Fl as dJ,RE as dK,Va as dL,Vt as dM,am as dN,ll as dO,RR as dP,Zl as dQ,fh as dR,tr as dS,Br as dT,Yi as dU,Xi as dV,mr as dW,Kl as dX,ah as dY,uh as dZ,gr as d_,Ur as da,Nr as db,jr as dc,Gl as dd,vh as de,qo as df,Ql as dg,ql as dh,Fp as di,Cu as dj,Eh as dk,gl as dl,wn as dm,lh as dn,Wd as dp,al as dq,kl as dr,wf as ds,Lp as dt,Mu as du,gP as dv,OS as dw,Oa as dx,om as dy,vf as dz,Xr as e,Ws as e$,Ji as e0,er as e1,jp as e2,Tt as e3,dh as e4,kr as e5,zp as e6,Tl as e7,Dr as e8,Bp as e9,sR as eA,vP as eB,Zh as eC,ds as eD,op as eE,LS as eF,dl as eG,kR as eH,os as eI,Nw as eJ,ci as eK,qn as eL,rp as eM,uo as eN,Da as eO,Mi as eP,mT as eQ,ha as eR,Nc as eS,tu as eT,ec as eU,Ds as eV,Tr as eW,Hd as eX,I2 as eY,fl as eZ,Ao as e_,xl as ea,Kp as eb,VS as ec,Iu as ed,lt as ee,Eu as ef,Cn as eg,ip as eh,HS as ei,ul as ej,ER as ek,cE as el,Po as em,xR as en,ch as eo,cn as ep,zr as eq,Fr as er,hh as es,di as et,WS as eu,gh as ev,CE as ew,Oo as ex,mS as ey,Rl as ez,Gn as f,pp as f$,pl as f0,pm as f1,ml as f2,Yr as f3,ca as f4,Dl as f5,Sb as f6,fi as f7,km as f8,co as f9,X as fA,se as fB,Oc as fC,FS as fD,qp as fE,jh as fF,Do as fG,yh as fH,dn as fI,up as fJ,oi as fK,Yw as fL,oo as fM,mu as fN,dp as fO,cp as fP,Jc as fQ,hp as fR,gp as fS,ya as fT,Zw as fU,Ma as fV,Ea as fW,xa as fX,eh as fY,Jo as fZ,mp as f_,C_ as fa,Dn as fb,Ll as fc,mc as fd,Sn as fe,Tm as ff,Ow as fg,zs as fh,pc as fi,Aw as fj,Hl as fk,ir as fl,ra as fm,C5 as fn,_b as fo,Th as fp,yf as fq,Bw as fr,BS as fs,Jr as ft,Wb as fu,nf as fv,jS as fw,$o as fx,Uo as fy,_h as fz,ea as g,_n as g$,ka as g0,KR as g1,fp as g2,Cp as g3,vp as g4,qi as g5,th as g6,pu as g7,nh as g8,wp as g9,dc as gA,PP as gB,FP as gC,jP as gD,Lw as gE,Ww as gF,ss as gG,rS as gH,WR as gI,DR as gJ,Zp as gK,mE as gL,Yh as gM,Or as gN,HR as gO,Hw as gP,T6 as gQ,dr as gR,sC as gS,sr as gT,fx as gU,jw as gV,Fw as gW,Vr as gX,Zn as gY,tb as gZ,Al as g_,Sp as ga,ao as gb,bp as gc,lo as gd,sh as ge,Ld as gf,_p as gg,_i as gh,ft as gi,oy as gj,ay as gk,nn as gl,Qn as gm,Kn as gn,Ip as go,cr as gp,jd as gq,zh as gr,dS as gs,Yn as gt,Kd as gu,Bl as gv,In as gw,Vi as gx,qT as gy,uv as gz,mt as h,go as h$,zn as h0,id as h1,Rk as h2,tM as h3,gS as h4,qv as h5,vi as h6,JT as h7,LP as h8,fP as h9,cP as hA,Hy as hB,dP as hC,Ty as hD,Uy as hE,uP as hF,uS as hG,by as hH,yy as hI,My as hJ,xy as hK,lP as hL,Ry as hM,lS as hN,wy as hO,aS as hP,WP as hQ,LT as hR,V6 as hS,Uu as hT,zv as hU,Dw as hV,cl as hW,is as hX,Yo as hY,ey as hZ,YR as h_,BP as ha,of as hb,Gw as hc,Yx as hd,lp as he,lx as hf,Ei as hg,Ht as hh,qw as hi,NP as hj,Zi as hk,hP as hl,Y as hm,kw as hn,sn as ho,Rs as hp,M6 as hq,df as hr,rd as hs,TR as ht,Kv as hu,Kc as hv,Xo as hw,Nd as hx,zo as hy,Dy as hz,xt as i,VP as i0,l3 as i1,Hb as i2,HP as i3,Zr as i4,UP as i5,ot as i6,Fn as i7,to as i8,BC as i9,c6 as ia,ur as ib,em as j,fS as k,SE as l,Me as m,gt as n,Gt as o,Te as p,Ac as q,lm as r,Mr as s,au as t,Ky as u,zw as v,Ho as w,vl as x,Rh as y,oe as z};
