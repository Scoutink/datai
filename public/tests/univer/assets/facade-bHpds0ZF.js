import{aB as T,b as W,da as R,bx as g,au as F,ap as Z,as as k,ar as Y,at as q,L as G,Z as J,e as Q,b5 as X,cV as K,cX as ee,dd as te,di as re,I as ne,x as se,d as ie,p as oe,w as ae,z as ce,av as de,ay as he,az as le,aA as ue,br as pe,N as ge,bJ as me,c9 as ye,ct as ve,cE as fe,d2 as Ee,f$ as c,gf as v,b6 as p,d6 as l,i as f,co as u,A as _e,h as w,bi as A,bw as H,d4 as be,bB as M,C as Ce,cx as xe,cy as we,c1 as je,c2 as Re,cZ as Se,c_ as De,cW as Be,cm as Oe,fy as Te,d5 as He,cr as Ue,bm as h,bo as m,dc as Me}from"./index-BI8deSNo.js";var Pe=Object.defineProperty,Ie=(n,e,t)=>e in n?Pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,d=(n,e,t)=>Ie(n,typeof e!="symbol"?e+"":e,t);class U extends T{static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}}const E=Symbol("initializers"),P=Symbol("manualInit");class Ne extends T{constructor(e){if(super(),this._injector=e,!!this.constructor[P])return;const t=this,r=Object.getPrototypeOf(this)[E];r&&r.forEach(function(s){s.apply(t,[e])})}_initialize(e,...t){}_runInitializers(...e){const t=Object.getPrototypeOf(this)[E];t!=null&&t.length&&t.forEach(r=>r.apply(this,e))}static _enableManualInit(){this[P]=!0}static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{if(t==="_initialize"){let r=this.prototype[E];r||(r=[],this.prototype[E]=r),r.push(e.prototype._initialize)}else t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}}var Ae=(n,e,t,r)=>{for(var s=e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=o(s)||s);return s},$e=(n,e)=>(t,r)=>e(t,r,n);let x=class extends U{constructor(n,e){super(),this._blob=n,this._injector=e}copyBlob(){return this._injector.createInstance(x,this._blob)}getAs(n){const e=this.copyBlob();return e.setContentType(n),e}getDataAsString(n){return this._blob===null?Promise.resolve(""):n===void 0?this._blob.text():new Promise((e,t)=>{this._blob.arrayBuffer().then(r=>{const s=new TextDecoder(n).decode(r);e(s)}).catch(r=>{t(new Error(`Failed to read Blob as ArrayBuffer: ${r.message}`))})})}getBytes(){return this._blob?this._blob.arrayBuffer().then(n=>new Uint8Array(n)):Promise.reject(new Error("Blob is undefined or null."))}setBytes(n){return this._blob=new Blob([n.buffer]),this}setDataFromString(n,e){const t=e??"text/plain",r=new Blob([n],{type:t});return this._blob=r,this}getContentType(){var n;return(n=this._blob)==null?void 0:n.type}setContentType(n){var e;return this._blob=(e=this._blob)==null?void 0:e.slice(0,this._blob.size,n),this}};x=Ae([$e(1,h(m))],x);const $=class b{static get(){if(this._instance)return this._instance;const e=new b;return this._instance=e,e}static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}constructor(){for(const e in b.prototype)this[e]=b.prototype[e]}get AbsoluteRefType(){return W}get UniverInstanceType(){return R}get LifecycleStages(){return g}get DataValidationType(){return F}get DataValidationErrorStyle(){return Z}get DataValidationRenderMode(){return k}get DataValidationOperator(){return Y}get DataValidationStatus(){return q}get CommandType(){return G}get BaselineOffset(){return J}get BooleanNumber(){return Q}get HorizontalAlign(){return X}get TextDecoration(){return K}get TextDirection(){return ee}get VerticalAlign(){return te}get WrapStrategy(){return re}get BorderType(){return ne}get BorderStyleTypes(){return se}get AutoFillSeries(){return ie}get ColorType(){return oe}get CommonHideTypes(){return ae}get CopyPasteType(){return ce}get DeleteDirection(){return de}get DeveloperMetadataVisibility(){return he}get Dimension(){return le}get Direction(){return ue}get InterpolationPointType(){return pe}get LocaleType(){return ge}get MentionType(){return me}get ProtectionType(){return ye}get RelativeDate(){return ve}get SheetTypes(){return fe}get ThemeColorType(){return Ee}};d($,"_instance");let ze=$;const z=class C{static get(){if(this._instance)return this._instance;const e=new C;return this._instance=e,e}static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}constructor(){for(const e in C.prototype)this[e]=C.prototype[e]}get DocCreated(){return"DocCreated"}get DocDisposed(){return"DocDisposed"}get LifeCycleChanged(){return"LifeCycleChanged"}get Redo(){return"Redo"}get Undo(){return"Undo"}get BeforeRedo(){return"BeforeRedo"}get BeforeUndo(){return"BeforeUndo"}get CommandExecuted(){return"CommandExecuted"}get BeforeCommandExecute(){return"BeforeCommandExecute"}};d(z,"_instance");let Le=z;var Ve=(n,e,t,r)=>{for(var s=e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=o(s)||s);return s},I=(n,e)=>(t,r)=>e(t,r,n);let S=class extends U{constructor(n,e){super(),this._injector=n,this._lifecycleService=e}onStarting(n){return c(this._lifecycleService.lifecycle$.pipe(v(e=>e===g.Starting)).subscribe(n))}onReady(n){return c(this._lifecycleService.lifecycle$.pipe(v(e=>e===g.Ready)).subscribe(n))}onRendered(n){return c(this._lifecycleService.lifecycle$.pipe(v(e=>e===g.Rendered)).subscribe(n))}onSteady(n){return c(this._lifecycleService.lifecycle$.pipe(v(e=>e===g.Steady)).subscribe(n))}onBeforeUndo(n){return this._injector.get(p).beforeCommandExecuted(e=>{if(e.id===l.id){const t=this._injector.get(f).pitchTopUndoElement();t&&n(t)}})}onUndo(n){return this._injector.get(p).onCommandExecuted(e=>{if(e.id===l.id){const t=this._injector.get(f).pitchTopUndoElement();t&&n(t)}})}onBeforeRedo(n){return this._injector.get(p).beforeCommandExecuted(e=>{if(e.id===u.id){const t=this._injector.get(f).pitchTopRedoElement();t&&n(t)}})}onRedo(n){return this._injector.get(p).onCommandExecuted(e=>{if(e.id===u.id){const t=this._injector.get(f).pitchTopRedoElement();t&&n(t)}})}};S=Ve([I(0,h(m)),I(1,h(H))],S);var We=(n,e,t,r)=>{for(var s=e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=o(s)||s);return s},Fe=(n,e)=>(t,r)=>e(t,r,n);let D=class extends Ne{constructor(n,e){super(e),this.doc=n}};D=We([Fe(1,h(m))],D);class Ze{constructor(){d(this,"_eventRegistry",new Map),d(this,"_eventHandlerMap",new Map),d(this,"_eventHandlerRegisted",new Map)}_ensureEventRegistry(e){return this._eventRegistry.has(e)||this._eventRegistry.set(e,new Ue),this._eventRegistry.get(e)}registerEventHandler(e,t){const r=this._eventHandlerMap.get(e);return r?r.add(t):this._eventHandlerMap.set(e,new Set([t])),this._ensureEventRegistry(e).getData().length&&this._initEventHandler(e),c(()=>{var s,i,o,a;(s=this._eventHandlerMap.get(e))==null||s.delete(t),(o=(i=this._eventHandlerRegisted.get(e))==null?void 0:i.get(t))==null||o.dispose(),(a=this._eventHandlerRegisted.get(e))==null||a.delete(t)})}removeEvent(e,t){const r=this._ensureEventRegistry(e);if(r.delete(t),r.getData().length===0){const s=this._eventHandlerRegisted.get(e);s?.forEach(i=>i.dispose()),this._eventHandlerRegisted.delete(e)}}_initEventHandler(e){let t=this._eventHandlerRegisted.get(e);const r=this._eventHandlerMap.get(e);r&&(!t||t.size===0)&&(t=new Map,this._eventHandlerRegisted.set(e,t),r?.forEach(s=>{t?.set(s,c(s()))}))}addEvent(e,t){return this._ensureEventRegistry(e).add(t),this._initEventHandler(e),c(()=>this.removeEvent(e,t))}fireEvent(e,t){var r;return(r=this._eventRegistry.get(e))==null||r.getData().forEach(s=>{s(t)}),t.cancel}}var ke=(n,e,t,r)=>{for(var s=e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=o(s)||s);return s},N=(n,e)=>(t,r)=>e(t,r,n);let B=class extends U{constructor(n,e){super(),this._injector=n,this._userManagerService=e}getCurrentUser(){return this._userManagerService.getCurrentUser()}};B=ke([N(0,h(m)),N(1,h(Me))],B);const L=class V{static get(){if(this._instance)return this._instance;const e=new V;return this._instance=e,e}static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}get rectangle(){return Oe}get numfmt(){return Te}get tools(){return He}};d(L,"_instance");let Ye=L;var qe=(n,e,t,r)=>{for(var s=e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=o(s)||s);return s},_=(n,e)=>(t,r)=>e(t,r,n);const j=Symbol("initializers");let O=class extends T{constructor(e,t,r,s){super(),d(this,"_eventRegistry",new Ze),d(this,"registerEventHandler",(o,a)=>this._eventRegistry.registerEventHandler(o,a)),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._lifecycleService=s,this.disposeWithMe(this.registerEventHandler(this.Event.LifeCycleChanged,()=>c(this._lifecycleService.lifecycle$.subscribe(o=>{this.fireEvent(this.Event.LifeCycleChanged,{stage:o})})))),this._initUnitEvent(this._injector),this._initBeforeCommandEvent(this._injector),this._initCommandEvent(this._injector),this._injector.onDispose(()=>{this.dispose()});const i=Object.getPrototypeOf(this)[j];if(i){const o=this;i.forEach(function(a){a.apply(o,[e])})}}static newAPI(e){return(e instanceof _e?e.__getInjector():e).createInstance(O)}_initialize(e){}static extend(e){Object.getOwnPropertyNames(e.prototype).forEach(t=>{if(t==="_initialize"){let r=this.prototype[j];r||(r=[],this.prototype[j]=r),r.push(e.prototype._initialize)}else t!=="constructor"&&(this.prototype[t]=e.prototype[t])}),Object.getOwnPropertyNames(e).forEach(t=>{t!=="prototype"&&t!=="name"&&t!=="length"&&(this[t]=e[t])})}_initCommandEvent(e){const t=e.get(p);this.disposeWithMe(this.registerEventHandler(this.Event.Redo,()=>t.onCommandExecuted(r=>{const{id:s,type:i,params:o}=r;if(r.id===u.id){const a={id:s,type:i,params:o};this.fireEvent(this.Event.Redo,a)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.Undo,()=>t.onCommandExecuted(r=>{const{id:s,type:i,params:o}=r;if(r.id===l.id){const a={id:s,type:i,params:o};this.fireEvent(this.Event.Undo,a)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.CommandExecuted,()=>t.onCommandExecuted((r,s)=>{const{id:i,type:o,params:a}=r;if(r.id!==u.id&&r.id!==l.id){const y={id:i,type:o,params:a,options:s};this.fireEvent(this.Event.CommandExecuted,y)}})))}_initBeforeCommandEvent(e){const t=e.get(p);this.disposeWithMe(this.registerEventHandler(this.Event.BeforeRedo,()=>t.beforeCommandExecuted(r=>{const{id:s,type:i,params:o}=r;if(r.id===u.id){const a={id:s,type:i,params:o};if(this.fireEvent(this.Event.BeforeRedo,a),a.cancel)throw new w}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeUndo,()=>t.beforeCommandExecuted(r=>{const{id:s,type:i,params:o}=r;if(r.id===l.id){const a={id:s,type:i,params:o};if(this.fireEvent(this.Event.BeforeUndo,a),a.cancel)throw new w}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeCommandExecute,()=>t.beforeCommandExecuted((r,s)=>{const{id:i,type:o,params:a}=r;if(r.id!==u.id&&r.id!==l.id){const y={id:i,type:o,params:a,options:s};if(this.fireEvent(this.Event.BeforeCommandExecute,y),y.cancel)throw new w}})))}_initUnitEvent(e){const t=e.get(A);this.disposeWithMe(this.registerEventHandler(this.Event.DocDisposed,()=>t.unitDisposed$.subscribe(r=>{r.type===R.UNIVER_DOC&&this.fireEvent(this.Event.DocDisposed,{unitId:r.getUnitId(),unitType:r.type,snapshot:r.getSnapshot()})}))),this.disposeWithMe(this.registerEventHandler(this.Event.DocCreated,()=>t.unitAdded$.subscribe(r=>{if(r.type===R.UNIVER_DOC){const s=r,i=e.createInstance(D,s);this.fireEvent(this.Event.DocCreated,{unitId:r.getUnitId(),type:r.type,doc:i,unit:i})}})))}disposeUnit(e){return this._univerInstanceService.disposeUnit(e)}getCurrentLifecycleStage(){return this._injector.get(H).stage}undo(){return this._commandService.executeCommand(l.id)}redo(){return this._commandService.executeCommand(u.id)}toggleDarkMode(e){this._injector.get(be).setDarkMode(e)}loadLocales(e,t){this._injector.get(M).load({[e]:t})}setLocale(e){this._injector.get(M).setLocale(e)}onBeforeCommandExecute(e){return this._commandService.beforeCommandExecuted((t,r)=>{e(t,r)})}onCommandExecuted(e){return this._commandService.onCommandExecuted((t,r)=>{e(t,r)})}executeCommand(e,t,r){return this._commandService.executeCommand(e,t,r)}syncExecuteCommand(e,t,r){return this._commandService.syncExecuteCommand(e,t,r)}getHooks(){return this._injector.createInstance(S)}get Enum(){return ze.get()}get Event(){return Le.get()}get Util(){return Ye.get()}addEvent(e,t){if(!e||!t)throw new Error("Cannot add empty event");return this._eventRegistry.addEvent(e,t)}fireEvent(e,t){return this._eventRegistry.fireEvent(e,t)}getUserManager(){return this._injector.createInstance(B)}newBlob(){return this._injector.createInstance(x)}newColor(){return new Ce}newRichText(e){return xe.create(e)}newRichTextValue(e){return we.create(e)}newParagraphStyle(e){return je.create(e)}newParagraphStyleValue(e){return Re.create(e)}newTextStyle(e){return Se.create(e)}newTextStyleValue(e){return De.create(e)}newTextDecoration(e){return new Be(e)}};O=qe([_(0,h(m)),_(1,p),_(2,A),_(3,h(H))],O);export{U as $,x as D,Ye as M,ze as O,S as P,O as U,Ne as a,Le as j};
