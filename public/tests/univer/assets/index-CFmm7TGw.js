import{aB as S,da as g,dT as p,c5 as I,fk as U,g0 as b,bf as O,bi as N,bm as m,bo as C,b7 as j}from"./index-BI8deSNo.js";import{UnitDrawingService as y,IDrawingManagerService as M}from"./index-u4QJ_A0o.js";var R=Object.defineProperty,E=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t,r)=>E(e,typeof t!="symbol"?t+"":t,r);class D extends y{}const _=p("univer.doc.plugin.doc-drawing.service");var F=(e,t,r,n)=>{for(var a=t,i=e.length-1,s;i>=0;i--)(s=e[i])&&(a=s(a)||a);return a},o=(e,t)=>(r,n)=>t(r,n,e);const f="DOC_DRAWING_PLUGIN";let d=class extends S{constructor(e,t,r,n){super(),this._docDrawingService=e,this._drawingManagerService=t,this._resourceManagerService=r,this._univerInstanceService=n,this._init()}_init(){this._initSnapshot()}_initSnapshot(){const e=r=>{const n=this._univerInstanceService.getUnit(r,g.UNIVER_DOC);if(n){const a=n.getSnapshot().drawings,i=n.getSnapshot().drawingsOrder;return JSON.stringify({data:a??{},order:i??[]})}return""},t=r=>{if(!r)return{data:{},order:[]};try{return JSON.parse(r)}catch{return{data:{},order:[]}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({pluginName:f,businesses:[g.UNIVER_DOC],toJson:r=>e(r),parseJson:r=>t(r),onUnLoad:r=>{this._setDrawingDataForUnit(r,{data:{},order:[]})},onLoad:(r,n)=>{var a,i;this._setDrawingDataForUnit(r,{data:(a=n.data)!=null?a:{},order:(i=n.order)!=null?i:[]})}}))}_setDrawingDataForUnit(e,t){const r=this._univerInstanceService.getUnit(e);r!=null&&(r.resetDrawing(t.data,t.order),this.loadDrawingDataForUnit(e))}loadDrawingDataForUnit(e){const t=this._univerInstanceService.getUnit(e,g.UNIVER_DOC);if(!t)return!1;const r=e,n=t.getDrawings(),a=t.getDrawingsOrder();if(!n||!a)return!1;Object.keys(n).forEach(s=>{const w=n[s];n[s]={...w}});const i={[r]:{unitId:e,subUnitId:r,data:n,order:a}};return this._docDrawingService.registerDrawingData(e,i),this._drawingManagerService.registerDrawingData(e,i),!0}};d=F([o(0,_),o(1,M),o(2,O),o(3,N)],d);const G="docs-drawing.config",l={};var x=(e,t,r,n)=>{for(var a=t,i=e.length-1,s;i>=0;i--)(s=e[i])&&(a=s(a)||a);return a},h=(e,t)=>(r,n)=>t(r,n,e),c;let v=(c=class extends I{constructor(e=l,t,r){super(),this._config=e,this._injector=t,this._configService=r;const{...n}=U({},l,this._config);this._configService.setConfig(G,n)}onStarting(){[[d],[D],[_,{useClass:D}]].forEach(e=>this._injector.add(e)),b(this._injector,[[d]])}},u(c,"pluginName",f),u(c,"type",g.UNIVER_DOC),c);v=x([h(1,m(C)),h(2,j)],v);export{f as DOCS_DRAWING_PLUGIN,d as DocDrawingController,D as DocDrawingService,_ as IDocDrawingService,v as UniverDocsDrawingPlugin};
