import{L as M,bi as R,cz as le,dT as vt,da as I,ba as Jt,bY as Re,b6 as P,ea as Be,T as pt,dV as ei,aB as ye,g6 as Z,aC as $e,b9 as ce,aF as ti,bB as G,c5 as ii,fk as mt,fm as Ge,d_ as ni,el as ri,gm as ft,aH as fe,aR as _t,aZ as Ct,b5 as bt,dd as _e,aE as si,f$ as St,aN as ai,gf as oi,di as Qe,aP as li,X as ci,aA as U,aY as xt,a_ as di,bm as H,bo as He,i as ui,b7 as hi}from"./index-BI8deSNo.js";import{cL as gi,a0 as q,aa as k,bn as qe,aX as It,bK as Ne,b5 as vi,aG as Et,aU as pi,at as re,x as Y,bu as Je,bD as et}from"./index-DnxWP_AP.js";import{ObjectProvider as mi,SLIDE_KEY as J}from"./index-C2HNLJBA.js";import{DRAWING_IMAGE_ALLOW_IMAGE_LIST as fi,getImageSize as _i}from"./index-u4QJ_A0o.js";import{ac as Ci,bt as E,bw as bi,F as tt,a as it,b8 as nt,an as w,aK as Si,ao as ee,ba as te,aj as Rt,ar as xi,ad as Ii,w as Ei,al as Ri,ai as yi,a3 as wi,aa as ji}from"./index-BeEHzc6r.js";import{aj as m,ak as d,a4 as $,T as ae,ag as Ti,c as yt,Z as he,f as ne,a3 as wt,r as Oi}from"./index-BmfxE5KL.js";import{IEditorService as ke,DeleteLeftCommand as Mi,DocSelectionRenderService as rt,VIEWPORT_KEY as st,DOCS_COMPONENT_MAIN_LAYER_INDEX as Pi,MoveSelectionOperation as Ni,MoveCursorOperation as Ui,DOCS_VIEW_KEY as Vi}from"./index-C5GuqOxb.js";import{DocSkeletonManagerService as at,RichTextEditingMutation as Di,DocSelectionManagerService as Li}from"./index-GTTB9Gpg.js";import{t as ot}from"./takeUntil-BWepI5Pd.js";import"./shareReplay-DR2HpNHE.js";import"./isObservable-DLg0_x3m.js";import"./bufferTime-Dc1Jgi3q.js";var Ai=Object.defineProperty,Bi=(e,t,i)=>t in e?Ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,b=(e,t,i)=>Bi(e,typeof t!="symbol"?t+"":t,i),$i=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},Te=(e,t)=>(i,n)=>t(i,n,e);let oe=class extends le{constructor(e,t,i,n){super(),b(this,"_objectProvider",null),b(this,"_refreshThumb",ni(()=>{this.createThumbs()},300)),this._renderContext=e,this._injector=t,this._univerInstanceService=i,this._renderManagerService=n,this._objectProvider=this._injector.createInstance(mi),this._addNewRender()}_addNewRender(){const{unitId:e,engine:t,scene:i}=this._renderContext,n=this._getCurrUnitModel();if(!n)return;const r=t.onTransformChange$.subscribeEvent(()=>{this._scrollToCenter(),r?.unsubscribe()});t.onTransformChange$.subscribeEvent(()=>{setTimeout(()=>{this.createThumbs()},300)});const s=new qe(J.VIEW,i,{left:0,top:0,bottom:0,right:0,explicitViewportWidthSet:!1,explicitViewportHeightSet:!1,isWheelPreventDefaultX:!0});i.attachControl(),i.onMouseWheel$.subscribeEvent((o,c)=>{const l=o;if(l.ctrlKey){const u=Math.abs(l.deltaX);let g=u<40?.2:u<80?.4:.2;g*=l.deltaY>0?-1:1,i.scaleX<1&&(g/=2),i.scaleX+g>4?i.scale(4,4):i.scaleX+g<.1?i.scale(.1,.1):(l.deltaY>0,l.preventDefault())}else s.onMouseWheel(l,c)}),i.onFileLoaded$.subscribeEvent(()=>{this._refreshThumb()}),It.attachTo(s);const a=this._createSlide(i);this._renderContext.mainComponent=a,this._createSlidePages(n,a),this.createThumbs(),t.runRenderLoop(()=>{i.render()})}_scrollToCenter(){var e;const t=(e=this._currentRender())==null?void 0:e.scene,i=t?.getViewport(J.VIEW),n=this._getCenterPositionViewPort(t);if(!i||!n)return;const{left:r,top:s}=n,{x:a,y:o}=i.transViewportScroll2ScrollValue(r,s);i.scrollToBarPos({x:a,y:o})}_currentRender(){return Ne(I.UNIVER_SLIDE,this._univerInstanceService,this._renderManagerService)}_createSlide(e){const t=this._univerInstanceService.getCurrentUnitForType(I.UNIVER_SLIDE),{width:i,height:n}=e,r=t.getPageSize(),{width:s=100,height:a=100}=r,o=new vi(J.COMPONENT,{left:(i-s)/2,top:(n-a)/2,width:s,height:a,zIndex:10});return o.enableSelectedClipElement(),e.addObject(o),o}_addBackgroundRect(e,t){const i=this._univerInstanceService.getCurrentUnitForType(I.UNIVER_SLIDE).getPageSize(),{width:n=0,height:r=0}=i,s=new Et("canvas",{left:0,top:0,width:n,height:r,strokeWidth:1,stroke:"rgba(198,198,198,1)",fill:ri(t)||"rgba(255,255,255,1)",zIndex:0,evented:!1});e.addObject(s,0)}_getCenterPositionViewPort(e){if(!e)return{left:0,top:0};const{width:t,height:i}=e,n=e.getEngine(),r=n?.width||0,s=n?.height||0;return{left:(t-r)/2,top:(i-s)/2}}_thumbSceneRender(e,t){const i=this._renderManagerService.getRenderById(e);if(i==null)return;const{engine:n}=i;if(n==null)return;const{width:r,height:s}=t,{width:a=r,height:o=s}=n,c=n.getCanvas().getContext();t.renderToThumb(c,e,a/r,o/s)}_createSlidePages(e,t){const i=e.getPages(),n=e.getPageOrder();if(!(!i||!n)&&n.length!==0){for(let r=0,s=n.length;r<s;r++){const a=n[r];this.createPageScene(a,i[a]),this._createThumb(a)}t.activeFirstPage()}}_createThumb(e){this._renderManagerService.createRender(e)}_getCurrUnitModel(){return this._renderContext.unit}activePage(e){let t=e;const i=this._getCurrUnitModel();let n;if(t)n=i.getPage(t);else{const o=i.getPages(),c=i.getPageOrder();if(c==null||o==null)return;n=o[c[0]],t=n.id}const r=this._currentRender();if(n==null||r==null||r.mainComponent==null)return;const{id:s}=n,a=r.mainComponent;if(i.setActivePage(n),a!=null&&a.hasPage(s)){a.changePage(s);return}this.createPageScene(s,n)}createThumbs(){const e=this._getCurrUnitModel().getPageOrder(),t=this._currentRender();if(!(!e||!t)&&e.length!==0)for(let i=0,n=e.length;i<n;i++){const r=e[i];this._thumbSceneRender(r,t.mainComponent)}}createPageScene(e,t){const i=this._renderContext;if(!i||!this._objectProvider)return;const{scene:n,mainComponent:r}=i,s=r,{width:a,height:o}=s,c=new pi(e,s,{width:a,height:o});new qe(`PageViewer_${e}`,c,{left:0,top:0,bottom:0,right:0,explicitViewportWidthSet:!1,explicitViewportHeightSet:!1}).closeClip();const{pageElements:l,pageBackgroundFill:u}=t,g=this._objectProvider.convertToRenderObjects(l,n);if(!g||!s)return;this._addBackgroundRect(c,u),c.addObjects(g),c.initTransformer(),g.forEach(f=>{c.attachTransformerTo(f)});const v=c.getTransformer();return v?.changeEnd$.subscribe(()=>{this._thumbSceneRender(e,s)}),v?.clearControl$.subscribe(()=>{this._thumbSceneRender(e,s)}),s.addPageScene(c),c}getPageRenderUnit(e){const t=this._renderContext.mainComponent.getSubScenes().get(e),{engine:i,unit:n}=this._renderContext;return{scene:t,engine:i,unit:n}}createObjectToPage(e,t){const{scene:i}=this.getPageRenderUnit(t);if(!i||!this._objectProvider)return;const n=this._objectProvider.convertToRenderObject(e,i);if(n)return i.addObject(n),i.attachTransformerTo(n),i.getLayer().makeDirty(),n}setObjectActiveByPage(e,t){const{scene:i}=this.getPageRenderUnit(t);if(!i)return;const n=i.getTransformer();n?.activeAnObject(e)}removeObjectById(e,t){const{scene:i}=this.getPageRenderUnit(t);if(!i)return;i.removeObject(e);const n=i.getTransformer();n?.clearControls()}appendPage(){const e=this._getCurrUnitModel(),t=e.getBlankPage(),i=this._currentRender();if(t==null||i==null||i.mainComponent==null)return;const{id:n}=t,r=i.mainComponent,s=this.createPageScene(n,t);r&&s&&r.addPageScene(s),e.appendPage(t),e.setActivePage(t)}};oe=$i([Te(1,H(He)),Te(2,R),Te(3,k)],oe);var Hi=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},ki=(e,t)=>(i,n)=>t(i,n,e);let j=class extends le{constructor(e){super(),this._renderManagerService=e}_getSlideRenderControllerFromRenderUnit(e){return this._renderManagerService.getRenderById(e).with(oe)}createThumbs(e){this._getSlideRenderControllerFromRenderUnit(e).createThumbs()}activePage(e,t){this._getSlideRenderControllerFromRenderUnit(t).activePage(e)}getRenderUnitByPageId(e,t){return this._getSlideRenderControllerFromRenderUnit(t).getPageRenderUnit(e)}createObjectToPage(e,t,i){return this._getSlideRenderControllerFromRenderUnit(i).createObjectToPage(e,t)}setObjectActiveByPage(e,t,i){return this._getSlideRenderControllerFromRenderUnit(i).setObjectActiveByPage(e,t)}removeObjectById(e,t,i){this._getSlideRenderControllerFromRenderUnit(i).removeObjectById(e,t)}appendPage(e){this._getSlideRenderControllerFromRenderUnit(e).appendPage()}};j=Hi([ki(0,k)],j);const jt={id:"slide.operation.activate-slide",type:M.OPERATION,handler:(e,t)=>{var i,n;const r=t.unitId,s=e.get(j),a=e.get(R).getUnit(r),o=(i=a?.getActivePage())==null?void 0:i.id;if(!o)return!1;const c=s.getRenderUnitByPageId(o,r);if(!c)return!1;const l=(n=c.scene)==null?void 0:n.getTransformer();return l&&l.clearControls(),s.activePage(t.id,r),!0}},Tt={id:"slide.operation.append-slide",type:M.OPERATION,handler:(e,t)=>{const i=t.unitId;return e.get(R).getUnit(i)?(e.get(j).appendPage(i),!0):!1}},Ot={id:"slide.operation.delete-element",type:M.OPERATION,handler:(e,t)=>{if(!(t!=null&&t.id))return!1;const i=t.unitId,n=e.get(R).getUnit(i);if(!n)return!1;const r=n.getActivePage();return delete r.pageElements[t.id],n.updatePage(r.id,r),e.get(j).removeObjectById(t.id,r.id,i),!0}},Fe={id:"slide.command.insert-float-image",type:M.COMMAND,handler:async(e,t)=>{var i;const n=e.get(R),r=(i=n.getCurrentUnitForType(I.UNIVER_SLIDE))==null?void 0:i.getUnitId();if(!r)return!1;const s=await e.get(Ci).openFile({multiple:!0,accept:fi.map(N=>`.${N.replace("image/","")}`).join(",")});if(s.length!==1)return!1;const a=await e.get(Jt).saveImage(s[0]);if(!a)return!1;const{imageId:o,imageSourceType:c,source:l,base64Cache:u}=a,{width:g,height:v,image:f}=await _i(u||""),_=n.getUnit(r);if(!_)return!1;const p=_.getActivePage(),h=Object.values(p.pageElements),x=h!=null&&h.length?Math.max(...h.map(N=>N.zIndex)):20,S={id:o,zIndex:x+1,left:0,top:0,width:g,height:v,title:"",description:"",type:Re.IMAGE,image:{imageProperties:{contentUrl:u,imageSourceType:c,source:l,base64Cache:u,image:f}}};p.pageElements[o]=S,_.updatePage(p.id,p);const y=e.get(j),T=y.createObjectToPage(S,p.id,r);return T&&y.setObjectActiveByPage(T,p.id,r),!0}};function A({ref:e,...t}){const{icon:i,id:n,className:r,extend:s,...a}=t,o=`univerjs-icon univerjs-icon-${n} ${r||""}`.trim(),c=m.useRef(`_${zi()}`);return Mt(i,`${n}`,{defIds:i.defIds,idSuffix:c.current},{ref:e,className:o,...a},s)}function Mt(e,t,i,n,r){return m.createElement(e.tag,{key:t,...Fi(e,i,r),...n},(Wi(e,i).children||[]).map((s,a)=>Mt(s,`${t}-${e.tag}-${a}`,i,void 0,r)))}function Fi(e,t,i){const n={...e.attrs};i!=null&&i.colorChannel1&&n.fill==="colorChannel1"&&(n.fill=i.colorChannel1),e.tag==="mask"&&n.id&&(n.id=n.id+t.idSuffix),Object.entries(n).forEach(([s,a])=>{s==="mask"&&typeof a=="string"&&(n[s]=a.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))});const{defIds:r}=t;return!r||r.length===0||(e.tag==="use"&&n["xlink:href"]&&(n["xlink:href"]=n["xlink:href"]+t.idSuffix),Object.entries(n).forEach(([s,a])=>{typeof a=="string"&&(n[s]=a.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))})),n}function Wi(e,t){var i;const{defIds:n}=t;return!n||n.length===0?e:e.tag==="defs"&&(i=e.children)!=null&&i.length?{...e,children:e.children.map(r=>typeof r.attrs.id=="string"&&n&&n.includes(r.attrs.id)?{...r,attrs:{...r.attrs,id:r.attrs.id+t.idSuffix}}:r)}:e}function zi(){return Math.random().toString(36).substring(2,8)}A.displayName="UniverIcon";const Ki={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.0045 4.4334C14.8881 4.4334 15.6045 3.71705 15.6045 2.8334C15.6045 1.94974 14.8881 1.2334 14.0045 1.2334H3.70449C2.82084 1.2334 2.10449 1.94974 2.10449 2.8334C2.10449 3.71705 2.82084 4.4334 3.70449 4.4334H14.0045ZM14.4045 2.8334C14.4045 3.05431 14.2254 3.2334 14.0045 3.2334H3.70449C3.48358 3.2334 3.30449 3.05431 3.30449 2.8334C3.30449 2.61248 3.48358 2.4334 3.70449 2.4334H14.0045C14.2254 2.4334 14.4045 2.61249 14.4045 2.8334Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.1544 8.5999C15.038 8.5999 15.7544 7.88356 15.7544 6.9999C15.7544 6.11625 15.038 5.3999 14.1544 5.3999H3.85439C2.97074 5.3999 2.25439 6.11625 2.25439 6.9999C2.25439 7.88356 2.97074 8.5999 3.85439 8.5999H14.1544ZM14.5544 6.9999C14.5544 7.22082 14.3753 7.3999 14.1544 7.3999H3.85439C3.63348 7.3999 3.45439 7.22082 3.45439 6.9999C3.45439 6.77899 3.63348 6.5999 3.85439 6.5999H14.1544C14.3753 6.5999 14.5544 6.77899 14.5544 6.9999Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.57975 14.5902L6.58023 12.5907C6.34591 12.3564 6.34591 11.9765 6.58023 11.7421C6.81454 11.5078 7.19444 11.5078 7.42876 11.7421L8.40449 12.7179V10.1664C8.40449 9.83504 8.67312 9.56641 9.00449 9.56641C9.33586 9.56641 9.60449 9.83504 9.60449 10.1664V12.7179L10.5802 11.7421C10.8145 11.5078 11.1944 11.5078 11.4288 11.7421C11.6631 11.9765 11.6631 12.3564 11.4288 12.5907L9.42923 14.5902"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.57975 14.5902C8.58121 14.5917 8.58268 14.5931 8.58416 14.5946C8.64077 14.6502 8.70566 14.6923 8.77482 14.7209C8.84557 14.7502 8.92314 14.7664 9.00449 14.7664C9.08585 14.7664 9.16342 14.7502 9.23416 14.7209C9.30332 14.6923 9.36821 14.6502 9.42482 14.5946"}}]},Pt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"bottom-icon",ref:t,icon:Ki}))});Pt.displayName="BottomIcon";const Xi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"g",attrs:{clipPath:"url(#graph-icon_clip0_1293_28)"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M6.29541 11.1896C3.83208 10.7489 1.9624 8.59552 1.9624 6.00544C1.9624 3.09673 4.32036 0.73877 7.22907 0.73877C9.93483 0.73877 12.164 2.77918 12.4619 5.40527H13.5621C14.998 5.40527 16.1621 6.56933 16.1621 8.00527V12.6719C16.1621 14.1079 14.998 15.2719 13.5621 15.2719H8.89541C7.45947 15.2719 6.29541 14.1079 6.29541 12.6719V11.1896ZM3.1624 6.00544C3.1624 3.75947 4.98311 1.93877 7.22907 1.93877C9.27112 1.93877 10.9616 3.44388 11.2518 5.40527H8.89541C7.45947 5.40527 6.29541 6.56933 6.29541 8.00527V9.96442C4.49946 9.5425 3.1624 7.93012 3.1624 6.00544ZM7.49541 8.00527C7.49541 7.23207 8.12221 6.60527 8.89541 6.60527H13.5621C14.3353 6.60527 14.9621 7.23207 14.9621 8.00527V12.6719C14.9621 13.4451 14.3353 14.0719 13.5621 14.0719H8.89541C8.12221 14.0719 7.49541 13.4451 7.49541 12.6719V8.00527Z",fillRule:"evenodd",clipRule:"evenodd"}}]},{tag:"defs",attrs:{},children:[{tag:"clipPath",attrs:{id:"graph-icon_clip0_1293_28"},children:[{tag:"path",attrs:{fill:"white",d:"M0 0H16V16H0z",transform:"translate(.9)"}}]}]}],defIds:["graph-icon_clip0_1293_28"]},Nt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"graph-icon",ref:t,icon:Xi}))});Nt.displayName="GraphIcon";const Zi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},We=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"more-down-icon",ref:t,icon:Zi}))});We.displayName="MoreDownIcon";const Yi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.25 2.96401C1.25 3.84767 1.96634 4.56401 2.85 4.56401H13.15C14.0337 4.56401 14.75 3.84767 14.75 2.96401C14.75 2.08036 14.0337 1.36401 13.15 1.36401H2.85C1.96635 1.36401 1.25 2.08036 1.25 2.96401ZM2.85 3.36401C2.62909 3.36401 2.45 3.18493 2.45 2.96401C2.45 2.7431 2.62909 2.56401 2.85 2.56401H13.15C13.3709 2.56401 13.55 2.7431 13.55 2.96401C13.55 3.18493 13.3709 3.36401 13.15 3.36401H2.85Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.57564 11.6118C5.80995 11.3774 6.18985 11.3774 6.42417 11.6118L7.3999 12.5875V6.36951C7.3999 6.03814 7.66853 5.76951 7.9999 5.76951C8.33127 5.76951 8.5999 6.03814 8.5999 6.36951V12.5875L9.57564 11.6118C9.80995 11.3774 10.1899 11.3774 10.4242 11.6118C10.6585 11.8461 10.6585 12.226 10.4242 12.4603L8.4324 14.452C8.32324 14.5655 8.16982 14.6362 7.9999 14.6362C7.82998 14.6362 7.67655 14.5655 7.56739 14.452L5.57564 12.4603C5.34132 12.226 5.34132 11.8461 5.57564 11.6118Z"}}]},Ut=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"move-down-icon",ref:t,icon:Yi}))});Ut.displayName="MoveDownIcon";const Gi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.25 13.036C1.25 12.1523 1.96634 11.436 2.85 11.436H13.15C14.0337 11.436 14.75 12.1523 14.75 13.036C14.75 13.9196 14.0337 14.636 13.15 14.636H2.85C1.96635 14.636 1.25 13.9196 1.25 13.036ZM2.85 12.636C2.62909 12.636 2.45 12.8151 2.45 13.036C2.45 13.2569 2.62909 13.436 2.85 13.436H13.15C13.3709 13.436 13.55 13.2569 13.55 13.036C13.55 12.8151 13.3709 12.636 13.15 12.636H2.85Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.57564 4.38825C5.80995 4.62256 6.18985 4.62256 6.42417 4.38825L7.3999 3.41251V9.63049C7.3999 9.96186 7.66853 10.2305 7.9999 10.2305C8.33127 10.2305 8.5999 9.96186 8.5999 9.63049V3.41251L9.57564 4.38825C9.80995 4.62256 10.1899 4.62256 10.4242 4.38825C10.6585 4.15393 10.6585 3.77403 10.4242 3.53972L8.4324 1.54796C8.32324 1.43445 8.16982 1.36382 7.9999 1.36382C7.82998 1.36382 7.67655 1.43446 7.56739 1.54797L5.57564 3.53972C5.34132 3.77403 5.34132 4.15393 5.57564 4.38825Z"}}]},Vt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"move-up-icon",ref:t,icon:Gi}))});Vt.displayName="MoveUpIcon";const Qi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"g",attrs:{fill:"currentColor",clipPath:"url(#text-icon_clip0_1293_26)"},children:[{tag:"path",attrs:{d:"M2.22891 2.07227C1.89754 2.07227 1.62891 2.34089 1.62891 2.67227C1.62891 3.00364 1.89754 3.27227 2.22891 3.27227H6.29541V14.0056C6.29541 14.337 6.56404 14.6056 6.89541 14.6056C7.22678 14.6056 7.49541 14.337 7.49541 14.0056V3.27227H11.5622C11.8936 3.27227 12.1622 3.00364 12.1622 2.67227C12.1622 2.34089 11.8936 2.07227 11.5622 2.07227H2.22891Z"}},{tag:"path",attrs:{d:"M10.2289 6.40552C9.89754 6.40552 9.62891 6.67415 9.62891 7.00552C9.62891 7.33689 9.89754 7.60552 10.2289 7.60552H12.2954V14.0055C12.2954 14.3369 12.564 14.6055 12.8954 14.6055C13.2268 14.6055 13.4954 14.3369 13.4954 14.0055V7.60552H15.5622C15.8936 7.60552 16.1622 7.33689 16.1622 7.00552C16.1622 6.67415 15.8936 6.40552 15.5622 6.40552H10.2289Z"}}]},{tag:"defs",attrs:{},children:[{tag:"clipPath",attrs:{id:"text-icon_clip0_1293_26"},children:[{tag:"path",attrs:{fill:"white",d:"M0 0H16V16H0z",transform:"translate(.9)"}}]}]}],defIds:["text-icon_clip0_1293_26"]},Dt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"text-icon",ref:t,icon:Qi}))});Dt.displayName="TextIcon";const qi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.82994 1.40913C7.88746 1.35161 7.95376 1.30821 8.02453 1.27893C8.09527 1.24959 8.17285 1.2334 8.2542 1.2334C8.33555 1.2334 8.41313 1.24959 8.48387 1.27893C8.55464 1.30821 8.62094 1.35161 8.67846 1.40913L10.6785 3.40913C10.9128 3.64345 10.9128 4.02335 10.6785 4.25766C10.4441 4.49198 10.0642 4.49198 9.82994 4.25766L8.8542 3.28193V5.8334C8.8542 6.16477 8.58557 6.4334 8.2542 6.4334C7.92283 6.4334 7.6542 6.16477 7.6542 5.8334V3.28193L6.67846 4.25766C6.44415 4.49198 6.06425 4.49198 5.82994 4.25766C5.59562 4.02335 5.59562 3.64345 5.82994 3.40913L7.82994 1.40913Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.50439 9C1.50439 8.11634 2.22074 7.4 3.10439 7.4H13.4044C14.288 7.4 15.0044 8.11634 15.0044 9C15.0044 9.88366 14.2881 10.6 13.4044 10.6H3.1044C2.22074 10.6 1.50439 9.88366 1.50439 9ZM3.10439 8.6C2.88348 8.6 2.70439 8.77909 2.70439 9C2.70439 9.22091 2.88348 9.4 3.1044 9.4H13.4044C13.6253 9.4 13.8044 9.22091 13.8044 9C13.8044 8.77909 13.6253 8.6 13.4044 8.6H3.10439Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.6543 13.1665C1.6543 12.2828 2.37064 11.5665 3.2543 11.5665H13.5543C14.438 11.5665 15.1543 12.2828 15.1543 13.1665C15.1543 14.0502 14.438 14.7665 13.5543 14.7665H3.2543C2.37064 14.7665 1.6543 14.0502 1.6543 13.1665ZM3.2543 12.7665C3.03338 12.7665 2.8543 12.9456 2.8543 13.1665C2.8543 13.3874 3.03338 13.5665 3.2543 13.5665H13.5543C13.7752 13.5665 13.9543 13.3874 13.9543 13.1665C13.9543 12.9456 13.7752 12.7665 13.5543 12.7665H3.2543Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Lt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"topmost-icon",ref:t,icon:qi}))});Lt.displayName="TopmostIcon";const Ji={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",fillRule:"evenodd",clipRule:"evenodd"}}]},At=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"autofill-double-icon",ref:t,icon:Ji}))});At.displayName="AutofillDoubleIcon";const en={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}}]},Bt=m.forwardRef(function(e,t){return m.createElement(A,Object.assign({},e,{id:"paint-bucket-double-icon",ref:t,icon:en}))});Bt.displayName="PaintBucketDoubleIcon";const L={id:"slide.operation.update-element",type:M.OPERATION,handler:(e,t)=>{const{oKey:i,props:n}=t,r=e.get(R),s=t?.unitId,a=r.getUnit(s);if(!a)return!1;const o=a.getActivePage();return o.pageElements[i]=mt(o.pageElements[i],n),a.updatePage(o.id,o),!0}};function tn(e){const{pageId:t,unitId:i}=e,n=E(G),r=E(j),s=E(P),a=r.getRenderUnitByPageId(t,i),o=a?.scene;if(!o)return null;const c=o.getTransformer();if(!c)return null;const l=c.getSelectedObjectMap().values().next().value;if(!l)return null;const u=g=>{const v=o.getAllObjects(),[f,_]=v.reduce(([h,x],S)=>{const y=S.zIndex,T=y<h?y:h,N=y>x?y:x;return[T,N]},[0,0]);let p=l.zIndex;g===3?p=f-1:g===2?p=_+1:g===0?p=l.zIndex+1:g===1&&(p=l.zIndex-1),l.setProps({zIndex:p}),s.executeCommand(L.id,{unitId:i,oKey:l?.oKey,props:{zIndex:p}})};return d.jsxs("div",{className:"univer-relative univer-w-full",children:[d.jsx("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:d.jsx("div",{className:"univer-w-full univer-text-left univer-text-gray-600 dark:!univer-text-gray-200",children:d.jsx("div",{children:n.t("image-panel.arrange.title")})})}),d.jsxs("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:[d.jsx("div",{className:"univer-w-1/2",children:d.jsx(he,{onClick:()=>{u(0)},children:d.jsxs("span",{className:"univer-flex univer-items-center univer-gap-1",children:[d.jsx(Vt,{}),n.t("image-panel.arrange.forward")]})})}),d.jsx("div",{className:"univer-w-1/2",children:d.jsx(he,{onClick:()=>{u(1)},children:d.jsxs("span",{className:"univer-flex univer-items-center univer-gap-1",children:[d.jsx(Ut,{}),n.t("image-panel.arrange.backward")]})})})]}),d.jsxs("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:[d.jsx("div",{className:"univer-w-1/2",children:d.jsx(he,{onClick:()=>{u(2)},children:d.jsxs("span",{className:"univer-flex univer-items-center univer-gap-1",children:[d.jsx(Lt,{}),n.t("image-panel.arrange.front")]})})}),d.jsx("div",{className:"univer-w-1/2",children:d.jsx(he,{onClick:()=>{u(3)},children:d.jsxs("span",{className:"univer-flex univer-items-center univer-gap-1",children:[d.jsx(Pt,{}),n.t("image-panel.arrange.back")]})})})]})]})}function nn(e){var t,i;const{pageId:n,unitId:r}=e,s=E(G),a=E(j),o=E(P),c=a.getRenderUnitByPageId(n,r),l=c?.scene;if(!l)return null;const u=l.getTransformer();if(!u)return null;const g=u.getSelectedObjectMap().values().next().value;if(!g)return null;const[v,f]=m.useState((i=(t=g.fill)==null?void 0:t.toString())!=null?i:"");function _(p){g?.setProps({fill:p}),o.executeCommand(L.id,{unitId:r,oKey:g?.oKey,props:{shape:{shapeProperties:{shapeBackgroundFill:{rgb:p}}}}}),f(p)}return d.jsx("div",{className:$("univer-relative univer-bottom-0 univer-mt-5 univer-w-full",wt),children:d.jsxs("div",{className:"univer-relative univer-w-full",children:[d.jsx("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:d.jsx("div",{className:"univer-w-full univer-text-left univer-text-gray-600 dark:!univer-text-gray-200",children:d.jsx("div",{children:s.t("slide.panel.fill.title")})})}),d.jsx("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:d.jsx("div",{className:"univer-w-1/2",children:d.jsx(yt,{overlay:d.jsx("div",{className:"univer-rounded-lg univer-p-4",children:d.jsx(Oi,{value:"#fff",onChange:_})}),children:d.jsxs("a",{className:"univer-flex univer-cursor-pointer univer-items-center univer-gap-1",children:[d.jsx(Bt,{className:"univer-fill-primary-600"}),d.jsx(We,{})]})})})})]})})}function rn(e){const{pageId:t,unitId:i}=e,n=E(G),r=E(j),s=E(P),a=r.getRenderUnitByPageId(t,i),o=a?.scene;if(!o)return null;const c=o.getTransformer();if(!c)return null;const l=c.getSelectedObjectMap().values().next().value;if(!l)return null;const{width:u=0,height:g=0,left:v=0,top:f=0,angle:_=0}=l,[p,h]=m.useState(u),[x,S]=m.useState(g),[y,T]=m.useState(v),[N,O]=m.useState(f),[B,K]=m.useState(_),D=C=>{const{objects:je}=C,ie=je.values().next().value,{width:Zt=0,height:Yt=0,left:Gt=0,top:Qt=0,angle:qt=0}=ie;h(Zt),S(Yt),T(Gt),O(Qt),K(qt)};m.useEffect(()=>{const C=c.changeStart$.subscribe(ie=>{D(ie)}),je=c.changing$.subscribe(ie=>{D(ie)});return()=>{je.unsubscribe(),C.unsubscribe()}},[]);function F(C){!C||!l||(s.executeCommand(L.id,{pageId:t,oKey:l.oKey,props:{width:C}}),l?.resize(C,l.height),h(C),c?.refreshControls())}function W(C){!C||!l||(s.executeCommand(L.id,{pageId:t,oKey:l.oKey,props:{height:C}}),l?.resize(l.width,C),S(C),c?.refreshControls())}function we(C){!C||!l||(s.executeCommand(L.id,{pageId:t,oKey:l.oKey,props:{left:C}}),l?.translate(C,l.top),T(C),c?.refreshControls())}function de(C){!C||!l||(s.executeCommand(L.id,{pageId:t,oKey:l.oKey,props:{right:C}}),l?.translate(l.left,C),O(C),c?.refreshControls())}function ue(C){!C||!l||(s.executeCommand(L.id,{pageId:t,oKey:l.oKey,props:{angle:C}}),l?.transformByState({angle:C}),K(C),c?.refreshControls())}return d.jsxs("div",{className:$("univer-grid univer-gap-2 univer-py-2 univer-text-gray-400",wt),children:[d.jsx("header",{className:"univer-text-gray-600 dark:!univer-text-gray-200",children:d.jsx("div",{children:n.t("image-panel.transform.title")})}),d.jsxs("div",{className:"univer-grid univer-grid-cols-3 univer-gap-2 [&>div]:univer-grid [&>div]:univer-gap-2",children:[d.jsxs("div",{children:[d.jsx("span",{children:n.t("image-panel.transform.width")}),d.jsx(ne,{min:1,value:p,onChange:C=>{F(C)}})]}),d.jsxs("div",{children:[d.jsx("span",{children:n.t("image-panel.transform.height")}),d.jsx(ne,{min:1,value:x,onChange:C=>{W(C)}})]})]}),d.jsxs("div",{className:"univer-relative univer-mt-2.5 univer-flex univer-h-full",children:[d.jsxs("div",{children:[d.jsx("span",{children:n.t("image-panel.transform.x")}),d.jsx(ne,{min:0,precision:1,value:y,onChange:C=>{we(C)}})]}),d.jsxs("div",{children:[d.jsx("span",{children:n.t("image-panel.transform.y")}),d.jsx(ne,{min:0,precision:1,value:N,onChange:C=>{de(C)}})]}),d.jsxs("div",{children:[d.jsx("span",{children:n.t("image-panel.transform.rotate")}),d.jsx(ne,{precision:1,value:B,onChange:ue})]})]})]})}const me="COMPONENT_SLIDE_SIDEBAR";function sn(){var e,t,i;const n=E(R),r=E(j),s=n.getCurrentUnitForType(I.UNIVER_SLIDE),a=(e=s?.getActivePage())==null?void 0:e.id,o=((t=n.getFocusedUnit())==null?void 0:t.getUnitId())||"";if(!a||!o)return null;const c=(i=r.getRenderUnitByPageId(a,o).scene)==null?void 0:i.getTransformer();if(!c)return null;const l=c.getSelectedObjectMap().values().next().value;return l?d.jsxs("section",{className:"univer-p-2 univer-text-center univer-text-sm",children:[d.jsx(tn,{pageId:a,unitId:o}),d.jsx(rn,{pageId:a,unitId:o}),l.objectType===re.RECT&&d.jsx(nn,{pageId:a,unitId:o})]}):null}const ze={id:"slide.command.insert-float-shape.rectangle",type:M.COMMAND,handler:async e=>{var t;const i=e.get(P),n=(t=e.get(R).getFocusedUnit())==null?void 0:t.getUnitId();return i.executeCommand($t.id,{unitId:n})}},$t={id:"slide.operation.insert-float-shape.rectangle",type:M.OPERATION,handler:async(e,t)=>{const i=Be(6),n=e.get(R),r=t.unitId,s=n.getUnit(r);if(!s)return!1;const a=s.getActivePage(),o=Object.values(a.pageElements),c=o!=null&&o.length?Math.max(...o.map(v=>v.zIndex)):20,l={id:i,zIndex:c+1,left:378,top:142,width:250,height:250,title:i,description:"",type:Re.SHAPE,shape:{shapeType:pt.Rect,text:"",shapeProperties:{shapeBackgroundFill:{rgb:"rgb(0,0,255)"}}}};a.pageElements[i]=l,s.updatePage(a.id,a);const u=e.get(j),g=u.createObjectToPage(l,a.id,r);return g&&u.setObjectActiveByPage(g,a.id,r),!0}},Ue={id:"sidebar.operation.slide-shape",type:M.COMMAND,handler:async(e,t)=>{const{visible:i,objectType:n}=t,r=e.get(Rt),s=e.get(G);let a="",o="";return n===re.RECT?(a="slide.sidebar.shape",o=me):n===re.IMAGE?(a="slide.sidebar.image",o=me):n===re.RICH_TEXT&&(a="slide.sidebar.text",o=me),i?r.open({header:{title:s.t(a)},children:{label:o},onClose:()=>{},width:360}):r.close(),!0}},Ke={id:"slide.command.insert-float-shape.ellipse",type:M.COMMAND,handler:async e=>{var t;const i=e.get(P),n=(t=e.get(R).getFocusedUnit())==null?void 0:t.getUnitId();return i.executeCommand(Ht.id,{unitId:n})}},Ht={id:"slide.operation.insert-float-shape.ellipse",type:M.OPERATION,handler:async(e,t)=>{const i=Be(6),n=e.get(R),r=t.unitId,s=n.getUnit(r);if(!s)return!1;const a=s.getActivePage(),o=Object.values(a.pageElements),c=o!=null&&o.length?Math.max(...o.map(v=>v.zIndex)):20,l={id:i,zIndex:c+1,left:378,top:142,width:250,height:250,title:i,description:"",type:Re.SHAPE,shape:{shapeType:pt.Ellipse,text:"",shapeProperties:{radius:100,shapeBackgroundFill:{rgb:"rgb(0,0,255)"}}}};a.pageElements[i]=l,s.updatePage(a.id,a);const u=e.get(j),g=u.createObjectToPage(l,a.id,r);return g&&u.setObjectActiveByPage(g,a.id,r),!0}},Xe={id:"slide.command.add-text",type:M.COMMAND,handler:async e=>{var t;const i=e.get(P),n=(t=e.get(R).getFocusedUnit())==null?void 0:t.getUnitId();return await i.executeCommand(kt.id,{unitId:n})}},kt={id:"slide.operation.add-text",type:M.OPERATION,handler:async(e,t)=>{const i=t.unitId,n=Be(6),r=220,s=40,a=230,o=142,c=t?.text||"A New Text",l=e.get(R).getUnit(i);if(!l)return!1;const u=l.getActivePage(),g=Object.values(u.pageElements),v=g!=null&&g.length?Math.max(...g.map(h=>h.zIndex)):21,f={id:n,zIndex:v+1,left:a,top:o,width:r,height:s,title:"text",description:"",type:Re.TEXT,richText:{text:c,fs:30,cl:{rgb:"rgb(51, 51, 51)"},bl:1}};u.pageElements[n]=f,l.updatePage(u.id,u);const _=e.get(j),p=_.createObjectToPage(f,u.id,i);return p&&_.setObjectActiveByPage(p,u.id,i),!0}},Ft={id:"slide.operation.set-slide-page-thumb",type:M.OPERATION,handler:(e,t)=>(e.get(j).createThumbs(t.unitId),!0)};function an(){var e,t;const i=E(R),n=E(P),r=E(k),s=E(G),a=m.useRef(null),o=i.getCurrentUnitForType(I.UNIVER_SLIDE),c=o?.getPages(),l=o?.getPageOrder();if(!c||!l)return null;const u=l.map(h=>c[h]),[g,v]=m.useState((t=(e=o?.getActivePage())==null?void 0:e.id)!=null?t:null),f=m.useMemo(()=>u.map(()=>m.createRef()),[u]);m.useEffect(()=>{const h=o?.activePage$.subscribe(x=>{var S;const y=(S=x?.id)!=null?S:null;y&&v(y)});return()=>{h?.unsubscribe()}},[]),m.useEffect(()=>{f.forEach((h,x)=>{var S;if(h.current){const y=u[x];(S=r.getRenderById(y.id))==null||S.engine.setContainer(h.current)}}),f.length>0&&n.syncExecuteCommand(Ft.id,{unitId:o?.getUnitId()})},[f,u,r,n,o]);const _=m.useCallback(h=>{n.syncExecuteCommand(jt.id,{id:h,unitId:o?.getUnitId()})},[n,o]),p=m.useCallback(()=>{n.syncExecuteCommand(Tt.id,{unitId:o?.getUnitId()})},[n,o]);return d.jsx("aside",{ref:a,className:$("univer-flex univer-h-full univer-w-64 univer-flex-col univer-overflow-y-auto univer-overflow-x-hidden",Ti),children:d.jsxs("div",{className:"univer-px-4",children:[d.jsx("header",{className:"univer-flex univer-justify-center univer-pt-4",children:d.jsx("a",{className:$("univer-box-border univer-block univer-h-8 univer-w-full univer-cursor-pointer univer-rounded-md univer-bg-white univer-text-center univer-text-sm univer-leading-8 univer-transition-colors",ae),onClick:p,children:s.t("slide.append")})}),u.map((h,x)=>d.jsxs("div",{className:$("univer-my-4 univer-flex univer-gap-2",{"[&>div]:univer-border-primary-600 [&>span]:univer-text-primary-600":h.id===g}),onClick:()=>_(h.id),children:[d.jsx("span",{children:x+1}),d.jsx("div",{ref:f[x],className:$("univer-relative univer-box-border univer-h-32 univer-w-52 univer-bg-white hover:univer-border-primary-600",ae)})]},h.id))]})})}const se=ei("SLIDE_EDITOR"),Wt="slide.menu.image";function on(e){return{id:Wt,type:ee.SUBITEMS,icon:"AddImageIcon",tooltip:"slide.image.insert.title",hidden$:te(e,I.UNIVER_SLIDE)}}function ln(e){return{id:Fe.id,title:"slide.image.insert.float",type:ee.BUTTON,hidden$:te(e,I.UNIVER_SLIDE)}}const zt="slide.menu.shape";function cn(e){return{id:zt,type:ee.SUBITEMS,icon:"GraphIcon",tooltip:"slide.shape.insert.title",hidden$:te(e,I.UNIVER_SLIDE)}}function dn(e){return{id:ze.id,title:"slide.shape.insert.rectangle",type:ee.BUTTON,hidden$:te(e,I.UNIVER_SLIDE)}}function un(e){return{id:Ke.id,title:"slide.shape.insert.ellipse",type:ee.BUTTON,hidden$:te(e,I.UNIVER_SLIDE)}}function hn(e){return{id:Xe.id,type:ee.BUTTON,icon:"TextIcon",tooltip:"slide.text.insert.title",hidden$:te(e,I.UNIVER_SLIDE)}}const gn={[Si.FORMAT]:{[Xe.id]:{order:0,menuItemFactory:hn},[Wt]:{order:0,menuItemFactory:on,[Fe.id]:{order:0,menuItemFactory:ln}},[zt]:{order:0,menuItemFactory:cn,[ze.id]:{order:0,menuItemFactory:dn},[Ke.id]:{order:0,menuItemFactory:un}}}},Ce={id:"slide.operation.edit-arrow",type:M.OPERATION,handler:()=>!0},Kt="COMPONENT_SLIDE_IMAGE_POPUP_MENU";function vn(e){var t,i;const n=(i=(t=e.popup)==null?void 0:t.extraProps)==null?void 0:i.menuItems;if(!n)return null;const r=E(P),s=E(G),[a,o]=m.useState(!1),[c,l]=m.useState(!1),u=()=>{l(!0)},g=()=>{l(!1)},v=h=>{o(h)},f=h=>{r.executeCommand(h.commandId,h.commandParams),o(!1)},_=a||c,p=n.filter(h=>!h.disable);return d.jsx("div",{onMouseEnter:u,onMouseLeave:g,children:d.jsx(yt,{align:"start",overlay:d.jsx("ul",{className:$("univer-m-0 univer-box-border univer-grid univer-list-none univer-items-center univer-gap-1 univer-rounded-lg univer-bg-white univer-p-1.5 univer-text-sm univer-shadow-lg",ae),children:p.map(h=>d.jsx("li",{className:"univer-relative univer-box-border univer-flex univer-h-8 univer-cursor-pointer univer-items-center univer-rounded univer-text-sm univer-transition-colors hover:univer-bg-gray-100",onClick:()=>f(h),children:d.jsx("span",{className:"univer-px-2 univer-py-1.5 univer-align-middle",children:s.t(h.label)})},h.index))}),open:a,onOpenChange:v,children:d.jsxs("div",{className:$("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",ae,{"univer-bg-gray-100 dark:!univer-bg-gray-800":a,"univer-bg-white dark:!univer-bg-gray-900":!a}),children:[d.jsx(At,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),_&&d.jsx(We,{className:"dark:!univer-text-white"})]})})})}class pn{constructor(){b(this,"_state",null),b(this,"_rect",null),b(this,"_state$",new Z(null)),b(this,"state$",this._state$.asObservable()),b(this,"_rect$",new Z(null)),b(this,"rect$",this._rect$.asObservable()),b(this,"_focus",!1),b(this,"_focus$",new Z(this._focus)),b(this,"focus$",this._focus$.asObservable())}dispose(){this._state$.complete(),this._state=null,this._rect$.complete(),this._rect=null}setState(t){this._state=t,this._refresh(t)}getRect(){return this._rect}setRect(t){this._rect=t,this._rect$.next(t)}getState(){return this._state}setFocus(t=!1){this._focus=t,this._focus$.next(t)}_refresh(t){this._state$.next(t)}}const Ze=vt("univer.slide-editor-manager.service"),be=-1e3,lt={width:0,height:0,top:be,left:be};function mn(){const[e,t]=m.useState({...lt}),i=E(Ze),n=E(ke),r=E(ce),s=bi(()=>r.subscribeContextValue$(tt),!1,void 0,[r,tt]);return ti.UNSPECIFIED,m.useEffect(()=>{i.state$.subscribe(a=>{if(a==null)return;const{startX:o=be,startY:c=be,endX:l=0,endY:u=0,show:g=!1}=a;if(!g)t({...lt});else{t({width:l-o-q+2,height:u-c-q+2,left:o+q,top:c+q});const v=n.getEditor(se);if(v==null)return;const{left:f,top:_,width:p,height:h}=v.getBoundingClientRect();i.setRect({left:f,top:_,width:p,height:h})}})},[]),m.useEffect(()=>{s||i.setFocus(!0)},[s,e]),d.jsx("div",{className:$("univer-absolute univer-z-10 univer-box-border univer-flex",ae),style:{left:e.left,top:e.top,width:e.width,height:e.height}})}function Ve(e){return e.getContextValue(xt)&&e.getContextValue(fe)}function fn(e){return e.getContextValue(di)&&e.getContextValue(xt)}const Xt=[w.ARROW_DOWN,w.ARROW_UP,w.ARROW_LEFT,w.ARROW_RIGHT];[w.ENTER,w.TAB,...Xt];function _n(){const e=[];for(const t of Xt)e.push({id:Ce.id,binding:t,preconditions:i=>Ve(i),staticParameters:{visible:!1,eventType:Y.Keyboard,keycode:t,isShift:!1}}),e.push({id:Ce.id,binding:t|xi.SHIFT,preconditions:i=>Ve(i),staticParameters:{visible:!1,eventType:Y.Keyboard,keycode:t,isShift:!0}});return e}const Cn={id:Mi.id,preconditions:e=>Ve(e)||fn(e),binding:w.BACKSPACE};var bn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},Q=(e,t)=>(i,n)=>t(i,n,e);let Se=class extends ye{constructor(e,t,i,n,r,s){super(),this._injector=e,this._menuManagerService=t,this._componentManager=i,this._uiPartsService=n,this._commandService=r,this._shortcutService=s,this._initCommands(),this._initCustomComponents(),this._initUIComponents(),this._initMenus(),this._initShortcuts()}_initMenus(){this._menuManagerService.mergeMenu(gn)}_initCustomComponents(){const e=this._componentManager;this.disposeWithMe(e.register("TextIcon",Dt)),this.disposeWithMe(e.register("GraphIcon",Nt)),this.disposeWithMe(e.register(Kt,vn)),this.disposeWithMe(e.register(me,sn))}_initCommands(){[Tt,jt,Ft,Fe,kt,Xe,Ke,Ht,$t,ze,Ue,Ot,L,Ce].forEach(e=>this.disposeWithMe(this._commandService.registerCommand(e)))}_initUIComponents(){this.disposeWithMe(this._uiPartsService.registerComponent(it.LEFT_SIDEBAR,()=>nt(an,this._injector))),this.disposeWithMe(this._uiPartsService.registerComponent(it.CONTENT,()=>nt(mn,this._injector)))}_initShortcuts(){[Cn,..._n()].forEach(e=>{this.disposeWithMe(this._shortcutService.registerShortcut(e))})}};Se=bn([Q(0,H(He)),Q(1,Ii),Q(2,H(Ei)),Q(3,Ri),Q(4,P),Q(5,yi)],Se);const Sn="slides-ui.config",ct={};var xn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},ge=(e,t)=>(i,n)=>t(i,n,e);function In(e,t){const i=dt(e.left,e.top,t),n=dt(e.right,e.bottom,t);return{left:i.x,top:i.y,right:n.x,bottom:n.y}}function dt(e,t,i){const{scaleX:n,scaleY:r}=i.getAncestorScale(),s=i.getViewport(J.VIEW);if(!s)return{x:e,y:t};const{viewportScrollX:a,viewportScrollY:o}=s,c=(e-a)*n,l=(t-o)*r;return{x:c,y:l}}let xe=class extends ye{constructor(e,t,i,n){super(),this._globalPopupManagerService=e,this._renderManagerService=t,this._univerInstanceService=i,this._commandService=n}_createObjectPositionObserver(e,t){const i=(()=>{var s,a,o,c;const{scene:l,engine:u}=t,{left:g,top:v,width:f,height:_}=e,p=(l.width-((a=(s=t.mainComponent)==null?void 0:s.width)!=null?a:0))/2,h=(l.height-((c=(o=t.mainComponent)==null?void 0:o.height)!=null?c:0))/2,x={left:g,right:g+f,top:v,bottom:v+_},S=u.getCanvasElement(),y=S.getBoundingClientRect(),T=gi(S.style.width),{scaleX:N,scaleY:O}=l.getAncestorScale(),B=In(x,l),{top:K,left:D,width:F}=y,W=F/T;return{left:B.left*W*N+D+p,right:B.right*W*N+D+p,top:B.top*W*O+K+h,bottom:B.bottom*W*O+K+h}})(),n=new Z(i),r=new $e;return{position:i,position$:n,disposable:r}}attachPopupToObject(e,t){const i=this._univerInstanceService.getCurrentUnitForType(I.UNIVER_SLIDE).getUnitId(),n=this._renderManagerService.getRenderById(i);if(!n)return{dispose:()=>{}};const{position:r,position$:s,disposable:a}=this._createObjectPositionObserver(e,n),o=this._globalPopupManagerService.addPopup({...t,unitId:i,subUnitId:"default",anchorRect:r,anchorRect$:s,canvasElement:n.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(o),s.complete(),a.dispose()}}}};xe=xn([ge(0,H(wi)),ge(1,k),ge(2,R),ge(3,P)],xe);var En=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},X=(e,t)=>(i,n)=>t(i,n,e);let Ie=class extends le{constructor(e,t,i,n,r,s,a){super(),b(this,"_initImagePopupMenu",new Set),this._canvasPopManagerService=e,this._renderManagerService=t,this._univerInstanceService=i,this._contextService=n,this._canvasView=r,this._sidebarService=s,this._commandService=a,this._init()}_init(){this._univerInstanceService.getAllUnitsForType(I.UNIVER_SLIDE).forEach(e=>this._create(e))}_create(e){if(!e)return;const t=e.getUnitId();this._renderManagerService.has(t)&&!this._initImagePopupMenu.has(t)&&(this._popupMenuListener(t),this._initImagePopupMenu.add(t))}_hasCropObject(e){}_popupMenuListener(e){var t;const i=this._univerInstanceService.getCurrentUnitForType(I.UNIVER_SLIDE),n=(t=i?.getPages())!=null?t:{};Object.keys(n).forEach(r=>{var s;const a=(s=this._canvasView.getRenderUnitByPageId(r,e).scene)==null?void 0:s.getTransformer();if(!a)return;let o;this.disposeWithMe(St(a.createControl$.subscribe(()=>{const c=a.getSelectedObjectMap();if(c.size>1){o?.dispose();return}const l=c.values().next().value;if(!l)return;const u=l.oKey;o?.dispose(),o=this.disposeWithMe(this._canvasPopManagerService.attachPopupToObject(l,{componentKey:Kt,direction:"horizontal",offset:[2,0],extraProps:{menuItems:this._getMenuItemsByObjectType(l.objectType,u,e)}})),this._sidebarService.visible&&this._commandService.executeCommand(Ue.id,{visible:!0,objectType:l.objectType})}))),this.disposeWithMe(a.clearControl$.subscribe(()=>{o?.dispose(),this._contextService.setContextValue(ai,!1)})),this.disposeWithMe(a.changing$.subscribe(()=>{o?.dispose();const c=a.getSelectedObjectMap();if(c.size>1){o?.dispose();return}const l=c.values().next().value;l&&this._commandService.executeCommand(L.id,{unitId:e,oKey:l.oKey,props:{width:l.width,height:l.height,left:l.left,top:l.top}})}))})}_getMenuItemsByObjectType(e,t,i){return[{label:"slide.popup.edit",index:0,commandId:Ue.id,commandParams:{visible:!0,objectType:e},disable:!1},{label:"slide.popup.delete",index:5,commandId:Ot.id,commandParams:{id:t,unitId:i},disable:!1}]}};Ie=En([X(0,H(xe)),X(1,k),X(2,R),X(3,ce),X(4,H(j)),X(5,Rt),X(6,P)],Ie);var Rn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},Oe=(e,t)=>(i,n)=>t(i,n,e);const Ye=vt("univer.slide-editor-bridge.service");let De=class extends ye{constructor(e,t,i){super(),b(this,"_editorUnitId",se),b(this,"_isForceKeepVisible",!1),b(this,"_editorIsDirty",!1),b(this,"_currentEditRectState",null),b(this,"_currentEditRectState$",new Z(null)),b(this,"currentEditRectState$",this._currentEditRectState$.asObservable()),b(this,"_visibleParam",{visible:!1,eventType:Y.Dblclick,unitId:""}),b(this,"_visible$",new Z(this._visibleParam)),b(this,"visible$",this._visible$.asObservable()),b(this,"_afterVisible$",new Z(this._visibleParam)),b(this,"afterVisible$",this._afterVisible$.asObservable()),b(this,"endEditing$",new ft),b(this,"_currentEditRectInfo"),this._editorService=e,this._contextService=t,this._renderManagerService=i}dispose(){super.dispose()}getEditorRect(){return this._currentEditRectInfo}setEditorRect(e){this._currentEditRectInfo=e,this._editorService.getFocusEditor()||(this._editorService.focus(se),this._contextService.setContextValue(fe,!1),this._contextService.setContextValue(_t,!1),this._contextService.setContextValue(Ct,!1));const t=this.getEditRectState();this._currentEditRectState=t,this._currentEditRectState$.next(t)}changeVisible(e){this._visibleParam=e,e.visible&&(this._editorIsDirty=!1),this._visible$.next(this._visibleParam),this._afterVisible$.next(this._visibleParam)}getEditRectState(){const e=se,t=this._currentEditRectInfo,i=t.unitId,n=t.richTextObj.documentData;n.id=e,n.documentStyle={...n.documentStyle,pageSize:{width:t.richTextObj.width,height:1/0}};const r={documentModel:new si(n),fontString:"document",textRotation:{a:0,v:0},wrapStrategy:0,verticalAlign:_e.TOP,horizontalAlign:bt.LEFT,paddingData:{t:0,b:1,l:2,r:2}},s=t.richTextObj.width,a=t.richTextObj.height,o=t.richTextObj.left,c=t.richTextObj.top,l={left:0,top:0},u=this._renderManagerService.getRenderById(i),g=u?.scene,v=g?.getViewport(J.VIEW),f=g?.getObject(J.COMPONENT),_={x:f?.left||0,y:f?.top||0},p=v?.viewportScrollX||0,h=v?.viewportScrollY||0;return l.left=_.x-p,l.top=_.y-h,{position:{startX:o,startY:c,endX:o+s,endY:c+a},scaleX:1,scaleY:1,slideCardOffset:l,unitId:i,editorUnitId:e,documentLayoutObject:r}}changeEditorDirty(e){this._editorIsDirty=e}isVisible(){return this._visibleParam.visible}getEditorDirty(){return this._editorIsDirty}getCurrentEditorId(){return this._editorUnitId}genDocData(e){const t=this.getCurrentEditorId(),i=e.text,n=e.fs;return{id:t,body:{dataStream:`${i}\r
`,textRuns:[{st:0,ed:i.length}],paragraphs:[{paragraphStyle:{},startIndex:i.length+1}],sectionBreaks:[{startIndex:i.length+2}]},documentStyle:{marginBottom:0,marginLeft:0,marginRight:0,marginTop:0,pageSize:{width:1/0,height:1/0},textStyle:{fs:n},renderConfig:{verticalAlign:_e.MIDDLE,centerAngle:0,vertexAngle:0,wrapStrategy:0}},drawings:{},drawingsOrder:[],settings:{zoomRatio:1}}}};De=Rn([Oe(0,ke),Oe(1,ce),Oe(2,k)],De);var z=(e=>(e[e.InitialState=0]="InitialState",e[e.StartEditor=1]="StartEditor",e[e.CursorChange=2]="CursorChange",e))(z||{}),yn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},V=(e,t)=>(i,n)=>t(i,n,e);const ut=-1e3,ht=5,wn=2;let Le=class extends ye{constructor(e,t,i,n,r,s,a,o,c,l,u,g){super(),b(this,"_cursorChange",z.InitialState),b(this,"_isUnitEditing",!1),b(this,"_d"),this._renderContext=e,this._layoutService=t,this._undoRedoService=i,this._contextService=n,this._instanceSrv=r,this._renderManagerService=s,this._editorBridgeService=a,this._cellEditorManagerService=o,this._textSelectionManagerService=c,this._commandService=l,this._localService=u,this._editorService=g,this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(I.UNIVER_SLIDE).subscribe(v=>{v&&v.getUnitId()===this._renderContext.unitId?this._d=this._init():(this._disposeCurrent(),this._isUnitEditing&&(this._handleEditorInvisible({visible:!1,eventType:Y.Keyboard,keycode:w.ESC,unitId:this._renderContext.unitId}),this._isUnitEditing=!1))})),this._initEditorVisibilityListener()}dispose(){super.dispose(),this._disposeCurrent()}_disposeCurrent(){var e;(e=this._d)==null||e.dispose(),this._d=null}_init(){const e=new $e;return this._subscribeToCurrentCell(e),this._initialKeyboardListener(e),this._initialCursorSync(e),this._listenEditorFocus(e),this._commandExecutedListener(e),setTimeout(()=>{this._cursorStateListener(e)},1e3),e}_initEditorVisibilityListener(){this.disposeWithMe(this._editorBridgeService.visible$.subscribe(e=>{e.visible?(this._isUnitEditing=!0,this._handleEditorVisible(e)):this._isUnitEditing&&(this._handleEditorInvisible(e),this._isUnitEditing=!1)}))}_listenEditorFocus(e){const t=this._getEditorObject();t&&e.add(t.document.onPointerDown$.subscribeEvent(()=>{}))}_getEditorSkeleton(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(at).getSkeleton()}_getEditorViewModel(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(at).getViewModel()}_initialCursorSync(e){e.add(this._cellEditorManagerService.focus$.pipe(oi(t=>!!t)).subscribe(()=>{var t;(t=Ne(I.UNIVER_DOC,this._instanceSrv,this._renderManagerService))==null||t.with(rt).sync()}))}_subscribeToCurrentCell(e){e.add(this._editorBridgeService.currentEditRectState$.subscribe(t=>{var i;if(t==null||this._contextService.getContextValue(_t)||this._contextService.getContextValue(Ct))return;const{position:{startX:n,endX:r},documentLayoutObject:{textRotation:s,wrapStrategy:a,documentModel:o},scaleX:c,editorUnitId:l}=t,{vertexAngle:u}=Je(s);o.updateDocumentId(l),a===Qe.WRAP&&u===0&&o.updateDocumentDataPageSize((r-n)/c),this._instanceSrv.changeDoc(l,o),this._contextService.setContextValue(li,!0),this._textSelectionManagerService.replaceTextRanges([{startOffset:0,endOffset:0}]),(i=Ne(I.UNIVER_DOC,this._instanceSrv,this._renderManagerService))==null||i.with(rt).activate(ut,ut)}))}_fitTextSize(e,t,i,n,r=1,s=1){const{startX:a,startY:o,endX:c,endY:l}=e,u=n.documentModel;if(u==null)return;const{actualWidth:g,actualHeight:v}=this._predictingSize(e,t,i,n,r,s),{verticalAlign:f,paddingData:_,fill:p}=n;let h=c-a,x=l-o;if(h<g&&(h=g),x<v)x=v,u.updateDocumentDataMargin(_);else{let S=0;f===_e.MIDDLE?S=(x-v)/2/s:f===_e.TOP?S=_.t||0:S=(x-v)/s-(_.b||0),S=S<(_.t||0)?_.t||0:S,u.updateDocumentDataMargin({t:S})}i.calculate(),this._editAreaProcessing(h,x,e,t,p,r,s)}_predictingSize(e,t,i,n,r=1,s=1){const{startX:a,endX:o}=e,{textRotation:c,wrapStrategy:l}=n,u=n.documentModel,{vertexAngle:g}=Je(c),v=document.body.clientWidth;if(l===Qe.WRAP&&g===0){const{actualWidth:p,actualHeight:h}=i.getActualSize();return{actualWidth:p*r,actualHeight:h*s}}u?.updateDocumentDataPageSize((v-a-t.left)/r),i.calculate();const f=i.getActualSize();let _=o-a;return _<f.actualWidth*r+ht*r&&(_=f.actualWidth*r+ht*r),u?.updateDocumentDataPageSize(_/r),u?.updateDocumentRenderConfig({horizontalAlign:bt.UNSPECIFIED,cellValueType:void 0}),{actualWidth:_,actualHeight:f.actualHeight*s}}_editAreaProcessing(e,t,i,n,r,s=1,a=1){var o;const c=this._getEditorObject();if(c==null)return;function l(C){return Number.parseInt(C.replace("px",""))}const u=this._renderContext.engine.getCanvasElement(),g=u.getBoundingClientRect(),v=l(u.style.width),{top:f,left:_,width:p}=g,h=p/v;let{startX:x,startY:S}=i;x+=n.left,S+=n.top;const{document:y,scene:T,engine:N}=c,O=T.getViewport(st.VIEW_MAIN),B=document.body.clientHeight-S-n.top-wn*2,K=document.body.clientWidth-x-n.left;let D=t,F=O?.getScrollBar();D>B?(D=B,F==null?O&&new It(O,{enableHorizontal:!1,barSize:8}):O?.resetCanvasSizeAndUpdateScroll()):(F=null,(o=O?.getScrollBar())==null||o.dispose()),e+=F?.barSize||0,e=Math.min(e,K),x-=q,S-=q,this._addBackground(T,e/s,t/a,r);const{scaleX:W,scaleY:we}=T.getPrecisionScale();T.transformByState({width:e*h/s,height:t*h/a,scaleX:s*h,scaleY:a*h}),y.resize(e/s,t/a),setTimeout(()=>{N.resizeBySize(et(e,W),et(D,we))},0);const de=this._layoutService.getContentElement().getBoundingClientRect(),ue=u.getBoundingClientRect();x=x*h+(ue.left-de.left),S=S*h+(ue.top-de.top),this._cellEditorManagerService.setState({startX:x,startY:S,endX:e*h+x,endY:D*h+S,show:!0})}_addBackground(e,t,i,n){const r="_backgroundRectHelperColor_",s=e.getObject(r);s==null&&n==null||(s==null?e.addObjects([new Et(r,{width:t,height:i,fill:n,evented:!1})],Pi):n==null?s.dispose():(s.setProps({fill:n}),s.transformByState({width:t,height:i})))}_handleEditorVisible(e){var t,i;const{eventType:n}=e;this._cursorChange=[Y.PointerDown,Y.Dblclick].includes(n)?z.CursorChange:z.StartEditor;const r=this._editorBridgeService.getEditRectState();if(r==null)return;const{position:s,documentLayoutObject:a,slideCardOffset:o,scaleX:c,scaleY:l,editorUnitId:u,unitId:g}=r,v=this._getEditorObject();if(v==null)return;const{scene:f}=v;this._contextService.setContextValue(fe,!0);const{documentModel:_}=a,p=this._getEditorSkeleton(u);if(!p||!_)return;this._fitTextSize(s,o,p,a,c,l);const h=_.getBody().dataStream.length-2||0;(t=f.getViewport(st.VIEW_MAIN))==null||t.scrollToViewportPos({viewportScrollX:Number.POSITIVE_INFINITY}),this._textSelectionManagerService.replaceTextRanges([{startOffset:h,endOffset:h}]),(i=this._renderManagerService.getRenderById(g))==null||i.scene.resetCursor()}_resetBodyStyle(e,t=!1){e.dataStream=ci,e.textRuns!=null&&(e.textRuns.length===1&&!t?(e.textRuns[0].st=0,e.textRuns[0].ed=1):e.textRuns=void 0),e.paragraphs!=null&&(e.paragraphs.length===1?e.paragraphs[0].startIndex=0:e.paragraphs=[{startIndex:0}]),e.sectionBreaks!=null&&(e.sectionBreaks=void 0),e.tables!=null&&(e.tables=void 0),e.customRanges!=null&&(e.customRanges=void 0),e.customBlocks!=null&&(e.customBlocks=void 0)}_initialKeyboardListener(e){}_showEditorByKeyboard(e){}_commandExecutedListener(e){const t=[Ce.id],i=[Di.id];e.add(this._commandService.onCommandExecuted(n=>{this._editorService.getFocusId()===se&&(t.includes(n.id)&&this._moveCursorCmdHandler(n),i.includes(n.id)&&this._editorBridgeService.isVisible()&&this._editingChangedHandler())}))}_moveCursorCmdHandler(e){const t=e.params,{keycode:i,isShift:n}=t;i!=null&&this._cursorChange===z.CursorChange?this._moveInEditor(i,n):this._editorBridgeService.changeVisible(t)}_editingChangedHandler(){const e=this._editorBridgeService.getEditorRect();if(!e)return;const t=e.richTextObj;t.refreshDocumentByDocData(),t.resizeToContentSize();const{unitId:i}=this._renderContext;this._handleEditorVisible({visible:!0,eventType:3,unitId:i})}_getEditorObject(){return jn(this._editorBridgeService.getCurrentEditorId(),this._renderManagerService)}async _handleEditorInvisible(e){const{keycode:t}=e;if(this._cursorChange=z.InitialState,this._exitInput(e),this._editorBridgeService.getEditRectState()!=null){if(this._editorBridgeService.getEditorDirty()===!1){this._moveCursor(t);return}this._moveCursor(t)}}_exitInput(e){this._contextService.setContextValue(fe,!1),this._cellEditorManagerService.setState({show:e.visible});const t=this._editorBridgeService.getCurrentEditorId();t!=null&&this._undoRedoService.clearUndoRedo(t)}_moveCursor(e){if(e!=null)switch(U.LEFT,e){case w.ENTER:U.DOWN;break;case w.TAB:U.RIGHT;break;case w.ARROW_DOWN:U.DOWN;break;case w.ARROW_UP:U.UP;break;case w.ARROW_LEFT:U.LEFT;break;case w.ARROW_RIGHT:U.RIGHT;break}}_cursorStateListener(e){const t=this._getEditorObject();if(!t)return;const{document:i}=t;e.add(St(i.onPointerDown$.subscribeEvent(()=>{this._cursorChange===z.StartEditor&&(this._cursorChange=z.CursorChange)})))}_moveInEditor(e,t){let i=U.LEFT;e===w.ARROW_DOWN?i=U.DOWN:e===w.ARROW_UP?i=U.UP:e===w.ARROW_RIGHT&&(i=U.RIGHT),t?this._commandService.executeCommand(Ni.id,{direction:i}):this._commandService.executeCommand(Ui.id,{direction:i})}};Le=yn([V(1,ji),V(2,ui),V(3,ce),V(4,R),V(5,k),V(6,Ye),V(7,Ze),V(8,H(Li)),V(9,P),V(10,H(G)),V(11,ke)],Le);function jn(e,t){if(e==null)return;const i=t.getRenderById(e);if(i==null)return;const{mainComponent:n,scene:r,engine:s,components:a}=i,o=n,c=a.get(Vi.BACKGROUND);return{document:o,docBackground:c,scene:r,engine:s}}var Tn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},Me=(e,t)=>(i,n)=>t(i,n,e);let Ae=class extends le{constructor(e,t,i,n){super(),b(this,"setSlideTextEditor$",new ft),b(this,"_curRichText",null),b(this,"_d"),this._renderContext=e,this._instanceSrv=t,this._commandService=i,this._editorBridgeService=n,this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(I.UNIVER_SLIDE).subscribe(r=>{r&&r.getUnitId()===this._renderContext.unitId?this._d=this._init():this._disposeCurrent()}))}_init(){const e=new $e;return this._initEventListener(e),e}_disposeCurrent(){var e;(e=this._d)==null||e.dispose(),this._d=null}_setEditorRect(e,t){this._curRichText=t;const{scene:i,engine:n}=this._renderContext,r=this._renderContext.unitId,s={scene:i,engine:n,unitId:r,pageId:e,richTextObj:t};this._editorBridgeService.setEditorRect(s)}_initEventListener(e){const t=r=>{const s=r.getTransformer();s&&(e.add(s.clearControl$.subscribe(()=>{this.setEditorVisible(!1),this.pickOtherObjects()})),e.add(s.createControl$.subscribe(()=>{this.setEditorVisible(!1)})),e.add(r.onDblclick$.subscribeEvent(()=>{s.clearControls();const a=s.getSelectedObjectMap().values().next().value;a&&(a.objectType!==re.RICH_TEXT?this.pickOtherObjects():this.startEditing(r.sceneKey,a))})),e.add(this._instanceSrv.focused$.subscribe(a=>{this.endEditing()})))},{mainComponent:i}=this._renderContext;i.subSceneChanged$.subscribeEvent(r=>{t(r)});const n=Array.from(i.getSubScenes().values());for(let r=0;r<n.length;r++){const s=n[r];t(s)}}pickOtherObjects(){this.endEditing()}endEditing(){var e;if(!this._curRichText)return;this.setEditorVisible(!1);const t=this._curRichText;if(!this._instanceSrv.getCurrentUnitForType(I.UNIVER_SLIDE))return!1;t.refreshDocumentByDocData(),t.resizeToContentSize(),this._editorBridgeService.endEditing$.next(t);const i={bl:1,fs:t.fs,text:t.text},n=(e=t.documentData.body)==null?void 0:e.textRuns;if(n&&n.length){const r=n[0].ts;i.cl=r?.cl}this._commandService.executeCommand(L.id,{unitId:this._renderContext.unitId,oKey:t?.oKey,props:{richText:i}}),this._curRichText=null}startEditing(e,t){this._setEditorRect(e,t),this.setEditorVisible(!0)}setEditorVisible(e){var t,i;e?(t=this._curRichText)==null||t.hide():(i=this._curRichText)==null||i.show();const{unitId:n}=this._renderContext;this._editorBridgeService.changeVisible({visible:e,eventType:Y.PointerDown,unitId:n})}};Ae=Tn([Me(1,R),Me(2,P),Me(3,Ye)],Ae);var On=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},Pe=(e,t)=>(i,n)=>t(i,n,e);let Ee=class extends le{constructor(e,t,i){super(),this._contextService=e,this._instanceSrv=t,this._renderManagerService=i,Promise.resolve().then(()=>this._init())}_init(){this._initSlideDataListener(),this._initContextListener()}_initSlideDataListener(){this._instanceSrv.getTypeOfUnitAdded$(I.UNIVER_SLIDE).pipe(ot(this.dispose$)).subscribe(e=>{this._createRenderer(e?.getUnitId())}),this._instanceSrv.getAllUnitsForType(I.UNIVER_SLIDE).forEach(e=>{this._createRenderer(e.getUnitId())}),this._instanceSrv.getTypeOfUnitDisposed$(I.UNIVER_SLIDE).pipe(ot(this.dispose$)).subscribe(e=>this._disposeRenderer(e))}_createRenderer(e){e==null||this._instanceSrv.getUnit(e,I.UNIVER_SLIDE)==null||this._renderManagerService.createRender(e)}_disposeRenderer(e){const t=e.getUnitId();this._renderManagerService.removeRender(t)}_initContextListener(){}};Ee=On([Pe(0,ce),Pe(1,R),Pe(2,k)],Ee);var Mn=(e,t,i,n)=>{for(var r=t,s=e.length-1,a;s>=0;s--)(a=e[s])&&(r=a(r)||r);return r},ve=(e,t)=>(i,n)=>t(i,n,e);const Pn="SLIDE_UI";var pe;let gt=(pe=class extends ii{constructor(e=ct,t,i,n,r){super(),this._config=e,this._injector=t,this._renderManagerService=i,this._univerInstanceService=n,this._configService=r;const{menu:s,...a}=mt({},ct,this._config);s&&this._configService.setConfig("menu",s,{merge:!0}),this._configService.setConfig(Sn,a)}onStarting(){Ge([[Ee],[Ye,{useClass:De}],[Ze,{useClass:pn}],[xe]],this._config.override).forEach(e=>this._injector.add(e))}onReady(){[[oe]].forEach(e=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(I.UNIVER_SLIDE,e))}),Ge([[j],[Se],[oe],[Ie]],this._config.override).forEach(e=>{this._injector.add(e)}),this._injector.get(j),this._injector.get(Ee)}onRendered(){[[Ae],[Le]].forEach(e=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(I.UNIVER_SLIDE,e))}),this._markSlideAsFocused(),this._injector.get(Se)}onSteady(){this._injector.get(Ie)}_markSlideAsFocused(){const e=this._univerInstanceService;try{const t=e.getCurrentUnitForType(I.UNIVER_SLIDE);e.focusUnit(t.getUnitId())}catch{}}},b(pe,"pluginName",Pn),b(pe,"type",I.UNIVER_SLIDE),pe);gt=Mn([ve(1,H(He)),ve(2,k),ve(3,R),ve(4,hi)],gt);export{jt as ActivateSlidePageOperation,Tt as AppendSlideOperation,j as CanvasView,Ot as DeleteSlideElementOperation,Ye as ISlideEditorBridgeService,Fe as InsertSlideFloatImageCommand,Ke as InsertSlideShapeEllipseCommand,Ht as InsertSlideShapeEllipseOperation,ze as InsertSlideShapeRectangleCommand,$t as InsertSlideShapeRectangleOperation,zt as SHAPE_MENU_ID,Wt as SLIDES_IMAGE_MENU_ID,se as SLIDE_EDITOR_ID,Ft as SetSlidePageThumbOperation,Xe as SlideAddTextCommand,kt as SlideAddTextOperation,xe as SlideCanvasPopMangerService,mn as SlideEditorContainer,an as SlideSideBar,Se as SlidesUIController,gn as SlidesUIMenuSchema,gt as UniverSlidesUIPlugin,L as UpdateSlideElementOperation};
