import{g4 as Nh,ga as _h,g5 as fo,gx as Ch,cz as ou,g6 as Ps,gg as Eh,gf as Ma,gn as Ah,g8 as Fs,f$ as di,da as nt,L as Ae,aB as Me,dT as Ye,c5 as iu,fk as lu,gl as ph,b6 as _t,bi as pr,bc as yh,bm as ge,bo as $r,b7 as _n,fT as bh,fs as cu,j as Ut,fa as Rh,bP as me,gm as Dt,s as Sh,fE as Oh,ck as Va,e as Ni,eZ as vt,e_ as bt,ce as rt,g7 as _i,gc as Mh,gd as Vh,d5 as Xe,cx as Th,ea as Ci,b as xe,fc as Ih,fy as yr,es as js,g0 as ga,f7 as Q,bE as es,bD as Ur,Q as xh,bv as Uh,eG as vh,cm as No,dF as Ei,aC as wh,ao as Be,ds as Dh,N as At,bB as Lh,bS as Ph,bw as Fh}from"./index-BI8deSNo.js";import{t as ts}from"./takeUntil-BWepI5Pd.js";import{i as jh}from"./isObservable-DLg0_x3m.js";import{a as hu}from"./shareReplay-DR2HpNHE.js";function Bh(a){return Nh(function(e,t){var r=null,n=null,s=function(){n?.unsubscribe();var u=r;r=[],u&&t.next(u),_h(a()).subscribe(n=fo(t,s,Ch))};s(),e.subscribe(fo(t,function(u){return r?.push(u)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=n=null}))})}var kh=Object.defineProperty,$h=(a,e,t)=>e in a?kh(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,We=(a,e,t)=>$h(a,typeof e!="symbol"?e+"":e,t);const Yh="rpc.main-thread.config",_o={},Hh="rpc.worker-thread.config",Co={};var Ai=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Yn=(a,e)=>(t,r)=>e(t,r,a);const mu="rpc.remote-sync.service",rs=Ye(mu);let Ta=class{constructor(a){this._commandService=a}async syncMutation(a,e){const{fromCollab:t,...r}=e||{};return this._commandService.syncExecuteCommand(a.mutationInfo.id,a.mutationInfo.params,{...r,onlyLocal:!0,fromSync:!0})}};Ta=Ai([Yn(0,_t)],Ta);const gu="univer.remote-instance-service",ns=Ye(gu);let Ia=class{constructor(a,e,t){this._univerInstanceService=a,this._commandService=e,this._logService=t}whenReady(){return Promise.resolve(!0)}async syncMutation(a,e){return this._applyMutation(a.mutationInfo,e)}async createInstance(a){this._logService.debug(`[WebWorkerRemoteInstanceService]: Creating instance with id ${a.unitID}`);const{type:e,snapshot:t}=a;try{if(e===nt.UNIVER_SHEET)return this._univerInstanceService.createUnit(nt.UNIVER_SHEET,t),!0;throw new Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${e}.`)}catch(r){throw r instanceof Error?r:new TypeError(`${r}`)}}async disposeInstance(a){return this._logService.debug(`[WebWorkerRemoteInstanceService]: Disposing instance with id ${a.unitID}`),this._univerInstanceService.disposeUnit(a.unitID)}_applyMutation(a,e){const{id:t,params:r}=a,{fromCollab:n,...s}=e||{};return this._commandService.syncExecuteCommand(t,r,{...s,onlyLocal:!0,fromSync:!0})}};Ia=Ai([Yn(0,pr),Yn(1,_t),Yn(2,yh)],Ia);function pi(a){const e=a;return new class{call(t,r){const n=e[t];if(typeof n=="function"){let s=r?n.apply(e,r):n.call(e);return s instanceof Promise||(s=Promise.resolve(s)),s}throw new Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){const n=e[t];if(typeof n=="function"){const s=r?n.apply(e,r):n.call(e);return jh(s)?s:ph(s)}throw new Error(`[RPC]: observable method not found for ${t}!`)}}}function yi(a){return new Proxy({},{get(e,t){if(t!=="dispose")return function(...r){return Gh(t)?a.subscribe(t,r):a.call(t,r)}}})}function Gh(a){return a.endsWith("$")}class Xh extends ou{constructor(e){super(),We(this,"_initialized",new Ps(!1)),We(this,"_lastRequestCounter",0),We(this,"_pendingRequests",new Map),this._protocol=e,this._protocol.send({type:50}),this._protocol.onMessage.pipe(ts(this.dispose$)).subscribe(t=>this._onMessage(t))}dispose(){this._pendingRequests.clear()}getChannel(e){const t=this;return{call(r,n){return t._disposed?Promise.reject():t._remoteCall(e,r,n)},subscribe(r,n){if(t._disposed)throw new Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,n)}}}_whenReady(){return Eh(this._initialized.pipe(Ma(e=>e),Ah(1)))}async _remoteCall(e,t,r){await this._whenReady();const n=++this._lastRequestCounter,s={seq:n,type:100,channelName:e,method:t,args:r},u=this;return new Promise((o,i)=>{const l={handle(c){switch(c.type){case 201:u._pendingRequests.delete(n),o(c.data);break;case 202:u._pendingRequests.delete(n),i(c.data);break;default:throw new Error("[ChannelClient]: unknown response type!")}}};this._pendingRequests.set(n,l),this._sendRequest(s)})}_remoteSubscribe(e,t,r){return new Fs(n=>{let s=-1;return this._whenReady().then(()=>{s=++this._lastRequestCounter;const u={seq:s,type:101,channelName:e,method:t,args:r},o={handle(i){switch(i.type){case 300:n.next(i.data);break;case 301:n.error(i.data);break;case 302:n.complete();break;default:throw new Error("[ChannelClient]: unknown response type!")}}};this._pendingRequests.set(s,o),this._sendRequest(u)}),()=>{if(s===-1)return;const u={type:102,seq:s,channelName:e,method:t};this._sendRequest(u)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;const{type:r,seq:n}=e;switch(r){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:{const{_pendingRequests:s}=this;(t=s.get(n))==null||t.handle(e),r!==300&&s.delete(n);break}}}}class qh extends ou{constructor(e){super(),We(this,"_channels",new Map),We(this,"_subscriptions",new Map),this._protocol=e,this._protocol.onMessage.pipe(ts(this.dispose$)).subscribe(t=>this._onRequest(t)),this._sendInitialize()}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 50:this._sendInitialize();break;case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e);break}}_sendInitialize(){this._sendResponse({seq:-1,type:0})}_onMethodCall(e){const{channelName:t,method:r,args:n}=e,s=this._channels.get(t);let u;try{if(!s)throw new Error(`[ChannelServer]: Channel ${t} not found!`);u=n?s.call(r,n):s.call(r)}catch(o){u=Promise.reject(o)}u.then(o=>{this._sendResponse({seq:e.seq,type:201,data:o})}).catch(o=>{o instanceof Error?this._sendResponse({seq:e.seq,type:202,data:o.message}):this._sendResponse({seq:e.seq,type:202,data:String(o)})})}_onSubscribe(e){const{channelName:t,seq:r}=e,n=this._channels.get(t);try{if(!n)throw new Error(`[ChannelServer]: Channel ${t} not found!`);const s=n.subscribe(e.method,e.args).subscribe({next:u=>{this._sendResponse({seq:r,type:300,data:u})},error:u=>{this._sendResponse({seq:r,type:301,data:u.message}),this._sendResponse({seq:r,type:302})},complete:()=>{this._sendResponse({seq:r,type:302})}});this._subscriptions.set(e.seq,s)}catch(s){s instanceof Error?this._sendResponse({seq:e.seq,type:301,data:s.message}):this._sendResponse({seq:e.seq,type:301,data:String(s)})}}_onUnsubscribe(e){const t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}}const Bs=Ye("IRPCChannelService");let bi=class{constructor(e){We(this,"_client"),We(this,"_server"),this._client=new Xh(e),this._server=new qh(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}};var Wh=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Wr=(a,e)=>(t,r)=>e(t,r,a);let tn=class extends ou{constructor(a,e,t,r,n){super(),We(this,"_remoteInstanceService"),We(this,"_syncingUnits",new Set),We(this,"_syncingMutations",new Set),this._injector=a,this._commandService=e,this._univerInstanceService=t,this._rpcChannelService=r,this._remoteSyncService=n,this._initRPCChannels(),this._init()}registerSyncingMutations(a){this._syncingMutations.add(a.id)}syncUnit(a){return this._syncingUnits.add(a),di(()=>this._syncingUnits.delete(a))}_initRPCChannels(){this._rpcChannelService.registerChannel(mu,pi(this._remoteSyncService)),this._injector.add([ns,{useFactory:()=>yi(this._rpcChannelService.requestChannel(gu))}]),this._remoteInstanceService=this._injector.get(ns)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(nt.UNIVER_SHEET).pipe(ts(this.dispose$)).subscribe(a=>{this._syncingUnits.add(a.getUnitId()),this._remoteInstanceService.createInstance({unitID:a.getUnitId(),type:nt.UNIVER_SHEET,snapshot:a.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(nt.UNIVER_SHEET).pipe(ts(this.dispose$)).subscribe(a=>{this._syncingUnits.delete(a.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:a.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((a,e)=>{const{type:t,params:r,id:n}=a,s=r?.unitId||"";t===Ae.MUTATION&&(!s||this._syncingUnits.has(s))&&!(e!=null&&e.fromSync)&&this._syncingMutations.has(n)&&this._remoteInstanceService.syncMutation({mutationInfo:a},e)}))}};tn=Wh([Wr(0,ge($r)),Wr(1,_t),Wr(2,pr),Wr(3,Bs),Wr(4,rs)],tn);var Qh=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},vn=(a,e)=>(t,r)=>e(t,r,a);let ss=class extends Me{constructor(a,e,t,r){super(),We(this,"_remoteSyncService"),this._injector=a,this._remoteInstanceService=e,this._commandService=t,this._rpcChannelService=r,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(gu,pi(this._remoteInstanceService)),this._injector.add([rs,{useFactory:()=>yi(this._rpcChannelService.requestChannel(mu))}]),this._remoteSyncService=this._injector.get(rs)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((a,e)=>{a.type===Ae.MUTATION&&!(e!=null&&e.fromSync)&&this._remoteSyncService.syncMutation({mutationInfo:a},e)}))}};ss=Qh([vn(0,ge($r)),vn(1,ns),vn(2,_t),vn(3,Bs)],ss);function Kh(){return{send(a){postMessage(a)},onMessage:new Fs(a=>{const e=t=>{a.next(t.data)};return addEventListener("message",e),()=>removeEventListener("message",e)}).pipe(hu(1))}}function Zh(a){return{send(e){a.postMessage(e)},onMessage:new Fs(e=>{const t=r=>{e.next(r.data)};return a.addEventListener("message",t),()=>a.removeEventListener("message",t)}).pipe(hu(1))}}var Ri=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},as=(a,e)=>(t,r)=>e(t,r,a),fa;let Eo=(fa=class extends iu{constructor(a=_o,e,t){super(),We(this,"_internalWorker",null),this._config=a,this._injector=e,this._configService=t;const{...r}=lu({},_o,this._config);this._configService.setConfig(Yh,r)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){const{workerURL:a}=this._config;if(!a)throw new Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");const e=a instanceof Worker?a:new Worker(a);this._internalWorker=a instanceof Worker?null:e;const t=Zh(e);[[Bs,{useFactory:()=>new bi(t)}],[tn],[rs,{useClass:Ta}]].forEach(r=>this._injector.add(r)),this._injector.get(tn)}},We(fa,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),fa);Eo=Ri([as(1,ge($r)),as(2,_n)],Eo);var da;let Ao=(da=class extends iu{constructor(a=Co,e,t){super(),this._config=a,this._injector=e,this._configService=t;const{...r}=lu({},Co,this._config);this._configService.setConfig(Hh,r)}onStarting(){[[ss],[Bs,{useFactory:()=>new bi(Kh())}],[ns,{useClass:Ia}]].forEach(a=>this._injector.add(a)),this._injector.get(ss)}},We(da,"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),da);Ao=Ri([as(1,ge($r)),as(2,_n)],Ao);var zh=Object.defineProperty,Jh=(a,e,t)=>e in a?zh(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,N=(a,e,t)=>Jh(a,typeof e!="symbol"?e+"":e,t),Wt=(a=>(a.FALSE="FALSE",a.TRUE="TRUE",a))(Wt||{}),Gt=(a=>(a[a.SUCCESS=0]="SUCCESS",a[a.ERROR=1]="ERROR",a))(Gt||{}),Te=(a=>(a.ALL="#All",a.DATA="#Data",a.HEADERS="#Headers",a.TOTALS="#Totals",a.THIS_ROW="#This Row",a))(Te||{}),gt=(a=>(a[a.FRONT=0]="FRONT",a[a.BACK=1]="BACK",a))(gt||{});class Ft{constructor(e){N(this,"_cache"),this._cache=new Uh(e)}set(e,t){const r=this._hash(e);this._cache.set(r,t)}get(e){const t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}delete(e){this._cache.delete(this._hash(e))}forEach(e,t){this._cache.forEach(e,t)}_hash(e){return e.length<=64?e:vh(e).toString()}}var g=(a=>(a.DIV_BY_ZERO="#DIV/0!",a.NAME="#NAME?",a.VALUE="#VALUE!",a.NUM="#NUM!",a.NA="#N/A",a.CYCLE="#CYCLE!",a.REF="#REF!",a.SPILL="#SPILL!",a.CALC="#CALC!",a.ERROR="#ERROR!",a.CONNECT="#GETTING_DATA",a.NULL="#NULL!",a))(g||{});const zt=new Set(Object.values(g)),po=[...new Set(Object.values(g).map(a=>a.length))];class ks{constructor(){N(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}}var K=(a=>(a.PLUS="+",a.MINUS="-",a.MULTIPLY="*",a.DIVIDED="/",a.CONCATENATE="&",a.POWER="^",a.EQUALS="=",a.NOT_EQUAL="<>",a.GREATER_THAN=">",a.GREATER_THAN_OR_EQUAL=">=",a.LESS_THAN="<",a.LESS_THAN_OR_EQUAL="<=",a))(K||{}),k=(a=>(a.EQUALS="=",a.NOT_EQUAL="<>",a.GREATER_THAN=">",a.GREATER_THAN_OR_EQUAL=">=",a.LESS_THAN="<",a.LESS_THAN_OR_EQUAL="<=",a))(k||{});const Hn=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),yt=new Set(Hn.keys()),em=new Set(["=","<>",">",">=","<","<="]);var q=(a=>(a.OPEN_BRACKET="(",a.CLOSE_BRACKET=")",a.COMMA=",",a.SINGLE_QUOTATION="'",a.DOUBLE_QUOTATION='"',a.OPEN_BRACES="{",a.CLOSE_BRACES="}",a.COLON=":",a.OPEN_SQUARE_BRACKET="[",a.CLOSE_SQUARE_BRACKET="]",a))(q||{}),st=(a=>(a.PERCENTAGE="%",a.POUND="#",a))(st||{});const Gn=new Set(["%","#"]);var Ie=(a=>(a.AT="@",a.MINUS="-",a.PLUS="+",a))(Ie||{});const tm=" ";class jt extends ks{constructor(e){super(),N(this,"_customData"),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isDateFormat(){return!1}isError(){return!1}isNull(){return!1}isHyperlink(){return!1}isImage(){return!1}sum(){return f.create(g.VALUE)}max(){return f.create(g.VALUE)}min(){return f.create(g.VALUE)}count(){return f.create(g.VALUE)}countA(){return f.create(g.VALUE)}countBlank(){return f.create(g.VALUE)}getNegative(){return f.create(g.VALUE)}getReciprocal(){return f.create(g.VALUE)}plus(e){return f.create(g.VALUE)}minus(e){return f.create(g.VALUE)}multiply(e){return f.create(g.VALUE)}divided(e){return f.create(g.VALUE)}mod(e){return f.create(g.VALUE)}map(e){return f.create(g.NAME)}mapValue(e){return f.create(g.NAME)}compare(e,t,r=!1){return f.create(g.NAME)}isEqual(e){return this.compare(e,k.EQUALS)}isNotEqual(e){return this.compare(e,k.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,k.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,k.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,k.LESS_THAN)}isGreaterThan(e){return this.compare(e,k.GREATER_THAN)}concatenateFront(e){return f.create(g.NAME)}concatenateBack(e){return f.create(g.NAME)}plusBy(e){return f.create(g.VALUE)}minusBy(e){return f.create(g.VALUE)}multiplyBy(e){return f.create(g.VALUE)}dividedBy(e){return f.create(g.VALUE)}modInverse(e){return f.create(g.VALUE)}compareBy(e,t,r=!1){return f.create(g.NAME)}concatenate(e,t=gt.FRONT){let r=this.getValue().toString();if(typeof e=="string")t===gt.FRONT?r=e+r:r+=e;else if(typeof e=="number")t===gt.FRONT?r=e.toString()+r:r+=e.toString();else if(typeof e=="boolean"){const n=e?"TRUE":"FALSE";t===gt.FRONT?r=n+r:r+=n}return r}pow(e){return f.create(g.VALUE)}powInverse(e){return f.create(g.VALUE)}sqrt(){return f.create(g.VALUE)}cbrt(){return f.create(g.VALUE)}cos(){return f.create(g.VALUE)}cosh(){return f.create(g.VALUE)}acos(){return f.create(g.VALUE)}acosh(){return f.create(g.VALUE)}sin(){return f.create(g.VALUE)}sinh(){return f.create(g.VALUE)}asin(){return f.create(g.VALUE)}asinh(){return f.create(g.VALUE)}tan(){return f.create(g.VALUE)}tanh(){return f.create(g.VALUE)}atan(){return f.create(g.VALUE)}atan2(e){return f.create(g.VALUE)}atan2Inverse(e){return f.create(g.VALUE)}atanh(){return f.create(g.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return f.create(g.VALUE)}log10(){return f.create(g.VALUE)}exp(){return f.create(g.VALUE)}abs(){return f.create(g.VALUE)}round(e){return f.create(g.VALUE)}roundInverse(e){return f.create(g.VALUE)}floor(e){return f.create(g.VALUE)}floorInverse(e){return f.create(g.VALUE)}ceil(e){return f.create(g.VALUE)}ceilInverse(e){return f.create(g.VALUE)}convertToNumberObjectValue(){return f.create(g.VALUE)}convertToBooleanObjectValue(){return f.create(g.VALUE)}}const rm=1e3,xa=new Ft(rm);class f extends jt{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(e,t=""){const r=`${e}-${t}`,n=xa.get(r);if(n)return n;const s=new f(e,t);return xa.set(r,s),s}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}}const fu="yyyy/mm/dd;@",nm="yyyy/mm/dd hh:mm",sm="h:mm A/P",mr=1440*60*1e3;function be(a){const e=Date.UTC(1900,0,1),t=Date.UTC(1900,1,28),r=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());let n=(r-e)/mr;return r>t&&(n+=1),Math.floor(n)+1}function Cn(a){const e=Date.UTC(1900,0,1,0,0,0),t=Date.UTC(1900,1,28,0,0,0),r=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());let n=(r-e)/mr;return r>t&&(n+=1),n+1}function se(a){const e=Date.UTC(1900,0,1),t=Date.UTC(1900,1,28);let r=Math.floor(a)-1;return r>(t-e)/mr&&(r-=1),new Date(e+r*mr)}function du(a){const e=Date.UTC(1900,0,1,0,0,0),t=Date.UTC(1900,1,28,0,0,0);let r=a-1;return r>(t-e)/mr&&(r-=1),r<0&&(r=a),new Date(e+r*mr)}function Nu(a){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(a))return!1;const e=a.replace(/-/g,"/").replace(/T.+/,""),t=new Date(`${e}`);if(Number.isNaN(t.getTime()))return!1;const r=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),u=`${r}-${n}-${s}`;return a.replace(/\//g,"-").split("-").map(o=>o.padStart(2,"0")).join("-")===u}function us(a){return yr.parseDate(a)}function os(a){return yr.parseTime(a)}function _u(a){return yr.getFormatInfo(a).isDate}const Si={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function rn(a){return!!(typeof a=="string"&&/^[0|1]{7}/.test(a)||Si[Number(a)])}function Oi(a){if(!rn(a))return[];if(typeof a=="string"&&/^[0|1]{7}/.test(a)){const e=[];for(let t=1;t<=a.length;t++)`${a[t-1]}`=="1"&&(t===a.length?e.push(0):e.push(t));return e}return Si[Number(a)]||[]}function is(a,e,t=1,r){const n=Oi(t),s=Math.floor(a),u=Math.floor(e),o=u>s?s:u;let i=0;const l=Math.abs(Math.floor(e)-Math.floor(a))+1;for(let c=0;c<l;c++){const h=o+c;if(r&&r.length>0&&r.some(d=>Math.floor(d)===h))continue;const m=gr(h);n.includes(m)||i++}return u>=s?i:-i}function ls(a,e,t=1,r){const n=Oi(t),s=Math.floor(a);let u=s,o=Math.abs(e);for(let i=1;i<=o;i++){const l=e<0?s-i:s+i;if(l<0)return f.create(g.NUM);if(r&&r.length>0&&r.some(h=>Math.floor(h)===l)){o++;continue}const c=gr(l);if(n.includes(c)){o++;continue}u=l}return u}function $(a){if(a.isError())return a;const e=a.getValue();if(a.isString()){let t;if(us(`${e}`))t=us(`${e}`).v;else if(os(`${e}`))t=os(`${e}`).v;else if(Q(e))t=+e;else return f.create(g.VALUE);return t instanceof Date&&(t=Cn(t)),+t<0||+t>2958465?f.create(g.NUM):+t}else{const t=+a.getValue();return t<0||t>2958465?f.create(g.NUM):t}}function gr(a){const e=Math.floor(a)===60;let t=se(a);const r=Date.UTC(1900,1,28),n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return!e&&n<=r&&(t=new Date(n-mr)),t.getUTCDay()}function Ee(a,e,t){switch(t){case 0:return am(a,e);case 1:return um(a,e);case 2:return{days:Math.abs(e-a),yearDays:360};case 3:return{days:Math.abs(e-a),yearDays:365};case 4:return om(a,e);default:return{days:Math.abs(e-a),yearDays:365}}}function am(a,e){const t=se(a),r=a>0?t.getUTCFullYear():1900,n=a>0?t.getUTCMonth()+1:1;let s=a>0?t.getUTCDate():0,u=se(e),o=e>0?u.getUTCFullYear():1900,i=e>0?u.getUTCMonth()+1:1,l=e>0?u.getUTCDate():0;n===2?se(a+1).getUTCMonth()+1===3&&(s=30):s===31&&(s=30),l===31&&(s<30?(u=se(e+1),o=u.getUTCFullYear(),i=u.getUTCMonth()+1,l=u.getUTCDate()):l=30);const c=(o-r)*360,h=e>=a?30-s:-s,m=e>=a?l:l-30,d=(e>=a?i-n-1:i-n+1)*30;return{days:Math.abs(c+h+m+d),yearDays:360}}function um(a,e){const t=se(a),r=a>0?t.getUTCFullYear():1900,n=se(e),s=e>0?n.getUTCFullYear():1900,u=Math.abs(e-a),o=Math.abs(s-r)+1;let i,l;if(s<r){const c=new Date(Date.UTC(s,0,1)),h=new Date(Date.UTC(r,11,31));i=be(c),l=be(h),s===1900&&(i+=1)}else{const c=new Date(Date.UTC(r,0,1)),h=new Date(Date.UTC(s,11,31));i=be(c),l=be(h),r===1900&&(i+=1)}return{days:u,yearDays:(l-i+1)/o}}function om(a,e){const t=se(a),r=a>0?t.getUTCFullYear():1900,n=a>0?t.getUTCMonth()+1:1;let s=a>0?t.getUTCDate():0;const u=se(e),o=e>0?u.getUTCFullYear():1900,i=e>0?u.getUTCMonth()+1:1;let l=e>0?u.getUTCDate():0;s===31&&(s=30),l===31&&(l=30);const c=(o-r)*360,h=e>=a?30-s:-s,m=e>=a?l:l-30,d=(e>=a?i-n-1:i-n+1)*30;return{days:Math.abs(c+h+m+d),yearDays:360}}function im(a){return a%4===0&&a%100!==0||a%400===0}function lm(a){return a%4===0&&a%100!==0||a%400===0||a===1900}const cm=[31,29,31,30,31,30,31,31,30,31,30,31],hm=[31,28,31,30,31,30,31,31,30,31,30,31];function En(a,e){return im(a)?cm[e]:hm[e]}function $s(a){return lm(a)?366:365}function Mi(a,e){switch(e){case 0:case 2:case 4:return 360;case 1:return $s(se(a).getUTCFullYear());case 3:return 365;default:return-1}}function vr(a,e,t){return En(a,e)===t}function wr(a,e){let t=a.getUTCFullYear(),r=a.getUTCMonth();const n=a.getUTCDate();return vr(t,r,n)?(a.setUTCDate(1),a.setUTCMonth(a.getUTCMonth()+e),t=a.getUTCFullYear(),r=a.getUTCMonth(),a.setUTCDate(En(t,r))):a.setUTCMonth(a.getUTCMonth()+e),a}function Vi(a,e,t,r,n){for(let s=0,u=a.length;s<u;s++){const o=a[s];if(e!==o.unitId||t!==o.sheetId)continue;const{startRow:i,startColumn:l,endRow:c,endColumn:h}=o.range;if(r>=i&&r<=c&&n>=l&&n<=h)return!0}return!1}var Ti=(a=>(a[a.Financial=0]="Financial",a[a.Date=1]="Date",a[a.Math=2]="Math",a[a.Statistical=3]="Statistical",a[a.Lookup=4]="Lookup",a[a.Database=5]="Database",a[a.Text=6]="Text",a[a.Logical=7]="Logical",a[a.Information=8]="Information",a[a.Engineering=9]="Engineering",a[a.Cube=10]="Cube",a[a.Compatibility=11]="Compatibility",a[a.Web=12]="Web",a[a.Array=13]="Array",a[a.Univer=14]="Univer",a[a.User=15]="User",a[a.DefinedName=16]="DefinedName",a[a.Table=17]="Table",a))(Ti||{});const Ii=[...Object.values(k),...Object.values(K),...Object.values(q),...Object.values(st),...Object.values(Ie)];function zr(a){return Ii.includes(a)}function xi(a){for(const e of Ii)if(a.indexOf(e)>-1)return!0;return!1}function mm(a){return a[0]==="'"&&a[a.length-1]==="'"?a.substring(1,a.length-1):a}function gm(a){return zr(a)&&a!==q.CLOSE_BRACES&&a!==q.CLOSE_BRACKET&&a!==q.SINGLE_QUOTATION&&a!==q.DOUBLE_QUOTATION||a===" "}const fm=new Set([K.PLUS,K.MINUS,K.MULTIPLY,K.DIVIDED,K.CONCATENATE,K.POWER,K.EQUALS,K.NOT_EQUAL,K.GREATER_THAN,K.GREATER_THAN_OR_EQUAL,K.LESS_THAN,K.LESS_THAN_OR_EQUAL,q.OPEN_BRACKET,q.COMMA,q.COLON,q.OPEN_BRACES,q.OPEN_SQUARE_BRACKET]);function dm(a){return fm.has(a)}const Nm=new Set([K.PLUS,K.MINUS,K.MULTIPLY,K.DIVIDED,K.CONCATENATE,K.POWER,K.EQUALS,K.NOT_EQUAL,K.GREATER_THAN,K.GREATER_THAN_OR_EQUAL,K.LESS_THAN,K.LESS_THAN_OR_EQUAL,q.OPEN_BRACKET,q.COMMA,q.COLON,q.OPEN_BRACES,q.OPEN_SQUARE_BRACKET,st.PERCENTAGE,st.POUND]);function _m(a){return Nm.has(a)}const Yr='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',yo=new RegExp(Yr),Cm="((?![\\[\\]\\/?*\\\\]).)*!",Qt="$",Ys="\\s*?:\\s*?",cs="[A-Za-z]+",hs="[1-9][0-9]*",Hr=`'?(${Yr})?(${Cm})?'?`,Ua=`\\${Qt}?${cs}\\${Qt}?${hs}`,Em=`^(${Ie.AT})?${Hr}${Ua}${Ys}${Ua}$`,bo=new RegExp(Em),Am=`^${Hr}\\s*?${Ua}(${st.POUND})?$`,Ro=new RegExp(Am),pm=`^${Hr}\\${Qt}?${hs}${Ys}\\${Qt}?${hs}$`,So=new RegExp(pm),ym=`^${Hr}\\${Qt}?${cs}${Ys}\\${Qt}?${cs}$`,Oo=new RegExp(ym),bm=`^${Hr}\\s*?\\${Qt}?${hs}$`,Mo=new RegExp(bm),Rm=`^${Hr}\\s*?\\${Qt}?${cs}$`,Vo=new RegExp(Rm),nn="((?![~!@#$%^&*()_+<>?:,./;’，。、‘：“《》？~！@#￥%……（）【】\\[\\]\\/\\\\]).)+",Ui="\\[#.+\\]\\s*?,\\s*?",ms="\\[((?<!#).)*\\]",To=`${ms}${Ys}${ms}`,Sm=`^(${Yr})?${nn}$`,Om=`^(${Yr})?${nn}(${ms}|\\[${Ui}${ms}\\])+$`,Mm=`^(${Yr})?${nn}(\\[${To}\\])?$|^${nn}(\\[${Ui}${To}\\])?$`,Vm=`^(${Yr})?${nn}\\[\\s*#([^\\]]+)\\s*\\]$`,Io=new RegExp(Sm),xo=new RegExp(Om),Uo=new RegExp(Mm),vo=new RegExp(Vm),Tm="{.*?}",wo=new RegExp(Tm,"g");function An(a){return Ro.lastIndex=0,Ro.test(a)}function Im(a){return bo.lastIndex=0,bo.test(a)}function vi(a){return So.lastIndex=0,So.test(a)}function wi(a){return Oo.lastIndex=0,Oo.test(a)}function Di(a){return Mo.lastIndex=0,Mo.test(a)}function Li(a){return Vo.lastIndex=0,Vo.test(a)}function xm(a){return Io.lastIndex=0,Io.test(a)}function Um(a){return xo.lastIndex=0,xo.test(a)}function vm(a){return Uo.lastIndex=0,Uo.test(a)}function wm(a){return vo.lastIndex=0,vo.test(a)}function Dm(a){return wo.lastIndex=0,wo.test(a)}function Cu(a){return An(a)||Im(a)||vi(a)||wi(a)}function va(a){const e={};return Object.keys(a).forEach(t=>{const r=a[t];if(r==null)return!0;e[t]==null&&(e[t]={}),Object.keys(r).forEach(n=>{const s=r[n];e[t][n]=new me(s)})}),e}function Lm(a){const e={};for(const t in a){const r=a[t];if(r!=null){e[t]==null&&(e[t]={});for(const n in r){const s=r[n],u={};s.forValue((o,i,l)=>{u[o]===void 0&&(u[o]={}),u[o][i]=l}),e[t][n]=u}}}return e}const mt="P_1",Lt="R_1",fr="L_1",pn="LR_1",Pi="LO_1",Fi="LET",Dr="LAMBDA",Pm="CUBE",Fm=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),Kr={type:Ae.MUTATION,id:"sheet.mutation.data-validation-formula-mark-dirty",handler(){return!0}},ji={id:"formula.mutation.register-function",type:Ae.MUTATION,handler:()=>!0},gs={id:"formula.mutation.set-array-formula-data",type:Ae.MUTATION,handler:(a,e)=>!0},jm=/[^0-9]/g,Bm=/[^A-Za-z]/g;function Jr(a){let e=a[0]==="$";const t=a.substring(1);let r=t.indexOf("$")>-1;return Xe.isStringNumber(t)&&e&&!r&&(e=!1,r=!0),e&&r?xe.ALL:e?xe.COLUMN:r?xe.ROW:xe.NONE}function km(a){const e=a.split("!");e.length>1&&(a=e[e.length-1]);const t=a.split(":");return t.length>1?{startAbsoluteRefType:Jr(t[0]),endAbsoluteRefType:Jr(t[1])}:{startAbsoluteRefType:Jr(t[0])}}function Do(a=xe.NONE){let e="",t="";return a===xe.ROW?e="$":a===xe.COLUMN?t="$":a===xe.ALL&&(e="$",t="$"),{rowAbsoluteString:e,columnAbsoluteString:t}}function Pt(a){const{startColumn:e,startRow:t,endColumn:r,endRow:n,startAbsoluteRefType:s,endAbsoluteRefType:u,rangeType:o=rt.NORMAL}=a,i=Do(s),l=Do(u);if(o===rt.ROW||o===rt.ALL){const m=`${i.rowAbsoluteString}${t+1}`,d=`${l.rowAbsoluteString}${n+1}`;return`${m}:${d}`}if(o===rt.COLUMN){const m=`${i.columnAbsoluteString}${Xe.chatAtABC(e)}`,d=`${l.columnAbsoluteString}${Xe.chatAtABC(r)}`;return`${m}:${d}`}const c=`${i.columnAbsoluteString}${Xe.chatAtABC(e)}${i.rowAbsoluteString}${t+1}`,h=`${l.columnAbsoluteString}${Xe.chatAtABC(r)}${l.rowAbsoluteString}${n+1}`;return c===h?c:`${c}:${h}`}function Bi(a,e){return`${Hi(a)}!${Pt(e)}`}function ki(a,e,t){return ds(a)||ds(e)?`'[${Ns(a)}]${Ns(e)}'!${Pt(t)}`:`[${a}]${e}!${Pt(t)}`}function fs(a){const{unitId:e,sheetName:t,range:r}=a;return e!=null&&e.length>0&&t!=null&&t.length>0?ki(e,t,r):t!=null&&t.length>0?Bi(t,r):Pt(r)}function Xn(a){const e=Number.parseInt(a.replace(jm,""))-1,t=Xe.ABCatNum(a.replace(Bm,"")),r=Jr(a);return{row:e,column:t,absoluteRefType:r}}function Hs(a){const e=yo.exec(a);let t="";e!=null&&(t=e[0].trim(),t=wa(t.slice(1,t.length-1)),a=a.replace(yo,""));const r=a.indexOf("!");let n="",s="";return r>-1?(n=a.substring(0,r),n[0]==="'"&&n[n.length-1]==="'"&&(n=n.substring(1,n.length-1)),n=wa(n),s=a.substring(r+1)):s=a,{refBody:s,sheetName:n,unitId:t}}function Lr(a){const{refBody:e,sheetName:t,unitId:r}=Hs(a),n=e.indexOf(":");if(n===-1){const _=Xn(e),C=_.row,E=_.column,p=_.absoluteRefType;return{unitId:r,sheetName:t,range:{startRow:C,startColumn:E,endRow:C,endColumn:E,startAbsoluteRefType:p,endAbsoluteRefType:p}}}const s=e.substring(0,n),u=e.substring(n+1),o=Xn(s),i=Xn(u),l=o.row>i.row?i.row:o.row,c=o.column>i.column?i.column:o.column,h=o.row>i.row?o.row:i.row,m=o.column>i.column?o.column:i.column;let d=rt.NORMAL;return Number.isNaN(l)&&Number.isNaN(h)?d=rt.COLUMN:Number.isNaN(c)&&Number.isNaN(m)&&(d=rt.ROW),{unitId:r,sheetName:t,range:{startRow:l,startColumn:c,endRow:h,endColumn:m,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:i.absoluteRefType,rangeType:d}}}const $m=["LOG10"];function en(a){const e=$i(a);if(!Cu(e)||$m.includes(e.toUpperCase().trim()))return!1;const{range:t}=Lr(e);return!(t.endColumn>=Ur)}function $i(a){const e=[];let t=!1;for(let r=0,n=a.length;r<n;r++){const s=a[r];if(s===tm&&!t)e.push(s);else{if(!t&&(s===Ie.AT||s===Ie.MINUS||s===Ie.PLUS))continue;e.push(s),t=!0}}return e.join("")}function Ym(a,e){const t=a?.split(",")||[];return a===""||t.length===0?[]:Yi(a)?t.map(r=>{const n=Lr(r);return{unitId:n.unitId,sheetId:e(n.sheetName),range:n.range,sheetName:n.sheetName}}):[]}function Yi(a){return(a?.split(",")||[]).every(e=>en(e.trim()))}function ds(a){return a.length===0?!1:!!(xi(a)||Hm(a)||Gm(a)||Xm(a)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?（）]/.test(a))}function Hi(a){return ds(a)?`'${Ns(a)}'`:a}function Ns(a){return a.replace(/'/g,"''")}function wa(a){return a.replace(/''/g,"'")}function Hm(a){const e=/^([A-Z]+)([1-9][0-9]*)$/.exec(a);if(!e)return!1;const[,t,r]=e,n=Number(r);if(n<1||n>es)return!1;const s=Ei(t);return!(s<1||s>Ur)}function Gm(a){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(a)}function Xm(a){return!new RegExp("^\\p{Letter}","u").test(a.charAt(0))}function Gi(a){const e=a.indexOf("[");return e===-1?{tableName:a,struct:""}:{tableName:a.slice(0,e),columnStruct:a.slice(e)}}var qm=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Wm=(a,e)=>(t,r)=>e(t,r,a);let _s=class extends Me{constructor(a){super(),N(this,"_definedNameMap",{}),N(this,"_nameCacheMap",{}),N(this,"_update$",new Dt),N(this,"update$",this._update$.asObservable()),N(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),N(this,"_currentRange$",new Dt),N(this,"currentRange$",this._currentRange$.asObservable()),N(this,"_focusRange$",new Dt),N(this,"focusRange$",this._focusRange$.asObservable()),this._univerInstanceService=a}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(a,e){var t;const{sheetName:r}=Hs(e);return(t=this._univerInstanceService.getUnit(a))==null?void 0:t.getSheetBySheetName(r)}focusRange(a,e){const t=this.getValueById(a,e);t!==void 0&&this._focusRange$.next({...t,unitId:a})}setCurrentRange(a){this._currentRange=a,this._currentRange$.next(a)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return Pt(this._currentRange.range)}registerDefinedNames(a,e){this._definedNameMap[a]=e,this._updateCache(a),this._update()}registerDefinedName(a,e){this._definedNameMap[a]===void 0&&(this._definedNameMap[a]={}),this._definedNameMap[a][e.id]=e,this._updateCache(a),this._update()}removeDefinedName(a,e){var t;(t=this._definedNameMap[a])==null||delete t[e],this._updateCache(a),this._update()}removeUnitDefinedName(a){delete this._definedNameMap[a],this._updateCache(a),this._update()}getDefinedNameMap(a){return this._definedNameMap[a]}getValueByName(a,e){const t=this._nameCacheMap[a];if(t)return t[e.toLowerCase()]||null;const r=this._definedNameMap[a];if(r===void 0)return null;let n=null;for(const s of Object.values(r))if(s.name===e){n=s;break}return n&&(this._nameCacheMap[a]=this._nameCacheMap[a]||{},this._nameCacheMap[a][e.toLowerCase()]=n),n}getValueById(a,e){var t;return(t=this._definedNameMap[a])==null?void 0:t[e]}hasDefinedName(a){return this._definedNameMap[a]===void 0?!1:(Array.from(Object.values(this._definedNameMap[a])).length||0)!==0}getAllDefinedNames(){return this._definedNameMap}getDefinedNameByRefString(a,e){if(this._definedNameMap[a]){for(const[t,r]of Object.entries(this._definedNameMap[a]))if(r.formulaOrRefString===e)return r}}_update(){this._update$.next(null)}_updateCache(a){const e=this._definedNameMap[a];if(e===void 0){delete this._nameCacheMap[a];return}this._nameCacheMap[a]={};for(const t of Object.values(e))this._nameCacheMap[a][t.name.toLowerCase()]=t}};_s=qm([Wm(0,pr)],_s);const br=Ye("univer.formula.defined-names.service"),Qm=(a,e)=>{const{unitId:t,id:r}=e;return{...a.get(br).getValueById(t,r),unitId:t}},Eu={id:"formula.mutation.set-defined-name",type:Ae.MUTATION,handler:(a,e)=>{if(e==null)return!1;const t=a.get(br),{id:r,unitId:n,name:s,formulaOrRefString:u,comment:o,hidden:i,localSheetId:l,formulaOrRefStringWithPrefix:c}=e;return t.registerDefinedName(n,{id:r,name:s.trim(),formulaOrRefString:u.trim(),comment:o?.trim(),hidden:i,localSheetId:l,formulaOrRefStringWithPrefix:c}),!0}},Xi={id:"formula.mutation.remove-defined-name",type:Ae.MUTATION,handler:(a,e)=>{if(e==null)return!1;const t=a.get(br),{unitId:r,id:n}=e;return t.removeDefinedName(r,n),!0}},Gs={id:"formula.mutation.set-feature-calculation",type:Ae.MUTATION,handler:()=>!0},Xs={id:"formula.mutation.remove-feature-calculation",type:Ae.MUTATION,handler:()=>!0},Au={id:"formula.mutation.set-formula-calculation-start",type:Ae.MUTATION,handler:()=>!0},qi={id:"formula.mutation.set-trigger-formula-calculation-start",type:Ae.MUTATION,handler:()=>!0},pu={id:"formula.mutation.set-formula-string-batch-calculation",type:Ae.MUTATION,handler:()=>!0},yu={id:"formula.mutation.set-formula-string-batch-calculation-result",type:Ae.MUTATION,handler:()=>!0},bu={id:"formula.mutation.set-formula-calculation-stop",type:Ae.MUTATION,handler:()=>!0},sn={id:"formula.mutation.set-formula-calculation-notification",type:Ae.MUTATION,handler:()=>!0},qs={id:"formula.mutation.set-formula-calculation-result",type:Ae.MUTATION,handler:()=>!0},Ru={id:"formula.mutation.set-formula-dependency-calculation",type:Ae.MUTATION,handler:()=>!0},Cs={id:"formula.mutation.set-formula-dependency-calculation-result",type:Ae.MUTATION,handler:()=>!0},Su={id:"formula.mutation.set-cell-formula-dependency-calculation",type:Ae.MUTATION,handler:()=>!0},Ou={id:"formula.mutation.set-cell-formula-dependency-calculation-result",type:Ae.MUTATION,handler:()=>!0},Mu={id:"formula.mutation.set-query-formula-dependency",type:Ae.MUTATION,handler:()=>!0},Vu={id:"formula.mutation.set-query-formula-dependency-result",type:Ae.MUTATION,handler:()=>!0},Tu={id:"formula.mutation.set-query-formula-dependency-all",type:Ae.MUTATION,handler:()=>!0},Iu={id:"formula.mutation.set-query-formula-dependency-all-result",type:Ae.MUTATION,handler:()=>!0},xu={id:"formula.mutation.set-formula-data",type:Ae.MUTATION,handler:(a,e)=>!0},Uu={id:"formula.mutation.set-image-formula-data",type:Ae.MUTATION,handler:(a,e)=>!0},yn={id:"formula.mutation.set-other-formula",type:Ae.MUTATION,handler:()=>!0},bn={id:"formula.mutation.remove-other-formula",type:Ae.MUTATION,handler:()=>!0};class Wi extends Me{constructor(){super(),N(this,"_tableMap",new Map),N(this,"_tableOptionMap",new Map),N(this,"_update$",new Dt),N(this,"update$",this._update$.asObservable()),this.registerTableOptionMap(Te.ALL,Te.ALL),this.registerTableOptionMap(Te.DATA,Te.DATA),this.registerTableOptionMap(Te.HEADERS,Te.HEADERS),this.registerTableOptionMap(Te.TOTALS,Te.TOTALS),this.registerTableOptionMap(Te.THIS_ROW,Te.THIS_ROW)}dispose(){super.dispose(),this._update$.complete(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;(r=this._tableMap.get(e))==null||r.delete(t),this._update()}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;this._tableMap.get(e)==null&&this._tableMap.set(e,new Map),(n=this._tableMap.get(e))==null||n.set(t,r),this._update()}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}getTable(e,t){var r;return(r=this._tableMap.get(e))==null?void 0:r.get(t)}hasTable(e,t){const r=this._tableMap.get(e);return r?r.keys().some(n=>n.toLowerCase()===t.toLowerCase()):!1}_update(){this._update$.next(null)}}const Gr=Ye("univer.formula.super-table.service"),Qi={id:"formula.mutation.set-super-table",type:Ae.MUTATION,handler:(a,e)=>{const{unitId:t,tableName:r,reference:n}=e;return a.get(Gr).registerTable(t,r,n),!0}},Ki={id:"formula.mutation.remove-super-table",type:Ae.MUTATION,handler:(a,e)=>{const{unitId:t,tableName:r}=e;return a.get(Gr).remove(t,r),!0}},Zi={id:"formula.mutation.set-super-table-option",type:Ae.MUTATION,handler:(a,e)=>{const{tableOption:t,tableOptionType:r}=e;return a.get(Gr).registerTableOptionMap(t,r),!0}},Da=new Ft(1e5);function dr(a){const e=Da.get(a);if(e)return e;const t=Lr(a);return Da.set(a,t),Lr(a)}function Km(){Da.clear()}var je=(a=>(a[a.NORMAL=0]="NORMAL",a[a.NUMBER=1]="NUMBER",a[a.STRING=2]="STRING",a[a.FUNCTION=3]="FUNCTION",a[a.REFERENCE=4]="REFERENCE",a[a.ARRAY=5]="ARRAY",a[a.DEFINED_NAME=6]="DEFINED_NAME",a[a.TABLE=7]="TABLE",a))(je||{});function La(a){let e="";for(const t of a)typeof t=="string"?e+=t:e+=t.token;return e}class ae{constructor(){N(this,"_parent"),N(this,"_token",Lt),N(this,"_children",[]),N(this,"_lambdaId"),N(this,"_functionDefinitionPrivacyVar"),N(this,"_lambdaParameter",""),N(this,"_startIndex",-1),N(this,"_endIndex",-1),N(this,"_definedNames",[])}dispose(){var e;this._children.forEach(t=>{typeof t!="string"&&t.dispose()}),(e=this._functionDefinitionPrivacyVar)==null||e.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){const r=this._getIndexInParent(e);r!=null&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){const t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){const t=this._getIndexInParent(e);t!=null&&this.getChildren().splice(t,1)}serialize(){const e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let s=0;s<n;s++){const u=t[s];u instanceof ae?r.push(u.serialize()):r.push(u)}return{token:e,st:this._startIndex,ed:this._endIndex,children:r}}_getIndexInParent(e){const t=this.getChildren(),r=t.length;for(let n=0;n<r;n++)if(t[n]===e)return n}}const zi=2e3,Na=new Ft(zi),_a=new Ft(zi);class Pr extends Me{constructor(){super(...arguments),N(this,"_currentLexerNode",new ae),N(this,"_upLevel",0),N(this,"_segment",""),N(this,"_bracketState",[]),N(this,"_squareBracketState",0),N(this,"_bracesState",0),N(this,"_singleQuotationState",0),N(this,"_doubleQuotationState",0),N(this,"_lambdaState",!1),N(this,"_colonState",!1),N(this,"_formulaErrorCount",0),N(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),Na.clear(),_a.clear()}getUpLevel(){return this._upLevel}isColonClose(){return this._colonState===!1}isColonOpen(){return this._colonState===!0}isDoubleQuotationClose(){return this._doubleQuotationState===0}isLambdaOpen(){return this._lambdaState===!0}isLambdaClose(){return this._lambdaState===!1}isSingleQuotationClose(){return this._singleQuotationState===0}isBracesClose(){return this._bracesState===0}isBracketClose(){return this._bracketState.length===0}isSquareBracketClose(){return this._squareBracketState===0}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){const r=this._getCurrentParamIndex(e,t);if(r==null||r===g.VALUE)return;const n=r[0];if(typeof n=="string")return;let s=n.getParent(),u=n;for(;s;){const o=s.getToken();if(o!==mt&&!zr(o)&&s.getStartIndex()!==-1){const i=s.getChildren().indexOf(u);return{functionName:o,paramIndex:i}}u=s,s=s.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===q.CLOSE_BRACKET||n===" ")&&r>=0;)n===q.CLOSE_BRACKET&&t++,n=e[--r];const s=this._getCurrentParamIndex(e,e.length-2);if(s==null||s===g.VALUE)return 0;const u=s[0];if(typeof u=="string")return 0;let o=u.getParent(),i=0;for(s[1]===q.OPEN_BRACKET&&i++;o;){const l=o.getToken();l!==mt&&l!==q.COLON&&o.getStartIndex()!==-1&&l.toUpperCase()!==Dr&&(t===0?i+=1:t--),o=o.getParent()}return i}sequenceNodesBuilder(e){const t=_a.get(e);if(t)return[...t];const r=this._getSequenceArray(e);if(r.length===0)return;const n=this.getSequenceNode(r);return _a.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){const s=this.sequenceNodesBuilder(e);if(s==null)return e;let u="";e.substring(0,1)===K.EQUALS&&(u=K.EQUALS);for(let o=0,i=s.length;o<i;o++){const l=s[o];if(typeof l!="string"&&l.nodeType===je.REFERENCE){const{token:c,endIndex:h}=l,m=dr(c);if(m==null)continue;const{range:d,sheetName:_,unitId:C}=m,E={...d,startAbsoluteRefType:t,endAbsoluteRefType:r},p=fs({range:E,unitId:C,sheetName:_||n}),y=p.length-c.length;s[o]={...l,token:p,endIndex:h+y};for(let b=o+1;b<i;b++){const O=s[b];typeof O!="string"&&(O.startIndex+=y,O.endIndex+=y)}}}return`${u}${La(s)}`}moveFormulaRefOffset(e,t,r,n=!1){const s=this.sequenceNodesBuilder(e);if(s==null)return e;const u=[];for(let o=0,i=s.length;o<i;o++){const l=s[o];if(typeof l=="string"||l.nodeType!==je.REFERENCE){u.push(l);continue}const{token:c}=l,h=dr(c),{sheetName:m,unitId:d}=h;let _=h.range;if(!n&&_.startAbsoluteRefType===xe.ALL&&_.endAbsoluteRefType===xe.ALL){u.push(l);continue}else _=cu(_,t,r,n);let C="";Ih(_)?C=fs({range:_,unitId:d,sheetName:m}):C=g.REF,u.push({...l,token:C})}return`=${La(u)}`}_formulaSpellCheck(){if(this._currentLexerNode.getChildren().length===0)return!0;const e=this._currentLexerNode.getChildren()[0];return e instanceof ae?!0:!!(this._passArrayOperator(e)||yt.has(e)||Gn.has(e)||e===Ie.AT||e===q.COMMA||e===q.COLON||e===q.OPEN_BRACKET)}_passArrayOperator(e){if(e.length===0||!(e[0]==="{"&&e[e.length-1]==="}"))return!1;const t=this._currentLexerNode.getChildren(),r=t[t.length-1];return r instanceof ae?!1:!!yt.has(r)}getSequenceNode(e){const t=[];let r=!1;for(let n=0,s=e.length;n<s;n++){const u=e[n],o=e[n-1],{segment:i,currentString:l}=u;if(l===q.DOUBLE_QUOTATION&&(r=!0),(i!==""||n===0)&&n!==s-1){t.push(l);continue}let c=o?.segment||"";const h=n-c.length;let m=n-1;const d=n-1;if(n===s-1&&this._isLastMergeString(l)&&(c+=l,m+=1),c===""||Hn.has(c)){t.push(l);continue}const _=c.trim(),C=$i(_);r===!0&&_[_.length-1]===q.DOUBLE_QUOTATION&&_[0]!==q.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,je.STRING,c,h,m,d)):An(C)&&en(C)?this._processPushSequenceNode(t,je.REFERENCE,c,h,m,d):Xe.isStringNumber(_)?this._processPushSequenceNode(t,je.NUMBER,c,h,m,d):_.length>0&&this._processPushSequenceNode(t,je.FUNCTION,c,h,m,d),(n!==s-1||!this._isLastMergeString(l))&&t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,s,u){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:s},u)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===q.DOUBLE_QUOTATION||Xe.isStringNumber(e)||!zr(e)}_mergeSequenceNodeReference(e){const t=[],r=e.length;let n=0;for(;n<r;){const s=e[n];if(typeof s=="string"){const u=e[n-1];if(s.trim()===q.CLOSE_BRACES&&u!=null&&typeof u!="string"&&u.nodeType===je.FUNCTION&&u.token.trim().substring(0,1)===q.OPEN_BRACES){u.nodeType=je.ARRAY,u.token+=s,u.endIndex+=s.length,n++;continue}t.push(s)}else{const u=e[n+1],o=e[n+2];u===q.COLON&&typeof s!="string"&&o!=null&&typeof o!="string"&&en((s.token+u+o.token).trim())&&(s.nodeType=je.REFERENCE,s.token+=u+o.token,s.endIndex=o.endIndex,n+=2),t.push(s)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){const t=[];for(const r of e){if(typeof r!="string"){const n=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(n){const s=n[1],u=n[3];if(en(u.trim())){const o=s.length,i=r.startIndex,l=r.startIndex+o-1,c={nodeType:je.NORMAL,token:s,startIndex:i,endIndex:l},h={nodeType:je.REFERENCE,token:u,startIndex:l+1,endIndex:r.endIndex};t.push(c),t.push(h);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){const n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r){var n;if(t===!0){const h=Na.get(e),m=r&&((n=this._simpleCheckDefinedName)==null?void 0:n.call(this,e,r));if(h&&!m)return h}this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Lt);const s=[];let u=this._nodeMaker(e,s);if(u===g.VALUE||s.length===0)return u;let o=!1,i="",l=[];if(r){const{hasDefinedName:h,sequenceString:m,definedNames:d}=this._handleDefinedName(s,r);o=h,i=m,l=d}if(o&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken(Lt),u=this._nodeMaker(`=${i}`),u===g.VALUE))return u;const c=this._getTopNode(this._currentLexerNode);if(c&&(this._currentLexerNode=c),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return g.VALUE;Na.set(e,this._currentLexerNode)}return o&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_handleDefinedName(e,t){const{unitId:r,getValueByName:n,getSheetName:s}=t;if(r==null)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};const u=this.getSequenceNode(e);let o="",i=!1;const l=[];for(let c=0,h=u.length;c<h;c++){const m=u[c];if(typeof m=="string"){o+=m;continue}const{nodeType:d,token:_}=m;let C=_;if(d===je.REFERENCE||d===je.FUNCTION){d===je.FUNCTION&&(C=this._getHasSheetNameDefinedName(_,r,t));const E=n(r,C);if(E){const p=E.formulaOrRefString,y=this._handleNestedDefinedName(p,t);if(y==null||typeof y!="object")o+=y||g.NAME,i=!0,l.push(C);else if(typeof y=="object"){const{sequenceString:b,definedNames:O}=y;o+=b,O.forEach(M=>{l.push(M)}),i=!0}}else this._checkDefinedNameDirty(C,t)?(o+=g.NAME,i=!0,l.push(C)):o+=C}else o+=C}return{sequenceString:o,hasDefinedName:i,definedNames:l}}_getHasSheetNameDefinedName(e,t,r){if(!e.includes("!"))return e;const n=e.split("!");if(n.length!==2)return e;const s=n[0],u=n[1].trim(),o=r.getValueByName(t,u);if(!o)return e;const i=o.localSheetId;if(i!==void 0){if(i==="AllDefaultWorkbook")return u;const l=r.getSheetName(t,i);if(s===l)return u}else return u;return e}_handleNestedDefinedName(e,t){const r=[],n=this._nodeMaker(e,r);return n===g.VALUE||r.length===0?n:this._handleDefinedName(r,t)}_simpleCheckDefinedName(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),u=n;if(u!=null&&s[u]!=null){const o=Object.keys(s[u]);for(let i=0,l=o.length;i<l;i++){const c=o[i];if(e.indexOf(c)>-1)return!0}}return!1}_checkDefinedNameDirty(e,t){const{getDirtyDefinedNameMap:r,unitId:n}=t,s=r(),u=n;if(u!=null&&s[u]!=null){const o=Object.keys(s[u]);for(let i=0,l=o.length;i<l;i++)if(o[i]===e)return!0}return!1}_suffixExpressionHandler(e){var t;const r=e.getChildren();if(!r)return!1;const n=r.length,s=[],u=[];let o=!0;for(let i=0;i<n;i++){const l=r[i];if(l instanceof ae)o=this._suffixExpressionHandler(l),s.push(l);else{const c=l.trim();if(c==="")continue;if(yt.has(c)){if(c===K.PLUS&&this._deletePlusForPreNode(r[i-1]))continue;if(c!==K.PLUS&&c!==K.MINUS&&this._deletePlusForPreNode(r[i-1]))return!1;for(;u.length>0;){const h=(t=u[u.length-1])==null?void 0:t.trim();if(!h||h===q.OPEN_BRACKET)break;const m=Hn.get(h),d=Hn.get(c);if(m===void 0||d===void 0)break;if(d>=m)s.push(u.pop());else break}u.push(l)}else if(c===q.OPEN_BRACKET)u.push(l);else if(c===q.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(s,u,r,i);else{if(this._checkCloseBracket(r[i-1]))return!1;s.push(l)}}}return o?this._processSuffixExpressionRemain(s,u,e):!1}_processSuffixExpressionRemain(e,t,r){const n=e.length,s=e[n-1];for(;t.length>0;){const u=t.pop();if(!(s instanceof ae)&&(u===q.OPEN_BRACKET||u===q.CLOSE_BRACKET))return!1;e.push(u)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var s;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){const u=(s=t[t.length-1])==null?void 0:s.trim();if(!u)break;if(u===q.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===q.CLOSE_BRACKET||e instanceof ae}_checkOpenBracket(e){return e===q.OPEN_BRACKET}_checkOperator(e){return e==null||e instanceof ae?!1:yt.has(e)}_deletePlusForPreNode(e){if(e==null)return!0;if(!(e instanceof ae)){const t=e.trim();if(yt.has(t)||t===q.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new ae}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){const e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){const t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){const e=this._currentLexerNode.getChildren();if(e&&e.length>0){const t=e[e.length-1];if(t instanceof ae)return t}return!1}_getLastChildCurrent(){const e=this._currentLexerNode.getChildren();return e&&e.length>0?e[e.length-1]:!1}_setParentCurrentLexerNode(){const e=this._currentLexerNode.getParent();return e?(this._currentLexerNode=e,!0):!1}_setAncestorCurrentLexerNode(){var e,t,r,n,s,u;const o=(e=this._currentLexerNode)==null?void 0:e.getParent();let i=!1;if(o&&o.getToken()===fr){if((t=o?.getParent())!=null&&t.getParent()){const l=(n=(r=this._currentLexerNode.getParent())==null?void 0:r.getParent())==null?void 0:n.getParent();l&&(this._currentLexerNode=l),i=!0}}else if(o!=null&&o.getParent()){const l=(s=this._currentLexerNode.getParent())==null?void 0:s.getParent();l&&(this._currentLexerNode=l),i=!0}for(let l=0;l<this._upLevel;l++){const c=(u=this._currentLexerNode)==null?void 0:u.getParent();c&&(this._currentLexerNode=c),this._currentLexerNode?i=!0:i=!1}return i}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(r!==""){const n=this._currentLexerNode.getChildren();if(!(r instanceof ae)&&this.isColonOpen()){const s=new ae;s.setToken(r),s.setParent(this._currentLexerNode),r=s}t?n.unshift(r):n.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){const n=new ae;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;t!=null&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){const r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&dm(r))return!0;if(Gn.has(r)){const s=this._findSecondLastNonSpaceToken(e,t);if(s==null||_m(s))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){const s=e[r];if(s!==" "&&(n++,n===2))return s;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){const n=e[r];if(n!==" ")return n;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===q.OPEN_BRACKET||e===q.COMMA||e===K.EQUALS||e===""}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!yt.has(e)}_getSequenceArray(e){const t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new ae,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==st.POUND)return!0;let s=r[++n];for(;s===" ";)s=r[++n];return!!zr(s)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<po.length;r++){const n=po[r],s=t.slice(e,e+n).join("").toUpperCase();if(zt.has(s))return s}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===K.EQUALS&&(n=n.substring(1));const s=n.split(""),u=s.length;this._resetTemp(),this._formulaErrorLastTokenCheck(s,u-1)&&this._formalErrorOccurred();let o=0;for(;o<u;){const i=s[o];if(r===o)return[this._currentLexerNode,i];if(i===st.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(o,s)){const l=this._findErrorObject(o,s);if(l==null)return g.VALUE;this._pushNodeToChildren(l);for(let c=0;c<l.length;c++){const h=s[o];this._pushSegment(h),this._addSequenceArray(t,h,o),o++}this._resetSegment();continue}else if(i===q.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,o),this._resetSegment()),this._openBracket(1),this._closeLambda();const l=s[o+1];if(l&&l===q.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&o!==u-1)return g.VALUE;this._addSequenceArray(t,i,o),o++,this._addSequenceArray(t,l,o),o++,this._closeBracket();continue}else l&&this._newAndPushCurrentLexerNode(mt,o)}else this._pushNodeToChildren(i),this._openBracket(0),this._resetSegment();else if(i===q.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(s,o-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();const l=this._getCurrentBracket();if(l===0)this._pushNodeToChildren(i);else if(l===1){const c=s[o+1];if(c&&c===q.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&o!==u-1)return g.VALUE;this._newAndPushCurrentLexerNode(fr,o,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&o!==u-1)return g.VALUE}else return g.VALUE;this._closeBracket()}else if(i===q.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(i),this._openBraces(),!this._formulaSpellCheck())return g.VALUE}else if(i===q.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(i),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(i===q.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(i),this._openSquareBracket();else if(i===q.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(i),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(i);else if(i===q.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{const l=s[o+1];l&&l===q.DOUBLE_QUOTATION?o++:this._closeDoubleQuotation()}this._pushSegment(i)}else if(i===q.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),this._segmentCount()===0&&this._resetSegment();else{const l=s[o+1];if(l&&l===q.SINGLE_QUOTATION){this._pushSegment(i),this._addSequenceArray(t,i,o),o++,this._pushSegment(l),this._addSequenceArray(t,l,o),o++;continue}else this._closeSingleQuotation()}this._pushSegment(i)}else if(i===q.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(s,o-1)&&this._formalErrorOccurred();const l=this._getCurrentBracket();if(l===1||l==null){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&o!==u-1&&l!=null)return g.VALUE;this._newAndPushCurrentLexerNode(mt,o)}else{const c=new ae;c.setToken(Pm);const h=new ae;h.setToken(mt),h.changeToParent(c);const m=this._currentLexerNode.getParent();if(m&&m.getToken()===q.COLON){const d=m.getParent();if(!d)return g.VALUE;m.changeToParent(h),d.setChildren([]),c.changeToParent(d)}else return g.VALUE;this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=c,this._newAndPushCurrentLexerNode(mt,o)}}else if(i===q.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){const l=new ae;l.setToken(i);const c=new ae;c.setToken(mt),c.setParent(l);const h=new ae;h.setToken(mt),h.setParent(l),l.getChildren().push(c,h);let m=l,d=0;if(this._segmentCount()>0){let _,C,E=0;const p=this._segment.trim(),y=p[0],b=p[1];if(y===Ie.MINUS&&(_=new ae,_.setToken(Ie.MINUS),_.setIndex(o-this._segment.length,o-this._segment.length),E++),y===Ie.AT||b===Ie.AT){C=new ae,C.setToken(Ie.AT);const M=o-this._segment.length+E;C.setIndex(M,M),_&&(_.addChildren(C),C.setParent(_)),E++}if(E>0&&(this._segment=p.slice(E)),d=E,C)if(C.addChildren(l),l.setParent(C),C.getParent()){const M=C.getParent();M&&(m=M)}else m=C;else _&&(m=_,_.addChildren(l),l.setParent(_));const O=new ae;O.setToken(this._segment),O.setParent(c),O.setIndex(o-this._segment.length,o-1),c.getChildren().push(O),this._resetSegment()}else{const _=this._getLastChildCurrentLexerNode();_&&_.changeToParent(c)}this._setCurrentLexerNode(m),this._currentLexerNode=h,this._openColon(d)}else if(Gn.has(i)&&this._checkSimilarErrorToken(i,o,s)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);const l=new ae;l.setToken(i),l.setIndex(o-1,o-1);const c=this._getLastChildCurrent();c instanceof ae?c.changeToParent(l):c!==!1&&(l.getChildren().push(c),this._removeLastChild()),this._pushNodeToChildren(l),l.setParent(this._currentLexerNode),this._resetSegment()}else if(yt.has(i)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let l=this._segment.trim();if(i===K.MINUS&&l===""){const c=this._findPreviousToken(s,o-1)||"",h=this._findNextToken(s,o+1)||"";if(this._unexpectedEndingTokenExcludeOperator(c)&&this._isOperatorToken(h)){this._pushNodeToChildren("0"),this._pushNodeToChildren(K.MINUS),this._addSequenceArray(t,i,o),this._resetSegment(),o++;continue}else if(this._unexpectedEndingToken(c))if(h===K.PLUS){this._pushSegment(K.MINUS),this._addSequenceArray(t,i,o),this._addSequenceArray(t,K.PLUS,o+1),o+=2;continue}else{this._pushSegment(K.MINUS),this._addSequenceArray(t,i,o),o++;continue}}else if(this._segment.length>0&&this._isScientificNotation(s,o,i)){this._pushSegment(i),this._addSequenceArray(t,i,o),o++;continue}else this._segment.length>0&&l===""?l=this._segment:(this._pushNodeToChildren(this._segment),l="");if(i===K.LESS_THAN||i===K.GREATER_THAN){const c=s[o+1];if(c&&yt.has(i+c)){this._pushNodeToChildren(l+i+c),this._resetSegment(),this._addSequenceArray(t,i,o),o++,this._addSequenceArray(t,c,o),o++;continue}else this._pushNodeToChildren(l+i)}else this._pushNodeToChildren(l+i);this._resetSegment()}else(this._segment!==""||i!==" ")&&this._pushSegment(i);this._addSequenceArray(t,i,o),o++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return g.VALUE}_isScientificNotation(e,t,r){const n=e[t-2];if(n&&Number.isNaN(Number(n))||!(r===K.MINUS||r===K.PLUS))return!1;const s=e[t+1];if(s&&Number.isNaN(Number(s)))return!1;const u=e[t-1];return u&&u.toUpperCase()==="E"}_addSequenceArray(e,t,r){e?.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}getNewFormulaWithPrefix(e,t){return null}getFormulaExprTree(e,t,r,n,s){return null}}function Zm(a,e,t,r,n,s,u){const o=u?.f||"",i=u?.si||"",l=bt(o),c=vt(i),h=a.getValue(n,s),m=h?.f||"",d=h?.si||"",_=h?.x||0,C=h?.y||0;function E(){var p;if(bt(m)&&vt(d)&&_===0&&C===0){const y=(p=t?.[d])==null?void 0:p.f;y?r.set(d,y):r.set(d,m)}}l&&c?(d!==i&&E(),a.setValue(n,s,{f:o,si:i}),t[i]={f:o,r:n,c:s},e.setValue(n,s,{f:o,si:i})):l&&!c?(m!==o&&E(),a.setValue(n,s,{f:o}),e.setValue(n,s,{f:o})):!l&&c?(d!==i&&E(),a.setValue(n,s,{f:"",si:i})):!l&&!c&&a.getValue(n,s)&&(E(),a.realDeleteValue(n,s),e.setValue(n,s,null))}function zm(a,e,t,r){const n=a?.getValue(t,r);if(n==null)return!0;const s=[];a.forValue((c,h,m)=>{c===t&&h===r||No.intersects(m,n)&&s.push(m)});const{startRow:u,startColumn:o,endRow:i,endColumn:l}=n;for(let c=u;c<=i;c++)for(let h=o;h<=l;h++){let m=!1;const d=Dh(c,h);s.some(_=>No.contains(_,d)?(m=!0,!0):!1),m||e.realDeleteValue(c,h)}}var Jm=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Lo=(a,e)=>(t,r)=>e(t,r,a);let Nr=class extends Me{constructor(a,e){super(),N(this,"_arrayFormulaRange",{}),N(this,"_arrayFormulaCellData",{}),N(this,"_unitImageFormulaData",{}),this._univerInstanceService=a,this._lexerTreeBuilder=e}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={},this._unitImageFormulaData={}}clearPreviousArrayFormulaCellData(a){Object.keys(a).forEach(e=>{const t=a[e];if(t==null)return!0;Object.keys(t).forEach(r=>{var n,s,u,o;const i=t[r],l=(s=(n=this._arrayFormulaRange)==null?void 0:n[e])==null?void 0:s[r];if(l==null)return!0;const c=new me(l);let h=new me;((u=this._arrayFormulaCellData[e])==null?void 0:u[r])!=null&&(h=new me((o=this._arrayFormulaCellData[e])==null?void 0:o[r])),i.forValue((m,d)=>{const _=c.getValue(m,d);if(_==null)return!0;const{startRow:C,startColumn:E,endRow:p,endColumn:y}=_;for(let b=C;b<=p;b++)for(let O=E;O<=y;O++)h.setValue(b,O,null);c.realDeleteValue(m,d)}),this._arrayFormulaCellData[e]&&(this._arrayFormulaCellData[e][r]=h.getData())})})}mergeArrayFormulaCellData(a){Object.keys(a).forEach(e=>{const t=a[e];if(t==null)return!0;this._arrayFormulaRange[e]==null&&(this._arrayFormulaRange[e]={}),this._arrayFormulaCellData[e]==null&&(this._arrayFormulaCellData[e]={}),Object.keys(t).forEach(r=>{var n,s;const u=t[r],o=new me((n=this._arrayFormulaRange[e])==null?void 0:n[r]),i=new me((s=this._arrayFormulaCellData[e])==null?void 0:s[r]);u.forValue((l,c)=>{const h=o?.getValue(l,c);if(h==null)return!0;const{startRow:m,startColumn:d,endRow:_,endColumn:C}=h;for(let E=m;E<=_;E++)for(let p=d;p<=C;p++)i.setValue(E,p,null)}),u.forValue((l,c,h)=>{i.setValue(l,c,h)}),this._arrayFormulaCellData[e]&&(this._arrayFormulaCellData[e][r]=i.getData())})})}getFormulaData(){const a={},e=this._univerInstanceService.getAllUnitsForType(nt.UNIVER_SHEET);return e.length===0||e.forEach(t=>{const r=t.getUnitId();a[r]={},t.getSheets().forEach(n=>{const s=n.getCellMatrix(),u=n.getSheetId();Pa(a,r,u,s)})}),a}getSheetFormulaData(a,e){const t={},r=this._univerInstanceService.getUnit(a);if(r==null)return{};t[a]={};const n=r.getSheetBySheetId(e);if(n==null)return{};const s=n.getCellMatrix();return Pa(t,a,e,s),t[a][e]}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(a){this._arrayFormulaRange=a}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(a){this._arrayFormulaCellData=a}getUnitImageFormulaData(){return this._unitImageFormulaData}setUnitImageFormulaData(a){this._unitImageFormulaData=a}mergeArrayFormulaRange(a){Object.keys(a).forEach(e=>{const t=a[e];if(t==null)return!0;this._arrayFormulaRange[e]||(this._arrayFormulaRange[e]={}),Object.keys(t).forEach(r=>{var n;const s=new me(t[r]),u=new me((n=this._arrayFormulaRange[e])==null?void 0:n[r]);s.forValue((o,i,l)=>{u.setValue(o,i,l)}),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][r]=u.getData())})})}mergeUnitImageFormulaData(a){const e=Object.keys(a);for(let t=0;t<e.length;t++){const r=e[t],n=a[r];if(!n)continue;this._unitImageFormulaData[r]||(this._unitImageFormulaData[r]={});const s=Object.keys(n);for(let u=0;u<s.length;u++){const o=s[u],i=n[o];i&&(this._unitImageFormulaData[r][o]||(this._unitImageFormulaData[r][o]=new me),i.forValue((l,c,h)=>{this._unitImageFormulaData[r][o].setValue(l,c,h)}))}}}deleteArrayFormulaRange(a,e,t,r){var n;const s=(n=this._arrayFormulaRange[a])==null?void 0:n[e];if(s==null)return;const u=new me(s);u.getValue(t,r)&&(u.realDeleteValue(t,r),this._arrayFormulaRange[a]&&(this._arrayFormulaRange[a][e]=u.getData()))}getCalculateData(){const a=this._univerInstanceService.getAllUnitsForType(nt.UNIVER_SHEET),e={},t={},r={};for(const n of a){const s=n.getUnitId(),u=n.getSheets(),o={},i={};for(const l of u){const c=l.getSheetId(),h=l.getConfig();o[c]={cellData:new me(h.cellData),rowCount:h.rowCount,columnCount:h.columnCount,rowData:h.rowData,columnData:h.columnData,defaultRowHeight:h.defaultRowHeight,defaultColumnWidth:h.defaultColumnWidth},i[l.getName()]=l.getSheetId()}e[s]=o,t[s]=n.getStyles(),r[s]=i}return{allUnitData:e,unitStylesData:t,unitSheetNameMap:r}}getHiddenRowsFiltered(){const a=this._univerInstanceService.getAllUnitsForType(nt.UNIVER_SHEET),e={};for(const t of a){const r=t.getUnitId(),n=t.getSheets();e[r]={};for(const s of n){const u=s.getSheetId();e[r][u]={};const o=0,i=s.getRowCount()-1,l={};for(let c=o;c<=i;c++)s.getRowVisible(c)||(l[c]={hd:Ni.TRUE});e[r][u]=l}}return e}updateFormulaData(a,e,t){const r=new me(t),n=this._getSheetFormulaIdMap(a,e),s=new Map,u=this.getFormulaData();u[a]==null&&(u[a]={});const o=u[a];o[e]==null&&(o[e]={});const i=new me(o[e]||{}),l=new me;return r.forValue((c,h,m)=>{Zm(i,l,n,s,c,h,m)}),i.forValue((c,h,m)=>{const d=m?.f||"",_=m?.si||"";if(vt(_)){const C=n?.[_],E=s.get(_);if(C&&!bt(d)){const p=C.f,y=h-C.c,b=c-C.r;i.setValue(c,h,{f:p,si:_,x:y,y:b}),l.setValue(c,h,{f:p,si:_,x:y,y:b})}else if(typeof E=="string"){const p=m?.x||0,y=m?.y||0,b=this._lexerTreeBuilder.moveFormulaRefOffset(E,p,y);s.set(_,{r:c,c:h,f:b}),i.setValue(c,h,{f:b,si:_}),l.setValue(c,h,{f:b,si:_})}else if(typeof E=="object"){const p=h-E.c,y=c-E.r;i.setValue(c,h,{f:E.f,si:_,x:p,y}),l.setValue(c,h,{f:E.f,si:_,x:p,y})}}}),l.getMatrix()}updateArrayFormulaRange(a,e,t){var r;const n=(r=this._arrayFormulaRange[a])==null?void 0:r[e];if(!n)return;const s=new me(n);new me(t).forValue((u,o,i)=>{s.realDeleteValue(u,o)})}updateArrayFormulaCellData(a,e,t){var r,n;const s=(r=this._arrayFormulaRange[a])==null?void 0:r[e];if(!s)return;const u=new me(s),o=(n=this._arrayFormulaCellData[a])==null?void 0:n[e];if(!o)return;const i=new me(o);new me(t).forValue((l,c,h)=>{zm(u,i,l,c)})}updateImageFormulaData(a,e,t){var r;const n=(r=this._unitImageFormulaData[a])==null?void 0:r[e];n&&new me(t).forValue((s,u)=>{n.realDeleteValue(s,u)})}getFormulaStringByCell(a,e,t,r){const n=this._univerInstanceService.getUnit(r);if(n==null)return null;const s=n.getSheetBySheetId(t);if(s==null)return null;const u=s.getCellMatrix(),o=u.getValue(a,e);if(o==null)return null;const{f:i,si:l}=o;if(bt(i))return i;if(vt(l)){let c=null;return u.forValue((h,m,d)=>{if(d==null)return!0;const{f:_,si:C}=d;if(bt(_)&&l===C)return c=this._lexerTreeBuilder.moveFormulaRefOffset(_,e-m,a-h),!1}),c}return null}getFormulaDirtyRanges(){const a=this.getFormulaData(),e=[];for(const t in a){const r=a[t];if(!r)continue;const n=this._univerInstanceService.getUnit(t);if(n)for(const s in r){const u=r[s];if(!u)continue;const o=n.getSheetBySheetId(s);if(!o)continue;const i={};for(const l of Object.keys(u)){const c=Number(l);for(const h in u[c]){const m=Number(h),d=o.getCellRaw(c,m),_=bt(d?.f)||vt(d?.si),C=d?.v===void 0||d?.v===null||d?.v==="";if(!(_&&C))continue;i[m]||(i[m]=[]);const E=i[m].slice(-1)[0];E&&E.endRow===c-1?E.endRow=c:i[m].push({startRow:c,endRow:c})}}for(const l in i){const c=i[l];for(let h=0;h<c.length;h++){const m=c[h];e.push({unitId:t,sheetId:s,range:{rangeType:rt.NORMAL,startRow:m.startRow,endRow:m.endRow,startColumn:Number(l),endColumn:Number(l)}})}}}}return e}_getSheetFormulaIdMap(a,e){const t={},r=this._univerInstanceService.getUnit(a);if(r==null)return t;const n=r.getSheetBySheetId(e);return n?.getCellMatrix().forValue((s,u,o)=>{if(o==null)return!0;const{f:i,si:l}=o;bt(i)&&vt(l)&&(t[l]={f:i,r:s,c:u})}),t}};Nr=Jm([Lo(0,pr),Lo(1,ge(Pr))],Nr);function Pa(a,e,t,r){a[e]||(a[e]={}),a[e][t]||(a[e][t]={});const n=new Map,s=new me(a[e][t]);r.forValue((o,i,l)=>{const c=l?.f||"",h=l?.si||"",m=bt(c),d=vt(h);m&&d?(s.setValue(o,i,{f:c,si:h}),n.set(h,{f:c,r:o,c:i})):m&&!d?s.setValue(o,i,{f:c}):!m&&d&&s.setValue(o,i,{f:"",si:h})}),s.forValue((o,i,l)=>{const c=l?.f||"",h=l?.si||"";if(vt(h)&&!bt(c)){const m=n.get(h);if(m){const d=m.f,_=i-m.c,C=o-m.r;s.setValue(o,i,{f:d,si:h,x:_,y:C})}else s.realDeleteValue(o,i)}});const u=s.getMatrix();return{[e]:{[t]:u}}}const eg=class Fa{constructor(e,t){this.low=e,this.high=t}clone(){return new Fa(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equal_to(e){return this.low===e.low&&this.high===e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new Fa(this.low===void 0?e.low:this.low<e.low?this.low:e.low,this.high===void 0?e.high:this.high>e.high?this.high:e.high)}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},Le=0,pe=1;class er{constructor(e=void 0,t=void 0,r=null,n=null,s=null,u=pe){if(this.left=r,this.right=n,this.parent=s,this.color=u,this.item={key:e,value:t},e&&e instanceof Array&&e.length===2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])){let[o,i]=e;o>i&&([o,i]=[i,o]),this.item.key=new eg(o,i)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===pe}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value===e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){const t=this.item.key.constructor.comparable_less_than;let r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return t(r,e.item.key.low)}not_intersect_right_subtree(e){const t=this.item.key.constructor.comparable_less_than;let r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}}class vu{constructor(){this.root=null,this.nil_node=new er}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return this.root==null||this.root===this.nil_node}clear(){this.root=null}insert(e,t=e){if(e===void 0)return;let r=new er(e,t,this.nil_node,this.nil_node,null,Le);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new er(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new er(e,t),n=this.tree_search(this.root,r);return n&&this.tree_delete(n),n}search(e,t=(r,n)=>r===n?n.output():r){let r=new er(e),n=[];return this.tree_search_interval(this.root,r,n),n.map(s=>t(s.item.value,s.item.key))}intersect_any(e){let t=new er(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){const t=new vu;return this.tree_walk(this.root,r=>t.insert(r.item.key,e(r.item.value,r.item.key))),t}*iterate(e,t=(r,n)=>r===n?n.output():r){let r;for(e?r=this.tree_search_nearest_forward(this.root,new er(e)):this.root&&(r=this.local_minimum(this.root));r;)yield t(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(e){let t=e;for(;t.parent!=null;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(this.root==null||this.root===this.nil_node)this.root=e;else{for(;t!==this.nil_node;)r=t,e.less_than(t)?t=t.left:t=t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!==this.root&&t.parent.color===Le;)t.parent===t.parent.parent.left?(r=t.parent.parent.right,r.color===Le?(t.parent.color=pe,r.color=pe,t.parent.parent.color=Le,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=pe,t.parent.parent.color=Le,this.rotate_right(t.parent.parent))):(r=t.parent.parent.left,r.color===Le?(t.parent.color=pe,r.color=pe,t.parent.parent.color=Le,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=pe,t.parent.parent.color=Le,this.rotate_left(t.parent.parent)));this.root.color=pe}tree_delete(e){let t,r;e.left===this.nil_node||e.right===this.nil_node?t=e:t=this.tree_successor(e),t.left!==this.nil_node?r=t.left:r=t.right,r.parent=t.parent,t===this.root?this.root=r:(t===t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!==e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),t.color===pe&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!==this.root&&t.parent!=null&&t.color===pe;)t===t.parent.left?(r=t.parent.right,r.color===Le&&(r.color=pe,t.parent.color=Le,this.rotate_left(t.parent),r=t.parent.right),r.left.color===pe&&r.right.color===pe?(r.color=Le,t=t.parent):(r.right.color===pe&&(r.color=Le,r.left.color=pe,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=pe,r.right.color=pe,this.rotate_left(t.parent),t=this.root)):(r=t.parent.left,r.color===Le&&(r.color=pe,t.parent.color=Le,this.rotate_right(t.parent),r=t.parent.left),r.left.color===pe&&r.right.color===pe?(r.color=Le,t=t.parent):(r.left.color===pe&&(r.color=Le,r.right.color=pe,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=pe,r.left.color=pe,this.rotate_right(t.parent),t=this.root));t.color=pe}tree_search(e,t){if(!(e==null||e===this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_nearest_forward(e,t){let r,n=e;for(;n&&n!==this.nil_node;)n.less_than(t)?n.intersect(t)?(r=n,n=n.left):n=n.right:((!r||n.less_than(r))&&(r=n),n=n.left);return r||null}tree_search_interval(e,t,r){e!=null&&e!==this.nil_node&&(e.left!==this.nil_node&&!e.not_intersect_left_subtree(t)&&this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right!==this.nil_node&&!e.not_intersect_right_subtree(t)&&this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return e!=null&&e!==this.nil_node&&(e.left!==this.nil_node&&!e.not_intersect_left_subtree(t)&&(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),!r&&e.right!==this.nil_node&&!e.not_intersect_right_subtree(t)&&(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;t.left!=null&&t.left!==this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;t.right!=null&&t.right!==this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,n;if(e.right!==this.nil_node)t=this.local_minimum(e.right);else{for(r=e,n=e.parent;n!=null&&n.right===r;)r=n,n=n.parent;t=n}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!==this.nil_node&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,e!=null&&e!==this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!==this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!==this.nil_node&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,e!==null&&e!==this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!==this.nil_node&&t.update_max()}tree_walk(e,t){e!=null&&e!==this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){t.color===Le&&(t.left.color===pe&&t.right.color===pe||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0,n=0;if(e.color===pe&&t++,e.left!==this.nil_node?r=this.testBlackHeightProperty(e.left):r=1,e.right!==this.nil_node?n=this.testBlackHeightProperty(e.right):n=1,r!==n)throw new Error("Red-black height property violated");return t+=r,t}}const ja=Symbol("EMPTY_CELL");class tg{constructor(){N(this,"_cache",new Map),N(this,"_continueBuildingCache",new Map)}set(e,t,r,n,s,u=!1){if(!this.shouldContinueBuildingCache(e,t,r,s)&&!u)return;let o=this._cache.get(e);o==null&&(o=new Map,this._cache.set(e,o));let i=o.get(t);i==null&&(i=new Map,o.set(t,i));let l=i.get(r);if(l==null&&(l=new Map,i.set(r,l)),u){for(const[m,d]of l)if(d.has(s)){d.delete(s);break}}let c=typeof n=="string"?n.toLowerCase():n;(c===""||c===null)&&(c=ja);let h=l.get(c);h==null&&(h=new Set,l.set(c,h)),h.add(s)}getCellValuePositions(e,t,r){var n,s;return(s=(n=this._cache.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}getCellPositions(e,t,r,n,s){var u,o,i;let l=typeof n=="string"?n.toLowerCase():n;(l===""||l===null)&&(l=ja);const c=(i=(o=(u=this._cache.get(e))==null?void 0:u.get(t))==null?void 0:o.get(r))==null?void 0:i.get(l);return c&&[...c].filter(h=>s.some(([m,d])=>h>=m&&h<=d))}setContinueBuildingCache(e,t,r,n,s){if(r===-1||n===-1||s===-1)return;let u=this._continueBuildingCache.get(e);u==null&&(u=new Map,this._continueBuildingCache.set(e,u));let o=u.get(t);o==null&&(o=new Map,u.set(t,o));let i=o.get(r);if(i==null){i=new vu,i.insert([n,s]),o.set(r,i);return}this._handleNewInterval(i,n,s)}shouldContinueBuildingCache(e,t,r,n){var s,u;if(r===-1||n===-1)return!1;const o=(u=(s=this._continueBuildingCache.get(e))==null?void 0:s.get(t))==null?void 0:u.get(r);return o?o.search([n,n]).length===0:!0}canUseCache(e,t,r,n,s){var u,o;const i=(o=(u=this._continueBuildingCache.get(e))==null?void 0:u.get(t))==null?void 0:o.get(r);if(r===-1||n===-1||s===-1||!i)return{rowsInCache:[],rowsNotInCache:[]};const l=i.search([n,s]);if(l.length===0)return{rowsInCache:[],rowsNotInCache:[]};l.sort((d,_)=>d[0]-_[0]);const c=[],h=[];let m=n;for(let d=0;d<l.length;d++){const[_,C]=l[d];if(m>=_){if(s<=C){c.push([m,s]);break}c.push([m,C]),m=C+1,d===l.length-1&&m<=s&&h.push([m,s])}else{if(s>C){c.push([_,C]),h.push([m,_-1]),m=C+1,d===l.length-1&&m<=s&&h.push([m,s]);continue}c.push([_,s]),h.push([m,_-1])}}return{rowsInCache:c,rowsNotInCache:h}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(e,t,r){let n=e.search([t,r]);if(n.length===0){const o=[t-1<0?0:t-1,r+1];if(n=e.search(o),n.length===0){e.insert([t,r]);return}}let s=t,u=r;for(const o of n)s=Math.min(s,o[0]),u=Math.max(u,o[1]),e.remove(o);e.insert([s,u])}}const ze=new tg,Ws="engine-formula.config",Ji=1,rg="CYCLE_REFERENCE_COUNT",ng="RETURN_DEPENDENCY_TREE",Po={};class el extends Me{constructor(){super(...arguments),N(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return this._getRowFilteredCallback&&(n=this._getRowFilteredCallback(e,t,r))!=null?n:!1}}const wu=Ye("univer.formula.sheet-row-filtered.service");var sg=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},wn=(a,e)=>(t,r)=>e(t,r,a);let Es=class extends Me{constructor(a,e,t,r){super(),N(this,"_unitData",{}),N(this,"_unitStylesData",{}),N(this,"_arrayFormulaCellData",{}),N(this,"_arrayFormulaRange",{}),N(this,"_formulaData",{}),N(this,"_sheetNameMap",{}),N(this,"_forceCalculate",!1),N(this,"_clearDependencyTreeCache",{}),N(this,"_dirtyRanges",[]),N(this,"_dirtyNameMap",{}),N(this,"_dirtyDefinedNameMap",{}),N(this,"_dirtyUnitFeatureMap",{}),N(this,"_dirtyUnitOtherFormulaMap",{}),N(this,"_excludedCell"),N(this,"_sheetIdToNameMap",{}),N(this,"_executeUnitId",""),N(this,"_executeSubUnitId",""),this._univerInstanceService=a,this._localeService=e,this._formulaDataModel=t,this._sheetRowFilteredService=r}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(a){this._executeUnitId=a}setExecuteSubUnitId(a){this._executeSubUnitId=a}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(a,e){return this._sheetIdToNameMap[a]==null?"":this._sheetIdToNameMap[a][e]||""}setSheetNameMap(a){this._sheetIdToNameMap=a}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){const a=this._univerInstanceService.getCurrentUnitForType(nt.UNIVER_SHEET),{id:e,sheetOrder:t}=a.getSnapshot();return{sheetOrder:t,sheetNameMap:this._sheetIdToNameMap[e]}}getSheetRowColumnCount(a,e){const t=this._univerInstanceService.getUnit(a),r=t?.getSheetBySheetId(e),n=r?.getSnapshot();if(!n)return{rowCount:0,columnCount:0};const{rowCount:s,columnCount:u}=n;return{rowCount:s,columnCount:u}}getFilteredOutRows(a,e,t,r){const n=[];for(let s=t;s<=r;s++)this._sheetRowFilteredService.getRowFiltered(a,e,s)&&n.push(s);return n}load(a){if(a.allUnitData&&a.unitSheetNameMap&&a.unitStylesData)this._unitData=a.allUnitData,this._unitStylesData=a.unitStylesData,this._sheetNameMap=a.unitSheetNameMap;else{const{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}a.rowData&&this._applyUnitRowData(a.rowData),this._formulaData=a.formulaData,this._arrayFormulaCellData=va(a.arrayFormulaCellData),this._arrayFormulaRange=a.arrayFormulaRange,this._forceCalculate=a.forceCalculate,this._clearDependencyTreeCache=a.clearDependencyTreeCache||{},this._dirtyRanges=a.dirtyRanges,this._dirtyNameMap=a.dirtyNameMap,this._dirtyDefinedNameMap=a.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=a.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=a.dirtyUnitOtherFormulaMap,this._excludedCell=a.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}loadDataLite(a){const{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t,this._formulaData=this._formulaDataModel.getFormulaData(),this._arrayFormulaCellData=va(this._formulaDataModel.getArrayFormulaCellData()),this._arrayFormulaRange=this._formulaDataModel.getArrayFormulaRange(),a&&this._applyUnitRowData(a)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(a,e){this._dirtyRanges=a,this._excludedCell=e,this._dirtyNameMap={}}registerUnitData(a){this._unitData=a}registerFormulaData(a){this._formulaData=a}registerSheetNameMap(a){this._sheetNameMap=a}_mergeNameMap(a,e){Object.keys(e).forEach(t=>{e[t]&&Object.keys(e[t]).forEach(r=>{a[t]==null&&(a[t]={}),a[t][e[t][r]]=r})}),this._sheetIdToNameMap={},Object.keys(a).forEach(t=>{Object.keys(a[t]).forEach(r=>{this._sheetIdToNameMap[t]==null&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][a[t][r]]=r})})}_loadSheetData(){const a=this._univerInstanceService.getCurrentUnitForType(nt.UNIVER_SHEET),e=a?.getActiveSheet();return this._executeUnitId=a?.getUnitId(),this._executeSubUnitId=e?.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(a){for(const e in a)if(a[e]!=null)for(const t in a[e])a[e][t]!=null&&(this._unitData[e]==null&&(this._unitData[e]={}),this._unitData[e][t]==null&&(this._unitData[e][t]={cellData:new me({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[e][t].rowData=a[e][t])}};Es=sg([wn(0,pr),wn(1,ge(Lh)),wn(2,ge(Nr)),wn(3,ge(wu))],Es);const Bt=Ye("univer.formula.current-data.service");var ag=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Ca=(a,e)=>(t,r)=>e(t,r,a);let _r=class extends Me{constructor(a,e,t){super(),this._definedNamesService=a,this._lexerTreeBuilder=e,this._formulaCurrentConfigService=t}treeBuilder(a,e=!0){const t=this._definedNamesService.getAllDefinedNames();return this._isDeepDefinedNameMapEmpty(t)?this._lexerTreeBuilder.treeBuilder(a,e):this._lexerTreeBuilder.treeBuilder(a,e,{unitId:this._formulaCurrentConfigService.getExecuteUnitId(),getValueByName:this._definedNamesService.getValueByName.bind(this._definedNamesService),getDirtyDefinedNameMap:this._formulaCurrentConfigService.getDirtyDefinedNameMap.bind(this._formulaCurrentConfigService),getSheetName:this._formulaCurrentConfigService.getSheetName.bind(this._formulaCurrentConfigService)})}_isDeepDefinedNameMapEmpty(a){for(const e in a)if(Object.keys(a[e]).length>0)return!1;return!0}};_r=ag([Ca(0,br),Ca(1,ge(Pr)),Ca(2,Bt)],_r);function qn(a){if(a==null)return!0;const{v:e,f:t,si:r,p:n}=a;return!(!(e==null||typeof e=="string"&&e.length===0)||t!=null&&t.length>0||r!=null&&r.length>0||n!=null)}function ug(a){var e;if(a===null)return 0;if(a!=null&&a.p){const t=a?.p.body;if(t==null)return 0;const r=t.dataStream;return xh.transform.getPlainText(r)}return(e=a?.v)!=null?e:0}function og(a,e=!1){return!e&&!(bt(a?.f)||vt(a?.si))?null:typeof a?.v=="string"&&zt.has(a.v)?a.v:null}function tl(a,e,t,r,n){var s;const u=Object.keys(n);for(const o of u){const i=n[o],l=(s=i?.[r])==null?void 0:s[t];if(l==null)continue;const c=l.getValue(a,e);if(c!=null)return c}}var rr=(a=>(a[a.MIN=0]="MIN",a[a.MAX=1]="MAX",a))(rr||{}),ve=(a=>(a[a.NORMAL=0]="NORMAL",a[a.MIN=1]="MIN",a[a.MAX=2]="MAX",a))(ve||{});function As(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(a,e)=>a.localeCompare(e)}function rl(a){return a.indexOf("*")>-1||a.indexOf("?")>-1}function Ea(a,e){const t=lg(e).replace(/~?[*?]/g,r=>r.startsWith("~")?`\\${r.substring(1)}`:r==="*"?".*":r==="?"?".":r);return new RegExp(`^${t}$`).test(a)}function Fo(a){return a.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function ig(a,e,t){let r=!1;switch(t){case k.EQUALS:r=Ea(a,e);break;case k.NOT_EQUAL:r=!Ea(a,e);break;case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:r=Ea(a,e)||a>Fo(e);break;case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:r=a<Fo(e);break}return r}function lg(a){return a.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function Ba(a){switch(a){case 1:return 2;case 0:return 0;case-1:return 1;default:return 0}}function ka(a){return a===-2?1:0}const cg=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿"],hg={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function mg(a,e,t){var r,n;if(a==null||e==null)return e;const s=t?.getStyleByCell(a)||a.s,u=t?.getStyleByCell(e)||e.s;if(s==null||u==null||typeof s!="object"||typeof u!="object")return e;const o=(r=s?.n)==null?void 0:r.pattern,i=(n=u?.n)==null?void 0:n.pattern;if(o==null||i==null)return e;const l=o||i;return u.n.pattern=l,e}const $a=new Ft(1e5);function jo(a){const e=$a.get(a);if(e!==void 0)return e;const t=fg(a);return $a.set(a,t),t}function gg(){$a.clear()}function fg(a){if(dg(a))return 3;const e=yr.getFormatInfo(a).type||"unknown";return hg[e]}function dg(a){return!!cg.find(e=>a.includes(e))&&a.startsWith("_(")}function Dn(a,e,t){if(a==="")return e;if(e==="")return a;const r=jo(a),n=jo(e);return t===K.PLUS||t===K.MINUS?r===4&&n===4||r===11&&n===11?"":e:t===K.MULTIPLY||t===K.DIVIDED?r===6&&n===6||r===7&&n===7||r===8&&n===8||r===9&&n===9?e:"":a||e}const Ng=new Map([[At.EN_US,"$"],[At.RU_RU,"₽"],[At.VI_VN,"₫"],[At.ZH_CN,"¥"],[At.ZH_TW,"NT$"],[At.FR_FR,"€"],[At.FA_IR,"﷼"],[At.KO_KR,"₩"],[At.ES_ES,"€"],[At.CA_ES,"€"]]);function Bo(a){return Ng.get(a)||"$"}function tt(a,e=2){let t=e;e>127&&(t=127);let r="";return t>0&&(r=`.${"0".repeat(t)}`),`"${Bo(a)}"#,##0${r}_);[Red]("${Bo(a)}"#,##0${r})`}function _g(a,e,t=2){return yr.format(tt(a,t),e)}const Du=new Ft(1e5);function Cg(a){let e=a;e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1));const t=Du.get(e);if(t)return{isNumberPattern:!0,value:t.value,pattern:t.pattern};const r=js(e);return r&&r.z?Eg(e,r.v,r.z):{isNumberPattern:!1}}function Eg(a,e,t){return Du.set(a,{value:e,pattern:t}),{isNumberPattern:!0,value:e,pattern:t}}function Ag(){Du.clear()}function Lu(a){let e;switch(a){case k.EQUALS:e=k.EQUALS;break;case k.GREATER_THAN:e=k.LESS_THAN;break;case k.GREATER_THAN_OR_EQUAL:e=k.LESS_THAN_OR_EQUAL;break;case k.LESS_THAN:e=k.GREATER_THAN;break;case k.LESS_THAN_OR_EQUAL:e=k.GREATER_THAN_OR_EQUAL;break;case k.NOT_EQUAL:e=k.NOT_EQUAL;break}return e}var Mr=9e15,Jt=1e9,Ya="0123456789abcdef",ps="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ys="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ha={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Mr,maxE:Mr,crypto:!1},nl,wt,ie=!0,Qs="[DecimalError] ",Kt=Qs+"Invalid argument: ",sl=Qs+"Precision limit exceeded",al=Qs+"crypto unavailable",ul="[object Decimal]",$e=Math.floor,we=Math.pow,pg=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,yg=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,bg=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ol=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,dt=1e7,ne=7,Rg=9007199254740991,Sg=ps.length-1,Ga=ys.length-1,B={toStringTag:ul};B.absoluteValue=B.abs=function(){var a=new this.constructor(this);return a.s<0&&(a.s=1),re(a)};B.ceil=function(){return re(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(a,e){var t,r=this,n=r.constructor;if(a=new n(a),e=new n(e),!a.s||!e.s)return new n(NaN);if(a.gt(e))throw Error(Kt+e);return t=r.cmp(a),t<0?a:r.cmp(e)>0?e:new n(r)};B.comparedTo=B.cmp=function(a){var e,t,r,n,s=this,u=s.d,o=(a=new s.constructor(a)).d,i=s.s,l=a.s;if(!u||!o)return!i||!l?NaN:i!==l?i:u===o?0:!u^i<0?1:-1;if(!u[0]||!o[0])return u[0]?i:o[0]?-l:0;if(i!==l)return i;if(s.e!==a.e)return s.e>a.e^i<0?1:-1;for(r=u.length,n=o.length,e=0,t=r<n?r:n;e<t;++e)if(u[e]!==o[e])return u[e]>o[e]^i<0?1:-1;return r===n?0:r>n^i<0?1:-1};B.cosine=B.cos=function(){var a,e,t=this,r=t.constructor;return t.d?t.d[0]?(a=r.precision,e=r.rounding,r.precision=a+Math.max(t.e,t.sd())+ne,r.rounding=1,t=Og(r,ml(r,t)),r.precision=a,r.rounding=e,re(wt==2||wt==3?t.neg():t,a,e,!0)):new r(1):new r(NaN)};B.cubeRoot=B.cbrt=function(){var a,e,t,r,n,s,u,o,i,l,c=this,h=c.constructor;if(!c.isFinite()||c.isZero())return new h(c);for(ie=!1,s=c.s*we(c.s*c,1/3),!s||Math.abs(s)==1/0?(t=Pe(c.d),a=c.e,(s=(a-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=we(t,1/3),a=$e((a+1)/3)-(a%3==(a<0?-1:2)),s==1/0?t="5e"+a:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+a),r=new h(t),r.s=c.s):r=new h(s.toString()),u=(a=h.precision)+3;;)if(o=r,i=o.times(o).times(o),l=i.plus(c),r=Oe(l.plus(c).times(o),l.plus(i),u+2,1),Pe(o.d).slice(0,u)===(t=Pe(r.d)).slice(0,u))if(t=t.slice(u-3,u+1),t=="9999"||!n&&t=="4999"){if(!n&&(re(o,a+1,0),o.times(o).times(o).eq(c))){r=o;break}u+=4,n=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(re(r,a+1,1),e=!r.times(r).times(r).eq(c));break}return ie=!0,re(r,a,h.rounding,e)};B.decimalPlaces=B.dp=function(){var a,e=this.d,t=NaN;if(e){if(a=e.length-1,t=(a-$e(this.e/ne))*ne,a=e[a],a)for(;a%10==0;a/=10)t--;t<0&&(t=0)}return t};B.dividedBy=B.div=function(a){return Oe(this,new this.constructor(a))};B.dividedToIntegerBy=B.divToInt=function(a){var e=this,t=e.constructor;return re(Oe(e,new t(a),0,1,1),t.precision,t.rounding)};B.equals=B.eq=function(a){return this.cmp(a)===0};B.floor=function(){return re(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(a){return this.cmp(a)>0};B.greaterThanOrEqualTo=B.gte=function(a){var e=this.cmp(a);return e==1||e===0};B.hyperbolicCosine=B.cosh=function(){var a,e,t,r,n,s=this,u=s.constructor,o=new u(1);if(!s.isFinite())return new u(s.s?1/0:NaN);if(s.isZero())return o;t=u.precision,r=u.rounding,u.precision=t+Math.max(s.e,s.sd())+4,u.rounding=1,n=s.d.length,n<32?(a=Math.ceil(n/3),e=(1/Zs(4,a)).toString()):(a=16,e="2.3283064365386962890625e-10"),s=Fr(u,1,s.times(e),new u(1),!0);for(var i,l=a,c=new u(8);l--;)i=s.times(s),s=o.minus(i.times(c.minus(i.times(c))));return re(s,u.precision=t,u.rounding=r,!0)};B.hyperbolicSine=B.sinh=function(){var a,e,t,r,n=this,s=n.constructor;if(!n.isFinite()||n.isZero())return new s(n);if(e=s.precision,t=s.rounding,s.precision=e+Math.max(n.e,n.sd())+4,s.rounding=1,r=n.d.length,r<3)n=Fr(s,2,n,n,!0);else{a=1.4*Math.sqrt(r),a=a>16?16:a|0,n=n.times(1/Zs(5,a)),n=Fr(s,2,n,n,!0);for(var u,o=new s(5),i=new s(16),l=new s(20);a--;)u=n.times(n),n=n.times(o.plus(u.times(i.times(u).plus(l))))}return s.precision=e,s.rounding=t,re(n,e,t,!0)};B.hyperbolicTangent=B.tanh=function(){var a,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(a=r.precision,e=r.rounding,r.precision=a+7,r.rounding=1,Oe(t.sinh(),t.cosh(),r.precision=a,r.rounding=e)):new r(t.s)};B.inverseCosine=B.acos=function(){var a=this,e=a.constructor,t=a.abs().cmp(1),r=e.precision,n=e.rounding;return t!==-1?t===0?a.isNeg()?St(e,r,n):new e(0):new e(NaN):a.isZero()?St(e,r+4,n).times(.5):(e.precision=r+6,e.rounding=1,a=new e(1).minus(a).div(a.plus(1)).sqrt().atan(),e.precision=r,e.rounding=n,a.times(2))};B.inverseHyperbolicCosine=B.acosh=function(){var a,e,t=this,r=t.constructor;return t.lte(1)?new r(t.eq(1)?0:NaN):t.isFinite()?(a=r.precision,e=r.rounding,r.precision=a+Math.max(Math.abs(t.e),t.sd())+4,r.rounding=1,ie=!1,t=t.times(t).minus(1).sqrt().plus(t),ie=!0,r.precision=a,r.rounding=e,t.ln()):new r(t)};B.inverseHyperbolicSine=B.asinh=function(){var a,e,t=this,r=t.constructor;return!t.isFinite()||t.isZero()?new r(t):(a=r.precision,e=r.rounding,r.precision=a+2*Math.max(Math.abs(t.e),t.sd())+6,r.rounding=1,ie=!1,t=t.times(t).plus(1).sqrt().plus(t),ie=!0,r.precision=a,r.rounding=e,t.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var a,e,t,r,n=this,s=n.constructor;return n.isFinite()?n.e>=0?new s(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(a=s.precision,e=s.rounding,r=n.sd(),Math.max(r,a)<2*-n.e-1?re(new s(n),a,e,!0):(s.precision=t=r-n.e,n=Oe(n.plus(1),new s(1).minus(n),t+a,1),s.precision=a+4,s.rounding=1,n=n.ln(),s.precision=a,s.rounding=e,n.times(.5))):new s(NaN)};B.inverseSine=B.asin=function(){var a,e,t,r,n=this,s=n.constructor;return n.isZero()?new s(n):(e=n.abs().cmp(1),t=s.precision,r=s.rounding,e!==-1?e===0?(a=St(s,t+4,r).times(.5),a.s=n.s,a):new s(NaN):(s.precision=t+6,s.rounding=1,n=n.div(new s(1).minus(n.times(n)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=r,n.times(2)))};B.inverseTangent=B.atan=function(){var a,e,t,r,n,s,u,o,i,l=this,c=l.constructor,h=c.precision,m=c.rounding;if(l.isFinite()){if(l.isZero())return new c(l);if(l.abs().eq(1)&&h+4<=Ga)return u=St(c,h+4,m).times(.25),u.s=l.s,u}else{if(!l.s)return new c(NaN);if(h+4<=Ga)return u=St(c,h+4,m).times(.5),u.s=l.s,u}for(c.precision=o=h+10,c.rounding=1,t=Math.min(28,o/ne+2|0),a=t;a;--a)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(ie=!1,e=Math.ceil(o/ne),r=1,i=l.times(l),u=new c(l),n=l;a!==-1;)if(n=n.times(i),s=u.minus(n.div(r+=2)),n=n.times(i),u=s.plus(n.div(r+=2)),u.d[e]!==void 0)for(a=e;u.d[a]===s.d[a]&&a--;);return t&&(u=u.times(2<<t-1)),ie=!0,re(u,c.precision=h,c.rounding=m,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&$e(this.e/ne)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(a){return this.cmp(a)<0};B.lessThanOrEqualTo=B.lte=function(a){return this.cmp(a)<1};B.logarithm=B.log=function(a){var e,t,r,n,s,u,o,i,l=this,c=l.constructor,h=c.precision,m=c.rounding,d=5;if(a==null)a=new c(10),e=!0;else{if(a=new c(a),t=a.d,a.s<0||!t||!t[0]||a.eq(1))return new c(NaN);e=a.eq(10)}if(t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new c(t&&!t[0]?-1/0:l.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)s=!0;else{for(n=t[0];n%10===0;)n/=10;s=n!==1}if(ie=!1,o=h+d,u=Xt(l,o),r=e?bs(c,o+10):Xt(a,o),i=Oe(u,r,o,1),an(i.d,n=h,m))do if(o+=10,u=Xt(l,o),r=e?bs(c,o+10):Xt(a,o),i=Oe(u,r,o,1),!s){+Pe(i.d).slice(n+1,n+15)+1==1e14&&(i=re(i,h+1,0));break}while(an(i.d,n+=10,m));return ie=!0,re(i,h,m)};B.minus=B.sub=function(a){var e,t,r,n,s,u,o,i,l,c,h,m,d=this,_=d.constructor;if(a=new _(a),!d.d||!a.d)return!d.s||!a.s?a=new _(NaN):d.d?a.s=-a.s:a=new _(a.d||d.s!==a.s?d:NaN),a;if(d.s!=a.s)return a.s=-a.s,d.plus(a);if(l=d.d,m=a.d,o=_.precision,i=_.rounding,!l[0]||!m[0]){if(m[0])a.s=-a.s;else if(l[0])a=new _(d);else return new _(i===3?-0:0);return ie?re(a,o,i):a}if(t=$e(a.e/ne),c=$e(d.e/ne),l=l.slice(),s=c-t,s){for(h=s<0,h?(e=l,s=-s,u=m.length):(e=m,t=c,u=l.length),r=Math.max(Math.ceil(o/ne),u)+2,s>r&&(s=r,e.length=1),e.reverse(),r=s;r--;)e.push(0);e.reverse()}else{for(r=l.length,u=m.length,h=r<u,h&&(u=r),r=0;r<u;r++)if(l[r]!=m[r]){h=l[r]<m[r];break}s=0}for(h&&(e=l,l=m,m=e,a.s=-a.s),u=l.length,r=m.length-u;r>0;--r)l[u++]=0;for(r=m.length;r>s;){if(l[--r]<m[r]){for(n=r;n&&l[--n]===0;)l[n]=dt-1;--l[n],l[r]+=dt}l[r]-=m[r]}for(;l[--u]===0;)l.pop();for(;l[0]===0;l.shift())--t;return l[0]?(a.d=l,a.e=Ks(l,t),ie?re(a,o,i):a):new _(i===3?-0:0)};B.modulo=B.mod=function(a){var e,t=this,r=t.constructor;return a=new r(a),!t.d||!a.s||a.d&&!a.d[0]?new r(NaN):!a.d||t.d&&!t.d[0]?re(new r(t),r.precision,r.rounding):(ie=!1,r.modulo==9?(e=Oe(t,a.abs(),0,3,1),e.s*=a.s):e=Oe(t,a,0,r.modulo,1),e=e.times(a),ie=!0,t.minus(e))};B.naturalExponential=B.exp=function(){return Xa(this)};B.naturalLogarithm=B.ln=function(){return Xt(this)};B.negated=B.neg=function(){var a=new this.constructor(this);return a.s=-a.s,re(a)};B.plus=B.add=function(a){var e,t,r,n,s,u,o,i,l,c,h=this,m=h.constructor;if(a=new m(a),!h.d||!a.d)return!h.s||!a.s?a=new m(NaN):h.d||(a=new m(a.d||h.s===a.s?h:NaN)),a;if(h.s!=a.s)return a.s=-a.s,h.minus(a);if(l=h.d,c=a.d,o=m.precision,i=m.rounding,!l[0]||!c[0])return c[0]||(a=new m(h)),ie?re(a,o,i):a;if(s=$e(h.e/ne),r=$e(a.e/ne),l=l.slice(),n=s-r,n){for(n<0?(t=l,n=-n,u=c.length):(t=c,r=s,u=l.length),s=Math.ceil(o/ne),u=s>u?s+1:u+1,n>u&&(n=u,t.length=1),t.reverse();n--;)t.push(0);t.reverse()}for(u=l.length,n=c.length,u-n<0&&(n=u,t=c,c=l,l=t),e=0;n;)e=(l[--n]=l[n]+c[n]+e)/dt|0,l[n]%=dt;for(e&&(l.unshift(e),++r),u=l.length;l[--u]==0;)l.pop();return a.d=l,a.e=Ks(l,r),ie?re(a,o,i):a};B.precision=B.sd=function(a){var e,t=this;if(a!==void 0&&a!==!!a&&a!==1&&a!==0)throw Error(Kt+a);return t.d?(e=il(t.d),a&&t.e+1>e&&(e=t.e+1)):e=NaN,e};B.round=function(){var a=this,e=a.constructor;return re(new e(a),a.e+1,e.rounding)};B.sine=B.sin=function(){var a,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(a=r.precision,e=r.rounding,r.precision=a+Math.max(t.e,t.sd())+ne,r.rounding=1,t=Vg(r,ml(r,t)),r.precision=a,r.rounding=e,re(wt>2?t.neg():t,a,e,!0)):new r(NaN)};B.squareRoot=B.sqrt=function(){var a,e,t,r,n,s,u=this,o=u.d,i=u.e,l=u.s,c=u.constructor;if(l!==1||!o||!o[0])return new c(!l||l<0&&(!o||o[0])?NaN:o?u:1/0);for(ie=!1,l=Math.sqrt(+u),l==0||l==1/0?(e=Pe(o),(e.length+i)%2==0&&(e+="0"),l=Math.sqrt(e),i=$e((i+1)/2)-(i<0||i%2),l==1/0?e="5e"+i:(e=l.toExponential(),e=e.slice(0,e.indexOf("e")+1)+i),r=new c(e)):r=new c(l.toString()),t=(i=c.precision)+3;;)if(s=r,r=s.plus(Oe(u,s,t+2,1)).times(.5),Pe(s.d).slice(0,t)===(e=Pe(r.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!n&&e=="4999"){if(!n&&(re(s,i+1,0),s.times(s).eq(u))){r=s;break}t+=4,n=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(re(r,i+1,1),a=!r.times(r).eq(u));break}return ie=!0,re(r,i,c.rounding,a)};B.tangent=B.tan=function(){var a,e,t=this,r=t.constructor;return t.isFinite()?t.isZero()?new r(t):(a=r.precision,e=r.rounding,r.precision=a+10,r.rounding=1,t=t.sin(),t.s=1,t=Oe(t,new r(1).minus(t.times(t)).sqrt(),a+10,0),r.precision=a,r.rounding=e,re(wt==2||wt==4?t.neg():t,a,e,!0)):new r(NaN)};B.times=B.mul=function(a){var e,t,r,n,s,u,o,i,l,c=this,h=c.constructor,m=c.d,d=(a=new h(a)).d;if(a.s*=c.s,!m||!m[0]||!d||!d[0])return new h(!a.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?a.s/0:a.s*0);for(t=$e(c.e/ne)+$e(a.e/ne),i=m.length,l=d.length,i<l&&(s=m,m=d,d=s,u=i,i=l,l=u),s=[],u=i+l,r=u;r--;)s.push(0);for(r=l;--r>=0;){for(e=0,n=i+r;n>r;)o=s[n]+d[r]*m[n-r-1]+e,s[n--]=o%dt|0,e=o/dt|0;s[n]=(s[n]+e)%dt|0}for(;!s[--u];)s.pop();return e?++t:s.shift(),a.d=s,a.e=Ks(s,t),ie?re(a,h.precision,h.rounding):a};B.toBinary=function(a,e){return Pu(this,2,a,e)};B.toDecimalPlaces=B.toDP=function(a,e){var t=this,r=t.constructor;return t=new r(t),a===void 0?t:(Qe(a,0,Jt),e===void 0?e=r.rounding:Qe(e,0,8),re(t,a+t.e+1,e))};B.toExponential=function(a,e){var t,r=this,n=r.constructor;return a===void 0?t=Mt(r,!0):(Qe(a,0,Jt),e===void 0?e=n.rounding:Qe(e,0,8),r=re(new n(r),a+1,e),t=Mt(r,!0,a+1)),r.isNeg()&&!r.isZero()?"-"+t:t};B.toFixed=function(a,e){var t,r,n=this,s=n.constructor;return a===void 0?t=Mt(n):(Qe(a,0,Jt),e===void 0?e=s.rounding:Qe(e,0,8),r=re(new s(n),a+n.e+1,e),t=Mt(r,!1,a+r.e+1)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toFraction=function(a){var e,t,r,n,s,u,o,i,l,c,h,m,d=this,_=d.d,C=d.constructor;if(!_)return new C(d);if(l=t=new C(1),r=i=new C(0),e=new C(r),s=e.e=il(_)-d.e-1,u=s%ne,e.d[0]=we(10,u<0?ne+u:u),a==null)a=s>0?e:l;else{if(o=new C(a),!o.isInt()||o.lt(l))throw Error(Kt+o);a=o.gt(e)?s>0?e:l:o}for(ie=!1,o=new C(Pe(_)),c=C.precision,C.precision=s=_.length*ne*2;h=Oe(o,e,0,1,1),n=t.plus(h.times(r)),n.cmp(a)!=1;)t=r,r=n,n=l,l=i.plus(h.times(n)),i=n,n=e,e=o.minus(h.times(n)),o=n;return n=Oe(a.minus(t),r,0,1,1),i=i.plus(n.times(l)),t=t.plus(n.times(r)),i.s=l.s=d.s,m=Oe(l,r,s,1).minus(d).abs().cmp(Oe(i,t,s,1).minus(d).abs())<1?[l,r]:[i,t],C.precision=c,ie=!0,m};B.toHexadecimal=B.toHex=function(a,e){return Pu(this,16,a,e)};B.toNearest=function(a,e){var t=this,r=t.constructor;if(t=new r(t),a==null){if(!t.d)return t;a=new r(1),e=r.rounding}else{if(a=new r(a),e===void 0?e=r.rounding:Qe(e,0,8),!t.d)return a.s?t:a;if(!a.d)return a.s&&(a.s=t.s),a}return a.d[0]?(ie=!1,t=Oe(t,a,0,e,1).times(a),ie=!0,re(t)):(a.s=t.s,t=a),t};B.toNumber=function(){return+this};B.toOctal=function(a,e){return Pu(this,8,a,e)};B.toPower=B.pow=function(a){var e,t,r,n,s,u,o=this,i=o.constructor,l=+(a=new i(a));if(!o.d||!a.d||!o.d[0]||!a.d[0])return new i(we(+o,l));if(o=new i(o),o.eq(1))return o;if(r=i.precision,s=i.rounding,a.eq(1))return re(o,r,s);if(e=$e(a.e/ne),e>=a.d.length-1&&(t=l<0?-l:l)<=Rg)return n=ll(i,o,t,r),a.s<0?new i(1).div(n):re(n,r,s);if(u=o.s,u<0){if(e<a.d.length-1)return new i(NaN);if((a.d[e]&1)==0&&(u=1),o.e==0&&o.d[0]==1&&o.d.length==1)return o.s=u,o}return t=we(+o,l),e=t==0||!isFinite(t)?$e(l*(Math.log("0."+Pe(o.d))/Math.LN10+o.e+1)):new i(t+"").e,e>i.maxE+1||e<i.minE-1?new i(e>0?u/0:0):(ie=!1,i.rounding=o.s=1,t=Math.min(12,(e+"").length),n=Xa(a.times(Xt(o,r+t)),r),n.d&&(n=re(n,r+5,1),an(n.d,r,s)&&(e=r+10,n=re(Xa(a.times(Xt(o,e+t)),e),e+5,1),+Pe(n.d).slice(r+1,r+15)+1==1e14&&(n=re(n,r+1,0)))),n.s=u,ie=!0,i.rounding=s,re(n,r,s))};B.toPrecision=function(a,e){var t,r=this,n=r.constructor;return a===void 0?t=Mt(r,r.e<=n.toExpNeg||r.e>=n.toExpPos):(Qe(a,1,Jt),e===void 0?e=n.rounding:Qe(e,0,8),r=re(new n(r),a,e),t=Mt(r,a<=r.e||r.e<=n.toExpNeg,a)),r.isNeg()&&!r.isZero()?"-"+t:t};B.toSignificantDigits=B.toSD=function(a,e){var t=this,r=t.constructor;return a===void 0?(a=r.precision,e=r.rounding):(Qe(a,1,Jt),e===void 0?e=r.rounding:Qe(e,0,8)),re(new r(t),a,e)};B.toString=function(){var a=this,e=a.constructor,t=Mt(a,a.e<=e.toExpNeg||a.e>=e.toExpPos);return a.isNeg()&&!a.isZero()?"-"+t:t};B.truncated=B.trunc=function(){return re(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var a=this,e=a.constructor,t=Mt(a,a.e<=e.toExpNeg||a.e>=e.toExpPos);return a.isNeg()?"-"+t:t};function Pe(a){var e,t,r,n=a.length-1,s="",u=a[0];if(n>0){for(s+=u,e=1;e<n;e++)r=a[e]+"",t=ne-r.length,t&&(s+=Ht(t)),s+=r;u=a[e],r=u+"",t=ne-r.length,t&&(s+=Ht(t))}else if(u===0)return"0";for(;u%10===0;)u/=10;return s+u}function Qe(a,e,t){if(a!==~~a||a<e||a>t)throw Error(Kt+a)}function an(a,e,t,r){var n,s,u,o;for(s=a[0];s>=10;s/=10)--e;return--e<0?(e+=ne,n=0):(n=Math.ceil((e+1)/ne),e%=ne),s=we(10,ne-e),o=a[n]%s|0,r==null?e<3?(e==0?o=o/100|0:e==1&&(o=o/10|0),u=t<4&&o==99999||t>3&&o==49999||o==5e4||o==0):u=(t<4&&o+1==s||t>3&&o+1==s/2)&&(a[n+1]/s/100|0)==we(10,e-2)-1||(o==s/2||o==0)&&(a[n+1]/s/100|0)==0:e<4?(e==0?o=o/1e3|0:e==1?o=o/100|0:e==2&&(o=o/10|0),u=(r||t<4)&&o==9999||!r&&t>3&&o==4999):u=((r||t<4)&&o+1==s||!r&&t>3&&o+1==s/2)&&(a[n+1]/s/1e3|0)==we(10,e-3)-1,u}function Wn(a,e,t){for(var r,n=[0],s,u=0,o=a.length;u<o;){for(s=n.length;s--;)n[s]*=e;for(n[0]+=Ya.indexOf(a.charAt(u++)),r=0;r<n.length;r++)n[r]>t-1&&(n[r+1]===void 0&&(n[r+1]=0),n[r+1]+=n[r]/t|0,n[r]%=t)}return n.reverse()}function Og(a,e){var t,r,n;if(e.isZero())return e;r=e.d.length,r<32?(t=Math.ceil(r/3),n=(1/Zs(4,t)).toString()):(t=16,n="2.3283064365386962890625e-10"),a.precision+=t,e=Fr(a,1,e.times(n),new a(1));for(var s=t;s--;){var u=e.times(e);e=u.times(u).minus(u).times(8).plus(1)}return a.precision-=t,e}var Oe=(function(){function a(r,n,s){var u,o=0,i=r.length;for(r=r.slice();i--;)u=r[i]*n+o,r[i]=u%s|0,o=u/s|0;return o&&r.unshift(o),r}function e(r,n,s,u){var o,i;if(s!=u)i=s>u?1:-1;else for(o=i=0;o<s;o++)if(r[o]!=n[o]){i=r[o]>n[o]?1:-1;break}return i}function t(r,n,s,u){for(var o=0;s--;)r[s]-=o,o=r[s]<n[s]?1:0,r[s]=o*u+r[s]-n[s];for(;!r[0]&&r.length>1;)r.shift()}return function(r,n,s,u,o,i){var l,c,h,m,d,_,C,E,p,y,b,O,M,V,T,x,v,L,D,Y,ee=r.constructor,ue=r.s==n.s?1:-1,H=r.d,Z=n.d;if(!H||!H[0]||!Z||!Z[0])return new ee(!r.s||!n.s||(H?Z&&H[0]==Z[0]:!Z)?NaN:H&&H[0]==0||!Z?ue*0:ue/0);for(i?(d=1,c=r.e-n.e):(i=dt,d=ne,c=$e(r.e/d)-$e(n.e/d)),D=Z.length,v=H.length,p=new ee(ue),y=p.d=[],h=0;Z[h]==(H[h]||0);h++);if(Z[h]>(H[h]||0)&&c--,s==null?(V=s=ee.precision,u=ee.rounding):o?V=s+(r.e-n.e)+1:V=s,V<0)y.push(1),_=!0;else{if(V=V/d+2|0,h=0,D==1){for(m=0,Z=Z[0],V++;(h<v||m)&&V--;h++)T=m*i+(H[h]||0),y[h]=T/Z|0,m=T%Z|0;_=m||h<v}else{for(m=i/(Z[0]+1)|0,m>1&&(Z=a(Z,m,i),H=a(H,m,i),D=Z.length,v=H.length),x=D,b=H.slice(0,D),O=b.length;O<D;)b[O++]=0;Y=Z.slice(),Y.unshift(0),L=Z[0],Z[1]>=i/2&&++L;do m=0,l=e(Z,b,D,O),l<0?(M=b[0],D!=O&&(M=M*i+(b[1]||0)),m=M/L|0,m>1?(m>=i&&(m=i-1),C=a(Z,m,i),E=C.length,O=b.length,l=e(C,b,E,O),l==1&&(m--,t(C,D<E?Y:Z,E,i))):(m==0&&(l=m=1),C=Z.slice()),E=C.length,E<O&&C.unshift(0),t(b,C,O,i),l==-1&&(O=b.length,l=e(Z,b,D,O),l<1&&(m++,t(b,D<O?Y:Z,O,i))),O=b.length):l===0&&(m++,b=[0]),y[h++]=m,l&&b[0]?b[O++]=H[x]||0:(b=[H[x]],O=1);while((x++<v||b[0]!==void 0)&&V--);_=b[0]!==void 0}y[0]||y.shift()}if(d==1)p.e=c,nl=_;else{for(h=1,m=y[0];m>=10;m/=10)h++;p.e=h+c*d-1,re(p,o?s+p.e+1:s,u,_)}return p}})();function re(a,e,t,r){var n,s,u,o,i,l,c,h,m,d=a.constructor;e:if(e!=null){if(h=a.d,!h)return a;for(n=1,o=h[0];o>=10;o/=10)n++;if(s=e-n,s<0)s+=ne,u=e,c=h[m=0],i=c/we(10,n-u-1)%10|0;else if(m=Math.ceil((s+1)/ne),o=h.length,m>=o)if(r){for(;o++<=m;)h.push(0);c=i=0,n=1,s%=ne,u=s-ne+1}else break e;else{for(c=o=h[m],n=1;o>=10;o/=10)n++;s%=ne,u=s-ne+n,i=u<0?0:c/we(10,n-u-1)%10|0}if(r=r||e<0||h[m+1]!==void 0||(u<0?c:c%we(10,n-u-1)),l=t<4?(i||r)&&(t==0||t==(a.s<0?3:2)):i>5||i==5&&(t==4||r||t==6&&(s>0?u>0?c/we(10,n-u):0:h[m-1])%10&1||t==(a.s<0?8:7)),e<1||!h[0])return h.length=0,l?(e-=a.e+1,h[0]=we(10,(ne-e%ne)%ne),a.e=-e||0):h[0]=a.e=0,a;if(s==0?(h.length=m,o=1,m--):(h.length=m+1,o=we(10,ne-s),h[m]=u>0?(c/we(10,n-u)%we(10,u)|0)*o:0),l)for(;;)if(m==0){for(s=1,u=h[0];u>=10;u/=10)s++;for(u=h[0]+=o,o=1;u>=10;u/=10)o++;s!=o&&(a.e++,h[0]==dt&&(h[0]=1));break}else{if(h[m]+=o,h[m]!=dt)break;h[m--]=0,o=1}for(s=h.length;h[--s]===0;)h.pop()}return ie&&(a.e>d.maxE?(a.d=null,a.e=NaN):a.e<d.minE&&(a.e=0,a.d=[0])),a}function Mt(a,e,t){if(!a.isFinite())return hl(a);var r,n=a.e,s=Pe(a.d),u=s.length;return e?(t&&(r=t-u)>0?s=s.charAt(0)+"."+s.slice(1)+Ht(r):u>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(a.e<0?"e":"e+")+a.e):n<0?(s="0."+Ht(-n-1)+s,t&&(r=t-u)>0&&(s+=Ht(r))):n>=u?(s+=Ht(n+1-u),t&&(r=t-n-1)>0&&(s=s+"."+Ht(r))):((r=n+1)<u&&(s=s.slice(0,r)+"."+s.slice(r)),t&&(r=t-u)>0&&(n+1===u&&(s+="."),s+=Ht(r))),s}function Ks(a,e){var t=a[0];for(e*=ne;t>=10;t/=10)e++;return e}function bs(a,e,t){if(e>Sg)throw ie=!0,t&&(a.precision=t),Error(sl);return re(new a(ps),e,1,!0)}function St(a,e,t){if(e>Ga)throw Error(sl);return re(new a(ys),e,t,!0)}function il(a){var e=a.length-1,t=e*ne+1;if(e=a[e],e){for(;e%10==0;e/=10)t--;for(e=a[0];e>=10;e/=10)t++}return t}function Ht(a){for(var e="";a--;)e+="0";return e}function ll(a,e,t,r){var n,s=new a(1),u=Math.ceil(r/ne+4);for(ie=!1;;){if(t%2&&(s=s.times(e),$o(s.d,u)&&(n=!0)),t=$e(t/2),t===0){t=s.d.length-1,n&&s.d[t]===0&&++s.d[t];break}e=e.times(e),$o(e.d,u)}return ie=!0,s}function ko(a){return a.d[a.d.length-1]&1}function cl(a,e,t){for(var r,n,s=new a(e[0]),u=0;++u<e.length;){if(n=new a(e[u]),!n.s){s=n;break}r=s.cmp(n),(r===t||r===0&&s.s===t)&&(s=n)}return s}function Xa(a,e){var t,r,n,s,u,o,i,l=0,c=0,h=0,m=a.constructor,d=m.rounding,_=m.precision;if(!a.d||!a.d[0]||a.e>17)return new m(a.d?a.d[0]?a.s<0?0:1/0:1:a.s?a.s<0?0:a:NaN);for(e==null?(ie=!1,i=_):i=e,o=new m(.03125);a.e>-2;)a=a.times(o),h+=5;for(r=Math.log(we(2,h))/Math.LN10*2+5|0,i+=r,t=s=u=new m(1),m.precision=i;;){if(s=re(s.times(a),i,1),t=t.times(++c),o=u.plus(Oe(s,t,i,1)),Pe(o.d).slice(0,i)===Pe(u.d).slice(0,i)){for(n=h;n--;)u=re(u.times(u),i,1);if(e==null)if(l<3&&an(u.d,i-r,d,l))m.precision=i+=10,t=s=o=new m(1),c=0,l++;else return re(u,m.precision=_,d,ie=!0);else return m.precision=_,u}u=o}}function Xt(a,e){var t,r,n,s,u,o,i,l,c,h,m,d=1,_=10,C=a,E=C.d,p=C.constructor,y=p.rounding,b=p.precision;if(C.s<0||!E||!E[0]||!C.e&&E[0]==1&&E.length==1)return new p(E&&!E[0]?-1/0:C.s!=1?NaN:E?0:C);if(e==null?(ie=!1,c=b):c=e,p.precision=c+=_,t=Pe(E),r=t.charAt(0),Math.abs(s=C.e)<15e14){for(;r<7&&r!=1||r==1&&t.charAt(1)>3;)C=C.times(a),t=Pe(C.d),r=t.charAt(0),d++;s=C.e,r>1?(C=new p("0."+t),s++):C=new p(r+"."+t.slice(1))}else return l=bs(p,c+2,b).times(s+""),C=Xt(new p(r+"."+t.slice(1)),c-_).plus(l),p.precision=b,e==null?re(C,b,y,ie=!0):C;for(h=C,i=u=C=Oe(C.minus(1),C.plus(1),c,1),m=re(C.times(C),c,1),n=3;;){if(u=re(u.times(m),c,1),l=i.plus(Oe(u,new p(n),c,1)),Pe(l.d).slice(0,c)===Pe(i.d).slice(0,c))if(i=i.times(2),s!==0&&(i=i.plus(bs(p,c+2,b).times(s+""))),i=Oe(i,new p(d),c,1),e==null)if(an(i.d,c-_,y,o))p.precision=c+=_,l=u=C=Oe(h.minus(1),h.plus(1),c,1),m=re(C.times(C),c,1),n=o=1;else return re(i,p.precision=b,y,ie=!0);else return p.precision=b,i;i=l,n+=2}}function hl(a){return String(a.s*a.s/0)}function Qn(a,e){var t,r,n;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(t<0&&(t=r),t+=+e.slice(r+1),e=e.substring(0,r)):t<0&&(t=e.length),r=0;e.charCodeAt(r)===48;r++);for(n=e.length;e.charCodeAt(n-1)===48;--n);if(e=e.slice(r,n),e){if(n-=r,a.e=t=t-r-1,a.d=[],r=(t+1)%ne,t<0&&(r+=ne),r<n){for(r&&a.d.push(+e.slice(0,r)),n-=ne;r<n;)a.d.push(+e.slice(r,r+=ne));e=e.slice(r),r=ne-e.length}else r-=n;for(;r--;)e+="0";a.d.push(+e),ie&&(a.e>a.constructor.maxE?(a.d=null,a.e=NaN):a.e<a.constructor.minE&&(a.e=0,a.d=[0]))}else a.e=0,a.d=[0];return a}function Mg(a,e){var t,r,n,s,u,o,i,l,c;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ol.test(e))return Qn(a,e)}else if(e==="Infinity"||e==="NaN")return+e||(a.s=NaN),a.e=NaN,a.d=null,a;if(yg.test(e))t=16,e=e.toLowerCase();else if(pg.test(e))t=2;else if(bg.test(e))t=8;else throw Error(Kt+e);for(s=e.search(/p/i),s>0?(i=+e.slice(s+1),e=e.substring(2,s)):e=e.slice(2),s=e.indexOf("."),u=s>=0,r=a.constructor,u&&(e=e.replace(".",""),o=e.length,s=o-s,n=ll(r,new r(t),s,s*2)),l=Wn(e,t,dt),c=l.length-1,s=c;l[s]===0;--s)l.pop();return s<0?new r(a.s*0):(a.e=Ks(l,c),a.d=l,ie=!1,u&&(a=Oe(a,n,o*4)),i&&(a=a.times(Math.abs(i)<54?we(2,i):U.pow(2,i))),ie=!0,a)}function Vg(a,e){var t,r=e.d.length;if(r<3)return e.isZero()?e:Fr(a,2,e,e);t=1.4*Math.sqrt(r),t=t>16?16:t|0,e=e.times(1/Zs(5,t)),e=Fr(a,2,e,e);for(var n,s=new a(5),u=new a(16),o=new a(20);t--;)n=e.times(e),e=e.times(s.plus(n.times(u.times(n).minus(o))));return e}function Fr(a,e,t,r,n){var s,u,o,i,l=a.precision,c=Math.ceil(l/ne);for(ie=!1,i=t.times(t),o=new a(r);;){if(u=Oe(o.times(i),new a(e++*e++),l,1),o=n?r.plus(u):r.minus(u),r=Oe(u.times(i),new a(e++*e++),l,1),u=o.plus(r),u.d[c]!==void 0){for(s=c;u.d[s]===o.d[s]&&s--;);if(s==-1)break}s=o,o=r,r=u,u=s}return ie=!0,u.d.length=c+1,u}function Zs(a,e){for(var t=a;--e;)t*=a;return t}function ml(a,e){var t,r=e.s<0,n=St(a,a.precision,1),s=n.times(.5);if(e=e.abs(),e.lte(s))return wt=r?4:1,e;if(t=e.divToInt(n),t.isZero())wt=r?3:2;else{if(e=e.minus(t.times(n)),e.lte(s))return wt=ko(t)?r?2:3:r?4:1,e;wt=ko(t)?r?1:4:r?3:2}return e.minus(n).abs()}function Pu(a,e,t,r){var n,s,u,o,i,l,c,h,m,d=a.constructor,_=t!==void 0;if(_?(Qe(t,1,Jt),r===void 0?r=d.rounding:Qe(r,0,8)):(t=d.precision,r=d.rounding),!a.isFinite())c=hl(a);else{for(c=Mt(a),u=c.indexOf("."),_?(n=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):n=e,u>=0&&(c=c.replace(".",""),m=new d(1),m.e=c.length-u,m.d=Wn(Mt(m),10,n),m.e=m.d.length),h=Wn(c,10,n),s=i=h.length;h[--i]==0;)h.pop();if(!h[0])c=_?"0p+0":"0";else{if(u<0?s--:(a=new d(a),a.d=h,a.e=s,a=Oe(a,m,t,r,0,n),h=a.d,s=a.e,l=nl),u=h[t],o=n/2,l=l||h[t+1]!==void 0,l=r<4?(u!==void 0||l)&&(r===0||r===(a.s<0?3:2)):u>o||u===o&&(r===4||l||r===6&&h[t-1]&1||r===(a.s<0?8:7)),h.length=t,l)for(;++h[--t]>n-1;)h[t]=0,t||(++s,h.unshift(1));for(i=h.length;!h[i-1];--i);for(u=0,c="";u<i;u++)c+=Ya.charAt(h[u]);if(_){if(i>1)if(e==16||e==8){for(u=e==16?4:3,--i;i%u;i++)c+="0";for(h=Wn(c,n,e),i=h.length;!h[i-1];--i);for(u=1,c="1.";u<i;u++)c+=Ya.charAt(h[u])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>i)for(s-=i;s--;)c+="0";else s<i&&(c=c.slice(0,s)+"."+c.slice(s))}c=(e==16?"0x":e==2?"0b":e==8?"0o":"")+c}return a.s<0?"-"+c:c}function $o(a,e){if(a.length>e)return a.length=e,!0}function Tg(a){return new this(a).abs()}function Ig(a){return new this(a).acos()}function xg(a){return new this(a).acosh()}function Ug(a,e){return new this(a).plus(e)}function vg(a){return new this(a).asin()}function wg(a){return new this(a).asinh()}function Dg(a){return new this(a).atan()}function Lg(a){return new this(a).atanh()}function Pg(a,e){a=new this(a),e=new this(e);var t,r=this.precision,n=this.rounding,s=r+4;return!a.s||!e.s?t=new this(NaN):!a.d&&!e.d?(t=St(this,s,1).times(e.s>0?.25:.75),t.s=a.s):!e.d||a.isZero()?(t=e.s<0?St(this,r,n):new this(0),t.s=a.s):!a.d||e.isZero()?(t=St(this,s,1).times(.5),t.s=a.s):e.s<0?(this.precision=s,this.rounding=1,t=this.atan(Oe(a,e,s,1)),e=St(this,s,1),this.precision=r,this.rounding=n,t=a.s<0?t.minus(e):t.plus(e)):t=this.atan(Oe(a,e,s,1)),t}function Fg(a){return new this(a).cbrt()}function jg(a){return re(a=new this(a),a.e+1,2)}function Bg(a,e,t){return new this(a).clamp(e,t)}function kg(a){if(!a||typeof a!="object")throw Error(Qs+"Object expected");var e,t,r,n=a.defaults===!0,s=["precision",1,Jt,"rounding",0,8,"toExpNeg",-Mr,0,"toExpPos",0,Mr,"maxE",0,Mr,"minE",-Mr,0,"modulo",0,9];for(e=0;e<s.length;e+=3)if(t=s[e],n&&(this[t]=Ha[t]),(r=a[t])!==void 0)if($e(r)===r&&r>=s[e+1]&&r<=s[e+2])this[t]=r;else throw Error(Kt+t+": "+r);if(t="crypto",n&&(this[t]=Ha[t]),(r=a[t])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(al);else this[t]=!1;else throw Error(Kt+t+": "+r);return this}function $g(a){return new this(a).cos()}function Yg(a){return new this(a).cosh()}function gl(a){var e,t,r;function n(s){var u,o,i,l=this;if(!(l instanceof n))return new n(s);if(l.constructor=n,Yo(s)){l.s=s.s,ie?!s.d||s.e>n.maxE?(l.e=NaN,l.d=null):s.e<n.minE?(l.e=0,l.d=[0]):(l.e=s.e,l.d=s.d.slice()):(l.e=s.e,l.d=s.d?s.d.slice():s.d);return}if(i=typeof s,i==="number"){if(s===0){l.s=1/s<0?-1:1,l.e=0,l.d=[0];return}if(s<0?(s=-s,l.s=-1):l.s=1,s===~~s&&s<1e7){for(u=0,o=s;o>=10;o/=10)u++;ie?u>n.maxE?(l.e=NaN,l.d=null):u<n.minE?(l.e=0,l.d=[0]):(l.e=u,l.d=[s]):(l.e=u,l.d=[s]);return}if(s*0!==0){s||(l.s=NaN),l.e=NaN,l.d=null;return}return Qn(l,s.toString())}if(i==="string")return(o=s.charCodeAt(0))===45?(s=s.slice(1),l.s=-1):(o===43&&(s=s.slice(1)),l.s=1),ol.test(s)?Qn(l,s):Mg(l,s);if(i==="bigint")return s<0?(s=-s,l.s=-1):l.s=1,Qn(l,s.toString());throw Error(Kt+s)}if(n.prototype=B,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=kg,n.clone=gl,n.isDecimal=Yo,n.abs=Tg,n.acos=Ig,n.acosh=xg,n.add=Ug,n.asin=vg,n.asinh=wg,n.atan=Dg,n.atanh=Lg,n.atan2=Pg,n.cbrt=Fg,n.ceil=jg,n.clamp=Bg,n.cos=$g,n.cosh=Yg,n.div=Hg,n.exp=Gg,n.floor=Xg,n.hypot=qg,n.ln=Wg,n.log=Qg,n.log10=Zg,n.log2=Kg,n.max=zg,n.min=Jg,n.mod=ef,n.mul=tf,n.pow=rf,n.random=nf,n.round=sf,n.sign=af,n.sin=uf,n.sinh=of,n.sqrt=lf,n.sub=cf,n.sum=hf,n.tan=mf,n.tanh=gf,n.trunc=ff,a===void 0&&(a={}),a&&a.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<r.length;)a.hasOwnProperty(t=r[e++])||(a[t]=this[t]);return n.config(a),n}function Hg(a,e){return new this(a).div(e)}function Gg(a){return new this(a).exp()}function Xg(a){return re(a=new this(a),a.e+1,3)}function qg(){var a,e,t=new this(0);for(ie=!1,a=0;a<arguments.length;)if(e=new this(arguments[a++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return ie=!0,new this(1/0);t=e}return ie=!0,t.sqrt()}function Yo(a){return a instanceof U||a&&a.toStringTag===ul||!1}function Wg(a){return new this(a).ln()}function Qg(a,e){return new this(a).log(e)}function Kg(a){return new this(a).log(2)}function Zg(a){return new this(a).log(10)}function zg(){return cl(this,arguments,-1)}function Jg(){return cl(this,arguments,1)}function ef(a,e){return new this(a).mod(e)}function tf(a,e){return new this(a).mul(e)}function rf(a,e){return new this(a).pow(e)}function nf(a){var e,t,r,n,s=0,u=new this(1),o=[];if(a===void 0?a=this.precision:Qe(a,1,Jt),r=Math.ceil(a/ne),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(r));s<r;)n=e[s],n>=429e7?e[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=n%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(r*=4);s<r;)n=e[s]+(e[s+1]<<8)+(e[s+2]<<16)+((e[s+3]&127)<<24),n>=214e7?crypto.randomBytes(4).copy(e,s):(o.push(n%1e7),s+=4);s=r/4}else throw Error(al);else for(;s<r;)o[s++]=Math.random()*1e7|0;for(r=o[--s],a%=ne,r&&a&&(n=we(10,ne-a),o[s]=(r/n|0)*n);o[s]===0;s--)o.pop();if(s<0)t=0,o=[0];else{for(t=-1;o[0]===0;t-=ne)o.shift();for(r=1,n=o[0];n>=10;n/=10)r++;r<ne&&(t-=ne-r)}return u.e=t,u.d=o,u}function sf(a){return re(a=new this(a),a.e+1,this.rounding)}function af(a){return a=new this(a),a.d?a.d[0]?a.s:0*a.s:a.s||NaN}function uf(a){return new this(a).sin()}function of(a){return new this(a).sinh()}function lf(a){return new this(a).sqrt()}function cf(a,e){return new this(a).sub(e)}function hf(){var a=0,e=arguments,t=new this(e[a]);for(ie=!1;t.s&&++a<e.length;)t=t.plus(e[a]);return ie=!0,re(t,this.precision,this.rounding)}function mf(a){return new this(a).tan()}function gf(a){return new this(a).tanh()}function ff(a){return re(a=new this(a),a.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var U=B.constructor=gl(Ha);ps=new U(ps);ys=new U(ys);function df(a,e){const t=a+e;return Number.isSafeInteger(t)?t:new U(a).add(e).toNumber()}function Nf(a,e){const t=a-e;return Number.isSafeInteger(t)?t:new U(a).sub(e).toNumber()}function Xr(a,e){const t=a*e;return Number.isSafeInteger(t)?t:new U(a).mul(e).toNumber()}function _f(a,e){const t=a/e;return Number.isSafeInteger(t)?t:new U(a).div(e).toNumber()}function qt(a,e){const t=10**Math.trunc(e),r=zs(a,t);return Math.round(Xr(a,t)+r)/t}function Je(a,e){const t=10**Math.trunc(e),r=zs(a,t);return Math.floor(Xr(a,t)+r)/t}function qe(a,e){const t=10**Math.trunc(e),r=zs(a,t);return Math.ceil(Xr(a,t)-r)/t}function zs(a,e){return Number.EPSILON*Math.max(1,Math.abs(Xr(a,e)))}function Ho(a,e){return a-e*Math.floor(a/e)}function Cf(a,e){return a**e}function Ef(a){return Math.sqrt(a)}function Go(a,e){return a===e}function Af(a,e){return a>e}function pf(a,e){return a>=e}function yf(a,e){return a<e}function bf(a,e){return a<=e}function qa(a,e=15){return Math.floor(Math.abs(a)).toString().length>=e?a:Number.parseFloat(a.toPrecision(e))}function Rf(a,e,t=Number.EPSILON){return Math.abs(a-e)<t}function Js(a,e=12,t=1e-10){const r=qa(a,e);return Rf(a,r,t)?r:qa(a)}function Sf(a){return a-Math.trunc(a)}const fl=class dl extends jt{static create(){return this._instance=this._instance||new dl(0),this._instance}isNull(){return!0}plus(e){return A.create(0).plus(e)}minus(e){return A.create(0).minus(e)}multiply(e){return A.create(0).multiply(e)}divided(e){return A.create(0).divided(e)}mod(e){return A.create(0).mod(e)}compare(e,t){return e.isString()?w.create("").compare(e,t):e.isBoolean()?P.create(!1).compare(e,t):A.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(w.create("")):w.create(this.concatenate(e.getValue(),gt.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(w.create("")):w.create(this.concatenate(e.getValue(),gt.BACK))}plusBy(e){return A.create(0).plusBy(e)}minusBy(e){return A.create(0).minusBy(e)}multiplyBy(e){return A.create(0).multiplyBy(e)}dividedBy(e){return A.create(0).dividedBy(e)}compareBy(e,t){return typeof e=="string"?w.create("").compareBy(e,t):typeof e=="boolean"?P.create(!1).compareBy(e,t):A.create(0).compareBy(e,t)}pow(e){return A.create(0).pow(e)}sqrt(){return A.create(0).sqrt()}cbrt(){return A.create(0).cbrt()}cos(){return A.create(0).cos()}cosh(){return A.create(0).cosh()}acos(){return A.create(0).acos()}acosh(){return A.create(0).acosh()}sin(){return A.create(0).sin()}sinh(){return A.create(0).sinh()}asin(){return A.create(0).asin()}asinh(){return A.create(0).asinh()}tan(){return A.create(0).tan()}tanh(){return A.create(0).tanh()}atan(){return A.create(0).atan()}atan2(e){return A.create(0).atan2(e)}atanh(){return A.create(0).atanh()}log(){return f.create(g.NUM)}log10(){return f.create(g.NUM)}exp(){return A.create(0).exp()}abs(){return A.create(0).abs()}round(e){return A.create(0).round(e)}floor(e){return A.create(0).floor(e)}ceil(e){return A.create(0).ceil(e)}convertToNumberObjectValue(){return A.create(0)}convertToBooleanObjectValue(){return P.create(!1)}};N(fl,"_instance");let ce=fl;const Wa=class Kn extends jt{constructor(e){super(e),N(this,"_value",!1),this._value=e}static create(e){return e?(this._instanceTrue=this._instanceTrue||new Kn(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new Kn(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){const e=this.getValue();let t=0;return e&&(t=1),A.create(-t)}getReciprocal(){return this.getValue()?A.create(1):f.create(g.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,Lu(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(e,t){let r=!1;if(typeof e=="string"||typeof e=="number")r=this._compareString(t);else if(typeof e=="boolean"){const n=A.create(e?1:0);return this._convertToNumber().compare(n,t)}return Kn.create(r)}_compareString(e){switch(e){case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:return!0;case k.EQUALS:case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:case k.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){const e=this.getValue();let t=0;return e&&(t=1),A.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return un(this.getValue())}convertToBooleanObjectValue(){return this}};N(Wa,"_instanceTrue"),N(Wa,"_instanceFalse");let P=Wa;class A extends jt{constructor(e){super(e),N(this,"_value",0),this._value=Number(e)}static create(e,t=""){const r=new A(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return A.create(0).minus(this)}getReciprocal(){return A.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.plusBy(t.getValue());if(r.isError())return r;const n=Dn(this.getPattern(),t.getPattern(),K.PLUS);return r=A.create(Number(r.getValue()),n),r}equalZero(){return this._value===0}minus(e){if(e.isArray()){const s=e.getNegative();return s.isError()?s:s.plus(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.minusBy(t.getValue());if(r.isError())return r;const n=Dn(this.getPattern(),t.getPattern(),K.MINUS);return r=A.create(Number(r.getValue()),n),r}multiply(e){if(e.isArray())return e.multiply(this);let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.multiplyBy(t.getValue());if(r.isError())return r;const n=Dn(this.getPattern(),t.getPattern(),K.MULTIPLY);return r=A.create(Number(r.getValue()),n),r}divided(e){if(e.isArray()){const s=e.getReciprocal();return s.isError()?s:s.multiply(this)}let t=e;e.isNumber()||(t=e.convertToNumberObjectValue());let r=this.dividedBy(t.getValue());if(r.isError())return r;const n=Dn(this.getPattern(),t.getPattern(),K.DIVIDED);return r=A.create(Number(r.getValue()),n),r}mod(e){if(e.isArray())return e.modInverse(this);const t=this.getValue(),r=e.getValue();if(e.isNull())return f.create(g.DIV_BY_ZERO);if(typeof r=="string")return f.create(g.VALUE);if(typeof r=="number"){if(r===0)return f.create(g.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||Math.abs(r)*11259e8<=Math.abs(t))return f.create(g.NUM);const n=Ho(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}if(typeof r=="boolean"){const n=r?1:0;return n===0?f.create(g.DIV_BY_ZERO):A.create(Ho(t,n))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):w.create(this.concatenate(e.getValue(),gt.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):w.create(this.concatenate(e.getValue(),gt.BACK))}isDateFormat(){const e=this.getPattern();return yr.isDateFormat(e)}compare(e,t){if(e.isArray())return e.compare(this,Lu(t));let r=!1;return e.isDateFormat()&&this.isDateFormat()&&(r=!0),this.compareBy(e.getValue(),t,r)}plusBy(e){if(typeof e=="string"&&e.trim()==="")return f.create(g.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return f.create(g.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=df(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}minusBy(e){if(typeof e=="string"&&e.trim()==="")return f.create(g.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return f.create(g.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=Nf(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}multiplyBy(e){if(typeof e=="string"&&e.trim()==="")return f.create(g.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return f.create(g.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=Xr(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}dividedBy(e){if(typeof e=="string"&&e.trim()==="")return f.create(g.VALUE);const t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return f.create(g.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);if(r===0)return f.create(g.DIV_BY_ZERO);const n=_f(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}compareBy(e,t,r=!1){const n=this.getValue();let s=!1,u=n,o=e;return r&&(u=Math.round(n*1e8)/1e8,o=Math.round(e*1e8)/1e8),typeof o=="string"?s=this._compareString(t):typeof o=="number"?s=this._compareNumber(u,o,t):typeof o=="boolean"&&(s=this._compareBoolean(t)),P.create(s)}_compareString(e){switch(e){case k.EQUALS:case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:return!1;case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:case k.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return!Number.isFinite(e)||!Number.isFinite(t)?this._compareInfinity(e,t,r):this._compareFiniteNumber(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case k.EQUALS:return Go(e,t);case k.GREATER_THAN:return Af(e,t);case k.GREATER_THAN_OR_EQUAL:return pf(e,t);case k.LESS_THAN:return yf(e,t);case k.LESS_THAN_OR_EQUAL:return bf(e,t);case k.NOT_EQUAL:return!Go(e,t)}}_compareBoolean(e){switch(e){case k.EQUALS:case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:return!1;case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:case k.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;const t=this.getValue();let r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;const n=+r.getValue();if(Number.isNaN(n))return f.create(g.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return f.create(g.NUM);if(t===0)return n<0?f.create(g.DIV_BY_ZERO):n===0?f.create(g.NUM):A.create(0);const s=Cf(t,n);return Number.isFinite(s)?A.create(s):f.create(g.NUM)}sqrt(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Ef(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}cbrt(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.cbrt(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}cos(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.cos(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}cosh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.cosh(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}acos(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.acos(e);return Number.isNaN(t)?f.create(g.NUM):A.create(t)}acosh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.acosh(e);return Number.isNaN(t)?f.create(g.NUM):A.create(t)}sin(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.sin(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}sinh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.sinh(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}asin(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.asin(e);return Number.isNaN(t)?f.create(g.NUM):A.create(t)}asinh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.asinh(e);return Number.isNaN(t)?f.create(g.NUM):A.create(t)}tan(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.tan(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}tanh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.tanh(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}atan(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.atan(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return f.create(g.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);if(t===0&&r===0)return f.create(g.DIV_BY_ZERO);const n=Math.atan2(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}return typeof r=="boolean"?A.create(Math.atan2(t,r?1:0)):this}atanh(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.atanh(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}log(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return f.create(g.NUM);const t=Math.log(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}log10(){const e=this.getValue();if(typeof e=="number"&&e<=0||!Number.isFinite(e))return f.create(g.NUM);const t=Math.log10(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}exp(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.exp(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}abs(){const e=this.getValue();if(!Number.isFinite(e))return f.create(g.NUM);const t=Math.abs(e);return Number.isFinite(t)?A.create(t):f.create(g.NUM)}round(e){if(e.isArray())return e.roundInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return f.create(g.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=t<0?-qt(Math.abs(t),r):qt(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}return typeof r=="boolean"?A.create(qt(t,r?1:0)):this}floor(e){if(e.isArray())return e.floorInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return f.create(g.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=t<0?-Je(Math.abs(t),r):Je(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}return typeof r=="boolean"?A.create(Je(t,r?1:0)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);const t=this.getValue(),r=e.getValue();if(typeof r=="string")return f.create(g.VALUE);if(typeof r=="number"){if(!Number.isFinite(t)||!Number.isFinite(r))return f.create(g.NUM);const n=t<0?-qe(Math.abs(t),r):qe(t,r);return Number.isFinite(n)?A.create(n):f.create(g.NUM)}return typeof r=="boolean"?A.create(qe(t,r?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return ea(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case k.EQUALS:n=e===t;break;case k.GREATER_THAN:n=e>t;break;case k.GREATER_THAN_OR_EQUAL:n=e>=t;break;case k.LESS_THAN:n=e<t;break;case k.LESS_THAN_OR_EQUAL:n=e<=t;break;case k.NOT_EQUAL:n=e!==t;break}return n}}const Of=1e5,Qa=new Ft(Of);class w extends jt{constructor(e){super(e),N(this,"_value"),N(this,"_isHyperlink",!1),N(this,"_hyperlinkUrl",""),N(this,"_isImage",!1),N(this,"_imageInfo"),this._value=e}static create(e,t){var r;const n=Qa.get(e);if(n&&t&&this.checkCacheByOptions(n,t))return n;const s=new w(e);return t!=null&&t.isHyperlink&&(s._isHyperlink=t.isHyperlink,s._hyperlinkUrl=(r=t.hyperlinkUrl)!=null?r:""),t!=null&&t.isImage&&(s._isImage=t.isImage,s._imageInfo=t.imageInfo),Qa.set(e,s),s}static checkCacheByOptions(e,t){return!(e.isHyperlink()!==t.isHyperlink||e.getHyperlinkUrl()!==t.hyperlinkUrl||e.isImage()!==t.isImage||!Xe.diffValue(e.getImageInfo(),t.imageInfo))}getValue(){return this._value}isString(){return!0}isHyperlink(){return this._isHyperlink}getHyperlinkUrl(){return this._hyperlinkUrl}isImage(){return this._isImage}getImageInfo(){return this._imageInfo}concatenateFront(e){return e.isArray()?e.concatenateBack(this):w.create(this.concatenate(e.getValue(),gt.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):w.create(this.concatenate(e.getValue(),gt.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,Lu(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),s=!1;if(typeof e=="string"){let u=e;if(r||(n=n.toLocaleLowerCase(),u=u.toLocaleLowerCase()),rl(u))return this._checkWildcard(u,t);s=this._compareString(n,u,t)}else typeof e=="number"?s=this._compareNumber(t):typeof e=="boolean"&&(s=this._compareBoolean(t));return P.create(s)}_compareString(e,t,r){switch(r){case k.EQUALS:return e===t;case k.GREATER_THAN:return e>t;case k.GREATER_THAN_OR_EQUAL:return e>=t;case k.LESS_THAN:return e<t;case k.LESS_THAN_OR_EQUAL:return e<=t;case k.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case k.NOT_EQUAL:case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:return!0;case k.EQUALS:case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case k.EQUALS:case k.GREATER_THAN:case k.GREATER_THAN_OR_EQUAL:return!1;case k.LESS_THAN:case k.LESS_THAN_OR_EQUAL:case k.NOT_EQUAL:return!0}}convertToNumberObjectValue(){const e=this.getValue(),t=js(e);return t&&t.z?un(t.v,t.z):un(e)}convertToBooleanObjectValue(){return P.create(!0)}_checkWildcard(e,t){const r=this.getValue().toLocaleLowerCase(),n=ig(r,e,t);return P.create(n)}}function ea(a){if(typeof a=="boolean")return P.create(a);let e=!1;if(typeof a=="string"){const t=a.toLocaleUpperCase();t===Wt.TRUE?e=!0:t===Wt.FALSE&&(e=!1)}else a===1?e=!0:e=!1;return P.create(e)}function Mf(a){let e=a.toString();return e.charAt(0)==='"'&&e.charAt(e.length-1)==='"'&&(e=e.slice(1,-1),e=e.replace(/""/g,'"')),w.create(e)}function un(a,e=""){if(typeof a=="boolean"){let t=0;return a&&(t=1),A.create(t,e)}else{if(typeof a=="number")return Number.isFinite(a)?A.create(a,e):f.create(g.NUM);if(Q(a))return A.create(Number(a),e)}return f.create(g.VALUE)}function Vf(a){return""}function Nl(a=[],e=!1){const t=[];for(let r=0;r<a.length;r++){const n=a[r];t[r]==null&&(t[r]=[]);for(let s=0;s<n.length;s++){const u=n[s];t[r][s]=Vt.create(u,e)}}return t}function Tf(a=[]){const e=[];for(let t=0;t<a.length;t++){const r=a[t];e[t]==null&&(e[t]=[]);for(let n=0;n<r.length;n++){const s=r[n];s==null?e[t][n]=null:s.isError()?e[t][n]=s.getErrorType():e[t][n]=s.getValue()}}return e}class W extends jt{constructor(e){super(typeof e=="string"?e:Vf()),N(this,"_values",[]),N(this,"_rowCount",-1),N(this,"_columnCount",-1),N(this,"_unitId",""),N(this,"_sheetId",""),N(this,"_currentRow",-1),N(this,"_currentColumn",-1),N(this,"_sliceCache",new Map),N(this,"_flattenCache"),N(this,"_defaultValue",null),N(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(e){return new W(e)}static createByArray(e){const t={calculateValueList:Nl(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1};return new W(t)}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return((r=this._values[e])==null?void 0:r[t])||this._defaultValue}getRealValue(e,t){const r=this._values[e];if(r==null)return null;const n=r[t];return n??null}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount){console.error("Exceeding array bounds.");return}this._clearCache(),this._values[e][t]=r}getRangePosition(){const e=this.getRowCount(),t=0,r=this.getColumnCount();return{startRow:0,endRow:e-1,startColumn:t,endColumn:r-1}}iterator(e){var t;const{startRow:r,endRow:n,startColumn:s,endColumn:u}=this.getRangePosition(),o=this.getArrayValue();for(let i=r;i<=n;i++)for(let l=s;l<=u;l++)if(e(((t=o[i])==null?void 0:t[l])||this._defaultValue,i,l)===!1)return}iteratorReverse(e){var t;const{startRow:r,endRow:n,startColumn:s,endColumn:u}=this.getRangePosition(),o=this.getArrayValue();for(let i=n;i>=r;i--)for(let l=u;l>=s;l--)if(e(((t=o[i])==null?void 0:t[l])||this._defaultValue,i,l)===!1)return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(t!=null&&t.isBoolean()&&t.getValue()===!0)return e={row:r,column:n},!1}),e}getFirstCell(){const{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||ce.create()}getLastCell(){const{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||ce.create()}pick(e){const t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){const t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[ce.create()]];const n=[];n[0]=[];for(let s=0;s<t;s++)for(let u=0;u<r;u++){const o=e.get(s,u);if(!(o==null||o.isError())&&o.getValue()===!0){const i=this.get(s,u);n[0].push(i)}}return n}flatten(){if(this._flattenCache!=null)return this._flattenCache;const e=[];e[0]=[];for(let r=0;r<this._rowCount;r++)for(let n=0;n<this._columnCount;n++){const s=this.get(r,n);e[0].push(s)}const t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(this._flattenPosition!=null)return this._flattenPosition;const e=[],t=[],r=[],n=[];let s=0;for(let o=0;o<this._rowCount;o++)for(let i=0;i<this._columnCount;i++){const l=this.get(o,i);if(l==null||l.isError()||l.isNull()){s++;continue}l.isString()?(e.push(l),r.push(s++)):(t.push(l),n.push(s++))}const u={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=u,u}slice(e,t){let r=0,n=this._rowCount,s=1,u=0,o=this._columnCount,i=1;if(e!=null&&(r=e[0]||0,n=e[1]||this._rowCount,s=e[2]||1),t!=null&&(u=t[0]||0,o=t[1]||this._columnCount,i=t[2]||1),r>=this._rowCount||u>=this._columnCount)return;const l=`${r}_${n}_${s}_${u}_${o}_${i}`,c=this._sliceCache.get(l);if(c!=null)return c;const h=[],m=this._values;let d=0,_=0;for(let y=r;y<n;y+=s){_=0,h[d]==null&&(h[d]=[]);for(let b=u;b<o;b+=i){if(!m[y])return;let O=m[y][b]||this._defaultValue;O==null&&(O=ce.create()),h[d][_]=O,_++}d++}if(h.length===0||h[0].length===0)return;const C=s>1?-1:r+this._currentRow,E=i>1?-1:u+this._currentColumn,p=this._createNewArray(h,h.length,h[0].length,C,E);return p.setDefaultValue(this._defaultValue),this._sliceCache.set(l,p),p}sortByRow(e){const t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){const e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=ve.MIN,r=!1,n=!1){let s,u,o,i;const l=(c,h,m)=>{if(c==null||c.isNull())return!0;let d;if(n===!0?d=c.compare(e,k.EQUALS):d=c.isEqual(e),d?.getValue()===!0)return s=c,o={row:h,column:m},!1;t===ve.MAX?c.isGreaterThan(e).getValue()===!0&&(u==null||c.minus(e).abs().isLessThanOrEqual(u.minus(e).abs()).getValue()===!0)&&(u=c,i={row:h,column:m}):t===ve.MIN&&c.isLessThan(e).getValue()===!0&&(u==null||c.minus(e).abs().isLessThanOrEqual(u.minus(e).abs()).getValue()===!0)&&(u=c,i={row:h,column:m})};if(r?this.iteratorReverse((c,h,m)=>l(c,h,m)):this.iterator((c,h,m)=>l(c,h,m)),s!=null)return o;if(u!=null)return i}binarySearch(e,t=rr.MIN,r=ve.MIN){if(e.isError())return;const{stringArray:n,stringPosition:s,numberArray:u,numberPosition:o}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,s,t,r):this._binarySearch(e,u,o,t,r)}_binarySearch(e,t,r,n=rr.MIN,s=ve.MIN){const u=As(),o=Number(e.getValue()),i=!Number.isNaN(o);let l=0,c=t.length-1,h=-1,m=-1,d=-1;for(;l<=c;){const _=Math.floor((l+c)/2),C=t[_];let E;if(C.isNull())E=n===rr.MIN?1:-1;else{const p=C.getValue();if(i){const y=Number(p);E=Number.isNaN(y)?1:Math.sign(y-o)}else E=u(p.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===rr.MAX&&(E=-E),E===0){h=_;break}E<0?(m=_,l=_+1):(d=_,c=_-1)}if(s===ve.NORMAL)return h!==-1?r[h]:void 0;if(s===ve.MIN)return h!==-1?r[h]:n===rr.MIN?r[m]:r[d];if(s===ve.MAX)return h!==-1?r[h]:n===rr.MIN?r[d]:r[m]}sum(){let e=A.create(0);return this.iterator(t=>{if(t==null||t.isString()||t.isBoolean()||t.isNull())return!0;if(t.isError())return e=t,!1;e=e.plus(t)}),e}max(){let e=A.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isLessThan(t).getValue()&&(e=t)}),e}min(){let e=A.create(Number.POSITIVE_INFINITY);return this.iterator(t=>{if(t==null)return!0;if(t.isError())return e=t,!1;if(t.isString()||t.isNull()||t.isBoolean())return!0;e.isGreaterThan(t).getValue()&&(e=t)}),e}count(){let e=A.create(0);return this.iterator(t=>{if(t==null||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=A.create(0);return this.iterator(t=>{if(t==null||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=A.create(0);return this.iterator(t=>{(t==null||t.isNull()||t.getValue()==="")&&(e=e.plusBy(1))}),e}getNegative(){return W.create("{0}").minus(this)}getReciprocal(){return W.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){const t=(r,n,s)=>r==null?ce.create():r.isError()?r:e(r,n,s);return this.mapValue(t)}mapValue(e){var t;const r=this._rowCount,n=this._columnCount,s=[];for(let u=0;u<r;u++){const o=[];for(let i=0;i<n;i++){const l=(t=this._values)==null?void 0:t[u];if(l==null)o[i]=f.create(g.VALUE);else{const c=l[i]||this._defaultValue;c?o[i]=e(c,u,i):o[i]=ce.create()}}s.push(o)}return this._createNewArray(s,r,n)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){const t=this.sum(),r=this.count();return t.divided(e===0?r:r.minusBy(1))}median(){const e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||ce.create();if(t.sortByRow(0),r%2===0){const n=t.get(0,r/2)||ce.create(),s=t.get(0,r/2-1)||ce.create();return n.plus(s).divided(A.create(2))}return t.get(0,(r-1)/2)||ce.create()}var(e=0){const t=this.mean(),r=[[]];this.iterator(i=>{if(i==null||i.isError()||i.isString()||i.isBoolean()||i.isNull())return;const l=i.minus(t).pow(A.create(2));l.isError()||r[0].push(l)});const{_unitId:n,_sheetId:s,_currentRow:u,_currentColumn:o}=this;return W.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:s,row:u,column:o}).mean(e)}std(e=0){const t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return Tf(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){const t=As();return(r,n)=>{const s=r[e],u=n[e];return s==null?1:u==null?-1:s.isError()&&s.isError()?0:s.isError()?1:u.isError()?-1:t(s.getValue(),u.getValue())}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let u=0;u<t;u++)n[s][u]=e[u][s]}return n}_batchOperator(e,t,r,n){const s=[];let u=this._rowCount,o=this._columnCount;if(e.isArray()){const c=e.getRowCount(),h=e.getColumnCount();if(u=Math.max(c,u),o=Math.max(h,o),c===1&&h===1){const m=e.getFirstCell();for(let d=0;d<o;d++)s.push(m)}else if(c===1&&this._columnCount>1){const m=e.getArrayValue();for(let d=0;d<o;d++)m[0]&&m[0][d]?s.push(m[0][d]):s.push(ce.create())}else return this._batchOperatorArray(e,t,r,n)}else for(let c=0;c<o;c++)s.push(e);const i=[];for(let c=0;c<o;c++){const h=s[c];this._batchOperatorValue(h,c,i,t,r,n)}const l=this._createNewArray(i,u,o);return l.setDefaultValue(P.create(!1)),l}_batchOperatorValue(e,t,r,n,s,u){const o=this._rowCount,i=this.getUnitId(),l=this.getSheetId(),c=this.getCurrentRow(),h=this.getCurrentColumn();if(n===5){const{rowsInCache:m,rowsNotInCache:d}=ze.canUseCache(i,l,t+h,c,c+o-1);if(m.length>0){if(s===k.EQUALS&&!(e.isString()&&rl(e.getValue()))){const _=ze.getCellPositions(i,l,t+h,e.isNull()?null:e.getValue(),m);_?.forEach(C=>{if(C<c||C>c+o-1)return;const E=C-c;r[E]==null&&(r[E]=[]),r[E][t]=P.create(!0)})}else{const _=ze.getCellValuePositions(i,l,t+h);_?.forEach((C,E)=>{let p=ce.create();zt.has(E)?p=f.create(E):typeof E=="string"?p=w.create(E):typeof E=="number"?p=A.create(E):typeof E=="boolean"&&(p=P.create(E));let y;p.isError()?y=p:e.isError()?y=e:y=p.compare(e,s,u),C.forEach(b=>{b>=c&&b<=c+o-1&&(r[b-c]==null&&(r[b-c]=[]),r[b-c][t]=y)})})}if(d.length>0)for(const _ of d){const[C,E]=_;for(let p=C;p<=E;p++)this.__batchOperatorRowValue(e,t,r,n,p-c,i,l,c,h,s,u);ze.setContinueBuildingCache(i,l,t+h,C,E)}return}}for(let m=0;m<o;m++)this.__batchOperatorRowValue(e,t,r,n,m,i,l,c,h,s,u);ze.setContinueBuildingCache(i,l,t+h,c,c+o-1)}__batchOperatorRowValue(e,t,r,n,s,u,o,i,l,c,h){const m=this.getValueOrDefault(s,t);if(r[s]==null&&(r[s]=[]),m&&e)if(m.isError())r[s][t]=m;else if(e.isError())r[s][t]=e;else switch(n){case 1:r[s][t]=m.plus(e);break;case 0:r[s][t]=m.minus(e);break;case 2:r[s][t]=m.multiply(e);break;case 3:r[s][t]=m.divided(e);break;case 4:r[s][t]=m.mod(e);break;case 5:c?r[s][t]=m.compare(e,c,h):r[s][t]=f.create(g.VALUE);break;case 6:r[s][t]=m.concatenateFront(e);break;case 7:r[s][t]=m.concatenateBack(e);break;case 8:r[s][t]=m.pow(e);break;case 9:r[s][t]=m.round(e);break;case 10:r[s][t]=m.floor(e);break;case 12:r[s][t]=m.atan2(e);break;case 11:r[s][t]=m.ceil(e);break}else r[s][t]=f.create(g.NA);!m||m!=null&&m.isNull()?ze.set(u,o,t+l,ja,s+i):ze.set(u,o,t+l,m.getValue(),s+i)}_batchOperatorArray(e,t,r,n){let s=e.getRowCount(),u=e.getColumnCount();s<this._rowCount&&(s=this._rowCount),u<this._columnCount&&(u=this._columnCount);const o=[],i=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let c=0;c<s;c++){const h=[];for(let m=0;m<u;m++){let d;i===3?d=this.getValueOrDefault(0,0):i===1?d=this.getValueOrDefault(0,m):i===2?d=this.getValueOrDefault(c,0):d=this.getValueOrDefault(c,m);let _;if(l===3?_=e.getValueOrDefault(0,0):l===1?_=e.getValueOrDefault(0,m):l===2?_=e.getValueOrDefault(c,0):_=e.getValueOrDefault(c,m),d&&_)if(d.isError())h[m]=d;else if(_.isError())h[m]=_;else switch(t){case 1:h[m]=d.plus(_);break;case 0:h[m]=d.minus(_);break;case 2:h[m]=d.multiply(_);break;case 3:h[m]=d.divided(_);break;case 4:h[m]=d.mod(_);break;case 5:r?h[m]=d.compare(_,r,n):h[m]=f.create(g.VALUE);break;case 6:h[m]=d.concatenateFront(_);break;case 7:h[m]=d.concatenateBack(_);break;case 8:h[m]=d.pow(_);break;case 9:h[m]=d.round(_);break;case 12:h[m]=d.atan2(_);break;case 10:h[m]=d.floor(_);break;case 11:h[m]=d.ceil(_);break}else h[m]=f.create(g.NA)}o.push(h)}return this._createNewArray(o,s,u)}_checkArrayCalculateType(e){return e.getRowCount()===1&&e.getColumnCount()===1?3:e.getRowCount()===1?1:e.getColumnCount()===1?2:0}_formatValue(e){if(typeof e!="string")return e=e,this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;e=e.slice(1,-1);const t=e.split(";"),r=t.length,n=[];let s=0;for(let u=0;u<r;u++){const o=t[u].split(","),i=o.length;s<i&&(s=i);const l=[];for(let c=0;c<i;c++){const h=o[c].trim();l.push(Vt.create(h))}n.push(l)}return this._rowCount=r,this._columnCount=s,n}_createNewArray(e,t,r,n=-1,s=-1){(this._currentColumn===-1||this._currentRow===-1)&&(n=-1,s=-1);const u={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:s};return W.create(u)}}class Vt{static create(e,t=!1){if(e==null)return ce.create();if(typeof e=="boolean")return P.create(e);if(typeof e=="string"){const r=e.toLocaleUpperCase().trim();if(zt.has(r))return f.create(r);if(r===Wt.TRUE||r===Wt.FALSE)return ea(e);if(Q(e))return A.create(Number(e));if(!t){const{isNumberPattern:s,value:u,pattern:o}=Cg(e);if(s)return A.create(u,o)}const n=e.replace(/\n/g,"").replace(/\r/g,"");return!If(n)&&Dm(n)?W.create(n):Mf(e)}return typeof e=="number"?un(e):f.create(g.VALUE)}}function If(a){const e=a.trim();return e.startsWith('"')&&e.endsWith('"')}const xf=1e4,Tr=new Ft(xf);class Rr extends ks{constructor(e){super(),N(this,"_forcedSheetId",""),N(this,"_forcedSheetName",""),N(this,"_defaultSheetId",""),N(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),N(this,"_unitData",{}),N(this,"_unitStylesData",{}),N(this,"_filteredOutRows",[]),N(this,"_defaultUnitId",""),N(this,"_forcedUnitId",""),N(this,"_runtimeData",{}),N(this,"_arrayFormulaCellData",{}),N(this,"_arrayFormulaRange",{}),N(this,"_runtimeArrayFormulaCellData",{}),N(this,"_runtimeArrayFormulaRange",{}),N(this,"_runtimeFeatureCellData",{}),N(this,"_refOffsetX",0),N(this,"_refOffsetY",0),N(this,"_currentRow"),N(this,"_currentColumn"),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){const{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){const{x:e,y:t}=this.getRefOffset(),r=cu(this.getRangeData(),e,t);return Number.isNaN(r.startRow)&&(r.startRow=0),Number.isNaN(r.startColumn)&&(r.startColumn=0),Number.isNaN(r.endRow)&&(r.endRow=this.getActiveSheetRowCount()-1),Number.isNaN(r.endColumn)&&(r.endColumn=this.getActiveSheetColumnCount()-1),r}isReferenceObject(){return!0}iterator(e){const{startRow:t,endRow:r,startColumn:n,endColumn:s}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(f.create(g.VALUE),t,n);const u=this._forcedUnitId||this._defaultUnitId,o=this._forcedSheetId||this._defaultSheetId;for(let i=t;i<=r;i++)for(let l=n;l<=s;l++){if(i<0||l<0)return e(f.create(g.REF),i,l);const c=this.getCellData(i,l);let h=!1;if(qn(c)){h=e(null,i,l);continue}let m=this.getCellValueObject(c);if(i===t&&l===n){const d=this.getCellPattern(u,o,i,l);if(d&&m.isNumber()){const _=Number(m.getValue());m=A.create(_,d)}}if(h=e(m,i,l),h===!1)return}}getFirstCell(){if(this._checkIfWorksheetMiss())return f.create(g.VALUE);const{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return A.create(0);let n=this.getCellValueObject(r);const s=this._forcedUnitId||this._defaultUnitId,u=this._forcedSheetId||this._defaultSheetId,o=this.getCellPattern(s,u,e,t);if(o&&n.isNumber()){const i=Number(n.getValue());n=A.create(i,o)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=(t=e[this.getUnitId()])==null?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeArrayFormulaRange(){return this._runtimeArrayFormulaRange}setRuntimeArrayFormulaRange(e){this._runtimeArrayFormulaRange=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnCount)||0}getRowCount(){const e=this.getRangeData();return e.endRow-e.startRow+1}getColumnCount(){const e=this.getRangeData();return e.endColumn-e.startColumn+1}getRowData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.rowData)||{}}getColumnData(){var e;return((e=this.getCurrentActiveSheetData())==null?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}isCurrentRowForRange(){return!1}isCurrentColumnForRange(){return!1}isMultiArea(){return!1}unionBy(e){return f.create(g.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){const t=ug(e);if(zt.has(t))return f.create(t);if(e.t===Ut.NUMBER){const r=this._getPatternByCell(e);return Rh(r)?w.create(t.toString()):un(t,r)}return e.t===Ut.STRING||e.t===Ut.FORCE_STRING?w.create(t.toString()):e.t===Ut.BOOLEAN?ea(t):Vt.create(t)}_getPatternByCell(e){var t;const r=this._unitStylesData[this.getUnitId()];if(!r)return"";const n=r.getStyleByCell(e);return((t=n?.n)==null?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return(e=this._unitData[this.getUnitId()])==null?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return(t=(e=this._runtimeData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return(t=(e=this._arrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return(t=(e=this._runtimeArrayFormulaCellData)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaRange(){var e,t;return(t=(e=this._arrayFormulaRange)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaRange(){var e,t;return(t=(e=this._runtimeArrayFormulaRange)==null?void 0:e[this.getUnitId()])==null?void 0:t[this.getSheetId()]}getCellData(e,t){const r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),s=this.getCurrentActiveArrayFormulaCellData(),u=this.getCurrentRuntimeActiveArrayFormulaCellData(),o=new me(this.getCurrentActiveArrayFormulaRange()),i=new me(this.getCurrentRuntimeActiveArrayFormulaRange());let l=n?.getValue(e,t)||u?.getValue(e,t)||this.getRuntimeFeatureCellValue(e,t);if(l)return l;if(l=s?.getValue(e,t),l){let c=!1;return o.forValue((h,m,d)=>{if(e>=d.startRow&&e<=d.endRow&&t>=d.startColumn&&t<=d.endColumn&&i.getValue(h,m))return c=!0,!1}),c?null:l}return r?.cellData.getValue(e,t)}getRuntimeFeatureCellValue(e,t){return tl(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;const s=this.getRangeData();r||(r=s.startRow),n||(n=s.startColumn);const u=this.getCellData(r,n);return u?this.getCellValueObject(u):f.create(g.VALUE)}setCurrentRowAndColumn(e,t){this._currentRow=e,this._currentColumn=t}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getCellPattern(e,t,r,n){var s,u,o,i;const l=this._unitStylesData[e];if(!l)return"";const c=(o=(u=(s=this._unitData[e])==null?void 0:s[t])==null?void 0:u.cellData)==null?void 0:o.getValue(r,n);if(!c)return"";const h=l.getStyleByCell(c);return((i=h?.n)==null?void 0:i.pattern)||""}toArrayValueObject(e=!0){var t;const{startRow:r,endRow:n,startColumn:s,endColumn:u}=this.getRangePosition(),o=`${this.getUnitId()}_${this.getSheetId()}_${r}_${n}_${s}_${u}`,i=Tr.get(o);if(i&&e)return i;const l=n-r+1,c=u-s+1;if(l<0||c<0)return this._getBlankArrayValueObject();const h=new Array(l);this.iterator((_,C,E)=>{const p=C-r,y=E-s;h[p]||(h[p]=new Array(c)),_==null&&(_=ce.create()),h[p][y]=_});const m={calculateValueList:h,rowCount:h.length,columnCount:((t=h[0])==null?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:s},d=W.create(m);return e&&Tr.set(o,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(this._forcedSheetId==null||this._forcedSheetId.length===0)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){const e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return W.create(e)}}class _l extends ks{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}}class Cl extends ks{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;const t=[];for(let n=0;n<this._promiseList.length;n++){const s=this._promiseList[n];t[n]==null&&(t[n]=[]);for(let u=0;u<s.length;u++){const o=s[u];o.isAsyncObject()?t[n][u]=await o.getValue():t[n][u]=o}}const r={calculateValueList:t,rowCount:t.length,columnCount:((e=t[0])==null?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return W.create(r)}}class on extends Rr{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}}class Fu extends Rr{constructor(e){super(e);const t=dr(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return f.create(g.REF);const t=e,r=this.unionRange(this.getRangeData(),t.getRangeData());return this._createRange(r)}unionRange(e,t){const r=e.startRow,n=e.startColumn,s=t.startRow,u=t.startColumn,o={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>s?(o.startRow=s,o.endRow=r):(o.startRow=r,o.endRow=s),n>u?(o.startColumn=u,o.endColumn=n):(o.startColumn=n,o.endColumn=u),e.startAbsoluteRefType&&(o.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(o.endAbsoluteRefType=t.startAbsoluteRefType),o}_createRange(e){const t=new on(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());const{x:r,y:n}=this.getRefOffset();t.setRefOffset(r,n);const s=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),s!=null&&t.setForcedSheetIdDirect(s);const u=this.getForcedUnitId();return u&&t.setForcedUnitIdDirect(u),t}}class ju extends Rr{constructor(e){super(e);const t=dr(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);const r={...t.range,startColumn:t.range.startColumn,startRow:Number.NaN,endColumn:t.range.endColumn,endRow:Number.NaN,rangeType:rt.COLUMN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn())return f.create(g.REF);const t=e;if(t.getForcedSheetName()!==void 0&&t.getForcedSheetName()!=="")return f.create(g.REF);const r=this.getRangeData(),n=t.getRangeData(),s=n.startColumn;if(s>=r.startColumn&&s<=r.endColumn)return this;const u=r.startColumn;return s>u?r.endColumn=s:(r.startColumn=s,r.endColumn=u),n.startAbsoluteRefType&&(r.endAbsoluteRefType=n.startAbsoluteRefType),r.rangeType=rt.COLUMN,this.setToken(`${this.getToken()}${q.COLON}${t.getToken()}`),this}}class Bu extends Rr{constructor(e){super(e);const t=dr(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);const r={...t.range,startColumn:Number.NaN,startRow:t.range.startRow,endColumn:Number.NaN,endRow:t.range.endRow,rangeType:rt.ROW};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow())return f.create(g.REF);const t=e;if(t.getForcedSheetName()!==void 0&&t.getForcedSheetName()!=="")return f.create(g.REF);const r=this.getRangeData(),n=t.getRangeData(),s=n.startRow;if(s>=r.startRow&&s<=r.endRow)return this;const u=r.startRow;return s>u?r.endRow=s:(r.startRow=s,r.endRow=u),n.startAbsoluteRefType&&(r.endAbsoluteRefType=n.startAbsoluteRefType),r.rangeType=rt.ROW,this.setToken(`${this.getToken()}${q.COLON}${t.getToken()}`),this}}function S(a,e,t,r){const n=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,u=[];for(let o=0;o<a;o++){const i=[];for(let l=0;l<e;l++){if(n===1&&s===1){const h=t.isArray()?t.get(0,0):t;i.push(h);continue}if(n===1&&l<s){const h=t.get(0,l);i.push(h);continue}if(s===1&&o<n){const h=t.get(o,0);i.push(h);continue}if(o>=n||l>=s){i.push(r??ce.create());continue}const c=t.get(o,l);i.push(c)}u.push(i)}return ft(u,a,e)}function ft(a,e,t,r="",n=""){const s={calculateValueList:a,rowCount:e,columnCount:t,unitId:r,sheetId:n,row:-1,column:-1};return W.create(s)}function ku(a){const e=[k.EQUALS,k.NOT_EQUAL,k.GREATER_THAN_OR_EQUAL,k.GREATER_THAN,k.LESS_THAN_OR_EQUAL,k.LESS_THAN];for(const t of e)if(a.startsWith(t)){const r=a.substring(t.length);return[t,Vt.create(r)]}return[k.EQUALS,Vt.create(a)]}function ta(a,e,t,r){if(!t)if(e.isString()){const n=`${e.getValue()}`,[s,u]=ku(n);t=s,e=u}else t=k.EQUALS;return a.compare(e,t,r)}function Uf(a,e){const t=Math.max(a.isArray()?a.getRowCount():1,e.isArray()?e.getRowCount():1),r=Math.max(a.isArray()?a.getColumnCount():1,e.isArray()?e.getColumnCount():1),n=S(t,r,a),s=S(t,r,e);return n.mapValue((u,o,i)=>{const l=s.get(o,i);return u!=null&&u.isError()?u:l!=null&&l.isError()?l:u!=null&&u.isBoolean()&&l!=null&&l.isBoolean()?ea(u.getValue()&&l.getValue()):P.create(!1)})}function vf(a){const e=a.getValue();let t=0;return e&&(t=1),A.create(t)}function Xo(a){return a.isArray()&&a.getRowCount()===1&&a.getColumnCount()===1?!0:a.isReferenceObject()?!!(a.isCell()||a.getRowCount()===1&&a.getColumnCount()===1):(a=a,!!(a.isString()||a.isNumber()||a.isBoolean()||a.isError()||a.isNull()))}function wf(a){const e=a?.getPattern();let t={},r={};if(e&&(t={s:{n:{pattern:e}}}),a!=null&&a.getCustomData()&&(r={custom:a.getCustomData()}),a==null)return{v:null,...t};if(a.isError())return{v:a.getErrorType(),t:Ut.STRING,...t,...r};if(a.isValueObject()){const n=a,s=n.getValue();return n.isNumber()?{v:s,t:Ut.NUMBER,...t,...r}:n.isBoolean()?{v:s?1:0,t:Ut.BOOLEAN,...t,...r}:n.isString()?{v:s,t:Ut.STRING,...t,...r}:n.isNull()?{v:null,...t,...r}:{v:s,t:Ut.STRING,...t,...r}}}function Df(a){let e=0,t=0;return a.forEach((r,n)=>{if(n%2===1)if(r.isArray()){const s=r;e=Math.max(e,s.getRowCount()),t=Math.max(t,s.getColumnCount())}else e=Math.max(e,1),t=Math.max(t,1)}),{maxRowLength:e,maxColumnLength:t}}function Rn(a,e){if(a.length===0||a.length%2!==0)return{isError:!0,errorObject:f.create(g.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};let t=null,r=-1,n=-1;if(e){if(!e.isReferenceObject())return{isError:!0,errorObject:f.create(g.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};t=e.toArrayValueObject(),r=t.getRowCount(),n=t.getColumnCount()}let s=0,u=0,o=!1;const i=[];for(let l=0;l<a.length;l++)if(l%2===1){const c=a[l-1],h=a[l];if(!c.isReferenceObject())return{isError:!0,errorObject:f.create(g.VALUE),rangeIsDifferentSize:!1,criteriaMaxRowLength:0,criteriaMaxColumnLength:0,targetRange:null,variants:[]};const m=c.toArrayValueObject(),d=m.getRowCount(),_=m.getColumnCount();l===1&&r===-1&&n===-1?(r=d,n=_):!o&&(r!==d||n!==_)&&(o=!0);let C=h;h.isReferenceObject()&&(C=h.toArrayValueObject()),s=Math.max(s,C.isArray()?C.getRowCount():1),u=Math.max(u,C.isArray()?C.getColumnCount():1),i.push(m),i.push(C)}return{isError:!1,errorObject:null,rangeIsDifferentSize:o,criteriaMaxRowLength:s,criteriaMaxColumnLength:u,targetRange:t,variants:i}}function Ka(a){return a.isArray()?a:W.createByArray([[a.getValue()]])}function Sn(a,e,t,r=!1){const n=[];for(let s=0;s<a.length;s++){if(s%2===1)continue;const u=a[s],o=a[s+1];S(e,t,o,f.create(g.NA)).iterator((i,l,c)=>{if(!i)return;let h=ta(u,i);if(r&&(h=ra(h,u,i)),n[l]===void 0&&(n[l]=[]),n[l][c]===void 0){n[l][c]=h;return}n[l][c]=Uf(n[l][c],h)})}return n}function ra(a,e,t){const[r,n]=ku(`${t.getValue()}`);return a.mapValue((s,u,o)=>{const i=e.get(u,o);if(i&&Lf(i,n))return s;if(i!=null&&i.isError()&&n.isError()&&i.getValue()===n.getValue())return P.create(!0);if(r===k.EQUALS||r===k.NOT_EQUAL){if(i!=null&&i.isNumber()&&n.isString()){const l=n.convertToNumberObjectValue();if(l.isNumber())return i.compare(l,r)}if(n.isNumber()&&i!=null&&i.isString()){const l=i.convertToNumberObjectValue();if(l.isNumber())return l.compare(n,r)}if(r===k.EQUALS)return P.create(!1);if(r===k.NOT_EQUAL)return P.create(!0)}return P.create(!1)})}function Lf(a,e){if(a.isNumber()&&e.isNumber()||a.isBoolean()&&e.isBoolean())return!0;const t=a.isString()&&a.getValue()==="",r=e.isString()&&e.getValue()==="";return!!((t||a.isNull())&&(r||e.isNull())||a.isString()&&!t&&e.isString()&&!r)}var Zr=(a=>(a[a.CELL=0]="CELL",a[a.COLUMN=1]="COLUMN",a[a.ROW=2]="ROW",a))(Zr||{});function Pf(a,e){let t;switch(e){case 1:t=new ju(a);break;case 2:t=new Bu(a);break;default:t=new Fu(a);break}return t}function Ff(a,e){let t;return a.isCell()&&e.isCell()||a.isRow()&&e.isRow()||a.isColumn()&&e.isColumn()?t=a.unionBy(e):t=f.create(g.NAME),t}var jf=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Bf=(a,e)=>(t,r)=>e(t,r,a);let Rs=class extends Me{constructor(a){super(),this._univerInstanceService=a}generateCellValue(a,e){if(e.trim()==="")return{v:""};let t=a;if(a.startsWith("#")&&Cu(a.slice(1))){const{unitId:r,sheetName:n,range:s}=Lr(a.slice(1)),u=this._univerInstanceService.getCurrentUnitOfType(nt.UNIVER_SHEET);if(r===""||r===u.getUnitId())if(n==="")t=`#gid=${u.getActiveSheet().getSheetId()}&range=${Pt(s)}`;else{const o=u.getSheetBySheetName(n);o&&(t=`#gid=${o.getSheetId()}&range=${Pt(s)}`)}}else Xe.isLegalUrl(a)&&(t=Xe.normalizeUrl(a));return{p:Th.create().insertLink(e,t).getData()}}};Rs=jf([Bf(0,pr)],Rs);const $u=Ye("univer.formula.hyperlink-engine-formula.service");var kf=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},qo=(a,e)=>(t,r)=>e(t,r,a),Ze=(a=>(a[a.IDLE=0]="IDLE",a[a.START=1]="START",a[a.START_DEPENDENCY=2]="START_DEPENDENCY",a[a.START_CALCULATION=3]="START_CALCULATION",a[a.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",a[a.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",a[a.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",a[a.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",a[a.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",a))(Ze||{}),Vr=(a=>(a[a.INITIAL=0]="INITIAL",a[a.STOP_EXECUTION=1]="STOP_EXECUTION",a[a.NOT_EXECUTED=2]="NOT_EXECUTED",a[a.SUCCESS=3]="SUCCESS",a))(Vr||{});let Ss=class extends Me{constructor(a,e){super(),N(this,"_formulaExecuteStage",0),N(this,"_stopState",!1),N(this,"_currentRow",-1),N(this,"_currentColumn",-1),N(this,"_currentRowCount",Number.NEGATIVE_INFINITY),N(this,"_currentColumnCount",Number.NEGATIVE_INFINITY),N(this,"_currentSubUnitId",""),N(this,"_currentUnitId",""),N(this,"_runtimeData",{}),N(this,"_runtimeOtherData",{}),N(this,"_unitArrayFormulaRange",{}),N(this,"_unitArrayFormulaEmbeddedMap",{}),N(this,"_runtimeArrayFormulaCellData",{}),N(this,"_runtimeClearArrayFormulaCellData",{}),N(this,"_runtimeFeatureRange",{}),N(this,"_runtimeFeatureCellData",{}),N(this,"_runtimeImageFormulaData",[]),N(this,"_functionsExecutedState",0),N(this,"_functionDefinitionPrivacyVar",new Map),N(this,"_totalFormulasToCalculate",0),N(this,"_completedFormulasCount",0),N(this,"_totalArrayFormulasToCalculate",0),N(this,"_completedArrayFormulasCount",0),N(this,"_formulaCycleIndex",0),N(this,"_isCycleDependency",!1),N(this,"_dependencyTreeModelData",[]),this._currentConfigService=a,this._hyperlinkEngineFormulaService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(a){this._formulaCycleIndex=a}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(a){this._totalArrayFormulasToCalculate=a}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(a){this._completedArrayFormulasCount=a}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(a){this._totalFormulasToCalculate=a}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(a){this._completedFormulasCount=a}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(a){this._formulaExecuteStage=a}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._unitArrayFormulaEmbeddedMap={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._runtimeImageFormulaData=[],this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){gg(),Ag(),Km()}setCurrent(a,e,t,r,n,s){this._currentRow=a,this._currentColumn=e,this._currentRowCount=t,this._currentColumnCount=r,this._currentSubUnitId=n,this._currentUnitId=s}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(a,e){this._functionDefinitionPrivacyVar.set(a,e)}getFunctionDefinitionPrivacyVar(a){return this._functionDefinitionPrivacyVar.get(a)}setRuntimeOtherData(a,e,t,r){const n=this._currentSubUnitId,s=this._currentUnitId;this._runtimeOtherData[s]===void 0&&(this._runtimeOtherData[s]={});const u=this._runtimeOtherData[s];(u[n]===void 0||u[n]===null)&&(u[n]={});const o=u[n];let i=[];if(r.isReferenceObject()||r.isValueObject()&&r.isArray()){const l=r,{startRow:c,startColumn:h}=l.getRangePosition();l.iterator((m,d,_)=>{const C=this._getValueObjectOfRuntimeData(m),E=d-c,p=_-h;i[E]==null&&(i[E]=[]),i[E][p]=C})}else i=[[this._getValueObjectOfRuntimeData(r)]];(o[a]===void 0||o[a]===null)&&(o[a]={}),(o[a][t]===void 0||o[a][t]===null)&&(o[a][t]={}),o[a][t][e]=i}setRuntimeData(a){const e=this._currentRow,t=this._currentColumn,r=this._currentRowCount,n=this.currentColumnCount,s=this._currentSubUnitId,u=this._currentUnitId;this._runtimeData[u]==null&&(this._runtimeData[u]={});const o=this._runtimeData[u];o[s]==null&&(o[s]=new me);const i=o[s];this._unitArrayFormulaRange[u]==null&&(this._unitArrayFormulaRange[u]={});const l=this._unitArrayFormulaRange[u];(l[s]===null||l[s]===void 0)&&(l[s]={});const c=new me(l[s]);this._runtimeArrayFormulaCellData[u]===void 0&&(this._runtimeArrayFormulaCellData[u]={});const h=this._runtimeArrayFormulaCellData[u];h[s]==null&&(h[s]=new me);const m=h[s];this._runtimeClearArrayFormulaCellData[u]===void 0&&(this._runtimeClearArrayFormulaCellData[u]={});const d=this._runtimeClearArrayFormulaCellData[u];d[s]==null&&(d[s]=new me);const _=d[s];if(a.isReferenceObject()||a.isValueObject()&&a.isArray()){const C=a,{startRow:E,startColumn:p,endRow:y,endColumn:b}=C.getRangePosition();if(E===y&&p===b){const M=C.getFirstCell(),V=this._getValueObjectOfRuntimeData(M);i.setValue(e,t,V),_.setValue(e,t,V),ze.set(u,s,t,M.getValue(),e,!0);return}const O={startRow:e,startColumn:t,endRow:y-E+e,endColumn:b-p+t};if(c.setValue(e,t,O),this._checkIfArrayFormulaRangeHasData(u,s,e,t,O)||this._checkIfArrayFormulaExceeded(r,n,O)){const M=this._getValueObjectOfRuntimeData(f.create(g.SPILL));i.setValue(e,t,M),_.setValue(e,t,M),ze.set(u,s,t,g.SPILL,e,!0);const V=this._currentConfigService.getUnitData();C.iterator((T,x,v)=>{var L,D;const Y=x-E+e,ee=v-p+t,ue=(D=(L=V[u])==null?void 0:L[s])==null?void 0:D.cellData.getValue(Y,ee);if(x===E&&v===p)m.setValue(e,t,M);else if(ue!=null)ue.v==null&&(ue.v=""),m.setValue(Y,ee,ue);else{if(this._isInOtherArrayFormulaRange(u,s,e,t,Y,ee))return!0;m.setValue(Y,ee,{v:""})}})}else{const M=f.create(g.SPILL);C.iterator((V,T,x)=>{ze.set(u,s,t-p+x,V?V.getValue():0,e-E+T,!0);const v=this._getValueObjectOfRuntimeData(V);if(T===E&&x===p){if(V!=null&&V.isError()&&V.isEqualType(M))return _.setValue(e,t,{}),i.setValue(e,t,{...this._getValueObjectOfRuntimeData(M)}),!1;i.setValue(e,t,{...v})}const L=T-E+e,D=x-p+t;m.setValue(L,D,v)})}}else{const C=this._getValueObjectOfRuntimeData(a);if(i.setValue(e,t,C),a.isString()&&a.isImage()){const E=a.getImageInfo();E&&this._runtimeImageFormulaData.push({...E,unitId:u,sheetId:s,row:e,column:t})}ze.set(u,s,t,a.getValue(),e,!0),_.setValue(e,t,C)}}_getValueObjectOfRuntimeData(a){return a!=null&&a.isString()&&a.isHyperlink()?this._hyperlinkEngineFormulaService.generateCellValue(a.getHyperlinkUrl(),a.getValue()):wf(a)}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getUnitArrayFormulaEmbeddedMap(){return this._unitArrayFormulaEmbeddedMap}setUnitArrayFormulaEmbeddedMap(){const a=this._currentUnitId,e=this._currentSubUnitId,t=this._currentRow,r=this._currentColumn,n=this._unitArrayFormulaEmbeddedMap;n[a]==null&&(n[a]={}),n[a][e]==null&&(n[a][e]={}),n[a][e][t]==null&&(n[a][e][t]={}),n[a][e][t][r]=!0}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(a,e){this._runtimeFeatureRange[a]=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(a,e){this._runtimeFeatureCellData[a]=e}setDependencyTreeModelData(a){this._dependencyTreeModelData=a}getDependencyTreeModelData(){return this._dependencyTreeModelData}getRuntimeImageFormulaData(){return this._runtimeImageFormulaData}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),arrayFormulaEmbedded:this.getUnitArrayFormulaEmbeddedMap(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),imageFormulaData:this.getRuntimeImageFormulaData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData(),dependencyTreeModelData:this.getDependencyTreeModelData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}clearArrayObjectCache(){Tr.clear()}_checkIfArrayFormulaRangeHasData(a,e,t,r,n){var s,u,o,i,l,c,h,m,d,_,C;const{startRow:E,startColumn:p,endRow:y,endColumn:b}=n,O=this._currentConfigService.getUnitData(),M=this._currentConfigService.getArrayFormulaCellData();(o=(u=(s=this._unitArrayFormulaRange[a])==null?void 0:s[e])==null?void 0:u[t])==null||o[r];for(let V=E;V<=y;V++)for(let T=p;T<=b;T++){if(V===t&&r===T)continue;const x=(c=(l=(i=this._runtimeData)==null?void 0:i[a])==null?void 0:l[e])==null?void 0:c.getValue(V,T);(m=(h=M?.[a])==null?void 0:h[e])==null||m.getValue(V,T);const v=(C=(_=(d=O?.[a])==null?void 0:d[e])==null?void 0:_.cellData)==null?void 0:C.getValue(V,T),L=this._getRuntimeFeatureCellValue(V,T,e,a);if(!qn(x)||this._isInOtherArrayFormulaRange(a,e,t,r,V,T)||!qn(v)||!qn(L))return!0}return!1}_getRuntimeFeatureCellValue(a,e,t,r){return tl(a,e,t,r,this._runtimeFeatureCellData)}_arrayCellHasData(a){return a==null?!1:a.v!==void 0}_isInOtherArrayFormulaRange(a,e,t,r,n,s){var u;const o=(u=this._currentConfigService.getArrayFormulaRange()[a])==null?void 0:u[e];if(o==null)return!1;let i=!1;return new me(o).forValue((l,c,h)=>{var m,d;if(l===t&&c===r)return;const _=this._isInArrayFormulaRange(h,n,s),C=(d=(m=this._runtimeData[a])==null?void 0:m[e])==null?void 0:d.getValue(l,c);_&&C?.v!==g.SPILL&&(i=!0)}),i}_isInArrayFormulaRange(a,e,t){if(a==null)return!1;const{startRow:r,startColumn:n,endRow:s,endColumn:u}=a;return e>=r&&e<=s&&t>=n&&t<=u}_checkIfArrayFormulaExceeded(a,e,t){return t.endRow>=a||t.endColumn>=e}_isInDirtyRange(a,e,t,r){const n=this._currentConfigService.getDirtyRanges();return n.length===0?!0:Vi(n,a,e,t,r)}};Ss=kf([qo(0,Bt),qo(1,$u)],Ss);const Ct=Ye("univer.formula.runtime.service");var oe=(a=>(a[a.REFERENCE=1]="REFERENCE",a[a.VALUE=2]="VALUE",a[a.OPERATOR=3]="OPERATOR",a[a.FUNCTION=4]="FUNCTION",a[a.LAMBDA=5]="LAMBDA",a[a.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",a[a.ERROR=7]="ERROR",a[a.BASE=8]="BASE",a[a.ROOT=9]="ROOT",a[a.UNION=10]="UNION",a[a.PREFIX=11]="PREFIX",a[a.SUFFIX=12]="SUFFIX",a[a.NULL=13]="NULL",a))(oe||{});const Tt=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class Ke{constructor(e){N(this,"_children",[]),N(this,"_definedNames"),N(this,"_parent"),N(this,"_valueObject"),N(this,"_calculateState",!1),N(this,"_async",!1),N(this,"_address",!1),N(this,"_isForcedCalculateFunction",!1),this._token=e}dispose(){var e;this._children.forEach(t=>{t.dispose()}),(e=this._valueObject)==null||e.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return oe.BASE}resetCalculationState(){this._children.forEach(e=>{e.resetCalculationState()}),this._valueObject=null,this._calculateState=!1}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}async executeAsync(){return Promise.resolve(Gt.SUCCESS)}serialize(){const e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let u=0;u<n;u++){const o=t[u];r.push(o.serialize())}const s={token:e,nodeType:this.nodeType};return n>0&&(s.children=r),s}hasDefinedName(e){var t;return((t=this._definedNames)==null?void 0:t.includes(e))||!1}setDefinedNames(e){this._definedNames=e}getDefinedNames(){return this._definedNames}}class De extends Ke{constructor(e){super(e),N(this,"_errorValueObject"),this._errorValueObject=f.create(e)}get nodeType(){return oe.ERROR}static create(e){return new De(e)}getValue(){return this._errorValueObject}}const It=100;class xt{get zIndex(){return 0}dispose(){}create(e,t,r){let n;return e instanceof ae?n=e.getToken():n=e,new Ke(n)}}class Za extends Ke{get nodeType(){return oe.ROOT}execute(){const e=this.getChildren();if(e.length>1){this.setValue(f.create(g.VALUE));return}const t=e[0];t==null?this.setValue(f.create(g.VALUE)):this.setValue(t.getValue())}}class Yu extends xt{get zIndex(){return Tt.get(oe.ROOT)||It}checkAndCreateNodeType(e){if(e instanceof ae&&e.getToken()===Lt)return new Za(Lt)}}var _e=(a=>(a.DATE="DATE",a.DATEDIF="DATEDIF",a.DATEVALUE="DATEVALUE",a.DAY="DAY",a.DAYS="DAYS",a.DAYS360="DAYS360",a.EDATE="EDATE",a.EOMONTH="EOMONTH",a.EPOCHTODATE="EPOCHTODATE",a.HOUR="HOUR",a.ISOWEEKNUM="ISOWEEKNUM",a.MINUTE="MINUTE",a.MONTH="MONTH",a.NETWORKDAYS="NETWORKDAYS",a.NETWORKDAYS_INTL="NETWORKDAYS.INTL",a.NOW="NOW",a.SECOND="SECOND",a.TIME="TIME",a.TIMEVALUE="TIMEVALUE",a.TO_DATE="TO_DATE",a.TODAY="TODAY",a.WEEKDAY="WEEKDAY",a.WEEKNUM="WEEKNUM",a.WORKDAY="WORKDAY",a.WORKDAY_INTL="WORKDAY.INTL",a.YEAR="YEAR",a.YEARFRAC="YEARFRAC",a))(_e||{}),X=(a=>(a.BESSELI="BESSELI",a.BESSELJ="BESSELJ",a.BESSELK="BESSELK",a.BESSELY="BESSELY",a.BIN2DEC="BIN2DEC",a.BIN2HEX="BIN2HEX",a.BIN2OCT="BIN2OCT",a.BITAND="BITAND",a.BITLSHIFT="BITLSHIFT",a.BITOR="BITOR",a.BITRSHIFT="BITRSHIFT",a.BITXOR="BITXOR",a.COMPLEX="COMPLEX",a.CONVERT="CONVERT",a.DEC2BIN="DEC2BIN",a.DEC2HEX="DEC2HEX",a.DEC2OCT="DEC2OCT",a.DELTA="DELTA",a.ERF="ERF",a.ERF_PRECISE="ERF.PRECISE",a.ERFC="ERFC",a.ERFC_PRECISE="ERFC.PRECISE",a.GESTEP="GESTEP",a.HEX2BIN="HEX2BIN",a.HEX2DEC="HEX2DEC",a.HEX2OCT="HEX2OCT",a.IMABS="IMABS",a.IMAGINARY="IMAGINARY",a.IMARGUMENT="IMARGUMENT",a.IMCONJUGATE="IMCONJUGATE",a.IMCOS="IMCOS",a.IMCOSH="IMCOSH",a.IMCOT="IMCOT",a.IMCOTH="IMCOTH",a.IMCSC="IMCSC",a.IMCSCH="IMCSCH",a.IMDIV="IMDIV",a.IMEXP="IMEXP",a.IMLN="IMLN",a.IMLOG="IMLOG",a.IMLOG10="IMLOG10",a.IMLOG2="IMLOG2",a.IMPOWER="IMPOWER",a.IMPRODUCT="IMPRODUCT",a.IMREAL="IMREAL",a.IMSEC="IMSEC",a.IMSECH="IMSECH",a.IMSIN="IMSIN",a.IMSINH="IMSINH",a.IMSQRT="IMSQRT",a.IMSUB="IMSUB",a.IMSUM="IMSUM",a.IMTAN="IMTAN",a.IMTANH="IMTANH",a.OCT2BIN="OCT2BIN",a.OCT2DEC="OCT2DEC",a.OCT2HEX="OCT2HEX",a))(X||{}),J=(a=>(a.ACCRINT="ACCRINT",a.ACCRINTM="ACCRINTM",a.AMORDEGRC="AMORDEGRC",a.AMORLINC="AMORLINC",a.COUPDAYBS="COUPDAYBS",a.COUPDAYS="COUPDAYS",a.COUPDAYSNC="COUPDAYSNC",a.COUPNCD="COUPNCD",a.COUPNUM="COUPNUM",a.COUPPCD="COUPPCD",a.CUMIPMT="CUMIPMT",a.CUMPRINC="CUMPRINC",a.DB="DB",a.DDB="DDB",a.DISC="DISC",a.DOLLARDE="DOLLARDE",a.DOLLARFR="DOLLARFR",a.DURATION="DURATION",a.EFFECT="EFFECT",a.FV="FV",a.FVSCHEDULE="FVSCHEDULE",a.INTRATE="INTRATE",a.IPMT="IPMT",a.IRR="IRR",a.ISPMT="ISPMT",a.MDURATION="MDURATION",a.MIRR="MIRR",a.NOMINAL="NOMINAL",a.NPER="NPER",a.NPV="NPV",a.ODDFPRICE="ODDFPRICE",a.ODDFYIELD="ODDFYIELD",a.ODDLPRICE="ODDLPRICE",a.ODDLYIELD="ODDLYIELD",a.PDURATION="PDURATION",a.PMT="PMT",a.PPMT="PPMT",a.PRICE="PRICE",a.PRICEDISC="PRICEDISC",a.PRICEMAT="PRICEMAT",a.PV="PV",a.RATE="RATE",a.RECEIVED="RECEIVED",a.RRI="RRI",a.SLN="SLN",a.SYD="SYD",a.TBILLEQ="TBILLEQ",a.TBILLPRICE="TBILLPRICE",a.TBILLYIELD="TBILLYIELD",a.VDB="VDB",a.XIRR="XIRR",a.XNPV="XNPV",a.YIELD="YIELD",a.YIELDDISC="YIELDDISC",a.YIELDMAT="YIELDMAT",a))(J||{}),ye=(a=>(a.CELL="CELL",a.ERROR_TYPE="ERROR.TYPE",a.INFO="INFO",a.ISBETWEEN="ISBETWEEN",a.ISBLANK="ISBLANK",a.ISDATE="ISDATE",a.ISEMAIL="ISEMAIL",a.ISERR="ISERR",a.ISERROR="ISERROR",a.ISEVEN="ISEVEN",a.ISFORMULA="ISFORMULA",a.ISLOGICAL="ISLOGICAL",a.ISNA="ISNA",a.ISNONTEXT="ISNONTEXT",a.ISNUMBER="ISNUMBER",a.ISODD="ISODD",a.ISOMITTED="ISOMITTED",a.ISREF="ISREF",a.ISTEXT="ISTEXT",a.ISURL="ISURL",a.N="N",a.NA="NA",a.SHEET="SHEET",a.SHEETS="SHEETS",a.TYPE="TYPE",a))(ye||{}),Ce=(a=>(a.AND="AND",a.BYCOL="BYCOL",a.BYROW="BYROW",a.FALSE="FALSE",a.IF="IF",a.IFERROR="IFERROR",a.IFNA="IFNA",a.IFS="IFS",a.LAMBDA="LAMBDA",a.LET="LET",a.MAKEARRAY="MAKEARRAY",a.MAP="MAP",a.NOT="NOT",a.OR="OR",a.REDUCE="REDUCE",a.SCAN="SCAN",a.SWITCH="SWITCH",a.TRUE="TRUE",a.XOR="XOR",a))(Ce||{}),te=(a=>(a.ADDRESS="ADDRESS",a.AREAS="AREAS",a.CHOOSE="CHOOSE",a.CHOOSECOLS="CHOOSECOLS",a.CHOOSEROWS="CHOOSEROWS",a.COLUMN="COLUMN",a.COLUMNS="COLUMNS",a.DROP="DROP",a.EXPAND="EXPAND",a.FILTER="FILTER",a.FORMULATEXT="FORMULATEXT",a.GETPIVOTDATA="GETPIVOTDATA",a.HLOOKUP="HLOOKUP",a.HSTACK="HSTACK",a.HYPERLINK="HYPERLINK",a.IMAGE="IMAGE",a.INDEX="INDEX",a.INDIRECT="INDIRECT",a.LOOKUP="LOOKUP",a.MATCH="MATCH",a.OFFSET="OFFSET",a.ROW="ROW",a.ROWS="ROWS",a.RTD="RTD",a.SORT="SORT",a.SORTBY="SORTBY",a.TAKE="TAKE",a.TOCOL="TOCOL",a.TOROW="TOROW",a.TRANSPOSE="TRANSPOSE",a.UNIQUE="UNIQUE",a.VLOOKUP="VLOOKUP",a.VSTACK="VSTACK",a.WRAPCOLS="WRAPCOLS",a.WRAPROWS="WRAPROWS",a.XLOOKUP="XLOOKUP",a.XMATCH="XMATCH",a))(te||{}),j=(a=>(a.ABS="ABS",a.ACOS="ACOS",a.ACOSH="ACOSH",a.ACOT="ACOT",a.ACOTH="ACOTH",a.AGGREGATE="AGGREGATE",a.ARABIC="ARABIC",a.ASIN="ASIN",a.ASINH="ASINH",a.ATAN="ATAN",a.ATAN2="ATAN2",a.ATANH="ATANH",a.BASE="BASE",a.CEILING="CEILING",a.CEILING_MATH="CEILING.MATH",a.CEILING_PRECISE="CEILING.PRECISE",a.COMBIN="COMBIN",a.COMBINA="COMBINA",a.COS="COS",a.COSH="COSH",a.COT="COT",a.COTH="COTH",a.CSC="CSC",a.CSCH="CSCH",a.DECIMAL="DECIMAL",a.DEGREES="DEGREES",a.EVEN="EVEN",a.EXP="EXP",a.FACT="FACT",a.FACTDOUBLE="FACTDOUBLE",a.FLOOR="FLOOR",a.FLOOR_MATH="FLOOR.MATH",a.FLOOR_PRECISE="FLOOR.PRECISE",a.GCD="GCD",a.INT="INT",a.ISO_CEILING="ISO.CEILING",a.LCM="LCM",a.LET="LET",a.LN="LN",a.LOG="LOG",a.LOG10="LOG10",a.MDETERM="MDETERM",a.MINVERSE="MINVERSE",a.MMULT="MMULT",a.MOD="MOD",a.MROUND="MROUND",a.MULTINOMIAL="MULTINOMIAL",a.MUNIT="MUNIT",a.ODD="ODD",a.PI="PI",a.POWER="POWER",a.PRODUCT="PRODUCT",a.QUOTIENT="QUOTIENT",a.RADIANS="RADIANS",a.RAND="RAND",a.RANDARRAY="RANDARRAY",a.RANDBETWEEN="RANDBETWEEN",a.ROMAN="ROMAN",a.ROUND="ROUND",a.ROUNDBANK="ROUNDBANK",a.ROUNDDOWN="ROUNDDOWN",a.ROUNDUP="ROUNDUP",a.SEC="SEC",a.SECH="SECH",a.SERIESSUM="SERIESSUM",a.SEQUENCE="SEQUENCE",a.SIGN="SIGN",a.SIN="SIN",a.SINH="SINH",a.SQRT="SQRT",a.SQRTPI="SQRTPI",a.SUBTOTAL="SUBTOTAL",a.SUM="SUM",a.SUMIF="SUMIF",a.SUMIFS="SUMIFS",a.SUMPRODUCT="SUMPRODUCT",a.SUMSQ="SUMSQ",a.SUMX2MY2="SUMX2MY2",a.SUMX2PY2="SUMX2PY2",a.SUMXMY2="SUMXMY2",a.TAN="TAN",a.TANH="TANH",a.TRUNC="TRUNC",a))(j||{}),I=(a=>(a.AVEDEV="AVEDEV",a.AVERAGE="AVERAGE",a.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",a.AVERAGEA="AVERAGEA",a.AVERAGEIF="AVERAGEIF",a.AVERAGEIFS="AVERAGEIFS",a.BETA_DIST="BETA.DIST",a.BETA_INV="BETA.INV",a.BINOM_DIST="BINOM.DIST",a.BINOM_DIST_RANGE="BINOM.DIST.RANGE",a.BINOM_INV="BINOM.INV",a.CHISQ_DIST="CHISQ.DIST",a.CHISQ_DIST_RT="CHISQ.DIST.RT",a.CHISQ_INV="CHISQ.INV",a.CHISQ_INV_RT="CHISQ.INV.RT",a.CHISQ_TEST="CHISQ.TEST",a.CONFIDENCE_NORM="CONFIDENCE.NORM",a.CONFIDENCE_T="CONFIDENCE.T",a.CORREL="CORREL",a.COUNT="COUNT",a.COUNTA="COUNTA",a.COUNTBLANK="COUNTBLANK",a.COUNTIF="COUNTIF",a.COUNTIFS="COUNTIFS",a.COVARIANCE_P="COVARIANCE.P",a.COVARIANCE_S="COVARIANCE.S",a.DEVSQ="DEVSQ",a.EXPON_DIST="EXPON.DIST",a.F_DIST="F.DIST",a.F_DIST_RT="F.DIST.RT",a.F_INV="F.INV",a.F_INV_RT="F.INV.RT",a.F_TEST="F.TEST",a.FISHER="FISHER",a.FISHERINV="FISHERINV",a.FORECAST="FORECAST",a.FORECAST_ETS="FORECAST.ETS",a.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",a.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",a.FORECAST_ETS_STAT="FORECAST.ETS.STAT",a.FORECAST_LINEAR="FORECAST.LINEAR",a.FREQUENCY="FREQUENCY",a.GAMMA="GAMMA",a.GAMMA_DIST="GAMMA.DIST",a.GAMMA_INV="GAMMA.INV",a.GAMMALN="GAMMALN",a.GAMMALN_PRECISE="GAMMALN.PRECISE",a.GAUSS="GAUSS",a.GEOMEAN="GEOMEAN",a.GROWTH="GROWTH",a.HARMEAN="HARMEAN",a.HYPGEOM_DIST="HYPGEOM.DIST",a.INTERCEPT="INTERCEPT",a.KURT="KURT",a.LARGE="LARGE",a.LINEST="LINEST",a.LOGEST="LOGEST",a.LOGNORM_DIST="LOGNORM.DIST",a.LOGNORM_INV="LOGNORM.INV",a.MARGINOFERROR="MARGINOFERROR",a.MAX="MAX",a.MAXA="MAXA",a.MAXIFS="MAXIFS",a.MEDIAN="MEDIAN",a.MIN="MIN",a.MINA="MINA",a.MINIFS="MINIFS",a.MODE_MULT="MODE.MULT",a.MODE_SNGL="MODE.SNGL",a.NEGBINOM_DIST="NEGBINOM.DIST",a.NORM_DIST="NORM.DIST",a.NORM_INV="NORM.INV",a.NORM_S_DIST="NORM.S.DIST",a.NORM_S_INV="NORM.S.INV",a.PEARSON="PEARSON",a.PERCENTILE_EXC="PERCENTILE.EXC",a.PERCENTILE_INC="PERCENTILE.INC",a.PERCENTRANK_EXC="PERCENTRANK.EXC",a.PERCENTRANK_INC="PERCENTRANK.INC",a.PERMUT="PERMUT",a.PERMUTATIONA="PERMUTATIONA",a.PHI="PHI",a.POISSON_DIST="POISSON.DIST",a.PROB="PROB",a.QUARTILE_EXC="QUARTILE.EXC",a.QUARTILE_INC="QUARTILE.INC",a.RANK_AVG="RANK.AVG",a.RANK_EQ="RANK.EQ",a.RSQ="RSQ",a.SKEW="SKEW",a.SKEW_P="SKEW.P",a.SLOPE="SLOPE",a.SMALL="SMALL",a.STANDARDIZE="STANDARDIZE",a.STDEV_P="STDEV.P",a.STDEV_S="STDEV.S",a.STDEVA="STDEVA",a.STDEVPA="STDEVPA",a.STEYX="STEYX",a.T_DIST="T.DIST",a.T_DIST_2T="T.DIST.2T",a.T_DIST_RT="T.DIST.RT",a.T_INV="T.INV",a.T_INV_2T="T.INV.2T",a.T_TEST="T.TEST",a.TREND="TREND",a.TRIMMEAN="TRIMMEAN",a.VAR_P="VAR.P",a.VAR_S="VAR.S",a.VARA="VARA",a.VARPA="VARPA",a.WEIBULL_DIST="WEIBULL.DIST",a.Z_TEST="Z.TEST",a))(I||{}),z=(a=>(a.ASC="ASC",a.ARRAYTOTEXT="ARRAYTOTEXT",a.BAHTTEXT="BAHTTEXT",a.CHAR="CHAR",a.CLEAN="CLEAN",a.CODE="CODE",a.CONCAT="CONCAT",a.CONCATENATE="CONCATENATE",a.DBCS="DBCS",a.DOLLAR="DOLLAR",a.EXACT="EXACT",a.FIND="FIND",a.FINDB="FINDB",a.FIXED="FIXED",a.LEFT="LEFT",a.LEFTB="LEFTB",a.LEN="LEN",a.LENB="LENB",a.LOWER="LOWER",a.MID="MID",a.MIDB="MIDB",a.NUMBERSTRING="NUMBERSTRING",a.NUMBERVALUE="NUMBERVALUE",a.PHONETIC="PHONETIC",a.PROPER="PROPER",a.REGEXEXTRACT="REGEXEXTRACT",a.REGEXMATCH="REGEXMATCH",a.REGEXREPLACE="REGEXREPLACE",a.REPLACE="REPLACE",a.REPLACEB="REPLACEB",a.REPT="REPT",a.RIGHT="RIGHT",a.RIGHTB="RIGHTB",a.SEARCH="SEARCH",a.SEARCHB="SEARCHB",a.SUBSTITUTE="SUBSTITUTE",a.T="T",a.TEXT="TEXT",a.TEXTAFTER="TEXTAFTER",a.TEXTBEFORE="TEXTBEFORE",a.TEXTJOIN="TEXTJOIN",a.TEXTSPLIT="TEXTSPLIT",a.TRIM="TRIM",a.UNICHAR="UNICHAR",a.UNICODE="UNICODE",a.UPPER="UPPER",a.VALUE="VALUE",a.VALUETOTEXT="VALUETOTEXT",a.CALL="CALL",a.EUROCONVERT="EUROCONVERT",a.REGISTER_ID="REGISTER.ID",a))(z||{}),On=(a=>(a.ENCODEURL="ENCODEURL",a.FILTERXML="FILTERXML",a.WEBSERVICE="WEBSERVICE",a))(On||{});const $f=[_e,X,J,ye,Ce,te,j,I,z,On],Yf=new Set($f.flatMap(a=>Object.values(a)).filter(a=>/^[A-Z]{1,3}$/.test(a)).filter(a=>{const e=Ei(a);return e>0&&e<=Ur})),Hf=5e3,or=new Ft(Hf);function za(a,e,t,r,n){let s=or.get(`${a}${e}`);if(s&&!El(s,n))return s;const u=t.treeBuilder(e);return zt.has(u)?De.create(u):(s=r.parse(u),s==null?(console.error("generateAstNode astNode is null"),De.create(u)):(or.set(`${a}${e}`,s),s))}function El(a,e){const t=e.getDirtyDefinedNameMap(),r=e.getExecuteUnitId();if(r!=null&&t[r]!=null){const n=Object.keys(t[r]);for(let s=0,u=n.length;s<u;s++){const o=n[s];if(a.hasDefinedName(o))return!0}}return!1}function Gf(a,e,t){return!!(e!=null&&El(e,t))}const kt=Ye("univer.formula-function.service");class Al extends Me{constructor(){super(...arguments),N(this,"_functionExecutors",new Map),N(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.set(r.functionName,r)}return di(()=>{for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){const r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){or.forEach((t,r)=>{e.forEach(n=>{r.includes(n)&&or.delete(r)})})}}var ke=(a=>(a.COMPARE="COMPARE",a.DIVIDED="DIVIDED",a.MINUS="MINUS",a.MULTIPLY="MULTIPLY",a.PLUS="PLUS",a.UNION="UNION",a.CUBE="CUBE",a))(ke||{}),Xf=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Wo=(a,e)=>(t,r)=>e(t,r,a);class Os extends Ke{constructor(e,t,r){super(t),this._runtimeService=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return oe.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(e==null){console.error("PrefixNode execute value is null"),this.setValue(f.create(g.VALUE));return}this._operatorString===Ie.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(A.create(0),e)):this._operatorString===Ie.AT?t=this._handlerAT(e):t=f.create(g.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject())return f.create(g.VALUE);const t=e;if(t.isCell())return f.create(g.VALUE);const r=this._runtimeService,n=r.currentRow||0,s=r.currentColumn||0,u=t.getRangePosition(),{startRow:o,startColumn:i,endRow:l,endColumn:c}=u;return c!==i&&l!==o||o===l&&i===c?f.create(g.VALUE):l===o&&s>=i&&s<=c?t.getCellByColumn(s):i===c&&n>=o&&n<=l?t.getCellByRow(n):t.isTable()?t.getCellByPosition(n):f.create(g.VALUE)}}let ln=class extends xt{constructor(a,e){super(),this._functionService=a,this._runtimeService=e}get zIndex(){return Tt.get(oe.PREFIX)||It}checkAndCreateNodeType(a){if(!(a instanceof ae))return;const e=a.getToken(),t=e.trim();if(t.charAt(0)==='"'&&t.charAt(t.length-1)==='"')return;let r="";if(t===Ie.MINUS)r=ke.MINUS;else return t===Ie.AT?new Os(this._runtimeService,t):void 0;const n=this._functionService.getExecutor(r);return n?new Os(this._runtimeService,t,n):(console.error(`No function ${e}`),De.create(g.NAME))}};ln=Xf([Wo(0,kt),Wo(1,Ct)],ln);function pl(a,e,t){let r,n,s=a;const u=s[0];let o=0;if(u===Ie.MINUS){const i=e.getExecutor(ke.MINUS);r=new Os(t,Ie.MINUS,i),o++}else u===Ie.AT&&(n=new Os(t,Ie.AT),r&&n.setParent(r),o++);return o>0&&(s=s.slice(o)),{tokenTrim:s,minusPrefixNode:r,atPrefixNode:n}}var qf=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Or=(a,e)=>(t,r)=>e(t,r,a);class Wf extends Ke{constructor(e,t,r,n,s,u){super(e),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=n,this._definedNamesService=s,this._formulaDataModel=u,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return oe.FUNCTION}async executeAsync(){const e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let u=0;u<r;u++){const o=t[u].getValue();o!=null&&(o.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(o.toArrayValueObject()):e.push(o))}const n=await this._calculateAsync(e);let s;return n.isAsyncObject()||n.isAsyncArrayObject()?s=await n.getValue():s=n,this._setEmbeddedArrayFormulaToResult(s),this._setRefData(s),this.setValue(s),Promise.resolve(Gt.SUCCESS)}execute(){const e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let s=0;s<r;s++){const u=t[s].getValue();u!=null&&(u.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(u),u.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(u.toArrayValueObject()):e.push(u))}const n=this._calculate(e);this._setEmbeddedArrayFormulaToResult(n),this._setRefData(n),this.setValue(n)}isFunctionExecutorArgumentsIgnoreNumberPattern(){return this._functionExecutor.isArgumentsIgnoreNumberPattern()}_setEmbeddedArrayFormulaToResult(e){if(!e.isArray())return;const t=e.getRowCount(),r=e.getColumnCount();t<=1&&r<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){const e=this.getChildren(),t=e.length;if(!this._functionExecutor.needsExpandParams||t!==3)return;const r=e[1].getValue(),n=e[2].getValue();if(!(r!=null&&r.isReferenceObject())&&!(n!=null&&n.isReferenceObject()))return;let s,u;if(r!=null&&r.isReferenceObject()){const _=r.getRangeData(),{startRow:C,startColumn:E,endRow:p,endColumn:y}=_;s=p-C+1,u=y-E+1}else s=r!=null&&r.isArray()?r.getRowCount():1,u=r!=null&&r.isArray()?r.getColumnCount():1;const o=n.getRangeData(),{startRow:i,startColumn:l,endRow:c,endColumn:h}=o,m=c-i+1,d=h-l+1;s!==m&&(o.endRow+=s-m),u!==d&&(o.endColumn+=u-d)}_handleCustomResult(e){var t;if(typeof e!="object"||e==null)return Vt.create(e);const r=Nl(e);return W.create({calculateValueList:r,rowCount:r.length,columnCount:((t=r[0])==null?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(e){return e.map(t=>t.isArray()?t.toValue():t.isLambda()?t:t.getValue())}_calculate(e){const{minParams:t,maxParams:r}=this._functionExecutor;if(t!==-1&&r!==-1&&(e.length<t||e.length>r))return f.create(g.NA);let n;if(this._setRefInfo(),this._functionExecutor.isCustom()){const s=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));n=this._handleCustomResult(s)}else this._handleAddressFunction(),n=this._functionExecutor.calculate(...e);return n}async _calculateAsync(e){const{minParams:t,maxParams:r}=this._functionExecutor;if(t!==-1&&r!==-1&&(e.length<t||e.length>r))return f.create(g.NA);let n;if(this._setRefInfo(),this._functionExecutor.isCustom()){const s=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));n=this._handleCustomResult(s)}else this._handleAddressFunction(),n=this._functionExecutor.calculate(...e);return n}_setDefinedNamesForFunction(){const e=this._currentConfigService.getExecuteUnitId();if(e==null)return;const t=this._definedNamesService.getDefinedNameMap(e);t!=null&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){const{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:n}=this._runtimeService;if(this._functionExecutor.setRefInfo(e,t,r,n),this._functionExecutor.needsSheetRowColumnCount){const{rowCount:s,columnCount:u}=this._currentConfigService.getSheetRowColumnCount(e,t);this._functionExecutor.setSheetRowColumnCount(s,u)}}_setRefData(e){if(!e.isReferenceObject())return;const t=e;t.setForcedSheetId(this._currentConfigService.getSheetNameMap()),t.setUnitData(this._currentConfigService.getUnitData()),t.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),t.setArrayFormulaRange(this._currentConfigService.getArrayFormulaRange()),t.setRuntimeData(this._runtimeService.getUnitData()),t.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),t.setRuntimeArrayFormulaRange(this._runtimeService.getUnitArrayFormula()),t.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData())}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(e){const{startRow:t,endRow:r}=e.getRangePosition(),n=this._currentConfigService.getFilteredOutRows(e.getUnitId(),e.getSheetId(),t,r);e.setFilteredOutRows(n)}}class Qf extends Ke{constructor(e="Error"){super(e)}get nodeType(){return oe.FUNCTION}async executeAsync(){return this.setValue(f.create(g.NAME)),Promise.resolve(Gt.SUCCESS)}execute(){this.setValue(f.create(g.NAME))}}let cn=class extends xt{constructor(a,e,t,r,n,s){super(),this._functionService=a,this._currentConfigService=e,this._runtimeService=t,this._definedNamesService=r,this._injector=n,this._formulaDataModel=s}get zIndex(){return Tt.get(oe.FUNCTION)||It}create(a){const e=this._functionService.getExecutor(a);return e?new Wf(a,e,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${a}`),De.create(g.NAME))}checkAndCreateNodeType(a){if(typeof a=="string")return;const e=a.getToken(),{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=pl(e.trim(),this._functionService,this._runtimeService),s=this._isParentUnionNode(a);if(!Number.isNaN(Number(t))&&!s)return De.create(g.VALUE);const u=t.toUpperCase();if(!(s&&Yf.has(u))&&this._functionService.hasExecutor(u)){const o=this.create(u);return n?o.setParent(n):r&&o.setParent(r),o}}_isParentUnionNode(a){var e,t;return((t=(e=a.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken())===q.COLON}};cn=qf([Or(0,kt),Or(1,Bt),Or(2,Ct),Or(3,br),Or(4,ge($r)),Or(5,ge(Nr))],cn);var Kf=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Zf=(a,e)=>(t,r)=>e(t,r,a);let Cr=class extends Me{constructor(a){super(),this._runtimeService=a}async executeAsync(a){if(!a||!a.node)return Promise.resolve(f.create(g.VALUE));const e=a.node,t=a.refOffsetX,r=a.refOffsetY;await this._executeAsync(e,t,r);const n=e.getValue();return n==null?Promise.resolve(f.create(g.VALUE)):Promise.resolve(n)}execute(a){if(!a||!a.node)return f.create(g.VALUE);const e=a.node,t=a.refOffsetX,r=a.refOffsetY;this._execute(e,t,r);const n=e.getValue();return n??f.create(g.VALUE)}executePreCalculateNode(a){return a.execute(),a.getValue()}checkAsyncNode(a){if(a==null)return!1;const e=[];this._checkAsyncNode(a,e);for(let t=0,r=e.length;t<r;t++)if(e[t]===!0)return!0;return!1}_checkAsyncNode(a,e){const t=a.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];e.push(s.isAsync()),this._checkAsyncNode(s,e)}}async _executeAsync(a,e=0,t=0){if(this._runtimeService.isStopExecution())return Promise.resolve(Gt.ERROR);const r=a.getChildren(),n=r.length;for(let s=0;s<n;s++){const u=r[s];if(u.getToken().toUpperCase()===Dr&&u.isEmptyParamFunction()){u.execute();continue}await this._executeAsync(u,e,t)}return a.nodeType===oe.REFERENCE&&a.setRefOffset(e,t),a.nodeType===oe.FUNCTION&&a.isAsync()?await a.executeAsync():a.execute(),Promise.resolve(Gt.SUCCESS)}_execute(a,e=0,t=0){if(this._runtimeService.isStopExecution())return Gt.ERROR;const r=a.getChildren(),n=r.length;for(let s=0;s<n;s++){const u=r[s];if(u.getToken().toUpperCase()===Dr&&u.isEmptyParamFunction()){u.execute();continue}this._execute(u,e,t)}return a.nodeType===oe.REFERENCE&&a.setRefOffset(e,t),a.execute(),Gt.SUCCESS}};Cr=Kf([Zf(0,Ct)],Cr);function yl(a){return a instanceof ae?a.getToken()===fr:!1}function zf(a){return a instanceof ae?a.getToken()===Pi:!1}function Hu(a,e,t){const r=a.getChildren(),n=r.length,s=r[0];for(let u=0;u<n;u++){const o=r[u];if(!(yl(s)&&u!==0))if(o instanceof ae)Hu(o,e,t);else{const i=o.trim();if(t.has(i)){const l=new ae;l.setToken(pn),l.setLambdaId(e),l.setLambdaPrivacyVar(t),l.setLambdaParameter(i),r[u]=l}}}}function Jf(a){let e=a;for(;e!=null&&e.getParent();)e=e.getParent();return e}function Ja(a,e=0,t=0){return{node:a,refOffsetX:e,refOffsetY:t}}function bl(a){if(!a)return;if(a.getToken()!==pn)return a;const e=a,t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(!t)return;const n=t.get(r);return n==null&&a.getValue()?a:bl(n)}class na extends jt{constructor(e,t,r){super(0),N(this,"_lambdaPrivacyValueMap",new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new na(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){const t=this._lambdaPrivacyVarKeys.length;if(e.length!==t||!this._interpreter||!this._lambdaNode)return f.create(g.VALUE);this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1);let r;if(this._interpreter.checkAsyncNode(this._lambdaNode))r=new _l(this._interpreter.executeAsync(Ja(this._lambdaNode)));else{const n=this._interpreter.execute(Ja(this._lambdaNode));n.isReferenceObject()?r=n.toArrayValueObject():r=n}return this._lambdaNode.setNotEmpty(!0),r}executeCustom(...e){const t=e.map(r=>Vt.create(r));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;const t=e.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(s.getToken()===pn){const u=s.getLambdaParameter(),o=this._lambdaPrivacyValueMap.get(u);if(o)s.setValue(o);else{const i=s.getCurrentLambdaPrivacyVar(),l=bl(i.get(u));l!=null&&s.setValue(l.getValue())}continue}this._setLambdaNodeValue(s)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){const r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var ed=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Qo=(a,e)=>(t,r)=>e(t,r,a);class td extends Ke{constructor(e,t,r,n,s){super(e),N(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n,this._runtimeService=s}get nodeType(){return oe.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return this._lambdaId===null}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(na.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{const e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}let hn=class extends xt{constructor(a,e){super(),this._runtimeService=a,this._interpreter=e}get zIndex(){return Tt.get(oe.LAMBDA)||It}create(a){const e=a.getChildren(),t=e[0];let r=e.slice(1,-1);const n=e[e.length-1];if(!(t instanceof ae&&n instanceof ae))return De.create(g.NAME);if(t.getToken()===fr){const o=t.getChildren();if(r.length!==o.length)return De.create(g.VALUE)}else r=e.slice(0,-1);const s=Ci(8),u=new Map;for(let o=0;o<r.length;o++){const i=r[o];if(i instanceof ae){const l=i.getChildren()[0];i.setToken(Pi),u.set(l.trim(),void 0)}else return De.create(g.VALUE)}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,u),this._updateLambdaStatement(n,s,u),new td(a.getToken(),s,this._interpreter,[...u.keys()],this._runtimeService)}checkAndCreateNodeType(a){if(!(!(a instanceof ae)||a.getToken().trim().toUpperCase()!==Dr))return this.create(a)}_updateLambdaStatement(a,e,t){Hu(a,e,t)}};hn=ed([Qo(0,Ct),Qo(1,ge(Cr))],hn);function Rl(a){if(!a)return;if(a.getToken()!==pn)return a;const e=a,t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(t)return Rl(t.get(r))}class rd extends Ke{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return oe.LAMBDA_PARAMETER}execute(){const e=Rl(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{const t=this.getValue();(t==null||t.isError())&&this.setValue(f.create(g.NAME))}}}class Gu extends xt{get zIndex(){return Tt.get(oe.LAMBDA_PARAMETER)||It}create(e){const t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new rd(e.getToken(),r,t):new De(g.NAME)}checkAndCreateNodeType(e){if(!(!(e instanceof ae)||e.getToken().trim()!==pn))return this.create(e)}}class nd extends Ke{constructor(e){super(e),this._operatorString=e}get nodeType(){return oe.NULL}execute(){this.setValue(ce.create())}}var sd=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Ko=(a,e)=>(t,r)=>e(t,r,a);class ad extends Ke{constructor(e,t,r){super(e),this._functionExecutor=t,this._runtimeService=r}get nodeType(){return oe.OPERATOR}execute(){const e=this.getChildren();this._functionExecutor.name===ke.COMPARE&&this._functionExecutor.setCompareType(this.getToken());const t=e[0],r=e[1];let n=t?.getValue(),s=r?.getValue();const u=this.getToken();if((n==null||s==null)&&u!==K.MINUS&&u!==K.PLUS){this.setValue(f.create(g.VALUE));return}n==null&&(n=ce.create()),s==null&&(s=ce.create()),n.isReferenceObject()&&(n=n.toArrayValueObject()),s.isReferenceObject()&&(s=s.toArrayValueObject());const o=this._functionExecutor.calculate(n,s);this._setEmbeddedArrayFormulaToResult(o),this.setValue(o)}_setEmbeddedArrayFormulaToResult(e){if(!e.isArray())return;const t=e.getRowCount(),r=e.getColumnCount();t<=1&&r<=1||this._runtimeService.setUnitArrayFormulaEmbeddedMap()}}let mn=class extends xt{constructor(a,e){super(),this._functionService=a,this._runtimeService=e}get zIndex(){return Tt.get(oe.OPERATOR)||It}create(a){let e="";const t=a;t===K.PLUS?e=ke.PLUS:t===K.MINUS?e=ke.MINUS:t===K.MULTIPLY?e=ke.MULTIPLY:t===K.DIVIDED?e=ke.DIVIDED:t===K.CONCATENATE?e=z.CONCATENATE:t===K.POWER?e=j.POWER:em.has(t)&&(e=ke.COMPARE);const r=this._functionService.getExecutor(e);return r?new ad(t,r,this._runtimeService):(console.error(`No function ${a}`),De.create(g.NAME))}checkAndCreateNodeType(a){if(a instanceof ae)return;const e=a.trim();if(!(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')&&yt.has(e))return this.create(e)}};mn=sd([Ko(0,kt),Ko(1,Ct)],mn);class ud extends Rr{constructor(e,t,r,n){super(e),N(this,"_isCurrentRowForRange",!1),this._tableData=t,this._columnDataString=r,this._tableOptionMap=n;const{sheetId:s,range:u,titleMap:o}=this._tableData;this.setForcedSheetIdDirect(s);const{startColumn:i,endColumn:l,type:c}=this._parseStructuredRef(this._columnDataString,o),h=u.startRow,m=u.endRow;let d=-1,_=-1;switch(c){case Te.ALL:d=h,_=m;break;case Te.DATA:d=h+1,_=m;break;case Te.HEADERS:d=h,_=h;break;case Te.TOTALS:d=m,_=m;break;case Te.THIS_ROW:{const C=this._resolveThisRow(h,m);d=C,_=C;break}default:d=h+1,_=m;break}this.setRangeData({startColumn:i,endColumn:l,startRow:d,endRow:_})}getRangeData(){const e=super.getRangeData();if(this._isCurrentRowForRange){const{startRow:t,startColumn:r,endRow:n,endColumn:s}=e,u=this.getCurrentRow();return{startRow:u??t,endRow:u??n,startColumn:r,endColumn:s}}return e}getRefOffset(){return{x:0,y:0}}isTable(){return!0}isCurrentRowForRange(){return this._isCurrentRowForRange}setForcedSheetId(e){}_parseStructuredRef(e,t){var r,n;const{range:s}=this._tableData,u=(r=s.startColumn)!=null?r:0,o=(n=s.endColumn)!=null?n:0;if(!e||e.trim().length===0)return{startColumn:u,endColumn:o,type:Te.DATA};const i=e.trim();if(i[0]!=="["){const E=this._mapSection(i);if(E!==void 0)return{startColumn:u,endColumn:o,type:E};const{startColumn:p,endColumn:y}=this._parseColumnOrRange(i,t,u);return{startColumn:p,endColumn:y,type:Te.DATA}}const l=this._stripOuterBracketOnce(i),c=this._findCommaAtTopLevel(l);if(l.length===0)return{startColumn:u,endColumn:o,type:Te.DATA};if(c===-1){if(l.startsWith("#")){const y=this._mapSection(l);return y!==void 0?{startColumn:u,endColumn:o,type:y}:{startColumn:u,endColumn:o,type:Te.DATA}}const{startColumn:E,endColumn:p}=this._parseColumnOrRange(l,t,u);return{startColumn:E,endColumn:p,type:Te.DATA}}const h=l.slice(0,c).trim(),m=l.slice(c+1).trim(),d=this._parseSectionMaybeBracketed(h),{startColumn:_,endColumn:C}=this._parseColumnOrRange(m,t,u);return{startColumn:_,endColumn:C,type:d}}_stripOuterBracketOnce(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findCommaAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===q.COMMA&&t===0)return r}return-1}_parseSectionMaybeBracketed(e){const t=e.trim(),r=t.startsWith("[")&&t.endsWith("]")?this._stripOuterBracketOnce(t):t,n=this._mapSection(r);return n??Te.DATA}_mapSection(e){const t=e.trim();if(!t.startsWith("#"))return;const r=this._tableOptionMap.get(t);if(r!==void 0)return r;const n=t.replace(/\s+/g," ").toLowerCase();for(const[s,u]of this._tableOptionMap.entries())if(s.replace(/\s+/g," ").toLowerCase()===n)return u}_parseColumnOrRange(e,t,r){const n=e.trim(),s=this._findColonAtTopLevel(n);if(s===-1){const m=this._stripOuterBracketIfAny(n),d=this._titleToIndex(m,t);return{startColumn:r+d,endColumn:+r+d}}const u=n.slice(0,s).trim(),o=n.slice(s+1).trim(),i=this._stripOuterBracketIfAny(u),l=this._stripOuterBracketIfAny(o),c=this._titleToIndex(i,t),h=this._titleToIndex(l,t);return c!==-1&&h!==-1&&c>h?{startColumn:r+h,endColumn:r+c}:{startColumn:r+c,endColumn:r+h}}_stripOuterBracketIfAny(e){return e.length>=2&&e[0]==="["&&e[e.length-1]==="]"?e.slice(1,-1):e}_findColonAtTopLevel(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(n==="[")t++;else if(n==="]")t=Math.max(0,t-1);else if(n===q.COLON&&t===0)return r}return-1}_titleToIndex(e,t){var r;const n=e.trim(),s=t.get(n);if(s!==void 0)return s;const u=n.replace(/\u3000/g," ").trim();return(r=t.get(u))!=null?r:-1}_resolveThisRow(e,t){return this._isCurrentRowForRange=!0,Math.min(e+1,t)}}var od=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Ln=(a,e)=>(t,r)=>e(t,r,a);class Zo extends Ke{constructor(e,t,r,n,s=!1,u){super(r),N(this,"_refOffsetX",0),N(this,"_refOffsetY",0),this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=s,this._tableReferenceObject=u}get nodeType(){return oe.REFERENCE}execute(){const e=this._currentConfigService,t=this._runtimeService,r=this._tableReferenceObject||Pf(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setArrayFormulaRange(e.getArrayFormulaRange()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeArrayFormulaRange(t.getUnitArrayFormula()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());const n=t.currentRow,s=t.currentColumn;r.setCurrentRowAndColumn(n,s);const{x:u,y:o}=this.getRefOffset();r.setRefOffset(u,o),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(f.create(g.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}let gn=class extends xt{constructor(a,e,t,r){super(),this._currentConfigService=a,this._formulaRuntimeService=e,this._functionService=t,this._superTableService=r}get zIndex(){return Tt.get(oe.REFERENCE)||It}checkAndCreateNodeType(a){var e,t;let r=!1,n,s=!1;a instanceof ae?(r=!0,n=a.getToken().trim(),((t=(e=a.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken().trim())===q.COLON&&(s=!0)):n=a.trim();const{tokenTrim:u,minusPrefixNode:o,atPrefixNode:i}=pl(n,this._functionService,this._formulaRuntimeService);if(!r&&u.charAt(0)==='"'&&u.charAt(u.length-1)==='"')return;const l=this._getNode(u,r,s,a);if(l)return i?l.setParent(i):o&&l.setParent(o),l}_getTableMap(){const a=this._currentConfigService.getExecuteUnitId();if(a)return this._superTableService.getTableMap(a)}_getNode(a,e,t,r){var n;const s=this._currentConfigService,u=this._formulaRuntimeService,o=c=>new Zo(s,u,a,c,t),i=this._getTableMap();if((n=i?.has(a))!=null&&n)return this._getTableReferenceNode(a,e,t,!0);if(An(a))return o(Zr.CELL);const l=e&&this._checkParentIsUnionOperator(r);return l&&Di(a)?o(Zr.ROW):l&&Li(a)?o(Zr.COLUMN):this._getTableReferenceNode(a,e,t,!1)}_getTableReferenceNode(a,e,t,r=!1){if(!this._checkTokenIsTableReference(a)&&!r)return;const{tableName:n,columnStruct:s}=Gi(a),u=this._getTableMap();if(!e&&u!=null&&u.has(n)){const o=s,i=u.get(n),l=this._superTableService.getTableOptionMap();return new Zo(this._currentConfigService,this._formulaRuntimeService,a,Zr.COLUMN,t,new ud(a,i,o,l))}}_checkTokenIsTableReference(a){return xm(a)||Um(a)||vm(a)||wm(a)}_checkParentIsUnionOperator(a){var e,t;return((t=(e=a.getParent())==null?void 0:e.getParent())==null?void 0:t.getToken().trim())===q.COLON}};gn=od([Ln(0,Bt),Ln(1,Ct),Ln(2,kt),Ln(3,Gr)],gn);var id=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Aa=(a,e)=>(t,r)=>e(t,r,a);class zo extends Ke{constructor(e,t,r,n){super(r),this._currentConfigService=e,this._lexer=t,this._operatorString=r,this._functionExecutor=n}get nodeType(){return oe.SUFFIX}execute(){var e;let t=(e=this.getChildren()[0])==null?void 0:e.getValue(),r;if(t==null){this.setValue(f.create(g.ERROR));return}if(this._operatorString===st.PERCENTAGE){if(t.isReferenceObject()&&(t=t.toArrayValueObject()),r=this._functionExecutor.calculate(t,A.create(100)),r.isNumber()){const n=Number(r.getValue());r=A.create(n,"0.00%")}}else this._operatorString===st.POUND?r=this._handlerPound(t):r=f.create(g.VALUE);this.setValue(r)}_handlerPound(e){var t,r,n,s;if(!e.isReferenceObject()||!e.isCell())return f.create(g.VALUE);const u=e,o=u.getRangePosition(),i=u.getUnitId(),l=u.getSheetId(),c=this._currentConfigService.getFormulaData(),h=(s=(n=(r=(t=c?.[i])==null?void 0:t[l])==null?void 0:r[o.startRow])==null?void 0:n[o.startColumn])==null?void 0:s.f;return h&&this._lexer.treeBuilder(h),f.create(g.VALUE)}}let fn=class extends xt{constructor(a,e,t){super(),this._functionService=a,this._lexer=e,this._currentConfigService=t}get zIndex(){return Tt.get(oe.SUFFIX)||It}checkAndCreateNodeType(a){if(!(a instanceof ae))return;const e=a.getToken().trim();if(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')return;let t="";if(e===st.PERCENTAGE)t=ke.DIVIDED;else return e===st.POUND?new zo(this._currentConfigService,this._lexer,e):void 0;const r=this._functionService.getExecutor(t);return r?new zo(this._currentConfigService,this._lexer,e,r):(console.error(`No function ${a}`),De.create(g.NAME))}};fn=id([Aa(0,kt),Aa(1,ge(_r)),Aa(2,Bt)],fn);var ld=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},cd=(a,e)=>(t,r)=>e(t,r,a);class hd extends Ke{constructor(e){super(e)}get nodeType(){return oe.UNION}execute(){const e=this.getChildren(),t=e[0],r=e[1],n=t.getValue(),s=r.getValue();if(n==null||s==null){console.error("UnionNode execute leftNode or rightNode is null"),this.setValue(f.create(g.VALUE));return}let u;this.getToken()===q.COLON?u=this._unionFunction(n,s):u=f.create(g.NAME),this.setValue(u)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?f.create(g.REF):(e=e,t=t,Ff(e,t))}}let dn=class extends xt{constructor(a){super(),this._functionService=a}get zIndex(){return Tt.get(oe.UNION)||It}create(a){return new hd(a)}checkAndCreateNodeType(a){if(!(a instanceof ae))return;const e=a.getToken().trim();if(!(e.charAt(0)==='"'&&e.charAt(e.length-1)==='"')&&e===q.COLON)return this.create(e)}};dn=ld([cd(0,kt)],dn);class md extends Ke{constructor(e){super(e)}get nodeType(){return oe.VALUE}execute(){var e,t;const r=this.getParent();let n=!0;r?.nodeType===oe.FUNCTION&&(n=(t=(e=r.isFunctionExecutorArgumentsIgnoreNumberPattern)==null?void 0:e.call(r))!=null?t:!0),this.setValue(Vt.create(this.getToken(),n))}}class Xu extends xt{get zIndex(){return Tt.get(oe.VALUE)||It}_checkValueNode(e){if(Number.isNaN(Number(e))){const t=e.trim(),r=t.charAt(0),n=t.charAt(t.length-1);if(zt.has(t))return this.create(t);if(r==='"'&&n==='"')return this.create(t);if(r==="{"&&n==="}")return this.create(t);const s=t.toUpperCase();if(s===Wt.TRUE||s===Wt.FALSE)return this.create(s)}else return this.create(e)}create(e){return new md(e)}checkAndCreateNodeType(e){if(!(e instanceof ae))return this._checkValueNode(e)}}var gd=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},ht=(a,e)=>(t,r)=>e(t,r,a);let jr=class extends Me{constructor(a,e,t,r,n,s,u,o,i,l,c){super(),N(this,"_astNodeFactoryList",[]),this._runtimeService=a,this._astRootNodeFactory=e,this._functionNodeFactory=t,this._lambdaNodeFactory=r,this._lambdaParameterNodeFactory=n,this._operatorNodeFactory=s,this._prefixNodeFactory=u,this._referenceNodeFactory=o,this._suffixNodeFactory=i,this._unionNodeFactory=l,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(a=>{a.dispose()}),this._astNodeFactoryList=[]}parse(a){const e=new Za(Lt),t=this._parse(a,e);return a.hasDefinedNames()&&t?.setDefinedNames(a.getDefinedNames()),t}_lambdaParameterHandler(a,e){if(e.getLambdaId==null)return De.create(g.VALUE);const t=e.getLambdaId(),r=new Za(Lt),n=this._runtimeService.getFunctionDefinitionPrivacyVar(t);if(!n)return!1;const s=[...n.keys()],u=a.getChildren(),o=u.length;for(let i=0;i<o;i++){const l=u[i];if(l instanceof ae){Hu(l,t,n),this._parse(l,r);const c=r.getChildren()[i];c!=null&&n.set(s[i],c)}else return!1}return r.setParent(e),e}_changeLetToLambda(a){const e=a.getChildren(),t=e.length;if(t%2!==1||t===0)return;const r=new ae;r.setToken(Dr);const n=new ae;n.setToken(fr);const s=[...e];for(let o=0;o<t;o++){const i=s[o];if(!(i instanceof ae))return;o%2===0?i.changeToParent(r):i.changeToParent(n)}r.addChildrenFirst(n),n.setParent(r);const u=a.getParent();return u?.replaceChild(a,r),r}_parse(a,e){var t;const r=a.getChildren(),n=r.length,s=[];let u=null;const o=a.getToken().trim().toUpperCase();if(o===Fi){const c=this._changeLetToLambda(a);return c!=null?this._parse(c,e):De.create(g.ERROR)}if(o===mt){if(u=e,n===0)return new nd(Lt).setParent(e),u}else{if(o===fr){let c=this._lambdaParameterHandler(a,e);return c===!1&&(c=De.create(g.ERROR)),c}if(u=this._checkAstNode(a),u==null)return De.create(g.NAME)}const i=r[0];for(let c=0;c<n;c++){const h=r[c];if(yl(i)){if(c!==0&&c!==n-1)continue}else if(zf(h)&&c!==n-1)continue;let m=null;if(h instanceof ae){if(h.getToken()===mt&&h.getChildren().length===0){const d=(t=h.getParent())==null?void 0:t.getChildren();if(d&&d.length===1)return De.create(g.NAME)}if(m=this._parse(h,u),m===u)continue}else m=this._checkAstNode(h);if(m==null)return De.create(g.NAME);if(m=Jf(m),m==null||m?.nodeType===oe.ERROR)return m;switch(m.nodeType){case oe.FUNCTION:{const d=m.getToken().trim().toUpperCase();Fm.has(d)&&m.setForcedCalculateFunction(),s.push(m);break}case oe.LAMBDA:s.push(m);break;case oe.LAMBDA_PARAMETER:s.push(m);break;case oe.OPERATOR:{const d=s.pop(),_=s.pop();_&&_.setParent(m),d&&d.setParent(m),s.push(m);break}case oe.REFERENCE:s.push(m);break;case oe.ROOT:s.push(m);break;case oe.UNION:s.push(m);break;case oe.VALUE:s.push(m);break;case oe.PREFIX:s.push(m);break;case oe.SUFFIX:s.push(m);break}}const l=s.length;for(let c=0;c<l;c++)s[c].setParent(u);return u}_checkAstNode(a){let e=null;const t=this._astNodeFactoryList.length;for(let r=0;r<t&&(e=this._astNodeFactoryList[r].checkAndCreateNodeType(a),e==null);r++);return e??new Qf}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(bh)}};jr=gd([ht(0,Ct),ht(1,ge(Yu)),ht(2,ge(cn)),ht(3,ge(hn)),ht(4,ge(Gu)),ht(5,ge(mn)),ht(6,ge(ln)),ht(7,ge(gn)),ht(8,ge(fn)),ht(9,ge(dn)),ht(10,ge(Xu))],jr);class Sl extends Me{constructor(){super(...arguments),N(this,"_otherFormulaData",new Map),N(this,"_featureFormulaData",new Map),N(this,"_formulaData",new Map),N(this,"_definedNameMap",new Map),N(this,"_otherFormulaDataMainData",new Set),N(this,"_dependencyRTreeCache",new Va),N(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw new Error("Method not implemented.")}getTreeById(e){throw new Error("Method not implemented.")}getAllTree(){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw new Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw new Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw new Error("Method not implemented.")}addFormulaDependency(e,t,r,n,s){throw new Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw new Error("Method not implemented.")}clearFormulaDependency(e,t){throw new Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw new Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,s;return(s=(n=this._otherFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,s;return(s=(n=this._featureFormulaData.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}getFormulaDependency(e,t,r,n){var s,u;return(u=(s=this._formulaData.get(e))==null?void 0:s.get(t))==null?void 0:u.getValue(r,n)}addDependencyRTreeCache(e){const t=[];for(let r=0;r<e.rangeList.length;r++){const n=e.rangeList[r],{unitId:s,sheetId:u,range:o}=n;t.push({unitId:s,sheetId:u,range:o,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){const e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw new Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);const n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){const r=e.treeId,n=t?.getDefinedNames()||[];for(const s of n)this._addDefinedName(e.unitId,s,r)}updateDependencyTreeDirtyState(e,t){throw new Error("Method not implemented.")}}class Ol extends Sl{constructor(){super(...arguments),N(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){const r=this.getAllTree();return e.length===0?(this._buildReverseDependency(r,t),r):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e),r)}_buildDependencyTree(e,t){const r=new Map;for(let n=0;n<t.length;n++){const s=t[n];r.set(s.treeId,s)}for(let n=0;n<e.length;n++){const s=e[n],u=s.toRTreeItem(),o=this._dependencyRTreeCache.bulkSearch(u);for(const i of o){const l=r.get(i);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}_buildReverseDependency(e,t){const r=new Map;for(let n=0;n<e.length;n++){const s=e[n];r.set(s.treeId,s)}for(let n=0;n<t.length;n++){const s=t[n],u=s.toRTreeItem(),o=this._dependencyRTreeCache.bulkSearch(u);for(const i of o){const l=r.get(i);l&&s!==l&&!l.hasChildren(s.treeId)&&l.pushChildren(s)}}r.clear()}getAllTree(){const e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);const s=this._otherFormulaData.get(e);s.has(t)||s.set(t,new Map);const u=s.get(t);u.has(r)||u.set(r,new me),u.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){const n=this._otherFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(u=>{const o=s.get(u);o!=null&&(o.forValue((i,l,c)=>{this._removeDependencyRTreeCache(c),this.clearDependencyForTree(this._allTreeMap.get(c)),this._removeAllTreeMap(c)}),s.delete(u),this._otherFormulaDataMainData.delete(u))}),s.size===0&&n.delete(t),n.size===0&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){const r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t);for(const s of n.keys()){const u=n.get(s);u!=null&&(u.forValue((o,i,l)=>{const c=this._allTreeMap.get(l);c&&(this.clearDependencyForTree(c),this._removeAllTreeMap(l))}),this._otherFormulaDataMainData.delete(s))}n.clear()}else if(r){for(const n of r.keys()){const s=r.get(n);this._removeDependencyRTreeCacheById(e,n);for(const u of s.keys()){const o=s.get(u);o!=null&&(o.forValue((i,l,c)=>{const h=this._allTreeMap.get(c);h&&(this.clearDependencyForTree(h),this._removeAllTreeMap(c))}),this._otherFormulaDataMainData.delete(u))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);const s=this._featureFormulaData.get(e);s.has(t)||s.set(t,new Map),s.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){const n=this._featureFormulaData.get(e);if(n&&n.has(t)){const s=n.get(t);r.forEach(u=>{const o=s.get(u);o!=null&&(this._removeDependencyRTreeCache(o),s.delete(u),this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o))})}}clearFeatureFormulaDependency(e,t){const r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(s=>{s!=null&&(this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s))}),n.clear()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forEach(u=>{u!=null&&(this.clearDependencyForTree(this._allTreeMap.get(u)),this._removeAllTreeMap(u))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,s){this._formulaData.has(e)||this._formulaData.set(e,new Map);const u=this._formulaData.get(e);u.has(t)||u.set(t,new me),u.get(t).setValue(r,n,s.treeId),this._addAllTreeMap(s)}removeFormulaDependency(e,t,r,n){const s=this._formulaData.get(e);if(s&&s.has(t)){const u=s.get(t),o=u.getValue(r,n);if(o==null)return;this._removeDependencyRTreeCache(o),u.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o)}}clearFormulaDependency(e,t){const r=this._formulaData.get(e);if(t&&r&&r.has(t)){const n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((s,u,o)=>{if(o==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(o)),this._removeAllTreeMap(o)}),n.reset()}else r&&(r.forEach((n,s)=>{this._removeDependencyRTreeCacheById(e,s),n.forValue((u,o,i)=>{if(i==null)return!0;this.clearDependencyForTree(this._allTreeMap.get(i)),this._removeAllTreeMap(i)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(e==null)return;const t=e.parents,r=e.children,n=this._allTreeMap;for(const s of t){const u=n.get(s);u?.children.delete(e.treeId)}for(const s of r){const u=n.get(s);u?.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(e==null)return;const t=this._allTreeMap.get(e);if(t){const r=[];for(let n=0;n<t.rangeList.length;n++){const s=t.rangeList[n],{unitId:u,sheetId:o,range:i}=s;r.push({unitId:u,sheetId:o,range:i,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){const r=this._definedNameMap.get(e);if(r){const n=r.get(t);if(n){for(const s of n)this._removeDependencyRTreeCache(s),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s);n.clear()}}}_removeAllTreeMap(e){e!=null&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}updateDependencyTreeDirtyState(e,t){const r=this._allTreeMap.get(e);r&&(r.isDirty=t)}}const Mn=Ye("univer.formula.dependency-manager.service");class Ml extends Me{constructor(){super(...arguments),N(this,"_referenceExecutorMap",new Map),N(this,"_onChanged$",new Dt),N(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(n=>{var s,u;(u=(s=this._referenceExecutorMap.get(e))==null?void 0:s.get(t))==null||u.delete(n)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,s;return(s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))==null?void 0:s.get(r)}has(e,t,r){var n,s;return!!((s=(n=this._referenceExecutorMap.get(e))==null?void 0:n.get(t))!=null&&s.has(r))}register(e,t,r,n){let s=this._referenceExecutorMap.get(e);s||(s=new Map,this._referenceExecutorMap.set(e,s));let u=s.get(t);u||(u=new Map,s.set(t,u)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),u.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}const Br=Ye("univer.formula.feature-calculation-manager.service");class Vl extends Me{constructor(){super(...arguments),N(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var t,r,n;const{unitId:s,subUnitId:u,formulaId:o}=e;(n=(r=(t=this._otherFormulaData)==null?void 0:t[s])==null?void 0:r[u])==null||delete n[o]}get(e){var t,r;const{unitId:n,subUnitId:s,formulaId:u}=e;return(r=(t=this._otherFormulaData[n])==null?void 0:t[s])==null?void 0:r[u]}has(e){var t,r;const{unitId:n,subUnitId:s,formulaId:u}=e;return((r=(t=this._otherFormulaData[n])==null?void 0:t[s])==null?void 0:r[u])!=null}register(e){const{unitId:t,subUnitId:r,formulaId:n,item:s}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=s}batchRegister(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(u=>{const o=s[u];if(o==null)return!0;this.register({unitId:t,subUnitId:n,formulaId:u,item:o})})})})}batchRemove(e){Object.keys(e).forEach(t=>{const r=e[t];if(r==null)return!0;Object.keys(r).forEach(n=>{const s=r[n];if(s==null)return!0;Object.keys(s).forEach(u=>{this.remove({unitId:t,subUnitId:n,formulaId:u})})})})}getOtherFormulaData(){return this._otherFormulaData}}const sa=Ye("univer.formula.other-formula-manager.service");var sr=(a=>(a[a.NORMAL_FORMULA=0]="NORMAL_FORMULA",a[a.OTHER_FORMULA=1]="OTHER_FORMULA",a[a.FEATURE_FORMULA=2]="FEATURE_FORMULA",a))(sr||{});class Tl{constructor(){N(this,"_state",0),N(this,"type",0),N(this,"treeId"),N(this,"children",new Set),N(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return this._state===1}setSkip(){this._state=2}isSkip(){return this._state===2}pushChildren(e){this.children.add(e.treeId),e._pushParent(this)}hasChildren(e){return this.children.has(e)}_pushParent(e){this.parents.add(e.treeId)}}class eu extends Tl{constructor(){super(...arguments),N(this,"refTree"),N(this,"refOffsetX",-1),N(this,"refOffsetY",-1),N(this,"isCache",!1),N(this,"isDirty",!1),N(this,"addressFunctionNodes",[]),N(this,"getDirtyData"),N(this,"featureId")}get isVirtual(){return!0}get row(){return this.refTree==null?-1:this.refTree.row+this.refOffsetY}get column(){return this.refTree==null?-1:this.refTree.column+this.refOffsetX}get rowCount(){return this.refTree==null?0:this.refTree.rowCount}get columnCount(){return this.refTree==null?0:this.refTree.columnCount}get unitId(){return this.refTree==null?"":this.refTree.unitId}get subUnitId(){return this.refTree==null?"":this.refTree.subUnitId}get formula(){var e,t;return(t=(e=this.refTree)==null?void 0:e.formula)!=null?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return(e=this.refTree)==null?void 0:e.node}dispose(){this.refTree=null}get rangeList(){const e=[];if(this.refTree==null)return[];for(let t=0;t<this.refTree.rangeList.length;t++){const r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:cu(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,u=this.row,o=this.column;return!(u<t||u>n||o<r||o>s)}dependencySheetName(e){return this.refTree==null?!1:this.refTree.dependencySheetName(e)}isExcludeRange(e){var t;const r=this.rangeList;if(r.length===0)return!1;for(let n=0,s=r.length;n<s;n++){const u=r[n],{unitId:o,sheetId:i,range:l}=u,c=(t=e?.[o])==null?void 0:t[i];let{startRow:h,endRow:m,startColumn:d,endColumn:_}=l;Number.isNaN(h)&&(h=0),Number.isNaN(d)&&(d=0),Number.isNaN(m)&&(m=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let C=!1;if(c?.forValue((E,p)=>{if(E>=h&&E<=m&&p>=d&&p<=_)return C=!0,!1}),C)return!0}return!1}get formulaId(){return this.refTree==null?"":this.refTree.formulaId}}class Zn extends Tl{constructor(e){super(),N(this,"isCache",!1),N(this,"featureId"),N(this,"featureDirtyRanges",[]),N(this,"refOffsetX",0),N(this,"refOffsetY",0),N(this,"formulaId"),N(this,"subUnitId",""),N(this,"unitId",""),N(this,"rangeList",[]),N(this,"formula",""),N(this,"row",-1),N(this,"column",-1),N(this,"rowCount",Number.NEGATIVE_INFINITY),N(this,"columnCount",Number.NEGATIVE_INFINITY),N(this,"isDirty",!1),N(this,"node"),N(this,"addressFunctionNodes",[]),N(this,"getDirtyData"),this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){const t=e.startRow,r=e.startColumn,n=e.endRow,s=e.endColumn,u=this.row,o=this.column;return!(u<t||u>n||o<r||o>s)}dependencySheetName(e){var t;const r=this.rangeList;if(r.length===0||e==null)return!1;for(let n=0,s=r.length;n<s;n++){const u=r[n],{unitId:o,sheetId:i}=u;if(((t=e[o])==null?void 0:t[i])!=null)return!0}return!1}isExcludeRange(e){var t;const r=this.rangeList;if(r.length===0)return!1;for(let n=0,s=r.length;n<s;n++){const u=r[n],{unitId:o,sheetId:i,range:l}=u,c=(t=e?.[o])==null?void 0:t[i];let{startRow:h,endRow:m,startColumn:d,endColumn:_}=l;Number.isNaN(h)&&(h=0),Number.isNaN(d)&&(d=0),Number.isNaN(m)&&(m=Number.POSITIVE_INFINITY),Number.isNaN(_)&&(_=Number.POSITIVE_INFINITY);let C=!1;if(c?.forValue((E,p)=>{if(E>=h&&E<=m&&p>=d&&p<=_)return C=!0,!1}),C)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return this.rangeList.length===0&&this.type!==2}toRTreeItem(){if(this.featureId!=null)return this.featureDirtyRanges;const e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}class tu{constructor(e){N(this,"children",new Set),N(this,"parents",new Set),N(this,"treeId",-1),N(this,"formula",""),N(this,"refOffsetX",0),N(this,"refOffsetY",0),N(this,"row",-1),N(this,"column",-1),N(this,"unitId",""),N(this,"subUnitId",""),N(this,"rangeList",[]),N(this,"refTreeId"),N(this,"formulaId"),N(this,"featureId"),N(this,"type");var t,r,n,s;this.treeId=e.treeId,this.row=e.row,this.column=e.column,this.unitId=e.unitId,this.subUnitId=e.subUnitId,this.refOffsetX=e.refOffsetX,this.refOffsetY=e.refOffsetY,this.rangeList=e.rangeList,e.isVirtual?this.refTreeId=(r=(t=e.refTree)==null?void 0:t.treeId)!=null?r:-1:(this.formula=e.formula,this.formulaId=(n=e.formulaId)!=null?n:void 0,this.featureId=(s=e.featureId)!=null?s:void 0,this.type=e.type)}toJson(){return{children:Array.from(this.children).map(e=>e.treeId),parents:Array.from(this.parents).map(e=>e.treeId),treeId:this.treeId,formula:this.formula,row:this.row,column:this.column,unitId:this.unitId,subUnitId:this.subUnitId,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY,rangeList:this.rangeList,refTreeId:this.refTreeId,formulaId:this.formulaId,featureId:this.featureId,type:this.type}}toFullJson(){return{children:Array.from(this.children).map(e=>e.toJson()),parents:Array.from(this.parents).map(e=>e.toJson()),treeId:this.treeId,formula:this.formula,row:this.row,column:this.column,unitId:this.unitId,subUnitId:this.subUnitId,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY,rangeList:this.rangeList,refTreeId:this.refTreeId,formulaId:this.formulaId,featureId:this.featureId,type:this.type}}addParent(e){this.parents.add(e)}addChild(e){this.children.add(e)}}var fd=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},pt=(a,e)=>(t,r)=>e(t,r,a);function nr(a){return a.getLastTreeId()||0}const Ms=Ye("engine-formula.dependency-generator");let Vs=class extends Me{constructor(a,e,t,r,n,s,u,o,i,l){super(),N(this,"_updateRangeFlattenCache",new Map),N(this,"_dependencyRTreeCacheForAddressFunction",new Va),N(this,"_executedAddressFunctionNodeIds",new Set),N(this,"_formulaDependencyTreeModel",new Map),this._currentConfigService=a,this._runtimeService=e,this._otherFormulaManagerService=t,this._featureCalculationManagerService=r,this._univerInstanceService=n,this._interpreter=s,this._astTreeBuilder=u,this._lexer=o,this._dependencyManagerService=i,this._lexerTreeBuilder=l,this._initUnitDispose()}dispose(){super.dispose(),this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),or.clear()}_initUnitDispose(){this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(nt.UNIVER_SHEET).subscribe(a=>{this._disposeByUnitId(a.getUnitId())}))}_disposeByUnitId(a){or.forEach((e,t)=>{t.startsWith(a)&&or.delete(t)})}async generate(a=!1){this._updateRangeFlatten();const e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();r!=null&&Object.keys(r).forEach(i=>{i!=null&&Object.keys(r[i]).forEach(l=>{l!=null&&(this._dependencyManagerService.clearOtherFormulaDependency(i,l),this._dependencyManagerService.clearFeatureFormulaDependency(i,l),this._dependencyManagerService.clearFormulaDependency(i,l))})});const n=this._currentConfigService.getUnitData(),s=await this._generateTreeList(e,t,n);a&&this._runtimeService.setDependencyTreeModelData(this._getAllDependencyJson(s));const u=this._getUpdateTreeListAndMakeDependency(s);let o=this._calculateRunList(u);return this._dependencyFeatureCalculation(o)&&(o.forEach(i=>{i.resetState()}),o=this._calculateRunList(o)),this._checkIsCycleDependency(o)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),this._runtimeService.clearArrayObjectCache(),Promise.resolve(o)}_dependencyFeatureCalculation(a){const e=this._featureCalculationManagerService.getReferenceExecutorMap();if(e.size===0)return;this._clearFeatureCalculationNode(a);let t=!1;return e.forEach((r,n)=>{r.forEach((s,u)=>{s.forEach((o,i)=>{const{unitId:l,subUnitId:c,getDirtyData:h}=o,m=h(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),d=this._convertDirtyRangesToUnitRange(m.dirtyRanges),_=this._intersectFeatureCalculation(d,a,{unitId:l,subUnitId:c,featureId:i});if(_.length>0){let C=this._getExistTreeList({unitId:l,subUnitId:c,featureId:i},a);C==null&&(C=this._getFeatureFormulaTree(i,nr(this._dependencyManagerService),o),a.push(C)),C.parents=new Set,_.forEach(E=>{E.hasChildren(C.treeId)||E.pushChildren(C)}),t=!0}})})}),t}_clearFeatureCalculationNode(a){const e=this._featureCalculationManagerService.getReferenceExecutorMap();a.forEach(t=>{var r,n,s,u;const o=new Set;for(const l of t.children){const c=this._dependencyManagerService.getTreeById(l);c&&(c.featureId&&(n=(r=e.get(t.unitId))==null?void 0:r.get(t.subUnitId))!=null&&n.has(c.featureId)||o.add(l))}t.children=o;const i=new Set;for(const l of t.parents){const c=this._dependencyManagerService.getTreeById(l);c&&(c.featureId&&(u=(s=e.get(t.unitId))==null?void 0:s.get(t.subUnitId))!=null&&u.has(c.featureId)||i.add(l))}t.parents=i})}_convertDirtyRangesToUnitRange(a){const e=[];for(const t in a){const r=a[t];for(const n in r){const s=r[n];for(const u of s)e.push({unitId:t,sheetId:n,range:u})}}return e}_intersectFeatureCalculation(a,e,t){const r=[],n=this._dependencyManagerService.searchDependency(a);for(let s=0,u=e.length;s<u;s++){const o=e[s];o.unitId===t.unitId&&o.subUnitId===t.subUnitId&&o.featureId===t.featureId||n.has(o.treeId)&&r.push(o)}return r}_getExistTreeList(a,e){const{unitId:t,subUnitId:r,featureId:n}=a;for(let s=0,u=e.length;s<u;s++){const o=e[s];if(o.unitId===t&&o.subUnitId===r&&o.featureId===n)return o}}_isCyclicUtil(a,e,t){const r=this._dependencyManagerService.getTreeById(a);if(r==null)return!1;if(!e.has(r.treeId)){e.add(r.treeId),t.add(r.treeId);for(const n of r.children)if(!e.has(n)&&this._isCyclicUtil(n,e,t)||t.has(n))return!0}return t.delete(r.treeId),!1}_checkIsCycleDependency(a){const e=new Set,t=new Set;for(let r=0,n=a.length;r<n;r++){const s=a[r];if(this._isCyclicUtil(s.treeId,e,t)===!0)return!0}return!1}async _generateTreeList(a,e,t){const r=Object.keys(a),n=Object.keys(e),s=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(r,a,t,s),this._registerOtherFormulas(e,n,s),this._registerFeatureFormulas(s);for(let u=0,o=s.length;u<o;u++){const i=s[u];if(!i.formula)continue;const l=this._getTreeNode(i);i.isDirty=this._includeTree(i,l);const c=this._getAddressFunctionNodeList(l);if(c.length>0&&(i.addressFunctionNodes=c),i.isVirtual)continue;this._runtimeService.setCurrent(i.row,i.column,i.rowCount,i.columnCount,i.subUnitId,i.unitId);const h=await this._getRangeListByNode({node:l,refOffsetX:i.refOffsetX,refOffsetY:i.refOffsetY});i.pushRangeList(h)}for(let u=0,o=s.length;u<o;u++){const i=s[u];i.isCache||this._dependencyManagerService.addDependencyRTreeCache(i)}return await this._calculateListByFunctionRefNode(s),s}_registerFeatureFormulas(a){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((e,t)=>{e.forEach((r,n)=>{r.forEach((s,u)=>{const o=this._dependencyManagerService.getFeatureFormulaDependency(s.unitId,s.subUnitId,u);a.push(this._getFeatureFormulaTree(u,o,s))})})})}_getFeatureFormulaTree(a,e,t){const{unitId:r,subUnitId:n,dependencyRanges:s,getDirtyData:u}=t,o=e||nr(this._dependencyManagerService),i=new Zn(o);i.unitId=r,i.subUnitId=n,i.rangeList=s,i.getDirtyData=u;const l=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),c=this._convertDirtyRangesToUnitRange(l.dirtyRanges);return i.featureDirtyRanges=c,i.featureId=a,i.type=sr.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(r,n,a,i),this._dependencyManagerService.getFeatureFormulaDependency(t.unitId,t.subUnitId,a)&&(i.isCache=!0),i}_registerOtherFormulas(a,e,t){for(const r of e){const n=a[r];if(n==null)continue;const s=Object.keys(n);for(const u of s){const o=n[u];if(o==null)continue;const i=Object.keys(o);for(const l of i){const c=this._dependencyManagerService.hasOtherFormulaDataMainData(l),h=o[l],{f:m,ranges:d}=h;let _=!1;c&&(_=!0);const C=za(r,m,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:E,firstColumn:p}=this._getFirstCellOfRange(d),y=this._dependencyManagerService.getOtherFormulaDependency(r,u,l),b=y?.getValue(0,0)||nr(this._dependencyManagerService),O=new Zn(b);for(let M=0;M<d.length;M++){const V=d[M],{startRow:T,startColumn:x,endRow:v,endColumn:L}=V;for(let D=T;D<=v;D++)for(let Y=x;Y<=L;Y++){const ee=Y-p,ue=D-E;if(ee===0&&ue===0){O.node=C,O.formula=m,O.unitId=r,O.subUnitId=u,O.formulaId=l,O.type=sr.OTHER_FORMULA,O.isCache=_,t.push(O),this._dependencyManagerService.addOtherFormulaDependency(r,u,l,O),this._dependencyManagerService.addFormulaDependencyByDefinedName(O);continue}const H=new eu;H.treeId=y?.getValue(ee,ue)||nr(this._dependencyManagerService),H.refTree=O,H.refOffsetX=ee,H.refOffsetY=ue,H.isCache=_,H.type=sr.OTHER_FORMULA,this._dependencyManagerService.addOtherFormulaDependency(r,u,l,H),this._dependencyManagerService.addFormulaDependencyByDefinedName(H),t.push(H)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(l)}}}}_getFirstCellOfRange(a){const e=a[0];return{firstRow:e.startRow,firstColumn:e.startColumn}}_registerFormulas(a,e,t,r){for(const n of a){const s=e[n];if(s==null)continue;const u=Object.keys(s);for(const o of u){const i=new me(s[o]||{}),l=new Map;i.forValue((c,h,m)=>{if(m==null)return!0;const{x:d=0,y:_=0,si:C}=m;if(!(d===0&&_===0&&C!=null))return!0;const E=this._createFDtree(n,o,c,h,t,m),p=this._dependencyManagerService.getFormulaDependency(n,o,c,h);p!=null?(E.treeId=p,E.isCache=!0,this._dependencyManagerService.updateDependencyTreeDirtyState(p,!1)):(this._dependencyManagerService.addFormulaDependency(n,o,c,h,E),this._dependencyManagerService.addFormulaDependencyByDefinedName(E)),l.set(C,E),r.push(E)}),i.forValue((c,h,m)=>{if(m==null)return!0;const{x:d=0,y:_=0,si:C}=m;if(d===0&&_===0&&C!=null)return!0;let E;if(C&&l.has(C)){const y=l.get(C);E=this._createVirtualFDtree(y,m)}else E=this._createFDtree(n,o,c,h,t,m);const p=this._dependencyManagerService.getFormulaDependency(n,o,c,h);p!=null?(E.treeId=p,E.isCache=!0,this._dependencyManagerService.updateDependencyTreeDirtyState(p,!1)):(this._dependencyManagerService.addFormulaDependency(n,o,c,h,E),this._dependencyManagerService.addFormulaDependencyByDefinedName(E)),r.push(E)}),l.clear()}}}_createFDtree(a,e,t,r,n,s){const{f:u,x:o=0,y:i=0}=s,l=new Zn(nr(this._dependencyManagerService)),c=n[a][e],h=za(a,u,this._lexer,this._astTreeBuilder,this._currentConfigService);return l.node=h,l.formula=u,l.unitId=a,l.subUnitId=e,l.row=t,l.column=r,l.rowCount=c.rowCount,l.columnCount=c.columnCount,l}_createVirtualFDtree(a,e){const{x:t=0,y:r=0}=e,n=new eu;return n.treeId=nr(this._dependencyManagerService),n.refTree=a,n.refOffsetX=t,n.refOffsetY=r,n}_updateRangeFlatten(){const a=this._currentConfigService.isForceCalculate(),e=this._currentConfigService.getDirtyRanges();if(!a){this._updateRangeFlattenCache.clear();for(let t=0;t<e.length;t++){const r=e[t],n=r.range,s=r.sheetId,u=r.unitId;this._addFlattenCache(u,s,n)}}}_addFlattenCache(a,e,t){let r=this._updateRangeFlattenCache.get(a);r==null&&(r=new Map,this._updateRangeFlattenCache.set(a,r));let n=r.get(e);n==null&&(n=[],r.set(e,n)),n.push(t)}_isPreCalculateNode(a){return a.nodeType===oe.UNION||a.nodeType===oe.PREFIX&&a.getToken()===Ie.AT||a.nodeType===oe.SUFFIX&&a.getToken()===st.POUND}_nodeTraversalRef(a,e){const t=a.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(this._isPreCalculateNode(s)){if(e.push(s),s.nodeType===oe.UNION)for(const u of s.getChildren())u.nodeType===oe.FUNCTION&&u.isAddress()&&this._nodeTraversalRef(u,e);continue}else s.nodeType===oe.REFERENCE&&e.push(s);this._nodeTraversalRef(s,e)}}_nodeTraversalReferenceFunction(a,e){const t=a.getChildren(),r=t.length;for(let n=0;n<r;n++){const s=t[n];if(s.nodeType===oe.FUNCTION&&s.isAddress()){e.push(s);continue}this._nodeTraversalReferenceFunction(s,e)}}async _executeNode(a,e=0,t=0){let r;const n={node:a,refOffsetX:e,refOffsetY:t};return this._interpreter.checkAsyncNode(a)?r=await this._interpreter.executeAsync(n):r=this._interpreter.execute(n),r}async _getRangeListByNode(a){const e=[],t=a.refOffsetX,r=a.refOffsetY,n=a.node;if(n==null)return[];this._nodeTraversalRef(n,e);const s=[];for(let u=0,o=e.length;u<o;u++){const i=e[u],l=(await this._executeNode(i,t,r)).toUnitRange();s.push(l),i.setValue(null)}return s}_getAddressFunctionNodeList(a){const e=[];return a==null?[]:(this._nodeTraversalReferenceFunction(a,e),e)}_getTreeNode(a){return a.node}async _buildDirtyRangesByAddressFunction(a,e){const t=e.addressFunctionNodes;if(t.length===0)return;const r=e.refOffsetX,n=e.refOffsetY,s=await this._getRangeListByFunctionRefNode(t,r,n);e.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(e,s);const u=a.bulkSearch(s),o=this._buildTreeNodeById(u);o.length!==0&&await this._calculateAddressFunctionRuntimeData(a,o)}async _calculateListByFunctionRefNode(a){const e=new Va;for(let t=0,r=a.length;t<r;t++){const n=a[t];e.insert({unitId:n.unitId,sheetId:n.subUnitId,range:{startRow:n.row,startColumn:n.column,endRow:n.row,endColumn:n.column},id:n.treeId})}this._executedAddressFunctionNodeIds.clear();for(let t=0,r=a.length;t<r;t++){const n=a[t];await this._calculateAddressFunction(e,n)}}async _calculateAddressFunction(a,e){const t=e.addressFunctionNodes;if(t.length===0)return;const r=e.refOffsetX,n=e.refOffsetY;this._runtimeService.setCurrent(e.row,e.column,e.rowCount,e.columnCount,e.subUnitId,e.unitId);const s=[];for(let i=0,l=t.length;i<l;i++){const c=await this._getRangeListByNode({node:t[i],refOffsetX:r,refOffsetY:n});s.push(...c)}const u=new Set;this._searchDependencyByAddressFunction(a,s,u);const o=this._buildTreeNodeById(u);if(o.length===0){await this._buildDirtyRangesByAddressFunction(a,e);return}await this._calculateAddressFunctionRuntimeData(a,o),await this._buildDirtyRangesByAddressFunction(a,e)}async _calculateAddressFunctionRuntimeData(a,e){for(;e.length>0;){const t=e.pop(),r={node:this._getTreeNode(t),refOffsetX:t.refOffsetX,refOffsetY:t.refOffsetY};await this._calculateAddressFunction(a,t),this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let n;this._interpreter.checkAsyncNode(r.node)?n=await this._interpreter.executeAsync(r):n=this._interpreter.execute(r),t.formulaId!=null?this._runtimeService.setRuntimeOtherData(t.formulaId,t.refOffsetX,t.refOffsetY,n):this._runtimeService.setRuntimeData(n)}}_buildTreeNodeById(a){const e=[];for(const t of a){const r=this._getTreeById(t);!r||this._executedAddressFunctionNodeIds.has(t)||(this._executedAddressFunctionNodeIds.add(t),e.push(r))}return e}_searchDependencyByAddressFunction(a,e,t){const r=a.bulkSearch(e),n=this._dependencyRTreeCacheForAddressFunction.bulkSearch(e);for(const u of n)t.has(u)||t.add(u);const s=[];for(const u of r){const o=this._getTreeById(u);o&&!t.has(u)&&(s.push(...o.rangeList),t.add(u))}return s.length>0&&this._searchDependencyByAddressFunction(a,s,t),t}_getTreeById(a){return this._dependencyManagerService.getTreeById(a)}_addDependencyTreeByAddressFunction(a,e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],{unitId:s,sheetId:u,range:o}=n;t.push({unitId:s,sheetId:u,range:o,id:a.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(t)}async _getRangeListByFunctionRefNode(a,e,t){const r=[];for(let n=0,s=a.length;n<s;n++){const u=a[n],o=(await this._executeNode(u,e,t)).toUnitRange();r.push(o),u.setValue(null)}return r}_getUpdateTreeListAndMakeDependency(a){const e=[],t=new Set,r=this._currentConfigService.isForceCalculate(),n=this._currentConfigService.getDirtyRanges(),s=this._dependencyManagerService.searchDependency(n),u=this._dependencyRTreeCacheForAddressFunction.bulkSearch(n);for(const i of u)s.add(i);const o=this._dependencyManagerService.buildDependencyTree(a);for(const i of o){const l=i.treeId;(r||i.isDirty||i.dependencySheetName(this._currentConfigService.getDirtyNameMap())||s.has(l)&&!i.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!t.has(l)&&(e.push(i),t.add(l))}return e}_includeTreeFeature(a){var e,t;const r=a.unitId,n=a.subUnitId,s=a.featureId;if(s!=null){const u=this._currentConfigService.getDirtyUnitFeatureMap();if(((t=(e=u?.[r])==null?void 0:e[n])==null?void 0:t[s])!=null)return!0}return!1}_includeOtherFormula(a){var e,t;const r=a.unitId,n=a.subUnitId,s=a.formulaId;if(s!=null){const u=this._currentConfigService.getDirtyUnitOtherFormulaMap();if(((t=(e=u?.[r])==null?void 0:e[n])==null?void 0:t[s])!=null)return!0}return!1}_detectForcedRecalculationNode(a,e){return e==null?!1:this._detectForcedRecalculationNodeRecursion(e)}_detectForcedRecalculationNodeRecursion(a){if(a.isForcedCalculateFunction())return!0;const e=a.getChildren();for(let t=0,r=e.length;t<r;t++){const n=e[t];if(this._detectForcedRecalculationNodeRecursion(n))return!0}return!1}_includeTree(a,e){var t,r,n;const s=a.unitId,u=a.subUnitId;if(this._detectForcedRecalculationNode(a,e)===!0||this._includeTreeFeature(a)===!0||this._includeOtherFormula(a)===!0||Gf(a,e,this._currentConfigService)===!0)return!0;const o=(r=(t=this._currentConfigService.getExcludedRange())==null?void 0:t[s])==null?void 0:r[u];if(o?.getValue(a.row,a.column)!=null)return!1;if(((n=this._currentConfigService.getDirtyNameMap()[s])==null?void 0:n[u])!=null)return!0;if(!this._updateRangeFlattenCache.has(s))return!1;const i=this._updateRangeFlattenCache.get(s);if(!i.has(u))return!1;const l=i.get(u);for(const c of l)if(a.inRangeData(c))return!0;return!1}_calculateRunList(a){a.length;const e=a,t=[],r=[];for(;e.length>0;){const n=e.pop();if(n===void 0||n.isSkip())continue;if(n.isAdded()){t.push(n),n.setSkip();continue}r.length=0;for(const u of n.parents){const o=this._dependencyManagerService.getTreeById(u);if(!o){console.error("Dependency tree not found for treeId:",u);continue}o.isAdded()||n.isSkip()||r.push(o)}const s=this._dependencyRTreeCacheForAddressFunction.bulkSearch(n.toRTreeItem());for(const u of s){const o=this._dependencyManagerService.getTreeById(u);if(!o){console.error("Dependency tree not found for treeId:",u);continue}o.isAdded()||n.isSkip()||r.push(o)}r.length===0?(t.push(n),n.setSkip()):(n.setAdded(),e.push(n,...r))}return t}async _initializeGenerateTreeList(){const a=this._currentConfigService.getFormulaData(),e=this._otherFormulaManagerService.getOtherFormulaData(),t=this._currentConfigService.getUnitData();return await this._generateTreeList(a,e,t)}async _getAllTreeList(){const a=await this._initializeGenerateTreeList();return this._dependencyManagerService.buildDependencyTree(a)}_getTreeModel(a){let e=this._formulaDependencyTreeModel.get(a);if(!e){const t=this._getTreeById(a);if(!t){console.error("FormulaDependencyTree is null for treeId:",a);return}e=new tu(t),this._formulaDependencyTreeModel.set(a,e)}return e}_getDependencyTreeParenIds(a){return a.parents}_getDependencyTreeChildrenIds(a){return a.children}_getFormulaDependencyTreeModel(a){const e=this._getTreeModel(a.treeId),t=this._getDependencyTreeParenIds(a);if(!e)return new tu(a);for(const r of t){const n=this._getTreeModel(r);n&&(e.addParent(n),n.addChild(e))}return e}_endFormulaDependencyTreeModel(){this._formulaDependencyTreeModel.clear()}_startFormulaDependencyTreeModel(){}_getAllDependencyJson(a){this._startFormulaDependencyTreeModel();const e=[];for(const r of a){const n=r.type;if(r.isVirtual&&(n===sr.FEATURE_FORMULA||n===sr.OTHER_FORMULA))continue;const s=this._getFormulaDependencyTreeModel(r);e.push(s)}const t=[];for(const r of e)t.push(r.toJson());return this._endFormulaDependencyTreeModel(),t}async getAllDependencyJson(){const a=await this._getAllTreeList();return this._getAllDependencyJson(a)}_setRealFormulaString(a){if(a.refTreeId==null)return;const e=this._getTreeById(a.refTreeId);if(!e)return;const t=this._lexerTreeBuilder.moveFormulaRefOffset(e.formula,a.refOffsetX,a.refOffsetY);a.formula=t}async getCellDependencyJson(a,e,t,r){await this._initializeGenerateTreeList();const n=this._dependencyManagerService.getFormulaDependency(a,e,t,r);if(n==null)return;const s=this._getTreeById(n);if(!s)return;this._startFormulaDependencyTreeModel();const u=this._getFormulaDependencyTreeModel(s);this._setRealFormulaString(u);const o=this._getDependencyTreeChildrenIds(s);for(const i of o){const l=this._getTreeModel(i);l&&(this._setRealFormulaString(l),u.addChild(l))}for(const i of u.parents)this._setRealFormulaString(i);return this._endFormulaDependencyTreeModel(),u.toFullJson()}_getRangeDependents(a){const e=this._dependencyManagerService.searchDependency(a),t=[];for(const n of e){const s=this._getTreeById(n);if(!s)continue;const u=this._getFormulaDependencyTreeModel(s);this._setRealFormulaString(u),t.push(u)}const r=[];for(const n of t)n&&r.push(n.toJson());return r}async getRangeDependents(a){await this._initializeGenerateTreeList(),this._startFormulaDependencyTreeModel();const e=this._getRangeDependents(a);return this._endFormulaDependencyTreeModel(),e}_getInRangeFormulas(a,e){const t=[];for(const s of e)for(const u of a){const o=u.unitId,i=u.sheetId;if(!(s.unitId!==o||s.subUnitId!==i)&&(u.range,s.inRangeData(u.range))){t.push(s);break}}const r=[];for(const s of t){const u=this._getFormulaDependencyTreeModel(s);this._setRealFormulaString(u),r[s.treeId]=u}const n=[];for(const s of r)s&&n.push(s.toJson());return n}async getInRangeFormulas(a){const e=await this._getAllTreeList();this._startFormulaDependencyTreeModel();const t=this._getInRangeFormulas(a,e);return this._endFormulaDependencyTreeModel(),t}async getRangeDependentsAndInRangeFormulas(a){const e=await this._getAllTreeList();this._startFormulaDependencyTreeModel();const t=this._getRangeDependents(a),r=this._getInRangeFormulas(a,e);return this._endFormulaDependencyTreeModel(),{dependents:t,inRanges:r}}};Vs=fd([pt(0,Bt),pt(1,Ct),pt(2,sa),pt(3,Br),pt(4,ge(pr)),pt(5,ge(Cr)),pt(6,ge(jr)),pt(7,ge(_r)),pt(8,Mn),pt(9,ge(Pr))],Vs);var dd=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},tr=(a,e)=>(t,r)=>e(t,r,a);const Il=500,Ts=Ye("engine-formula.calculate-formula.service");let Is=class extends Me{constructor(a,e,t,r,n,s,u){super(),N(this,"_executionInProgressListener$",new Dt),N(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),N(this,"_executionCompleteListener$",new Dt),N(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),N(this,"_executeLock",new Sh),N(this,"_isCalculateTreeModel",!1),this._configService=a,this._lexer=e,this._currentConfigService=t,this._runtimeService=r,this._formulaDependencyGenerator=n,this._interpreter=s,this._astTreeBuilder=u}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),Tr.clear(),ze.clear(),xa.clear(),Qa.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(a,e){this._runtimeService.setRuntimeFeatureCellData(a,e)}setRuntimeFeatureRange(a,e){this._runtimeService.setRuntimeFeatureRange(a,e)}async execute(a){this._runtimeService.setFormulaExecuteStage(Ze.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(a),this._runtimeService.reset();const e=a.maxIteration||Ji;this._isCalculateTreeModel=a.isCalculateTreeModel||!1,this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let t=0;t<e&&(this._runtimeService.setFormulaCycleIndex(t),await this._executeStep(),Tr.clear(),!!this._runtimeService.isCycleDependency());t++);this._runtimeService.setFormulaExecuteStage(Ze.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),ze.clear(),this._runtimeService.reset()})}async _executeStep(){const a=await this._apply();if(a==null)return;const{arrayFormulaRange:e,runtimeFeatureRange:t}=a,{dirtyRanges:r,excludedCell:n}=this._getArrayFormulaDirtyRangeAndExcludedRange(e,t);return r==null||r.length===0||(Tr.clear(),this._currentConfigService.loadDirtyRangesAndExcludedCell(r,n),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(a,e){const t=[],r={};return Object.keys(a).forEach(n=>{const s=a[n];if(s==null)return!0;Object.keys(s).forEach(u=>{const o=new me(s[u]);if(o==null)return!0;const i=new me;o.forValue((l,c,h)=>{i.setValue(l,c,!0),t.push({unitId:n,sheetId:u,range:h})}),r[n]==null&&(r[n]={}),r[n][u]=i})}),Object.keys(e).forEach(n=>{const s=e[n];Object.keys(s).forEach(u=>{const o=s[u];if(o==null)return!0;Object.keys(o).forEach(i=>{const l=o[i];if(l==null)return!0;for(const c of l)t.push({unitId:u,sheetId:i,range:c})})})}),{dirtyRanges:t,excludedCell:r}}async _apply(a=!1){var e;a?this._runtimeService.setFormulaExecuteStage(Ze.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(Ze.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());const t=(await this._formulaDependencyGenerator.generate(this._isCalculateTreeModel)).reverse(),r=this._interpreter;a?(this._runtimeService.setFormulaExecuteStage(Ze.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(Ze.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[];const s=this._configService.getConfig(Ws),u=s?.intervalCount||Il,o=t.length;for(let i=0;i<o;i++){const l=t[i],c=l.nodeData,h=l.getDirtyData;if(i%u===0&&(await new Promise(d=>{const _=Oh(d);n.push(_)}),a?(this._runtimeService.setFormulaExecuteStage(Ze.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(i+1)):(this._runtimeService.setFormulaExecuteStage(Ze.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(i+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||c==null&&h==null)){this._runtimeService.setFormulaExecuteStage(Ze.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}this._runtimeService.setCurrent(l.row,l.column,l.rowCount,l.columnCount,l.subUnitId,l.unitId);let m;if(h!=null&&l.featureId!=null){const{runtimeCellData:d,dirtyRanges:_}=h(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(l.featureId,d),this._runtimeService.setRuntimeFeatureRange(l.featureId,_)}else c!=null&&(r.checkAsyncNode(c.node)?m=await r.executeAsync(c):m=r.execute(c),l.formulaId!=null?this._runtimeService.setRuntimeOtherData(l.formulaId,l.refOffsetX,l.refOffsetY,m):this._runtimeService.setRuntimeData(m));(e=c.node)==null||e.resetCalculationState()}return n.forEach(i=>i()),n=[],o>0?this._runtimeService.markedAsSuccessfullyExecuted():a||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}async executeFormulas(a,e){var t;this._currentConfigService.loadDataLite(e);const r=this._currentConfigService.getUnitData();this._runtimeService.reset();const n={};for(const s of Object.keys(a)){const u=a[s];if(u!=null){n[s]={};for(const o of Object.keys(u)){const i=u[o];if(i==null)continue;const l=(t=r[s])==null?void 0:t[o];if(l!=null){n[s][o]={};for(const c of Object.keys(i)){const h=Number.parseInt(c);n[s][o][h]={};const m=i[h];if(m)for(const d of Object.keys(m)){const _=Number.parseInt(d),C=m[_];if(!C)continue;const E=l.rowCount||0,p=l.columnCount||0;this._runtimeService.setCurrent(h,_,E,p,o,s);const y=[];for(const b of C){let O=await this.calculate(b);if(!O){y.push({value:null,formula:b});continue}O.isReferenceObject()&&(O=O.toArrayValueObject());const M=O;if(M.isArray()){const V=M;if(V.getRowCount()===1&&V.getColumnCount()===1){y.push({value:V.getFirstCell().getValue(),formula:b});continue}y.push({value:V.toValue(),formula:b});continue}y.push({value:M.getValue(),formula:b})}n[s][o][h][_]=y}}}}}}return n}async calculate(a){const e=this._lexer.treeBuilder(a);if(Object.values(g).includes(e))return;const t=this._astTreeBuilder.parse(e),r=this._interpreter;if(t==null)return;const n={node:t,refOffsetX:0,refOffsetY:0};return r.checkAsyncNode(t)?await r.executeAsync(n):r.execute(n)}async getAllDependencyJson(){return this._currentConfigService.loadDataLite(),this._formulaDependencyGenerator.getAllDependencyJson()}async getCellDependencyJson(a,e,t,r){return this._currentConfigService.loadDataLite(),this._formulaDependencyGenerator.getCellDependencyJson(a,e,t,r)}async getRangeDependents(a){return this._currentConfigService.loadDataLite(),this._formulaDependencyGenerator.getRangeDependents(a)}async getInRangeFormulas(a){return this._currentConfigService.loadDataLite(),this._formulaDependencyGenerator.getInRangeFormulas(a)}async getDependentsAndInRangeFormulas(a){return this._currentConfigService.loadDataLite(),this._formulaDependencyGenerator.getRangeDependentsAndInRangeFormulas(a)}};Is=dd([tr(0,_n),tr(1,ge(_r)),tr(2,Bt),tr(3,Ct),tr(4,Ms),tr(5,ge(Cr)),tr(6,ge(jr))],Is);var Nd=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},pa=(a,e)=>(t,r)=>e(t,r,a);let Nn=class extends Me{constructor(a,e,t){super(),this._commandService=a,this._calculateFormulaService=e,this._formulaDataModel=t,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(a=>{if(a.id===bu.id)this._calculateFormulaService.stopFormulaExecution();else if(a.id===Au.id)this._calculate(a.params);else if(a.id===gs.id){const e=a.params;if(e==null)return;const{arrayFormulaRange:t,arrayFormulaCellData:r}=e;this._formulaDataModel.setArrayFormulaRange(t),this._formulaDataModel.setArrayFormulaCellData(r)}else if(a.id===pu.id)this._calculateFormulaString(a.params);else if(a.id===Ru.id)this._generateAllDependencyTreeJson();else if(a.id===Su.id)this._generateCellDependencyTreeJson(a.params);else if(a.id===Mu.id){const e=a.params;this._queryFormulaDependencyJson(e)}else if(a.id===Tu.id){const e=a.params;this._queryFormulaDependencyAllJson(e)}}))}async _calculate(a){const{forceCalculation:e=!1,dirtyRanges:t=[],dirtyNameMap:r={},dirtyDefinedNameMap:n={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:u={},clearDependencyTreeCache:o={},maxIteration:i=Ji,rowData:l,isCalculateTreeModel:c=!1}=a,h=this._formulaDataModel.getFormulaData(),m=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:h,arrayFormulaCellData:m,arrayFormulaRange:d,forceCalculate:e,dirtyRanges:t,dirtyNameMap:r,dirtyDefinedNameMap:n,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:u,clearDependencyTreeCache:o,maxIteration:i,isCalculateTreeModel:c,rowData:l})}async _queryFormulaDependencyJson(a){const{unitRanges:e,isInRange:t}=a;let r=[];t?r=await this._calculateFormulaService.getInRangeFormulas(e):r=await this._calculateFormulaService.getRangeDependents(e),this._commandService.executeCommand(Vu.id,{result:r},{onlyLocal:!0})}async _queryFormulaDependencyAllJson(a){const{unitRanges:e}=a,t=await this._calculateFormulaService.getDependentsAndInRangeFormulas(e);this._commandService.executeCommand(Iu.id,{result:t},{onlyLocal:!0})}async _generateAllDependencyTreeJson(){const a=await this._calculateFormulaService.getAllDependencyJson();this._commandService.executeCommand(Cs.id,{result:a},{onlyLocal:!0})}async _generateCellDependencyTreeJson(a){const{unitId:e,sheetId:t,row:r,column:n}=a,s=await this._calculateFormulaService.getCellDependencyJson(e,t,r,n);this._commandService.executeCommand(Ou.id,{result:s},{onlyLocal:!0})}async _calculateFormulaString(a){const{formulas:e}=a,t=await this._calculateFormulaService.executeFormulas(e);this._commandService.executeCommand(yu.id,{result:t},{onlyLocal:!0})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(a=>{const e=a.functionsExecutedState;switch(e){case Vr.NOT_EXECUTED:this._applyTreeResult(a);break;case Vr.STOP_EXECUTION:break;case Vr.SUCCESS:this._applyResult(a);break;case Vr.INITIAL:break}this._commandService.executeCommand(sn.id,{functionsExecutedState:e},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(a=>{this._commandService.executeCommand(sn.id,{stageInfo:a},{onlyLocal:!0})})}async _applyTreeResult(a){const{dependencyTreeModelData:e}=a;e.length>0&&this._commandService.executeCommand(Cs.id,{result:e},{onlyLocal:!0})}async _applyResult(a){const{unitData:e,unitOtherData:t,arrayFormulaRange:r,arrayFormulaCellData:n,clearArrayFormulaCellData:s,arrayFormulaEmbedded:u,imageFormulaData:o,dependencyTreeModelData:i}=a;if(!e){this._applyTreeResult(a),console.error("No sheetData from Formula Engine!");return}(r||u)&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(r),this._commandService.executeCommand(gs.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData(),arrayFormulaEmbedded:u},{onlyLocal:!0})),o&&o.length>0&&this._commandService.executeCommand(Uu.id,{imageFormulaData:o},{onlyLocal:!0}),this._applyTreeResult(a),this._commandService.executeCommand(qs.id,{unitData:Lm(e),unitOtherData:t},{onlyLocal:!0})}};Nn=Nd([pa(0,_t),pa(1,Ts),pa(2,ge(Nr))],Nn);const Jo=/[\[\]]/g;function ei(a,e){if(Jo.test(a)){const t=Number(a.replace(Jo,""));return e+t}return Number(a)-1}function ya(a,e=0,t=0){a=a.toLocaleUpperCase();const r=a.split(/[RC]/),n=r[1],s=r[2],u=ei(n,e),o=ei(s,t);return{row:u,column:o,absoluteRefType:xe.NONE}}function xl(a,e=0,t=0){const{refBody:r,sheetName:n,unitId:s}=Hs(a),u=r.indexOf(":");if(u===-1){const C=ya(r,e,t),E=C.row,p=C.column,y=C.absoluteRefType;return{unitId:s,sheetName:n,range:{startRow:E,startColumn:p,endRow:E,endColumn:p,startAbsoluteRefType:y,endAbsoluteRefType:y}}}const o=r.substring(0,u),i=r.substring(u+1),l=ya(o,e,t),c=ya(i,e,t),h=l.row,m=l.column,d=c.row,_=c.column;return{unitId:s,sheetName:n,range:{startRow:h,startColumn:m,endRow:d,endColumn:_,startAbsoluteRefType:l.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}function _d(a){const e=Pn(a.startRow,a.startAbsoluteRefType,!0),t=Pn(a.startColumn,a.startAbsoluteRefType,!1),r=Pn(a.endRow,a.endAbsoluteRefType,!0),n=Pn(a.endColumn,a.endAbsoluteRefType,!1);return e===r&&t===n?`R${e}C${t}`:`R${e}C${t}:R${r}C${n}`}function Pn(a,e=xe.ALL,t){switch(a+=1,e){case xe.ALL:return`${a}`;case xe.ROW:return t?`${a}`:`[${a}]`;case xe.COLUMN:return t?`[${a}]`:`${a}`;case xe.NONE:return`[${a}]`}}function ir(a){let e=a;if(a.isArray()){const t=a.getRowCount(),r=a.getColumnCount();if(t>1||r>1)return f.create(g.VALUE);e=a.get(0,0)}return e.isError(),e}function Vn(...a){for(let e=0;e<a.length;e++){const t=ir(a[e]);if(t.isError())return{isError:!0,errorObject:t};a[e]=t}return{isError:!1,variants:a}}function G(...a){for(let e=0;e<a.length;e++){const t=ir(a[e]);if(t.isError())return{isError:!0,errorObject:t};if(t.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE)};a[e]=t}return{isError:!1,variants:a}}function He(...a){for(let e=0;e<a.length;e++){let t=a[e];if(t.isError())return{isError:!0,errorObject:t};if(t.isNull())return{isError:!0,errorObject:f.create(g.NA)};if(t=ir(a[e]),t.isError())return{isError:!0,errorObject:t};if(t.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE)};a[e]=t}return{isError:!1,variants:a}}function F(...a){for(let e=0;e<a.length;e++){let t=a[e];if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t};a[e]=t}return{isError:!1,variants:a}}class R{constructor(e){N(this,"_unitId"),N(this,"_subUnitId"),N(this,"_row",-1),N(this,"_column",-1),N(this,"_definedNames"),N(this,"_locale"),N(this,"_sheetOrder"),N(this,"_sheetNameMap"),N(this,"_formulaDataModel"),N(this,"_rowCount",-1),N(this,"_columnCount",-1),N(this,"needsExpandParams",!1),N(this,"needsReferenceObject",!1),N(this,"needsLocale",!1),N(this,"needsSheetsInfo",!1),N(this,"needsFormulaDataModel",!1),N(this,"needsSheetRowColumnCount",!1),N(this,"needsFilteredOutRows",!1),N(this,"minParams",-1),N(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(e){var t;const r=this._definedNames;return r==null?null:(t=Array.from(Object.values(r)).filter(n=>n.name===e))==null?void 0:t[0]}setDefinedNames(e){this._definedNames=e}getLocale(){return this._locale}setLocale(e){this._locale=e}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:e,sheetNameMap:t}){this._sheetOrder=e,this._sheetNameMap=t}setFormulaDataModel(e){this._formulaDataModel=e}setSheetRowColumnCount(e,t){this._rowCount=e,this._columnCount=t}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}isArgumentsIgnoreNumberPattern(){return!1}setRefInfo(e,t,r,n){this._unitId=e,this._subUnitId=t,this._row=r,this._column=n}calculateCustom(...e){return null}calculate(...e){return f.create(g.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return r.getValue()===!1?f.create(g.VALUE):t;if(r.isString()){const n=Number(r.getValue());return Number.isNaN(n)?f.create(g.REF):n}else if(r.isNumber())return r.getValue();return f.create(g.VALUE)}getZeroOrOneByOneDefault(e){if(e==null)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())e.getValue()===!1&&(t=0);else{if(e.isString())return;e.isNumber()&&e.getValue()===0&&(t=0)}return t}getMatchTypeValue(e){if(e==null)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())e.getValue()===!1&&(t=0);else{if(e.isString())return;if(e.isNumber()){const r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,n,s){const u=t.binarySearch(e,n,s);if(u==null)return f.create(g.NA);let o;return r.getRowCount()===1?o=r.get(0,u)||ce.create():o=r.get(u,0)||ce.create(),o.isNull()?A.create(0):o}_getOneFirstByRaw(e){return e.length===0?f.create(g.NA):e[0][0]||f.create(g.NA)}_getOneLastByRaw(e){return e.length===0?f.create(g.NA):e[e.length-1][e[0].length-1]||f.create(g.NA)}equalSearch(e,t,r,n=!0){const s=r.pickRaw(t.isEqual(e));return n?this._getOneFirstByRaw(s):this._getOneLastByRaw(s)}fuzzySearch(e,t,r,n=!0){const s=r.pickRaw(t.compare(e,k.EQUALS));return n?this._getOneFirstByRaw(s):this._getOneLastByRaw(s)}orderSearch(e,t,r,n=ve.MIN,s=!1){const u=t.orderSearch(e,n,s);if(u==null)return f.create(g.NA);const o=r.get(u.row,u.column)||ce.create();return o.isNull()?f.create(g.NA):o}binarySearchExpand(e,t,r,n=0,s,u){const o=t.binarySearch(e,s,u);return o==null?f.create(g.NA):n===0?r.slice([o,o+1]):r.slice(void 0,[o,o+1])}equalSearchExpand(e,t,r,n=!0,s=0){const u=t.isEqual(e);let o;return n?o=u.getFirstTruePosition():o=u.getLastTruePosition(),o==null?f.create(g.NA):s===0?r.slice([o.row,o.row+1]):r.slice(void 0,[o.column,o.column+1])}fuzzySearchExpand(e,t,r,n=!0,s=0){const u=t.compare(e,k.EQUALS);let o;return n?o=u.getFirstTruePosition():o=u.getLastTruePosition(),o==null?f.create(g.NA):s===0?r.slice([o.row,o.row+1]):r.slice(void 0,[o.column,o.column+1])}orderSearchExpand(e,t,r,n=ve.MIN,s=!1,u=0){const o=t.orderSearch(e,n,s);return o==null?f.create(g.NA):u===0?r.slice([o.row,o.row+1]):r.slice(void 0,[o.column,o.column+1])}flattenArray(e,t=!0){const r=[];r[0]=[];for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean()||s.isNull())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){let u;if(s.iterator(o=>{if(o==null||o.isNull()||t&&(o.isString()||o.isBoolean()))return!0;if(o=this._includingLogicalValuesAndText(o),o.isError())return u=o,!1;r[0].push(o)}),u!=null&&u.isError())return u}else r[0].push(s)}return ft(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=vf(e)),e.isString()){const t=Number(e.getValue());e=A.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){const r=e.getForcedUnitId()||e.getDefaultUnitId()||"",n=e.getForcedSheetId()||e.getDefaultUnitId()||"",s=e.getForcedSheetName(),u=fs({unitId:r,sheetName:s,range:t});let o;return An(u)?o=new Fu(u):Di(u)?o=new Bu(u):Li(u)?o=new ju(u):o=new on(t,n,r),this._setReferenceDefault(e,o)}_setReferenceDefault(e,t){if(this.unitId==null||this.subUnitId==null)return f.create(g.REF);t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId);const r=e.getUnitId();r!=null&&t.setForcedUnitIdDirect(r);const n=e.getForcedSheetId();return n!=null&&t.setForcedSheetIdDirect(n),t.setForcedSheetName(e.getForcedSheetName()),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setUnitStylesData(e.getUnitStylesData()),t}}class Cd extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;const{isError:n,errorObject:s,variants:u}=Vn(t,r);if(n)return s;const{isError:o,errorObject:i,variants:l}=F(...u);if(o)return i;const[c,h]=l,m=Math.floor(+c.getValue()),d=Math.floor(+h.getValue());if(m<0||d<0)return f.create(g.NUM);if(m===0||d===0)return f.create(g.REF);const _=e.isArray()?e.getRowCount():1,C=e.isArray()?e.getColumnCount():1;if(_===1&&C===1)return e.isArray()?e.get(0,0):e;const E=m>_?_:m,p=d>C?C:d;return e.slice([0,E],[0,p])}}class Ed extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r],s=n.isArray()?n.getRowCount():1,u=n.isArray()?n.getColumnCount():1;for(let o=0;o<s;o++)for(let i=0;i<u;i++){const l=n.isArray()?n.get(o,i):n;t.push([l])}}return W.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}var xs=(a=>(a.ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",a.FLATTEN="FLATTEN",a))(xs||{});const Ul=[[Cd,xs.ARRAY_CONSTRAIN],[Ed,xs.FLATTEN]];var kr;(a=>{const e=.636619772;function t(s,u){let o=0;for(let i=0;i<s.length;++i)o=u*o+s[i];return o}function r(s,u,o,i,l){if(u===0)return o;if(u===1)return i;const c=2/s;let h=o,m=i,d=i;for(let _=1;_<u;++_)d=m*_*c+l*h,h=m,m=d;return d}function n(s,u,o,i){return function(l,c){if(o){if(l===0)return o===1?-1/0:1/0;if(l<0)return Number.NaN}if(c===0)return s(l);if(c===1)return u(l);if(c<0)return Number.NaN;const h=c|0,m=s(l),d=u(l);return r(l,h,m,d,i)}}a.besselj=(()=>{const s=[-184.9052456,77392.33017,-1121442418e-2,6516196407e-1,-13362590354,57568490574],u=[1,267.8532712,59272.64853,9494680718e-3,1029532985,57568490411],o=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],i=[-934935152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function l(C){let E=0,p=0,y=0,b=C*C;if(C<8)p=t(s,b),y=t(u,b),E=p/y;else{const O=C-.785398164;b=64/b,p=t(o,b),y=t(i,b),E=Math.sqrt(e/C)*(Math.cos(O)*p-Math.sin(O)*y*8/C)}return E}const c=[-30.16036606,15704.4826,-2972611439e-3,2423968531e-1,-7895059235,72362614232],h=[1,376.9991397,99447.43394,1858330474e-2,2300535178,144725228442],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function _(C){let E=0,p=0,y=0,b=C*C;const O=Math.abs(C)-2.356194491;return Math.abs(C)<8?(p=C*t(c,b),y=t(h,b),E=p/y):(b=64/b,p=t(m,b),y=t(d,b),E=Math.sqrt(e/Math.abs(C))*(Math.cos(O)*p-Math.sin(O)*y*8/Math.abs(C)),C<0&&(E=-E)),E}return function C(E,p){const y=Math.round(p);if(!Number.isFinite(E))return Number.isNaN(E)?E:0;if(y<0)return(y%2?-1:1)*C(E,-y);if(E<0)return(y%2?-1:1)*C(-E,y);if(y===0)return l(E);if(y===1)return _(E);if(E===0)return 0;let b=0;if(E>y)b=r(E,y,l(E),_(E),-1);else{const O=2*Math.floor((y+Math.floor(Math.sqrt(40*y)))/2);let M=!1,V=0,T=0,x=1,v=0;const L=2/E;for(let D=O;D>0;D--)if(v=D*L*x-V,V=x,x=v,Math.abs(x)>1e10&&(x*=1e-10,V*=1e-10,b*=1e-10,T*=1e-10),M&&(T+=x),M=!M,D===y&&(b=V),O-D>100&&b===0)return Number.NaN;T=2*T-x,b/=T}return b}})(),a.bessely=(()=>{const s=[228.4622733,-86327.92757,1087988129e-2,-5123598036e-1,7062834065,-2957821389],u=[1,226.1030244,47447.2647,7189466438e-3,7452499648e-1,40076544269],o=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],i=[-934945152e-16,7621095161e-16,-6911147651e-15,.0001430488765,-.01562499995];function l(C){let E=0,p=0,y=0,b=C*C;const O=C-.785398164;return C<8?(p=t(s,b),y=t(u,b),E=p/y+e*(0,a.besselj)(C,0)*Math.log(C)):(b=64/b,p=t(o,b),y=t(i,b),E=Math.sqrt(e/C)*(Math.sin(O)*p+Math.cos(O)*y*8/C)),E}const c=[8511.937935,-4237922726e-3,7349264551e-1,-51534381390,127527439e4,-4900604943e3],h=[1,354.9632885,102042.605,2245904002e-2,3733650367,424441966400,249958057e5],m=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],d=[105787412e-15,-88228987e-14,8449199096e-15,-.0002002690873,.04687499995];function _(C){let E=0,p=0,y=0,b=C*C;const O=C-2.356194491;return C<8?(p=C*t(c,b),y=t(h,b),E=p/y+e*((0,a.besselj)(C,1)*Math.log(C)-1/C)):(b=64/b,p=t(m,b),y=t(d,b),E=Math.sqrt(e/C)*(Math.sin(O)*p+Math.cos(O)*y*8/C)),E}return n(l,_,1,-1)})(),a.besseli=(()=>{const s=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],u=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function o(h){return h<=3.75?t(s,h*h/(3.75*3.75)):Math.exp(Math.abs(h))/Math.sqrt(Math.abs(h))*t(u,3.75/Math.abs(h))}const i=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],l=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function c(h){return h<3.75?h*t(i,h*h/(3.75*3.75)):(h<0?-1:1)*Math.exp(Math.abs(h))/Math.sqrt(Math.abs(h))*t(l,3.75/Math.abs(h))}return function h(m,d){const _=Math.round(d);if(_===0)return o(m);if(_===1)return c(m);if(_<0)return Number.NaN;if(Math.abs(m)===0)return 0;if(m===1/0)return 1/0;let C=0,E;const p=2/Math.abs(m);let y=0,b=1,O=0;const M=2*Math.round((_+Math.round(Math.sqrt(40*_)))/2);for(E=M;E>0;E--)if(O=E*p*b+y,y=b,b=O,Math.abs(b)>1e10&&(b*=1e-10,y*=1e-10,C*=1e-10),E===_&&(C=y),M-E>100&&C===0)return Number.NaN;return C*=h(m,0)/b,m<0&&_%2?-C:C}})(),a.besselk=(()=>{const s=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],u=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function o(h){return h<=2?-Math.log(h/2)*(0,a.besseli)(h,0)+t(s,h*h/4):Math.exp(-h)/Math.sqrt(h)*t(u,2/h)}const i=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],l=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function c(h){return h<=2?Math.log(h/2)*(0,a.besseli)(h,1)+1/h*t(i,h*h/4):Math.exp(-h)/Math.sqrt(h)*t(l,2/h)}return n(o,c,2,1)})()})(kr||(kr={}));function qu(a){return/^[01]{1,10}$/.test(a)}function Wu(a){return/^[0-7]{1,10}$/.test(a)}function Qu(a){return/^[0-9A-Fa-f]{1,10}$/.test(a)}function lr(a){if(a===0)return 0;const e=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let t=a,r=!1;t<0&&(t=-t,r=!0);const n=2/(2+t),s=4*n-2;let u=0,o=0,i;for(let c=e.length-1;c>0;c--)i=u,u=s*u-o+e[c],o=i;const l=n*Math.exp(-t*t+.5*(e[0]+s*u)-o);return r?l-1:1-l}function Ku(a){return 1-lr(a)}function Ad(a){if(a>=2)return-100;if(a<=0)return 100;const e=a<1?a:2-a,t=Math.sqrt(-2*Math.log(e/2));let r=-.70711*((2.30753+t*.27061)/(1+t*(.99229+t*.04481))-t);for(let n=0;n<2;n++){const s=Ku(r)-e;r+=s/(1.1283791670955126*Math.exp(-r*r)-r*s)}return a<1?r:-r}function Ir(a,e=1){let t=Math.floor(a);if(a<0)return Number.NaN;let r=1;for(;t>1&&Number.isFinite(r);)r*=t,t-=e;return r}function cr(a,e){const t=Math.min(a-e,e);let r=1;for(let n=1;n<=t&&Number.isFinite(r);n++)r*=a-n+1,r/=n;return r}function ru(a,e){let t=Math.floor(a),r=Math.floor(e);for(;r!==0;){const n=r;r=t%r,t=n}return t}function ti(a,e){const t=ru(a,e);return t===0?0:Math.abs(a*e)/t}function Zu(a){const e=a.length;if(e===1)return a[0][0];if(e===2)return a[0][0]*a[1][1]-a[0][1]*a[1][0];const{rowSwap:t,smallPivotDetected:r,luMatrix:n,permutation:s}=vl(a);if(r)return 0;let u=t?1:-1;for(let o=0;o<s.length;o++)u*=n[o][o];return u===0?0:u}function pd(a){const e=Zu(a);return e===0?null:a.length===1?[[1/e]]:bd(a).map(t=>t.map(r=>r/e))}function yd(a,e,t){return a.filter((r,n)=>n!==e).map(r=>r.filter((n,s)=>s!==t))}function bd(a){const e=a.length,t=Array.from({length:e},()=>new Array(e).fill(0));for(let r=0;r<e;r++)for(let n=0;n<e;n++){const s=((r+n)%2===0?1:-1)*Zu(yd(a,r,n));t[n][r]=s===0?0:s}return t}function xr(a,e){return a.map(t=>e[0].map((r,n)=>t.reduce((s,u,o)=>s+u*e[o][n],0)))}function Rt(a){return a[0].map((e,t)=>a.map(r=>r[t]))}function Rd(a){const{smallPivotDetected:e,luMatrix:t,permutation:r}=vl(a);return e?null:Sd(t,r)}function vl(a){const e=Rt(a),t=e.length,r=e[0].length;let n=!0,s=!1;const u=nu(t,r,0),o=new Array(r).fill(0).map((i,l)=>l);for(let i=0;i<r;i++){for(let m=0;m<i;m++){let d=e[m][i];for(let _=0;_<m;_++)d-=u[m][_]*u[_][i];u[m][i]=d}let l=-1/0,c=i;for(let m=i;m<t;m++){let d=e[m][i];for(let C=0;C<i;C++)d-=u[m][C]*u[C][i];u[m][i]=d;const _=Math.abs(d);_>l&&(l=_,c=m)}if(Math.abs(u[c][i])<1e-11){s=!0;break}c!==i&&([u[i],u[c]]=[u[c],u[i]],[e[i],e[c]]=[e[c],e[i]],[o[i],o[c]]=[o[c],o[i]],n=!n);const h=u[i][i];for(let m=i+1;m<t;m++)u[m][i]/=h}return{rowSwap:n,smallPivotDetected:s,luMatrix:u,permutation:o}}function Sd(a,e){const t=e.length,r=nu(t,t,0);for(let s=0;s<t;s++)r[s][s]=1;const n=nu(t,t,0);for(let s=0;s<t;s++){const u=e[s];for(let o=0;o<t;o++)n[s][o]=r[u][o]}for(let s=0;s<t;s++){const u=n[s];for(let o=s+1;o<t;o++){const i=a[o][s];for(let l=0;l<t;l++)n[o][l]-=u[l]*i}}for(let s=t-1;s>=0;s--){const u=n[s],o=a[s][s];for(let i=0;i<t;i++)u[i]/=o;for(let i=0;i<s;i++){const l=a[i][s];for(let c=0;c<t;c++)n[i][c]-=u[c]*l}}return n}function nu(a,e,t){const r=[];for(let n=0;n<a;n++){r[n]=[];for(let s=0;s<e;s++)r[n].push(t)}return r}function Od(a){const e=Md(a);if(!e)return null;const{matrixU:t,matrixS:r,matrixV:n}=e,s=Rt(t),u=Array.from({length:r.length},()=>new Array(a[0].length).fill(0)),o=Math.max(a.length,a[0].length)*Number.EPSILON*r[0];for(let i=0;i<r.length;i++)Math.abs(r[i])>o&&(u[i][i]=1/r[i]);return xr(n,xr(u,s))}function Md(a){const e=Rt(a),t=e.length,r=e[0].length;if(t<r)return null;const n=new Array(r).fill(0),s=new Array(r).fill(0),u=Array.from({length:r},()=>new Array(r).fill(0));let o=Number.EPSILON,i=0,l=0,c=0;for(let C=0;C<r;C++){if(n[C]=i,l=ba(e,C,t,C,C),l<=1e-64/o)i=0;else{i=Math.sqrt(l),e[C][C]>=0&&(i=-i);const p=e[C][C]*i-l;e[C][C]-=i;for(let y=C+1;y<r;y++){l=ba(e,C,t,C,y);for(let b=C;b<t;b++)e[b][y]+=l/p*e[b][C]}}if(s[C]=i,l=ri(e,C+1,r,C,C),l<=1e-64/o)i=0;else{i=Math.sqrt(l),e[C][C+1]>=0&&(i=-i);const p=e[C][C+1]*i-l;e[C][C+1]-=i;for(let y=C+1;y<r;y++)n[y]=e[C][y]/p;for(let y=C+1;y<t;y++){l=ri(e,C+1,r,y,C);for(let b=C+1;b<r;b++)e[y][b]+=l*n[b]}}const E=Math.abs(s[C])+Math.abs(n[C]);E>c&&(c=E)}let h=0;for(let C=r-1;C>=0;C--){if(i!==0){for(let E=h;E<r;E++)u[E][C]=e[C][E]/(i*e[C][C+1]);for(let E=h;E<r;E++){l=0;for(let p=h;p<r;p++)l+=e[C][p]*u[p][E];for(let p=h;p<r;p++)u[p][E]+=l*u[p][C]}}for(let E=h;E<r;E++)u[C][E]=0,u[E][C]=0;u[C][C]=1,i=n[C],h=C}for(let C=r-1;C>=0;C--){i=s[C];for(let E=C+1;E<r;E++)e[C][E]=0;if(i!==0){for(let E=C+1;E<r;E++){l=ba(e,C+1,t,C,E);for(let p=C;p<t;p++)e[p][E]+=l/(e[C][C]*i)*e[p][C]}for(let E=C;E<t;E++)e[E][C]/=i}else for(let E=C;E<t;E++)e[E][C]=0;e[C][C]+=1}o*=c;let m=0,d=0,_=0;for(let C=r-1;C>=0;C--)for(let E=0;E<50;E++){let p=!1,y=C;for(;y>=0;y--){if(Math.abs(n[y])<=o){p=!0;break}if(Math.abs(s[y-1])<=o)break}if(!p){let V=0,T=1;for(let x=y;x<C+1&&(m=T*n[x],d=s[x],n[x]*=V,!(Math.abs(m)<=o));x++){_=Fn(m,d),s[x]=_,V=d/_,T=-m/_;for(let v=0;v<t;v++){const L=e[v][y-1],D=e[v][x];e[v][y-1]=L*V+D*T,e[v][x]=-L*T+D*V}}}if(y===C){if(s[C]<0){s[C]=-s[C];for(let V=0;V<r;V++)u[V][C]=-u[V][C]}break}if(E>=49)return null;let b=s[y];m=((s[C-1]-s[C])*(s[C-1]+s[C])+(n[C-1]-n[C])*(n[C-1]+n[C]))/(2*n[C]*s[C-1]),_=Fn(m,1),m<0?m=((b-s[C])*(b+s[C])+n[C]*(s[C-1]/(m-_)-n[C]))/b:m=((b-s[C])*(b+s[C])+n[C]*(s[C-1]/(m+_)-n[C]))/b;let O=1,M=1;for(let V=y+1;V<C+1;V++){let T=n[V],x=s[V];d=M*T,T*=O,_=Fn(m,d),n[V-1]=_,O=m/_,M=d/_,m=b*O+T*M,d=x*M,T=-b*M+T*O,x*=O;for(let v=0;v<r;v++){const L=u[v][V-1],D=u[v][V];u[v][V-1]=L*O+D*M,u[v][V]=-L*M+D*O}_=Fn(m,d),s[V-1]=_,O=m/_,M=d/_,m=O*T+M*x,b=-M*T+O*x;for(let v=0;v<t;v++){const L=e[v][V-1],D=e[v][V];e[v][V-1]=L*O+D*M,e[v][V]=-L*M+D*O}}n[y]=0,n[C]=m,s[C]=b}for(let C=0;C<s.length;C++)s[C]<o&&(s[C]=0);for(let C=0;C<r;C++)for(let E=C-1;E>=0;E--)if(s[E]<s[C]){const p=s[E];s[E]=s[C],s[C]=p;for(let y=0;y<e.length;y++){const b=e[y][C];e[y][C]=e[y][E],e[y][E]=b}for(let y=0;y<u.length;y++){const b=u[y][C];u[y][C]=u[y][E],u[y][E]=b}C=E}return{matrixU:e,matrixS:s,matrixV:u}}function Fn(a,e){let t=0;return Math.abs(a)>Math.abs(e)?(t=e/a,Math.abs(a)*Math.sqrt(1+t*t)):e!==0?(t=a/e,Math.abs(e)*Math.sqrt(1+t*t)):0}function ba(a,e,t,r,n){let s=0;for(let u=e;u<t;u++)s+=a[u][r]*a[u][n];return s}function ri(a,e,t,r,n){let s=0;for(let u=e;u<t;u++)s+=a[r][u]*a[n][u];return s}const jn=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),Vd=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),Td=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function wl(a,e,t){return a<=0?0:a>=1?1:aa(a,e,t)}function Id(a,e,t){return a<=0||a>=1?0:e===1&&t===1?1:e<512&&t<512?a**(e-1)*(1-a)**(t-1)/Ju(e,t):Math.exp((e-1)*Math.log(a)+(t-1)*Math.log(1-a)-eo(e,t))}function zu(a,e,t){if(a<=0)return 0;if(a>=1)return 1;const r=1e-8;let n;if(e>=1&&t>=1){const l=a<.5?a:1-a,c=Math.sqrt(-2*Math.log(l));n=(2.30753+c*.27061)/(1+c*(.99229+c*.04481))-c,a<.5&&(n=-n);const h=(n*n-3)/6,m=2/(1/(2*e-1)+1/(2*t-1)),d=n*Math.sqrt(h+m)/m-(1/(2*t-1)-1/(2*e-1))*(h+5/6-2/(3*m));n=e/(e+t*Math.exp(2*d))}else{const l=Math.exp(e*Math.log(e/(e+t)))/e,c=Math.exp(t*Math.log(t/(e+t)))/t,h=l+c;a<l/h?n=(e*h*a)**(1/e):n=1-(t*h*(1-a))**(1/t)}const s=-eo(e,t);let u,o,i;for(let l=0;l<10;l++){if(n===0||n===1)return n;if(u=aa(n,e,t)-a,o=Math.exp((e-1)*Math.log(n)+(t-1)*Math.log(1-n)+s),i=u/o,n-=o=i/(1-.5*Math.min(1,i*((e-1)/n-(t-1)/(1-n)))),n<=0&&(n=.5*(n+o)),n>=1&&(n=.5*(n+o+1)),Math.abs(o)<r*n&&l>0)break}return n}function aa(a,e,t){const r=a===0||a===1?0:Math.exp(Nt(e+t)-Nt(e)-Nt(t)+e*Math.log(a)+t*Math.log(1-a));return a<(e+1)/(e+t+2)?r*ni(a,e,t)/e:1-r*ni(1-a,t,e)/t}function ni(a,e,t){let r=1-(e+t)*a/(e+1);Math.abs(r)<1e-8&&(r=1e-8),r=1/r;let n=1,s=r;for(let u=1;u<=100;u++){let o=u*(t-u)*a/((e-1+u*2)*(e+u*2));if(r=1+o*r,Math.abs(r)<1e-8&&(r=1e-8),n=1+o/n,Math.abs(n)<1e-8&&(n=1e-8),r=1/r,s*=r*n,o=-(e+u)*(e+t+u)*a/((e+u*2)*(e+1+u*2)),r=1+o*r,Math.abs(r)<1e-8&&(r=1e-8),n=1+o/n,Math.abs(n)<1e-8&&(n=1e-8),r=1/r,s*=r*n,Math.abs(r*n-1)<1e-8)break}return s}function Ju(a,e){return a+e>170?Math.exp(eo(a,e)):zn(a)*zn(e)/zn(a+e)}function eo(a,e){return Nt(a)+Nt(e)-Nt(a+e)}function Dl(a,e,t){if(a<0)return 0;if(a>=e)return 1;if(t<0||t>1||e<=0)return Number.NaN;let r=0;for(let n=0;n<=a;n++)r+=to(n,e,t);return r}function to(a,e,t){return t===0||t===1?e*t===a?1:0:cr(e,a)*t**a*(1-t)**(e-a)}function ro(a,e){return a<=0?0:so(e/2,a/2)}function xd(a,e){return a<0?0:a===0&&e===2?.5:Math.exp((e/2-1)*Math.log(a)-a/2-e/2*Math.log(2)-Nt(e/2))}function Ll(a,e){return a<=0?0:a>=1?1/0:2*jl(a,e/2)}function no(a,e,t){return a<0?0:aa(e*a/(e*a+t),e/2,t/2)}function Ud(a,e,t){if(a<0)return 0;if(a===0&&e<2)return 1/0;if(a===0&&e===2)return 1;let r=1/Ju(e/2,t/2);return r*=(e/t)**(e/2),r*=a**(e/2-1),r*=(1+e/t*a)**(-(e+t)/2),r}function Pl(a,e,t){return a<=0?0:a>=1?1/0:t/(e*(1/zu(a,e/2,t/2)-1))}function vd(a,e){return a<0?0:1-Math.exp(-e*a)}function wd(a,e){return a<0?0:e*Math.exp(-e*a)}function Fl(a,e,t){const r=e.length;let n=0,s=0;for(let h=0;h<r;h++)n+=e[h],s+=t[h];const u=n/r,o=s/r;let i=0,l=0;for(let h=0;h<r;h++)i+=(e[h]-u)*(t[h]-o),l+=(t[h]-o)**2;if(l===0)return 1/0;const c=i/l;return u-c*o+c*a}function zn(a){const e=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],t=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let r=0,n=a;if(a>171.6243769536076)return 1/0;if(n<=0){const h=n%1+36e-17;if(h)r=(n&1?-1:1)*Math.PI/Math.sin(Math.PI*h),n=1-n;else return 1/0}const s=n;let u=0,o;n<1?o=n++:o=(n-=u=(n|0)-1)-1;let i=0,l=0;for(let h=0;h<8;++h)i=(i+e[h])*o,l=l*o+t[h];let c=i/l+1;if(s<n)c/=s;else if(s>n)for(let h=0;h<u;++h)c*=n,n++;return r&&(c=r/c),c}function Dd(a,e,t){return a<=0?0:so(e,a/t)}function Ld(a,e,t){return a<0?0:a===0&&e===1?1/t:Math.exp((e-1)*Math.log(a)-a/t-Nt(e)-e*Math.log(t))}function Pd(a,e,t){return a<=0?0:a>=1?1/0:t*jl(a,e)}function Nt(a){const e=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let t=a,r=a+5.5;r-=(a+.5)*Math.log(r);let n=1.000000000190015;for(let s=0;s<6;s++)n+=e[s]/++t;return-r+Math.log(2.5066282746310007*n/a)}function so(a,e){if(e<0||a<=0)return Number.NaN;const t=1e-30,r=-~(Math.log(a>=1?a:1/a)*8.5+a*.4+17),n=Nt(a),s=Math.exp(-e+a*Math.log(e)-n);let u=a,o=1/a,i=o;if(e<a+1){if(s===0)return 0;for(let d=1;d<=r&&(o+=i*=e/++u,!(Math.abs(i)<Math.abs(o)*t));d++);return o*s}if(s===0)return 1;let l=e+1-a,c=1/t,h=1/l,m=h;for(let d=1;d<=r;d++){const _=-d*(d-a);if(l+=2,h=_*h+l,Math.abs(h)<t&&(h=t),c=l+_/c,Math.abs(c)<t&&(c=t),h=1/h,m*=h*c,Math.abs(h*c-1)<t)break}return 1-m*s}function jl(a,e){if(a<=0)return 0;if(a>=1)return Math.max(100,e+100*Math.sqrt(e));let t;if(e>1){const o=a<.5?a:1-a,i=Math.sqrt(-2*Math.log(o));t=(2.30753+i*.27061)/(1+i*(.99229+i*.04481))-i,a<.5&&(t=-t),t=Math.max(.001,e*(1-1/(9*e)-t/(3*Math.sqrt(e)))**3)}else{const o=1-e*(.253+e*.12);a<o?t=(a/o)**(1/e):t=1-Math.log(1-(a-o)/(1-o))}const r=1e-8,n=Nt(e);let s,u;for(let o=0;o<12;o++){if(t<=0)return 0;if(s=so(e,t)-a,e>1?u=Math.exp((e-1)*(Math.log(e-1)-1)-n)*Math.exp(-(t-(e-1))+(e-1)*(Math.log(t)-Math.log(e-1))):u=Math.exp(-t+(e-1)*Math.log(t)-n),u!==0&&(u=s/u/(1-.5*Math.min(1,s/u*((e-1)/t-1)))),t-=u,t<=0&&(t=.5*(t+u)),Math.abs(u)<r*t)break}return t}function Fd(a,e,t,r){let n=0;for(let s=0;s<=a;s++)n+=ao(s,e,t,r);return n}function ao(a,e,t,r){return e-a>r-t?0:cr(t,a)*cr(r-t,e-a)/cr(r,e)}function Bl(a,e,t){return a<0?0:.5+.5*lr((Math.log(a)-e)/Math.sqrt(2*t*t))}function jd(a,e,t){return a<=0?0:Math.exp(-Math.log(a)-.5*Math.log(2*Math.PI)-Math.log(t)-(Math.log(a)-e)**2/(2*t*t))}function Bd(a,e,t){return Math.exp(ua(a,e,t))}function kd(a,e,t){if(a<0)return 0;let r=0;for(let n=0;n<=a;n++)r+=uo(n,e,t);return r}function uo(a,e,t){return a<0?0:cr(a+e-1,e-1)*t**e*(1-t)**a}function Tn(a,e,t){return .5*(1+lr((a-e)/Math.sqrt(2*t*t)))}function kl(a,e,t){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(t)-(a-e)**2/(2*t*t))}function ua(a,e,t){return-1.4142135623730951*t*Ad(2*a)+e}function $d(a,e){let t=0;for(let r=0;r<=a;r++)t+=$l(r,e);return t}function $l(a,e){return Math.exp(-e)*e**a/Ir(a)}function In(a,e){const t=.5*aa(e/(a**2+e),e/2,.5);return a<0?t:1-t}function Yd(a,e){const t=(1+a**2/e)**(-(e+1)/2);return 1/(Math.sqrt(e)*Ju(.5,e/2))*t}function oa(a,e){let t=zu(2*Math.min(a,1-a),.5*e,.5);return t=Math.sqrt(e*(1-t)/t),a>.5?t:-t}function at(a,e,t,r,n){const s=[],u=[];let o=!0;for(let i=0;i<t;i++){const l=Math.floor(i/r),c=i%r,h=Math.floor(i/n),m=i%n,d=a.isArray()?a.get(l,c):a,_=e.isArray()?e.get(h,m):e;if(d.isError())return{isError:!0,errorObject:d,array1Values:s,array2Values:u,noCalculate:o};if(_.isError())return{isError:!0,errorObject:_,array1Values:s,array2Values:u,noCalculate:o};if(d.isNull()||_.isNull()||d.isBoolean()||_.isBoolean())continue;const C=d.getValue(),E=_.getValue();!Q(C)||!Q(E)||(s.push(+C),u.push(+E),o=!1)}return{isError:!1,errorObject:null,array1Values:s,array2Values:u,noCalculate:o}}function ia(a,e,t){const r=a.isArray()?a.getRowCount():1,n=a.isArray()?a.getColumnCount():1;let s=r,u=n;if(e&&!e.isNull()&&(s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,r===1&&u!==n||n===1&&s!==r||r!==1&&n!==1&&(s!==r||u!==n)))return{isError:!0,errorObject:f.create(g.REF)};if(t&&!t.isNull()){const o=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;if(r===1&&s>1&&o!==s||n===1&&u>1&&i!==u)return{isError:!0,errorObject:f.create(g.REF)}}return{isError:!1,errorObject:null}}function Ot(a){const e=a.isArray()?a.getRowCount():1,t=a.isArray()?a.getColumnCount():1,r=[];for(let n=0;n<e;n++){r[n]=[];for(let s=0;s<t;s++){const u=a.isArray()?a.get(n,s):a;if(u.isError()||u.isNull()||u.isBoolean()||u.isString())return f.create(g.VALUE);r[n].push(+u.getValue())}}return r}function la(a,e){const t=[];let r=1;for(let n=0;n<a;n++){t[n]=[];for(let s=0;s<e;s++)t[n].push(r++)}return t}function ca(a,e,t,r){let n=e;r&&(n=e.map(o=>Math.log(o)));let s,u;return t?{slope:s,intercept:u}=Hd(a,n):{slope:s,intercept:u}=Gd(a,n),r&&(s=Math.exp(s),u=Math.exp(u)),Number.isNaN(s)&&!t&&(s=0),{slope:s,intercept:u,Y:n}}function Hd(a,e){const t=e.length;let r=0,n=0,s=0,u=0;for(let l=0;l<t;l++)r+=a[l],n+=e[l],s+=a[l]*a[l],u+=a[l]*e[l];const o=(t*u-r*n)/(t*s-r*r),i=1/t*n-o*(1/t)*r;return{slope:o,intercept:i}}function Gd(a,e){const t=[[...a]],r=[...e];let n=t.length,s=t[0].length,u=Math.min(n,s);const o=new Array(u).fill(0);for(let l=0;l<u;l++){const c=t[l];let h=0;for(let d=0;d<s;d++)h+=c[d]**2;const m=c[l]<0?Math.sqrt(h):-Math.sqrt(h);if(o[l]=m,m!==0){c[l]-=m;for(let d=l+1;d<n;d++){let _=0;for(let C=l;C<s;C++)_-=t[d][C]*c[C];_/=m*c[l];for(let C=l;C<s;C++)t[d][C]-=_*c[C]}}}n=t.length,s=t[0].length,u=Math.min(n,s);const i=new Array(n).fill(0);for(let l=0;l<u;l++){const c=t[l];let h=0;for(let m=0;m<s;m++)h+=r[m]*c[m];h/=o[l]*c[l];for(let m=0;m<s;m++)r[m]+=h*c[m]}for(let l=o.length-1;l>=0;l--){r[l]/=o[l];const c=r[l],h=t[l];i[l]=c;for(let m=0;m<l;m++)r[m]-=c*h[m]}return{slope:i[0],intercept:0}}function ha(a,e,t,r,n){const s=a.length===1&&a[0].length>1;let u=a;n&&(u=a.map(C=>C.map(E=>Math.log(E))));let o=e,i=t;s&&(u=Rt(u),o=Rt(o),i=Rt(i)),r&&(o=o.map(C=>[...C,1]));const l=Rt(o),c=xr(l,o),h=xr(l,u);let m=Rd(c);if(!m&&(m=Od(c),!m))return f.create(g.NA);let d=xr(m,h);r||d.push([0]),d=Rt(d);const _=d[0].pop();if(d[0].reverse(),d[0].push(_),n)for(let C=0;C<d[0].length;C++)d[0][C]=Math.exp(d[0][C]);return{coefficients:d,Y:u,X:o,newX:i,XTXInverse:m}}function Yl(a){const e=[],t=[];let r=!1;for(let n=0;n<a.length;n++){const s=a[n];if(s.isReferenceObject())s.isMultiArea()?e.push(s):t.push(s);else{r=!0;break}}return{isError:r,multiAreaRefs:e,normalRefs:t}}var Ve=(a=>(a.AVERAGE="AVERAGE",a.COUNT="COUNT",a.COUNTA="COUNTA",a.MAX="MAX",a.MIN="MIN",a.PRODUCT="PRODUCT",a.STDEV="STDEV",a.STDEV_S="STDEV.S",a.STDEVP="STDEVP",a.STDEV_P="STDEV.P",a.SUM="SUM",a.VAR="VAR",a.VAR_S="VAR.S",a.VARP="VARP",a.VAR_P="VAR.P",a.MEDIAN="MEDIAN",a.MODE_SNGL="MODE.SNGL",a))(Ve||{});function Hl(a,e){const t=a[e];return t?t.hd===Ni.TRUE:!1}function Gl(a,e,t,r,n,s){const u=a.getValue(e,t);if(u!=null&&u.f||u!=null&&u.si){const o=s.getFormulaStringByCell(e,t,r,n);if(o&&(o.indexOf(`${j.SUBTOTAL}(`)>-1||o.indexOf(`${j.AGGREGATE}(`)>-1))return!0}return!1}function Xl(a,e){const t=Object.entries(a).filter(([r,{count:n}])=>n===e).sort((r,n)=>r[1].order-n[1].order).map(([r])=>+r);return A.create(t[0])}function ql(a,e){var t,r;const{type:n,ignoreRowHidden:s,ignoreErrorValues:u,ignoreNested:o,formulaDataModel:i}=a,l=[];let c=0,h=0,m=0,d=0,_=0,C=0,E=1;const p={};let y=1,b=0;for(let O=0;O<e.length;O++){const M=e[O],V=M.getFilteredOutRows(),T=M.getRowData(),x=M.getUnitId(),v=M.getSheetId(),L=(r=(t=M.getUnitData()[x])==null?void 0:t[v])==null?void 0:r.cellData;let D;if(M.iterator((Y,ee,ue)=>{if(V.includes(ee)||s&&Hl(T,ee)||o&&Gl(L,ee,ue,v,x,i))return!0;if(n==="COUNT")return Y!=null&&Y.isNumber()&&c++,!0;if(n==="COUNTA")return Y!=null&&!Y.isNull()&&h++,!0;if(Y!=null&&Y.isError())return u?!0:(D=Y,!1);if(!Y||Y.isNull()||Y.isBoolean()||Y.isString())return!0;let H=Y.getValue();if(!Q(H))return!0;if(H=+H,d++,n==="MAX")return _=d===1?H:Math.max(_,H),!0;if(n==="MIN")return C=d===1?H:Math.min(C,H),!0;if(n==="MODE.SNGL")return p[H]?(p[H].count++,p[H].count>y&&(y=p[H].count)):p[H]={count:1,order:b++},!0;m+=H,E*=H,l.push(Y)}),D!=null&&D.isError())return D}switch(n){case"AVERAGE":return d===0?f.create(g.DIV_BY_ZERO):A.create(m/d);case"COUNT":return A.create(c);case"COUNTA":return A.create(h);case"MAX":return A.create(_);case"MIN":return A.create(C);case"PRODUCT":return A.create(d===0?0:E);case"STDEV":case"STDEV.S":return d<2?f.create(g.DIV_BY_ZERO):ft([l],1,d).std(1);case"STDEVP":case"STDEV.P":return d===0?f.create(g.DIV_BY_ZERO):ft([l],1,d).std();case"SUM":return A.create(m);case"VAR":case"VAR.S":return d<2?f.create(g.DIV_BY_ZERO):ft([l],1,d).var(1);case"VARP":case"VAR.P":return d===0?f.create(g.DIV_BY_ZERO):ft([l],1,d).var();case"MEDIAN":return d===0?f.create(g.NUM):Wl(l.map(O=>+O.getValue()));case"MODE.SNGL":return b===0||y===1?f.create(g.NA):Xl(p,y);default:return f.create(g.VALUE)}}function Sr(a,e,t){var r,n;const{ignoreRowHidden:s=!1,ignoreErrorValues:u=!1,ignoreNested:o=!1}=e??{},i=[];if(a.isReferenceObject()){const l=a.getFilteredOutRows(),c=a.getRowData(),h=a.getUnitId(),m=a.getSheetId(),d=(n=(r=a.getUnitData()[h])==null?void 0:r[m])==null?void 0:n.cellData;let _;if(a.iterator((C,E,p)=>{if(l.includes(E)||s&&Hl(c,E))return!0;if(C!=null&&C.isError())return u?!0:(_=C,!1);if(o&&t&&Gl(d,E,p,m,h,t)||!C||C.isNull()||C.isBoolean()||C.isString())return!0;const y=C.getValue();if(!Q(y))return!0;i.push(+y)}),_)return _}else{const l=a.isArray()?a.getRowCount():1,c=a.isArray()?a.getColumnCount():1;for(let h=0;h<l;h++)for(let m=0;m<c;m++){const d=a.isArray()?a.get(h,m):a;if(d.isError()){if(u)continue;return d}if(!d||d.isNull()||d.isBoolean()||d.isString())continue;const _=d.getValue();Q(_)&&i.push(+_)}}return i.length===0?f.create(g.NUM):i}function Wl(a){const e=a.length;a.sort((r,n)=>r-n);let t;if(e%2===0){const r=e/2;t=(a[r-1]+a[r])/2}else t=a[Math.floor(e/2)];return A.create(t)}function Ql(a,e){if(e<1||e>a.length)return f.create(g.NUM);a.sort((r,n)=>n-r);const t=Math.ceil(e);return A.create(a[t-1])}function Kl(a,e){if(e<1||e>a.length)return f.create(g.NUM);a.sort((r,n)=>r-n);const t=Math.floor(e);return A.create(a[t-1])}function Zl(a,e){const t=a.length;if(e<0||e>1)return f.create(g.NUM);a.sort((o,i)=>o-i);const r=e*(t-1),n=Math.floor(r),s=r-n;if(s===0)return A.create(a[n]);const u=a[n]+s*(a[n+1]-a[n]);return A.create(u)}function zl(a,e){const t=a.length;if(e<1/(t+1)||e>1-1/(t+1))return f.create(g.NUM);a.sort((o,i)=>o-i);const r=e*(t+1)-1,n=Math.floor(r),s=r-n;if(s===0)return A.create(a[n]);const u=a[n]+s*(a[n+1]-a[n]);return A.create(u)}function Jl(a,e){const t=a.length;if(e<0||e>4)return f.create(g.NUM);a.sort((o,i)=>o-i);const r=e/4*(t-1),n=Math.floor(r),s=r-n;if(s===0)return A.create(a[n]);const u=a[n]+s*(a[n+1]-a[n]);return A.create(u)}function ec(a,e){const t=a.length;if(e<=0||e>=4)return f.create(g.NUM);a.sort((i,l)=>i-l);const r=e/4;if(r<1/(t+1)||r>1-1/(t+1))return f.create(g.NUM);const n=r*(t+1)-1,s=Math.floor(n),u=n-s;if(u===0)return A.create(a[s]);const o=a[s]+u*(a[s+1]-a[s]);return A.create(o)}class tc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5)}calculate(e,t,r,n,s){let u=n??A.create(0),o=s??A.create(1);u.isNull()&&(u=A.create(0)),o.isNull()&&(o=A.create(1));const i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.mapValue((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y);return this._handleSingleObject(E,b,O,M,V)});return i===1&&l===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:u,errorObject:o,variants:i}=F(e,t,r,n,s);if(u)return o;const[l,c,h,m,d]=i,_=+l.getValue(),C=+c.getValue(),E=+h.getValue(),p=+m.getValue(),y=+d.getValue();if(C<=0||E<=0||_<=0||_>=1||p>=y)return f.create(g.NUM);const b=zu(_,C,E)*(y-p)+p;return A.create(b)}}class rc extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=Math.floor(+i.getValue()),d=Math.floor(+l.getValue()),_=+c.getValue(),C=+h.getValue();if(m<0||m>d||_<0||_>1)return f.create(g.NUM);let E;return C?E=Dl(m,d,_):E=to(m,d,_),A.create(E)}}class nc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=Math.floor(+o.getValue()),h=+i.getValue(),m=+l.getValue();if(c<0||h<=0||h>=1||m<=0||m>=1)return f.create(g.NUM);let d=0;for(;d<=c&&!(Dl(d,c,h)>=m);)d++;return A.create(d)}}class sc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<0||l<1||l>10**10)return f.create(g.NUM);const c=1-ro(i,l);return A.create(c)}}class ac extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<0||i>1||l<1||l>10**10)return f.create(g.NUM);const c=Ll(1-i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class uc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if(r*n===1||s*u===1)return o.isNull()||i.isNull()?f.create(g.VALUE):f.create(g.NA);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m,r,n)}_getResult(e,t,r,n){let s=0;for(let i=0;i<e.length;i++){if(t[i]===0)return f.create(g.DIV_BY_ZERO);s+=(e[i]-t[i])**2/t[i]}let u=(r-1)*(n-1);r===1?u=n-1:n===1&&(u=r-1);const o=1-ro(s,u);return A.create(o)}}class oc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);if(c.isError())return c;if(d.isError())return d;if(_.isError())return _;const{isError:C,errorObject:E,variants:p}=F(c,d,_);if(C)return E;const[y,b,O]=p,M=+y.getValue(),V=+b.getValue(),T=Math.floor(+O.getValue());if(M<=0||M>=1||V<=0||T<1)return f.create(g.NUM);const x=Math.abs(ua(M/2,0,1)*V/Math.sqrt(T));return A.create(x)});return n===1&&s===1?l.get(0,0):l}}class ic extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return f.create(g.VALUE);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){if(e.length===0)return f.create(g.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const u=n/r,o=s/r;let i=0;for(let l=0;l<r;l++){const c=e[l]-u,h=t[l]-o;i+=c*h}return A.create(i/r)}}class lc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(c<0||h<=0)return f.create(g.NUM);let d;return m?d=vd(c,h):d=wd(c,h),A.create(d)}}class cc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=Math.floor(+l.getValue());if(c<0||h<1||h>10**10||m<1||m>10**10)return f.create(g.NUM);const d=1-no(c,h,m);return A.create(d)}}class hc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=Math.floor(+l.getValue());if(c<0||c>1||h<1||h>10**10||m<1||m>10**10)return f.create(g.NUM);const d=Pl(1-c,h,m);return Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}class mc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variance:s,ns1:u}=this._getValues(e);if(r)return n;const{isError:o,errorObject:i,variance:l,ns1:c}=this._getValues(t);if(o)return i;let h=2*(1-no(s/l,u,c));return h>1&&(h=2-h),A.create(h)}_getValues(e){let t=0,r=0;const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;if(n===1&&s===1){const c=e.isArray()?e.get(0,0):e;return c.isError()?{isError:!0,errorObject:c,variance:t,ns1:r}:c.isNull()?{isError:!0,errorObject:f.create(g.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),variance:t,ns1:r}}const u=[];let o=0;for(let c=0;c<n;c++)for(let h=0;h<s;h++){const m=e.isArray()?e.get(c,h):e;if(m.isError())return{isError:!0,errorObject:m,variance:t,ns1:r};if(m.isNull()||m.isBoolean())continue;const d=m.getValue();Q(d)&&(u.push(+d),o+=+d)}if(u.length<=1)return{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),variance:t,ns1:r};const i=o/u.length;let l=0;for(let c=0;c<u.length;c++)l+=(u[c]-i)**2;return r=u.length-1,t=l/r,t===0?{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class gc extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=+i.getValue(),d=+l.getValue(),_=+c.getValue(),C=+h.getValue();if(m<0||d<=0||_<=0)return f.create(g.NUM);let E;return C?E=Dd(m,d,_):E=Ld(m,d,_),A.create(E)}}class fc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(c<0||c>1||h<=0||m<=0)return f.create(g.NUM);const d=Pd(c,h,m);return Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}class dc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(c<=0||c>=1||m<=0)return f.create(g.NUM);const d=Bd(c,h,m);return Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}class Nc extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const u=e[s];if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}const o=u.isArray()?u.getRowCount():1,i=u.isArray()?u.getColumnCount():1;for(let l=0;l<o;l++)for(let c=0;c<i;c++){const h=u.isArray()?u.get(l,c):u;if(h.isError())return h;if(h.isNull()||h.isBoolean()||h.isString())continue;const m=h.getValue();Q(m)&&(t[+m]?(t[+m].count++,t[+m].count>n&&(n=t[+m].count)):t[+m]={count:1,order:r++})}}return r===0||n===1?new f(g.NA):Xl(t,n)}}class _c extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=+i.getValue(),d=+l.getValue(),_=+c.getValue(),C=+h.getValue();if(_<=0)return f.create(g.NUM);let E;return C?E=Tn(m,d,_):E=kl(m,d,_),A.create(E)}}class Cc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(c<=0||c>=1||m<=0)return f.create(g.NUM);const d=ua(c,h,m);return A.create(d)}}class Ec extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue();if(u<=0||u>=1)return f.create(g.NUM);const o=ua(u,0,1);return A.create(o)}}class Ac extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=+u.getValue();return Zl(e,o)}}class pc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r??A.create(3);s.isNull()&&(s=A.create(3));const u=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,t,f.create(g.NA)),l=S(u,o,s,f.create(g.NA)),c=i.mapValue((h,m,d)=>{const _=l.get(m,d);return h.isError()?h:_.isError()?_:this._handleSingleObject(n,h,_)});return u===1&&o===1?c.get(0,0):c}_handleSingleObject(e,t,r){if(e instanceof f)return e;const{isError:n,errorObject:s,variants:u}=F(t,r);if(n)return s;const[o,i]=u,l=+o.getValue(),c=Math.floor(+i.getValue()),h=e.length;if(h===0||l<e[0]||l>e[h-1])return f.create(g.NA);if(h===1)return l===e[0]?A.create(1):f.create(g.NA);let m=0,d=!1,_=0;for(;!d&&_<h;)l===e[_]?(m=_/(h-1),d=!0):l>e[_]&&_+1<h&&l<e[_+1]&&(m=(_+(l-e[_])/(e[_+1]-e[_]))/(h-1),d=!0),_++;return d?c<1?f.create(g.NUM):(m=Je(m,c),A.create(m)):f.create(g.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let u=0;u<r;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const i=o.getValue();Q(i)&&n.push(+i)}return n.sort((s,u)=>s-u)}}class yc extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=Math.floor(+o.getValue()),h=+i.getValue(),m=+l.getValue();if(c<0||h<0)return f.create(g.NUM);let d;return m?d=$d(c,h):d=$l(c,h),A.create(d)}}class bc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=Math.floor(+u.getValue());return Jl(e,o)}}class Rc extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std()}}class Sc extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class Oc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<=0||i>1||l<1||l>10**10)return f.create(g.NUM);const c=Math.abs(oa(i/2,l));return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class Mc extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u,array1Values:o,array2Values:i}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),c=this._getArrayValues(t),h=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),m=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),d=S(h,m,r,f.create(g.NA)),_=S(h,m,n,f.create(g.NA)),C=d.mapValue((E,p,y)=>{const b=_.get(p,y);if(e.isError())return e;if(t.isError())return t;if(E.isError())return E;if(b.isError())return b;const{isError:O,errorObject:M,variants:V}=F(E,b);if(O)return M;const[T,x]=V,v=Math.floor(+T.getValue()),L=Math.floor(+x.getValue());return![1,2].includes(v)||![1,2,3].includes(L)?f.create(g.NUM):L===1&&s?u:L!==1&&l instanceof f?l:L!==1&&c instanceof f?c:this._handleSingleObject(L===1?o:l,L===1?i:c,v,L)});return h===1&&m===1?C.get(0,0):C}_handleSingleObject(e,t,r,n){if(e.length<2||t.length<2)return f.create(g.DIV_BY_ZERO);const{isError:s,errorObject:u,x:o,degFreedom:i}=this._getTDistParamByArrayValues(e,t,n);if(s)return u;let l=In(-o,i);return r===2&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?f.create(g.NUM):A.create(l)}_getArrayValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let u=0;u<r;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;if(o.isNull()){if(t*r===1)return f.create(g.VALUE);continue}o.isBoolean()||o.isString()||n.push(+o.getValue())}return n}_handleArray1AndArray2(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return{isError:!0,errorObject:o,array1Values:[],array2Values:[]};let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return{isError:!0,errorObject:i,array1Values:[],array2Values:[]};if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return{isError:!0,errorObject:f.create(g.VALUE),array1Values:[],array2Values:[]};if(r*n!==s*u)return{isError:!0,errorObject:f.create(g.NA),array1Values:[],array2Values:[]};const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?{isError:!0,errorObject:c,array1Values:[],array2Values:[]}:d||h.length<2?{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:h,array2Values:m}}_getTDistParamByArrayValues(e,t,r){return r===1?this._getTDistParamByType1(e,t):r===2?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){const r=e.length;let n=0,s=0,u=0;for(let c=0;c<r;c++)n+=e[c],s+=t[c],u+=(e[c]-t[c])**2;const o=n-s,i=r*u-o**2,l=r-1;return i===0?{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(o)*Math.sqrt(l/i),degFreedom:l}}_getTDistParamByType2(e,t){const r=e.length,n=t.length;let s=0,u=0;for(let _=0;_<r;_++)s+=e[_],u+=e[_]**2;let o=0,i=0;for(let _=0;_<n;_++)o+=t[_],i+=t[_]**2;const l=u-s**2/r,c=i-o**2/n,h=Math.sqrt(l+c);if(h===0)return{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),x:0,degFreedom:0};const m=r-1+n-1,d=Math.sqrt(r*n*m/(r+n));return{isError:!1,errorObject:null,x:Math.abs(s/r-o/n)/h*d,degFreedom:m}}_getTDistParamByType3(e,t){const r=e.length,n=t.length;let s=0,u=0;for(let _=0;_<r;_++)s+=e[_],u+=e[_]**2;let o=0,i=0;for(let _=0;_<n;_++)o+=t[_],i+=t[_]**2;const l=(u-s**2/r)/(r*(r-1)),c=(i-o**2/n)/(n*(n-1));if(l+c===0)return{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),x:0,degFreedom:0};const h=l/(l+c),m=Math.abs(s/r-o/n)/Math.sqrt(l+c),d=1/(h**2/(r-1)+(1-h)**2/(n-1));return{isError:!1,errorObject:null,x:m,degFreedom:d}}}class Vc extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var()}}class Tc extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class Ic extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=+i.getValue(),d=+l.getValue(),_=+c.getValue(),C=+h.getValue();if(m<0||d<=0||_<=0)return f.create(g.NUM);const E=Math.exp(-((m/_)**d));let p;return C?p=1-E:p=d/_**d*m**(d-1)*E,Number.isNaN(p)||!Number.isFinite(p)?f.create(g.NUM):A.create(p)}}class xc extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=this._getArrayValues(e),s=Math.max(t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),o=S(s,u,t,f.create(g.NA)),i=r?S(s,u,r,f.create(g.NA)):void 0,l=o.mapValue((c,h,m)=>{if(n instanceof f)return n;if(c.isError())return c;const d=r?i.get(h,m):void 0;return d!=null&&d.isError()?d:n.length===0?f.create(g.NA):n.length===1?f.create(g.DIV_BY_ZERO):this._handleSingleObject(n,c,d)});return s===1&&u===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=+o.getValue(),l=e.length;let c=0,h=0;for(let C=0;C<l;C++)c+=e[C],h+=e[C]**2;let m=0;if(r!==void 0){const{isError:C,errorObject:E,variants:p}=F(r);if(C)return E;const[y]=p;m=+y.getValue()}else{const C=c/l;m=Math.sqrt((h-2*C*c+l*C**2)/(l-1))}if(m<=0)return f.create(g.NUM);const d=(c/l-i)/(m/Math.sqrt(l)),_=1-Tn(d,0,1);return Number.isNaN(_)||!Number.isFinite(_)?f.create(g.NUM):A.create(_)}_getArrayValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let u=0;u<n;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;if(o.isNull()||o.isBoolean()||o.isString())continue;const i=o.getValue();Q(i)&&t.push(+i)}return t}}class Xd extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5)}calculate(e,t,r,n,s){let u=n??A.create(0),o=s??A.create(1);u.isNull()&&(u=A.create(0)),o.isNull()&&(o=A.create(1));const i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.mapValue((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y);return this._handleSingleObject(E,b,O,M,V)});return i===1&&l===1?C.get(0,0):C}_handleSingleObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;const{isError:u,errorObject:o,variants:i}=F(e,t,r,n,s);if(u)return o;const[l,c,h,m,d]=i,_=+l.getValue(),C=+c.getValue(),E=+h.getValue(),p=+m.getValue(),y=+d.getValue();if(C<=0||E<=0||_<p||_>y||p===y)return f.create(g.NUM);const b=wl((_-p)/(y-p),C,E);return A.create(b)}}var he=(a=>(a.BETADIST="BETADIST",a.BETAINV="BETAINV",a.BINOMDIST="BINOMDIST",a.CHIDIST="CHIDIST",a.CHIINV="CHIINV",a.CHITEST="CHITEST",a.CONFIDENCE="CONFIDENCE",a.COVAR="COVAR",a.CRITBINOM="CRITBINOM",a.EXPONDIST="EXPONDIST",a.FDIST="FDIST",a.FINV="FINV",a.FTEST="FTEST",a.GAMMADIST="GAMMADIST",a.GAMMAINV="GAMMAINV",a.HYPGEOMDIST="HYPGEOMDIST",a.LOGINV="LOGINV",a.LOGNORMDIST="LOGNORMDIST",a.MODE="MODE",a.NEGBINOMDIST="NEGBINOMDIST",a.NORMDIST="NORMDIST",a.NORMINV="NORMINV",a.NORMSDIST="NORMSDIST",a.NORMSINV="NORMSINV",a.PERCENTILE="PERCENTILE",a.PERCENTRANK="PERCENTRANK",a.POISSON="POISSON",a.QUARTILE="QUARTILE",a.RANK="RANK",a.STDEV="STDEV",a.STDEVP="STDEVP",a.TDIST="TDIST",a.TINV="TINV",a.TTEST="TTEST",a.VAR="VAR",a.VARP="VARP",a.WEIBULL="WEIBULL",a.ZTEST="ZTEST",a))(he||{});class qd extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=Math.floor(+i.getValue()),d=Math.floor(+l.getValue()),_=Math.floor(+c.getValue()),C=Math.floor(+h.getValue());if(m<0||m>d||m>_||m<d-C+_||d<=0||d>C||_<=0||_>C||C<=0)return f.create(g.NUM);let E=ao(m,d,_,C);return Number.isNaN(E)&&(E=0),A.create(E)}}class Wd extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(c<=0||m<=0)return f.create(g.NUM);const d=Bl(c,h,m);return A.create(d)}}class Qd extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=Math.floor(+o.getValue()),h=Math.floor(+i.getValue()),m=+l.getValue();if(c<0||h<1||m<=0||m>=1)return f.create(g.NUM);const d=uo(c,h,m);return A.create(d)}}class Kd extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return e.getRowCount()===1&&e.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue(),o=Tn(u,0,1);return A.create(o)}}class Zd extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:u,refNumbers:o}=this._checkRefReferenceObject(t);let i=r??A.create(0);i.isReferenceObject()&&(i=i.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,n,f.create(g.NA)),m=S(l,c,i,f.create(g.NA)),d=h.map((_,C,E)=>{const p=m.get(C,E);if(!e.isReferenceObject()&&e.isNull())return f.create(g.NA);if(s)return u;if(p.isError())return p;const y=+_.getValue(),b=+p.getValue();if(Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);const O=o.sort((M,V)=>b?M-V:V-M).indexOf(y);return O===-1?f.create(g.NA):A.create(O+1)});return l===1&&c===1?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=f.create(g.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(s=>{const u=s;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const o=+u.getValue();if(Number.isNaN(o))return!0;n.push(o)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class zd extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=Math.floor(+l.getValue());if(c<0||h<1||h>10**10||m<1||m>2)return f.create(g.NUM);let d=In(-c,h);return m===2&&(d*=2),Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}const Uc=[[Xd,he.BETADIST],[tc,he.BETAINV],[rc,he.BINOMDIST],[sc,he.CHIDIST],[ac,he.CHIINV],[uc,he.CHITEST],[oc,he.CONFIDENCE],[ic,he.COVAR],[nc,he.CRITBINOM],[lc,he.EXPONDIST],[cc,he.FDIST],[hc,he.FINV],[mc,he.FTEST],[gc,he.GAMMADIST],[fc,he.GAMMAINV],[qd,he.HYPGEOMDIST],[Wd,he.LOGNORMDIST],[dc,he.LOGINV],[Nc,he.MODE],[Qd,he.NEGBINOMDIST],[_c,he.NORMDIST],[Cc,he.NORMINV],[Kd,he.NORMSDIST],[Ec,he.NORMSINV],[Ac,he.PERCENTILE],[pc,he.PERCENTRANK],[yc,he.POISSON],[bc,he.QUARTILE],[Zd,he.RANK],[Sc,he.STDEV],[Rc,he.STDEVP],[zd,he.TDIST],[Oc,he.TINV],[Mc,he.TTEST],[Tc,he.VAR],[Vc,he.VARP],[Ic,he.WEIBULL],[xc,he.ZTEST]],vc=[];var wc=(a=>(a.CUBEKPIMEMBER="CUBEKPIMEMBER",a.CUBEMEMBER="CUBEMEMBER",a.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",a.CUBERANKEDMEMBER="CUBERANKEDMEMBER",a.CUBESET="CUBESET",a.CUBESETCOUNT="CUBESETCOUNT",a.CUBEVALUE="CUBEVALUE",a))(wc||{});class Dc extends R{isCustom(){return!0}}class Jd extends Dc{isAsync(){return!0}}function ut(a){const e=[];if(a.isError())return{isError:!0,errorObject:a,databaseValues:e};const t=a.isArray()?a.getRowCount():1,r=a.isArray()?a.getColumnCount():1;if(t<2)return{isError:!0,errorObject:f.create(g.VALUE),databaseValues:e};for(let n=0;n<t;n++){const s=[];for(let u=0;u<r;u++){const o=a.get(n,u);if(o.isNull()){s.push(null);continue}let i=`${o.getValue()}`;if(o.isBoolean()&&(i=i.toLocaleUpperCase()),o.isNumber()||Q(i)){s.push(+i);continue}s.push(i)}e.push(s)}return{isError:!1,errorObject:null,databaseValues:e}}function ot(a,e){let t=-1;if(a.isError())return{isError:!0,errorObject:a,fieldIndex:t};const r=a.isArray()?a.getRowCount():1,n=a.isArray()?a.getColumnCount():1;if(r>1||n>1)return{isError:!0,errorObject:f.create(g.VALUE),fieldIndex:t};const s=a.isArray()?a.get(0,0):a;let u=`${s.getValue()}`;if(s.isNull()?u=0:s.isBoolean()?u=s.getValue()?1:0:(s.isNumber()||Q(u))&&(u=Math.floor(+u)),typeof u=="number"){if(u<1||u>e[0].length)return{isError:!0,errorObject:f.create(g.VALUE),fieldIndex:t};t=u-1}else if(t=e[0].findIndex(o=>o===null?!1:`${o}`.toLocaleLowerCase()===u.toLocaleLowerCase()),t===-1)return{isError:!0,errorObject:f.create(g.VALUE),fieldIndex:t};return{isError:!1,errorObject:null,fieldIndex:t}}function it(a){const e=[];if(a.isError())return{isError:!0,errorObject:a,criteriaValues:e};const t=a.isArray()?a.getRowCount():1,r=a.isArray()?a.getColumnCount():1;if(t<2)return{isError:!0,errorObject:f.create(g.VALUE),criteriaValues:e};for(let n=0;n<t;n++){const s=[];for(let u=0;u<r;u++){const o=a.get(n,u);if(o.isNull()){s.push(null);continue}const i=`${o.getValue()}`;if(o.isBoolean()){s.push(o.getValue()?1:0);continue}if(o.isNumber()||Q(i)){s.push(+i);continue}s.push(i)}e.push(s)}return{isError:!1,errorObject:null,criteriaValues:e}}function lt(a,e,t){const r=a.length,n=a[0].length,s={};let u=!1;for(let o=1;o<r;o++){let i=!0;for(let l=0;l<n;l++){const c=a[o][l];if(c===null)continue;let h=s[l];if(h===void 0){const m=a[0][l];h=e[0].findIndex(d=>d===null||m===null?!1:`${d}`.toLocaleLowerCase()===`${m}`.toLocaleLowerCase()),s[l]=h}if(h===-1&&(typeof c=="string"||c===0)){i=!1;break}else if(h>-1){const m=e[t][h];if(m===null){i=!1;break}const[d,_]=ku(`${c}`);if(!Vt.create(`${m}`).compare(_,d).getValue()){i=!1;break}}}if(i){u=!0;break}}return u}class e1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=0,_=0;for(let C=1;C<u.length;C++){const E=u[C][l];typeof E=="number"&&lt(m,u,C)&&(d+=E,_++)}return _===0?f.create(g.DIV_BY_ZERO):A.create(d/_)}}class t1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=0;for(let _=1;_<u.length;_++)typeof u[_][l]=="number"&&lt(m,u,_)&&d++;return A.create(d)}}class r1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=0;for(let _=1;_<u.length;_++)u[_][l]!=null&&lt(m,u,_)&&d++;return A.create(d)}}class n1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=0,_=0;for(let C=1;C<u.length;C++)u[C][l]!=null&&lt(m,u,C)&&(d++,_=C);return d===0?f.create(g.VALUE):d>1?f.create(g.NUM):e.get(_,l)}}class s1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=-1/0,_=0;for(let C=1;C<u.length;C++){const E=u[C][l];typeof E=="number"&&lt(m,u,C)&&(d=Math.max(d,E),_++)}return _===0?A.create(0):A.create(d)}}class a1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=1/0,_=0;for(let C=1;C<u.length;C++){const E=u[C][l];typeof E=="number"&&lt(m,u,C)&&(d=Math.min(d,E),_++)}return _===0?A.create(0):A.create(d)}}class u1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=1,_=0;for(let C=1;C<u.length;C++){const E=u[C][l];typeof E=="number"&&lt(m,u,C)&&(d*=E,_++)}return _===0?A.create(0):A.create(d)}}class o1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;const d=[];let _=0,C=0;for(let b=1;b<u.length;b++){const O=u[b][l];typeof O=="number"&&lt(m,u,b)&&(d.push(O),_+=O,C++)}if(C<=1)return f.create(g.DIV_BY_ZERO);const E=_/C;let p=0;for(let b=0;b<C;b++)p+=(d[b]-E)**2;const y=Math.sqrt(p/(C-1));return A.create(y)}}class i1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;const d=[];let _=0,C=0;for(let b=1;b<u.length;b++){const O=u[b][l];typeof O=="number"&&lt(m,u,b)&&(d.push(O),_+=O,C++)}if(C===0)return f.create(g.DIV_BY_ZERO);const E=_/C;let p=0;for(let b=0;b<C;b++)p+=(d[b]-E)**2;const y=Math.sqrt(p/C);return A.create(y)}}class l1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;let d=0;for(let _=1;_<u.length;_++){const C=u[_][l];typeof C=="number"&&lt(m,u,_)&&(d+=C)}return A.create(d)}}class c1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;const d=[];let _=0,C=0;for(let b=1;b<u.length;b++){const O=u[b][l];typeof O=="number"&&lt(m,u,b)&&(d.push(O),_+=O,C++)}if(C<=1)return f.create(g.DIV_BY_ZERO);const E=_/C;let p=0;for(let b=0;b<C;b++)p+=(d[b]-E)**2;const y=p/(C-1);return A.create(y)}}class h1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,databaseValues:u}=ut(e);if(n)return s;const{isError:o,errorObject:i,fieldIndex:l}=ot(t,u);if(o)return i;const{isError:c,errorObject:h,criteriaValues:m}=it(r);if(c)return h;const d=[];let _=0,C=0;for(let b=1;b<u.length;b++){const O=u[b][l];typeof O=="number"&&lt(m,u,b)&&(d.push(O),_+=O,C++)}if(C===0)return f.create(g.DIV_BY_ZERO);const E=_/C;let p=0;for(let b=0;b<C;b++)p+=(d[b]-E)**2;const y=p/C;return A.create(y)}}var Ge=(a=>(a.DAVERAGE="DAVERAGE",a.DCOUNT="DCOUNT",a.DCOUNTA="DCOUNTA",a.DGET="DGET",a.DMAX="DMAX",a.DMIN="DMIN",a.DPRODUCT="DPRODUCT",a.DSTDEV="DSTDEV",a.DSTDEVP="DSTDEVP",a.DSUM="DSUM",a.DVAR="DVAR",a.DVARP="DVARP",a))(Ge||{});const Lc=[[e1,Ge.DAVERAGE],[t1,Ge.DCOUNT],[r1,Ge.DCOUNTA],[n1,Ge.DGET],[s1,Ge.DMAX],[a1,Ge.DMIN],[u1,Ge.DPRODUCT],[o1,Ge.DSTDEV],[i1,Ge.DSTDEVP],[l1,Ge.DSUM],[c1,Ge.DVAR],[h1,Ge.DVARP]];class m1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.map((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);if(c.isError())return c;if(d.isError())return d;if(_.isError())return _;const{isError:C,errorObject:E,variants:p}=F(c,d,_);if(C)return E;const[y,b,O]=p;let M=Math.floor(+y.getValue());const V=Math.floor(+b.getValue()),T=Math.floor(+O.getValue());if(M<0||M>9999)return f.create(g.NUM);M>=0&&M<1899&&(M+=1900);const x=new Date(Date.UTC(M,V-1,T)),v=be(x);return v<0?f.create(g.NUM):A.create(v,fu)});return n===1&&s===1?l.get(0,0):l}}class g1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t,u=r;if(n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),u.isArray()&&(u=u.get(0,0)),n.isError())return n;if(s.isError())return s;if(u.isError())return u;const o=$(n);if(typeof o!="number")return o;const i=$(s);return typeof i!="number"?i:i<o||!u.isString()?f.create(g.NUM):this._getResultByUnit(o,i,u)}_getResultByUnit(e,t,r){const n=se(e),s=n.getUTCFullYear(),u=n.getUTCMonth()+1,o=n.getUTCDate(),i=se(t),l=i.getUTCFullYear(),c=i.getUTCMonth()+1,h=i.getUTCDate(),m=`${r.getValue()}`.toLocaleUpperCase();let d=0,_;switch(m){case"Y":d=l-s,(c<u||c===u&&h<o)&&(d-=1);break;case"M":d=(l-s)*12+c-u,h<o&&(d-=1);break;case"D":d=Math.floor(t)-Math.floor(e);break;case"MD":d=h-o,h<o&&(_=new Date(Date.UTC(l,c-1,0)),d+=En(_.getUTCFullYear(),_.getUTCMonth()));break;case"YM":d=c-u,(c<u||c===u&&h<o)&&(d+=12),h<o&&(d-=1);break;case"YD":_=new Date(Date.UTC(s,c-1,h)),(c<u||c===u&&h<o)&&(_=new Date(Date.UTC(s+1,c-1,h))),d=Math.floor(be(_))-Math.floor(e);break;default:return f.create(g.NUM)}return A.create(d)}}class f1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`;let r=us(t);if(r===null&&(r=os(t)),r){let{v:n,z:s}=r;if(s&&_u(s))return n instanceof Date&&(n=Cn(n)),A.create(Math.trunc(+n))}}return f.create(g.VALUE)}}class d1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t;const r=e.getValue();if(e.isString()){if(!Nu(`${r}`))return f.create(g.VALUE);t=new Date(`${r}`)}else{const s=+e.getValue();if(s<0)return f.create(g.NUM);if(s===0)return A.create(0);t=se(s)}const n=t.getUTCDate();return A.create(n)}}class N1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e),u=S(r,n,t),o=s.map((i,l,c)=>{const h=u.get(l,c);if(i.isError())return i;if(h.isError())return h;const m=$(i);if(typeof m!="number")return m;const d=$(h);if(typeof d!="number")return d;const _=Math.floor(m)-Math.floor(d);return A.create(_)});return r===1&&n===1?o.get(0,0):o}}class _1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??P.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.map((h,m,d)=>{const _=i.get(m,d);let C=l.get(m,d);if(h.isError())return h;const E=$(h);if(typeof E!="number")return E;if(_.isError())return _;const p=$(_);if(typeof p!="number")return p;if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;const y=+C.getValue(),{days:b}=Ee(E,p,y?4:0),O=p>=E?b:-b;return A.create(O)});return s===1&&u===1?c.get(0,0):c}}class C1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e),u=S(r,n,t);return s.map((o,i,l)=>{const c=u.get(i,l)||ce.create();if(o.isError())return o;if(c.isError())return c;if(o.isString()||o.isBoolean()||c.isString()||c.isBoolean())return f.create(g.VALUE);const h=+o.getValue();if(h<0)return f.create(g.NUM);const m=Math.floor(+c.getValue()),d=se(h),_=d.getUTCFullYear(),C=d.getUTCMonth()+m,E=d.getUTCDate(),p=new Date(Date.UTC(_,C,E)),y=be(p);return A.create(y,fu)})}}class E1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){const m=r.getRowCount(),d=r.getColumnCount();if(m>1||d>1)return f.create(g.VALUE);r=r.get(0,0)}if(n.isArray()){const m=n.getRowCount(),d=n.getColumnCount();if(m>1||d>1)return f.create(g.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;const s=$(r);if(typeof s!="number")return s;if(n.isBoolean())return f.create(g.VALUE);const u=se(s),o=s>0?u.getUTCFullYear():1900,i=s>0?u.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return f.create(g.VALUE);const c=new Date(Date.UTC(o,i+l+1,0)),h=be(c);return A.create(h)}}class A1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2),N(this,"needsReferenceObject",!0)}calculate(e,t){const r=t??A.create(1),{isError:n,errorObject:s,timestampIsReferenceObject:u,timestampObject:o,unitObject:i}=this._checkVariants(e,r);if(n)return s;if(o.isNull()||o.isBoolean()||o.isString()||!u&&o.isNumber()&&o.getPattern()!=="")return f.create(g.VALUE);let l=+o.getValue();const{isError:c,errorObject:h,variants:m}=F(i);if(c)return h;const[d]=m,_=Math.floor(+d.getValue());if(l<0||_<1||_>3)return f.create(g.NUM);_===1&&(l=l*1e3),_===3&&(l=l/1e3);const C=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(C.getTime())){const E=25569+l/864e5;return A.create(E)}else{const E=Cn(C);return A.create(E,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){const r=e.isReferenceObject(),n=t.isReferenceObject();let s=e;if(r&&(s=e.toArrayValueObject()),s.isArray()){const o=s.getRowCount(),i=s.getColumnCount();if(o>1||i>1)return{isError:!0,errorObject:f.create(g.VALUE)};s=s.get(0,0)}if(s.isError())return{isError:!0,errorObject:s};let u=t;if(n&&(u=t.toArrayValueObject()),u.isArray()){const o=u.getRowCount(),i=u.getColumnCount();if(o>1||i>1)return{isError:!0,errorObject:f.create(g.VALUE)};u=u.get(0,0)}return u.isError()?{isError:!0,errorObject:u}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:s,unitIsReferenceObject:n,unitObject:u}}}class p1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return A.create(0);const r=du(t).getUTCHours();return A.create(r)}}class y1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;const r=se(t),n=t>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),u=be(s),o=gr(u),i;o<1?i=u+1:o<=4?i=u-(o-1):i=u+(11-o),t<i&&(s=new Date(Date.UTC(n-1,0,1)),u=be(s),o=gr(u),o<1?i=u+1:o<=4?i=u-(o-1):i=u+(11-o));const l=Math.ceil((t-i+1)/7);return A.create(l)}}class b1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return A.create(0);const r=du(t).getUTCMinutes();return A.create(r)}}class R1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!Nu(`${r}`))return f.create(g.VALUE);t=new Date(`${r}`)}else{const s=+e.getValue();if(s<0)return f.create(g.NUM);if(s===0)return A.create(1);t=se(s)}const n=t.getUTCMonth()+1;return A.create(n)}}class S1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),c=n.getColumnCount();if(l>1||c>1)return f.create(g.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),c=s.getColumnCount();if(l>1||c>1)return f.create(g.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return f.create(g.VALUE);const u=$(n);if(typeof u!="number")return u;const o=$(s);if(typeof o!="number")return o;if(r)return this._getResultByHolidays(u,o,r);const i=is(u,o);return A.create(i)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const u=r.getRowCount(),o=r.getColumnCount();for(let i=0;i<u;i++)for(let l=0;l<o;l++){const c=r.get(i,l);if(c.isBoolean())return f.create(g.VALUE);const h=$(c);if(typeof h!="number")return h;n.push(h)}}else{if(r.isBoolean())return f.create(g.VALUE);const u=$(r);if(typeof u!="number")return u;n.push(u)}const s=is(e,t,1,n);return A.create(s)}}class O1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let s=e,u=t;if(s.isArray()){const h=s.getRowCount(),m=s.getColumnCount();if(h>1||m>1)return f.create(g.VALUE);s=s.get(0,0)}if(s.isError())return s;if(u.isArray()){const h=u.getRowCount(),m=u.getColumnCount();if(h>1||m>1)return f.create(g.VALUE);u=u.get(0,0)}if(u.isError())return u;let o=1;if(r){if(o=r.getValue(),r.isBoolean()&&(o=+o),r.isString()&&!rn(o))return f.create(g.VALUE);if(!rn(o))return f.create(g.NUM)}if(s.isBoolean()||u.isBoolean())return f.create(g.VALUE);const i=$(s);if(typeof i!="number")return i;const l=$(u);if(typeof l!="number")return l;if(n)return this._getResultByHolidays(i,l,o,n);const c=is(i,l,o);return A.create(c)}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const o=n.getRowCount(),i=n.getColumnCount();for(let l=0;l<o;l++)for(let c=0;c<i;c++){const h=n.get(l,c);if(h.isBoolean())return f.create(g.VALUE);const m=$(h);if(typeof m!="number")return m;s.push(m)}}else{if(n.isBoolean())return f.create(g.VALUE);const o=$(n);if(typeof o!="number")return o;s.push(o)}const u=is(e,t,r,s);return A.create(u)}}class M1 extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){const e=new Date,t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())),r=Cn(t);return A.create(r,nm)}}class V1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(t=>t.isError()?t:this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=$(e);if(typeof t!="number")return t;if(t===0)return A.create(0);const r=du(t).getUTCSeconds();return A.create(r)}}class T1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e),o=S(n,s,t),i=S(n,s,r);return u.map((l,c,h)=>this._calculateTime(l,o,i,c,h))}_calculateTime(e,t,r,n,s){let u=e,o=t.get(n,s)||ce.create(),i=r.get(n,s)||ce.create();if((u.isString()||u.isBoolean())&&(u=u.convertToNumberObjectValue()),(o.isString()||o.isBoolean())&&(o=o.convertToNumberObjectValue()),(i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),u.isError())return u;if(o.isError())return o;if(i.isError())return i;let l=Math.floor(+u.getValue()),c=Math.floor(+o.getValue()),h=Math.floor(+i.getValue());if(l<0||c<0||h<0||l>32767||c>32767||h>32767)return f.create(g.NUM);c+=Math.floor(h/60),h%=60,l+=Math.floor(c/60),c%=60,l%=24;const m=(l*3600+c*60+h)/86400;return A.create(m,sm)}}class I1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isString()){const t=`${e.getValue()}`,r=js(t);if(r){let{v:n,z:s}=r;if(s&&_u(s))return n instanceof Date&&(n=Cn(n)),A.create(Sf(+n))}}return f.create(g.VALUE)}}class x1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0)}calculate(e){const t=e.isReferenceObject();let r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){const s=r.getRowCount(),u=r.getColumnCount();if(s>1||u>1)return f.create(g.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&r.getPattern()!=="")return r;const n=+r.getValue();return A.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}}class U1 extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){const e=new Date,t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())),r=be(t);return A.create(r,fu)}}class v1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2),N(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){const r=t??A.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.map((l,c,h)=>{const m=o.get(c,h);return this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;const n=$(e);if(typeof n!="number")return n;if(r.isString()&&(r=r.convertToNumberObjectValue(),r.isError()))return r;const s=Math.floor(+r.getValue());if(!this._returnTypeMap[s])return f.create(g.NUM);const u=gr(n),o=this._returnTypeMap[s][u];return A.create(o)}}class w1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2),N(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=t??A.create(1);if(r.isArray()){const o=r.getRowCount(),i=r.getColumnCount();if(o>1||i>1)return f.create(g.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){const o=n.getRowCount(),i=n.getColumnCount();if(o>1||i>1)return f.create(g.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return f.create(g.VALUE);const s=$(r);if(typeof s!="number")return s;if(n.isBoolean())return f.create(g.VALUE);const u=Math.floor(+n.getValue());return Number.isNaN(u)?f.create(g.VALUE):u in this._returnTypeMap?this._getResult(s,u):f.create(g.NUM)}_getResult(e,t){const r=se(e),n=e>0?r.getUTCFullYear():1900;let s=new Date(Date.UTC(n,0,1)),u=be(s),o=gr(u),i;if(t===21)o<1?i=u+1:o<=4?i=u-(o-1):i=u+(11-o),e<i&&(s=new Date(Date.UTC(n-1,0,1)),u=be(s),o=gr(u),o<1?i=u+1:o<=4?i=u-(o-1):i=u+(11-o));else{const c=this._returnTypeMap[t];o<c?i=u-(o+7-c):i=u-(o-c)}const l=Math.ceil((e-i+1)/7);return A.create(l)}}class D1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){let n=e,s=t;if(n.isArray()){const l=n.getRowCount(),c=n.getColumnCount();if(l>1||c>1)return f.create(g.VALUE);n=n.get(0,0)}if(n.isError())return n;if(s.isArray()){const l=s.getRowCount(),c=s.getColumnCount();if(l>1||c>1)return f.create(g.VALUE);s=s.get(0,0)}if(s.isError())return s;if(r!=null&&r.isError())return r;if(n.isBoolean()||s.isBoolean())return f.create(g.VALUE);const u=$(n);if(typeof u!="number")return u;const o=+s.getValue();if(Number.isNaN(o))return f.create(g.VALUE);if(r)return this._getResultByHolidays(u,o,r);const i=ls(u,o);return typeof i!="number"?i:A.create(i)}_getResultByHolidays(e,t,r){const n=[];if(r!=null&&r.isArray()){const u=r.getRowCount(),o=r.getColumnCount();for(let i=0;i<u;i++)for(let l=0;l<o;l++){const c=r.get(i,l);if(c.isBoolean())return f.create(g.VALUE);const h=$(c);if(typeof h!="number")return h;n.push(h)}}else{if(r.isBoolean())return f.create(g.VALUE);const u=$(r);if(typeof u!="number")return u;n.push(u)}const s=ls(e,t,1,n);return typeof s!="number"?s:A.create(s)}}class L1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:r!=null&&r.isError()?r:n!=null&&n.isError()?n:r!=null&&r.isArray()?r.map(s=>this._handleSingleObject(e,t,s,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){const s=r??A.create(1),u=this._checkArrayError(e);if(u.isError())return u;const o=this._checkArrayError(t);if(o.isError())return o;if(u.isBoolean()||o.isBoolean())return f.create(g.VALUE);const i=$(e);if(typeof i!="number")return i;const l=+t.getValue();if(Number.isNaN(l))return f.create(g.VALUE);let c=s.getValue();if(s.isBoolean()&&(c=+c),s.isString()&&(!rn(c)||c==="1111111"))return f.create(g.VALUE);if(!rn(c))return f.create(g.NUM);if(n)return this._getResultByHolidays(i,l,c,n);const h=ls(i,l,c);return typeof h!="number"?h:A.create(h)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return f.create(g.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){const s=[];if(n!=null&&n.isArray()){const o=n.getRowCount(),i=n.getColumnCount();for(let l=0;l<o;l++)for(let c=0;c<i;c++){const h=n.get(l,c);if(h.isBoolean())return f.create(g.VALUE);const m=$(h);if(typeof m!="number")return m;s.push(m)}}else{if(n.isBoolean())return f.create(g.VALUE);const o=$(n);if(typeof o!="number")return o;s.push(o)}const u=ls(e,t,r,s);return typeof u!="number"?u:A.create(u)}}class P1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t;const r=e.getValue();if(e.isString()){if(!Nu(`${r}`))return f.create(g.VALUE);t=new Date(`${r}`)}else{const s=+r;if(s<0)return f.create(g.NUM);if(s===0)return A.create(1900);t=se(s)}const n=t.getUTCFullYear();return A.create(n)}}class F1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){let n=r??A.create(0);const s=ir(e);if(s.isError())return s;const u=ir(t);if(u.isError())return u;if(n=ir(n),n.isError())return n;if(s.isBoolean()||u.isBoolean()||n.isBoolean())return f.create(g.VALUE);const o=$(s);if(typeof o!="number")return o;const i=$(u);if(typeof i!="number")return i;const l=Math.floor(+n.getValue());if(Number.isNaN(l))return f.create(g.VALUE);if(l<0||l>4)return f.create(g.NUM);const{days:c,yearDays:h}=Ee(o,i,l),m=c/h;return A.create(m)}}const Pc=[[m1,_e.DATE],[g1,_e.DATEDIF],[f1,_e.DATEVALUE],[d1,_e.DAY],[N1,_e.DAYS],[_1,_e.DAYS360],[C1,_e.EDATE],[E1,_e.EOMONTH],[A1,_e.EPOCHTODATE],[p1,_e.HOUR],[y1,_e.ISOWEEKNUM],[b1,_e.MINUTE],[R1,_e.MONTH],[S1,_e.NETWORKDAYS],[O1,_e.NETWORKDAYS_INTL],[M1,_e.NOW],[V1,_e.SECOND],[T1,_e.TIME],[I1,_e.TIMEVALUE],[x1,_e.TO_DATE],[U1,_e.TODAY],[v1,_e.WEEKDAY],[w1,_e.WEEKNUM],[D1,_e.WORKDAY],[L1,_e.WORKDAY_INTL],[P1,_e.YEAR],[F1,_e.YEARFRAC]];class j1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);const c=kr.besseli(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class B1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);const c=kr.besselj(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class k1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);const c=kr.besselk(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class $1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);const c=kr.bessely(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class Y1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`;if(!qu(u))return f.create(g.NUM);let o;return u.length===10&&u.substring(0,1)==="1"?o=Number.parseInt(u.substring(1),2)-512:o=Number.parseInt(u,2),A.create(o)}}class H1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:c,errorObject:h,variants:m}=G(t);if(c)return h;const[d]=m;if(r=Math.floor(+d.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!qu(i))return f.create(g.NUM);let l;if(i.length===10&&i.substring(0,1)==="1")l=(0xfffffffe00+Number.parseInt(i.substring(1),2)).toString(16);else if(l=Number.parseInt(i,2).toString(16),t){if(r<l.length)return f.create(g.NUM);l="0".repeat(r-l.length)+l}return w.create(l.toLocaleUpperCase())}}class G1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:c,errorObject:h,variants:m}=G(t);if(c)return h;const[d]=m;if(r=Math.floor(+d.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!qu(i))return f.create(g.NUM);let l;if(i.length===10&&i.substring(0,1)==="1")l=(1073741312+Number.parseInt(i.substring(1),2)).toString(8);else if(l=Number.parseInt(i,2).toString(8),t){if(r<l.length)return f.create(g.NUM);l="0".repeat(r-l.length)+l}return w.create(l)}}class X1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=u.get(l,c);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue(),_=+m.getValue();if(d<0||_<0||Math.floor(d)!==d||Math.floor(_)!==_||d>0xffffffffffff||_>0xffffffffffff)return f.create(g.NUM);const C=d&_;return A.create(C)});return r===1&&n===1?o.get(0,0):o}}class q1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=u.get(l,c);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue();let _=+m.getValue();if(d<0||Math.floor(d)!==d||d>0xffffffffffff||Math.abs(_)>53)return f.create(g.NUM);_=Math.trunc(_);const C=Number(_>=0?BigInt(d)<<BigInt(_):BigInt(d)>>BigInt(-_));return C>0xffffffffffff?f.create(g.NUM):A.create(C)});return r===1&&n===1?o.get(0,0):o}}class W1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=u.get(l,c);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue(),_=+m.getValue();if(d<0||_<0||Math.floor(d)!==d||Math.floor(_)!==_||d>0xffffffffffff||_>0xffffffffffff)return f.create(g.NUM);const C=Number(BigInt(d)|BigInt(_));return A.create(C)});return r===1&&n===1?o.get(0,0):o}}class Q1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=u.get(l,c);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue();let _=+m.getValue();if(d<0||Math.floor(d)!==d||d>0xffffffffffff||Math.abs(_)>53)return f.create(g.NUM);_=Math.trunc(_);const C=Number(_>=0?BigInt(d)>>BigInt(_):BigInt(d)<<BigInt(-_));return C>0xffffffffffff?f.create(g.NUM):A.create(C)});return r===1&&n===1?o.get(0,0):o}}class K1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=u.get(l,c);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue(),_=+m.getValue();if(d<0||_<0||Math.floor(d)!==d||Math.floor(_)!==_||d>0xffffffffffff||_>0xffffffffffff)return f.create(g.NUM);const C=d^_;return A.create(C)});return r===1&&n===1?o.get(0,0):o}}U.prototype.cos=function(){const a=this.toNumber();return new U(Math.cos(a))};let fe=class le{constructor(e){if(N(this,"_inumber",""),N(this,"_realNum",0),N(this,"_iNum",0),N(this,"_suffix",""),N(this,"_isError",!1),`${e}`.trim()===""){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){const n=new U(e).toSignificantDigits(15).toNumber(),s=new U(t).toSignificantDigits(15).toNumber(),u=r===""?"i":r;let o;if(n===0&&s===0)o=0;else if(n===0)o=s===1?u:`${s}${u}`;else if(s===0)o=n;else{const i=s>0?"+":"",l=s===1?u:`${s}${u}`;o=`${n}${i}${l}`}return o}static createByComplexStr(e,t,r){const n=le.getComplex(e,t,r);return new le(n)}_getImReal(){if(this._inumber===0||this._inumber==="0"){this._realNum=0;return}const e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");t===0&&(t=e.indexOf("+",1)),r===0&&(r=e.indexOf("-",1));const n=e.substring(e.length-1,e.length),s=n==="i"||n==="j";if(t>=0||r>=0){if(!s){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else s?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(this._inumber===0||this._inumber==="0"){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j");let t=e.indexOf("+"),r=e.indexOf("-");t===0&&(t=e.indexOf("+",1)),r===0&&(r=e.indexOf("-",1));const n=e.substring(e.length-1,e.length),s=n==="i"||n==="j";if(t>=0||r>=0){if(!s){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-+e.substring(r+1,e.length-1)}else s?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){const e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix=t==="i"||t==="j"?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return le.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){const t=e.getSuffix();return this._suffix===""||t===""?!1:this._suffix!==t}Abs(){return U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){const e=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2)));let t=U.acos(new U(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return le.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){const e=U.cos(this._realNum).mul(U.cosh(this._iNum)).toNumber(),t=U.sin(this._realNum).mul(U.sinh(this._iNum)).negated().toNumber();return le.getComplex(e,t,this._suffix)}else{const e=U.cos(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const e=U.cosh(this._realNum).mul(U.cos(this._iNum)).toNumber(),t=U.sinh(this._realNum).mul(U.sin(this._iNum)).toNumber();return le.getComplex(e,t,this._suffix)}else{const e=U.cosh(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Cot(){if(this._iNum){const e=U.cosh(this._iNum*2).sub(U.cos(this._realNum*2)),t=U.sin(this._realNum*2).div(e).toNumber(),r=U.sinh(this._iNum*2).div(e).negated().toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.tan(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const e=U.cosh(this._realNum*2).sub(U.cos(this._iNum*2)),t=U.sinh(this._realNum*2).div(e).toNumber(),r=U.sin(this._iNum*2).div(e).negated().toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.tanh(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Csc(){if(this._iNum){const e=U.cosh(this._iNum*2).sub(U.cos(this._realNum*2)),t=U.sin(this._realNum).mul(U.cosh(this._iNum)).mul(2).div(e).toNumber(),r=U.cos(this._realNum).mul(U.sinh(this._iNum)).mul(-2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.sin(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return le.getComplex(0,0,this._suffix);if(this._iNum){const e=U.cosh(this._realNum*2).sub(U.cos(this._iNum*2)),t=U.sinh(this._realNum).mul(U.cos(this._iNum)).mul(2).div(e).toNumber(),r=U.cosh(this._realNum).mul(U.sin(this._iNum)).mul(-2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.sinh(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Div(e){const t=new U(this._realNum),r=new U(this._iNum),n=new U(e.getRealNum()),s=new U(e.getINum()),u=n.mul(n).add(s.mul(s)),o=t.mul(n).add(r.mul(s)).div(u).toNumber(),i=r.mul(n).sub(t.mul(s)).div(u).toNumber(),l=this._suffix===""?e.getSuffix():this._suffix;return le.getComplex(o,i,l)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";const e=U.exp(this._realNum).mul(U.cos(this._iNum)).toNumber(),t=U.exp(this._realNum).mul(U.sin(this._iNum)).toNumber();return le.getComplex(e,t,this._suffix)}Ln(){const e=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),t=U.ln(e).toNumber(),r=U.acos(new U(this._realNum).div(e)).toNumber();return le.getComplex(t,r,this._suffix)}Log(e){const t=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),r=U.ln(t);let n=U.acos(new U(this._realNum).div(t));this._iNum<0&&(n=n.negated());const s=U.ln(e),u=new U(0),o=s.mul(s).add(u.mul(u));if(o.eq(0))return this._isError=!0,"";const i=r.mul(s).add(n.mul(u)).div(o).toNumber(),l=n.mul(s).sub(r.mul(u)).div(o).toNumber();return le.getComplex(i,l,this._suffix)}Power(e){if(this._realNum===0&&this._iNum===0)return e>0?le.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let t=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),r=U.acos(new U(this._realNum).div(t));this._iNum<0&&(r=r.negated()),t=U.pow(t,e),r=r.mul(e);const n=U.cos(r).mul(t).toNumber(),s=U.sin(r).mul(t).toNumber();return!Number.isFinite(n)||!Number.isFinite(s)?(this._isError=!0,""):le.getComplex(n,s,this._suffix)}Product(e){const t=new U(this._realNum),r=new U(this._iNum),n=new U(e.getRealNum()),s=new U(e.getINum()),u=t.mul(n).sub(r.mul(s)).toNumber(),o=t.mul(s).add(r.mul(n)).toNumber(),i=this._suffix===""?e.getSuffix():this._suffix;return le.getComplex(u,o,i)}Sec(){if(this._iNum){const e=U.cosh(this._iNum*2).add(U.cos(this._realNum*2)),t=U.cos(this._realNum).mul(U.cosh(this._iNum)).mul(2).div(e).toNumber(),r=U.sin(this._realNum).mul(U.sinh(this._iNum)).mul(2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.cos(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(this._realNum*2))||!Number.isFinite(Math.cosh(this._realNum*2)))return le.getComplex(0,0,this._suffix);if(this._iNum){const e=U.cosh(this._realNum*2).add(U.cos(this._iNum*2)),t=U.cosh(this._realNum).mul(U.cos(this._iNum)).mul(2).div(e).toNumber(),r=U.sinh(this._realNum).mul(U.sin(this._iNum)).mul(-2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=new U(1).div(U.cosh(this._realNum)).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Sin(){if(this._iNum){const e=U.sin(this._realNum).mul(U.cosh(this._iNum)).toNumber(),t=U.cos(this._realNum).mul(U.sinh(this._iNum)).toNumber();return le.getComplex(e,t,this._suffix)}else{const e=U.sin(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const e=U.sinh(this._realNum).mul(U.cos(this._iNum)).toNumber(),t=U.cosh(this._realNum).mul(U.sin(this._iNum)).toNumber();return le.getComplex(e,t,this._suffix)}else{const e=U.sinh(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Sqrt(){const e=U.sqrt(U.pow(this._realNum,2).add(U.pow(this._iNum,2))),t=U.sqrt(e);let r=U.acos(new U(this._realNum).div(e));this._iNum<0&&(r=r.negated());const n=t.mul(U.cos(r.div(2).toNumber())).toNumber(),s=t.mul(U.sin(r.div(2))).toNumber();return le.getComplex(n,s,this._suffix)}Sub(e){const t=new U(this._realNum),r=new U(this._iNum),n=new U(e.getRealNum()),s=new U(e.getINum()),u=t.sub(n).toNumber(),o=r.sub(s).toNumber(),i=this._suffix===""?e.getSuffix():this._suffix;return le.getComplex(u,o,i)}Sum(e){const t=new U(this._realNum),r=new U(this._iNum),n=new U(e.getRealNum()),s=new U(e.getINum()),u=t.add(n).toNumber(),o=r.add(s).toNumber(),i=this._suffix===""?e.getSuffix():this._suffix;return le.getComplex(u,o,i)}Tan(){if(this._iNum){const e=U.cos(this._realNum*2).add(U.cosh(this._iNum*2)),t=U.sin(this._realNum*2).div(e).toNumber(),r=U.sinh(this._iNum*2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=U.tan(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){const e=U.cosh(this._realNum*2).add(U.cos(this._iNum*2)),t=U.sinh(this._realNum*2).div(e).toNumber(),r=U.sin(this._iNum*2).div(e).toNumber();return le.getComplex(t,r,this._suffix)}else{const e=U.tanh(this._realNum).toNumber();return le.getComplex(e,this._iNum,this._suffix)}}};class Z1 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??w.create("i"),{isError:s,errorObject:u,variants:o}=G(e,t,n);if(s)return u;const[i,l,c]=o,h=+i.getValue(),m=+l.getValue(),d=`${c.getValue()}`;if(Number.isNaN(h)||Number.isNaN(m)||d!=="i"&&d!=="j")return f.create(g.VALUE);const _=fe.getComplex(h,m,d);return typeof _=="number"?A.create(_):w.create(_)}}class z1 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3),N(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ångström","Å",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ångström","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,416818182544058e-5],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","°",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519538e-3],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["œrsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Ω",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestärke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ångström","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988110336e-6],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]]),N(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,1152921504606847e3,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),N(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){const{isError:n,errorObject:s,variants:u}=G(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=`${i.getValue()}`,m=`${l.getValue()}`;if(Number.isNaN(c))return f.create(g.VALUE);let d,_=1,C,E=1;const{_from:p,_to:y}=this._lookupFromAndToUnits(h,m);if(d=p,C=y,d===null){const{_from:O,_fromMultiplier:M}=this._lookupFromPrefix(h);d=O,_=M}if(C===null){const{_to:O,_toMultiplier:M}=this._lookupToPrefix(m);C=O,E=M}if(d===null||C===null||d[3]!==C[3])return f.create(g.NA);let b;return d[3]==="temperature"?(b=this._getTemperatureConversion(c,d[1],C[1]),b=+b.toFixed(2)):b=c*d[6]*_/(C[6]*E),A.create(b)}_lookupFromAndToUnits(e,t){let r=null,n=null,s;for(let u=0;u<this._units.length;u++)s=this._units[u][2]===null?[]:this._units[u][2],(this._units[u][1]===e||s.indexOf(e)>=0)&&(r=this._units[u]),(this._units[u][1]===t||s.indexOf(t)>=0)&&(n=this._units[u]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,s;const u=this._binaryPrefixes[e.substring(0,2)];let o=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(o=["dekao",10,"da"]),u?(r=u[2],n=e.substring(2)):o&&(r=o[1],n=e.substring(o[2].length));for(let i=0;i<this._units.length;i++)s=this._units[i][2]===null?[]:this._units[i][2],(this._units[i][1]===n||s.indexOf(n)>=0)&&(t=this._units[i]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,s;const u=this._binaryPrefixes[e.substring(0,2)];let o=this._unitPrefixes[e.substring(0,1)];e.substring(0,2)==="da"&&(o=["dekao",10,"da"]),u?(r=u[2],n=e.substring(2)):o&&(r=o[1],n=e.substring(o[2].length));for(let i=0;i<this._units.length;i++)s=this._units[i][2]===null?[]:this._units[i][2],(this._units[i][1]===n||s.indexOf(n)>=0)&&(t=this._units[i]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return e*9/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return e*4/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return e*9/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return e*5/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return e*5/4;case"F":return e*9/4+32;case"K":return e*5/4+273.15;case"Rank":return e*9/4+491.67;default:return e}}}class J1 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:c,errorObject:h,variants:m}=G(t);if(c)return h;const[d]=m;if(r=Math.floor(+d.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=Math.trunc(+o.getValue());if(Number.isNaN(i))return f.create(g.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${i}`)||i<-512||i>511)return f.create(g.NUM);let l;if(i<0){const c=(512+i).toString(2);l=`1${"0".repeat(9-c.length)}${c}`}else if(l=Number.parseInt(`${i}`,10).toString(2),t){if(r<l.length)return f.create(g.NUM);l="0".repeat(r-l.length)+l}return w.create(l)}}class e0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:c,errorObject:h,variants:m}=G(t);if(c)return h;const[d]=m;if(r=Math.floor(+d.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=Math.trunc(+o.getValue());if(Number.isNaN(i))return f.create(g.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${i}`)||i<-549755813888||i>549755813887)return f.create(g.NUM);let l;if(i<0)l=(1099511627776+i).toString(16);else if(l=Number.parseInt(`${i}`,10).toString(16),t){if(r<l.length)return f.create(g.NUM);l="0".repeat(r-l.length)+l}return w.create(l.toLocaleUpperCase())}}class t0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:c,errorObject:h,variants:m}=G(t);if(c)return h;const[d]=m;if(r=Math.floor(+d.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=Math.trunc(+o.getValue());if(Number.isNaN(i))return f.create(g.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${i}`)||i<-536870912||i>536870911)return f.create(g.NUM);let l;if(i<0)l=(1073741824+i).toString(8);else if(l=Number.parseInt(`${i}`,10).toString(8),t){if(r<l.length)return f.create(g.NUM);l="0".repeat(r-l.length)+l}return w.create(l)}}class r0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(0),{isError:n,errorObject:s,variants:u}=G(e,r);if(n)return s;const[o,i]=u,l=+o.getValue(),c=+i.getValue();if(Number.isNaN(l)||Number.isNaN(c))return f.create(g.VALUE);const h=l===c?1:0;return A.create(h)}}class n0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){let r;if(t){const{isError:n,errorObject:s,variants:u}=G(e,t);if(n)return s;const[o,i]=u,l=+o.getValue(),c=+i.getValue();if(Number.isNaN(l)||Number.isNaN(c))return f.create(g.VALUE);r=lr(c)-lr(l)}else{const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=+o.getValue();if(Number.isNaN(i))return f.create(g.VALUE);r=lr(i)}return A.create(r)}}class s0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=+s.getValue();if(Number.isNaN(u))return f.create(g.VALUE);const o=lr(u);return A.create(o)}}class a0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=+s.getValue();if(Number.isNaN(u))return f.create(g.VALUE);const o=Ku(u);return A.create(o)}}class u0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=+s.getValue();if(Number.isNaN(u))return f.create(g.VALUE);const o=Ku(u);return A.create(o)}}class o0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);const r=t??A.create(0),{isError:n,errorObject:s,variants:u}=G(e,r);if(n)return s;const[o,i]=u,l=+o.getValue(),c=+i.getValue();if(Number.isNaN(l)||Number.isNaN(c))return f.create(g.VALUE);const h=l>=c?1:0;return A.create(h)}}class i0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:_}=G(t);if(m)return d;const[C]=_;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!Qu(i))return f.create(g.NUM);const l=i.length===10&&i.substring(0,1).toLocaleUpperCase()==="F",c=l?Number.parseInt(i,16)-1099511627776:Number.parseInt(i,16);if(c<-512||c>511)return f.create(g.NUM);let h;if(l){const m=(512+c).toString(2);h=`1${"0".repeat(9-m.length)}${m}`}else if(h=c.toString(2),t){if(r<h.length)return f.create(g.NUM);h="0".repeat(r-h.length)+h}return w.create(h)}}class l0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`;if(!Qu(u))return f.create(g.NUM);let o=Number.parseInt(u,16);return o>=549755813888&&(o-=1099511627776),A.create(o)}}class c0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:h,errorObject:m,variants:d}=G(t);if(h)return m;const[_]=d;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!Qu(i))return f.create(g.NUM);const l=Number.parseInt(i,16);if(l>536870911&&l<0xffe0000000)return f.create(g.NUM);let c;if(l>=0xffe0000000)c=(l-0xffc0000000).toString(8);else if(c=l.toString(8),t){if(r<c.length)return f.create(g.NUM);c="0".repeat(r-c.length)+c}return w.create(c)}}class h0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Abs();return A.create(i)}}class m0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.getINum();return A.create(i)}}class g0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);if(o.getRealNum()===0&&o.getINum()===0)return f.create(g.DIV_BY_ZERO);const i=o.Argument();return A.create(i)}}class f0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Conjugate();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class d0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Cos();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class N0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Cosh();return o.isError()?f.create(g.NUM):typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class _0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Cot();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class C0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Coth();return o.isError()?f.create(g.NUM):typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class E0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Csc();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class A0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Csch();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class p0 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=`${u.getValue()}`,l=`${o.getValue()}`,c=new fe(i),h=new fe(l);if(c.isError()||h.isError()||c.isDifferentSuffixes(h)||h.getRealNum()===0&&h.getINum()===0)return f.create(g.NUM);const m=c.Div(h);return typeof m=="number"||Q(m)?A.create(+m):w.create(m)}}class y0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Exp();return o.isError()?f.create(g.NUM):typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class b0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Ln();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class R0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e);if(r)return n;const[u]=s;let o=t??A.create(10);if(o.isArray()){const E=o.getRowCount(),p=o.getColumnCount();if(E>1||p>1)return f.create(g.VALUE);o=o.get(0,0)}const{isError:i,errorObject:l,variants:c}=F(o);if(i)return l;const[h]=c,m=`${u.getValue()}`,d=+h.getValue(),_=new fe(m);if(_.isError()||_.getRealNum()===0&&_.getINum()===0||d<=0)return f.create(g.NUM);const C=_.Log(d);return _.isError()?f.create(g.NUM):typeof C=="number"||Q(C)?A.create(+C):w.create(C)}}class S0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Log(2);return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class O0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError()||o.getRealNum()===0&&o.getINum()===0)return f.create(g.NUM);const i=o.Log(10);return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class M0 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=`${u.getValue()}`,l=new fe(i);if(l.isError())return f.create(g.NUM);const c=+o.getValue();if(Number.isNaN(c))return f.create(g.VALUE);const h=l.Power(c);return l.isError()?f.create(g.NUM):typeof h=="number"||Q(h)?A.create(+h):w.create(h)}}class V0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof f)return t;const n=e[r];if(n.isArray()){let s=!1,u;if(n.iterator(o=>{if(t=this._handleSingleObject(o,t),t instanceof f)return s=!0,u=t,!1}),s)return u}else t=this._handleSingleObject(n,t)}return t instanceof f?t:typeof t=="number"||Q(t)?A.create(+t):w.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return f.create(g.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new fe(n);if(s.isError())return f.create(g.NUM);r=s.toString()}else{const s=new fe(t),u=new fe(n);if(s.isError()||u.isError())return f.create(g.NUM);if(s.isDifferentSuffixes(u))return f.create(g.VALUE);r=s.Product(u)}return r}}class T0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.getRealNum();return A.create(i)}}class I0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Sec();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class x0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Sech();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class U0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Sin();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class v0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Sinh();return o.isError()?f.create(g.NUM):typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class w0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);if(o.getRealNum()===0&&o.getINum()===0)return A.create(0);const i=o.Sqrt();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class D0 extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=`${u.getValue()}`,l=`${o.getValue()}`,c=new fe(i),h=new fe(l);if(c.isError()||h.isError()||c.isDifferentSuffixes(h))return f.create(g.NUM);const m=c.Sub(h);return typeof m=="number"||Q(m)?A.create(+m):w.create(m)}}class L0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof f)return t;const n=e[r];if(n.isArray()){let s=!1,u;if(n.iterator(o=>{if(t=this._handleSingleObject(o,t),t instanceof f)return s=!0,u=t,!1}),s)return u}else t=this._handleSingleObject(n,t)}return t instanceof f?t:typeof t=="number"||Q(t)?A.create(+t):w.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return f.create(g.VALUE);const n=`${e.getValue()}`;if(typeof t!="number"&&!t){const s=new fe(n);if(s.isError())return f.create(g.NUM);r=s.toString()}else{const s=new fe(t),u=new fe(n);if(s.isError()||u.isError())return f.create(g.NUM);if(s.isDifferentSuffixes(u))return f.create(g.VALUE);r=s.Sum(u)}return r}}class P0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Tan();return typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class F0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`,o=new fe(u);if(o.isError())return f.create(g.NUM);const i=o.Tanh();return o.isError()?f.create(g.NUM):typeof i=="number"||Q(i)?A.create(+i):w.create(i)}}class j0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:m,errorObject:d,variants:_}=G(t);if(m)return d;const[C]=_;if(r=Math.floor(+C.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!Wu(i))return f.create(g.NUM);const l=i.length===10&&i.substring(0,1)==="7",c=l?Number.parseInt(i,8)-1073741824:Number.parseInt(i,8);if(c<-512||c>511)return f.create(g.NUM);let h;if(l){const m=(512+c).toString(2);h=`1${"0".repeat(9-m.length)}${m}`}else if(h=c.toString(2),t){if(r<h.length)return f.create(g.NUM);h="0".repeat(r-h.length)+h}return w.create(h)}}class B0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const{isError:t,errorObject:r,variants:n}=G(e);if(t)return r;const[s]=n,u=`${s.getValue()}`;if(!Wu(u))return f.create(g.NUM);let o=Number.parseInt(u,8);return o>=536870912&&(o-=1073741824),A.create(o)}}class k0 extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){if(e.isNull())return f.create(g.NA);let r=0;if(t){const{isError:h,errorObject:m,variants:d}=G(t);if(h)return m;const[_]=d;if(r=Math.floor(+_.getValue()),Number.isNaN(r))return f.create(g.VALUE);if(r<0||r>10)return f.create(g.NUM)}const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=`${o.getValue()}`;if(!Wu(i))return f.create(g.NUM);const l=Number.parseInt(i,8);let c;if(l>=536870912)c=`ff${(l+3221225472).toString(16)}`;else if(c=l.toString(16),t){if(r<c.length)return f.create(g.NUM);c="0".repeat(r-c.length)+c}return w.create(c.toLocaleUpperCase())}}const Fc=[[j1,X.BESSELI],[B1,X.BESSELJ],[k1,X.BESSELK],[$1,X.BESSELY],[Y1,X.BIN2DEC],[H1,X.BIN2HEX],[G1,X.BIN2OCT],[X1,X.BITAND],[q1,X.BITLSHIFT],[W1,X.BITOR],[Q1,X.BITRSHIFT],[K1,X.BITXOR],[Z1,X.COMPLEX],[z1,X.CONVERT],[J1,X.DEC2BIN],[e0,X.DEC2HEX],[t0,X.DEC2OCT],[r0,X.DELTA],[n0,X.ERF],[s0,X.ERF_PRECISE],[a0,X.ERFC],[u0,X.ERFC_PRECISE],[o0,X.GESTEP],[i0,X.HEX2BIN],[l0,X.HEX2DEC],[c0,X.HEX2OCT],[h0,X.IMABS],[m0,X.IMAGINARY],[g0,X.IMARGUMENT],[f0,X.IMCONJUGATE],[d0,X.IMCOS],[N0,X.IMCOSH],[_0,X.IMCOT],[C0,X.IMCOTH],[E0,X.IMCSC],[A0,X.IMCSCH],[p0,X.IMDIV],[y0,X.IMEXP],[b0,X.IMLN],[R0,X.IMLOG],[O0,X.IMLOG10],[S0,X.IMLOG2],[M0,X.IMPOWER],[V0,X.IMPRODUCT],[T0,X.IMREAL],[I0,X.IMSEC],[x0,X.IMSECH],[U0,X.IMSIN],[v0,X.IMSINH],[w0,X.IMSQRT],[D0,X.IMSUB],[L0,X.IMSUM],[P0,X.IMTAN],[F0,X.IMTANH],[j0,X.OCT2BIN],[B0,X.OCT2DEC],[k0,X.OCT2HEX]];function ma(a,e,t,r){const n=Zt(a,e,t),{days:s}=Ee(n,a,r);return s}function et(a,e,t,r){let n;if(r===1){const s=Zt(a,e,t);let u=se(s);u=wr(u,12/t);const o=be(u);s<0&&t===1?n=365:n=o-s}else r===3?n=365/t:n=360/t;return n}function jc(a,e,t){const r=se(a);let n=se(e);for(n.setUTCFullYear(r.getUTCFullYear()),n<r&&n.setUTCFullYear(n.getUTCFullYear()+1);n>r;)n=wr(n,-12/t);return n=wr(n,12/t),be(n)}function Er(a,e,t){let r=0;const n=se(a);let s=se(e);for(;s>n;)s=wr(s,-12/t),r++;return r}function Zt(a,e,t){const r=se(a);let n=se(e);for(n.setUTCFullYear(r.getUTCFullYear()),n<r&&n.setUTCFullYear(n.getUTCFullYear()+1);n>r;)n=wr(n,-12/t);return be(n)}function Bc(a,e,t,r,n,s){const u=ma(a,e,n,s),o=et(a,e,n,s),i=Er(a,e,n),l=(o-u)/o-1,c=r/n+1,h=t*100/n;let m=0,d=0;for(let E=1;E<=i;E++){const p=E+l,y=h/c**p;m+=p*y,d+=y}const _=i+l,C=100/c**_;return m+=_*C,d+=C,m/d/n}function xn(a,e,t,r,n){let s;if(a===0)s=(t+r)/e;else{const u=(1+a)**e;s=n===1?(r*a/(u-1)+t*a/(1-1/u))/(1+a):r*a/(u-1)+t*a/(1-1/u)}return-s}function Ar(a,e,t,r,n){let s;if(a===0)s=r+t*e;else{if(a===-1&&e===0)return Number.NaN;const u=(1+a)**e;s=n===1?r*u+t*(1+a)*(u-1)/a:r*u+t*(u-1)/a}return-s}function kc(a,e,t,r,n,s){const u=xn(a,t,r,n,s);return(e===1?s===1?0:-r:s===1?Ar(a,e-2,u,r,1)-u:Ar(a,e-1,u,r,0))*a}function $c(a,e){let t=0;for(let r=1;r<=e.length;r++)t+=e[r-1]/(1+a)**r;return t}function Yc(a,e,t,r,n,s,u,o,i){const l=ur(t,r,i),c=et(a,r,o,i);return l<c?$0(a,e,t,r,n,s,u,o,i,l,c):Y0(a,e,t,r,n,s,u,o,i,c)}function $0(a,e,t,r,n,s,u,o,i,l,c){let h=0;const m=Er(a,e,o),d=ur(a,r,i);h+=u/(1+s/o)**(m-1+d/c),h+=100*n/o*l/c/(1+s/o)**(d/c);for(let C=2;C<=m;C++)h+=100*n/o/(1+s/o)**(C-1+d/c);const _=ur(t,a,i);return h-=100*n/o*_/c,h}function Y0(a,e,t,r,n,s,u,o,i,l){let c=0;const h=Er(r,e,o),m=H0(r,a,12/o);let d;if(i===2||i===3){const y=jc(a,r,o);d=ur(a,y,i)}else{const y=Zt(a,r,o),{days:b}=Ee(y,a,i);d=l-b}c+=u/(1+s/o)**(h+m+d/l);const _=Er(t,r,o);let C=r,E=0,p=0;for(let y=_;y>=1;y--){const b=hr(C,-12/o,!1),O=i===1?ur(b,C,i):l,M=y>1?O:ur(t,C,i);E+=M/O;const V=t>b?t:b,T=a<C?a:C,x=ur(V,T,i);p+=x/O,C=b}c+=100*n/o*E/(1+s/o)**(m+d/l);for(let y=1;y<=h;y++)c+=100*n/o/(1+s/o)**(y+m+d/l);return c-=100*n/o*p,c}function ur(a,e,t){const{days:r}=Ee(a,e,t);return a<e?r:0}function Hc(a,e,t){const r=se(a),n=r.getUTCFullYear(),s=r.getUTCMonth(),u=r.getUTCDate(),o=vr(n,s,u),i=se(e),l=i.getUTCFullYear(),c=i.getUTCMonth(),h=i.getUTCDate(),m=vr(l,c,h);return!(u!==h&&!(o&&m)||Math.abs((l-n)*12+(c-s))%(12/t)!==0)}function qr(a,e,t){return Zt(a,e,t)>=0}function hr(a,e,t){let r=se(a);if(r=wr(r,e),t){const n=r.getUTCFullYear(),s=r.getUTCMonth(),u=En(n,s);r.setUTCDate(u)}return be(r)}function H0(a,e,t,r){const n=se(a),s=se(e),u=n.getUTCFullYear(),o=n.getUTCMonth(),i=n.getUTCDate(),l=s.getUTCFullYear(),c=s.getUTCMonth(),h=s.getUTCDate(),m=vr(u,o,i),d=!m&&o!==1&&i>28&&i<En(u,o)?vr(l,c,h):m,_=hr(e,0,d);let C=1+ +(e<_),E=hr(_,t,d);for(;!(t>0?E>=e:E<=e);)E=hr(E,t,d),C++;return C}function oo(a,e){let t=1,r=0,n=a,s;for(;t>1e-7&&r<500;){const u=(e(n+1e-7)-e(n-1e-7))/2e-7;s=n-e(n)/u,r++,t=Math.abs(s-n),n=s}return Number.isNaN(n)||Math.abs(n)===1/0||r===500?G0(a,e):n}function G0(a,e){const t=Number.MAX_VALUE,r=-1,n=1.6;let s=a-.01<=r?r+1e-7:a-.01,u=a+.01>=t?t-1e-7:a+.01,o,i,l=0;if(a<=r||a>=t)return f.create(g.NUM);for(let _=0;_<60;_++){o=s<=r?r+1e-7:s,i=u>=t?t-1e-7:u;const C=e(o),E=e(i);if(C*E<=0)break;if(C*E>0)s=o+n*(o-i),u=i+n*(i-o);else return f.create(g.NUM);if(_===59)return f.create(g.NUM)}o=o,i=i;let c=e(o);const h=e(i);let m,d;if(Math.abs(c)<1e-7||Math.abs(h)<1e-7)return f.create(g.NUM);do d=o+(i-o)/2,m=e(d),c*m<0?i=d:o=d,c=e(o),l++;while(Math.abs(m)>1e-7&&l<60);return d}function Jn(a,e,t,r,n,s,u){const o=Er(a,e,s),i=et(a,e,s,u),l=ma(a,e,s,u);if(o===1){const m=i-l,d=100*t/s+n,_=r/s*m/i+1,C=100*t/s*l/i;return d/_-C}const c=i-l;let h=n/(1+r/s)**(o-1+c/i);for(let m=1;m<=o;m++)h+=100*t/s/(1+r/s)**(m-1+c/i);return h-=100*t/s*l/i,h}function su(a,e,t,r,n){let s=0,u=n/t;u>=1?(u=1,s=r===1?a:0):s=a*(1-u)**(r-1);const o=a*(1-u)**r;let i=0;return o<e?i=s-e:i=s-o,i<0&&(i=0),i}class X0 extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",8)}calculate(e,t,r,n,s,u,o,i){const l=o??A.create(0),c=i??P.create(!0),{isError:h,errorObject:m,variants:d}=G(e,t,r,n,s,u,l);if(h)return m;const[_,C,E,p,y,b,O]=d,M=$(_);if(typeof M!="number")return M;const V=$(C);if(typeof V!="number")return V;const T=$(E);if(typeof T!="number")return T;const x=+p.getValue(),v=+y.getValue(),L=Math.floor(+b.getValue()),D=Math.floor(+O.getValue()),Y=+c.getValue();return Number.isNaN(x)||Number.isNaN(v)||Number.isNaN(L)||Number.isNaN(D)||Number.isNaN(Y)?f.create(g.VALUE):x<=0||v<=0||![1,2,4].includes(L)||D<0||D>4||Math.floor(M)>=Math.floor(T)?f.create(g.NUM):this._getResult(M,V,T,x,v,L,D,Y)}_getResult(e,t,r,n,s,u,o,i){let l=Zt(e,t,u);if(l<=0)return A.create(0);l=Zt(r,t,u);const c=12/u,h=se(t),m=h.getUTCFullYear(),d=h.getUTCMonth(),_=h.getUTCDate(),C=vr(m,d,_);let E=hr(t,-c,C);if(r>t&&i)for(E=t;E<r;)E=hr(E,c,C);let p=e>E?e:E,{days:y}=Ee(p,r,o);if(l>=e){const{days:x}=Ee(p,r,o?4:0);y=x}r<p&&(y=-y);let b=et(E,t,u,o),O=y/b,M=E,V=e;for(;M>e;){V=M,M=hr(M,-c,C),p=e>M?e:M;const{days:x}=Ee(p,V,o);if(o===0)V>=p||e<=M?y=x:y=-x,b=et(M,V,u,o);else if(y=V<p?-x:x,o===3)b=365/u;else{const{days:v}=Ee(M,V,o);b=V<M?-v:v}O+=e<=M?i?1:0:y/b}const T=s*n/u*O;return A.create(T)}}class q0 extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=s??A.create(0),{isError:o,errorObject:i,variants:l}=G(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||Math.floor(C)>Math.floor(E))return f.create(g.NUM);if(Math.floor(C)===Math.floor(E))return A.create(0);const{days:O,yearDays:M}=Ee(C,E,b),V=y*p*O/M;return A.create(V)}}class W0 extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",7)}calculate(e,t,r,n,s,u,o){const i=o??A.create(0),{isError:l,errorObject:c,variants:h}=G(e,t,r,n,s,u,i);if(l)return c;const[m,d,_,C,E,p,y]=h,b=$(d);if(typeof b!="number")return b;const O=$(_);if(typeof O!="number")return O;const M=+m.getValue(),V=+C.getValue();let T=+E.getValue();const x=+p.getValue(),v=Math.floor(+y.getValue());return Number.isNaN(M)||Number.isNaN(V)||Number.isNaN(T)||Number.isNaN(x)||Number.isNaN(v)?f.create(g.VALUE):M<=0||V<0||M<V||Math.floor(b)>Math.floor(O)||T<0||x<=0||![0,1,3,4].includes(v)?f.create(g.NUM):(T>1?T=Math.floor(T):T=Math.ceil(T),this._getResult(M,b,O,V,T,x,v))}_getResult(e,t,r,n,s,u,o){const i=e-n,l=e*u,{days:c,yearDays:h}=Ee(t,r,o),m=c/h,d=Math.ceil(i/l-m);if(d<0)return A.create(0);let _=l;return s===0?_=l*m:s===d?_=i-l*(m+s-1):s>d&&(_=0),A.create(_)}}class Q0 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_))return f.create(g.NUM);const p=ma(d,_,C,E);return A.create(p)}}class K0 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_))return f.create(g.NUM);const p=et(d,_,C,E);return A.create(p)}}class Z0 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_))return f.create(g.NUM);const p=se(d),y=se(_);for(y.setUTCFullYear(p.getUTCFullYear()),y<p&&y.setUTCFullYear(y.getUTCFullYear()+1);y>p;)y.setUTCMonth(y.getUTCMonth()-12/C);y.setUTCMonth(y.getUTCMonth()+12/C);const b=be(y),{days:O}=Ee(d,b,E);return A.create(O)}}class z0 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_))return f.create(g.NUM);const p=jc(d,_,C);return A.create(p)}}class J0 extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_)||Zt(d,_,C)<0)return f.create(g.NUM);const p=Er(d,_,C);return A.create(p)}}class eN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=n??A.create(0),{isError:u,errorObject:o,variants:i}=G(e,t,r,s);if(u)return o;const[l,c,h,m]=i,d=$(l);if(typeof d!="number")return d;const _=$(c);if(typeof _!="number")return _;const C=Math.floor(+h.getValue()),E=Math.floor(+m.getValue());if(Number.isNaN(C)||Number.isNaN(E))return f.create(g.VALUE);if(![1,2,4].includes(C)||E<0||E>4||Math.floor(d)>=Math.floor(_))return f.create(g.NUM);let p=Zt(d,_,C);return p<0&&(p=0),A.create(p)}}class tN extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){const{isError:o,errorObject:i,variants:l}=G(e,t,r,n,s,u);if(o)return i;const[c,h,m,d,_,C]=l,E=+c.getValue(),p=+h.getValue(),y=+m.getValue(),b=+d.getValue(),O=+_.getValue(),M=+C.getValue();return Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b)||Number.isNaN(O)||Number.isNaN(M)?f.create(g.VALUE):E<=0||p<=0||y<=0||b<1||O<1||b>O||b>p||O>p||![0,1].includes(M)?f.create(g.NUM):Math.trunc(b)!==b&&Math.trunc(O)!==O&&Math.trunc(b)===Math.trunc(O)?A.create(0):this._getResult(E,p,y,b,O,M)}_getResult(e,t,r,n,s,u){const o=xn(e,t,r,0,u);let i=0,l=Math.ceil(n);l===1&&(u===0&&(i=-r),l++);let c=!1;for(let h=l;h<=s;h++){const m=u===1?Ar(e,h-2,o,r,1):Ar(e,h-1,o,r,0);if(m===0){c=!0;break}i+=u===1?m-o:m}return i*=e,(i<o*(s-n+1)||c)&&(i=o*(s-n+1)),A.create(i)}}class rN extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){const{isError:o,errorObject:i,variants:l}=G(e,t,r,n,s,u);if(o)return i;const[c,h,m,d,_,C]=l,E=+c.getValue(),p=+h.getValue(),y=+m.getValue(),b=+d.getValue(),O=+_.getValue(),M=+C.getValue();return Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b)||Number.isNaN(O)||Number.isNaN(M)?f.create(g.VALUE):E<=0||p<=0||y<=0||b<1||O<1||b>O||![0,1].includes(M)?f.create(g.NUM):Math.trunc(b)!==b&&Math.trunc(O)!==O&&Math.trunc(b)===Math.trunc(O)?A.create(0):this._getResult(E,p,y,b,O,M)}_getResult(e,t,r,n,s,u){const o=xn(e,t,r,0,u);let i=0,l=Math.ceil(n);l===1&&(i=u===0?o+r*e:o,l++);for(let c=l;c<=s;c++)i+=u===1?o-(Ar(e,c-2,o,r,1)-o)*e:o-Ar(e,c-1,o,r,0)*e;return A.create(i)}}class nN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5),N(this,"needsLocale",!0)}calculate(e,t,r,n,s){let u=s??A.create(12);u.isNull()&&(u=A.create(12));const o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1),l=S(o,i,e,f.create(g.NA)),c=S(o,i,t,f.create(g.NA)),h=S(o,i,r,f.create(g.NA)),m=S(o,i,n,f.create(g.NA)),d=S(o,i,u,f.create(g.NA)),_=l.map((C,E,p)=>{const y=c.get(E,p),b=h.get(E,p),O=m.get(E,p),M=d.get(E,p),{isError:V,errorObject:T,variants:x}=F(C,y,b,O,M);if(V)return T;const[v,L,D,Y,ee]=x,ue=+v.getValue(),H=+L.getValue(),Z=+D.getValue();let Ne=+Y.getValue();const Re=Math.floor(+ee.getValue());return ue<0||H<0||Z<=0||Ne<=0||Math.floor(Ne)>Math.floor(Z)||Re<1||Re>12?f.create(g.NUM):(Ne<1&&(Ne=1),Ne=Math.floor(Ne),this._getResult(ue,H,Z,Ne,Re,E,p))});return o===1&&i===1?_.get(0,0):_}_getResult(e,t,r,n,s,u,o){const i=+(1-(t/e)**(1/r)).toFixed(3),l=e*i*s/12;let c=l,h=0;const m=n===r?r-1:n;for(let _=2;_<=m;_++)h=(e-c)*i,c+=h;let d;return n===1?d=l:n===r?d=(e-c)*i:d=h,Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):u===0&&o===0?A.create(d,tt(this.getLocale())):A.create(d)}}class sN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5),N(this,"needsLocale",!0)}calculate(e,t,r,n,s){let u=s??A.create(2);u.isNull()&&(u=A.create(2));const o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,u.isArray()?u.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,u.isArray()?u.getColumnCount():1),l=S(o,i,e,f.create(g.NA)),c=S(o,i,t,f.create(g.NA)),h=S(o,i,r,f.create(g.NA)),m=S(o,i,n,f.create(g.NA)),d=S(o,i,u,f.create(g.NA)),_=l.map((C,E,p)=>{const y=c.get(E,p),b=h.get(E,p),O=m.get(E,p),M=d.get(E,p),{isError:V,errorObject:T,variants:x}=F(C,y,b,O,M);if(V)return T;const[v,L,D,Y,ee]=x,ue=+v.getValue(),H=+L.getValue(),Z=+D.getValue(),Ne=+Y.getValue(),Re=+ee.getValue();if(ue<0||H<0||Z<=0||Ne<=0||Ne>Z||Re<=0)return f.create(g.NUM);const Se=su(ue,H,Z,Ne,Re);return Number.isNaN(Se)||!Number.isFinite(Se)?f.create(g.NUM):E===0&&p===0?A.create(Se,tt(this.getLocale())):A.create(Se)});return o===1&&i===1?_.get(0,0):_}}class aN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=s??A.create(0),{isError:o,errorObject:i,variants:l}=G(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||Math.floor(C)>=Math.floor(E))return f.create(g.NUM);const{days:O,yearDays:M}=Ee(C,E,b),V=(y-p)/y*(M/O);return A.create(V)}}class uN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);if(l>=0&&l<1)return f.create(g.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let c=Number.parseInt(`${i}`,10);c+=i%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;const h=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return c=Math.round(c*h)/h,A.create(c)}}class oN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l<0)return f.create(g.NUM);if(l>=0&&l<1)return f.create(g.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let c=Number.parseInt(`${i}`,10);return c+=i%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,A.create(c)}}class iN extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=u??A.create(0);o.isNull()&&(o=A.create(0));const{isError:i,errorObject:l,variants:c}=He(e,t,r,n,s,o);if(i)return l;const[h,m,d,_,C,E]=c,p=$(h);if(typeof p!="number")return p;const y=$(m);if(typeof y!="number")return y;const b=+d.getValue(),O=+_.getValue(),M=Math.floor(+C.getValue()),V=Math.floor(+E.getValue());if(Number.isNaN(b)||Number.isNaN(O)||Number.isNaN(M)||Number.isNaN(V))return f.create(g.VALUE);if(b<0||O<0||![1,2,4].includes(M)||V<0||V>4||Math.floor(p)>=Math.floor(y)||p<=0||y<=366)return f.create(g.NUM);const T=Bc(p,y,b,O,M,V);return A.create(T)}}class lN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(i<=0||l<1)return f.create(g.NUM);l=Number.parseInt(`${l}`,10);const c=(1+i/l)**l-1;return A.create(c)}}class cN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5),N(this,"needsLocale",!0)}calculate(e,t,r,n,s){const u=n??A.create(0),o=s??A.create(0),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.map((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y),{isError:T,errorObject:x,variants:v}=F(E,b,O,M,V);if(T)return x;const[L,D,Y,ee,ue]=v,H=+L.getValue(),Z=+D.getValue(),Ne=+Y.getValue(),Re=+ee.getValue(),Se=+ue.getValue(),de=Ar(H,Z,Ne,Re,Se?1:0);return Number.isNaN(de)||!Number.isFinite(de)?f.create(g.NUM):p===0&&y===0?A.create(de,tt(this.getLocale())):A.create(de)});return i===1&&l===1?C.get(0,0):C}}class hN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e);if(r)return n;const[u]=s,o=+u.getValue();if(Number.isNaN(o))return f.create(g.VALUE);let i=o;if(t.isArray()){const l=t.getArrayValue().flat();for(let c=0;c<l.length;c++){const h=l[c];if(h.isBoolean())return f.create(g.VALUE);const m=+h.getValue();if(Number.isNaN(m))return f.create(g.VALUE);i*=1+m}}else{if(t.isBoolean())return f.create(g.VALUE);const l=+t.getValue();if(Number.isNaN(l))return f.create(g.VALUE);i*=1+l}return A.create(i)}}class mN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=s??A.create(0),{isError:o,errorObject:i,variants:l}=G(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||Math.floor(C)>=Math.floor(E))return f.create(g.NUM);const{days:O,yearDays:M}=Ee(C,E,b),V=(y-p)/p*(M/O);return A.create(V)}}class gN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",6),N(this,"needsLocale",!0)}calculate(e,t,r,n,s,u){const o=s??A.create(0),i=u??A.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,e,f.create(g.NA)),m=S(l,c,t,f.create(g.NA)),d=S(l,c,r,f.create(g.NA)),_=S(l,c,n,f.create(g.NA)),C=S(l,c,o,f.create(g.NA)),E=S(l,c,i,f.create(g.NA)),p=h.map((y,b,O)=>{const M=m.get(b,O),V=d.get(b,O),T=_.get(b,O),x=C.get(b,O),v=E.get(b,O),{isError:L,errorObject:D,variants:Y}=F(y,M,V,T,x,v);if(L)return D;const[ee,ue,H,Z,Ne,Re]=Y,Se=+ee.getValue(),de=+ue.getValue(),Fe=+H.getValue(),Et=+Z.getValue(),$t=+Ne.getValue(),Yt=+Re.getValue();if(de<1||Math.floor(de)>Math.ceil(Fe))return f.create(g.NUM);const ct=kc(Se,de,Fe,Et,$t,Yt?1:0);return Number.isNaN(ct)||!Number.isFinite(ct)?f.create(g.NUM):b===0&&O===0?A.create(ct,tt(this.getLocale())):A.create(ct)});return l===1&&c===1?p.get(0,0):p}}class fN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){let r=t??A.create(.1);return r.isNull()&&(r=A.create(.1)),r.isArray()?r.map((n,s,u)=>this._handleSingleObject(e,n,s,u)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return f.create(g.VALUE);if(!e.isArray())return f.create(g.NUM);const{_values:s,valuesHasError:u}=this._getValues(e);if(u)return f.create(g.VALUE);let o=t;if(o.isString()&&(o=o.convertToNumberObjectValue(),o.isError()))return o;const i=+o.getValue(),{positive:l,negative:c}=this._checkValues(s);if(!l||!c)return f.create(g.NUM);const h=oo(i,m=>$c(m,s));return typeof h!="number"?h:r===0&&n===0?A.create(h,"0%"):A.create(h)}_getValues(e){const t=[];let r=!1;return e.iterator(n=>{const s=n;if(s.isError())return r=!0,!1;if(s.isNull()||s.isBoolean()||s.isString()&&s.getValue()==="")return!0;const u=+s.getValue();if(Number.isNaN(u))return!0;t.push(u)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}}class dN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.map((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_),{isError:y,errorObject:b,variants:O}=F(m,C,E,p);if(y)return b;const[M,V,T,x]=O,v=+M.getValue(),L=+V.getValue(),D=+T.getValue(),Y=+x.getValue();if(D===0)return f.create(g.DIV_BY_ZERO);const ee=Y*v*(L/D-1);return A.create(ee)});return s===1&&u===1?h.get(0,0):h}}class NN extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=u??A.create(0);o.isNull()&&(o=A.create(0));const{isError:i,errorObject:l,variants:c}=He(e,t,r,n,s,o);if(i)return l;const[h,m,d,_,C,E]=c,p=$(h);if(typeof p!="number")return p;const y=$(m);if(typeof y!="number")return y;const b=+d.getValue(),O=+_.getValue(),M=Math.floor(+C.getValue()),V=Math.floor(+E.getValue());if(Number.isNaN(b)||Number.isNaN(O)||Number.isNaN(M)||Number.isNaN(V))return f.create(g.VALUE);if(b<0||O<0||![1,2,4].includes(M)||V<0||V>4||Math.floor(p)>=Math.floor(y))return f.create(g.NUM);let T=Bc(p,y,b,O,M,V);return T/=1+O/M,A.create(T)}}class _N extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{_values:n,numberValues:s,positive:u,negative:o}=this._getValues(e),i=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),c=S(i,l,t,f.create(g.NA)),h=S(i,l,r,f.create(g.NA)),m=c.map((d,_,C)=>{const E=h.get(_,C);if(e.isError())return e;if(E.isError())return E;if(n.isError())return n;if(!u||!o)return f.create(g.DIV_BY_ZERO);const p=+d.getValue(),y=+E.getValue();if(Number.isNaN(p)||Number.isNaN(y))return f.create(g.VALUE);if(y===-1)return f.create(g.DIV_BY_ZERO);const b=this._getResult(s,p,y);return _===0&&C===0?A.create(b,"0%"):A.create(b)});return i===1&&l===1?m.get(0,0):m}_getValues(e){let t=e,r=[],n=!1,s=!1;if(!e.isError())if(e.isNull())t=f.create(g.VALUE);else if(!e.isArray())t=f.create(g.DIV_BY_ZERO);else{const{numberValues:u,valuesHasError:o,errorObject:i,positive:l,negative:c}=this._checkValues(e);o&&(t=i),r=u,n=l,s=c}return{_values:t,numberValues:r,positive:n,negative:s}}_checkValues(e){const t=[];let r=!1,n=f.create(g.VALUE),s=!1,u=!1;return e.iterator(o=>{const i=o;if(i.isError())return r=!0,n=i,!1;if(i.isNull()||i.isBoolean()||i.isString()&&i.getValue()==="")return!0;const l=+i.getValue();if(Number.isNaN(l))return!0;l>0&&(s=!0),l<0&&(u=!0),t.push(l)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:s,negative:u}}_getResult(e,t,r){const n=e.length,s=[],u=[];for(let h=0;h<n;h++)e[h]>0?u.push(e[h]):e[h]<0&&s.push(e[h]);const o=this._npv(r,e,"positive"),i=this._npv(t,e,"negative"),l=-o*(1+r)**n,c=i*(1+t);return(l/c)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let s=1;s<=t.length;s++){const u=t[s-1];(r==="positive"&&u>0||r==="negative"&&u<0)&&(n+=u/(1+e)**s)}return n}}class CN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue();let l=Math.floor(+o.getValue());if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(i<=0||l<1)return f.create(g.NUM);l=Number.parseInt(`${l}`,10);const c=((i+1)**(1/l)-1)*l;return A.create(c)}}class EN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=n??A.create(0),o=s??A.create(0),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.map((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y),{isError:T,errorObject:x,variants:v}=F(E,b,O,M,V);if(T)return x;const[L,D,Y,ee,ue]=v,H=+L.getValue(),Z=+D.getValue(),Ne=+Y.getValue(),Re=+ee.getValue();let Se=+ue.getValue();if(Se=Se?1:0,H===0&&Z===0)return f.create(g.DIV_BY_ZERO);let de;if(H===0)de=-(Ne+Re)/Z;else{const Fe=Z*(1+H*Se)-Re*H,Et=Ne*H+Z*(1+H*Se);de=Math.log(Fe/Et)/Math.log(1+H)}return Number.isNaN(de)||!Number.isFinite(de)?f.create(g.NUM):A.create(de)});return i===1&&l===1?C.get(0,0):C}}class AN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255),N(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;const{isError:r,errorObject:n,values:s}=this._getValues(t);return e.isArray()?e.map((u,o,i)=>this._handleSingleObject(u,r,n,s,o,i)):this._handleSingleObject(e,r,n,s)}_handleSingleObject(e,t,r,n,s=0,u=0){let o=e;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(t)return r;const i=+e.getValue(),l=$c(i,n);return Number.isNaN(l)||Math.abs(l)===1/0?f.create(g.DIV_BY_ZERO):s===0&&u===0?A.create(l,tt(this.getLocale())):A.create(l)}_getValues(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let s=!1,u=f.create(g.VALUE);if(n.iterator(o=>{const i=o;if(i.isError())return s=!0,u=i,!1;if(i.isNull()||i.isBoolean()||i.isString()&&i.getValue()==="")return!0;const l=+i.getValue();if(Number.isNaN(l))return!0;t.push(l)}),s)return{isError:s,errorObject:u}}else{const s=+n.getValue();if(Number.isNaN(s))return{isError:!0,errorObject:f.create(g.VALUE)};t.push(s)}}return{isError:!1,values:t}}}class pN extends R{constructor(){super(...arguments),N(this,"minParams",8),N(this,"maxParams",9)}calculate(e,t,r,n,s,u,o,i,l){let c=l??A.create(0);c.isNull()&&(c=A.create(0));const{isError:h,errorObject:m,variants:d}=He(e,t,r,n,s,u,o,i,c);if(h)return m;const[_,C,E,p,y,b,O,M,V]=d,T=$(_);if(typeof T!="number")return T;const x=$(C);if(typeof x!="number")return x;const v=$(E);if(typeof v!="number")return v;const L=$(p);if(typeof L!="number")return L;const D=+y.getValue(),Y=+b.getValue(),ee=+O.getValue(),ue=Math.floor(+M.getValue()),H=Math.floor(+V.getValue());if(Number.isNaN(D)||Number.isNaN(Y)||Number.isNaN(ee)||Number.isNaN(ue)||Number.isNaN(H))return f.create(g.VALUE);if(D<0||Y<0||ee<=0||![1,2,4].includes(ue)||H<0||H>4||!this._validDate(x,L,T,v,ue))return f.create(g.NUM);const Z=Yc(T,x,v,L,D,Y,ee,ue,H);return A.create(Z)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Hc(e,t,s)&&qr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}}class yN extends R{constructor(){super(...arguments),N(this,"minParams",8),N(this,"maxParams",9)}calculate(e,t,r,n,s,u,o,i,l){let c=l??A.create(0);c.isNull()&&(c=A.create(0));const{isError:h,errorObject:m,variants:d}=He(e,t,r,n,s,u,o,i,c);if(h)return m;const[_,C,E,p,y,b,O,M,V]=d,T=$(_);if(typeof T!="number")return T;const x=$(C);if(typeof x!="number")return x;const v=$(E);if(typeof v!="number")return v;const L=$(p);if(typeof L!="number")return L;const D=+y.getValue(),Y=+b.getValue(),ee=+O.getValue(),ue=Math.floor(+M.getValue()),H=Math.floor(+V.getValue());return Number.isNaN(D)||Number.isNaN(Y)||Number.isNaN(ee)||Number.isNaN(ue)||Number.isNaN(H)?f.create(g.VALUE):D<0||Y<=0||ee<=0||![1,2,4].includes(ue)||H<0||H>4||!this._validDate(x,L,T,v,ue)?f.create(g.NUM):this._getResult(T,x,v,L,D,Y,ee,ue,H)}_validDate(e,t,r,n,s){return this._getDateCorrectOrder(e,t,r,n)&&Hc(e,t,s)&&qr(n,e,s)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,s,u,o,i,l){const{days:c}=Ee(e,t,l),h=(s*c*100-(u-100))/((u-100)*.25*(1+2*c)+c*100);function m(_){return u-Yc(e,t,r,n,s,_,o,i,l)}const d=oo(h,_=>m(_));return typeof d!="number"?d:A.create(d)}}class bN extends R{constructor(){super(...arguments),N(this,"minParams",7),N(this,"maxParams",8)}calculate(e,t,r,n,s,u,o,i){let l=i??A.create(0);l.isNull()&&(l=A.create(0));const{isError:c,errorObject:h,variants:m}=He(e,t,r,n,s,u,o,l);if(c)return h;const[d,_,C,E,p,y,b,O]=m,M=$(d);if(typeof M!="number")return M;const V=$(_);if(typeof V!="number")return V;const T=$(C);if(typeof T!="number")return T;const x=+E.getValue(),v=+p.getValue(),L=+y.getValue(),D=Math.floor(+b.getValue()),Y=Math.floor(+O.getValue());if(Number.isNaN(x)||Number.isNaN(v)||Number.isNaN(L)||Number.isNaN(D)||Number.isNaN(Y))return f.create(g.VALUE);if(x<0||v<0||L<=0||![1,2,4].includes(D)||Y<0||Y>4||!this._validDate(V,M,T,D))return f.create(g.NUM);const ee=this._getResult(M,V,T,x,v,L,D,Y);return A.create(ee)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&qr(r,e,n)}_getResult(e,t,r,n,s,u,o,i){const l=this._getCoupDate(t,r,o),c=this._getFrac(r,e,l,o,i),h=this._getFrac(r,t,l,o,i),m=this._getFrac(e,t,l,o,i);return(u*o+100*n*(h-c*(1+s*m/o)))/(s*m+o)}_getCoupDate(e,t,r){const n=se(e),s=se(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const u=se(e),o=se(t),i=se(r);for(i.setUTCFullYear(u.getUTCFullYear()),i<u&&i.setUTCFullYear(i.getUTCFullYear()+1);i>u;)i.setUTCMonth(i.getUTCMonth()-12/n);let l=be(i);i.setUTCMonth(i.getUTCMonth()+12/n);let c=be(i);if(c>=t){const{days:y}=Ee(e,t,s),b=et(l,c,n,s);return y/b}const{days:h}=Ee(e,c,s),m=et(l,c,n,s);let d=h/m;const _=se(c),C=se(c);for(C.setUTCMonth(C.getUTCMonth()+12/n);C<o;)_.setUTCMonth(_.getUTCMonth()+12/n),C.setUTCMonth(C.getUTCMonth()+12/n),d+=1;l=be(_),c=be(C);const{days:E}=Ee(l,t,s),p=et(l,c,n,s);return d+=E/p,d}}class RN extends R{constructor(){super(...arguments),N(this,"minParams",8),N(this,"maxParams",9)}calculate(e,t,r,n,s,u,o,i){let l=i??A.create(0);l.isNull()&&(l=A.create(0));const{isError:c,errorObject:h,variants:m}=He(e,t,r,n,s,u,o,l);if(c)return h;const[d,_,C,E,p,y,b,O]=m,M=$(d);if(typeof M!="number")return M;const V=$(_);if(typeof V!="number")return V;const T=$(C);if(typeof T!="number")return T;const x=+E.getValue(),v=+p.getValue(),L=+y.getValue(),D=Math.floor(+b.getValue()),Y=Math.floor(+O.getValue());if(Number.isNaN(x)||Number.isNaN(v)||Number.isNaN(L)||Number.isNaN(D)||Number.isNaN(Y))return f.create(g.VALUE);if(x<0||v<=0||L<=0||![1,2,4].includes(D)||Y<0||Y>4||!this._validDate(V,M,T,D))return f.create(g.NUM);const ee=this._getResult(M,V,T,x,v,L,D,Y);return A.create(ee)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&qr(r,e,n)}_getResult(e,t,r,n,s,u,o,i){const l=this._getCoupDate(t,r,o),c=this._getFrac(r,e,l,o,i),h=this._getFrac(r,t,l,o,i),m=this._getFrac(e,t,l,o,i);return(o*(u-s)+100*n*(h-c))/(m*s+100*n*c*m/o)}_getCoupDate(e,t,r){const n=se(e),s=se(t);for(s.setUTCFullYear(n.getUTCFullYear()),s>n&&s.setUTCFullYear(s.getUTCFullYear()-1);s<n;)s.setUTCMonth(s.getUTCMonth()+12/r);return be(s)}_getFrac(e,t,r,n,s){const u=se(e),o=se(t),i=se(r);for(i.setUTCFullYear(u.getUTCFullYear()),i<u&&i.setUTCFullYear(i.getUTCFullYear()+1);i>u;)i.setUTCMonth(i.getUTCMonth()-12/n);let l=be(i);i.setUTCMonth(i.getUTCMonth()+12/n);let c=be(i);if(c>=t){const{days:y}=Ee(e,t,s),b=et(l,c,n,s);return y/b}const{days:h}=Ee(e,c,s),m=et(l,c,n,s);let d=h/m;const _=se(c),C=se(c);for(C.setUTCMonth(C.getUTCMonth()+12/n);C<o;)_.setUTCMonth(_.getUTCMonth()+12/n),C.setUTCMonth(C.getUTCMonth()+12/n),d+=1;l=be(_),c=be(C);const{days:E}=Ee(l,t,s),p=et(l,c,n,s);return d+=E/p,d}}class SN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.map((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m),{isError:C,errorObject:E,variants:p}=F(c,d,_);if(C)return E;const[y,b,O]=p,M=+y.getValue(),V=+b.getValue(),T=+O.getValue();if(M<=-1)return f.create(g.NUM);const x=(Math.log(T)-Math.log(V))/Math.log(1+M);return Number.isNaN(x)||!Number.isFinite(x)?f.create(g.NUM):A.create(x)});return n===1&&s===1?l.get(0,0):l}}class ON extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5),N(this,"needsLocale",!0)}calculate(e,t,r,n,s){const u=n??A.create(0),o=s??A.create(0),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.map((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y),{isError:T,errorObject:x,variants:v}=F(E,b,O,M,V);if(T)return x;const[L,D,Y,ee,ue]=v,H=+L.getValue(),Z=+D.getValue(),Ne=+Y.getValue(),Re=+ee.getValue(),Se=+ue.getValue();if(H<=-1)return f.create(g.NUM);const de=xn(H,Z,Ne,Re,Se?1:0);return Number.isNaN(de)||!Number.isFinite(de)?f.create(g.NUM):p===0&&y===0?A.create(de,tt(this.getLocale())):A.create(de)});return i===1&&l===1?C.get(0,0):C}}class MN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",6),N(this,"needsLocale",!0)}calculate(e,t,r,n,s,u){const o=s??A.create(0),i=u??A.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,e,f.create(g.NA)),m=S(l,c,t,f.create(g.NA)),d=S(l,c,r,f.create(g.NA)),_=S(l,c,n,f.create(g.NA)),C=S(l,c,o,f.create(g.NA)),E=S(l,c,i,f.create(g.NA)),p=h.map((y,b,O)=>{const M=m.get(b,O),V=d.get(b,O),T=_.get(b,O),x=C.get(b,O),v=E.get(b,O),{isError:L,errorObject:D,variants:Y}=F(y,M,V,T,x,v);if(L)return D;const[ee,ue,H,Z,Ne,Re]=Y,Se=+ee.getValue(),de=+ue.getValue(),Fe=+H.getValue(),Et=+Z.getValue(),$t=+Ne.getValue(),Yt=+Re.getValue();if(de<1||Math.floor(de)>Math.ceil(Fe)||de-Fe>=1)return f.create(g.NUM);const ct=xn(Se,Fe,Et,$t,Yt?1:0)-kc(Se,de,Fe,Et,$t,Yt?1:0);return Number.isNaN(ct)||!Number.isFinite(ct)?f.create(g.NUM):b===0&&O===0?A.create(ct,tt(this.getLocale())):A.create(ct)});return l===1&&c===1?p.get(0,0):p}}class VN extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",7)}calculate(e,t,r,n,s,u,o){let i=o??A.create(0);i.isNull()&&(i=A.create(0));const{isError:l,errorObject:c,variants:h}=He(e,t,r,n,s,u,i);if(l)return c;const[m,d,_,C,E,p,y]=h,b=$(m);if(typeof b!="number")return b;const O=$(d);if(typeof O!="number")return O;const M=+_.getValue(),V=+C.getValue(),T=+E.getValue(),x=Math.floor(+p.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(M)||Number.isNaN(V)||Number.isNaN(T)||Number.isNaN(x)||Number.isNaN(v))return f.create(g.VALUE);if(M<0||V<0||T<=0||![1,2,4].includes(x)||v<0||v>4||b>=O||!qr(b,O,x))return f.create(g.NUM);const L=Jn(b,O,M,V,T,x,v);return A.create(L)}}class TN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){let u=s??A.create(0);u.isNull()&&(u=A.create(0));const{isError:o,errorObject:i,variants:l}=He(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||C>=E)return f.create(g.NUM);const{days:O,yearDays:M}=Ee(C,E,b),V=y-p*y*O/M;return A.create(V)}}class IN extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=u??A.create(0);o.isNull()&&(o=A.create(0));const{isError:i,errorObject:l,variants:c}=He(e,t,r,n,s,o);if(i)return l;const[h,m,d,_,C,E]=c,p=$(h);if(typeof p!="number")return p;const y=$(m);if(typeof y!="number")return y;const b=$(d);if(typeof b!="number")return b;const O=+_.getValue(),M=+C.getValue(),V=Math.floor(+E.getValue());if(Number.isNaN(O)||Number.isNaN(M)||Number.isNaN(V))return f.create(g.VALUE);const T=this._getDateCorrectOrder(y,p,b);if(O<0||M<0||V<0||V>4||!T)return f.create(g.NUM);const x=Mi(p,V),{days:v}=Ee(p,y,V),{days:L}=Ee(b,y,V),{days:D}=Ee(b,p,V),Y=(100+L/x*O*100)/(1+v/x*M)-D/x*O*100;return A.create(Y)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}class xN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5),N(this,"needsLocale",!0)}calculate(e,t,r,n,s){const u=n??A.create(0),o=s??A.create(0),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,e,f.create(g.NA)),h=S(i,l,t,f.create(g.NA)),m=S(i,l,r,f.create(g.NA)),d=S(i,l,u,f.create(g.NA)),_=S(i,l,o,f.create(g.NA)),C=c.map((E,p,y)=>{const b=h.get(p,y),O=m.get(p,y),M=d.get(p,y),V=_.get(p,y),{isError:T,errorObject:x,variants:v}=F(E,b,O,M,V);if(T)return x;const[L,D,Y,ee,ue]=v,H=+L.getValue(),Z=+D.getValue(),Ne=+Y.getValue(),Re=+ee.getValue();let Se=+ue.getValue();Se=Se?1:0;const de=H===0?-Ne*Z-Re:((1-(1+H)**Z)/H*Ne*(1+H*Se)-Re)/(1+H)**Z;return Number.isNaN(de)||!Number.isFinite(de)?f.create(g.NUM):p===0&&y===0?A.create(de,tt(this.getLocale())):A.create(de)});return i===1&&l===1?C.get(0,0):C}}class UN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){const o=n??A.create(0),i=s??A.create(0),l=u??A.create(.1),c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1,l.isArray()?l.getRowCount():1),h=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1,l.isArray()?l.getColumnCount():1),m=S(c,h,e,f.create(g.NA)),d=S(c,h,t,f.create(g.NA)),_=S(c,h,r,f.create(g.NA)),C=S(c,h,o,f.create(g.NA)),E=S(c,h,i,f.create(g.NA)),p=S(c,h,l,f.create(g.NA)),y=m.map((b,O,M)=>{const V=d.get(O,M),T=_.get(O,M),x=C.get(O,M),v=E.get(O,M),L=p.get(O,M),{isError:D,errorObject:Y,variants:ee}=F(b,V,T,x,v,L);if(D)return Y;const[ue,H,Z,Ne,Re,Se]=ee,de=+ue.getValue(),Fe=+H.getValue(),Et=+Z.getValue(),$t=+Ne.getValue();let Yt=+Re.getValue();const ct=+Se.getValue();if(Yt=Yt?1:0,de<=0)return f.create(g.NUM);const fh=Fe>=0&&Et>=0&&$t>=0,dh=Fe<=0&&Et<=0&&$t<=0;return fh||dh?f.create(g.NUM):this._getResult(de,Fe,Et,$t,Yt,ct,O,M)});return c===1&&h===1?y.get(0,0):y}_getResult(e,t,r,n,s,u,o,i){if(Math.abs(t)<1e-14)return this._computeSimpleGrowthRate(e,r,n,o,i);let l=u,c=Number.POSITIVE_INFINITY;for(let h=0;h<100;h++){if(l<=-1)return f.create(g.NUM);const{value:m,derivative:d}=this._evaluateRateFunction(l,e,t,r,n,s,1e-10),_=Math.abs(m);if(_<1e-10||Math.abs(d)<1e-14)break;const C=this._getAdaptiveDampedStep(m,d,_,c);l-=C,c=_}return!Number.isFinite(l)||l<=-1?f.create(g.NUM):A.create(l,o===0&&i===0?"0%":void 0)}_computeSimpleGrowthRate(e,t,r,n,s){if(Math.sign(t)===Math.sign(r))return f.create(g.NUM);const u=(r/-t)**(1/e)-1;return A.create(u,n===0&&s===0?"0%":void 0)}_evaluateRateFunction(e,t,r,n,s,u,o){let i,l,c;if(Math.abs(e)<o)i=n*(1+t*e)+r*(1+e*u)*t+s,l=n*t+r*u*t;else{c=(1+e)**t,i=n*c+r*(1/e+u)*(c-1)+s;const h=t*(1+e)**(t-1);l=n*h+r*(1/e+u)*h+r*(-1/(e*e))*(c-1)}return{value:i,derivative:l}}_getAdaptiveDampedStep(e,t,r,n){const s=e/t;return r>.001||r>=n*.9?Math.max(Math.min(s,5),-5):Math.max(Math.min(s,.5),-.5)}}class vN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){let u=s??A.create(0);u.isNull()&&(u=A.create(0));const{isError:o,errorObject:i,variants:l}=He(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||C>=E)return f.create(g.NUM);const{days:O,yearDays:M}=Ee(C,E,b),V=p/(1-y*O/M);return V<0?f.create(g.NUM):A.create(V)}}class wN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",6)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.map((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m),{isError:C,errorObject:E,variants:p}=F(c,d,_);if(C)return E;const[y,b,O]=p,M=+y.getValue(),V=+b.getValue(),T=+O.getValue();if(M<=0)return f.create(g.NUM);if(V===0&&T===0)return A.create(0);const x=(T/V)**(1/M)-1;return Number.isNaN(x)||!Number.isFinite(x)||T/V<0?f.create(g.NUM):A.create(x)});return n===1&&s===1?l.get(0,0):l}}class DN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3),N(this,"needsLocale",!0)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.map((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);if(d.isError())return d;if(_.isError())return _;const C=+c.getValue(),E=+d.getValue(),p=+_.getValue();if(Number.isNaN(C)||Number.isNaN(E)||Number.isNaN(p))return f.create(g.VALUE);if(p===0)return f.create(g.DIV_BY_ZERO);const y=(C-E)/p;return h===0&&m===0?A.create(y,tt(this.getLocale())):A.create(y)});return n===1&&s===1?l.get(0,0):l}}class LN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4),N(this,"needsLocale",!0)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.map((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);if(C.isError())return C;if(E.isError())return E;if(p.isError())return p;const y=+m.getValue(),b=+C.getValue(),O=+E.getValue(),M=+p.getValue();if(Number.isNaN(y)||Number.isNaN(b)||Number.isNaN(O)||Number.isNaN(M))return f.create(g.VALUE);if(b<0||O<=0||M>O)return f.create(g.NUM);const V=(y-b)*(O-M+1)*2/(O*(O+1));return d===0&&_===0?A.create(V,tt(this.getLocale())):A.create(V)});return s===1&&u===1?h.get(0,0):h}}class PN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:u}=He(e,t,r);if(n)return s;const[o,i,l]=u,c=$(o);if(typeof c!="number")return c;const h=$(i);if(typeof h!="number")return h;const m=+l.getValue();if(Number.isNaN(m))return f.create(g.VALUE);if(m<=0||c>=h)return f.create(g.NUM);const d=Math.floor(h)-Math.floor(c),_=se(c).getUTCFullYear(),C=$s(_);if(d>C)return f.create(g.NUM);let E=365*m/(360-m*d);if(d>182){const p=100*(1-m*d/360),y=d/365;if(E=(-y+Math.sqrt(y*y-(y*2-1)*(1-100/p)))/(y-.5),Number.isNaN(E))return f.create(g.NUM)}return E<0?f.create(g.NUM):A.create(E)}}class FN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3),N(this,"needsLocale",!0)}calculate(e,t,r){const{isError:n,errorObject:s,variants:u}=He(e,t,r);if(n)return s;const[o,i,l]=u,c=$(o);if(typeof c!="number")return c;const h=$(i);if(typeof h!="number")return h;const m=+l.getValue();if(Number.isNaN(m))return f.create(g.VALUE);if(m<=0||c>=h)return f.create(g.NUM);const d=Math.floor(h)-Math.floor(c),_=se(c).getUTCFullYear(),C=$s(_);if(d>C)return f.create(g.NUM);const E=100*(1-m*d/360);return E<0?f.create(g.NUM):A.create(E,tt(this.getLocale()))}}class jN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:u}=He(e,t,r);if(n)return s;const[o,i,l]=u,c=$(o);if(typeof c!="number")return c;const h=$(i);if(typeof h!="number")return h;const m=+l.getValue();if(Number.isNaN(m))return f.create(g.VALUE);if(m<=0||c>=h)return f.create(g.NUM);const d=Math.floor(h)-Math.floor(c),_=se(c).getUTCFullYear(),C=$s(_);if(d>C)return f.create(g.NUM);const E=(100-m)/m*360/d;return A.create(E)}}class BN extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",7),N(this,"needsLocale",!0)}calculate(e,t,r,n,s,u,o){let i=u??A.create(2);i.isNull()&&(i=A.create(2));let l=o??P.create(!1);l.isNull()&&(l=P.create(!1));const c=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1,i.isArray()?i.getRowCount():1,l.isArray()?l.getRowCount():1),h=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1,i.isArray()?i.getColumnCount():1,l.isArray()?l.getColumnCount():1),m=S(c,h,e,f.create(g.NA)),d=S(c,h,t,f.create(g.NA)),_=S(c,h,r,f.create(g.NA)),C=S(c,h,n,f.create(g.NA)),E=S(c,h,s,f.create(g.NA)),p=S(c,h,i,f.create(g.NA)),y=S(c,h,l,f.create(g.NA));return this._getResultArray(m,d,_,C,E,p,y,c,h)}_getResultArray(e,t,r,n,s,u,o,i,l){const c=e.map((h,m,d)=>{const _=t.get(m,d),C=r.get(m,d),E=n.get(m,d),p=s.get(m,d),y=u.get(m,d),b=o.get(m,d),{isError:O,errorObject:M,variants:V}=F(h,_,C,E,p,y,b);if(O)return M;const[T,x,v,L,D,Y,ee]=V,ue=+T.getValue(),H=+x.getValue(),Z=+v.getValue(),Ne=+L.getValue(),Re=+D.getValue(),Se=+Y.getValue(),de=+ee.getValue();if(ue<0||H<0||Z<0||Ne<0||Re<0||Re>Z||Ne>Re||Se<0)return f.create(g.NUM);if(Z===0&&Ne===0&&Re===0)return f.create(g.DIV_BY_ZERO);const Fe=this._getResult(ue,H,Z,Ne,Re,Se,de);return m===0&&d===0?A.create(Fe,tt(this.getLocale())):A.create(Fe)});return i===1&&l===1?c.get(0,0):c}_getResult(e,t,r,n,s,u,o){const i=Math.floor(n),l=Math.ceil(s);let c=0;if(e<t){if(n>=1||o)return c;const h=Math.abs(e-t);return c=h*(s-n)>h?h:h*(s-n),-c}if(o)for(let h=i+1;h<=l;h++){let m=su(e,t,r,h,u);h===i+1?m*=Math.min(s,i+1)-n:h===l&&(m*=s+1-l),c+=m}else{const h=e-this._getVdb(e,t,r,r,n,u);c=this._getVdb(h,t,r,r-n,s-n,u)}return c}_getVdb(e,t,r,n,s,u){const o=Math.ceil(s);let i=0,l=e-t,c=0,h=0,m=!1;for(let d=1;d<=o;d++){if(m)h=c;else{const _=su(e,t,r,d,u);c=l/(n-(d-1)),c>_?(h=c,m=!0):(h=_,l-=_)}d===o&&(h*=s+1-o),i+=h}return i}}class kN extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return f.create(g.NA);const{isError:n,errorObejct:s,_values:u,_dates:o}=this._checkErrors(e,t);if(n)return s;let i=r??A.create(.1);i.isNull()&&(i=A.create(.1));const{isError:l,errorObject:c,variants:h}=G(i);if(l)return c;const[m]=h,d=+m.getValue();if(Number.isNaN(d))return f.create(g.VALUE);const{positive:_,negative:C}=this._checkValues(u);if(!_||!C||u?.length!==o?.length||d<0)return f.create(g.NUM);const E=oo(d,p=>this._iterF(u,o,p));return typeof E!="number"?E:A.create(E)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:u,errorObejct:o,_dates:i}=this._checkErrorDates(t);return u?{isError:u,errorObejct:o}:{isError:!1,_values:s,_dates:i}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);return e.iterator(s=>{const u=s;if(u.isError())return r=!0,n=u,!1;if(u.isBoolean())return r=!0,n=f.create(g.VALUE),!1;const o=+u.getValue();if(Number.isNaN(o))return r=!0,n=f.create(g.VALUE),!1;t.push(o)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:f.create(g.NA)}:{isError:r,_values:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!Q(r)?{isError:!0,errorObejct:f.create(g.VALUE)}:{isError:!0,errorObejct:f.create(g.NA)}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);return e.iterator(s=>{if(s!=null&&s.isError())return r=!0,n=s,!1;if(s!=null&&s.isBoolean())return r=!0,n=f.create(g.VALUE),!1;const u=+s.getValue();if(Number.isNaN(u))return r=!0,n=f.create(g.VALUE),!1;if(u<0)return r=!0,n=f.create(g.NUM),!1;t.push(Math.floor(u))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:f.create(g.NA)}:{isError:r,_dates:t}}else{const r=e.getValue();return e.isBoolean()||e.isString()&&!Q(r)?{isError:!0,errorObejct:f.create(g.VALUE)}:+r<0?{isError:!0,errorObejct:f.create(g.NUM)}:{isError:!0,errorObejct:f.create(g.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((n,s,u)=>n+s/(1+r)**((t[u]-t[0])/365),0)}}class $N extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return f.create(g.NA);const{isError:n,errorObject:s,variants:u}=G(e);if(n)return s;const[o]=u,i=+o.getValue();if(Number.isNaN(i))return f.create(g.VALUE);let{isError:l,errorObejct:c,_values:h,_dates:m}=this._checkErrors(t,r);if(l)return c;if(h=h,m=m,i<0||h.length!==m.length)return f.create(g.NUM);let d=0;const _=m[0];for(let C=0;C<m.length;C++){const E=m[C],p=h[C];d+=p/(1+i)**((E-_)/365)}return A.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};const{isError:r,errorObejct:n,_values:s}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};const{isError:u,errorObejct:o,_dates:i}=this._checkErrorDates(t);return u?{isError:u,errorObejct:o}:{isError:!1,_values:s,_dates:i}}_checkErrorValues(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);return e.iterator(s=>{const u=s;if(u.isError())return r=!0,n=u,!1;if(u.isNull()||u.isBoolean()||u.isString()&&u.getValue()==="")return r=!0,n=f.create(g.VALUE),!1;const o=+u.getValue();if(Number.isNaN(o))return r=!0,n=f.create(g.VALUE),!1;t.push(o)}),r?{isError:r,errorObejct:n}:{isError:r,_values:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:f.create(g.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:f.create(g.VALUE)}:{isError:!1,_values:[r]}}}_checkErrorDates(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);return e.iterator(s=>{const u=s;if(u.isError())return r=!0,n=u,!1;if(u.isNull()||u.isBoolean())return r=!0,n=f.create(g.VALUE),!1;const o=+u.getValue();if(Number.isNaN(o))return r=!0,n=f.create(g.VALUE),!1;if(o<0)return r=!0,n=f.create(g.NUM),!1;t.push(Math.floor(o))}),r?{isError:r,errorObejct:n}:{isError:r,_dates:t}}else{if(e.isError())return{isError:!0,errorObejct:e};if(e.isNull()||e.isBoolean())return{isError:!0,errorObejct:f.create(g.VALUE)};const r=+e.getValue();return Number.isNaN(r)?{isError:!0,errorObejct:f.create(g.VALUE)}:+r<0?{isError:!0,errorObejct:f.create(g.NUM)}:{isError:!1,_dates:[Math.floor(r)]}}}}class YN extends R{constructor(){super(...arguments),N(this,"minParams",6),N(this,"maxParams",7)}calculate(e,t,r,n,s,u,o){let i=o??A.create(0);i.isNull()&&(i=A.create(0));const{isError:l,errorObject:c,variants:h}=He(e,t,r,n,s,u,i);if(l)return c;const[m,d,_,C,E,p,y]=h,b=$(m);if(typeof b!="number")return b;const O=$(d);if(typeof O!="number")return O;const M=+_.getValue(),V=+C.getValue(),T=+E.getValue(),x=Math.floor(+p.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(M)||Number.isNaN(V)||Number.isNaN(T)||Number.isNaN(x)||Number.isNaN(v))return f.create(g.VALUE);if(M<0||V<=0||T<=0||![1,2,4].includes(x)||v<0||v>4||b>=O||!qr(b,O,x))return f.create(g.NUM);const L=this._getResult(b,O,M,V,T,x,v);return A.create(L)}_getResult(e,t,r,n,s,u,o){if(Er(e,t,u)>1){let m=r||.01,d=Jn(e,t,r,m,s,u,o),_=d-n;for(let C=0;C<100&&Math.abs(_)>1e-7;C++)d=Jn(e,t,r,1.01*m,s,u,o),m+=-_/(d-n-_)*m*.01,_=Jn(e,t,r,m,s,u,o)-n;return m}const i=ma(e,t,u,o),l=et(e,t,u,o),{days:c}=Ee(e,t,o),h=n/100+i/l*r/u;return(s/100+r/u-h)/h*u*l/c}}class HN extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",5)}calculate(e,t,r,n,s){let u=s??A.create(0);u.isNull()&&(u=A.create(0));const{isError:o,errorObject:i,variants:l}=He(e,t,r,n,u);if(o)return i;const[c,h,m,d,_]=l,C=$(c);if(typeof C!="number")return C;const E=$(h);if(typeof E!="number")return E;const p=+m.getValue(),y=+d.getValue(),b=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);if(p<=0||y<=0||b<0||b>4||C>=E)return f.create(g.NUM);const{days:O,yearDays:M}=Ee(C,E,b),V=(y/p-1)/(O/M);return A.create(V)}}class GN extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=u??A.create(0);o.isNull()&&(o=A.create(0));const{isError:i,errorObject:l,variants:c}=He(e,t,r,n,s,o);if(i)return l;const[h,m,d,_,C,E]=c,p=$(h);if(typeof p!="number")return p;const y=$(m);if(typeof y!="number")return y;const b=$(d);if(typeof b!="number")return b;const O=+_.getValue(),M=+C.getValue(),V=Math.floor(+E.getValue());if(Number.isNaN(O)||Number.isNaN(M)||Number.isNaN(V))return f.create(g.VALUE);const T=this._getDateCorrectOrder(y,p,b);if(O<0||M<=0||V<0||V>4||!T)return f.create(g.NUM);const x=Mi(p,V),{days:v}=Ee(p,y,V),{days:L}=Ee(b,y,V),{days:D}=Ee(b,p,V),Y=((1+L/x*O)/(M/100+D/x*O)-1)/(v/x);return A.create(Y)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}}const Gc=[[X0,J.ACCRINT],[q0,J.ACCRINTM],[W0,J.AMORLINC],[Q0,J.COUPDAYBS],[K0,J.COUPDAYS],[Z0,J.COUPDAYSNC],[z0,J.COUPNCD],[J0,J.COUPNUM],[eN,J.COUPPCD],[tN,J.CUMIPMT],[rN,J.CUMPRINC],[nN,J.DB],[sN,J.DDB],[aN,J.DISC],[uN,J.DOLLARDE],[oN,J.DOLLARFR],[iN,J.DURATION],[lN,J.EFFECT],[cN,J.FV],[hN,J.FVSCHEDULE],[mN,J.INTRATE],[gN,J.IPMT],[fN,J.IRR],[dN,J.ISPMT],[NN,J.MDURATION],[_N,J.MIRR],[CN,J.NOMINAL],[EN,J.NPER],[AN,J.NPV],[pN,J.ODDFPRICE],[yN,J.ODDFYIELD],[bN,J.ODDLPRICE],[RN,J.ODDLYIELD],[SN,J.PDURATION],[ON,J.PMT],[MN,J.PPMT],[VN,J.PRICE],[TN,J.PRICEDISC],[IN,J.PRICEMAT],[xN,J.PV],[UN,J.RATE],[vN,J.RECEIVED],[wN,J.RRI],[DN,J.SLN],[LN,J.SYD],[PN,J.TBILLEQ],[FN,J.TBILLPRICE],[jN,J.TBILLYIELD],[BN,J.VDB],[kN,J.XIRR],[$N,J.XNPV],[YN,J.YIELD],[HN,J.YIELDDISC],[GN,J.YIELDMAT]];class XN extends R{constructor(){super(...arguments),N(this,"needsReferenceObject",!0),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){const n=r.getRowCount(),s=r.getColumnCount();if(n===1&&s===1){const u=r.get(0,0);return this._handleSingleObject(u,t)}return r.map(u=>u.isError()?u:this._handleSingleObject(u,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n=t;if(n.isError())return n;if(!n.isReferenceObject())return f.create(g.NA);const s=n.getCurrentActiveSheetData(),{columnData:u,defaultColumnWidth:o}=s;n=n.toArrayValueObject();const i=n.getCurrentRow(),l=n.getCurrentColumn();n=n.getFirstCell();const c=`${e.getValue()}`;let h;switch(c.toLocaleLowerCase()){case"address":return w.create(`$${Xe.chatAtABC(l)}$${i+1}`);case"col":return A.create(l+1);case"color":return A.create(0);case"contents":return n;case"filename":return f.create(g.VALUE);case"format":return w.create("G");case"parentheses":return A.create(0);case"prefix":return w.create("");case"protect":return A.create(1);case"row":return A.create(i+1);case"type":return h="v",n.isNull()&&(h="b"),n.isString()&&(h="l"),w.create(h);case"width":return this._getWidthResult(u,o,l,r);default:return f.create(g.VALUE)}}_getWidthResult(e,t,r,n){var s;let u=(s=e[r])==null?void 0:s.w;if(!u&&u!==0&&(u=t),n)return A.create(u);const o=[[u,u===t]];return W.createByArray(o)}}class qN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"_errorTypeValueMap",new Map([[g.NULL,1],[g.DIV_BY_ZERO,2],[g.VALUE,3],[g.REF,4],[g.NAME,5],[g.NUM,6],[g.NA,7],[g.CONNECT,8],[g.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?A.create(r):f.create(g.NA)}}class WN extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=n??P.create(!0),o=s??P.create(!0),{isError:i,errorObject:l,variants:c}=Vn(e,t,r,u,o);if(i)return l;const[h,m,d,_,C]=c;if(_.isString()||C.isString())return f.create(g.VALUE);if(m.compare(d,">").getValue()===!0)return f.create(g.NUM);const E=+_.getValue(),p=+C.getValue(),y=E?">=":">",b=p?"<=":"<";return h.compare(m,y).getValue()===!1||h.compare(d,b).getValue()===!1?P.create(!1):P.create(!0)}}class QN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isNull()?P.create(!0):e.isArray()?e.mapValue(t=>t.isNull()?P.create(!0):P.create(!1)):P.create(!1)}}class KN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return f.create(g.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&t.getPattern()!==""?P.create(_u(t.getPattern())):t.isString()&&(us(`${t.getValue()}`)||os(`${t.getValue()}`))?P.create(!0):P.create(!1)}}class ZN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const u=t.getRowCount(),o=t.getColumnCount();if(u>1||o>1)return f.create(g.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return P.create(!1);const r=`${t.getValue()}`;if(r.length>254)return P.create(!1);const n=Xe.topLevelDomainCombiningString(),s=new RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return P.create(s.test(r))}}class zN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.getValue()===g.NA?P.create(!1):e.isError()?P.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===g.NA?P.create(!1):t.isError()?P.create(!0):P.create(!1)):P.create(!1)}}class JN extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?P.create(!0):e.isArray()?e.mapValue(t=>t.isError()?P.create(!0):P.create(!1)):P.create(!1)}}class e_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),u=t.getColumnCount();if(s>1||u>1)return f.create(g.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return f.create(g.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return f.create(g.VALUE);const n=r%2===0;return P.create(n)}}class t_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return f.create(g.NA);const r=(t=e.getCurrentActiveSheetData())==null?void 0:t.cellData.getMatrix(),{startRow:n,startColumn:s}=e.getRangePosition(),u=e.toArrayValueObject(),o=u.mapValue((i,l,c)=>{var h;const m=(h=r?.[n+l])==null?void 0:h[s+c];return m!=null&&m.f||m!=null&&m.si?P.create(!0):P.create(!1)});return u.getRowCount()===1&&u.getColumnCount()===1?o.get(0,0):o}}class r_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isBoolean()?P.create(!0):e.isArray()?e.mapValue(t=>t.isBoolean()?P.create(!0):P.create(!1)):P.create(!1)}}class n_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.getValue()===g.NA?P.create(!0):e.isArray()?e.mapValue(t=>t.getValue()===g.NA?P.create(!0):P.create(!1)):P.create(!1)}}class s_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return!e.isArray()&&!e.isString()?P.create(!0):e.isArray()?e.mapValue(t=>t.isString()?P.create(!1):P.create(!0)):P.create(!1)}}class a_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isNumber()?P.create(!0):e.isArray()?e.mapValue(t=>t.isNumber()?P.create(!0):P.create(!1)):P.create(!1)}}class u_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),u=t.getColumnCount();if(s>1||u>1)return f.create(g.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return f.create(g.VALUE);const r=Math.trunc(+t.getValue());if(Number.isNaN(r))return f.create(g.VALUE);const n=r%2!==0;return P.create(n)}}class o_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?P.create(!0):P.create(!1)}}class i_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isString()?P.create(!0):e.isArray()?e.mapValue(t=>t.isString()?P.create(!0):P.create(!1)):P.create(!1)}}class l_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const u=t.getRowCount(),o=t.getColumnCount();if(u>1||o>1)return f.create(g.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return P.create(!1);const r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return P.create(!1);const n=Xe.topLevelDomainCombiningString(),s=new RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return P.create(s.test(r))}}class c_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return A.create(0);const r=+t.getValue();return A.create(r)}}class h_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){return f.create(g.NA)}}class m_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",1),N(this,"needsReferenceObject",!0),N(this,"needsSheetsInfo",!0)}calculate(e){var t;if(e!=null&&e.isError())return e;const{sheetOrder:r,sheetNameMap:n}=this.getSheetsInfo();if(!e){const i=r.findIndex(l=>l===this.subUnitId);return A.create(i+1)}if(e.isReferenceObject()){const i=e.getForcedSheetId(),l=e.getDefaultSheetId(),c=r.findIndex(h=>i?h===i:h===l);return A.create(c+1)}if(e.isArray())return f.create(g.NA);const s=`${e.getValue()}`.toLocaleLowerCase(),u=(t=Object.entries(n).find(([i,l])=>l.toLocaleLowerCase()===s))==null?void 0:t[0];if(!u)return f.create(g.NA);const o=r.findIndex(i=>i===u);return A.create(o+1)}}class g_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0),N(this,"needsSheetsInfo",!0)}calculate(){const{sheetOrder:e}=this.getSheetsInfo();return A.create(e.length)}}class f_ extends R{constructor(){super(...arguments),N(this,"needsReferenceObject",!0),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){const t=e.getRowCount(),r=e.getColumnCount();if(t===1&&r===1){const n=e.getFirstCell();if(n.isError())return A.create(16);if(n.isBoolean())return A.create(4);if(n.isString())return A.create(2);if(n.isNumber()||n.isNull())return A.create(1)}else return A.create(64)}else{if(e.isArray())return A.create(64);if(e.isError())return A.create(16);if(e.isBoolean())return A.create(4);if(e.isString())return A.create(2);if(e.isNumber()||e.isNull())return A.create(1)}return A.create(128)}}const Xc=[[XN,ye.CELL],[qN,ye.ERROR_TYPE],[WN,ye.ISBETWEEN],[QN,ye.ISBLANK],[KN,ye.ISDATE],[ZN,ye.ISEMAIL],[zN,ye.ISERR],[JN,ye.ISERROR],[e_,ye.ISEVEN],[t_,ye.ISFORMULA],[r_,ye.ISLOGICAL],[n_,ye.ISNA],[s_,ye.ISNONTEXT],[a_,ye.ISNUMBER],[u_,ye.ISODD],[o_,ye.ISREF],[i_,ye.ISTEXT],[l_,ye.ISURL],[c_,ye.N],[h_,ye.NA],[m_,ye.SHEET],[g_,ye.SHEETS],[f_,ye.TYPE]];class d_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(u=>{if(u!=null&&u.isError())return n=u,!1;(u!=null&&u.isBoolean()||u!=null&&u.isNumber())&&(t=t&&!!u.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t&&!!s.getValue(),r=!1)}return r?f.create(g.VALUE):P.create(t)}}class N_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2),N(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return f.create(g.VALUE);const s=t,u=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;r=S(u,o,r);const i=[[]];for(let l=0;l<o;l++){const c=[];for(let d=0;d<u;d++){const _=r.get(d,l);c.push([_])}let h=W.create({calculateValueList:c,rowCount:u,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:d,startColumn:_}=n.getRangePosition(),C={startRow:d,startColumn:_+l,endRow:d+u-1,endColumn:_+l};h=this.createReferenceObject(n,C)}let m=s.execute(h);if(m.isArray()){const d=m.getRowCount(),_=m.getColumnCount();if(d>1||_>1)return f.create(g.CALC);m=m.get(0,0)}m.isNull()&&(m=A.create(0)),i[0].push(m)}return o===1?i[0][0]:W.create({calculateValueList:i,rowCount:1,columnCount:o,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class __ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2),N(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&t.getLambdaPrivacyVarKeys().length===1))return f.create(g.VALUE);const s=t,u=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;r=S(u,o,r);const i=[];for(let l=0;l<u;l++){const c=[[]];for(let d=0;d<o;d++){const _=r.get(l,d);c[0].push(_)}let h=W.create({calculateValueList:c,rowCount:1,columnCount:o,unitId:"",sheetId:"",row:0,column:0});if(n){const{startRow:d,startColumn:_}=n.getRangePosition(),C={startRow:d+l,startColumn:_,endRow:d+l,endColumn:_+o-1};h=this.createReferenceObject(n,C)}let m=s.execute(h);if(m.isArray()){const d=m.getRowCount(),_=m.getColumnCount();if(d>1||_>1)return f.create(g.CALC);m=m.get(0,0)}m.isNull()&&(m=A.create(0)),i.push([m])}return u===1?i[0][0]:W.create({calculateValueList:i,rowCount:u,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class C_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){return P.create(!1)}}class E_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r=P.create(!1)){let n=e;if(e.isArray()){const c=e.getRowCount(),h=e.getColumnCount();c===1&&h===1&&(n=e.get(0,0))}if(!n.isArray())return this._handleSingleObject(n,t,r);const s=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),o=S(s,u,n,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA));return o.mapValue((c,h,m)=>{const d=i.get(h,m),_=l.get(h,m);return this._handleSingleObject(c,d,_)})}_handleSingleObject(e,t,r){return e.isError()?e:e.getValue()?t:r}}class A_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e),u=S(r,n,t);return s.iterator((o,i,l)=>{o!=null&&o.isError()&&s.set(i,l,u.get(i,l))}),s}}class p_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==g.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===g.NA?t:e;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e),u=S(r,n,t);return s.iterator((o,i,l)=>{o!=null&&o.isError()&&o.getErrorType()===g.NA&&s.set(i,l,u.get(i,l))}),s}}class y_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255)}calculate(...e){if(e.length%2!==0)return f.create(g.NA);for(let u=0;u<e.length;u++)if(e[u].isError())return e[u];const t=Math.max(...e.map(u=>u.isArray()?u.getRowCount():1)),r=Math.max(...e.map(u=>u.isArray()?u.getColumnCount():1)),n=e.map(u=>S(t,r,u,f.create(g.NA))),s=n[0].map((u,o,i)=>{for(let l=0;l<n.length;l+=2){const c=n[l].get(o,i)||ce.create(),h=n[l+1].get(o,i)||ce.create();if(c.isNull())continue;if(c.isError())return c;const m=c.getValue();if(c.isString()){if(`${m}`.toLocaleUpperCase()==="TRUE")return h;if(`${m}`.toLocaleUpperCase()==="FALSE")continue;return f.create(g.VALUE)}if(+m)return h.isNull()?f.create(g.NA):h}return f.create(g.NA)});return t===1&&r===1?s.get(0,0):s}}class b_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){return f.create(g.VALUE)}}class R_ extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255)}calculate(...e){return f.create(g.VALUE)}}class S_ extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(...e){const t=this.getIndexNumValue(e[0]);if(typeof t!="number")return t;const r=this.getIndexNumValue(e[1]);if(typeof r!="number")return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return f.create(g.VALUE);const n=e[2],s=[];for(let u=0;u<t;u++){s[u]==null&&(s[u]=[]);for(let o=0;o<r;o++){let i=n.execute(A.create(u+1),A.create(o+1));i.isArray()&&(i=i.get(0,0)),s[u][o]=i}}return new Cl(s)}isAsync(){return!0}}let O_=class extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(...a){const e=[];let t=null,r=0,n=0;for(let u=0;u<a.length;u++){const o=a[u];let i=o;if(i.isReferenceObject()&&(i=o.toArrayValueObject()),i.isError())return i;if(u===a.length-1){if(!(o.isValueObject()&&o.isLambda()))return f.create(g.VALUE);t=o}else e.push(o),r=Math.max(r,i.isArray()?i.getRowCount():1),n=Math.max(n,i.isArray()?i.getColumnCount():1)}const s=this._getResultArray(e,t,r,n);return s instanceof f?s:r===1&&n===1?s[0][0]:W.create({calculateValueList:s,rowCount:r,columnCount:n,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(a,e,t,r){const n=[];for(let s=0;s<t;s++){const u=[];for(let o=0;o<r;o++){const i=[];let l=!1;for(let h=0;h<a.length;h++){let m=a[h],d=null;if(m.isReferenceObject()&&(d=m,m=m.toArrayValueObject()),!m.isArray())if(s===0&&o===0){i.push(d||m);continue}else{u.push(f.create(g.NA)),l=!0;break}let _=m.get(s,o);if(!_){u.push(f.create(g.NA)),l=!0;break}if(d){const{startRow:C,startColumn:E}=d.getRangePosition(),p={startRow:C+s,startColumn:E+o,endRow:C+s,endColumn:E+o};_=this.createReferenceObject(d,p)}i.push(_)}if(l||i.length===0)continue;let c=e.execute(...i);if(c.isArray()){const h=c.getRowCount(),m=c.getColumnCount();if(h>1||m>1)return f.create(g.CALC);c=c.get(0,0)}c.isNull()&&(c=A.create(0)),u.push(c)}n.push(u)}return n}};class M_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=+e.getValue();return Number.isNaN(t)?f.create(g.VALUE):P.create(!t)}}class V_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(u=>{if(u!=null&&u.isError())return n=u,!1;(u!=null&&u.isBoolean()||u!=null&&u.isNumber())&&(t=t||!!u.getValue(),r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(t=t||!!s.getValue(),r=!1)}return r?new f(g.VALUE):new P(t)}}class T_ extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,s;e.isReferenceObject()?(n=e.toArrayValueObject(),s=e):(n=e,s=null);let u,o;return t.isReferenceObject()?(u=t.toArrayValueObject(),o=t):(u=t,o=null),n.isArray()?n.mapValue(i=>this._handleSingleValueObject(i,u,r,s,o)):this._handleSingleValueObject(n,u,r,s,o)}_handleSingleValueObject(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return f.create(g.VALUE);const u=r,o=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let c=0;c<o;c++)for(let h=0;h<i;h++){let m=t.isArray()?t.get(c,h):t;if(m.isError())return m;if(s){const{startRow:_,startColumn:C}=s.getRangePosition(),E={startRow:_+c,startColumn:C+h,endRow:_+c,endColumn:C+h};m=this.createReferenceObject(s,E)}let d=u.execute(l,m);if(d.isError())return d;d.isNull()&&(d=A.create(0)),l=d}return l.isReferenceObject()?l.toArrayValueObject():l}}class I_ extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,s=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),s=e),n=n;let u=t,o=null;if(t.isReferenceObject()&&(u=t.toArrayValueObject(),o=t),u=u,n.isError())return n;if(u.isError())return u;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&r.getLambdaPrivacyVarKeys().length===2))return f.create(g.VALUE);if(n.isArray()){const i=n.getRowCount(),l=n.getColumnCount();if(i>1||l>1)return f.create(g.CALC);n=n.get(0,0)}return this._getResult(n,u,r,s,o)}_getResult(e,t,r,n,s){const u=[],o=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;let l=e;n&&(l=n);for(let c=0;c<o;c++){const h=[];for(let m=0;m<i;m++){if(l.isError()){h.push(l);continue}let d=t.isArray()?t.get(c,m):t;if(d.isError()){l=d,h.push(d);continue}if(s){const{startRow:C,startColumn:E}=s.getRangePosition(),p={startRow:C+c,startColumn:E+m,endRow:C+c,endColumn:E+m};d=this.createReferenceObject(s,p)}let _=r.execute(l,d);if(_.isArray()){const C=_.getRowCount(),E=_.getColumnCount();if(C>1||E>1)return f.create(g.CALC);_=_.get(0,0)}_.isNull()&&(_=A.create(0)),l=_,h.push(_)}u.push(h)}return o===1&&i===1?u[0][0]:W.create({calculateValueList:u,rowCount:o,columnCount:i,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class x_ extends R{constructor(){super(...arguments),N(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;const r=t.length%2!==0,n=r?t[t.length-1]:ce.create();return!e.isArray()&&!t.some(s=>s.isArray())?this._handleNonArrayInputs(e,t,n,r):this._handleArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let s=0;s<t.length-(n?1:0);s+=2){const u=t[s],o=t[s+1];if(!u.isNull()){if(u.isError())return u;if(`${e.getValue()}`.toLocaleLowerCase()===`${u.getValue()}`.toLocaleLowerCase())return o.isNull()?f.create(g.NA):o}}return r.isNull()?f.create(g.NA):r}_handleArrayInputs(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,...t.map(c=>c.isArray()?c.getRowCount():1),r.isArray()?r.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,...t.map(c=>c.isArray()?c.getColumnCount():1),r.isArray()?r.getColumnCount():1),o=S(s,u,e),i=t.map(c=>S(s,u,c,f.create(g.NA))),l=S(s,u,r,f.create(g.NA));return o.map((c,h,m)=>{for(let _=0;_<i.length-(n?1:0);_+=2){const C=i[_].get(h,m)||ce.create(),E=i[_+1].get(h,m)||ce.create();if(!C.isNull()){if(C.isError()||c.isError())return C.isError()?C:c;if(`${c.getValue()}`.toLocaleLowerCase()===`${C.getValue()}`.toLocaleLowerCase())return E.isNull()?f.create(g.NA):E}}const d=l.get(h,m)||ce.create();return d.isNull()?f.create(g.NA):d})}}class U_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){return P.create(!0)}}class v_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(const s of e){if(s.isError())return s;if(s.isArray()){if(s.iterator(u=>{if(u!=null&&u.isError())return n=u,!1;(u!=null&&u.isBoolean()||u!=null&&u.isNumber())&&(u.getValue()&&t++,r=!1)}),n)return n}else(s.isBoolean()||s.isNumber())&&(s.getValue()&&t++,r=!1)}return r?f.create(g.VALUE):P.create(t%2===1)}}const qc=[[d_,Ce.AND],[N_,Ce.BYCOL],[__,Ce.BYROW],[C_,Ce.FALSE],[E_,Ce.IF],[A_,Ce.IFERROR],[p_,Ce.IFNA],[y_,Ce.IFS],[b_,Ce.LAMBDA],[R_,Ce.LET],[S_,Ce.MAKEARRAY],[O_,Ce.MAP],[M_,Ce.NOT],[V_,Ce.OR],[T_,Ce.REDUCE],[I_,Ce.SCAN],[x_,Ce.SWITCH],[U_,Ce.TRUE],[v_,Ce.XOR]];class w_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",5)}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const u=r??A.create(1),o=n??P.create(!0),i=s??w.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,e,f.create(g.NA)),m=S(l,c,t,f.create(g.NA)),d=S(l,c,u,f.create(g.NA)),_=S(l,c,o,f.create(g.NA)),C=S(l,c,i,f.create(g.NA));return h.map((E,p,y)=>{const b=m.get(p,y)||f.create(g.NA),O=d.get(p,y)||f.create(g.NA),M=_.get(p,y)||f.create(g.NA),V=C.get(p,y)||f.create(g.NA);return E.isError()?E:b.isError()?b:O.isError()?O:M.isError()?M:V.isError()?V:this._calculateSingleCell(E,b,O,M,V)})}_calculateSingleCell(e,t,r,n,s){const u=Number.parseInt(`${Number(e.getValue())-1}`),o=Number.parseInt(`${Number(t.getValue())-1}`),i=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(u)||Number.isNaN(o)||Number.isNaN(i)||i<1||i>4)return f.create(g.VALUE);const l=D_(i),c=this.getZeroOrOneByOneDefault(n),h=`${s.getValue()}`,m=Hi(h),d={startRow:u,startColumn:o,endRow:u,endColumn:o,startAbsoluteRefType:l,endAbsoluteRefType:l},_=n&&!c?_d(d):Pt(d);return w.create(m!==""?`${m}!${_}`:_)}}function D_(a){switch(a){case 1:return xe.ALL;case 2:return xe.ROW;case 3:return xe.COLUMN;case 4:return xe.NONE;default:return xe.ALL}}class L_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?A.create(1):f.create(g.VALUE)}}class P_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){const i=r.convertToNumberObjectValue();return i.isError()?i:t[Math.trunc(+i.getValue())-1]||f.create(g.VALUE)}let n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;t.forEach((i,l)=>{if(i.isArray()){const c=i;n=Math.max(n,c.getRowCount()),s=Math.max(s,c.getColumnCount())}else n=Math.max(n,1),s=Math.max(s,1)});const u=S(n,s,r,f.create(g.NA)),o=t.map(i=>{let l=i;return l.isReferenceObject()&&(l=l.toArrayValueObject()),S(n,s,l,f.create(g.NA))});return u.map((i,l,c)=>{if(i.isError())return i;const h=i.convertToNumberObjectValue();if(h.isError())return h;const m=o[Math.trunc(+h.getValue())-1];let d=m?.get(l,c)||f.create(g.VALUE);return d!=null&&d.isNull()&&(d=A.create(0)),d})}}class F_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=[];for(let u=0;u<t.length;u++){let o=t[u];if(o.isArray()){const c=o.getRowCount(),h=o.getColumnCount();if(c>1||h>1)return f.create(g.VALUE);o=o.get(0,0)}if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;const i=Math.trunc(+o.getValue());if(i===0||Math.abs(i)>n)return f.create(g.VALUE);let l=e;n>1&&(i<0?l=e.slice(void 0,[i+n,i+1+n]):l=e.slice(void 0,[i-1,i]));for(let c=0;c<r;c++)s[c]||(s[c]=[]),e.isArray()?s[c].push(l.get(c,0)):s[c].push(e)}return W.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class j_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=e.isArray()?e.getRowCount():1,n=[];for(let s=0;s<t.length;s++){let u=t[s];if(u.isArray()){const l=u.getRowCount(),c=u.getColumnCount();if(l>1||c>1)return f.create(g.VALUE);u=u.get(0,0)}if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;const o=Math.trunc(+u.getValue());if(o===0||Math.abs(o)>r)return f.create(g.VALUE);let i=e;r>1&&(o<0?i=e.slice([o+r,o+1+r]):i=e.slice([o-1,o])),e.isArray()?n.push(i.getArrayValue()[0]):n.push([e])}return W.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class B_ extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",1)}calculate(e){if(e==null)return A.create(this.column+1);if(e.isError())return e;if(!e.isArray())return f.create(g.NA);const t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let u=0;u<r;u++)n.push(A.create(t+u+1));const s={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return W.create(s)}}class k_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return A.create(1);if(!e.isArray())return f.create(g.NA);const t=e.getColumnCount();return A.create(t)}}class $_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(0),s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),i=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=S(o,i,t,f.create(g.NA)),c=S(o,i,n,f.create(g.NA));if(o>1||i>1)return l.mapValue((p,y,b)=>{const O=c.get(y,b);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const{isError:M,errorObject:V}=this._checkRowsColumns(p,O,s,u);return M?V:e.isArray()?f.create(g.VALUE):e});if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const h=t.isArray()?t.get(0,0):t,m=n.isArray()?n.get(0,0):n,{isError:d,errorObject:_,rowsValue:C,columnsValue:E}=this._checkRowsColumns(h,m,s,u);return d?_:this._getResultArray(e,C,E,s,u)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const s=Math.trunc(+e.getValue()),u=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(u)?{isError:!0,errorObject:f.create(g.VALUE)}:Math.abs(s)>=r||Math.abs(u)>=n?{isError:!0,errorObject:f.create(g.CALC)}:{isError:!1,rowsValue:s,columnsValue:u}}_getResultArray(e,t,r,n,s){const u=t>=0?[t,n]:[0,n+t],o=r>=0?[r,s]:[0,s+r];let i;return t===0&&r===0?i=e:t===0?i=e.slice(void 0,o):r===0?i=e.slice(u,void 0):i=e.slice(u,o),i=i.map(l=>l.isNull()?A.create(0):l),n-t===1&&s-r===1?i.get(0,0):i}}class Y_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",4)}calculate(e,t,r,n){const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1;let o=t,i=r??A.create(u);const l=n??f.create(g.NA);t.isNull()&&(o=A.create(s)),i.isNull()&&(i=A.create(u));const c=Math.max(o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),h=Math.max(o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),m=S(c,h,o,f.create(g.NA)),d=S(c,h,i,f.create(g.NA));if(c>1||h>1)return m.mapValue((M,V,T)=>{const x=d.get(V,T);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const{isError:v,errorObject:L}=this._checkRowsColumnsPadWith(M,x,l,s,u);return v?L:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const _=o.isArray()?o.get(0,0):o,C=i.isArray()?i.get(0,0):i,{isError:E,errorObject:p,rowsValue:y,columnsValue:b,padWithObject:O}=this._checkRowsColumnsPadWith(_,C,l,s,u);return E?p:this._getResultArray(e,y,b,O,s,u)}_checkRowsColumnsPadWith(e,t,r,n,s){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};const u=Math.trunc(+e.getValue()),o=Math.trunc(+t.getValue());if(Number.isNaN(u)||Number.isNaN(o))return{isError:!0,errorObject:f.create(g.VALUE)};if(Math.abs(u)<n||Math.abs(o)<s)return{isError:!0,errorObject:f.create(g.VALUE)};let i=r;if(r.isArray()){const l=r.getRowCount(),c=r.getColumnCount();if(l>1||c>1)return{isError:!0,errorObject:f.create(g.VALUE)};i=r.get(0,0)}return{isError:!1,rowsValue:u,columnsValue:o,padWithObject:i}}_getResultArray(e,t,r,n,s,u){let o=[];e.isArray()?o=e.map(c=>c.isNull()?A.create(0):c).getArrayValue():o=[[e]];const i=Math.max(0,t-s),l=Math.max(0,r-u);for(let c=0;c<i;c++)o.push(new Array(u).fill(n));for(let c=0;c<l;c++)o.forEach(h=>{h.push(n)});return t===1&&r===1?o[0][0]:W.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class H_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??f.create(g.CALC);if(e.isError())return e;if(t.isError())return t;const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;return o>1&&i>1||o===1&&i!==u||i===1&&o!==s?f.create(g.VALUE):s===1&&u===1?this._getResultArrayByR1C1(e,t,n):o===1?i!==u?f.create(g.VALUE):this._getResultArrayByR1(s,u,e,t,n):i===1?o!==s?f.create(g.VALUE):this._getResultArrayByC1(s,u,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,s=t;return n.isArray()&&(n=n.get(0,0)),s.isArray()&&(s=s.get(0,0)),s.isString()&&(s=s.convertToNumberObjectValue()),s.isError()?s:+s.getValue()?n:r}_getResultArrayByR1(e,t,r,n,s){const u=[];for(let o=0;o<t;o++){let i=n.get(0,o);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(+i.getValue())for(let l=0;l<e;l++){u[l]||(u[l]=[]);const c=r.get(l,o);u[l].push(c)}}return u.length===0?s:W.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,s){const u=[];for(let o=0;o<e;o++){let i=n.get(o,0);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(!+i.getValue())continue;const l=[];for(let c=0;c<t;c++){const h=r.get(o,c);l.push(h)}u.push(l)}return u.length===0?s:W.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class G_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0),N(this,"needsFormulaDataModel",!0)}calculate(e){var t,r;if(!e.isReferenceObject())return f.create(g.NA);const n=e.getUnitId(),s=e.getSheetId(),u=(r=(t=e.getUnitData()[n])==null?void 0:t[s])==null?void 0:r.cellData,{startRow:o,startColumn:i}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((c,h,m)=>{const d=u.getValue(o+h,i+m);if(d!=null&&d.f||d!=null&&d.si){const _=this._formulaDataModel.getFormulaStringByCell(o+h,i+m,s,n);return w.create(_)}return f.create(g.NA)});return l.getRowCount()===1&&l.getColumnCount()===1?l.get(0,0):l}}class X_ extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return f.create(g.REF);if(!t.isArray()||r.isError()||n!=null&&n.isError())return f.create(g.NA);const s=this.getZeroOrOneByOneDefault(n);if(s==null)return f.create(g.VALUE);const u=this.getIndexNumValue(r);if(u instanceof f)return u;const o=t.slice([0,1]),i=t.slice([u-1,u]);return o==null||i==null?f.create(g.REF):e.isArray()?e.map(l=>this._handleSingleObject(l,o,i,s)):this._handleSingleObject(e,o,i,s)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class q_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const u=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let i=0;i<t;i++){r[i]||(r[i]=[]);for(let l=0;l<o;l++){let c=s;s.isArray()&&(c=s.get(i,l)),i>u-1||!c?r[i].push(f.create(g.NA)):r[i].push(c)}}}return W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class W_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){let r=e;if(e.isArray()&&(r=e.get(0,0)),r.isError())return r;let n=t;if(t!=null&&t.isArray()&&(n=t.get(0,0)),n!=null&&n.isError())return n;let s=`${r.getValue()}`;r.isNull()&&(s="");let u=s;return n&&(u=`${n.getValue()}`,n.isNull()?u="0":n.isBoolean()&&(u=u.toLocaleUpperCase())),w.create(u,{isHyperlink:!0,hyperlinkUrl:s})}}class Q_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=Math.max(e.isArray()?e.getRowCount():1,t!=null&&t.isArray()?t.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1,s!=null&&s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t!=null&&t.isArray()?t.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1,s!=null&&s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=t?S(u,o,t,f.create(g.NA)):void 0,c=r?S(u,o,r,f.create(g.NA)):void 0,h=n?S(u,o,n,f.create(g.NA)):void 0,m=s?S(u,o,s,f.create(g.NA)):void 0,d=i.mapValue((_,C,E)=>{if(_.isError())return _;const p=l?l.get(C,E):void 0;if(p!=null&&p.isError())return p;const y=c?c.get(C,E):void 0;if(y!=null&&y.isError())return y;const b=h?h.get(C,E):void 0;if(b!=null&&b.isError())return b;const O=m?m.get(C,E):void 0;return O!=null&&O.isError()?O:this._handleSingleObject(_,p,y,b,O)});return u===1&&o===1?d.get(0,0):d}_handleSingleObject(e,t,r,n,s){if(!e.isString())return f.create(g.VALUE);const u=e.getValue();let o="";t&&(t.isBoolean()?o=t.getValue()?"TRUE":"FALSE":t.isNull()||(o=`${t.getValue()}`));let i=r??A.create(0);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;const l=Math.abs(Math.trunc(+i.getValue()));if(l<0||l>3||[0,1,2].includes(l)&&(n||s))return f.create(g.VALUE);let c=n??A.create(0);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const h=Math.ceil(+c.getValue());let m=s??A.create(0);if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=Math.ceil(+m.getValue());return l===3&&h<1&&d<1?f.create(g.VALUE):w.create("",{isImage:!0,imageInfo:{source:u,altText:o,sizing:l,height:h,width:d}})}}class K_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",4),N(this,"needsReferenceObject",!0)}calculate(e,t,r,n){if(e.isError())return e;const s=this._getReferenceCounts(e);let u=t;t.isReferenceObject()&&(u=t.toArrayValueObject());let o=r;o!=null&&o.isReferenceObject()&&(o=r.toArrayValueObject());let i=n??A.create(1);i.isReferenceObject()&&(i=n.toArrayValueObject());const l=Math.max(u.isArray()?u.getRowCount():1,o!=null&&o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(u.isArray()?u.getColumnCount():1,o!=null&&o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1);if(l===1&&c===1)return this._handleSingleObject(e,u.isArray()?u.get(0,0):u,o?o.isArray()?o.get(0,0):o:void 0,i.isArray()?i.get(0,0):i,s);{const h=S(l,c,u,f.create(g.NA)),m=o?S(l,c,o,f.create(g.NA)):[],d=S(l,c,i,f.create(g.NA));return h.mapValue((_,C,E)=>{const p=o?m.get(C,E):void 0,y=d.get(C,E),b=this._handleSingleObject(e,_,p,y,s);return b.isReferenceObject()?b.getCellByPosition():b})}}_handleSingleObject(e,t,r,n,s){let u,o,i;if(r){const{isError:_,errorObject:C,variants:E}=F(t,r,n);if(_)return C;u=E[0],o=E[1],i=E[2]}else{const{isError:_,errorObject:C,variants:E}=F(t,n);if(_)return C;u=E[0],i=E[1]}const l=Math.floor(+i.getValue());if(l<0)return f.create(g.VALUE);if(l>s.length)return f.create(g.REF);const c=s[l-1];let h=0,m=0;if(c.rowCount===1&&!r?m=Math.floor(+u.getValue()):(h=Math.floor(+u.getValue()),r&&(m=Math.floor(+o.getValue()))),h<0||m<0)return f.create(g.VALUE);if(h>c.rowCount||m>c.columnCount)return f.create(g.REF);let d=e;return l>1&&(d=e.getCubeValues()[l-1]),d.isReferenceObject()?this._calculateReferenceObject(d,h,m):this._calculateArrayObject(d,h,m)}_getReferenceCounts(e){let t=[{rowCount:1,columnCount:1}];return e.isReferenceObject()?t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]:e.isCube()?t=e.getCubeValues().map(r=>({rowCount:r.getRowCount(),columnCount:r.getColumnCount()})):e.isArray()&&(t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]),t}_calculateReferenceObject(e,t,r){const{startRow:n,endRow:s,startColumn:u,endColumn:o}=e.getRangePosition();let i=0,l=0,c=0,h=0;if(t===0?(i=n,l=s):i=l=n+t-1,r===0?(c=u,h=o):c=h=u+r-1,i>s||c>o)return f.create(g.REF);const m={startRow:i,startColumn:c,endRow:l,endColumn:h};return this.createReferenceObject(e,m)}_calculateArrayObject(e,t,r){return!e.isArray()||t===0&&r===0?e:t===0?e.slice(void 0,[r-1,r]):r===0?e.slice([t-1,t],void 0):e.get(t-1,r-1)}}class Z_ extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(t!=null&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);r==null&&(r=1);let n=e;if(e.isArray()){const s=e.getRowCount(),u=e.getColumnCount();if(s>1||u>1)return e.map(()=>f.create(g.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){const r=`${e.getValue()}`;if(r.trim()==="")return f.create(g.REF);const n=this._convertToDefinedName(r);if(t===0){const c=xl(n),{range:h,sheetName:m,unitId:d}=c,_=new on(h);return _.setForcedUnitIdDirect(d),_.setForcedSheetName(m),this._setDefault(_)}if(An(n))return this._setDefault(new Fu(n));if(vi(n))return this._setDefault(new Bu(n));if(wi(n))return this._setDefault(new ju(n));const s=dr(n),{range:u,sheetName:o,unitId:i}=s;if(Number.isNaN(u.startRow)||u.endRow+1>es||Number.isNaN(u.startColumn)||u.endColumn+1>Ur)return f.create(g.REF);const l=new on(u);return l.setForcedUnitIdDirect(i),l.setForcedSheetName(o),this._setDefault(l)}_setDefault(e){return this.unitId==null||this.subUnitId==null?f.create(g.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){const t=this.getDefinedName(e);if(t==null)return e;const r=t.formulaOrRefString;return r==null?e:r.startsWith(K.EQUALS)?r.slice(1):r}}class z_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?f.create(g.REF):t.isArray()?r!=null&&r.isError()?r:t.getColumnCount()===1||t.getRowCount()===1?r!=null&&!r.isArray()?f.create(g.REF):this._handleVector(e,t,r):this._handleArray(e,t):f.create(g.VALUE)}_handleVector(e,t,r){let n=r;if(n==null)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return f.create(g.REF);return e.isArray()?e.map(s=>this.binarySearch(s,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){const r=t.getRowCount(),n=t.getColumnCount();let s,u;return n>r?(s=t.slice([0,1]),u=t.slice([r-1,r])):(s=t.slice(void 0,[0,1]),u=t.slice(void 0,[n-1,n])),s==null||u==null?f.create(g.VALUE):e.isArray()?e.map(o=>this.binarySearch(o,s,u)):this.binarySearch(e,s,u)}}class J_ extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return f.create(g.REF);if(!t.isArray())return f.create(g.VALUE);const n=t.getRowCount(),s=t.getColumnCount();if(n!==1&&s!==1||r!=null&&r.isError())return f.create(g.NA);const u=this.getMatchTypeValue(r);return u==null?f.create(g.VALUE):e.isArray()?e.map(o=>this._handleSingleObject(o,t,u)):this._handleSingleObject(e,t,u)}_handleSingleObject(e,t,r){const n=e.isNull()?A.create(0):e,s=this._getSearchModeValue(r),u=t.orderSearch(n,s);if(u==null)return f.create(g.NA);if(u instanceof f)return u;const o=t.getRowCount()===1?u.column+1:u.row+1;return A.create(o)}_getSearchModeValue(e){switch(e){case 1:return ve.MIN;case 0:return ve.NORMAL;case-1:return ve.MAX}}}class eC extends Rr{constructor(e,t=[]){super(e),N(this,"_areas",[]),this._areas=t}dispose(){this._areas.forEach(e=>{e.forEach(t=>t.dispose())}),this._areas=[],super.dispose()}getAreas(){return this._areas}setAreas(e){this._areas=e}addArea(e){Array.isArray(e)?this._areas.push(e):this._areas.push([e])}_flatAreas(){return this._areas.flat()}isMultiArea(){return!0}isRange(){return!1}isCell(){return!1}isRow(){return!1}isColumn(){return!1}getRowCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getRowCount());return e}getColumnCount(){let e=0;for(const t of this._flatAreas())t.isError()||(e+=t.getColumnCount());return e}isExceedRange(){return this._flatAreas().some(e=>e.isError()?!1:e.isExceedRange())}setRefOffset(e=0,t=0){super.setRefOffset(e,t),this._flatAreas().forEach(r=>{r.isError()||r.setRefOffset(e,t)})}_getReferenceArea(){return this._flatAreas().find(e=>!e.isError())}getUnitId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getUnitId())!=null?t:super.getUnitId()}getSheetId(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getSheetId())!=null?t:super.getSheetId()}getActiveSheetRowCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetRowCount())!=null?t:0}getActiveSheetColumnCount(){var e,t;return(t=(e=this._getReferenceArea())==null?void 0:e.getActiveSheetColumnCount())!=null?t:0}iterator(e){for(const t of this._areas){let r=!1;for(const n of t){if(n.isError())continue;let s=!1;if(n.iterator((u,o,i)=>{const l=e(u,o,i);return l===!1?(s=!0,r=!0,!1):l}),s)break}if(r)return}}getFirstCell(){const e=this._getReferenceArea();return e?e.getFirstCell():super.getFirstCell()}toArrayValueObject(){var e,t;const r=this._areas.length;if(r===0)return ft([],0,0);const n=(t=(e=this._areas[0])==null?void 0:e.length)!=null?t:0,s=[];for(let u=0;u<r;u++){const o=this._areas[u];if(o){s[u]=s[u]||[];for(let i=0;i<n;i++){const l=o[i];if(!l)continue;if(l.isError()){s[u][i]=l;continue}let c=null;l.iterator(h=>(c=h??null,!1)),c!=null&&(s[u][i]=c),s[u][i]=ce.create()}}}return ft(s,r,n)}getRangePosition(){const e=this._flatAreas();if(!e.length)return super.getRangePosition();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const u of e){if(u.isError())continue;const{startRow:o,startColumn:i,endRow:l,endColumn:c}=u.getRangePosition();!Number.isFinite(o)||!Number.isFinite(i)||!Number.isFinite(l)||!Number.isFinite(c)||(o<t&&(t=o),i<r&&(r=i),l>n&&(n=l),c>s&&(s=s<c?c:s))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangePosition():{startRow:t,startColumn:r,endRow:n,endColumn:s}}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}getRangeData(){const e=this._flatAreas();if(!e.length)return super.getRangeData();let t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const u of e){if(u.isError())continue;const{startRow:o,startColumn:i,endRow:l,endColumn:c}=u.getRangeData();!Number.isFinite(o)||!Number.isFinite(i)||!Number.isFinite(l)||!Number.isFinite(c)||(o<t&&(t=o),i<r&&(r=i),l>n&&(n=l),c>s&&(s=c))}return!Number.isFinite(t)||!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(s)?super.getRangeData():{startRow:t,startColumn:r,endRow:n,endColumn:s}}}class tC extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",5),N(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;if(!e.isReferenceObject())return f.create(g.VALUE);const u=e.getRowCount(),o=e.getColumnCount();let i=t;i.isReferenceObject()&&(i=i.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let c=n??A.create(u);c.isReferenceObject()&&(c=c.toArrayValueObject()),c.isNull()&&(c=A.create(u));let h=s??A.create(o);h.isReferenceObject()&&(h=h.toArrayValueObject()),h.isNull()&&(h=A.create(o));const m=Math.max(i.isArray()?i.getRowCount():1,l.isArray()?l.getRowCount():1,c.isArray()?c.getRowCount():1,h.isArray()?h.getRowCount():1),d=Math.max(i.isArray()?i.getColumnCount():1,l.isArray()?l.getColumnCount():1,c.isArray()?c.getColumnCount():1,h.isArray()?h.getColumnCount():1);if(i=i,l=l,c=c,h=h,m===1&&d===1)return i=i.isArray()?i.get(0,0):i,l=l.isArray()?l.get(0,0):l,c=c.isArray()?c.get(0,0):c,h=h.isArray()?h.get(0,0):h,this._handleSingleObject(e,i,l,c,h);const _=S(m,d,i,f.create(g.NA)),C=S(m,d,l,f.create(g.NA)),E=S(m,d,c,f.create(g.NA)),p=S(m,d,h,f.create(g.NA)),y=[];return _.iterator((b,O,M)=>{const V=C.get(O,M),T=E.get(O,M),x=p.get(O,M);if(y[O]=y[O]||[],b==null){y[O][M]=f.create(g.NA);return}if(b.isError()){y[O][M]=b;return}if(V.isError()){y[O][M]=V;return}if(T.isError()){y[O][M]=T;return}if(x.isError()){y[O][M]=x;return}const v=this._handleSingleObject(e,b,V,T,x);y[O][M]=v}),new eC("",y)}_handleSingleObject(e,t,r,n,s){const{startRow:u,startColumn:o}=e.getRangePosition();let i=t;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let l=r;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const c=+i.getValue(),h=+l.getValue();if(typeof c!="number"||typeof h!="number")return f.create(g.VALUE);const m=u+c,d=o+h;if(m<0||d<0||m>=es||d>=Ur)return f.create(g.REF);const _=this.getIndexNumValue(n),C=this.getIndexNumValue(s);if(typeof _!="number"||typeof C!="number")return f.create(g.VALUE);if(_===0||C===0)return f.create(g.REF);const E=_>0?m+_-1:m+_+1,p=C>0?d+C-1:d+C+1;if(E<0||p<0||E>=es||p>=Ur)return f.create(g.REF);const y=m<E?m:E,b=d<p?d:p,O=m>E?m:E,M=d>p?d:p,V={startRow:y,startColumn:b,endRow:O,endColumn:M};return this.createReferenceObject(e,V)}}class rC extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",1)}calculate(e){if(e==null)return A.create(this.row+1);if(e.isError())return e;if(!e.isArray())return f.create(g.NA);const t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let u=0;u<r;u++)n.push([A.create(t+u+1)]);const s={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return W.create(s)}}class nC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return A.create(1);if(!e.isArray())return f.create(g.NA);const t=e.getRowCount();return A.create(t)}}class sC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4)}calculate(e,t,r,n){let s=t??A.create(1);const u=r??A.create(1),o=n??P.create(!1);if(s.isNull()&&(s=A.create(1)),o.isArray()){const i=o.getRowCount(),l=o.getColumnCount();if(i===1&&l===1){const c=o.get(0,0);return this._handleSingleObject(e,s,u,c)}return o.map(c=>{const h=this._handleSingleObject(e,s,u,c);return h.isArray()?h.get(0,0):h})}return this._handleSingleObject(e,s,u,o)}_handleSingleObject(e,t,r,n){if(e.isError())return e;const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=this._checkArrayError(t);if(o.isError())return o;const i=Math.floor(+o.getValue());if(i<1)return f.create(g.VALUE);const l=this._checkArrayError(r);if(l.isError())return l;const c=Math.floor(+l.getValue());if(c!==-1&&c!==1)return f.create(g.VALUE);let h=n;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;if(!e.isArray()||s===1&&u===1)return e;const m=+h.getValue();return this._getResult(e,i,c,m,s,u)}_checkArrayError(e){let t=e;if(t.isArray()){const r=t.getRowCount(),n=t.getColumnCount();if(r>1||n>1)return f.create(g.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,s,u){if(n){if(t>s)return f.create(g.VALUE);const o=e.transpose().getArrayValue();return o.sort(this._sort(t-1,r)),W.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}else{if(t>u)return f.create(g.VALUE);const o=e.getArrayValue();return o.sort(this._sort(t-1,r)),W.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){const r=As();return t===1?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{const s=r[e],u=n[e];if(s==null||s.isNull())return 1;if(u==null||u.isNull())return-1;if(s.isError()&&u.isError())return 0;if(s.isError())return 1;if(u.isError())return-1;const o=s.getValue(),i=u.getValue();return s.isBoolean()&&o===!0?1:u.isBoolean()&&i===!0?-1:s.isBoolean()&&o===!1?1:u.isBoolean()&&i===!1?-1:s.isNumber()&&u.isNumber()?+o-+i:t(o,i)}}_sortDesc(e,t){return(r,n)=>{const s=r[e],u=n[e];if(s==null||s.isNull())return 1;if(u==null||u.isNull())return-1;if(s.isError()&&u.isError())return 0;if(s.isError())return-1;if(u.isError())return 1;const o=s.getValue(),i=u.getValue();return s.isBoolean()&&o===!0?-1:u.isBoolean()&&i===!0?1:s.isBoolean()&&o===!1?-1:u.isBoolean()&&i===!1?1:s.isNumber()&&u.isNumber()?+i-+o:t(i,o)}}}class aC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255)}calculate(e,...t){t.length===1&&t.push(A.create(1));const r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:s}=Df(t);if(r.isError()){const i=S(n,s,r);return n===1&&s===1?i.get(0,0):i}const u=t.map((i,l)=>l%2===0?i:S(n,s,i,f.create(g.NA))),o=this._getResultArray(e,u,n,s);return n===1&&s===1?o[0][0]:W.create({calculateValueList:o,rowCount:o.length,columnCount:o[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let o=0;o<t.length;o++){const i=t[o];if(i.isError())return i}if(t.length<2||t.length%2!==0)return f.create(g.VALUE);const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,u=t[0].isArray()?t[0].getColumnCount():1;if((s>1||u>1)&&(s>1&&u>1||s===1&&u!==n||u===1&&s!==r))return f.create(g.VALUE);for(let o=2;o<t.length;o++){if(o%2===1)continue;const i=t[o].isArray()?t[o].getRowCount():1,l=t[o].isArray()?t[o].getColumnCount():1;if(i!==s||l!==u)return f.create(g.VALUE)}return P.create(!0)}_getResultArray(e,t,r,n){const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=t[0].isArray()?t[0].getRowCount():1,i=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let c=0;c<r;c++){l[c]=[];for(let h=0;h<n;h++){const{isError:m,errorObject:d,byArrays:_,sortOrders:C}=this._getByArraysAndSortOrders(t,c,h,i);if(m){l[c].push(d);continue}if(!e.isArray()||s===1&&u===1){l[c].push(e);continue}let E=e.getArrayValue();o===1&&i===1||(o===1?(E=E.concat(_),E=this._transposeArray(E),E.sort(this._sort(s,C)),E=this._transposeArray(E).slice(0,s)):i===1&&(E=this._transposeArray(E),E=E.concat(_),E=this._transposeArray(E),E.sort(this._sort(u,C)),E=E.map(y=>y.slice(0,u))));const p=W.create({calculateValueList:E,rowCount:E.length,columnCount:E[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[c].push(p.get(0,0));continue}l[c].push(p)}}return l}_getByArraysAndSortOrders(e,t,r,n){const s=[],u=[];let o=!1,i=null;for(let l=0;l<e.length;l++){if(l%2===1)continue;const c=e[l];let h=e[l+1].get(t,r);if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError()){o=!0,i=h;break}const m=Math.floor(+h.getValue());if(m!==-1&&m!==1){o=!0,i=f.create(g.VALUE);break}if(u.push(m),c.isArray()){let d=c.getArrayValue();n===1&&(d=this._transposeArray(d)),s.push(d[0])}else s.push([c])}return{isError:o,errorObject:i,byArrays:s,sortOrders:u}}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let u=0;u<t;u++)n[s][u]=e[u][s]}return n}_sort(e,t){const r=As();return(n,s)=>{let u=n[e],o=s[e],i=this._compare(u,o,t[0],r);if(i===0&&t.length>1){for(let l=1;l<t.length;l++)if(u=n[e+l],o=s[e+l],i=this._compare(u,o,t[l],r),i!==0)return i}return i}}_compare(e,t,r,n){return r===1?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return-1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?1:t.isBoolean()&&s===!0?-1:e.isBoolean()&&n===!1?1:t.isBoolean()&&s===!1?-1:e.isNumber()&&t.isNumber()?+n-+s:r(n,s)}_desc(e,t,r){if(e==null||e.isNull())return 1;if(t==null||t.isNull())return-1;if(e.isError()&&t.isError())return 0;if(e.isError())return-1;if(t.isError())return 1;const n=e.getValue(),s=t.getValue();return e.isBoolean()&&n===!0?-1:t.isBoolean()&&s===!0?1:e.isBoolean()&&n===!1?-1:t.isBoolean()&&s===!1?1:e.isNumber()&&t.isNumber()?+s-+n:r(s,n)}}class uC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let u=t,o=r??A.create(s);t.isNull()&&(u=A.create(n)),o.isNull()&&(o=A.create(s));const i=Math.max(u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1),l=Math.max(u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=S(i,l,u,f.create(g.NA)),h=S(i,l,o,f.create(g.NA));if(i>1||l>1)return c.mapValue((y,b,O)=>{const M=h.get(b,O);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const{isError:V,errorObject:T}=this._checkRowsColumns(y,M,n,s);return V?T:e.isArray()?f.create(g.VALUE):e});if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);const m=u.isArray()?u.get(0,0):u,d=o.isArray()?o.get(0,0):o,{isError:_,errorObject:C,rowsValue:E,columnsValue:p}=this._checkRowsColumns(m,d,n,s);return _?C:this._getResultArray(e,E,p,n,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),u=Math.trunc(+t.getValue());return Number.isNaN(s)||Number.isNaN(u)?{isError:!0,errorObject:f.create(g.VALUE)}:Math.abs(s)===0||Math.abs(u)===0?{isError:!0,errorObject:f.create(g.CALC)}:(s>r&&(s=r),u>n&&(u=n),{isError:!1,rowsValue:s,columnsValue:u})}_getResultArray(e,t,r,n,s){if(!e.isArray())return e;const u=t>=0?[0,t]:[n+t,n],o=r>=0?[0,r]:[s+r,s];let i;return t===n&&r===s?i=e:t===n?i=e.slice(void 0,o):r===s?i=e.slice(u,void 0):i=e.slice(u,o),i=i.map(l=>l.isNull()?A.create(0):l),t===1&&r===1?i.get(0,0):i}}class oC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){const n=t??A.create(0),s=r??P.create(!1),u=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,n,f.create(g.NA)),l=S(u,o,s,f.create(g.NA)),c=i.mapValue((h,m,d)=>{const _=l.get(m,d);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);if(h.isError())return h;if(_.isError())return _;const C=Math.trunc(+h.getValue()),E=+_.getValue();if(Number.isNaN(C)||C<0||C>3||Number.isNaN(E))return f.create(g.VALUE);if(!e.isArray())return e;let p=[];return E?p=this._getArrayValueByColumn(e,C):p=this._getArrayValueByRow(e,C),p.length===0?f.create(g.CALC):u>1||o>1||p.length===1?p[0]:W.create({calculateValueList:p.map(y=>[y]),rowCount:p.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&o===1?c.get(0,0):c}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),u=[];for(let o=0;o<s;o++)for(let i=0;i<n;i++){const l=r.get(i,o);this._isIgnore(l,t)||u.push(l.isNull()?A.create(0):l)}return u}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),u=[];for(let o=0;o<n;o++)for(let i=0;i<s;i++){const l=r.get(o,i);this._isIgnore(l,t)||u.push(l.isNull()?A.create(0):l)}return u}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class iC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){const n=t??A.create(0),s=r??P.create(!1),u=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,n,f.create(g.NA)),l=S(u,o,s,f.create(g.NA)),c=i.mapValue((h,m,d)=>{const _=l.get(m,d);if(e.isError())return e;if(h.isError())return h;if(_.isError())return _;const C=Math.trunc(+h.getValue()),E=+_.getValue();if(Number.isNaN(C)||C<0||C>3||Number.isNaN(E)||e.isNull())return f.create(g.VALUE);if(!e.isArray())return e;let p=[];return E?p=this._getArrayValueByColumn(e,C):p=this._getArrayValueByRow(e,C),p.length===0?f.create(g.CALC):u>1||o>1||p.length===1?p[0]:W.create({calculateValueList:[p],rowCount:1,columnCount:p.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return u===1&&o===1?c.get(0,0):c}_getArrayValueByColumn(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),u=[];for(let o=0;o<s;o++)for(let i=0;i<n;i++){const l=r.get(i,o);this._isIgnore(l,t)||u.push(l.isNull()?A.create(0):l)}return u}_getArrayValueByRow(e,t){const r=e,n=r.getRowCount(),s=r.getColumnCount(),u=[];for(let o=0;o<n;o++)for(let i=0;i<s;i++){const l=r.get(o,i);this._isIgnore(l,t)||u.push(l.isNull()?A.create(0):l)}return u}_isIgnore(e,t){switch(t){case 0:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError();default:return!1}}}class lC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t===1&&r===1?e.get(0,0):e.transpose()}return e}}class cC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){const n=t??P.create(!1),s=r??P.create(!1),u=e.isArray()?e.getRowCount():1,o=e.isArray()?e.getColumnCount():1,i=Math.max(n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),c=S(i,l,n,f.create(g.NA)),h=S(i,l,s,f.create(g.NA)),m=c.map((d,_,C)=>{let E=d,p=h.get(_,C);if(e.isError())return e;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(p.isString()&&(p=p.convertToNumberObjectValue()),p.isError())return p;const y=+E.getValue(),b=+p.getValue();let O;return!y&&u===1||y&&o===1?O=e:O=this._getResult(e,y,b),(i>1||l>1)&&O!=null&&O.isArray()?O.get(0,0):O});return i===1&&l===1?m.get(0,0):m}_getResult(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;let u=e.getArrayValue(),o=n,i=s;t&&(u=this._transposeArray(u),o=s,i=n);const l=this._getRepeatRows(u,o,i);if(l.length>0){const c=[];l.forEach(h=>{h.forEach((m,d)=>{(d!==0||r)&&c.push(m)})}),u=u.filter((h,m)=>!c.includes(m))}return u.length===0?f.create(g.CALC):(t&&(u=this._transposeArray(u)),W.create({calculateValueList:u,rowCount:u.length,columnCount:u[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let s=0;s<r;s++)if(s===0){const u=new Array(t).fill(null).map((o,i)=>({r:i,valueObject:e[i][s]}));n=this._getRepeatRowsByObjects(u)}else{if(n.length===0)break;let u=[];n.forEach(o=>{const i=o.map(c=>({r:c,valueObject:e[c][s]})),l=this._getRepeatRowsByObjects(i);u=u.concat(l)}),n=u}return n}_getRepeatRowsByObjects(e){const t=new Map;return e.forEach(r=>{const n=r.r,s=r.valueObject;let u=s.getValue();if(s.isNull()?u=null:s.isString()&&Q(u)&&(u=+u),!t.has(u))t.set(u,[n]);else{const o=t.get(u);o.push(n),t.set(u,o)}}),Array.from(t.values()).filter(r=>r.length>1)}_transposeArray(e){const t=e.length,r=e[0].length,n=[];for(let s=0;s<r;s++){n[s]=[];for(let u=0;u<t;u++)n[s][u]=e[u][s]}return n}}class hC extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return f.create(g.VALUE);if(r.isError())return r;if(n!=null&&n.isError())return n;const s=n??P.create(!0);return Xo(e)&&Xo(s)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,s):this._handleNonArrayColIndexNum(e,t,r,s)}_handleArrayColIndexNum(e,t,r,n){const s=e.isArray()?e.getFirstCell():e,u=this.getZeroOrOneByOneDefault(n);if(u==null)return f.create(g.VALUE);let o;const i=[];return r.iterator((l,c,h)=>{if(l==null)return o=f.create(g.VALUE),!1;const m=this._handleTableArray(s,t,l,u);if(m.isError())return o=m,!1;i[c]===void 0&&(i[c]=[]),i[c][h]=m}),o||ft(i,i.length,i[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e),i=S(s,u,n);return o.map((l,c,h)=>{if(l.isError())return l;const m=i.get(c,h);if(m==null)return f.create(g.VALUE);if(m.isError())return m;const d=this.getZeroOrOneByOneDefault(m);return d==null?f.create(g.VALUE):this._handleTableArray(l,t,r,d)})}_handleTableArray(e,t,r,n){let s=this.getIndexNumValue(r);if(s instanceof f)return s;if(s=Math.floor(s),s<1)return f.create(g.VALUE);const u=t.slice(void 0,[0,1]);if(u==null)return f.create(g.VALUE);const o=t.slice(void 0,[s-1,s]);return o==null?f.create(g.REF):this._handleSingleObject(e,u,o,n)}_handleSingleObject(e,t,r,n){return n===0?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}}class mC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=Math.max(...e.map(n=>n.isArray()?n.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;const u=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let i=0;i<u;i++){const l=[];for(let c=0;c<t;c++){let h=s;s.isArray()&&(h=s.get(i,c)),c>o-1||!h?l.push(f.create(g.NA)):l.push(h)}r.push(l)}}return W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}class gC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){let n=r??f.create(g.NA);n.isNull()&&(n=f.create(g.NA));const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),i=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=S(o,i,t,f.create(g.NA)),c=S(o,i,n,f.create(g.NA)),h=l.mapValue((m,d,_)=>{const C=c.get(d,_);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);if(m.isError())return m;const E=Math.trunc(+m.getValue());if(s>1&&u>1||Number.isNaN(E))return f.create(g.VALUE);if(E<1)return f.create(g.NUM);const p=e.isArray()?e.getArrayValue().flat():[e],y=this._getWrapArray(p,E,C);return o>1||i>1||y.length===1&&y[0].length===1?y[0][0]:W.create({calculateValueList:y,rowCount:y.length,columnCount:y[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return o===1&&i===1?h.get(0,0):h}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,u=[];for(let o=0;o<n;o++)for(let i=0;i<s;i++){u[i]||(u[i]=[]);const l=o*s+i;l<e.length?u[i].push(e[l].isNull()?A.create(0):e[l]):u[i].push(r)}return u}}class fC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){let n=r??f.create(g.NA);n.isNull()&&(n=f.create(g.NA));const s=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,o=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),i=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=S(o,i,t,f.create(g.NA)),c=S(o,i,n,f.create(g.NA)),h=l.mapValue((m,d,_)=>{const C=c.get(d,_);if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);if(m.isError())return m;const E=Math.trunc(+m.getValue());if(s>1&&u>1||Number.isNaN(E))return f.create(g.VALUE);if(E<1)return f.create(g.NUM);const p=e.isArray()?e.getArrayValue().flat():[e],y=this._getWrapArray(p,E,C);return o>1||i>1||y.length===1&&y[0].length===1?y[0][0]:W.create({calculateValueList:y,rowCount:y.length,columnCount:y[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return o===1&&i===1?h.get(0,0):h}_getWrapArray(e,t,r){const n=Math.ceil(e.length/t),s=n>1?t:e.length,u=[];for(let o=0;o<n;o++){const i=[];for(let l=0;l<s;l++){const c=o*s+l;c<e.length?i.push(e[c].isNull()?A.create(0):e[c]):i.push(r)}u.push(i)}return u}}class dC extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=n??f.create(g.NA);n!=null&&n.isNull()&&(o=f.create(g.NA));let i=s??A.create(0);s!=null&&s.isNull()&&(i=A.create(0));let l=u??A.create(1);if(u!=null&&u.isNull()&&(l=A.create(1)),e.isError())return e;const c=t.isArray()?t.getRowCount():1,h=t.isArray()?t.getColumnCount():1,m=r.isArray()?r.getRowCount():1,d=r.isArray()?r.getColumnCount():1;if(c!==1&&h!==1||c===1&&h>1&&h!==d||h===1&&c>1&&c!==m)return f.create(g.VALUE);if(i.isError())return i;if(l.isError())return l;const _=this.getIndexNumValue(i);if(_ instanceof f)return _;const C=this.getIndexNumValue(l);return C instanceof f?C:this._getResult(e,Ka(t),Ka(r),o,_,C,c,h,m,d)}_getResult(e,t,r,n,s,u,o,i,l,c){const h=e.isArray()?e.getRowCount():1,m=e.isArray()?e.getColumnCount():1;if(h>1||m>1){let E;return o===1?E=r.slice([0,1]):E=r.slice(void 0,[0,1]),E==null?f.create(g.NA):e.map(p=>{const y=this._checkErrorCombination(s,u);if(y)return y;const b=this._handleSingleObject(p,t,E,s,u);return b.isError()?n:b})}const d=e.isArray()?e.get(0,0):e;if(i===c&&o===l){const E=this._checkErrorCombination(s,u);if(E)return E;const p=this._handleSingleObject(d,t,r,s,u);return p.isError()?n:p}let _=0;i===c&&(_=1);const C=this._handleExpandObject(d,t,r,s,u,_);return C??f.create(g.NA)}_handleExpandObject(e,t,r,n,s,u=0){if((s===2||s===-2)&&n!==2){const o=ka(s),i=Ba(n);return this.binarySearchExpand(e,t,r,u,o,i)}return n===2?this.fuzzySearchExpand(e,t,r,s!==-1,u):n===-1||n===1?this.orderSearchExpand(e,t,r,n===1?ve.MAX:ve.MIN,s===-1,u):this.equalSearchExpand(e,t,r,s!==-1,u)}_handleSingleObject(e,t,r,n,s){if((s===2||s===-2)&&n!==2){const u=ka(s),o=Ba(n);return this.binarySearch(e,t,r,u,o)}return n===2?this.fuzzySearch(e,t,r,s!==-1):n===-1||n===1?this.orderSearch(e,t,r,n===1?ve.MAX:ve.MIN,s===-1):this.equalSearch(e,t,r,s!==-1)}_checkErrorCombination(e,t){return e===2&&(t===-2||t===2)?f.create(g.VALUE):null}}class NC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",4)}calculate(e,t,r,n){let s=A.create(0);r&&!r.isNull()&&(s=r);let u=A.create(1);n&&!n.isNull()&&(u=n);const o=Math.max(e.isArray()?e.getRowCount():1,s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1),l=S(o,i,e,f.create(g.NA)),c=S(o,i,s,f.create(g.NA)),h=S(o,i,u,f.create(g.NA)),m=l.mapValue((d,_,C)=>{if(d.isError())return d;const E=c.get(_,C),p=h.get(_,C);return E.isError()?E:p.isError()?p:this._handleSingleObject(d,t,E,p)});return o===1&&i===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;if(s!==1&&u!==1)return f.create(g.VALUE);let o=r;if((r.isString()||r.isBoolean()||r.isNull())&&(o=r.convertToNumberObjectValue()),o.isError())return o;let i=n;if((n.isString()||n.isBoolean()||n.isNull())&&(i=n.convertToNumberObjectValue()),i.isError())return i;const l=o.getValue(),c=i.getValue();return![-1,0,1,2].includes(l)||![-1,1,2].includes(c)?f.create(g.VALUE):this._getResult(e,t,l,c)}_getResult(e,t,r,n){const s=Ka(t);let u;if((n===2||n===-2)&&r!==2){const o=ka(n),i=Ba(r);u=s.binarySearch(e,o,i)}else if(r===2){const o=s.compare(e,k.EQUALS);let i;if(n!==-1?i=o.getFirstTruePosition():i=o.getLastTruePosition(),i==null)return f.create(g.NA);u=s.getRowCount()===1?i.column:i.row}else if(r===-1||r===1){const o=s.orderSearch(e,r===1?ve.MAX:ve.MIN,n===-1);if(o==null)return f.create(g.NA);if(o instanceof f)return o;u=s.getRowCount()===1?o.column:o.row}else{const o=s.isEqual(e);let i;if(n!==-1?i=o.getFirstTruePosition():i=o.getLastTruePosition(),i==null)return f.create(g.NA);u=s.getRowCount()===1?i.column:i.row}return u==null?f.create(g.NA):A.create(u+1)}}const Wc=[[w_,te.ADDRESS],[L_,te.AREAS],[P_,te.CHOOSE],[F_,te.CHOOSECOLS],[j_,te.CHOOSEROWS],[B_,te.COLUMN],[k_,te.COLUMNS],[$_,te.DROP],[Y_,te.EXPAND],[H_,te.FILTER],[G_,te.FORMULATEXT],[X_,te.HLOOKUP],[q_,te.HSTACK],[W_,te.HYPERLINK],[Q_,te.IMAGE],[K_,te.INDEX],[Z_,te.INDIRECT],[z_,te.LOOKUP],[J_,te.MATCH],[tC,te.OFFSET],[rC,te.ROW],[nC,te.ROWS],[sC,te.SORT],[aC,te.SORTBY],[uC,te.TAKE],[oC,te.TOCOL],[iC,te.TOROW],[lC,te.TRANSPOSE],[cC,te.UNIQUE],[hC,te.VLOOKUP],[mC,te.VSTACK],[gC,te.WRAPCOLS],[fC,te.WRAPROWS],[dC,te.XLOOKUP],[NC,te.XMATCH]];class _C extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}}class CC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}}class EC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}}class AC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:si(r)):si(t)}}function si(a){let e=a.getValue();if(a.isBoolean()&&(e=e?1:0),!Number.isFinite(e))return f.create(g.VALUE);e=Number(e);let t=Math.atan(1/e);return e<0&&(t+=Math.PI),Number.isNaN(t)?f.create(g.VALUE):A.create(t)}class pC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(r=>r.isError()?r:ai(r)):ai(t)}}function ai(a){let e=a.getValue();if(a.isBoolean()&&(e=e?1:0),!Number.isFinite(e))return f.create(g.VALUE);if(e=Number(e),Math.abs(e)<=1)return f.create(g.NUM);const t=1/2*Math.log((e+1)/(e-1));return Number.isNaN(t)?f.create(g.VALUE):A.create(t)}const yC={1:Ve.AVERAGE,2:Ve.COUNT,3:Ve.COUNTA,4:Ve.MAX,5:Ve.MIN,6:Ve.PRODUCT,7:Ve.STDEV_S,8:Ve.STDEV_P,9:Ve.SUM,10:Ve.VAR_S,11:Ve.VAR_P,12:Ve.MEDIAN,13:Ve.MODE_SNGL};class bC extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255),N(this,"needsReferenceObject",!0),N(this,"needsFilteredOutRows",!0),N(this,"needsFormulaDataModel",!0)}calculate(e,t,...r){const{isError:n,multiAreaRefs:s,normalRefs:u}=Yl(r);let o;e.isReferenceObject()?o=e.toArrayValueObject():o=e;let i;t.isReferenceObject()?i=t.toArrayValueObject():i=t;const l=Math.max(o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,o,f.create(g.NA)),m=S(l,c,i,f.create(g.NA)),d=h.mapValue((_,C,E)=>{if(_.isError())return _;const p=m.get(C,E);return p.isError()?p:s.length>0?f.create(g.VALUE):this._handleSingleObject(_,p,r,n,u)});return d.getRowCount()===1&&d.getColumnCount()===1?d.get(0,0):d}_handleSingleObject(e,t,r,n,s){let u=e;if(e.isString()&&(u=e.convertToNumberObjectValue()),u.isError())return u;const o=Math.floor(+u.getValue());if(o<1||o>19||o>=1&&o<=13&&n||o>=14&&o<=19&&r.length!==2)return f.create(g.VALUE);let i=t;if(t.isString()&&(i=t.convertToNumberObjectValue()),i.isError())return i;const l=Math.floor(+i.getValue());if(l<0||l>7)return f.create(g.VALUE);const c=this._getAggregateOptions(l);return o>=14&&o<=19?this._handleLargeSmallPercentileQuartile(o,c,r[0],r[1]):ql({type:yC[o],...c,formulaDataModel:this._formulaDataModel},s)}_getAggregateOptions(e){switch(e){case 1:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!0};case 2:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!0};case 3:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!0};case 4:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!1};case 5:return{ignoreRowHidden:!0,ignoreErrorValues:!1,ignoreNested:!1};case 6:return{ignoreRowHidden:!1,ignoreErrorValues:!0,ignoreNested:!1};case 7:return{ignoreRowHidden:!0,ignoreErrorValues:!0,ignoreNested:!1};default:return{ignoreRowHidden:!1,ignoreErrorValues:!1,ignoreNested:!0}}}_handleLargeSmallPercentileQuartile(e,t,r,n){let s;if(n.isReferenceObject()?s=n.toArrayValueObject():s=n,s.isError())return s;if(s.isArray()){const i=s.getRowCount(),l=s.getColumnCount();if(i>1||l>1)return f.create(g.VALUE);s=s.get(0,0)}const u=Sr(r,t,this._formulaDataModel);if(!Array.isArray(u))return u;const o=+s.getValue();switch(e){case 14:return Ql(u,o);case 15:return Kl(u,o);case 16:return Zl(u,o);case 17:return Jl(u,o);case 18:return zl(u,o);case 19:return ec(u,o);default:return f.create(g.VALUE)}}}class RC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return A.create(0);if(e.isBoolean()||e.isNumber())return f.create(g.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return f.create(g.VALUE);const r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let s=0;s<t.length;s++){const u=jn.get(t[s])||0,o=jn.get(t[s+1])||0,i=jn.get(t[s+2])||0,l=jn.get(t[s+3])||0;if(!u||i>=o&&i>u||u===o&&u===i&&u===l||u===o/2)return f.create(g.VALUE);u<o?n-=u:n+=u}return A.create(r?-n:n)}}class SC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}}class OC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}}class MC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}}class VC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}}class TC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}}class IC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.map((h,m,d)=>{const _=i.get(m,d),C=l.get(m,d);return this._handleSingleObject(h,_,C)});return c.getRowCount()===1&&c.getColumnCount()===1?c.getArrayValue()[0][0]:c}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let u=r;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;const o=Math.floor(+n.getValue()),i=Math.floor(+s.getValue()),l=Math.floor(+u.getValue());if(o<0||o>=2**53||i<2||i>36||l<0)return f.create(g.NUM);let c=o.toString(i);return c.length<l&&(c=new Array(l-c.length+1).join("0")+c),w.create(c.toLocaleUpperCase())}}class xC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=i,m=u.get(l,c);if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const d=+h.getValue(),_=+m.getValue();if(d>0&&_<0)return f.create(g.NUM);if(d===0||_===0)return A.create(0);const C=qe(d/_,0)*_;return A.create(C)});return o.getRowCount()===1&&o.getColumnCount()===1?o.getArrayValue()[0][0]:o}}class UC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){const n=t??A.create(1),s=r??A.create(0);if(e.isError())return e;if(n.isError())return n;if(s.isError())return s;const u=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=S(u,o,n,f.create(g.NA)),c=S(u,o,s,f.create(g.NA)),h=i.map((m,d,_)=>{let C=m,E=l.get(d,_),p=c.get(d,_);if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(p.isString()&&(p=p.convertToNumberObjectValue()),p.isError())return p;const y=+C.getValue(),b=+E.getValue(),O=+p.getValue();return y===0||b===0?A.create(0):this._getResult(y,b,O)});return u===1&&o===1?h.get(0,0):h}_getResult(e,t,r){let n;return e<0&&r!==0?n=(t<0?qe(Math.abs(e)/Math.abs(t),0):-qe(Math.abs(e)/t,0))*t:n=(t<0?-qe(e/Math.abs(t),0):qe(e/t,0))*t,A.create(n)}}class vC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.map((l,c,h)=>{let m=o.get(c,h),d=l;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const _=+d.getValue(),C=+m.getValue();if(_===0||C===0)return A.create(0);const E=(C<0?-qe(_/Math.abs(C),0):qe(_/C,0))*C;return A.create(E)});return n===1&&s===1?i.get(0,0):i}}class wC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{let h=i,m=u.get(l,c);if(h.isString()&&(h=h.convertToNumberObjectValue()),m.isString()&&(m=m.convertToNumberObjectValue()),h.isError())return h;if(m.isError())return m;const d=Math.floor(+h.getValue()),_=Math.floor(+m.getValue());if(d<0||_<0||d<_)return f.create(g.NUM);const C=cr(d,_);return Number.isNaN(C)||!Number.isFinite(C)?f.create(g.NUM):A.create(C)});return r===1&&n===1?o.get(0,0):o}}class DC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{let h=i,m=u.get(l,c);if(h.isString()&&(h=h.convertToNumberObjectValue()),m.isString()&&(m=m.convertToNumberObjectValue()),h.isError())return h;if(m.isError())return m;const d=Math.floor(+h.getValue()),_=Math.floor(+m.getValue());if(d<0||_<0||d===0&&d<_)return f.create(g.NUM);const C=cr(d+_-1,d-1);return Number.isNaN(C)||!Number.isFinite(C)?f.create(g.NUM):A.create(C)});return r===1&&n===1?o.get(0,0):o}}class LC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}}class PC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}}class FC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?f.create(g.NUM):r===0?f.create(g.DIV_BY_ZERO):t.tan().getReciprocal()}}class jC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:+t.getValue()==0?f.create(g.DIV_BY_ZERO):t.tanh().getReciprocal()}}class BC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?f.create(g.NUM):r===0?f.create(g.DIV_BY_ZERO):t.sin().getReciprocal()}}class kC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return r===0?f.create(g.DIV_BY_ZERO):!Number.isNaN(r)&&!Number.isFinite(Math.sinh(r))?A.create(0):t.sinh().getReciprocal()}}class $C extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{if(i.isError())return i;let h=u.get(l,c);if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;const m=`${i.getValue()}`,d=Math.floor(+h.getValue());if(Q(m)&&(+m<0||+m>=2**53||!Number.isInteger(+m))||m.toLocaleLowerCase()==="true"||m.toLocaleLowerCase()==="false"||d<2||d>36)return f.create(g.NUM);if(m.replace(/\s/g,"")==="")return A.create(0);if(!this._isValidCharForRadix(m,d))return f.create(g.NUM);const _=Number.parseInt(m,d);return Number.isNaN(_)?f.create(g.NUM):A.create(_)});return r===1&&n===1?o.get(0,0):o}_isValidCharForRadix(e,t){for(const r of e){const n=r.toUpperCase().charCodeAt(0);if(t<=10&&!(n>=48&&n<48+t)||t>10&&!(n>=48&&n<58||n>=65&&n<65+t-10))return!1}return!0}}class YC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return f.create(g.VALUE);const n=r*(180/Math.PI);return Number.isNaN(n)?f.create(g.VALUE):A.create(n)}}class HC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return f.create(g.VALUE);const n=(r<0?-qe(Math.abs(r)/2,0):qe(r/2,0))*2;return Number.isNaN(n)?f.create(g.VALUE):n===0?A.create(0):A.create(n)}}class GC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}}class XC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=Ir(r);return Number.isNaN(n)||!Number.isFinite(n)?f.create(g.NUM):A.create(n)}}class qC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){const r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return f.create(g.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue()),n=Ir(r,2);return Number.isNaN(n)||!Number.isFinite(n)?f.create(g.NUM):A.create(n)}}class WC extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=u.get(l,c),m=i;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;const d=+m.getValue(),_=+h.getValue();if(d>0&&_<0)return f.create(g.NUM);if(d===0)return A.create(0);if(_===0)return f.create(g.DIV_BY_ZERO);const C=Je(d/_,0)*_;return A.create(C)});return r===1&&n===1?o.get(0,0):o}}class QC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){const n=t??A.create(1),s=r??A.create(0),u=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=S(u,o,n,f.create(g.NA)),c=S(u,o,s,f.create(g.NA)),h=i.map((m,d,_)=>{let C=m,E=l.get(d,_),p=c.get(d,_);if(C.isString()&&(C=C.convertToNumberObjectValue()),C.isError())return C;if(E.isString()&&(E=E.convertToNumberObjectValue()),E.isError())return E;if(p.isString()&&(p=p.convertToNumberObjectValue()),p.isError())return p;const y=+C.getValue(),b=+E.getValue(),O=+p.getValue();if(y===0||b===0)return A.create(0);let M;return y<0&&O!==0?M=(b<0?Je(Math.abs(y)/Math.abs(b),0):-Je(Math.abs(y)/b,0))*b:M=(b<0?-Je(y/Math.abs(b),0):Je(y/b,0))*b,A.create(M)});return u===1&&o===1?h.get(0,0):h}}class KC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.map((l,c,h)=>{let m=o.get(c,h),d=l;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const _=+d.getValue(),C=+m.getValue();if(_===0||C===0)return A.create(0);const E=(C<0?-Je(_/Math.abs(C),0):Je(_/C,0))*C;return A.create(E)});return n===1&&s===1?i.get(0,0):i}}class ZC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(!n.isNull())if(n.isArray()){let s=!1,u=f.create(g.VALUE);if(n.iterator(o=>{if(o!=null&&o.isNull())return!0;const{isError:i,errorObject:l,number:c}=this._handleSingleObject(o);if(i)return s=!0,u=l,!1;t=ru(t,c)}),s)return u}else{const{isError:s,errorObject:u,number:o}=this._handleSingleObject(n);if(s)return u;t=ru(t,o)}}return A.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0||r>=2**53?{isError:!0,errorObject:f.create(g.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class zC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());return A.create(r)}}class JC extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){const s=e[n];if(!s.isNull())if(s.isArray()){let u=!1,o=f.create(g.VALUE);if(s.iterator(i=>{if(i!=null&&i.isNull())return!0;const{isError:l,errorObject:c,number:h}=this._handleSingleObject(i);if(l)return u=!0,o=c,!1;t=ti(t,h),r=!1}),u)return o}else{const{isError:u,errorObject:o,number:i}=this._handleSingleObject(s);if(u)return o;t=ti(t,i),r=!1}}return r?A.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=2**53?f.create(g.VALUE):A.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:f.create(g.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class eE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}}class tE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(10);if(e.isError())return e;if(r.isError())return r;const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.map((l,c,h)=>{let m=o.get(c,h),d=l;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const _=+d.getValue(),C=+m.getValue();if(_<=0||C<=0)return f.create(g.NUM);const E=Math.log(C);if(E===0)return f.create(g.DIV_BY_ZERO);const p=Math.log(_)/E;return A.create(p)});return n===1&&s===1?i.get(0,0):i}}class rE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}}class nE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let u=0;u<t;u++){const o=[];for(let i=0;i<r;i++){let l=e.isArray()?e.get(u,i):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return f.create(g.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const c=+l.getValue();o.push(c)}n.push(o)}if(t!==r)return f.create(g.VALUE);const s=Zu(n);return A.create(s)}}class sE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let u=0;u<t;u++){const o=[];for(let i=0;i<r;i++){let l=e.isArray()?e.get(u,i):e;if(l.isError())return l;if(l.isNull()||l.isBoolean())return f.create(g.VALUE);if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;const c=+l.getValue();o.push(c)}n.push(o)}if(t!==r)return f.create(g.VALUE);const s=pd(n);return s===null?f.create(g.NUM):W.createByArray(s)}}class aE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;if(n!==s)return f.create(g.VALUE);const o=this._getMatrix(e,r,n),i=this._getMatrix(t,s,u);if(o instanceof f)return o;if(i instanceof f)return i;const l=xr(o,i);return W.createByArray(l)}_getMatrix(e,t,r){const n=[];for(let s=0;s<t;s++){const u=[];for(let o=0;o<r;o++){let i=e.isArray()?e.get(s,o):e;if(i.isError())return i;if(i.isNull()||i.isBoolean())return f.create(g.VALUE);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;const l=+i.getValue();u.push(l)}n.push(u)}return n}}class uE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}}class oE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const i=r.getRowCount(),l=r.getColumnCount();if(i>1||l>1)return f.create(g.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const i=n.getRowCount(),l=n.getColumnCount();if(i>1||l>1)return f.create(g.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return f.create(g.VALUE);const s=+r.getValue(),u=+n.getValue();if(Number.isNaN(s)||Number.isNaN(u))return f.create(g.VALUE);if(u===0)return A.create(0);if(s>0&&u<0||s<0&&u>0)return f.create(g.NUM);const o=qt(s/u,0)*u;return A.create(o)}}class iE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let s=0;s<e.length;s++){const u=e[s];if(!u.isNull())if(u.isArray()){let o=!1,i=f.create(g.VALUE);if(u.iterator(l=>{if(l!=null&&l.isNull())return!0;const{isError:c,errorObject:h,number:m}=this._handleSingleObject(l);if(c)return o=!0,i=h,!1;if(t+=m,t>170)return o=!0,i=f.create(g.NUM),!1;r*=Ir(m)}),o)return i}else{const{isError:o,errorObject:i,number:l}=this._handleSingleObject(u);if(o)return i;if(t+=l,t>170)return f.create(g.NUM);r*=Ir(l)}}const n=Ir(t)/r;return A.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};const r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:f.create(g.NUM),number:null}:{isError:!1,errorObject:null,number:r}}}class lE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(s=>{const u=this._handleSingleObject(s);return u.isError()?u:t>1||r>1?u.get(0,0):u});return t===1&&r===1?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=Math.floor(+t.getValue());if(r<=0)return f.create(g.VALUE);const n=[];for(let s=0;s<r;s++){n[s]=[];for(let u=0;u<r;u++)n[s][u]=s===u?1:0}return W.createByArray(n)}}class cE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return f.create(g.VALUE);let n=r<0?-qe(Math.abs(r),0):qe(r,0);return Number.isNaN(n)?f.create(g.VALUE):(Math.abs(n)%2===0&&(r<0?n--:n++),A.create(n))}}class hE extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){return A.create(Math.PI)}}class mE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}}class gE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(1),r=!0;for(let n=0;n<e.length;n++){let s=e[n];if(s.isError())return s;if(s.isArray()){let u=!1,o=null;if(s.iterator(i=>{if(i!=null&&i.isError())return u=!0,o=i,!1;if(!i||i.isNull()||i.isString()||i.isBoolean())return!0;t=t.multiply(i),r=!1}),u)return o}else{if(s.isNull())continue;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;t=t.multiply(s),r=!1}if(t.isError())return t}return r?A.create(0):t}}class fE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=G(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=+o.getValue();if(Number.isNaN(i)||Number.isNaN(l))return f.create(g.VALUE);if(l===0)return f.create(g.DIV_BY_ZERO);const c=Math.trunc(i/l);return A.create(c)}}class dE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(!Number.isFinite(r))return f.create(g.VALUE);const n=r*(Math.PI/180);return Number.isNaN(n)?f.create(g.VALUE):A.create(n)}}class NE extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",0)}calculate(){return A.create(Math.random())}}class _E extends R{constructor(){super(...arguments),N(this,"minParams",0),N(this,"maxParams",5),N(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,s){if(e!=null&&e.isError())return e;if(t!=null&&t.isError())return t;if(r!=null&&r.isError())return r;if(n!=null&&n.isError())return n;if(s!=null&&s.isError())return s;const u=e??A.create(1),o=t??A.create(1),i=r??A.create(0),l=n??A.create(1),c=s??A.create(0);return this._calculateResult(u,o,i,l,c)}_calculateResult(e,t,r,n,s){const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1);if(u===1&&o===1)return this._calculateSingleCell(e,t,r,n,s);const i=S(u,o,e,f.create(g.NA)),l=S(u,o,t,f.create(g.NA)),c=S(u,o,r,f.create(g.NA)),h=S(u,o,n,f.create(g.NA)),m=S(u,o,s,f.create(g.NA));return i.map((d,_,C)=>{const E=l.get(_,C),p=c.get(_,C),y=h.get(_,C),b=m.get(_,C),O=this._handleError(d,E,p,y,b);if(O.errorObject)return O.errorObject;let{minValue:M,maxValue:V,wholeNumberValue:T}=O,x;return T?(M=Math.ceil(M),V=Math.floor(V),x=Math.floor(Math.random()*(V-M+1))+M):x=Math.random()*(V-M)+M,x<M||x>V?f.create(g.VALUE):A.create(x)})}_calculateSingleCell(e,t,r,n,s){let u=e;u.isArray()&&(u=u.get(0,0));let o=t;o.isArray()&&(o=o.get(0,0));let i=r;i.isArray()&&(i=i.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let c=s;c.isArray()&&(c=c.get(0,0));const h=this._handleError(u,o,i,l,c);if(h.errorObject)return h.errorObject;let{rowsValue:m,columnsValue:d,minValue:_,maxValue:C,wholeNumberValue:E}=h;if(E&&(_=Math.ceil(_),C=Math.floor(C),_>C))return f.create(g.VALUE);const p=[];for(let y=0;y<m;y++){const b=[];for(let O=0;O<d;O++)E?b.push(Math.floor(Math.random()*(C-_+1))+_):b.push(Math.random()*(C-_)+_);p.push(b)}return m===1&&d===1?A.create(p[0][0]):W.createByArray(p)}_handleError(e,t,r,n,s){let u=e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return{errorObject:u};let o=t;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return{errorObject:o};let i=r;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return{errorObject:i};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let c=s;return c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()?{errorObject:c}:this._getValue(u,o,i,l,c)}_getValue(e,t,r,n,s){const u=Math.floor(+e.getValue()),o=Math.floor(+t.getValue());if(u===0||o===0)return{errorObject:f.create(g.CALC)};const i=this._rowCount-this.row,l=this._columnCount-this.column;if(u<0||o<0||u*o>10**7)return{errorObject:f.create(g.VALUE)};if(u>i||o>l)return{errorObject:f.create(g.REF)};const c=+r.getValue(),h=+n.getValue(),m=+s.getValue();return c>h?{errorObject:f.create(g.VALUE)}:m&&(!Number.isInteger(c)||!Number.isInteger(h))?{errorObject:f.create(g.VALUE)}:{rowsValue:u,columnsValue:o,minValue:c,maxValue:h,wholeNumberValue:m}}}class CE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){const i=r.getRowCount(),l=r.getColumnCount();if(i>1||l>1)return f.create(g.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){const i=n.getRowCount(),l=n.getColumnCount();if(i>1||l>1)return f.create(g.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return f.create(g.VALUE);let s=+r.getValue(),u=+n.getValue();if(Number.isNaN(s)||Number.isNaN(u))return f.create(g.VALUE);if(s>u)return f.create(g.NUM);s=Math.ceil(s),u=Math.floor(u);const o=Math.floor(Math.random()*(u-s+1))+s;return A.create(o)}}class EE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e);if(r)return n;const[u]=s;let o=Math.floor(+u.getValue()),i=t;if(i.isString()&&(i=i.convertToNumberObjectValue(),i.isError()))return i;let l=Math.floor(+i.getValue());if(i.isBoolean()&&(l=i.getValue()?0:4),o<0||o>3999||l<0||l>4)return f.create(g.VALUE);const c=Td[l];let h=c.length-1,m="";for(;o>0;){h=this._binarySearch(o,0,h,c);const d=c[h];o-=d,m+=Vd.get(d)}return w.create(m)}_binarySearch(e,t,r,n){let s=t,u=r;for(;u-s>1;){const o=Math.floor((s+u)/2),i=n[o];if(i===e)return o;i>e?u=o:s=o}return s!==u&&n[u]<=e?u:s}}class AE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}}class pE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);if(i.isError())return i;if(h.isError())return h;const{isError:m,errorObject:d,variants:_}=F(i,h);if(m)return d;const[C,E]=_,p=+C.getValue(),y=Math.trunc(+E.getValue()),b=this._roundBank(p,y);return A.create(b)});return r===1&&n===1?o.get(0,0):o}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;const r=1e-8,n=10**t,s=+(e*n).toFixed(8),u=Math.floor(s),o=s-u;let i=Math.round(s);return o>.5-r&&o<.5+r&&(i=u%2===0?u:u+1),t?i/n:i}}class yE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}}class bE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}}class RE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Math.abs(r)>=2**27?f.create(g.NUM):t.cos().getReciprocal()}}class SE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=2**27?f.create(g.NUM):t.cosh().getReciprocal():A.create(0)}}class OE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4),N(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let s=e,u=t??A.create(1),o=r??A.create(1),i=n??A.create(1);s.isNull()&&(s=A.create(1)),u.isNull()&&(u=A.create(1)),o.isNull()&&(o=A.create(1)),i.isNull()&&(i=A.create(1));const l=Math.max(s.isArray()?s.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(s.isArray()?s.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,s,f.create(g.NA)),m=S(l,c,u,f.create(g.NA)),d=S(l,c,o,f.create(g.NA)),_=S(l,c,i,f.create(g.NA)),C=h.mapValue((E,p,y)=>{const b=m.get(p,y),O=d.get(p,y),M=_.get(p,y);return E.isError()?E:b.isError()?b:O.isError()?O:M.isError()?M:this._getResult(E,b,O,M,l,c)});return l===1&&c===1?C.get(0,0):C}_getResult(e,t,r,n,s,u){const{isError:o,errorObject:i,variants:l}=F(e,t,r,n);if(o)return i;const[c,h,m,d]=l,_=Math.floor(+c.getValue()),C=Math.floor(+h.getValue()),E=+m.getValue(),p=+d.getValue();if(_<0||C<0||_*C>10**7)return f.create(g.VALUE);if(_===0||C===0)return f.create(g.CALC);const y=this._rowCount-this.row,b=this._columnCount-this.column;if(_>y||C>b)return f.create(g.REF);const O=[];for(let M=0;M<_;M++){O[M]=[];for(let V=0;V<C;V++)O[M][V]=E+(M*C+V)*p}return s>1||u>1?A.create(O[0][0]):W.createByArray(O)}}class ME extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return f.create(g.NA);const{isError:s,errorObject:u,variants:o}=G(e,t,r);if(s)return u;const{isError:i,errorObject:l,variants:c}=F(...o);if(i)return l;const[h,m,d]=c,_=+h.getValue(),C=+m.getValue(),E=+d.getValue(),p=[];if(n.isArray()){let b=!1,O=f.create(g.VALUE);if(n.iterator(M=>{const{isError:V,errorObject:T,coefficientsObject:x}=this._handleSingleObject(M);if(V)return b=!0,O=T,!1;const v=+x.getValue();p.push(v)}),b)return O}else{const{isError:b,errorObject:O,coefficientsObject:M}=this._handleSingleObject(n);if(b)return O;const V=+M.getValue();p.push(V)}let y=0;for(let b=0;b<p.length;b++)y+=p[b]*_**(C+b*E);return Number.isNaN(y)||!Number.isFinite(y)?f.create(g.NUM):A.create(y)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(e!=null&&e.isBoolean())return{isError:!0,errorObject:f.create(g.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}}class VE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue();return u>0?A.create(1):u<0?A.create(-1):A.create(0)}}class TE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}}class IE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}}class xE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}}class UE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){const s=t.getRowCount(),u=t.getColumnCount();if(s>1||u>1)return f.create(g.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;const r=+t.getValue();if(r<0)return f.create(g.NUM);const n=Math.sqrt(r*Math.PI);return A.create(n)}}const vE={1:Ve.AVERAGE,2:Ve.COUNT,3:Ve.COUNTA,4:Ve.MAX,5:Ve.MIN,6:Ve.PRODUCT,7:Ve.STDEV,8:Ve.STDEVP,9:Ve.SUM,10:Ve.VAR,11:Ve.VARP};class wE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255),N(this,"needsReferenceObject",!0),N(this,"needsFilteredOutRows",!0),N(this,"needsFormulaDataModel",!0)}calculate(e,...t){let r;e.isReferenceObject()?r=e.toArrayValueObject():r=e;const{isError:n,multiAreaRefs:s,normalRefs:u}=Yl(t);if(!n&&s.length>0)return this._handleMultiAreaRefs(r,s,t);if(r.isArray()){const o=r.mapValue(i=>this._handleSingleObject(i,{isError:n,refs:u}));return o.getRowCount()===1&&o.getColumnCount()===1?o.get(0,0):o}return this._handleSingleObject(r,{isError:n,refs:u})}_handleSingleObject(e,t){const{isError:r=!1,refs:n}=t;let s=e;if(e.isString()&&(s=e.convertToNumberObjectValue()),s.isError())return s;if(r)return f.create(g.VALUE);let u=Math.floor(+s.getValue());if(u<1||u>11&&u<101||u>111)return f.create(g.VALUE);let o=!1;return u>=101&&(u-=100,o=!0),ql({type:vE[u],ignoreRowHidden:o,ignoreErrorValues:!1,ignoreNested:!0,formulaDataModel:this._formulaDataModel},n)}_handleMultiAreaRefs(e,t,r){const n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,{multiAreaInfoMap:u,maxAreasLen:o}=this._getMultiAreaInfo(t),i=Math.max(n,o),l=[];for(let c=0;c<i;c++){const h=c<n?c:n-1,m=[];for(let d=0;d<s;d++){if(n>1&&c>=n){m.push(f.create(g.NA));continue}const _=e.isArray()?e.get(h,d):e,C=[];for(let p=0;p<r.length;p++){const y=r[p],b=u.get(y);if(b){const O=c<b.rowAreas.length?c:b.rowAreas.length-1,M=b.rowAreas[O];if(M.isError()){m.push(M);break}C.push(M);continue}C.push(y)}const E=this._handleSingleObject(_,{isError:!1,refs:C});m.push(E)}l.push(m)}return l.length===1?l[0][0]:ft(l,l.length,s)}_getMultiAreaInfo(e){const t=new Map;let r=1;return e.forEach(n=>{const s=n.getAreas().map(u=>{if(!u||u.length===0)return n;const o=u.find(i=>!i.isError());return o??u[0]});t.set(n,{ref:n,rowAreas:s}),r=Math.max(r,s.length||1)}),{multiAreaInfoMap:t,maxAreasLen:r}}}class DE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if(t=t.plus(n),t.isError())return t}return t}}class LE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return f.create(g.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(u=>this._handleSingleObject(e,u,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=ta(n,t);s=ra(s,n,t);const u=n.getRowCount(),o=n.getColumnCount();let i=n;if(r){i=r.toArrayValueObject();const l=i.getRowCount(),c=i.getColumnCount();if(u!==l||o!==c){const h=r.getRangeData();h.endRow=h.startRow+u-1,h.endColumn=h.startColumn+o-1,r.setRangeData(h),i=r.toArrayValueObject()}}return i.pick(s).sum()}}class PE extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:u,criteriaMaxColumnLength:o,targetRange:i,variants:l}=Rn(t,e);if(r)return n;if(s)return u===1&&o===1?f.create(g.VALUE):S(u,o,f.create(g.VALUE));const c=Sn(l,u,o,!0);return this._aggregateResults(i,c)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>e.pick(s).sum()));return r.length===1&&r[0].length===1?r[0][0]:W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class FE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;const r=this._initArray1(e);if(t.length===0)return r.sum();const n=r.getRowCount(),s=r.getColumnCount(),u=this._getResultArrayByArray1(n,s,r);if(u instanceof f)return u;const o=u;return this._validateVariants(t,n,s)||this._sumProduct(o,t,n,s)}_validateVariants(e,t,r){for(const n of e){if(n.isError())return n;if(n.isArray()){const s=n,u=s.getRowCount(),o=s.getColumnCount();if(u!==t&&o!==r)return f.create(g.VALUE)}}return null}_sumProduct(e,t,r,n){let s=0;for(let u=0;u<r;u++)for(let o=0;o<n;o++){let i=e[u][o];for(let l=0;l<t.length;l++){const c=t[l],h=this._getVariantCell(c,u,o);if(!h)return f.create(g.VALUE);if(h.isError())return h;h.isNumber()?i*=h.getValue():i=0}s+=i}return A.create(s)}_getVariantCell(e,t,r){if(!e.isArray())return e;const n=e.get(t,r);return n??null}_initArray1(e){let t=e;return t.isArray()||(t=W.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){const n=[];for(let s=0;s<e;s++){const u=[];for(let o=0;o<t;o++){const i=r.get(s,o);if(i.isError())return i;i.isNumber()?u.push(i.getValue()):u.push(0)}n.push(u)}return n}}class jE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0);const r=A.create(2);for(let n=0;n<e.length;n++){let s=e[n];if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()?s.iterator(u=>{if(u==null||u.isString()||u.isBoolean()||u.isNull())return!0;if(u.isError())return t=u,!1;t=t.plus(u.pow(r))}):t=t.plus(s.pow(r)),t.isError())return t}return t}}class BE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,u=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,i=u*o;if(s!==i)return f.create(g.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),c=t.flatten();let h=ce.create();const m=[],d=[];let _=0;return l.iterator((C,E,p)=>{const y=c.get(E,p);if(C==null||C.isString()||C.isBoolean()||C.isNull())return!0;if(C!=null&&C.isError())return h=C,!1;if(y==null||y.isString()||y.isBoolean()||y.isNull())return!0;if(y!=null&&y.isError())return h=y,!1;const b=+C.getValue(),O=+y.getValue();m.push(b),d.push(O),_+=b**2-O**2}),h.isError()?h:m.length===0||d.length===0?f.create(g.DIV_BY_ZERO):A.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return f.create(g.VALUE);const s=+r.getValue(),u=+n.getValue();if(r.isString()&&!Q(s)||r.isBoolean()||n.isString()&&!Q(u)||n.isBoolean())return f.create(g.DIV_BY_ZERO);const o=s**2-u**2;return A.create(o)}}class kE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,u=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,i=u*o;if(s!==i)return f.create(g.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),c=t.flatten();let h=ce.create();const m=[],d=[];let _=0;return l.iterator((C,E,p)=>{const y=c.get(E,p);if(C==null||C.isString()||C.isBoolean()||C.isNull())return!0;if(C!=null&&C.isError())return h=C,!1;if(y==null||y.isString()||y.isBoolean()||y.isNull())return!0;if(y!=null&&y.isError())return h=y,!1;const b=+C.getValue(),O=+y.getValue();m.push(b),d.push(O),_+=b**2+O**2}),h.isError()?h:m.length===0||d.length===0?f.create(g.DIV_BY_ZERO):A.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return f.create(g.VALUE);const s=+r.getValue(),u=+n.getValue();if(r.isString()&&!Q(s)||r.isBoolean()||n.isString()&&!Q(u)||n.isBoolean())return f.create(g.DIV_BY_ZERO);const o=s**2+u**2;return A.create(o)}}class $E extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=r*n,u=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,i=u*o;if(s!==i)return f.create(g.NA);if(s===1)return this._calculateSingleCell(e,t);{const l=e.flatten(),c=t.flatten();let h=ce.create();const m=[],d=[];let _=0;return l.iterator((C,E,p)=>{const y=c.get(E,p);if(C==null||C.isString()||C.isBoolean()||C.isNull())return!0;if(C!=null&&C.isError())return h=C,!1;if(y==null||y.isString()||y.isBoolean()||y.isNull())return!0;if(y!=null&&y.isError())return h=y,!1;const b=+C.getValue(),O=+y.getValue();m.push(b),d.push(O),_+=(b-O)**2}),h.isError()?h:m.length===0||d.length===0?f.create(g.DIV_BY_ZERO):A.create(_)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return f.create(g.VALUE);const s=+r.getValue(),u=+n.getValue();if(r.isString()&&!Q(s)||r.isBoolean()||n.isString()&&!Q(u)||n.isBoolean())return f.create(g.DIV_BY_ZERO);const o=(s-u)**2;return A.create(o)}}class YE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}}class HE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}}class GE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.map((l,c,h)=>{let m=o.get(c,h),d=l;if(d.isString()&&(d=d.convertToNumberObjectValue()),d.isError())return d;if(m.isString()&&(m=m.convertToNumberObjectValue()),m.isError())return m;const _=+d.getValue(),C=+m.getValue(),E=10**Math.trunc(C),p=zs(_,E),y=Math.trunc(Xr(_,E)+p)/E;return A.create(y)});return n===1&&s===1?i.get(0,0):i}}const Qc=[[_C,j.ABS],[CC,j.ACOS],[EC,j.ACOSH],[AC,j.ACOT],[pC,j.ACOTH],[bC,j.AGGREGATE],[RC,j.ARABIC],[SC,j.ASIN],[OC,j.ASINH],[MC,j.ATAN],[VC,j.ATAN2],[TC,j.ATANH],[IC,j.BASE],[xC,j.CEILING],[UC,j.CEILING_MATH],[vC,j.CEILING_PRECISE],[wC,j.COMBIN],[DC,j.COMBINA],[LC,j.COS],[PC,j.COSH],[FC,j.COT],[jC,j.COTH],[BC,j.CSC],[kC,j.CSCH],[$C,j.DECIMAL],[YC,j.DEGREES],[HC,j.EVEN],[GC,j.EXP],[XC,j.FACT],[qC,j.FACTDOUBLE],[WC,j.FLOOR],[QC,j.FLOOR_MATH],[KC,j.FLOOR_PRECISE],[ZC,j.GCD],[zC,j.INT],[JC,j.LCM],[eE,j.LN],[tE,j.LOG],[rE,j.LOG10],[nE,j.MDETERM],[sE,j.MINVERSE],[aE,j.MMULT],[uE,j.MOD],[oE,j.MROUND],[iE,j.MULTINOMIAL],[lE,j.MUNIT],[cE,j.ODD],[hE,j.PI],[mE,j.POWER],[gE,j.PRODUCT],[fE,j.QUOTIENT],[dE,j.RADIANS],[NE,j.RAND],[_E,j.RANDARRAY],[CE,j.RANDBETWEEN],[EE,j.ROMAN],[AE,j.ROUND],[pE,j.ROUNDBANK],[yE,j.ROUNDDOWN],[bE,j.ROUNDUP],[RE,j.SEC],[SE,j.SECH],[ME,j.SERIESSUM],[OE,j.SEQUENCE],[VE,j.SIGN],[TE,j.SIN],[IE,j.SINH],[xE,j.SQRT],[UE,j.SQRTPI],[wE,j.SUBTOTAL],[DE,j.SUM],[LE,j.SUMIF],[PE,j.SUMIFS],[FE,j.SUMPRODUCT],[jE,j.SUMSQ],[BE,j.SUMX2MY2],[kE,j.SUMX2PY2],[$E,j.SUMXMY2],[YE,j.TAN],[HE,j.TANH],[GE,j.TRUNC]];class XE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2),N(this,"_compareType",k.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}}class io extends jt{constructor(e){super(""),N(this,"_values",[]),this._values=e}static create(e){return new io(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}getCubeValues(){return this._values}getCubeCount(){return this._values.length}sum(){const e=A.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=A.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=A.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{const r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){const e=A.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){const e=A.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){const e=A.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}class qE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isError())return n;if(!n.isArray())return f.create(g.VALUE);t.push(n)}return io.create(t)}}class WE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:!t.isArray()&&t.getValue()===0?f.create(g.DIV_BY_ZERO):e.divided(t)}}class QE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}}class KE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}}class ZE extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}}const Kc=[[XE,ke.COMPARE],[WE,ke.DIVIDED],[QE,ke.MINUS],[KE,ke.MULTIPLY],[ZE,ke.PLUS],[qE,ke.CUBE]],zE=new Set([j.ACOT,j.ACOTH,j.ARABIC,j.BASE,j.CEILING_MATH,j.CEILING_PRECISE,j.COMBINA,j.COT,j.COTH,j.CSC,j.CSCH,j.DECIMAL,j.FLOOR_MATH,j.FLOOR_PRECISE,j.MUNIT,j.RANDARRAY,j.SEC,j.SECH,j.SEQUENCE,te.CHOOSECOLS,te.CHOOSEROWS,te.DROP,te.EXPAND,te.FILTER,te.FORMULATEXT,te.HSTACK,te.SORT,te.SORTBY,te.TAKE,te.TOCOL,te.TOROW,te.UNIQUE,te.VSTACK,te.WRAPCOLS,te.WRAPROWS,te.XLOOKUP,te.XMATCH,X.BITAND,X.BITLSHIFT,X.BITOR,X.BITRSHIFT,X.BITXOR,X.ERF_PRECISE,X.ERFC_PRECISE,X.IMCOSH,X.IMCOT,X.IMCSC,X.IMCSCH,X.IMSEC,X.IMSECH,X.IMSINH,X.IMTAN,ye.ISFORMULA,ye.SHEET,ye.SHEETS,Ce.IFNA,Ce.IFS,Ce.SWITCH,Ce.XOR,I.BETA_DIST,I.BETA_INV,I.BINOM_DIST,I.BINOM_DIST_RANGE,I.BINOM_INV,I.CHISQ_DIST,I.CHISQ_DIST_RT,I.CHISQ_INV,I.CHISQ_INV_RT,I.CHISQ_TEST,I.CONFIDENCE_NORM,I.CONFIDENCE_T,I.COVARIANCE_P,I.COVARIANCE_S,I.EXPON_DIST,I.F_DIST,I.F_DIST_RT,I.F_INV,I.F_INV_RT,I.F_TEST,I.FORECAST_LINEAR,I.GAMMA,I.GAMMA_DIST,I.GAMMA_INV,I.GAMMALN_PRECISE,I.GAUSS,I.HYPGEOM_DIST,I.LOGNORM_DIST,I.LOGNORM_INV,I.MAXIFS,I.MINIFS,I.MODE_MULT,I.MODE_SNGL,I.NEGBINOM_DIST,I.NORM_DIST,I.NORM_INV,I.NORM_S_DIST,I.NORM_S_INV,I.PERCENTILE_EXC,I.PERCENTILE_INC,I.PERCENTRANK_EXC,I.PERCENTRANK_INC,I.PERMUTATIONA,I.PHI,I.POISSON_DIST,I.QUARTILE_EXC,I.QUARTILE_INC,I.RANK_AVG,I.RANK_EQ,I.SKEW_P,I.STDEV_P,I.STDEV_S,I.T_DIST,I.T_DIST_2T,I.T_DIST_RT,I.T_INV,I.T_INV_2T,I.T_TEST,I.VAR_P,I.VAR_S,I.WEIBULL_DIST,I.Z_TEST,z.ARRAYTOTEXT,On.ENCODEURL,z.NUMBERVALUE,z.TEXTAFTER,z.TEXTBEFORE,z.TEXTJOIN,z.TEXTSPLIT,z.UNICHAR,z.UNICODE,z.VALUETOTEXT,_e.DAYS,_e.ISOWEEKNUM,J.PDURATION,J.RRI,Ce.BYCOL,Ce.BYROW,Ce.MAKEARRAY,Ce.MAP,Ce.REDUCE,Ce.SCAN]);class JE extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0),r=A.create(0);for(let u=0;u<e.length;u++){let o=e[u];if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(o.isArray()){if(o=eA(o),o.isError())return o;if(e[u]=o,t=t.plus(o.sum()),t.isError())return t;r=r.plus(o.count())}else o.isNull()||(t=t.plus(o),r=r.plus(A.create(1)))}if(r.getValue()===0)return f.create(g.NUM);const n=t.divided(r);if(n.isError())return n;let s=A.create(0);for(let u=0;u<e.length;u++){let o=e[u];if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(o.isArray()){if(s=s.plus(o.minus(n).abs().sum()),s.isError())return s}else o.isNull()||(s=s.plus(o.minus(n).abs()))}return s.divided(r)}}function eA(a){const e=[];e[0]=[];let t=null;return a.iterator((r,n,s)=>{if(r!=null&&r.isError())return t=r,!1;r!=null&&r.isNumber()&&e[0].push(r)}),t||ft(e,1,e[0].length)}class tA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0),r=A.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(t=t.plus(s.sum()),t.isError())return t;r=r.plus(s.count())}else s.isNull()||(t=t.plus(s),r=r.plus(A.create(1)))}return t.divided(r)}}class rA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!==0&&(t=!0,r=f.create(g.NA));const n=[],s=[];for(let u=0;u<e.length;u+=2){const o=e[u],i=o.isArray()?o.getRowCount():1,l=o.isArray()?o.getColumnCount():1;for(let d=0;d<i;d++)for(let _=0;_<l;_++){const C=o.isArray()?o.get(d,_):o;if(C.isError())return C;if(t)continue;const E=C.isNull()?"":C.getValue();n.push(E)}if(u+1>=e.length)continue;const c=e[u+1],h=c.isArray()?c.getRowCount():1,m=c.isArray()?c.getColumnCount():1;(h!==i||m!==l)&&(t=!0,r=f.create(g.VALUE));for(let d=0;d<h;d++)for(let _=0;_<m;_++){const C=c.isArray()?c.get(d,_):c;if(C.isError())return C;if(t)continue;const E=C.isNull()?"":C.getValue();s.push(E)}}return t?r:this._getResult(n,s)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let o=0;o<r;o++){const i=e[o],l=t[o];if(!(typeof i!="number"&&typeof l!="number")){if(typeof i!="number"||typeof l!="number"||l<0)return f.create(g.VALUE);n+=i*l,s+=l}}if(s===0)return f.create(g.DIV_BY_ZERO);const u=n/s;return A.create(u)}}class nA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0),r=A.create(0);for(let n=0;n<e.length;n++){let s=e[n];if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(s.isArray()){if(s.iterator(u=>{if(u==null||u.isNull())return!0;let o=u;if(o.isString()&&(o=o.convertToNumberObjectValue(),o.isError()&&(o=A.create(0))),o.isBoolean()&&(o=o.convertToNumberObjectValue()),o.isError())return t=o,!1;t=t.plus(o),r=r.plus(A.create(1))}),t.isError())return t}else s.isNull()||(t=t.plus(s),r=r.plus(A.create(1)))}return t.divided(r)}}class sA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){if(!e.isReferenceObject()||r&&!r.isReferenceObject())return f.create(g.VALUE);let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){const s=n.mapValue(u=>this._handleSingleObject(e,u,r));return s.getRowCount()===1&&s.getColumnCount()===1?s.get(0,0):s}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){const n=e.toArrayValueObject();let s=ta(n,t);s=ra(s,n,t);const u=n.getRowCount(),o=n.getColumnCount();let i=n;if(r){i=r.toArrayValueObject();const m=i.getRowCount(),d=i.getColumnCount();if(u!==m||o!==d){const _=r.getRangeData();_.endRow=_.startRow+u-1,_.endColumn=_.startColumn+o-1,r.setRangeData(_),i=r.toArrayValueObject()}}const l=i.pick(s),c=l.sum(),h=l.count();return c.divided(h)}}class aA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:u,criteriaMaxColumnLength:o,targetRange:i,variants:l}=Rn(t,e);if(r)return n;if(s)return u===1&&o===1?f.create(g.VALUE):S(u,o,f.create(g.VALUE));const c=Sn(l,u,o,!0);return this._aggregateResults(i,c)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const u=e.pick(s),o=u.sum(),i=u.count();return o.divided(i)}));return r.length===1&&r[0].length===1?r[0][0]:W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class uA extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=s??A.create(0),i=u??A.create(1);o.isNull()&&(o=A.create(0)),i.isNull()&&(i=A.create(1));const l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,e,f.create(g.NA)),m=S(l,c,t,f.create(g.NA)),d=S(l,c,r,f.create(g.NA)),_=S(l,c,n,f.create(g.NA)),C=S(l,c,o,f.create(g.NA)),E=S(l,c,i,f.create(g.NA)),p=h.mapValue((y,b,O)=>{const M=m.get(b,O),V=d.get(b,O),T=_.get(b,O),x=C.get(b,O),v=E.get(b,O);return this._handleSingleObject(y,M,V,T,x,v)});return l===1&&c===1?p.get(0,0):p}_handleSingleObject(e,t,r,n,s,u){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(s.isError())return s;if(u.isError())return u;const{isError:o,errorObject:i,variants:l}=F(e,t,r,n,s,u);if(o)return i;const[c,h,m,d,_,C]=l,E=+c.getValue(),p=+h.getValue(),y=+m.getValue(),b=+d.getValue(),O=+_.getValue(),M=+C.getValue();if(p<=0||y<=0||E<O||E>M||O===M)return f.create(g.NUM);let V;return b?V=wl((E-O)/(M-O),p,y):V=Id((E-O)/(M-O),p,y)/(M-O),A.create(V)}}class oA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){let s=n??r;s.isNull()&&(s=r);const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=S(u,o,t,f.create(g.NA)),c=S(u,o,r,f.create(g.NA)),h=S(u,o,s,f.create(g.NA)),m=i.mapValue((d,_,C)=>{const E=l.get(_,C),p=c.get(_,C),y=h.get(_,C);return d.isError()?d:E.isError()?E:p.isError()?p:y.isError()?y:this._handleSingleObject(d,E,p,y)});return u===1&&o===1?m.get(0,0):m}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=Math.floor(+i.getValue()),d=+l.getValue(),_=Math.floor(+c.getValue()),C=Math.floor(+h.getValue());if(m<0||d<0||d>1||_<0||_>m||C<0||C<_||C>m)return f.create(g.NUM);let E=0;for(let p=_;p<=C;p++)E+=to(p,m,d);return A.create(E)}}class iA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=+l.getValue();if(c<0||h<1||h>10**10)return f.create(g.NUM);let d;return m?d=ro(c,h):d=xd(c,h),A.create(d)}}class lA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<0||i>1||l<1||l>10**10)return f.create(g.NUM);const c=Ll(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class cA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);if(c.isError())return c;if(d.isError())return d;if(_.isError())return _;const{isError:C,errorObject:E,variants:p}=F(c,d,_);if(C)return E;const[y,b,O]=p,M=+y.getValue(),V=+b.getValue(),T=Math.floor(+O.getValue());if(M<=0||M>=1||V<=0||T<1)return f.create(g.NUM);if(T===1)return f.create(g.DIV_BY_ZERO);const x=Math.abs(oa(M/2,T-1)*V/Math.sqrt(T));return A.create(x)});return n===1&&s===1?l.get(0,0):l}}class hA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if(r*n===1||s*u===1)return o.isNull()||i.isNull()?f.create(g.VALUE):f.create(g.DIV_BY_ZERO);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const u=n/r,o=s/r;let i=0,l=0,c=0;for(let m=0;m<r;m++){const d=e[m]-u,_=t[m]-o;i+=d*_,l+=d**2,c+=_**2}const h=Math.sqrt(l*c);return h===0?f.create(g.DIV_BY_ZERO):A.create(i/h)}}class mA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0);for(let r=0;r<e.length;r++){const n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(A.create(1))):n.isNull()||(t=t.plus(A.create(1))))}return t}}class gA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(A.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(A.create(1)))}return t}}class fA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isError()?e:e.getValue()===""||e.isNull()?A.create(1):e.isArray()?e.countBlank():A.create(0)}}class dA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2),N(this,"needsReferenceObject",!0)}calculate(e,t){if(!e.isReferenceObject())return f.create(g.VALUE);let r=t;if(t.isReferenceObject()&&(r=t.toArrayValueObject()),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=e.toArrayValueObject();let n=ta(r,t);n=ra(n,r,t);const s=r.pick(n);return this._countA(s)}_countA(e){let t=A.create(0);return e.iterator(r=>{if(r==null)return!0;t=t.plusBy(1)}),t}}class NA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(...e){const{isError:t,errorObject:r,rangeIsDifferentSize:n,criteriaMaxRowLength:s,criteriaMaxColumnLength:u,variants:o}=Rn(e);if(t)return r;if(n)return s===1&&u===1?f.create(g.VALUE):S(s,u,f.create(g.VALUE));const i=Sn(o,s,u,!0);return this._aggregateResults(i)}_aggregateResults(e){const t=e.map(r=>r.map(n=>_A(n)));return t.length===1&&t[0].length===1?t[0][0]:W.create({calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}function _A(a){let e=0;return a.iterator(t=>{t!=null&&t.isBoolean()&&t.getValue()===!0&&e++}),A.create(e)}class CA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return f.create(g.VALUE);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){if(e.length<=1)return f.create(g.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let l=0;l<r;l++)n+=e[l],s+=t[l];const u=n/r,o=s/r;let i=0;for(let l=0;l<r;l++){const c=e[l]-u,h=t[l]-o;i+=c*h}return A.create(i/(r-1))}}class EA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];let r=0,n=!0;for(let o=0;o<e.length;o++){const i=e[o];if(i.isArray()){let l=!1,c=f.create(g.VALUE);if(i.iterator(h=>{const m=this._handleSingleObject(h);if(m.isError())return l=!0,c=m,!1;if(m.isNull())return!0;const d=m.getValue();t.push(d),r+=d,n=!1}),l)return c}else{const l=this._handleSingleObject(i);if(l.isError())return l;if(l.isNull())continue;const c=l.getValue();t.push(c),r+=c,n=!1}}if(n)return f.create(g.NUM);const s=r/t.length;let u=0;for(let o=0;o<t.length;o++)u+=(t[o]-s)**2;return A.create(u)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return ce.create();const t=e.getValue();return Q(t)?A.create(+t):ce.create()}}class AA extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=+i.getValue(),d=Math.floor(+l.getValue()),_=Math.floor(+c.getValue()),C=+h.getValue();if(m<0||d<1||d>10**10||_<1||_>10**10)return f.create(g.NUM);let E;return C?E=no(m,d,_):E=Ud(m,d,_),Number.isNaN(E)||!Number.isFinite(E)?f.create(g.NUM):A.create(E)}}class pA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=Math.floor(+l.getValue());if(c<0||c>1||h<1||h>10**10||m<1||m>10**10)return f.create(g.NUM);const d=Pl(c,h,m);return Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}class yA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=s.getValue();if(u<=-1||u>=1)return f.create(g.NUM);const o=Math.log((1+u)/(1-u))/2;return A.create(o)}}class bA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(t=>this._handleSingleObject(t)):this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue(),o=Math.exp(2*u)-1,i=Math.exp(2*u)+1;return!Number.isFinite(o)&&o>0&&!Number.isFinite(i)&&i>0?A.create(1):A.create(o/i)}}class ui extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,u=r.isArray()?r.getRowCount():1,o=r.isArray()?r.getColumnCount():1;let i=t;t.isArray()&&n===1&&s===1&&(i=t.get(0,0));let l=r;return r.isArray()&&u===1&&o===1&&(l=r.get(0,0)),e.isArray()?e.mapValue(c=>this._handleSingleObject(c,i,l,n,s,u,o)):this._handleSingleObject(e,i,l,n,s,u,o)}_handleSingleObject(e,t,r,n,s,u,o){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let i=e;if(e.isString()&&(i=e.convertToNumberObjectValue()),i.isError())return i;const l=+i.getValue();if((n*s===1||u*o===1)&&(t.isNull()||r.isNull()))return f.create(g.VALUE);if(n*s!==u*o)return f.create(g.NA);const{isError:c,errorObject:h,array1Values:m,array2Values:d,noCalculate:_}=at(t,r,n*s,s,o);if(c)return h;if(_)return f.create(g.DIV_BY_ZERO);const C=Fl(l,m,d);return Number.isFinite(C)?A.create(C):f.create(g.DIV_BY_ZERO)}}class RA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,values:s}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return f.create(g.VALUE);let{values:u}=this._getValues(t,!0);u.length===0&&(u=[0]);const o=this._getNewBinsArrayValues(u),i=new Array(o.length).fill(0);for(let l=0;l<s.length;l++){const c=s[l],h=o.findIndex(m=>c>m.start&&c<=m.end);i[h]++}return W.createByArray(i.map(l=>[l]))}_getValues(e,t=!1){const r=[],n=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1;for(let u=0;u<n;u++)for(let o=0;o<s;o++){const i=e.isArray()?e.get(u,o):e;if(i.isError()){if(!t)return{isError:!0,errorObject:i,values:r};continue}if(i.isNull()||i.isBoolean())continue;const l=i.getValue();Q(l)&&r.push(+l)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){const t=e.map((n,s)=>({value:n,index:s})).sort((n,s)=>n.value-s.value),r=[];for(let n=0;n<t.length;n++){const s=t[n].index;if(n===0){r[s]={start:-1/0,end:t[n].value};continue}r[s]={start:t[n-1].value,end:t[n].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}}class SA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue();if(u===0||u<0&&u%1===0)return f.create(g.NUM);const o=zn(u);return Number.isNaN(o)||!Number.isFinite(o)?f.create(g.NUM):A.create(o)}}class oi extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue();if(u<=0)return f.create(g.NUM);const o=Nt(u);return Math.abs(o)<1e-15?A.create(0):A.create(o)}}class OA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue(),o=Tn(u,0,1)-.5;return A.create(o)}}class MA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let u=0;u<e.length;u++){const o=e[u];if(o.isArray()){let i=!1,l=f.create(g.VALUE);if(o.iterator(c=>{if(c!=null&&c.isError())return i=!0,l=c,!1;if(c!=null&&c.isNull()||c!=null&&c.isBoolean())return!0;const h=c.getValue();if(!Q(h))return!0;+h<=0&&(n=!0),t*=+h,r++}),i)return l}else{if(o.isError())return o;if(o.isString()){const l=o.convertToNumberObjectValue();if(l.isError())return l}if(o.isNull()||o.isBoolean())continue;const i=o.getValue();if(!Q(i))continue;+i<=0&&(n=!0),t*=+i,r++}}if(r===0||n)return f.create(g.NUM);const s=t**(1/r);return A.create(s)}}class VA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u}=ia(e,t,r);if(s)return u;const o=Ot(e);if(o instanceof f)return o;const i=this._getKnownXsValues(o,t);if(i instanceof f)return i;const l=this._getNewXsValues(i,r);if(l instanceof f)return l;let c=n??P.create(!0);if(c.isArray()&&(c=c.get(0,0)),c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const h=+c.getValue();return this._getResult(o,i,l,h)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?f.create(g.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,u=ha(e,t,r,n,!0);if(u instanceof f)return u;const{coefficients:o,newX:i}=u,l=o[0].length,c=o[0][l-1];let h=[];for(let m=0;m<i.length;m++){h[m]=[];let d=c;for(let _=l-2;_>=0;_--)d*=o[0][l-2-_]**i[m][_];h[m].push(d)}return s&&(h=Rt(h)),W.createByArray(h)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),u=t.flat(),{slope:o,intercept:i}=ca(u,s,n,!0),l=r.map(c=>c.map(h=>i*o**h));return W.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?la(e.length,e[0].length):Ot(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:Ot(t)}}class TA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let u=0;u<e.length;u++){const o=e[u];if(o.isArray()){let i=!1,l=f.create(g.VALUE);if(o.iterator(c=>{if(c!=null&&c.isError())return i=!0,l=c,!1;if(c!=null&&c.isNull()||c!=null&&c.isBoolean())return!0;const h=c.getValue();if(!Q(h))return!0;+h<=0&&(n=!0),t+=1/+h,r++}),i)return l}else{if(o.isError())return o;if(o.isString()){const l=o.convertToNumberObjectValue();if(l.isError())return l}if(o.isNull()||o.isBoolean())continue;const i=o.getValue();if(!Q(i))continue;+i<=0&&(n=!0),t+=1/+i,r++}}if(r===0)return f.create(g.NA);if(n)return f.create(g.NUM);const s=r/t;return A.create(s)}}class IA extends R{constructor(){super(...arguments),N(this,"minParams",5),N(this,"maxParams",5)}calculate(e,t,r,n,s){const u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=S(u,o,t,f.create(g.NA)),c=S(u,o,r,f.create(g.NA)),h=S(u,o,n,f.create(g.NA)),m=S(u,o,s,f.create(g.NA)),d=i.mapValue((_,C,E)=>{const p=l.get(C,E),y=c.get(C,E),b=h.get(C,E),O=m.get(C,E);return _.isError()?_:p.isError()?p:y.isError()?y:b.isError()?b:O.isError()?O:this._handleSingleObject(_,p,y,b,O)});return u===1&&o===1?d.get(0,0):d}_handleSingleObject(e,t,r,n,s){const{isError:u,errorObject:o,variants:i}=F(e,t,r,n,s);if(u)return o;const[l,c,h,m,d]=i,_=Math.floor(+l.getValue()),C=Math.floor(+c.getValue()),E=Math.floor(+h.getValue()),p=Math.floor(+m.getValue()),y=+d.getValue();if(_<0||_>C||_>E||_<C-p+E||C<=0||C>p||E<=0||E>p||p<=0)return f.create(g.NUM);let b;return y?b=Fd(_,C,E,p):b=ao(_,C,E,p),Number.isNaN(b)&&(b=0),A.create(b)}}class xA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if(r*n===1||s*u===1)return o.isNull()||i.isNull()?f.create(g.VALUE):f.create(g.DIV_BY_ZERO);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){const r=Fl(0,e,t);return Number.isFinite(r)?A.create(r):f.create(g.DIV_BY_ZERO)}}class UA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const i=s.convertToNumberObjectValue();if(i.isError())return i}const u=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let i=0;i<u;i++)for(let l=0;l<o;l++){const c=s.isArray()?s.get(i,l):s;if(c.isError())return c;if(c.isNull()||c.isBoolean())continue;const h=c.getValue();Q(h)&&(t.push(+h),r+=+h)}}return t.length<=3?f.create(g.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const u=Math.sqrt(s/(r-1));if(u===0)return f.create(g.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/u)**4;const i=r*(r+1)/((r-1)*(r-2)*(r-3))*o-3*(r-1)**2/((r-2)*(r-3));return A.create(i)}}class vA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=+u.getValue();return Ql(e,o)}}class wA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u}=ia(e,t);if(s)return u;const o=Ot(e);if(o instanceof f)return o;const i=this._getKnownXsValues(o,t);if(i instanceof f)return i;let l=r??P.create(!0);l.isArray()&&(l=l.get(0,0));let c=n??P.create(!1);c.isArray()&&(c=c.get(0,0));const{isError:h,errorObject:m,variants:d}=F(l,c);if(h)return m;const[_,C]=d;return this._getResult(o,i,+_.getValue(),+C.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?f.create(g.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=ha(e,t,t,r,!1);if(s instanceof f)return s;const{coefficients:u,X:o,XTXInverse:i}=s;let l=[];if(n){const c=e.flat(),h=c.length,m=r?c.reduce((L,D)=>L+D,0)/h:0,d=i.length,_=h-d,C=u[0].length,E=new Array(C-2).fill(g.NA),p=u[0][C-1],y=[];for(let L=0;L<o.length;L++){let D=p;for(let Y=C-2;Y>=0;Y--)D+=u[0][C-2-Y]*o[L][Y];y.push(D)}let b=0,O=0;for(let L=0;L<h;L++)b+=(c[L]-m)**2,O+=(c[L]-y[L])**2;const M=b-O,V=b===0?0:M/b,T=[];for(let L=d-1;L>=0;L--){const D=_>0?Math.sqrt(O/_*i[L][L]):0;T.push(D)}if(r){const L=T.shift();T.push(L)}else T.push(g.NA);const x=_>0?Math.sqrt(O/_):0,v=_>0?M/(C-1)/(O/_):g.NUM;l=[u[0],[...T],[V,x,...E],[v,_,...E],[M,O,...E]]}else l=[u[0]];return W.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),u=t.flat(),{slope:o,intercept:i}=ca(u,s,r,!1);if(Number.isNaN(o))return f.create(g.NA);let l=[];if(n){const c=s.length;let h=0,m=0,d=c-1;if(r){let T=0,x=0;for(let v=0;v<c;v++)T+=s[v],x+=u[v];h=T/c,m=x/c,d=c-2}let _=0,C=0,E=0;for(let T=0;T<c;T++)_+=(s[T]-h)**2,C+=(s[T]-(o*u[T]+i))**2,E+=(u[T]-m)**2;const p=_-C,y=p===_?1:p/_;let b=0,O=0,M=0;d>0&&(E>0&&(b=Math.sqrt(C/d/E),O=Math.sqrt(C/d*(1/c+m**2/E))),M=Math.sqrt(C/d));const V=d>0?p/1/(C/d):g.NUM;r||(O=g.NA),l=[[o,i],[b,O],[y,M],[V,d],[p,C]]}else l=[[o,i]];return W.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?la(e.length,e[0].length):Ot(t)}}class DA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u}=ia(e,t);if(s)return u;const o=Ot(e);if(o instanceof f)return o;const i=this._getKnownXsValues(o,t);if(i instanceof f)return i;let l=r??P.create(!0);l.isArray()&&(l=l.get(0,0));let c=n??P.create(!1);c.isArray()&&(c=c.get(0,0));const{isError:h,errorObject:m,variants:d}=F(l,c);if(h)return m;const[_,C]=d;return this._getResult(o,i,+_.getValue(),+C.getValue())}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(r?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?f.create(g.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=ha(e,t,t,r,!0);if(s instanceof f)return s;const{coefficients:u,Y:o,X:i,XTXInverse:l}=s;let c=[];if(n){const h=o.flat(),m=h.length,d=r?h.reduce((D,Y)=>D+Y,0)/m:0,_=l.length,C=m-_,E=u[0].length,p=new Array(E-2).fill(g.NA),y=u[0][E-1],b=[];for(let D=0;D<i.length;D++){let Y=y;for(let ee=E-2;ee>=0;ee--)Y*=u[0][E-2-ee]**i[D][ee];b.push(Math.log(Y))}let O=0,M=0;for(let D=0;D<m;D++)O+=(h[D]-d)**2,!(!r&&!Number.isFinite(b[D]))&&(M+=(h[D]-b[D])**2);Number.isFinite(M)||(M=0);const V=O-M,T=O===0?0:V/O,x=[];for(let D=_-1;D>=0;D--){const Y=C>0?Math.sqrt(M/C*l[D][D]):0;x.push(Y)}if(r){const D=x.shift();x.push(D)}else x.push(g.NA);const v=C>0?Math.sqrt(M/C):0,L=C>0?V/(E-1)/(M/C):g.NUM;c=[u[0],[...x],[T,v,...p],[L,C,...p],[V,M,...p]]}else c=[u[0]];return W.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),u=t.flat(),{slope:o,intercept:i,Y:l}=ca(u,s,r,!0);if(Number.isNaN(o))return f.create(g.NA);let c=[];if(n){const h=l.length;let m=0,d=0,_=h-1;if(r){let x=0,v=0;for(let L=0;L<h;L++)x+=l[L],v+=u[L];m=x/h,d=v/h,_=h-2}let C=0,E=0,p=0;for(let x=0;x<h;x++)C+=(l[x]-m)**2,E+=(l[x]-Math.log(i*o**u[x]))**2,p+=(u[x]-d)**2;const y=C-E,b=C===0?0:y/C;let O=0,M=0,V=0,T=0;_>0&&(p>0&&(O=Math.sqrt(E/_/p),M=Math.sqrt(E/_*(1/h+d**2/p))),V=Math.sqrt(E/_),T=y/1/(E/_)),r||(M=g.NA),c=[[o,i],[O,M],[b,V],[T,_],[y,E]]}else c=[[o,i]];return W.createByArray(c)}_getKnownXsValues(e,t){return!t||t.isNull()?la(e.length,e[0].length):Ot(t)}}class LA extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=+i.getValue(),d=+l.getValue(),_=+c.getValue(),C=+h.getValue();if(m<=0||_<=0)return f.create(g.NUM);let E;return C?E=Bl(m,d,_):E=jd(m,d,_),A.create(E)}}class PA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=this._getRangeValues(e);if(r instanceof f)return r;const n=ir(t);if(n.isError())return n;const{isError:s,errorObject:u,variants:o}=F(n);if(s)return u;const[i]=o,l=+i.getValue();if(l<=0||l>=1)return f.create(g.NUM);if(r.length<2)return f.create(g.DIV_BY_ZERO);const c=1-l,h=r.length,m=r.reduce((E,p)=>E+p,0)/h,d=r.reduce((E,p)=>E+(p-m)**2,0)/(h-1),_=Math.sqrt(d);if(_<=0)return f.create(g.NUM);const C=Math.abs(oa(c/2,h-1)*_/Math.sqrt(h));return A.create(C)}_getRangeValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let u=0;u<n;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;o.isNull()||o.isBoolean()||o.isString()||t.push(+o.getValue())}return t}}class FA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?A.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class jA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let u=s;if((u==null||u.isNull()||u.isString())&&(u=A.create(0)),u.isBoolean()&&(u=u.convertToNumberObjectValue()),u.isError())return t=u,!1;t=this._validator(t,u)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?A.create(0):t}_validator(e,t){const r=e.isLessThan(t);let n=e;return r.getValue()&&(n=t),n}}class BA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:u,criteriaMaxColumnLength:o,targetRange:i,variants:l}=Rn(t,e);if(r)return n;if(s)return u===1&&o===1?f.create(g.VALUE):S(u,o,f.create(g.VALUE));const c=Sn(l,u,o,!0);return this._aggregateResults(i,c)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const u=e.pick(s);return u.getColumnCount()===0?W.create("0"):u.max()}));return r.length===1&&r[0].length===1?r[0][0]:W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class kA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];if(n.isArray()){let s=!1,u=f.create(g.VALUE);if(n.iterator(o=>{if(o!=null&&o.isError())return s=!0,u=o,!1;if(o!=null&&o.isNull()||o!=null&&o.isBoolean())return!0;const i=o.getValue();if(!Q(i))return!0;t.push(+i)}),s)return u}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){const u=n.convertToNumberObjectValue();if(u.isError())return u}const s=n.getValue();if(!Q(s))continue;t.push(+s)}}return t.length===0?f.create(g.NUM):Wl(t)}}class $A extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?A.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class YA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=A.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(s=>{let u=s;if((u==null||u.isNull()||u.isString())&&(u=A.create(0)),u.isBoolean()&&(u=u.convertToNumberObjectValue()),u.isError())return t=u,!1;t=this._validator(t,u)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?A.create(0):t}_validator(e,t){const r=e.isGreaterThan(t);let n=e;return r.getValue()&&(n=t),n}}class HA extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255),N(this,"needsReferenceObject",!0)}calculate(e,...t){const{isError:r,errorObject:n,rangeIsDifferentSize:s,criteriaMaxRowLength:u,criteriaMaxColumnLength:o,targetRange:i,variants:l}=Rn(t,e);if(r)return n;if(s)return u===1&&o===1?f.create(g.VALUE):S(u,o,f.create(g.VALUE));const c=Sn(l,u,o,!0);return this._aggregateResults(i,c)}_aggregateResults(e,t){const r=t.map(n=>n.map(s=>{const u=e.pick(s);return u.getColumnCount()===0?W.create("0"):u.min()}));return r.length===1&&r[0].length===1?r[0][0]:W.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column})}}class GA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t={};let r=0,n=1;for(let s=0;s<e.length;s++){const u=e[s];if(u.isError())return u;if(u.isString()){const l=u.convertToNumberObjectValue();if(l.isError())return l}const o=u.isArray()?u.getRowCount():1,i=u.isArray()?u.getColumnCount():1;for(let l=0;l<o;l++)for(let c=0;c<i;c++){const h=u.isArray()?u.get(l,c):u;if(h.isError())return h;if(h.isNull()||h.isBoolean()||h.isString())continue;const m=h.getValue();Q(m)&&(t[+m]?(t[+m].count++,t[+m].count>n&&(n=t[+m].count)):t[+m]={count:1,order:r++})}}return r===0||n===1?new f(g.NA):this._getResult(t,n)}_getResult(e,t){const r=Object.entries(e).filter(([n,{count:s}])=>s===t).sort((n,s)=>n[1].order-s[1].order).map(([n])=>+n);return r.length===1?A.create(r[0]):W.createByArray(r.map(n=>[n]))}}class XA extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(e,t,r,n);if(s)return u;const[i,l,c,h]=o,m=Math.floor(+i.getValue()),d=Math.floor(+l.getValue()),_=+c.getValue(),C=+h.getValue();if(m<0||d<1||_<=0||_>=1)return f.create(g.NUM);let E;return C?E=kd(m,d,_):E=uo(m,d,_),A.create(E)}}class qA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=+o.getValue();let c;return l?c=Tn(i,0,1):c=kl(i,0,1),A.create(c)}}class WA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if(r*n===1||s*u===1)return o.isNull()||i.isNull()?f.create(g.VALUE):f.create(g.DIV_BY_ZERO);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const u=n/r,o=s/r;let i=0,l=0,c=0;for(let m=0;m<r;m++)i+=(e[m]-u)*(t[m]-o),l+=(e[m]-u)**2,c+=(t[m]-o)**2;if(l===0||c===0)return f.create(g.DIV_BY_ZERO);const h=i/Math.sqrt(l*c);return A.create(h)}}class QA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=+u.getValue();return zl(e,o)}}class KA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=this._getValues(e);let s=r??A.create(3);s.isNull()&&(s=A.create(3));const u=Math.max(t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,t,f.create(g.NA)),l=S(u,o,s,f.create(g.NA)),c=i.mapValue((h,m,d)=>{const _=l.get(m,d);return h.isError()?h:_.isError()?_:this._handleSingleObject(n,h,_)});return u===1&&o===1?c.get(0,0):c}_handleSingleObject(e,t,r){if(e instanceof f)return e;const{isError:n,errorObject:s,variants:u}=F(t,r);if(n)return s;const[o,i]=u,l=+o.getValue(),c=Math.floor(+i.getValue()),h=e.length;if(h===0||l<e[0]||l>e[h-1])return f.create(g.NA);if(h===1)return l===e[0]?A.create(1):f.create(g.NA);let m=0,d=!1,_=0;for(;!d&&_<h;)l===e[_]?(m=(_+1)/(h+1),d=!0):l>e[_]&&_+1<h&&l<e[_+1]&&(m=(_+1+(l-e[_])/(e[_+1]-e[_]))/(h+1),d=!0),_++;return d?c<1?f.create(g.NUM):(m=Je(m,c),A.create(m)):f.create(g.NA)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let u=0;u<r;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const i=o.getValue();Q(i)&&n.push(+i)}return n.sort((s,u)=>s-u)}}class ZA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);if(i.isError())return i;if(h.isError())return h;const{isError:m,errorObject:d,variants:_}=F(i,h);if(m)return d;const[C,E]=_,p=Math.floor(+C.getValue()),y=Math.floor(+E.getValue());if(p<0||p>=2147483647||y<0||p<y)return f.create(g.NUM);let b=1;for(let O=p-y+1;O<=p;O++)b*=O;return Number.isFinite(b)?A.create(b):f.create(g.NUM)});return r===1&&n===1?o.get(0,0):o}}class zA extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);if(i.isError())return i;if(h.isError())return h;const{isError:m,errorObject:d,variants:_}=F(i,h);if(m)return d;const[C,E]=_,p=Math.floor(+C.getValue()),y=Math.floor(+E.getValue());if(p<0||p>=2147483647||y<0)return f.create(g.NUM);if(p===0)return y===0?A.create(1):A.create(0);const b=p**y;return Number.isFinite(b)?A.create(b):f.create(g.NUM)});return r===1&&n===1?o.get(0,0):o}}class JA extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue(),o=Math.exp(-.5*u*u)/Math.sqrt(2*Math.PI);return A.create(o)}}class ep extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u,xRangeValues:o,probRangeValues:i}=this._handleXRangeAndProbRange(e,t);let l=n??r;n!=null&&n.isNull()&&(l=r);const c=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),h=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),m=S(c,h,r,f.create(g.NA)),d=S(c,h,l,f.create(g.NA)),_=m.mapValue((C,E,p)=>{const y=d.get(E,p);return e.isError()?e:t.isError()?t:C.isError()?C:y.isError()?y:s?u:this._handleSingleObject(o,i,C,y)});return c===1&&h===1?_.get(0,0):_}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(r,n);if(s)return u;const[i,l]=o,c=+i.getValue(),h=+l.getValue();if(t.reduce((d,_)=>d+_,0)!==1)return f.create(g.NUM);let m=0;for(let d=0;d<e.length;d++)e[d]>=c&&e[d]<=h&&(m+=t[d]);return A.create(m)}_handleXRangeAndProbRange(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return{isError:!0,errorObject:o,xRangeValues:[],probRangeValues:[]};let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return{isError:!0,errorObject:i,xRangeValues:[],probRangeValues:[]};if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return{isError:!0,errorObject:f.create(g.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!==s*u)return{isError:!0,errorObject:f.create(g.NA),xRangeValues:[],probRangeValues:[]};const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?{isError:!0,errorObject:c,xRangeValues:[],probRangeValues:[]}:d?{isError:!0,errorObject:f.create(g.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:h,probRangeValues:m}}}class tp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=Math.floor(+u.getValue());return ec(e,o)}}class rp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:u,refNumbers:o}=this._checkRefReferenceObject(t);let i=r??A.create(0);i.isReferenceObject()&&(i=i.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,n,f.create(g.NA)),m=S(l,c,i,f.create(g.NA)),d=h.map((_,C,E)=>{const p=m.get(C,E);if(!e.isReferenceObject()&&e.isNull())return f.create(g.NA);if(s)return u;if(p.isError())return p;const y=+_.getValue(),b=+p.getValue();return Number.isNaN(y)||Number.isNaN(b)?f.create(g.VALUE):this._getResult(y,b,o)});return l===1&&c===1?d.get(0,0):d}_getResult(e,t,r){const n=r.sort((i,l)=>t?i-l:l-i);let s=n.indexOf(e);const u=[];for(;s>=0;){const i=s+1;u.push(i),s=n.indexOf(e,i)}if(u.length===0)return f.create(g.NA);const o=u.reduce((i,l)=>i+l,0)/u.length;return A.create(o)}_checkRefReferenceObject(e){let t=!1,r=f.create(g.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(s=>{const u=s;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const o=+u.getValue();if(Number.isNaN(o))return!0;n.push(o)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class np extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3),N(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());const{refHasError:s,refErrorObject:u,refNumbers:o}=this._checkRefReferenceObject(t);let i=r??A.create(0);i.isReferenceObject()&&(i=i.toArrayValueObject());const l=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),c=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),h=S(l,c,n,f.create(g.NA)),m=S(l,c,i,f.create(g.NA)),d=h.map((_,C,E)=>{const p=m.get(C,E);if(!e.isReferenceObject()&&e.isNull())return f.create(g.NA);if(s)return u;if(p.isError())return p;const y=+_.getValue(),b=+p.getValue();if(Number.isNaN(y)||Number.isNaN(b))return f.create(g.VALUE);const O=o.sort((M,V)=>b?M-V:V-M).indexOf(y);return O===-1?f.create(g.NA):A.create(O+1)});return l===1&&c===1?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=f.create(g.NA);const n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(s=>{const u=s;if(u.isError())return t=!0,r=u,!1;if(u.isNull()||u.isBoolean())return!0;const o=+u.getValue();if(Number.isNaN(o))return!0;n.push(o)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}}class sp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return f.create(g.VALUE);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){if(e.length===0)return f.create(g.DIV_BY_ZERO);const r=e.length;let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const u=n/r,o=s/r;let i=0,l=0,c=0;for(let m=0;m<r;m++)i+=(e[m]-u)*(t[m]-o),l+=(e[m]-u)**2,c+=(t[m]-o)**2;if(l===0||c===0)return f.create(g.DIV_BY_ZERO);const h=(i/Math.sqrt(l*c))**2;return A.create(h)}}class ap extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const i=s.convertToNumberObjectValue();if(i.isError())return i}const u=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let i=0;i<u;i++)for(let l=0;l<o;l++){const c=s.isArray()?s.get(i,l):s;if(c.isError())return c;if(c.isNull()||c.isBoolean())continue;const h=c.getValue();Q(h)&&(t.push(+h),r+=+h)}}return t.length<=2?f.create(g.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const u=Math.sqrt(s/(r-1));if(u===0)return f.create(g.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/u)**3;const i=r/((r-1)*(r-2))*o;return A.create(i)}}class up extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=[];let r=0;for(let n=0;n<e.length;n++){const s=e[n];if(s.isError())return s;if(s.isString()){const i=s.convertToNumberObjectValue();if(i.isError())return i}const u=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let i=0;i<u;i++)for(let l=0;l<o;l++){const c=s.isArray()?s.get(i,l):s;if(c.isError())return c;if(c.isNull()||c.isBoolean())continue;const h=c.getValue();Q(h)&&(t.push(+h),r+=+h)}}return t.length<=2?f.create(g.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){const r=e.length,n=t/r;let s=0;for(let l=0;l<r;l++)s+=(e[l]-n)**2;const u=Math.sqrt(s/r);if(u===0)return f.create(g.DIV_BY_ZERO);let o=0;for(let l=0;l<r;l++)o+=((e[l]-n)/u)**3;const i=o/r;return A.create(i)}}class op extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if(r*n===1||s*u===1)return o.isNull()||i.isNull()?f.create(g.VALUE):f.create(g.DIV_BY_ZERO);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){const r=e.length;let n=0,s=0;for(let h=0;h<r;h++)n+=e[h],s+=t[h];const u=n/r,o=s/r;let i=0,l=0;for(let h=0;h<r;h++)i+=(e[h]-u)*(t[h]-o),l+=(t[h]-o)**2;if(l===0)return f.create(g.DIV_BY_ZERO);const c=i/l;return A.create(c)}}class ip extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Sr(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(!Array.isArray(e))return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=+u.getValue();return Kl(e,o)}}class lp extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=+i.getValue(),m=+l.getValue();if(m<=0)return f.create(g.NUM);const d=(c-h)/m;return A.create(d)}}class cp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}}class hp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.std()}}class mp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,u=t.isArray()?t.getColumnCount():1;let o=e;if(e.isArray()&&r===1&&n===1&&(o=e.get(0,0)),o.isError())return o;let i=t;if(t.isArray()&&s===1&&u===1&&(i=t.get(0,0)),i.isError())return i;if((r*n===1||s*u===1)&&(o.isNull()||i.isNull()))return f.create(g.VALUE);if(r*n!==s*u)return f.create(g.NA);const{isError:l,errorObject:c,array1Values:h,array2Values:m,noCalculate:d}=at(e,t,r*n,n,u);return l?c:d?f.create(g.DIV_BY_ZERO):this._getResult(h,m)}_getResult(e,t){const r=e.length;if(r<=2)return f.create(g.DIV_BY_ZERO);let n=0,s=0;for(let m=0;m<r;m++)n+=e[m],s+=t[m];const u=n/r,o=s/r;let i=0,l=0,c=0;for(let m=0;m<r;m++)i+=(e[m]-u)*(t[m]-o),l+=(e[m]-u)**2,c+=(t[m]-o)**2;if(c===0)return f.create(g.DIV_BY_ZERO);const h=Math.sqrt((l-i**2/c)/(r-2));return Number.isNaN(h)||!Number.isFinite(h)?f.create(g.NUM):A.create(h)}}class gp extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u,c=+o.getValue(),h=Math.floor(+i.getValue()),m=+l.getValue();if(h<1)return f.create(g.NUM);let d;return m?d=In(c,h):d=Yd(c,h),Number.isNaN(d)||!Number.isFinite(d)?f.create(g.NUM):A.create(d)}}class fp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<0||l<1||l>10**10)return f.create(g.NUM);const c=In(-i,l)*2;return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class dp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(l<1||l>10**10)return f.create(g.NUM);const c=In(-i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class Np extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s,i=+u.getValue(),l=Math.floor(+o.getValue());if(i<=0||i>1||l<1||l>10**10)return f.create(g.NUM);const c=oa(i,l);return Number.isNaN(c)||!Number.isFinite(c)?f.create(g.NUM):A.create(c)}}class _p extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",4)}calculate(e,t,r,n){const{isError:s,errorObject:u}=ia(e,t,r);if(s)return u;const o=Ot(e);if(o instanceof f)return o;const i=this._getKnownXsValues(o,t);if(i instanceof f)return i;const l=this._getNewXsValues(i,r);if(l instanceof f)return l;let c=n??P.create(!0);if(c.isArray()&&(c=c.get(0,0)),c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;const h=+c.getValue();return this._getResult(o,i,l,h)}_getResult(e,t,r,n){return e.length===1&&t.length>1||e[0].length===1&&t[0].length>1?e.length===1&&t.length>1&&(n?t.length+1:t.length)>e[0].length||e[0].length===1&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?f.create(g.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){const s=e.length===1&&e[0].length>1,u=ha(e,t,r,n,!1);if(u instanceof f)return u;const{coefficients:o,newX:i}=u,l=o[0].length,c=o[0][l-1];let h=[];for(let m=0;m<i.length;m++){h[m]=[];let d=c;for(let _=l-2;_>=0;_--)d+=o[0][l-2-_]*i[m][_];h[m].push(d)}return s&&(h=Rt(h)),W.createByArray(h)}_getResultBySimpleVariables(e,t,r,n){const s=e.flat(),u=t.flat(),{slope:o,intercept:i}=ca(u,s,n,!1);if(Number.isNaN(o))return f.create(g.NA);const l=r.map(c=>c.map(h=>o*h+i));return W.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?la(e.length,e[0].length):Ot(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:Ot(t)}}class Cp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=this._getValues(e);if(t.isArray()){const n=t.mapValue(s=>this._handleSingleObject(r,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof f)return e;const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=+u.getValue();if(o<0||o>=1)return f.create(g.NUM);const i=Je(e.length*o/2,0)*2,l=e.slice(i/2,e.length-i/2),c=l.reduce((h,m)=>h+m,0)/l.length;return A.create(c)}_getValues(e){const t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let s=0;s<t;s++)for(let u=0;u<r;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;if(o.isNull()||o.isBoolean())continue;const i=o.getValue();Q(i)&&n.push(+i)}return n.length===0?f.create(g.NUM):n.sort((s,u)=>s-u)}}class Ep extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}}class Ap extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){const t=this.flattenArray(e,!1);return t.isError()?t:t.var()}}const Zc=[[JE,I.AVEDEV],[tA,I.AVERAGE],[rA,I.AVERAGE_WEIGHTED],[nA,I.AVERAGEA],[sA,I.AVERAGEIF],[aA,I.AVERAGEIFS],[uA,I.BETA_DIST],[tc,I.BETA_INV],[rc,I.BINOM_DIST],[oA,I.BINOM_DIST_RANGE],[nc,I.BINOM_INV],[iA,I.CHISQ_DIST],[sc,I.CHISQ_DIST_RT],[lA,I.CHISQ_INV],[ac,I.CHISQ_INV_RT],[uc,I.CHISQ_TEST],[oc,I.CONFIDENCE_NORM],[cA,I.CONFIDENCE_T],[hA,I.CORREL],[mA,I.COUNT],[gA,I.COUNTA],[fA,I.COUNTBLANK],[dA,I.COUNTIF],[NA,I.COUNTIFS],[ic,I.COVARIANCE_P],[CA,I.COVARIANCE_S],[EA,I.DEVSQ],[lc,I.EXPON_DIST],[AA,I.F_DIST],[cc,I.F_DIST_RT],[pA,I.F_INV],[hc,I.F_INV_RT],[mc,I.F_TEST],[yA,I.FISHER],[bA,I.FISHERINV],[ui,I.FORECAST],[ui,I.FORECAST_LINEAR],[RA,I.FREQUENCY],[SA,I.GAMMA],[gc,I.GAMMA_DIST],[fc,I.GAMMA_INV],[oi,I.GAMMALN],[oi,I.GAMMALN_PRECISE],[OA,I.GAUSS],[MA,I.GEOMEAN],[VA,I.GROWTH],[TA,I.HARMEAN],[IA,I.HYPGEOM_DIST],[xA,I.INTERCEPT],[UA,I.KURT],[vA,I.LARGE],[wA,I.LINEST],[DA,I.LOGEST],[LA,I.LOGNORM_DIST],[dc,I.LOGNORM_INV],[PA,I.MARGINOFERROR],[FA,I.MAX],[jA,I.MAXA],[BA,I.MAXIFS],[kA,I.MEDIAN],[$A,I.MIN],[YA,I.MINA],[HA,I.MINIFS],[GA,I.MODE_MULT],[Nc,I.MODE_SNGL],[XA,I.NEGBINOM_DIST],[_c,I.NORM_DIST],[Cc,I.NORM_INV],[qA,I.NORM_S_DIST],[Ec,I.NORM_S_INV],[WA,I.PEARSON],[QA,I.PERCENTILE_EXC],[Ac,I.PERCENTILE_INC],[KA,I.PERCENTRANK_EXC],[pc,I.PERCENTRANK_INC],[ZA,I.PERMUT],[zA,I.PERMUTATIONA],[JA,I.PHI],[yc,I.POISSON_DIST],[ep,I.PROB],[tp,I.QUARTILE_EXC],[bc,I.QUARTILE_INC],[rp,I.RANK_AVG],[np,I.RANK_EQ],[sp,I.RSQ],[ap,I.SKEW],[up,I.SKEW_P],[op,I.SLOPE],[ip,I.SMALL],[lp,I.STANDARDIZE],[Rc,I.STDEV_P],[Sc,I.STDEV_S],[cp,I.STDEVA],[hp,I.STDEVPA],[mp,I.STEYX],[gp,I.T_DIST],[fp,I.T_DIST_2T],[dp,I.T_DIST_RT],[Np,I.T_INV],[Oc,I.T_INV_2T],[Mc,I.T_TEST],[_p,I.TREND],[Cp,I.TRIMMEAN],[Vc,I.VAR_P],[Tc,I.VAR_S],[Ep,I.VARA],[Ap,I.VARPA],[Ic,I.WEIBULL_DIST],[xc,I.Z_TEST]];class pp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){let r=t??A.create(0);if(t!=null&&t.isNull()&&(r=A.create(0)),r.isArray()){const n=r.mapValue(s=>this._handleSingleObject(e,s));return n.getRowCount()===1&&n.getColumnCount()===1?n.get(0,0):n}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){const r=this._checkArray(e);if(r.isError())return r;const{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=+o.getValue(),l=e.isArray()?e.getRowCount():1,c=e.isArray()?e.getColumnCount():1;let h="";for(let m=0;m<l;m++)for(let d=0;d<c;d++){const _=e.isArray()?e.get(m,d):e;let C=`${_.getValue()}`;_.isNull()&&(C=""),_.isBoolean()&&(C=C.toLocaleUpperCase()),_.isString()&&i?h+=`"${C}"`:h+=C,m===l-1&&d===c-1||(i?d===c-1?h+=";":h+=",":h+=", ")}return i&&(h=`{${h}}`),h.length>32767?f.create(g.CALC):w.create(h)}_checkArray(e){if(e.isArray()){const t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}}class yp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const t=e.getValue().toLocaleString();let r="";for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);s===12288?s=32:s>=65281&&s<=65374&&(s-=65248),r+=String.fromCharCode(s)}return w.create(r)}}class bp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=+s.getValue(),o=Math.abs(Number.parseInt(u.toString(),10)),i=Number.parseFloat((Math.abs(u)-o).toFixed(2));let l="";return o===0?i!==0?l=`${u<0?"ลบ":""}${this._convertNumberToThaiText(i*100)}สตางค์`:l="ศูนย์บาทถ้วน":i===0?l=`${u<0?"ลบ":""}${this._convertNumberToThaiText(o)}บาทถ้วน`:l=`${u<0?"ลบ":""}${this._convertNumberToThaiText(o)}บาท${this._convertNumberToThaiText(i*100)}สตางค์`,w.create(l)}_convertNumberToThaiText(e){const t=["ล้าน","สิบ","ร้อย","พัน","หมื่น","แสน",""],r=["ศูนย์","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],n=["ลบ","บาท","ถ้วน","สตางค์","ยี่","เอ็ด",","," ","฿"],s=e.toString(),u=s.length;let o="";for(let i=u;i>0;i--){const l=Number.parseInt(s.charAt(u-i),10);let c=r[l];const h=i>1?(i-1)%6:6;if(h===1&&l===2&&(c=n[4]),l===1)switch(h){case 0:case 6:o+=i<u?n[5]:c;break;case 1:break;default:o+=c;break}else if(l===0){h===0&&(o+=t[h]);continue}else o+=c;o+=t[h]}return o}}const Rp=Object.values(Be).filter(a=>[Be.TABLE_START,Be.TABLE_ROW_START,Be.TABLE_CELL_START,Be.TABLE_CELL_END,Be.TABLE_ROW_END,Be.TABLE_END,Be.CUSTOM_BLOCK].includes(a));class Sp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=Math.floor(+s.getValue());if(u<=0)return f.create(g.VALUE);let o=String.fromCharCode(u);return Rp.some(i=>i===o)&&(o=""),w.create(o)}}class Op extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return w.create("");const t=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return w.create(t)}}class Mp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),t==="")return f.create(g.VALUE);const r=t.charCodeAt(0);return A.create(r)}}class Vp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t="",r=null;for(const n of e)if(n.isArray()){if(n.iterator(s=>{if(s==null||s.isNull())return!0;if(s.isError())return r=s,!1;s.isBoolean()?t+=`${s.getValue()}`.toLocaleUpperCase():(s.isString()||s.isNumber())&&(t+=s.getValue())}),r)return r}else!n.isError()&&!n.isNull()&&(t+=n.getValue());return w.create(t)}}class Tp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(s=>{if(s.isArray()){const u=s;t=Math.max(t,u.getRowCount()),r=Math.max(r,u.getColumnCount())}else t=Math.max(t,1),r=Math.max(r,1)});let n=null;for(const s of e)n=S(t,r,s,f.create(g.NA)).mapValue((u,o,i)=>{const l=n&&n.get(o,i);if(l!=null&&l.isError())return l;if(u.isError())return u;let c=l?.getValue(),h=u?.getValue();l!=null&&l.isBoolean()&&(c=`${c}`.toLocaleUpperCase()),u!=null&&u.isBoolean()&&(h=`${h}`.toLocaleUpperCase());const m=l!=null&&l.isNull()?"":c??"",d=u!=null&&u.isNull()?"":h??"";return w.create(`${m}${d}`)});return n||f.create(g.VALUE)}}class Ip extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return w.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s>=33&&s<=126?r+=String.fromCharCode(s+65248):s===32?r+="　":r+=t.charAt(n)}return w.create(r)}}class xp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2),N(this,"needsLocale",!0)}calculate(e,t){let r=t??A.create(2);r.isNull()&&(r=A.create(2));const n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(e,t);if(r)return n;const[u,o]=s;let i=+u.getValue(),l=Math.trunc(+o.getValue());if(l>127)return f.create(g.VALUE);l<0&&(`${i}`.length<Math.abs(l)?i=0:i=i<0?-qt(Math.abs(i),l):qt(i,l),l=0);const c=_g(this.getLocale(),i,l);return w.create(c)}}class Up extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,ce.create()),u=S(r,n,t,ce.create()),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){const u=e.isNull()&&t.isNull();return P.create(u)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());const s=r===n;return P.create(s)}}const lo=(a,e)=>yr.format(a,e,{throws:!1}),Ue=a=>{let e=`${a.getValue()}`;return a.isNull()&&(e=""),a.isBoolean()&&(e=e.toLocaleUpperCase()),a.isNumber()&&(a.getPattern()!==""?e=lo(a.getPattern(),+a.getValue()):e=`${Js(+a.getValue())}`),e};class vp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.mapValue((h,m,d)=>{const _=i.get(m,d),C=l.get(m,d);return h.isError()?h:_.isError()?_:C.isError()?C:this._handleSingleObject(h,_,C)});return s===1&&u===1?c.get(0,0):c}_handleSingleObject(e,t,r){const n=Ue(e),s=Ue(t),{isError:u,errorObject:o,variants:i}=F(r);if(u)return o;const[l]=i,c=Math.floor(+l.getValue());if(t.isNull()||c<=0||c>s.length)return f.create(g.VALUE);if(e.isNull()||n.length===0)return A.create(c);const h=s.indexOf(n,c-1);return h===-1?f.create(g.VALUE):A.create(h+1)}}function co(a){let e=0;for(let t=0;t<a.length;t++)e+=Un(a,t);return e}function Un(a,e,t="ltr"){return wp(a,e,t)>255?2:1}function ii(a){return a>=55296&&a<=56319}function li(a){return a>=56320&&a<=57343}function ci(a,e){const t=(a&1023)<<10,r=e&1023;return t+r+65536}function wp(a,e,t="ltr"){const r=a.charCodeAt(e);if(t==="ltr"&&ii(r)&&e+1<a.length){const n=a.charCodeAt(e+1);if(li(n))return ci(r,n)}if(t==="rtl"&&li(r)&&e-1>=0){const n=a.charCodeAt(e-1);if(ii(n))return ci(n,r)}return r}class Dp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.mapValue((h,m,d)=>{const _=i.get(m,d),C=l.get(m,d);return h.isError()?h:_.isError()?_:C.isError()?C:this._handleSingleObject(h,_,C)});return s===1&&u===1?c.get(0,0):c}_handleSingleObject(e,t,r){const n=Ue(e),s=Ue(t),{isError:u,errorObject:o,variants:i}=F(r);if(u)return o;const[l]=i,c=Math.floor(+l.getValue());if(t.isNull()||c<=0||c>s.length)return f.create(g.VALUE);if(e.isNull()||n.length===0)return A.create(c);const h=s.indexOf(n,c-1);if(h===-1)return f.create(g.VALUE);const m=co(s.substring(0,h))+1;return A.create(m)}}class Lp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}calculate(e,t,r){let n=t??A.create(2);n.isNull()&&(n=A.create(2));let s=r??P.create(!1);s.isNull()&&(s=P.create(!1));const u=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),i=S(u,o,e,f.create(g.NA)),l=S(u,o,n,f.create(g.NA)),c=S(u,o,s,f.create(g.NA)),h=i.mapValue((m,d,_)=>{const C=l.get(d,_),E=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:this._handleSingleObject(m,C,E)});return u===1&&o===1?h.get(0,0):h}_handleSingleObject(e,t,r){const{isError:n,errorObject:s,variants:u}=F(e,t,r);if(n)return s;const[o,i,l]=u;let c=+o.getValue(),h=Math.trunc(+i.getValue());const m=+l.getValue();if(h>127)return f.create(g.VALUE);h<0&&(`${c}`.length<Math.abs(h)?c=0:c=c<0?-qt(Math.abs(c),h):qt(c,h),h=0);let d=m?"###0":"#,##0";h>0&&(d+=`.${"0".repeat(h)}`);const _=lo(d,c);return w.create(_)}}class Pp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const r=Ue(e),{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=Math.floor(+o.getValue());if(i<0)return f.create(g.VALUE);if(e.isNull()||i===0)return w.create("");if(i>=r.length)return w.create(r);const l=r.substring(0,i);return w.create(l)}}class Fp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,ce.create()),o=S(n,s,r,ce.create()),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const r=Ue(e),{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=Math.floor(+o.getValue());if(i<0)return f.create(g.VALUE);if(e.isNull()||i===0)return w.create("");let l=0,c=0,h="";for(;c<i&&l<r.length;)c+=Un(r,l),h+=r.charAt(l),l++;return w.create(h)}}class jp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Ue(e);return A.create(t.length)}}class Bp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleText(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;const t=Ue(e),r=co(t);return A.create(r)}}class kp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return w.create("");const t=`${e.getValue()}`.toLocaleLowerCase();return w.create(t)}}class $p extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){const n=Ue(e),{isError:s,errorObject:u,variants:o}=F(t,r);if(s)return u;const[i,l]=o,c=Math.floor(+i.getValue()),h=Math.floor(+l.getValue());if(c<=0||h<0)return f.create(g.VALUE);if(e.isNull()||c>n.length||h===0)return w.create("");const m=n.substring(c-1,c-1+h);return w.create(m)}}class Yp extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,t,f.create(g.NA)),i=S(n,s,r,f.create(g.NA)),l=u.mapValue((c,h,m)=>{const d=o.get(h,m),_=i.get(h,m);return c.isError()?c:d.isError()?d:_.isError()?_:this._handleSingleObject(c,d,_)});return n===1&&s===1?l.get(0,0):l}_handleSingleObject(e,t,r){let n=Ue(e);const{isError:s,errorObject:u,variants:o}=F(t,r);if(s)return u;const[i,l]=o,c=Math.floor(+i.getValue()),h=Math.floor(+l.getValue());if(c<=0||h<0)return f.create(g.VALUE);if(e.isNull()||c>n.length||h===0)return w.create("");n=n.substring(c-1);let m=0,d=0,_="";for(;d<h&&m<n.length;)d+=Un(n,m),_+=n.charAt(m),m++;return w.create(_)}}const Qr=["〇","一","二","三","四","五","六","七","八","九"],Bn=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],Hp=["","十","百","千"],Gp=["","拾","佰","仟"],Xp=["","万","亿","兆"];class qp extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.mapValue((i,l,c)=>{const h=u.get(l,c);return i.isError()?i:h.isError()?h:this._handleSingleObject(i,h)});return r===1&&n===1?o.get(0,0):o}_handleSingleObject(e,t){const r=e.convertToNumberObjectValue();if(r.isError())return r;const n=t.convertToNumberObjectValue();if(n.isError())return n;let s=r.getValue();const u=Math.trunc(n.getValue());if(s<0||![1,2,3].includes(u))return f.create(g.NUM);s=Math.round(s);const o=s.toString(),i=o.length;let l="",c=!1;for(let h=0;h<i;h++){const m=Number(o[h]);if(i===1&&m===0){l+=u===2?Bn[0]:Qr[0];break}if(u===3){l+=Qr[m];continue}const d=i-h-1,_=d%4,C=Math.trunc(d/4);if(i>=17&&C>2){if(l+=u===1?Qr[m]:Bn[m],C>3)continue}else m===0?c=_!==0:(c&&(l+=u===1?Qr[0]:Bn[0],c=!1),l+=u===1?Qr[m]+Hp[_]:Bn[m]+Gp[_]);_===0&&C>0&&o.slice(Math.max(0,h-3),h+1)!=="0000"&&(l+=Xp[C])}return w.create(l)}}class Wp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",3)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t,r){const n=t??w.create("."),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,r!=null&&r.isArray()?r.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,r!=null&&r.isArray()?r.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,n,f.create(g.NA)),l=r?S(s,u,r,f.create(g.NA)):void 0,c=o.mapValue((h,m,d)=>{const _=i.get(m,d),C=r?l.get(m,d):void 0;return h.isError()?h:_.isError()?_:C!=null&&C.isError()?C:_.isNull()||C!=null&&C.isNull()?f.create(g.VALUE):h.isNull()?A.create(0):this._handleSingleObject(h,_,C)});return s===1&&u===1?c.get(0,0):c}_handleSingleObject(e,t,r){let n=`${e.getValue()}`;n=n.replace(/\s+/g,"");let s=`${t.getValue()}`;t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0);let u;if(r&&(u=`${r.getValue()}`,r.isBoolean()&&(u=u.toLocaleUpperCase()),u=u.charAt(0),s===u))return f.create(g.VALUE);if(n.trim()==="")return A.create(0);if(!n.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return f.create(g.VALUE);const o=n.split(s);if(o.length>2)return f.create(g.VALUE);let i=o[0].replace(/,/g,"");r&&(i=i.split(u).join(""));let l=0;if(o.length===1){s===","&&(i=i.replace(/\./g,""));let c=0;for(;i.endsWith("%");)i=i.slice(0,-1),c++;c>0?l=+i/100**c:l=+i}else{if(!Q(i))return f.create(g.VALUE);let c=o[1],h=0;for(;c.endsWith("%");)c=c.slice(0,-1),h++;const m=`${i}.${c}`;if(!Q(m))return f.create(g.VALUE);h>0?l=+m/100**h:l=+m}return Number.isNaN(l)?f.create(g.VALUE):A.create(l)}}class Qp extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;const t=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,r=>r.toLocaleUpperCase());return w.create(t)}}const zc=()=>[{type:4,from:48,to:57}],Jc=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],eh=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],th=()=>({type:3,set:Jc(),not:!1}),rh=()=>({type:3,set:Jc(),not:!0}),nh=()=>({type:3,set:zc(),not:!1}),sh=()=>({type:3,set:zc(),not:!0}),ah=()=>({type:3,set:eh(),not:!1}),uh=()=>({type:3,set:eh(),not:!0}),Kp=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function Zp(a){const e={type:0,stack:[]};let t=e,r=e.stack;const n=[],s=[];let u=0;const o=h=>{throw new SyntaxError(`Invalid regular expression: /${a}/: Nothing to repeat at column ${h-1}`)},i=Jp(a);let l=0,c;for(;l<i.length;)switch(c=i[l++],c){case"\\":if(l===i.length)throw new SyntaxError(`Invalid regular expression: /${a}/: \\ at end of pattern`);switch(c=i[l++],c){case"b":r.push({type:2,value:"b"});break;case"B":r.push({type:2,value:"B"});break;case"w":r.push(th());break;case"W":r.push(rh());break;case"d":r.push(nh());break;case"D":r.push(sh());break;case"s":r.push(ah());break;case"S":r.push(uh());break;default:if(/\d/.test(c)){for(;/\d/.test(i[l])&&l<i.length;)c+=i[l++];const h=Number.parseInt(c,10);r.push({type:6,value:h}),s.push({reference:{type:6,value:h},stack:r,index:r.length-1})}else r.push({type:7,value:c.charCodeAt(0)})}break;case"^":r.push({type:2,value:"^"});break;case"$":r.push({type:2,value:"$"});break;case"[":{const h=i[l]==="^";h&&l++;const m=zp(i.slice(l),a);l+=m[1],r.push({type:3,set:m[0],not:h});break}case".":r.push(Kp());break;case"(":{const h={type:1,stack:[],remember:!0};if(i[l]==="?"){const m=i[l+1];if(l+=2,m==="=")h.followedBy=!0;else if(m==="!")h.notFollowedBy=!0;else if(m!==":")throw new SyntaxError(`Invalid regular expression: /${a}/: Invalid group, character '${m}' after '?' at column ${l-1}`);h.remember=!1}else u+=1;r.push(h),n.push(t),t=h,r=h.stack;break}case")":if(n.length===0)throw new SyntaxError(`Invalid regular expression: /${a}/: Unmatched ) at column ${l-1}`);t=n.pop(),r=t.options?t.options[t.options.length-1]:t.stack;break;case"|":{t.options||(t.options=[t.stack],delete t.stack);const h=[];t.options.push(h),r=h;break}case"{":{const h=/^(\d+)(,(\d+)?)?\}/.exec(i.slice(l));if(h){r.length===0&&o(l);const m=Number.parseInt(h[1],10),d=h[2]?h[3]?Number.parseInt(h[3],10):1/0:m;l+=h[0].length,r.push({type:5,min:m,max:d,value:r.pop()})}else r.push({type:7,value:123});break}case"?":r.length===0&&o(l),r.push({type:5,min:0,max:1,value:r.pop()});break;case"+":r.length===0&&o(l),r.push({type:5,min:1,max:1/0,value:r.pop()});break;case"*":r.length===0&&o(l),r.push({type:5,min:0,max:1/0,value:r.pop()});break;default:r.push({type:7,value:c.charCodeAt(0)})}if(n.length>0)throw new SyntaxError(`Invalid regular expression: /${a}/: Unterminated group`);return ey(s,u),e}function zp(a,e){let t;const r=[],n=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;(t=n.exec(a))!==null;){let s=null;const[,u,o,i,l,c,h,m,d,_,C]=t;if(u||o||i||l||c||h?s=(()=>{let E={type:3,set:[],not:!1};return u?E=th():o?E=nh():i?E=ah():l?E=rh():c?E=sh():h&&(E=uh()),E})():m&&C?s={type:4,from:(d||_).charCodeAt(0),to:C.charCodeAt(C.length-1)}:t[16]&&(s={type:7,value:t[16].charCodeAt(0)}),!s)return[r,n.lastIndex];r.push(s)}throw new SyntaxError(`Invalid regular expression: /${e}/: Unterminated character class`)}function Jp(a){return a.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(e,t,r,n,s,u,o)=>{if(r)return e;let i;t?i=8:n?i=Number.parseInt(n,16):s?i=Number.parseInt(s,16):u?i="@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(u):i={0:0,t:9,n:10,v:11,f:12,r:13}[o];const l=String.fromCharCode(i);return/[[\]{}^$.|?*+()]/.test(l)?`\\${l}`:l})}function ey(a,e){for(const t of a.reverse()){const r=t.reference.value;if(e<r){t.reference.type=7;const n=r.toString();if(t.reference.value=Number.parseInt(n,8),!/^[0-7]+$/.test(n)){let s=0;for(;n[s]!=="8"&&n[s]!=="9"&&s<n.length;)s+=1;if(s===0?(t.reference.value=n.charCodeAt(0),s+=1):t.reference.value=Number.parseInt(n.slice(0,s),8),n.length>s){const u=t.stack.splice(t.index+1);for(const o of n.slice(s))t.stack.push({type:7,value:o.charCodeAt(0)});t.stack.push(...u)}}}}}function ho(a,e){if(!ty(a))return{isError:!0,regExp:null};try{const t=new RegExp(a,e?"ug":"u");return ry(t)?{isError:!1,regExp:t}:{isError:!0,regExp:null}}catch{return{isError:!0,regExp:null}}}function ty(a){return!(/\(\?<=.*?\)/g.test(a)&&!/\[.*?(\?<=.*?)\]/g.test(a)||/\(\?<!.*?\)/g.test(a)&&!/\[.*?(\?<!.*?)\]/g.test(a))}function ry(a,e){let t;Object.prototype.toString.call(a)==="[object RegExp]"?t=a.source:a&&typeof a!="string"&&(t=`${a}`);let r;try{r=Zp(t)}catch{return!1}let n=0;const s=(u,o)=>{let i=o;if(u.type===5){if(o>0&&(u.min===0||u.max===1/0)||ny(u)&&(n++,n>25))return!1;i=o+1}if(u.options){for(const c of u.options)if(!s({stack:c},i))return!1}const l=u.stack||u.value&&u.value.stack;if(!l)return!0;for(const c of l)if(!s(c,i))return!1;return!0};return s(r,0)}function ny(a){const e=a.stack||a.value&&a.value.stack;return e?oh(e):!1}function oh(a){for(const e of a){if(e.options&&e.options.length>0)return!0;const t=e.stack||e.value&&e.value.stack;if(t&&oh(t))return!0}return!1}class sy extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Vn(e,t);if(r)return n;const[u,o]=s;let i=u.getValue();u.isNull()&&(i=""),u.isBoolean()&&(i=i?"TRUE":"FALSE"),i=`${i}`;let l=o.getValue();o.isNull()&&(l=""),o.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:c,regExp:h}=ho(l,!1);if(c)return f.create(g.REF);const m=i.match(h);if(m===null)return f.create(g.NA);if(m.length>1){const d=m.slice(1).map(_=>w.create(_));return d.length>1?W.create({calculateValueList:[d],rowCount:1,columnCount:d.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):d[0]}return w.create(m[0])}}class ay extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){const{isError:r,errorObject:n,variants:s}=Vn(e,t);if(r)return n;const[u,o]=s;let i=u.getValue();u.isNull()&&(i=""),u.isBoolean()&&(i=i?"TRUE":"FALSE"),i=`${i}`;let l=o.getValue();o.isNull()&&(l=""),o.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;const{isError:c,regExp:h}=ho(l,!1);return c?f.create(g.REF):i.match(h)===null?P.create(!1):P.create(!0)}}class uy extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",3)}calculate(e,t,r){const{isError:n,errorObject:s,variants:u}=Vn(e,t,r);if(n)return s;const[o,i,l]=u;let c=o.getValue();o.isNull()&&(c=""),o.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let h=i.getValue();i.isNull()&&(h=""),i.isBoolean()&&(h=h?"TRUE":"FALSE"),h=`${h}`;let m=l.getValue();l.isNull()&&(m=""),l.isBoolean()&&(m=m?"TRUE":"FALSE"),m=`${m}`;const{isError:d,regExp:_}=ho(h,!0);if(d)return f.create(g.REF);const C=c.replace(_,m);return w.create(C)}}class oy extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(t,r);if(s)return u;const[i,l]=o,c=Math.floor(+i.getValue()),h=Math.floor(+l.getValue());if(c<=0||h<0)return f.create(g.VALUE);const m=Ue(e),d=Ue(n),_=m.substring(0,c-1)+d+m.substring(c-1+h);return w.create(_)}}class iy extends R{constructor(){super(...arguments),N(this,"minParams",4),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=S(s,u,n,f.create(g.NA)),h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_),p=c.get(d,_);return m.isError()?m:C.isError()?C:E.isError()?E:p.isError()?p:this._handleSingleObject(m,C,E,p)});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const{isError:s,errorObject:u,variants:o}=F(t,r);if(s)return u;const[i,l]=o,c=Math.floor(+i.getValue()),h=Math.floor(+l.getValue());if(c<=0||h<0)return f.create(g.VALUE);let m=Ue(e);const d=Ue(n);let _=m.substring(0,c-1);m=m.substring(c-1);let C=0,E=0;for(;E<h&&C<m.length;)E+=Un(m,C),C++;return _+=d+m.substring(C),w.create(_)}}class ly extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e,f.create(g.NA)),u=S(r,n,t,f.create(g.NA)),o=s.map((i,l,c)=>{let h=u.get(l,c);if(i.isError())return i;let m=i.getValue();if(i.isNull()&&(m=""),i.isBoolean()&&(m=m?"TRUE":"FALSE"),m+="",h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;const d=32767,_=Math.floor(+h.getValue());if(_<0||_>d/m.length)return f.create(g.VALUE);const C=m.repeat(_);return w.create(C)});return r===1&&n===1?o.get(0,0):o}}class cy extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const r=Ue(e),{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=Math.floor(+o.getValue());if(i<0)return f.create(g.VALUE);if(e.isNull()||i===0)return w.create("");if(i>=r.length)return w.create(r);const l=r.substring(r.length-i);return w.create(l)}}class hy extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const r=Ue(e),{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;const[o]=u,i=Math.floor(+o.getValue());if(i<0)return f.create(g.VALUE);if(e.isNull()||i===0)return w.create("");let l=r.length-1,c=0,h="";for(;c<i&&l>=0;)c+=Un(r,l,"rtl"),h=r.charAt(l)+h,l--;return w.create(h)}}class my extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.mapValue((h,m,d)=>{const _=i.get(m,d),C=l.get(m,d);return h.isError()?h:_.isError()?_:C.isError()?C:this._handleSingleObject(h,_,C)});return s===1&&u===1?c.get(0,0):c}_handleSingleObject(e,t,r){const n=Ue(e).toLocaleUpperCase(),s=Ue(t).toLocaleUpperCase(),{isError:u,errorObject:o,variants:i}=F(r);if(u)return o;const[l]=i,c=Math.floor(+l.getValue());if(t.isNull()||c<=0||c>s.length)return f.create(g.VALUE);if(e.isNull()||n.length===0)return A.create(c);const h=s.indexOf(n,c-1);return h===-1?f.create(g.VALUE):A.create(h+1)}}class gy extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",3)}calculate(e,t,r){const n=r??A.create(1),s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,n,f.create(g.NA)),c=o.mapValue((h,m,d)=>{const _=i.get(m,d),C=l.get(m,d);return h.isError()?h:_.isError()?_:C.isError()?C:this._handleSingleObject(h,_,C)});return s===1&&u===1?c.get(0,0):c}_handleSingleObject(e,t,r){const n=Ue(e).toLocaleUpperCase(),s=Ue(t).toLocaleUpperCase(),{isError:u,errorObject:o,variants:i}=F(r);if(u)return o;const[l]=i,c=Math.floor(+l.getValue());if(t.isNull()||c<=0||c>s.length)return f.create(g.VALUE);if(e.isNull()||n.length===0)return A.create(c);const h=s.indexOf(n,c-1);if(h===-1)return f.create(g.VALUE);const m=co(s.substring(0,h))+1;return A.create(m)}}class fy extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",4)}calculate(e,t,r,n){const s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n!=null&&n.isArray()?n.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n!=null&&n.isArray()?n.getColumnCount():1),o=S(s,u,e,f.create(g.NA)),i=S(s,u,t,f.create(g.NA)),l=S(s,u,r,f.create(g.NA)),c=n?S(s,u,n,f.create(g.NA)):void 0,h=o.mapValue((m,d,_)=>{const C=i.get(d,_),E=l.get(d,_);let p=n?c.get(d,_):void 0;return m.isError()?m:C.isError()?C:E.isError()?E:p!=null&&p.isError()?p:p!=null&&p.isNull()||p!=null&&p.isBoolean()?f.create(g.VALUE):(p!=null&&p.isString()&&(p=p.convertToNumberObjectValue()),p!=null&&p.isError()?p:this._handleSingleObject(m,C,E,p))});return s===1&&u===1?h.get(0,0):h}_handleSingleObject(e,t,r,n){const s=this._getObjectString(e),u=this._getObjectString(t),o=this._getObjectString(r),i=n?Math.floor(+n.getValue()):void 0;if(n&&i<=0)return f.create(g.VALUE);if(u==="")return w.create(s);let l="",c=0;for(let h=0;h<s.length;h++){const m=s.substr(h,u.length);if(m===u||m.length===u.length&&m.trim()===u.trim()){if(c++,c===i){l=s.substr(0,h)+o+s.substr(h+u.length);break}i===void 0&&(l+=o),h+=u.length-1}else i===void 0&&(l+=s[h])}return i&&c<i&&(l=s),w.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}}class dy extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1),N(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(r=>this._handleSingleObject(r)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?w.create(""):e}}class Ny extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",2)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t){if(e.isError())return e;if(t.isError())return t;const r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),s=S(r,n,e),u=S(r,n,t),o=s.map((i,l,c)=>{if(i.isError())return i;let h=u.get(l,c)||w.create(" ");if(h.isError())return h;if(h.isBoolean())return f.create(g.VALUE);if(i.isBoolean())return i;let m=i.getValue();if(i.isNull()&&(m=0),i.isString())if(Q(m))m=Number(m);else{const C=js(`${m}`);C&&C.v!=null&&typeof C.v=="number"&&(m=C.v)}h.isNull()&&(h=w.create(" "));const d=`${h.getValue()}`,_=lo(d,m);return w.create(d===" "?_.trimEnd():_)});return o.getRowCount()===1&&o.getColumnCount()===1?o.get(0,0):o}}class _y extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=!1,i=r??A.create(1);i.isNull()&&(o=!0,i=A.create(1));const l=!n,c=n??A.create(0),h=s??A.create(0),m=u??f.create(g.NA),d=Math.max(e.isArray()?e.getRowCount():1,i.isArray()?i.getRowCount():1,c.isArray()?c.getRowCount():1,h.isArray()?h.getRowCount():1,m.isArray()?m.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,i.isArray()?i.getColumnCount():1,c.isArray()?c.getColumnCount():1,h.isArray()?h.getColumnCount():1,m.isArray()?m.getColumnCount():1),C=S(d,_,e,f.create(g.NA)),E=S(d,_,i,f.create(g.NA)),p=S(d,_,c,f.create(g.NA)),y=S(d,_,h,f.create(g.NA)),b=S(d,_,m,f.create(g.NA)),O=this._getResultArray(C,t,E,p,y,b,o,l);return d===1&&_===1?O.get(0,0):O}_getResultArray(e,t,r,n,s,u,o,i){return e.map((l,c,h)=>{const m=r.get(c,h),d=n.get(c,h),_=s.get(c,h),C=u.get(c,h),E=this._checkVariantsError(l,m,d,_);if(E.isError())return E;const p=this._getStringValue(l),y=this._getDelimiterValue(t);if(y instanceof f)return y;const b=this._getVariantsNumberFloorValue(m,d,_);if(b instanceof f)return b;const[O,M,V]=b;return O===0||M<0||M>1||V<0||V>1?f.create(g.VALUE):y.includes("")?O>0?w.create(p):w.create(""):!o&&Math.abs(O)>p.length?f.create(g.VALUE):y.every(T=>T.length>p.length)?f.create(g.NA):this._getResult(p,y,O,M,V,C,i)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return P.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);if(e.iterator(s=>{const u=s;if(u.isError())return r=!0,n=u,!1;t.push(this._getStringValue(u))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,u,o){let i=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let c=0,h=0,m=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const C=l.map(E=>({index:i.lastIndexOf(E),length:E.length})).filter(E=>E.index!==-1).sort((E,p)=>p.index-E.index)[0];if(!C)break;c=C.index,i=i.substr(0,C.index),m=C.length,h++}else{const C=l.map(E=>({index:i.indexOf(E),length:E.length})).filter(E=>E.index!==-1).sort((E,p)=>E.index-p.index)[0];if(!C)break;c+=C.index+m,i=i.substr(C.index+C.length),m=C.length,h++}if(h&&h<Math.abs(r)&&o)return f.create(g.NA);if(!h||h<Math.abs(r))return s?r>0?w.create(""):w.create(e):u;const d=e.substr(c+m);return w.create(d)}}class Cy extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=!1,i=r??A.create(1);i.isNull()&&(o=!0,i=A.create(1));const l=!n,c=n??A.create(0),h=s??A.create(0),m=u??f.create(g.NA),d=Math.max(e.isArray()?e.getRowCount():1,i.isArray()?i.getRowCount():1,c.isArray()?c.getRowCount():1,h.isArray()?h.getRowCount():1,m.isArray()?m.getRowCount():1),_=Math.max(e.isArray()?e.getColumnCount():1,i.isArray()?i.getColumnCount():1,c.isArray()?c.getColumnCount():1,h.isArray()?h.getColumnCount():1,m.isArray()?m.getColumnCount():1),C=S(d,_,e,f.create(g.NA)),E=S(d,_,i,f.create(g.NA)),p=S(d,_,c,f.create(g.NA)),y=S(d,_,h,f.create(g.NA)),b=S(d,_,m,f.create(g.NA)),O=this._getResultArray(C,t,E,p,y,b,o,l);return d===1&&_===1?O.get(0,0):O}_getResultArray(e,t,r,n,s,u,o,i){return e.map((l,c,h)=>{const m=r.get(c,h),d=n.get(c,h),_=s.get(c,h),C=u.get(c,h),E=this._checkVariantsError(l,m,d,_);if(E.isError())return E;const p=this._getStringValue(l),y=this._getDelimiterValue(t);if(y instanceof f)return y;const b=this._getVariantsNumberFloorValue(m,d,_);if(b instanceof f)return b;const[O,M,V]=b;return O===0||M<0||M>1||V<0||V>1?f.create(g.VALUE):y.includes("")?O>0?w.create(""):w.create(p):!o&&Math.abs(O)>p.length?f.create(g.VALUE):y.every(T=>T.length>p.length)?f.create(g.NA):this._getResult(p,y,O,M,V,C,i)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return P.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){const t=[];if(e.isArray()){let r=!1,n=f.create(g.VALUE);if(e.iterator(s=>{const u=s;if(u.isError())return r=!0,n=u,!1;t.push(this._getStringValue(u))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){const t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;const s=Math.floor(+n.getValue());t.push(s)}return t}_getResult(e,t,r,n,s,u,o){let i=n?e.toLocaleLowerCase():e;const l=n?t.map(_=>_.toLocaleLowerCase()):t;let c=0,h=0,m=0;for(let _=0;_<Math.abs(r);_++)if(r<0){const C=l.map(E=>({index:i.lastIndexOf(E),length:E.length})).filter(E=>E.index!==-1).sort((E,p)=>p.index-E.index)[0];if(!C)break;c=C.index,i=i.substr(0,C.index),h++}else{const C=l.map(E=>({index:i.indexOf(E),length:E.length})).filter(E=>E.index!==-1).sort((E,p)=>E.index-p.index)[0];if(!C)break;c+=C.index+m,i=i.substr(C.index+C.length),m=C.length,h++}if(h&&h<Math.abs(r)&&o)return f.create(g.NA);if(!h||h<Math.abs(r))return s?r>0?w.create(e):w.create(""):u;const d=e.substr(0,c);return w.create(d)}}class Ey extends R{constructor(){super(...arguments),N(this,"minParams",3),N(this,"maxParams",255)}calculate(e,t,...r){const n=this._getDelimiterValues(e),s=this._getTextValues(r);if(t.isArray()){const o=t.mapValue(i=>this._handleSingleObject(n,i,s));return o.getRowCount()===1&&o.getColumnCount()===1?o.get(0,0):o}const u=t;if(u.isString()){const o=`${u.getValue()}`.toLocaleUpperCase();if(o==="TRUE")return this._handleSingleObject(n,P.create(!0),s);if(o==="FALSE")return this._handleSingleObject(n,P.create(!1),s)}return this._handleSingleObject(n,t,s)}_handleSingleObject(e,t,r){if(e instanceof f)return e;const{isError:n,errorObject:s,variants:u}=F(t);if(n)return s;if(r instanceof f)return r;const[o]=u,i=+o.getValue();let l=r;i&&(l=r.filter(h=>h!==null&&h!==""));let c="";for(let h=0;h<l.length;h++)l[h]!==null&&(c+=l[h]),h<l.length-1&&(c+=e[h%e.length]);return w.create(c)}_getDelimiterValues(e){const t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let s=0;s<r;s++)for(let u=0;u<n;u++){const o=e.isArray()?e.get(s,u):e;if(o.isError())return o;let i=`${o.getValue()}`;o.isNull()&&(i=""),o.isBoolean()&&(i=i.toLocaleUpperCase()),t.push(i)}return t}_getTextValues(e){const t=[];for(const r of e){const n=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;for(let u=0;u<n;u++)for(let o=0;o<s;o++){const i=r.isArray()?r.get(u,o):r;if(i.isError())return i;if(i.isNull()){t.push(null);continue}let l=`${i.getValue()}`;i.isBoolean()&&(l=l.toLocaleUpperCase()),t.push(l)}}return t}}class Ay extends R{constructor(){super(...arguments),N(this,"minParams",2),N(this,"maxParams",6)}calculate(e,t,r,n,s,u){let o=r??w.create("\\s");const i=n??A.create(0),l=s??A.create(0),c=u??w.create(g.NA),{_variant:h,values:m}=this._getStringValues(t),{_variant:d,values:_}=this._getStringValues(o,!1);o=d;const C=Math.max(e.isArray()?e.getRowCount():1,i.isArray()?i.getRowCount():1,l.isArray()?l.getRowCount():1),E=Math.max(e.isArray()?e.getColumnCount():1,i.isArray()?i.getColumnCount():1,l.isArray()?l.getColumnCount():1),p=S(C,E,e,f.create(g.NA)),y=S(C,E,i,f.create(g.NA)),b=S(C,E,l,f.create(g.NA)),O=this._getResultArray(p,h,o,y,b,c,m,_);return C===1&&E===1?O.get(0,0):O.map(M=>M.get(0,0))}_getStringValues(e,t=!0){let r=e;const n=[];if(r.isArray())r.iterator(s=>{if(s!=null&&s.isError())return r=s,!1;if(s!=null&&s.isNull()&&t)return r=f.create(g.VALUE),!1;const u=this._getRegExpStringValue(s);if(u==="")return r=f.create(g.VALUE),!1;n.push(u)});else{r.isNull()&&t&&(r=f.create(g.VALUE));const s=this._getRegExpStringValue(r);s===""&&(r=f.create(g.VALUE)),n.push(s)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,s,u,o,i){return e.map((l,c,h)=>{let m=n.get(c,h),d=s.get(c,h);const _=this._checkVariantsError(l,t,r,m,d);if(_.isError())return _;if(l.isNull())return f.create(g.VALUE);let C=u;if(C.isArray()){const O=C.getRowCount(),M=C.getColumnCount();if(O>1||M>1)return f.create(g.VALUE);C=C.get(0,0)}let E=`${l.getValue()}`;if(l.isBoolean()&&(E=E.toLocaleUpperCase()),m.isString()&&(m=m.convertToNumberObjectValue(),m.isError()))return m;const p=Math.floor(+m.getValue());if(d.isString()&&(d=d.convertToNumberObjectValue(),d.isError()))return d;const y=Math.floor(+d.getValue());if(y<0||y>1)return f.create(g.VALUE);let b=`${C.getValue()}`;return C.isBoolean()&&(b=b.toLocaleUpperCase()),this._getResult(E,o,i,p,y,b)})}_getResult(e,t,r,n,s,u){const o=new RegExp(r.join("|"),`g${s?"i":""}`),i=new RegExp(t.join("|"),`g${s?"i":""}`),l=e.split(o);let c=1,h=l.map(m=>{let d=m.split(i);return n&&(d=d.filter(_=>_!=="")),c=Math.max(c,d.length),d});return h=h.map(m=>{let d=m;return d.length<c&&(d=d.concat(new Array(c-d.length).fill(u))),d}),W.createByArray(h)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){const r=e[t];if(r.isError())return r}return P.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class py extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return w.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),w.create(t)}}const yy=Object.values(Be).filter(a=>[Be.TABLE_START,Be.TABLE_ROW_START,Be.TABLE_CELL_START,Be.TABLE_CELL_END,Be.TABLE_ROW_END,Be.TABLE_END,Be.CUSTOM_BLOCK].includes(a));class by extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){const{isError:t,errorObject:r,variants:n}=F(e);if(t)return r;const[s]=n,u=Math.floor(+s.getValue());if(u<1||u>1114111)return f.create(g.VALUE);if(u===1114111||u===1114110)return f.create(g.NA);let o=String.fromCharCode(u);return yy.some(i=>i===o)&&(o=""),w.create(o)}}class Ry extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return f.create(g.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());const r=t.charCodeAt(0);return A.create(r)}}class Sy extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return w.create("");const t=`${e.getValue()}`.toLocaleUpperCase();return w.create(t)}}class Oy extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return f.create(g.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue(),t.isError()))return t;const r=+t.getValue();return A.create(r)}}class My extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",2)}calculate(e,t){const r=t??A.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=S(n,s,e,f.create(g.NA)),o=S(n,s,r,f.create(g.NA)),i=u.mapValue((l,c,h)=>{const m=o.get(c,h);return l.isError()?l:m.isError()?m:this._handleSingleObject(l,m)});return n===1&&s===1?i.get(0,0):i}_handleSingleObject(e,t){const{isError:r,errorObject:n,variants:s}=F(t);if(r)return n;const[u]=s,o=Math.floor(+u.getValue());if(o<0||o>1)return f.create(g.VALUE);if(e.isNull())return w.create("");if(e.isBoolean())return e;if(e.isNumber())return A.create(e.getValue());const i=o?`"${e.getValue()}"`:`${e.getValue()}`;return w.create(i)}}const ih=[[yp,z.ASC],[pp,z.ARRAYTOTEXT],[bp,z.BAHTTEXT],[Sp,z.CHAR],[Op,z.CLEAN],[Mp,z.CODE],[Vp,z.CONCAT],[Tp,z.CONCATENATE],[Ip,z.DBCS],[xp,z.DOLLAR],[Up,z.EXACT],[vp,z.FIND],[Dp,z.FINDB],[Lp,z.FIXED],[Pp,z.LEFT],[Fp,z.LEFTB],[jp,z.LEN],[Bp,z.LENB],[kp,z.LOWER],[$p,z.MID],[Yp,z.MIDB],[qp,z.NUMBERSTRING],[Wp,z.NUMBERVALUE],[sy,z.REGEXEXTRACT],[ay,z.REGEXMATCH],[uy,z.REGEXREPLACE],[Qp,z.PROPER],[oy,z.REPLACE],[iy,z.REPLACEB],[ly,z.REPT],[cy,z.RIGHT],[hy,z.RIGHTB],[my,z.SEARCH],[gy,z.SEARCHB],[fy,z.SUBSTITUTE],[dy,z.T],[Ny,z.TEXT],[_y,z.TEXTAFTER],[Cy,z.TEXTBEFORE],[Ey,z.TEXTJOIN],[Ay,z.TEXTSPLIT],[py,z.TRIM],[by,z.UNICHAR],[Ry,z.UNICODE],[Sy,z.UPPER],[Oy,z.VALUE],[My,z.VALUETOTEXT]],lh=[];var ch=(a=>a)(ch||{});function hi(a){return a.map(e=>e.map(t=>typeof t=="number"?Js(t):t))}function Vy(a,e=!1){if(a.isReferenceObject()){const t=a.toArrayValueObject().toValue();return e?hi(t):t}else if(a.isArray()){const t=a.toValue();return e?hi(t):t}else if(a.isNumber()){const t=a.getValue();return e?Js(t):t}return a.getValue()}class Ty extends R{constructor(){super(...arguments),N(this,"minParams",1),N(this,"maxParams",1)}calculate(e){if(e.isArray()){const t=e.mapValue(r=>this._handleSingleObject(r));return t.getRowCount()===1&&t.getColumnCount()===1?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;const t=Ue(e),r=encodeURIComponent(t).replace(/[!~'()*]/g,n=>`%${n.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return w.create(r)}}const hh=[[Ty,On.ENCODEURL]];class mo extends Me{constructor(){super(...arguments),N(this,"_allSubjects",[]),N(this,"_computingStatus$",new Ps(!0)),N(this,"computingStatus$",this._computingStatus$.pipe(_i())),N(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),(e=this._computingSubscription)==null||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(t=>{t.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{const t=this._allSubjects.indexOf(e);t!==-1&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if((e=this._computingSubscription)==null||e.unsubscribe(),this._allSubjects.length===0){this._computingStatus$.next(!0);return}this._computingSubscription=Mh(this._allSubjects).pipe(Vh(t=>t.every(r=>r))).subscribe(t=>this._computingStatus$.next(t))}}var Iy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},mi=(a,e)=>(t,r)=>e(t,r,a);let au=class extends Me{constructor(a,e){super(),N(this,"_computingCompleted$",new Fs(n=>{this._commandService.onCommandExecuted(s=>{if(s.id!==sn.id)return;const u=s.params;if(u.stageInfo)return n.next(u.stageInfo.stage===Ze.IDLE||u.stageInfo.stage===Ze.CALCULATION_COMPLETED)})}).pipe(_i(),hu())),this._commandService=a,this._globalComputingSrv=e;const t=new wh,r=new Ps(!0);t.add(this._globalComputingSrv.pushComputingStatusSubject(r)),t.add(this._computingCompleted$.subscribe(n=>r.next(n))),t.add(()=>r.complete()),this.disposeWithMe(t)}};au=Iy([mi(0,_t),mi(1,ge(mo))],au);var xy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},kn=(a,e)=>(t,r)=>e(t,r,a);let Us=class extends Me{constructor(a,e,t,r){super(),this._commandService=a,this._functionService=e,this._configService=t,this._dataSyncPrimaryController=r,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[xu,gs,Uu,Au,qi,pu,yu,Mu,Vu,bu,sn,qs,Tu,Iu,Ru,Cs,Su,Ou,Eu,Xi,Gs,Xs,yn,bn,Qi,Ki,Zi,ji].forEach(a=>{var e;this._commandService.registerCommand(a),(e=this._dataSyncPrimaryController)==null||e.registerSyncingMutations(a)})}_registerFunctions(){var a;const e=this._configService.getConfig(Ws),t=[...Ul,...Uc,...vc,...Lc,...Pc,...Fc,...Gc,...Xc,...qc,...Wc,...Qc,...Kc,...Zc,...ih,...lh,...hh].concat((a=e?.function)!=null?a:[]).map(r=>{const n=r[0],s=r[1];return new n(s)});this._functionService.registerExecutors(...t)}};Us=xy([kn(0,_t),kn(1,kt),kn(2,_n),kn(3,Ph(tn))],Us);var Uy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},$n=(a,e)=>(t,r)=>e(t,r,a);let vs=class extends Me{constructor(a,e,t){super(),this._commandService=a,this._dependencyManagerService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(a=>{const{unitId:e,subUnitId:t,featureIds:r}=a;this._dependencyManagerService.removeFeatureFormulaDependency(e,t,r)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(a=>{if(a.id===Xs.id){const e=a.params;if(e==null)return;const{featureIds:t,unitId:r,subUnitId:n}=e;this._dependencyManagerService.removeFeatureFormulaDependency(r,n,t)}else if(a.id===Gs.id){const e=a.params;if(e==null)return;const{featureId:t,calculationParam:r}=e,{unitId:n,subUnitId:s}=r;this._dependencyManagerService.removeFeatureFormulaDependency(n,s,[t])}else if(a.id===bn.id){const e=a.params;if(e==null)return;this._dependencyManagerService.removeOtherFormulaDependency(e.unitId,e.subUnitId,e.formulaIdList)}else if(a.id===yn.id){const e=a.params;if(e==null)return;const t=e.formulaMap,r=[];Object.keys(t).forEach(n=>{r.push(n)}),this._dependencyManagerService.removeOtherFormulaDependency(e.unitId,e.subUnitId,r)}else if(a.id===xu.id){const e=a.params.formulaData;Object.keys(e).forEach(t=>{const r=e[t];if(r!==void 0){if(r===null){this._dependencyManagerService.clearFormulaDependency(t);return}Object.keys(r).forEach(n=>{const s=r[n];if(s!==void 0){if(s===null)return this._dependencyManagerService.clearFormulaDependency(t,n),!0;new me(s).forValue((u,o)=>{this._dependencyManagerService.removeFormulaDependency(t,n,u,o)})}})}})}else a.id===Eu.id&&this._handleSetDefinedName(a)}))}_handleSetDefinedName(a){const e=a.params;if(e==null)return;const{unitId:t,name:r}=e;this._dependencyManagerService.removeFormulaDependencyByDefinedName(t,r)}};vs=Uy([$n(0,_t),$n(1,Br),$n(1,Mn),$n(2,Br)],vs);var vy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},gi=(a,e)=>(t,r)=>e(t,r,a);let ws=class extends Me{constructor(a,e){super(),this._commandService=a,this._featureCalculationManagerService=e,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(a=>{if(a.id===Gs.id){const e=a.params;if(e==null)return;const{featureId:t,calculationParam:r}=e,{unitId:n,subUnitId:s}=r;this._featureCalculationManagerService.register(n,s,t,r)}else if(a.id===Xs.id){const e=a.params;if(e==null)return;const{featureIds:t,unitId:r,subUnitId:n}=e;this._featureCalculationManagerService.remove(r,n,t)}}))}};ws=vy([gi(0,_t),gi(1,Br)],ws);var wy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Ra=(a,e)=>(t,r)=>e(t,r,a);let Ds=class extends Me{constructor(a,e,t){super(),this._commandService=a,this._otherFormulaManagerService=e,this._dependencyManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(a=>{if(a.id===yn.id){const e=a.params;if(e==null)return;const t={[e.unitId]:{[e.subUnitId]:e.formulaMap}};this._otherFormulaManagerService.batchRegister(t)}else if(a.id===bn.id){const e=a.params;if(e==null)return;const t={};e.formulaIdList.forEach(n=>t[n]=!0);const r={[e.unitId]:{[e.subUnitId]:t}};this._otherFormulaManagerService.batchRemove(r)}}))}};Ds=wy([Ra(0,_t),Ra(1,sa),Ra(2,Mn)],Ds);class mh extends Me{constructor(){super(...arguments),N(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}const go=Ye("univer.formula.active-dirty-manager.service");var ar=(a=>(a[a.NOT_REGISTER=1]="NOT_REGISTER",a[a.SUCCESS=2]="SUCCESS",a[a.WAIT=3]="WAIT",a[a.ERROR=4]="ERROR",a))(ar||{}),Dy=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},Sa=(a,e)=>(t,r)=>e(t,r,a),gh=(a=>(a.DEFAULT="default",a.DATA_VALIDATION="dv",a.DATA_VALIDATION_CUSTOM="dv-custom",a.CONDITIONAL_FORMATTING="cf",a.DOC="doc",a.SLIDE="slide",a))(gh||{});let Ls=class extends Me{constructor(a,e,t){super(),N(this,"_formulaCacheMap",new Map),N(this,"_formulaChangeWithRange$",new Dt),N(this,"formulaChangeWithRange$",this._formulaChangeWithRange$.asObservable()),N(this,"_formulaResult$",new Dt),N(this,"formulaResult$",this._formulaResult$.asObservable()),N(this,"calculateStarted$",new Ps(!1)),this._commandService=a,this._activeDirtyManagerService=e,this._lifecycleService=t,this._initFormulaRegister(),this._initFormulaCalculationResultChange()}dispose(){super.dispose(),this._formulaChangeWithRange$.complete(),this._formulaResult$.complete(),this.calculateStarted$.complete()}_ensureCacheMap(a,e){let t=this._formulaCacheMap.get(a);t||(t=new Map,this._formulaCacheMap.set(a,t));let r=t.get(e);return r||(r=new Map,t.set(e,r)),r}_createFormulaId(a,e,t,r){return`formula.${a}_${e}_${t}_${r}_${Ci(8)}`}_initFormulaRegister(){this._activeDirtyManagerService.register(Kr.id,{commandId:Kr.id,getDirtyData(e){return{dirtyUnitOtherFormulaMap:e.params}}});const a=e=>{const{unitId:t,subUnitId:r,formulaText:n,formulaId:s,ranges:u}=e;if(!this._ensureCacheMap(t,r).has(s))return;const o={unitId:t,subUnitId:r,formulaMap:{[s]:{f:n,ranges:u}}};this._commandService.executeCommand(yn.id,o).then(()=>{this._commandService.executeCommand(Kr.id,{[t]:{[r]:{[s]:!0}}})})};this.disposeWithMe(this._formulaChangeWithRange$.pipe(Bh(()=>this.calculateStarted$.pipe(Ma(e=>e)))).subscribe(e=>e.forEach(a))),this.disposeWithMe(this._formulaChangeWithRange$.pipe(Ma(()=>this.calculateStarted$.getValue())).subscribe(a))}_initFormulaCalculationResultChange(){this.disposeWithMe(this._commandService.onCommandExecuted(a=>{if(a.id===qs.id){const e=a.params,{unitOtherData:t}=e,r={};for(const n in t){const s=t[n],u={};r[n]=u;for(const o in s){const i=this._ensureCacheMap(n,o),l=s[o],c=[];u[o]=c;for(const h in l){const m=l[h];if(i.has(h)){const d=i.get(h);if(!d)continue;d.result||(d.result={});const _=new me(m),C=new me(d.result);_.forValue((E,p,y)=>{C.setValue(E,p,y)}),d.status=ar.SUCCESS,d.callbacks.forEach(E=>{E(m)}),d.callbacks.clear(),c.push(d)}}}}this._formulaResult$.next(r)}}))}registerFormulaWithRange(a,e,t,r=[{startRow:0,endRow:0,startColumn:0,endColumn:0}],n,s="default",u=""){const o=this._createFormulaId(a,e,s,u);return this._ensureCacheMap(a,e).set(o,{result:void 0,status:ar.WAIT,formulaId:o,callbacks:new Set,extra:n}),this._formulaChangeWithRange$.next({unitId:a,subUnitId:e,formulaText:t,formulaId:o,ranges:r}),o}deleteFormula(a,e,t){const r={unitId:a,subUnitId:e,formulaIdList:t};this._commandService.executeCommand(bn.id,r);const n=this._ensureCacheMap(a,e);t.forEach(s=>n.delete(s))}getFormulaValue(a,e,t){const r=this._ensureCacheMap(a,e),n=r.get(t);return n?n.status===ar.SUCCESS||n.status===ar.ERROR?Promise.resolve(n):new Promise(s=>{n.callbacks.add(()=>{s(r.get(t))})}):Promise.resolve(null)}getFormulaValueSync(a,e,t){return this._ensureCacheMap(a,e).get(t)}markFormulaDirty(a,e,t){const r=this.getFormulaValueSync(a,e,t);r&&(r.status=ar.WAIT,this._commandService.executeCommand(Kr.id,{[a]:{[e]:{[t]:!0}}}))}};Ls=Dy([Sa(0,_t),Sa(1,go),Sa(2,ge(Fh))],Ls);var Ly=(a,e,t,r)=>{for(var n=e,s=a.length-1,u;s>=0;s--)(u=a[s])&&(n=u(n)||n);return n},fi=(a,e)=>(t,r)=>e(t,r,a);const Py="UNIVER_ENGINE_FORMULA_PLUGIN";var Oa;let uu=(Oa=class extends iu{constructor(a=Po,e,t){super(),this._config=a,this._injector=e,this._configService=t;const{...r}=lu({},Po,this._config);this._configService.setConfig(Ws,r)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var a;ga(this._injector,[[Us]]),(a=this._config)!=null&&a.notExecuteFormula||ga(this._injector,[[Ds],[ws],[vs],[Nn]])}onRendered(){var a;(a=this._config)!=null&&a.notExecuteFormula||ga(this._injector,[[Ts],[Ms]])}_initialize(){const a=!this._config.notExecuteFormula,e=[[kt,{useClass:Al}],[br,{useClass:_s}],[go,{useClass:mh}],[Ls],[$u,{useClass:Rs}],[wu,{useClass:el}],[Gr,{useClass:Wi}],[mo],[Nr],[Us],[au]];a&&e.push([sa,{useClass:Vl}],[Ct,{useClass:Ss}],[Bt,{useClass:Es}],[Br,{useClass:Ml}],[Nn],[Ds],[vs],[ws],[Cr],[jr],[_r],[Yu],[cn],[hn],[Gu],[mn],[ln],[gn],[fn],[dn],[Xu]),e.forEach(t=>this._injector.add(t))}_initializeWithOverride(){var a;this._injector.add([Pr,{useClass:Pr}]),(a=this._config)!=null&&a.notExecuteFormula||[[Ts,{useClass:Is}],[Mn,{useClass:Ol}],[Ms,{useClass:Vs}]].forEach(e=>this._injector.add(e))}},N(Oa,"pluginName",Py),Oa);uu=Ly([fi(1,ge($r)),fi(2,_n)],uu);const Yy=Object.freeze(Object.defineProperty({__proto__:null,ActiveDirtyManagerService:mh,ArrayValueObject:W,AstRootNodeFactory:Yu,get AstTreeBuilder(){return jr},AsyncArrayObject:Cl,AsyncCustomFunction:Jd,AsyncObject:_l,BaseFunction:R,BaseReferenceObject:Rr,BaseValueObject:jt,BooleanValue:Wt,BooleanValueObject:P,get CalculateController(){return Nn},get CalculateFormulaService(){return Is},CustomFunction:Dc,DEFAULT_INTERVAL_COUNT:Il,DEFAULT_TOKEN_LAMBDA_FUNCTION_NAME:Dr,DEFAULT_TOKEN_LET_FUNCTION_NAME:Fi,DEFAULT_TOKEN_TYPE_LAMBDA_PARAMETER:fr,DEFAULT_TOKEN_TYPE_PARAMETER:mt,DEFAULT_TOKEN_TYPE_ROOT:Lt,get DefinedNamesService(){return _s},DependencyManagerBaseService:Sl,DependencyManagerService:Ol,ENGINE_FORMULA_CYCLE_REFERENCE_COUNT:rg,ENGINE_FORMULA_PLUGIN_CONFIG_KEY:Ws,ENGINE_FORMULA_RETURN_DEPENDENCY_TREE:ng,ERROR_TYPE_SET:zt,ErrorType:g,ErrorValueObject:f,FUNCTION_NAMES_ARRAY:xs,FUNCTION_NAMES_COMPATIBILITY:he,FUNCTION_NAMES_CUBE:wc,FUNCTION_NAMES_DATABASE:Ge,FUNCTION_NAMES_DATE:_e,FUNCTION_NAMES_ENGINEERING:X,FUNCTION_NAMES_FINANCIAL:J,FUNCTION_NAMES_INFORMATION:ye,FUNCTION_NAMES_LOGICAL:Ce,FUNCTION_NAMES_LOOKUP:te,FUNCTION_NAMES_MATH:j,FUNCTION_NAMES_STATISTICAL:I,FUNCTION_NAMES_TEXT:z,FUNCTION_NAMES_UNIVER:ch,FUNCTION_NAMES_WEB:On,FeatureCalculationManagerService:Ml,get FormulaCurrentConfigService(){return Es},get FormulaDataModel(){return Nr},get FormulaDependencyGenerator(){return Vs},FormulaDependencyTree:Zn,FormulaDependencyTreeModel:tu,FormulaDependencyTreeType:sr,FormulaDependencyTreeVirtual:eu,FormulaExecuteStageType:Ze,FormulaExecutedStateType:Vr,FormulaResultStatus:ar,get FormulaRuntimeService(){return Ss},get FunctionNodeFactory(){return cn},FunctionService:Al,FunctionType:Ti,GlobalComputingStatusService:mo,get HyperlinkEngineFormulaService(){return Rs},IActiveDirtyManagerService:go,ICalculateFormulaService:Ts,IDefinedNamesService:br,IDependencyManagerService:Mn,IFeatureCalculationManagerService:Br,IFormulaCurrentConfigService:Bt,IFormulaDependencyGenerator:Ms,IFormulaRuntimeService:Ct,IFunctionService:kt,IHyperlinkEngineFormulaService:$u,IOtherFormulaManagerService:sa,ISheetRowFilteredService:wu,ISuperTableService:Gr,get Interpreter(){return Cr},get LambdaNodeFactory(){return hn},LambdaParameterNodeFactory:Gu,LambdaValueObjectObject:na,get Lexer(){return _r},LexerNode:ae,LexerTreeBuilder:Pr,NEW_EXCEL_FUNCTIONS:zE,NullValueObject:ce,NumberValueObject:A,OPERATOR_TOKEN_SET:yt,get OperatorNodeFactory(){return mn},OtherFormulaBizType:gh,OtherFormulaManagerService:Vl,OtherFormulaMarkDirty:Kr,get PrefixNodeFactory(){return ln},RangeReferenceObject:on,get ReferenceNodeFactory(){return gn},RegisterFunctionMutation:ji,get RegisterOtherFormulaService(){return Ls},RemoveDefinedNameMutation:Xi,RemoveFeatureCalculationMutation:Xs,RemoveOtherFormulaMutation:bn,RemoveSuperTableMutation:Ki,SUFFIX_TOKEN_SET:Gn,SetArrayFormulaDataMutation:gs,SetCellFormulaDependencyCalculationMutation:Su,SetCellFormulaDependencyCalculationResultMutation:Ou,SetDefinedNameMutation:Eu,SetDefinedNameMutationFactory:Qm,SetFeatureCalculationMutation:Gs,SetFormulaCalculationNotificationMutation:sn,SetFormulaCalculationResultMutation:qs,SetFormulaCalculationStartMutation:Au,SetFormulaCalculationStopMutation:bu,SetFormulaDataMutation:xu,SetFormulaDependencyCalculationMutation:Ru,SetFormulaDependencyCalculationResultMutation:Cs,SetFormulaStringBatchCalculationMutation:pu,SetFormulaStringBatchCalculationResultMutation:yu,SetImageFormulaDataMutation:Uu,SetOtherFormulaMutation:yn,SetQueryFormulaDependencyAllMutation:Tu,SetQueryFormulaDependencyAllResultMutation:Iu,SetQueryFormulaDependencyMutation:Mu,SetQueryFormulaDependencyResultMutation:Vu,SetSuperTableMutation:Qi,SetSuperTableOptionMutation:Zi,SetTriggerFormulaCalculationStartMutation:qi,SheetRowFilteredService:el,StringValueObject:w,get SuffixNodeFactory(){return fn},SuperTableService:Wi,get UnionNodeFactory(){return dn},get UniverFormulaEnginePlugin(){return uu},ValueNodeFactory:Xu,ValueObjectFactory:Vt,compareToken:k,convertUnitDataToRuntime:va,deserializeRangeForR1C1:xl,deserializeRangeWithSheet:Lr,deserializeRangeWithSheetWithCache:dr,excelDateSerial:be,extractFormulaError:og,functionArray:Ul,functionCompatibility:Uc,functionCube:vc,functionDatabase:Lc,functionDate:Pc,functionEngineering:Fc,functionFinancial:Gc,functionInformation:Xc,functionLogical:qc,functionLookup:Wc,functionMath:Qc,functionMeta:Kc,functionStatistical:Zc,functionText:ih,functionUniver:lh,functionWeb:hh,generateAstNode:za,generateExecuteAstNodeData:Ja,generateRandomDependencyTreeId:nr,generateStringWithSequence:La,getAbsoluteRefTypeWitString:km,getAbsoluteRefTypeWithSingleString:Jr,getObjectValue:Vy,getRangeWithRefsString:Ym,handleNumfmtInCell:mg,handleRefStringInfo:Hs,includeFormulaLexerToken:xi,initSheetFormulaData:Pa,isFormulaLexerToken:zr,isInDirtyRange:Vi,isReferenceString:Cu,isReferenceStringWithEffectiveColumn:en,isReferenceStrings:Yi,matchRefDrawToken:gm,matchToken:q,needsQuoting:ds,normalizeSheetName:mm,operatorToken:K,prefixToken:Ie,quoteSheetName:Ns,sequenceNodeType:je,serializeRange:Pt,serializeRangeToRefString:fs,serializeRangeWithSheet:Bi,serializeRangeWithSpreadsheet:ki,singleReferenceToGrid:Xn,splitTableStructuredRef:Gi,strip:qa,stripErrorMargin:Js,unquoteSheetName:wa},Symbol.toStringTag,{value:"Module"}));export{eu as $,mt as A,Lt as B,Yu as C,z as D,uu as E,ch as F,Dr as G,On as H,Rr as I,Nn as J,W as K,Ml as L,fr as M,R as N,Es as O,I as P,X as Q,Nr as R,Vs as S,Ws as T,Zn as U,tu as V,jt as W,Ge as X,sr as Y,mh as Z,Jd as _,jr as a,yn as a$,Ze as a0,Vr as a1,ar as a2,Ss as a3,cn as a4,Al as a5,Ti as a6,mo as a7,Rs as a8,go as a9,Kr as aA,ln as aB,on as aC,gn as aD,ji as aE,Ls as aF,Xi as aG,Xs as aH,bn as aI,Ki as aJ,Gn as aK,gs as aL,Su as aM,Ou as aN,Eu as aO,Qm as aP,Gs as aQ,sn as aR,qs as aS,Au as aT,bu as aU,xu as aV,Ru as aW,Cs as aX,pu as aY,yu as aZ,Uu as a_,Ts as aa,br as ab,Mn as ac,Br as ad,Bt as ae,Ms as af,Ct as ag,kt as ah,$u as ai,sa as aj,wu as ak,Gr as al,Cr as am,hn as an,Gu as ao,na as ap,_r as aq,ae as ar,Pr as as,zE as at,ce as au,A as av,yt as aw,mn as ax,gh as ay,Vl as az,Cl as b,fs as b$,Tu as b0,Iu as b1,Mu as b2,Vu as b3,Qi as b4,Zi as b5,qi as b6,el as b7,w as b8,fn as b9,hh as bA,za as bB,Ja as bC,nr as bD,La as bE,km as bF,Jr as bG,Vy as bH,Ym as bI,mg as bJ,Hs as bK,xi as bL,Pa as bM,zr as bN,Vi as bO,Cu as bP,en as bQ,Yi as bR,gm as bS,q as bT,ds as bU,mm as bV,K as bW,Ie as bX,Ns as bY,je as bZ,Pt as b_,Wi as ba,dn as bb,Xu as bc,Vt as bd,k as be,va as bf,xl as bg,Lr as bh,dr as bi,be as bj,og as bk,Ul as bl,Uc as bm,vc as bn,Lc as bo,Pc as bp,Fc as bq,Gc as br,Xc as bs,qc as bt,Wc as bu,Qc as bv,Kc as bw,Zc as bx,ih as by,lh as bz,Is as c,Bi as c0,ki as c1,Xn as c2,Gi as c3,qa as c4,Js as c5,wa as c6,Eo as c7,Xh as c8,qh as c9,bi as ca,tn as cb,ss as cc,Bs as cd,ns as ce,rs as cf,Yh as cg,Hh as ch,gu as ci,Ta as cj,mu as ck,Ao as cl,Ia as cm,pi as cn,yi as co,Bh as cp,Yy as cq,Fi as d,_s as e,Sl as f,ng as g,rg as h,zt as i,g as j,f as k,xs as l,he as m,wc as n,Wt as o,_e as p,J as q,ye as r,_l as s,Ol as t,Il as u,P as v,Ce as w,te as x,j as y,Dc as z};
