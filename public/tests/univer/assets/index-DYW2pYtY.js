import{L as I,b6 as M,bi as j,cl as C,j as R,eV as B,bB as J,i as le,fa as Q,bP as y,fM as oe,aB as ce,g6 as ie,N as o,gb as ue,bp as Z,da as ee,gq as fe,c5 as he,fk as de,fA as me,g0 as ge,fy as O,P as pe,aw as be,gl as ve,bm as E,bo as _e,b7 as te,d4 as Se}from"./index-BI8deSNo.js";import{K as D,e as H,hm as W,r as $e,gz as L,hV as z,O as ae,d as we,D as Re,X as P,l as ye,R as xe,bz as Ce,g as Me,Y as Ee}from"./facade-BslPbXnu.js";import{c5 as Ne}from"./index-BBqjqAkl.js";import{bE as Ie}from"./index-BeEHzc6r.js";var Ve=Object.defineProperty,Ue=(e,t,a)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,G=(e,t,a)=>Ue(e,typeof t!="symbol"?t+"":t,a);const se=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿","﷼"],U=new Map([[o.EN_US,"$"],[o.RU_RU,"₽"],[o.VI_VN,"₫"],[o.ZH_CN,"¥"],[o.ZH_TW,"NT$"],[o.FR_FR,"€"],[o.FA_IR,"﷼"],[o.KO_KR,"₩"],[o.ES_ES,"€"],[o.CA_ES,"€"],[o.SK_SK,"€"]]);function Oe(e){switch(e){case o.CA_ES:case o.ES_ES:case o.FR_FR:case o.SK_SK:return{icon:"EuroIcon",symbol:U.get(e)||"€",locale:e};case o.RU_RU:return{icon:"RoubleIcon",symbol:U.get(e)||"₽",locale:e};case o.ZH_CN:return{icon:"RmbIcon",symbol:U.get(e)||"¥",locale:e};case o.EN_US:default:return{icon:"DollarIcon",symbol:"$",locale:o.EN_US}}}function q(e){return U.get(e)||"$"}function Ae(e,t=2){let a=t;t>127&&(a=127);let s="";return a>0&&(s=`.${"0".repeat(a)}`),`"${q(e)}"#,##0${s}_);[Red]("${q(e)}"#,##0${s})`}const Te=[{label:"1930-08-05",suffix:"yyyy-MM-dd"},{label:"1930/08/05",suffix:"yyyy/MM/dd"},{label:"1930年08月05日",suffix:'yyyy"年"MM"月"dd"日"'},{label:"08-05",suffix:"MM-dd"},{label:"8月5日",suffix:'M"月"d"日"'},{label:"13:30:30",suffix:"h:mm:ss"},{label:"13:30",suffix:"h:mm"},{label:"下午01:30",suffix:"A/P hh:mm"},{label:"下午1:30",suffix:"A/P h:mm"},{label:"下午1:30:30",suffix:"A/P h:mm:ss"},{label:"08-05 下午 01:30",suffix:"MM-dd A/P hh:mm"}],Fe=[{label:"(1,235)",suffix:"#,##0_);(#,##0)"},{label:"(1,235) ",suffix:"#,##0_);[Red](#,##0)",color:"red"},{label:"1,234.56",suffix:"#,##0.00_);#,##0.00"},{label:"1,234.56",suffix:"#,##0.00_);[Red]#,##0.00",color:"red"},{label:"-1,234.56",suffix:"#,##0.00_);-#,##0.00"},{label:"-1,234.56",suffix:"#,##0.00_);[Red]-#,##0.00",color:"red"}],ke=[{label:e=>`${e}1,235`,suffix:e=>`"${e}"#,##0.00_);"${e}"#,##0.00`},{label:e=>`${e}1,235`,suffix:e=>`"${e}"#,##0.00_);[Red]"${e}"#,##0.00`,color:"red"},{label:e=>`(${e}1,235)`,suffix:e=>`"${e}"#,##0.00_);("${e}"#,##0.00)`},{label:e=>`(${e}1,235)`,suffix:e=>`"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`,color:"red"},{label:e=>`-${e}1,235`,suffix:e=>`"${e}"#,##0.00_);-"${e}"#,##0.00`},{label:e=>`-${e}1,235`,suffix:e=>`"${e}"#,##0.00_);[Red]-"${e}"#,##0.00`,color:"red"}],A=(e,t=0)=>{var a;return e&&(a=O.getFormatInfo(e).maxDecimals)!=null?a:t},X=e=>new Array(Math.min(Math.max(0,Number(e)),30)).fill(0).join(""),T=(e,t)=>e.split(";").map(a=>/\.0?/.test(a)?a.replace(/\.0*/g,`${t>0?".":""}${X(Number(t||0))}`):/0([^0]?)|0$/.test(a)?a.replace(/0([^0]+)|0$/,`0${t>0?".":""}${X(Number(t||0))}$1`):a).join(";"),et=e=>/\.0?/.test(e)||/0([^0]?)|0$/.test(e),V={id:"sheet.command.numfmt.set.numfmt",type:I.COMMAND,handler:(e,t)=>{if(!t)return!1;const a=e.get(M),s=e.get(j),n=e.get(le),r=W(s,t);if(!r)return!1;const{unitId:c,subUnitId:g,worksheet:u}=r,f=t.values.filter(l=>!!l.pattern),S=t.values.filter(l=>!l.pattern),w=$e(c,g,f),m={unitId:c,subUnitId:g,ranges:S.map(l=>({startColumn:l.col,startRow:l.row,endColumn:l.col,endRow:l.row}))},p=[],h=[];if(f.length){const l=f.reduce((d,i)=>{Q(i.pattern)&&d.setValue(i.row,i.col,{t:R.STRING});const $=u.getCellRaw(i.row,i.col);if($){const N=L($.v);N!==$.t&&d.setValue(i.row,i.col,{t:N})}return d},new y).getMatrix(),v=new y;new y(l).forValue((d,i)=>{const $=u.getCellRaw(d,i);$?v.setValue(d,i,{t:$.t}):v.setValue(d,i,{t:void 0})}),Object.keys(w.values).forEach(d=>{const i=w.values[d];i.ranges=z(i.ranges)}),p.push({id:ae.id,params:w});const _=we(e,w);h.push(..._)}if(S.length){m.ranges=z(m.ranges);const l=S.reduce((d,i)=>{const $=u.getCellRaw(i.row,i.col);if($){const N=L($.v);N!==$.t&&d.setValue(i.row,i.col,{t:N})}return d},new y).getMatrix(),v=new y;new y(l).forValue((d,i)=>{const $=u.getCellRaw(d,i);$?v.setValue(d,i,{t:$.t}):v.setValue(d,i,{t:void 0})}),p.push({id:Re.id,params:m},{id:P.id,params:{unitId:c,subUnitId:g,cellValue:l}});const _=ye(e,m);h.push({id:P.id,params:{unitId:c,subUnitId:g,cellValue:v.getMatrix()}},..._)}const b=oe(p,a).result;return b&&n.pushUndoRedo({unitID:c,undoMutations:h,redoMutations:p}),b}},je={id:"sheet.command.numfmt.add.decimal.command",type:I.COMMAND,handler:async e=>{const t=e.get(M),a=e.get(D),s=e.get(H),n=e.get(j),r=a.getCurrentSelections();if(!r||!r.length)return!1;const c=W(n);if(!c)return!1;const{unitId:g,subUnitId:u}=c;let f=0;r.forEach(p=>{C.foreach(p.range,(h,b)=>{const l=s.getValue(g,u,h,b);if(!l){const _=c.worksheet.getCellRaw(h,b);if(!f&&_&&_.t===R.NUMBER&&_.v){const d=/\.(\d*)$/.exec(String(_.v));if(d){const i=d[1].length;if(!i)return;f=Math.max(f,i)}}return}const v=A(l.pattern);f=v>f?v:f})});const S=f+1,w=T(`0${S>0?".0":""}`,S),m=[];return r.forEach(p=>{C.foreach(p.range,(h,b)=>{const l=s.getValue(g,u,h,b);if(B(l?.pattern))m.push({row:h,col:b,pattern:w});else{const v=A(l.pattern),_=T(l.pattern,v+1);_!==l.pattern&&m.push({row:h,col:b,pattern:_})}})}),m.length?await t.executeCommand(V.id,{values:m}):!1}},De={id:"sheet.command.numfmt.set.currency",type:I.COMMAND,handler:async e=>{const t=e.get(M),a=e.get(D),s=e.get(J),n=a.getCurrentSelections();if(!n||!n.length)return!1;const r=[],c=Oe(s.getCurrentLocale()),g=Ae(c.locale);return n.forEach(u=>{C.foreach(u.range,(f,S)=>{r.push({row:f,col:S,pattern:g,type:"currency"})})}),await t.executeCommand(V.id,{values:r})}},Ke={id:"sheet.command.numfmt.set.percent",type:I.COMMAND,handler:async e=>{const t=e.get(M),a=e.get(D).getCurrentSelections();if(!a||!a.length)return!1;const s=[],n="0%";return a.forEach(r=>{C.foreach(r.range,(c,g)=>{s.push({row:c,col:g,pattern:n,type:"percent"})})}),await t.executeCommand(V.id,{values:s})}},Le={id:"sheet.command.numfmt.subtract.decimal.command",type:I.COMMAND,handler:async e=>{const t=e.get(M),a=e.get(D),s=e.get(H),n=e.get(j),r=a.getCurrentSelections();if(!r||!r.length)return!1;const c=W(n);if(!c)return!1;const{unitId:g,subUnitId:u}=c;let f=0;r.forEach(p=>{C.foreach(p.range,(h,b)=>{const l=s.getValue(g,u,h,b);if(!l){const _=c.worksheet.getCellRaw(h,b);if(!f&&_&&_.t===R.NUMBER&&_.v){const d=/\.(\d*)$/.exec(String(_.v));if(d){const i=d[1].length;if(!i)return;f=Math.max(f,i)}}return}const v=A(l.pattern);f=v>f?v:f})});const S=f-1,w=T(`0${S>0?".0":"."}`,S),m=[];return r.forEach(p=>{C.foreach(p.range,(h,b)=>{const l=s.getValue(g,u,h,b);if(B(l?.pattern))m.push({row:h,col:b,pattern:w});else{const v=A(l.pattern);m.push({row:h,col:b,pattern:T(l.pattern,v-1)})}})}),await t.executeCommand(V.id,{values:m})}},re="sheets-numfmt.config",Y={},tt=e=>O.getFormatInfo(e).type||"unknown",Pe=(e,t,a="en")=>{try{const s=O.formatColor(e,t),n=s?String(s):void 0,r=O.format(e,t,{locale:a,throws:!1});return t<0?{result:r,color:n}:{result:r}}catch(s){console.warn("getPatternPreview error:",e,s)}return{result:String(t)}},Be=(e,t,a)=>e===pe?{result:String(Ne(t))}:Pe(e,t,a);var He=(e,t,a,s)=>{for(var n=t,r=e.length-1,c;r>=0;r--)(c=e[r])&&(n=c(n)||n);return n},x=(e,t)=>(a,s)=>t(a,s,e);const We={tl:{size:6,color:"#409f11"}};let F=class extends ce{constructor(e,t,a,s,n,r,c){super(),G(this,"_locale$",new ie("en")),G(this,"locale$",this._locale$.asObservable()),this._instanceService=e,this._sheetInterceptorService=t,this._themeService=a,this._commandService=s,this._numfmtService=n,this._localeService=r,this._configService=c,this._initInterceptorCellContent()}get locale(){const e=this._locale$.getValue();if(e)return e;switch(this._localeService.getCurrentLocale()){case o.FR_FR:return"fr";case o.RU_RU:return"ru";case o.VI_VN:return"vi";case o.ZH_CN:return"zh-CN";case o.KO_KR:return"ko";case o.ZH_TW:return"zh-TW";case o.ES_ES:case o.CA_ES:return"es";case o.SK_SK:return"sk";case o.EN_US:case o.FA_IR:default:return"en"}}_initInterceptorCellContent(){const e=new y;this.disposeWithMe(ue(this._locale$,this._localeService.currentLocale$).subscribe(()=>{e.reset()})),this.disposeWithMe(this._sheetInterceptorService.intercept(xe.CELL_CONTENT,{effect:Z.Value|Z.Style,handler:(t,a,s)=>{var n,r;if(!t||t.v===void 0||t.v===null||t.t===R.BOOLEAN||t.t===R.FORCE_STRING)return s(t);const c=a.unitId,g=a.subUnitId;let u;if(t!=null&&t.s){const h=a.workbook.getStyles().get(t.s);h!=null&&h.n&&(u=h.n)}if(u||(u=this._numfmtService.getValue(c,g,a.row,a.col)),B(u?.pattern)||t.t!==R.NUMBER&&L(t.v,t.t)!==R.NUMBER)return s(t);const f=t;if((!t||t===a.rawData)&&(t={...a.rawData}),Q(u?.pattern))return(n=this._configService.getConfig(re))!=null&&n.disableTextFormatMark?(t.t=R.STRING,s(t)):(t.t=R.STRING,t.markers={...t?.markers,...We},s(t));let S="";const w=e.getValue(a.row,a.col);if(w&&w.parameters===`${f.v}_${u?.pattern}`)return s({...t,...w.result});const m=Be(u?.pattern,Number(f.v),this.locale);if(S=m.result,!S)return s(t);const p={v:S,t:R.NUMBER};if(m.color){const h=(r=this._themeService.getColorFromTheme(`${m.color}.500`))!=null?r:m.color;h&&(p.interceptorStyle={cl:{rgb:h}})}return e.setValue(a.row,a.col,{result:p,parameters:`${f.v}_${u?.pattern}`}),Object.assign(t,p),s(t)},priority:Ce.NUMFMT})),this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===ae.id){const a=t.params;Object.keys(a.values).forEach(s=>{a.values[s].ranges.forEach(n=>{C.foreach(n,(r,c)=>{e.realDeleteValue(r,c)})})})}else if(t.id===P.id){const a=t.params;new y(a.cellValue).forValue((s,n)=>{e.realDeleteValue(s,n)})}})),this.disposeWithMe(this._instanceService.getCurrentTypeOfUnit$(ee.UNIVER_SHEET).pipe(Ie(t=>{var a;return(a=t?.activeSheet$)!=null?a:ve(null)}),fe(1)).subscribe(()=>e.reset()))}setNumfmtLocal(e){this._locale$.next(e)}};F=He([x(0,j),x(1,E(Ee)),x(2,E(Se)),x(3,E(M)),x(4,E(H)),x(5,E(J)),x(6,te)],F);const Ze="SHEET_NUMFMT_PLUGIN";var ze=Object.defineProperty,Ge=(e,t,a)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,qe=(e,t,a,s)=>{for(var n=t,r=e.length-1,c;r>=0;r--)(c=e[r])&&(n=c(n)||n);return n},K=(e,t)=>(a,s)=>t(a,s,e),ne=(e,t,a)=>Ge(e,typeof t!="symbol"?t+"":t,a);let k=class extends he{constructor(e=Y,t,a,s){super(),this._config=e,this._injector=t,this._configService=a,this._commandService=s;const{...n}=de({},Y,this._config);this._configService.setConfig(re,n)}onStarting(){me(this._injector,[[F]]),ge(this._injector,[[F]]),[je,Le,De,Ke,V].forEach(e=>{this.disposeWithMe(this._commandService.registerCommand(e))})}};ne(k,"pluginName",Ze);ne(k,"type",ee.UNIVER_SHEET);k=qe([be(Me),K(1,E(_e)),K(2,te),K(3,M)],k);const at=e=>se.find(t=>e.includes(t)),st=()=>se.map(e=>({label:e,value:e})),rt=e=>ke.map(t=>({label:t.label(e),value:t.suffix(e),color:t.color})),nt=()=>Te.map(e=>({label:e.label,value:e.suffix})),lt=()=>Fe.map(e=>({label:e.label,value:e.suffix,color:e.color}));export{ke as A,Pe as B,F as D,T as F,Be as H,Le as K,Ke as L,V as O,A as P,je as V,q as Y,re as a,Te as b,rt as c,Fe as d,se as e,k as f,Ae as g,st as h,nt as i,De as j,lt as l,et as n,at as o,X as q,tt as s,U as w,Oe as x};
