import{b6 as I,h as p,bi as A,cy as W,ai as j,bw as ie,aC as D,bx as z,gf as u,gc as se,da as ae,bc as P,f$ as w,bd as de,dn as he,bp as le,ea as ce}from"./index-BI8deSNo.js";import{U as X,j as ge,O as ue}from"./facade-bHpds0ZF.js";import{RichTextEditingMutation as ve}from"./index-GTTB9Gpg.js";import{aa as v,x as O,aS as Q}from"./index-DnxWP_AP.js";import{E as q,i7 as ee,i8 as te,i9 as $,f as re,d4 as f,i as k,eO as T,c as S,aF as H,f1 as M,a8 as we,hq as Ce,b8 as oe,p as E,cN as m,f8 as B,fe as U,b9 as y,b5 as ne,fm as be,ef as me,eK as pe,de as Ee,dR as ke,bz as Se,Y as fe,R as _e,eR as V,t as Ie,b7 as Re,K as He}from"./facade-BslPbXnu.js";import{an as x,W as N,z as L,av as Z,a4 as ye,au as F,a0 as K,bm as Y,aj as Pe,a6 as Ue,w as J}from"./index-BeEHzc6r.js";class xe extends X{_initSheetUIEvent(e){const t=e.get(I);this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetEditStart,()=>t.beforeCommandExecuted(r=>{if(r.id!==f.id)return;const o=this.getActiveSheet();if(!o)return;const{workbook:i,worksheet:d}=o,h=e.get(k),c=r.params,{visible:l,keycode:g,eventType:a}=c,n=h.getEditLocation();if(l){const s={row:n.row,column:n.column,eventType:a,keycode:g,workbook:i,worksheet:d,isZenEditor:!1};if(this.fireEvent(this.Event.BeforeSheetEditStart,s),s.cancel)throw new p}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetEditEnd,()=>t.beforeCommandExecuted(r=>{if(r.id!==f.id)return;const o=this.getActiveSheet();if(!o)return;const{workbook:i,worksheet:d}=o,h=e.get(k),c=e.get(A),l=r.params,{visible:g,keycode:a,eventType:n}=l,s=h.getEditLocation();if(!g){const C={row:s.row,column:s.column,eventType:n,keycode:a,workbook:i,worksheet:d,isZenEditor:!1,value:W.create(c.getUnit(j).getSnapshot()),isConfirm:a!==x.ESC};if(this.fireEvent(this.Event.BeforeSheetEditEnd,C),C.cancel)throw new p}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetEditStarted,()=>t.onCommandExecuted(r=>{if(r.id!==f.id)return;const o=this.getCommandSheetTarget(r);if(!o)return;const{workbook:i,worksheet:d}=o,h=e.get(k),c=r.params,{visible:l,keycode:g,eventType:a}=c,n=h.getEditLocation();if(l){const s={row:n.row,column:n.column,eventType:a,keycode:g,workbook:i,worksheet:d,isZenEditor:!1};this.fireEvent(this.Event.SheetEditStarted,s)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetEditEnded,()=>t.onCommandExecuted(r=>{if(r.id!==f.id)return;const o=this.getCommandSheetTarget(r);if(!o)return;const{workbook:i,worksheet:d}=o,h=e.get(k),c=r.params,{visible:l,keycode:g,eventType:a}=c,n=h.getEditLocation();if(!l){const s={row:n.row,column:n.column,eventType:a,keycode:g,workbook:i,worksheet:d,isZenEditor:!1,isConfirm:g!==x.ESC};this.fireEvent(this.Event.SheetEditEnded,s)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetEditChanging,()=>t.onCommandExecuted(r=>{if(r.id!==ve.id)return;const o=this.getActiveSheet();if(!o)return;const{workbook:i,worksheet:d}=o,h=e.get(k),c=e.get(A),l=r.params;if(!h.isVisible().visible)return;const{unitId:g}=l;if(g===j){const{row:a,column:n}=h.getEditLocation(),s={workbook:i,worksheet:d,row:a,column:n,value:W.create(c.getUnit(j).getSnapshot()),isZenEditor:!1};this.fireEvent(this.Event.SheetEditChanging,s)}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeSheetZoomChange,()=>t.beforeCommandExecuted(r=>{if(r.id!==T.id)return;const o=this.getCommandSheetTarget(r);if(!o)return;const{workbook:i,worksheet:d}=o,h={zoom:r.params.zoomRatio,workbook:i,worksheet:d};if(this.fireEvent(this.Event.BeforeSheetZoomChange,h),h.cancel)throw new p}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetZoomChanged,()=>t.onCommandExecuted(r=>{if(r.id!==T.id)return;const o=this.getCommandSheetTarget(r);if(!o)return;const{workbook:i,worksheet:d}=o;this.fireEvent(this.Event.SheetZoomChanged,{zoom:d.getZoom(),workbook:i,worksheet:d})})))}_initObserverListener(e){const t=e.get(v),r=e.get(ie),o=new D;this.disposeWithMe(r.lifecycle$.subscribe(c=>{if(c!==z.Rendered)return;const l=e.get(S),g=e.get(H);l&&(o.dispose(),o.add(this.registerEventHandler(this.Event.CellClicked,()=>{var a;return(a=l.currentClickedCell$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.location.unitId,n.location.subUnitId);s&&this.fireEvent(this.Event.CellClicked,{...s,...n,row:n.location.row,column:n.location.col})})})),o.add(this.registerEventHandler(this.Event.CellHover,()=>{var a;return(a=l.currentRichText$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.CellHover,{...s,...n,row:n.row,column:n.col})})})),o.add(this.registerEventHandler(this.Event.CellPointerDown,()=>{var a;return(a=l.currentPointerDownCell$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.CellPointerDown,{...s,...n,row:n.row,column:n.col})})})),o.add(this.registerEventHandler(this.Event.CellPointerUp,()=>{var a;return(a=l.currentPointerUpCell$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.CellPointerUp,{...s,...n,row:n.row,column:n.col})})})),o.add(this.registerEventHandler(this.Event.CellPointerMove,()=>{var a;return(a=l.currentCellPosWithEvent$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.CellPointerMove,{...s,...n,row:n.row,column:n.col})})})),o.add(this.registerEventHandler(this.Event.DragOver,()=>{var a;return(a=g.currentCell$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.location.unitId,n.location.subUnitId);s&&this.fireEvent(this.Event.DragOver,{...s,...n,row:n.location.row,column:n.location.col})})})),o.add(this.registerEventHandler(this.Event.Drop,()=>{var a;return(a=g.endCell$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.location.unitId,n.location.subUnitId);s&&this.fireEvent(this.Event.Drop,{...s,...n,row:n.location.row,column:n.location.col})})})),o.add(this.registerEventHandler(this.Event.RowHeaderClick,()=>{var a;return(a=l.currentRowHeaderClick$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.RowHeaderClick,{...s,row:n.index})})})),o.add(this.registerEventHandler(this.Event.RowHeaderPointerDown,()=>{var a;return(a=l.currentRowHeaderPointerDown$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.RowHeaderPointerDown,{...s,row:n.index})})})),o.add(this.registerEventHandler(this.Event.RowHeaderPointerUp,()=>{var a;return(a=l.currentRowHeaderPointerUp$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.RowHeaderPointerUp,{...s,row:n.index})})})),o.add(this.registerEventHandler(this.Event.RowHeaderHover,()=>{var a;return(a=l.currentHoveredRowHeader$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.RowHeaderHover,{...s,row:n.index})})})),o.add(this.registerEventHandler(this.Event.ColumnHeaderClick,()=>{var a;return(a=l.currentColHeaderClick$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.ColumnHeaderClick,{...s,column:n.index})})})),o.add(this.registerEventHandler(this.Event.ColumnHeaderPointerDown,()=>{var a;return(a=l.currentColHeaderPointerDown$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.ColumnHeaderPointerDown,{...s,column:n.index})})})),o.add(this.registerEventHandler(this.Event.ColumnHeaderPointerUp,()=>{var a;return(a=l.currentColHeaderPointerUp$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.ColumnHeaderPointerUp,{...s,column:n.index})})})),o.add(this.registerEventHandler(this.Event.ColumnHeaderHover,()=>{var a;return(a=l.currentHoveredColHeader$)==null?void 0:a.pipe(u(n=>!!n)).subscribe(n=>{const s=this.getSheetTarget(n.unitId,n.subUnitId);s&&this.fireEvent(this.Event.ColumnHeaderHover,{...s,column:n.index})})})),this.disposeWithMe(o))}));let i;const d=se([t.created$,r.lifecycle$]),h=new D;this.disposeWithMe(d.subscribe(([c,l])=>{if(c.type===ae.UNIVER_SHEET&&(i=c),l<=z.Rendered||!i)return;const g=this.getWorkbook(i.unitId);if(!g)return;h.dispose();const a=i.with(U),n=i.with(He);h.add(this.registerEventHandler(this.Event.Scroll,()=>a.validViewportScrollInfo$.subscribe(s=>{s&&this.fireEvent(this.Event.Scroll,{workbook:g,worksheet:g.getActiveSheet(),...s})}))),h.add(this.registerEventHandler(this.Event.SelectionMoveStart,()=>n.selectionMoveStart$.subscribe(s=>{var C;this.fireEvent(this.Event.SelectionMoveStart,{workbook:g,worksheet:g.getActiveSheet(),selections:(C=s?.map(_=>_.range))!=null?C:[]})}))),h.add(this.registerEventHandler(this.Event.SelectionMoving,()=>n.selectionMoving$.subscribe(s=>{var C;this.fireEvent(this.Event.SelectionMoving,{workbook:g,worksheet:g.getActiveSheet(),selections:(C=s?.map(_=>_.range))!=null?C:[]})}))),h.add(this.registerEventHandler(this.Event.SelectionMoveEnd,()=>n.selectionMoveEnd$.subscribe(s=>{var C;this.fireEvent(this.Event.SelectionMoveEnd,{workbook:g,worksheet:g.getActiveSheet(),selections:(C=s?.map(_=>_.range))!=null?C:[]})}))),h.add(this.registerEventHandler(this.Event.SelectionChanged,()=>n.selectionChanged$.subscribe(s=>{var C;this.fireEvent(this.Event.SelectionChanged,{workbook:g,worksheet:g.getActiveSheet(),selections:(C=s?.map(_=>_.range))!=null?C:[]})}))),i=null,this.disposeWithMe(h)}))}_initialize(e){this._initSheetUIEvent(e),this._initObserverListener(e);const t=e.get(I);this.disposeWithMe(this.registerEventHandler(this.Event.BeforeClipboardChange,()=>t.beforeCommandExecuted(r=>{switch(r.id){case L.id:case N.id:this._beforeClipboardChange();break}}))),this.disposeWithMe(this.registerEventHandler(this.Event.ClipboardChanged,()=>t.onCommandExecuted(r=>{switch(r.id){case L.id:case N.id:this._clipboardChanged();break}}))),this.disposeWithMe(this.registerEventHandler(this.Event.BeforeClipboardPaste,()=>t.beforeCommandExecuted(r=>{switch(r.id){case M.id:this._beforeClipboardPaste(r.params);break;case Z.id:this._beforeClipboardPasteAsync();break}}))),this.disposeWithMe(this.registerEventHandler(this.Event.ClipboardPasted,()=>t.onCommandExecuted(r=>{switch(r.id){case M.id:this._clipboardPaste(r.params);break;case Z.id:this._clipboardPasteAsync();break}}))),this.disposeWithMe(this.registerEventHandler(this.Event.SheetSkeletonChanged,()=>t.onCommandExecuted(r=>{if(we.indexOf(r.id)>-1){const o=this.getActiveSheet();if(!o)return;const i=Ce(r,o.worksheet.getMaxColumns()).map(d=>{var h,c;return(c=(h=this.getWorkbook(d.unitId))==null?void 0:h.getSheetBySheetId(d.subUnitId))==null?void 0:c.getRange(d.range)}).filter(Boolean);if(!i.length)return;this.fireEvent(this.Event.SheetSkeletonChanged,{workbook:o.workbook,worksheet:o.worksheet,payload:r,skeleton:o.worksheet.getSkeleton(),effectedRanges:i})}})))}_generateClipboardCopyParam(){const e=this.getActiveWorkbook(),t=e?.getActiveSheet(),r=e?.getActiveRange();if(!e||!t||!r)return;const o=this._injector.get(oe).generateCopyContent(e.getId(),t.getSheetId(),r.getRange());if(!o)return;const{html:i,plain:d}=o;return{workbook:e,worksheet:t,text:d,html:i,fromSheet:t,fromRange:r}}_beforeClipboardChange(){const e=this._generateClipboardCopyParam();if(e&&(this.fireEvent(this.Event.BeforeClipboardChange,e),e.cancel))throw new p}_clipboardChanged(){const e=this._generateClipboardCopyParam();e&&this.fireEvent(this.Event.ClipboardChanged,e)}_generateClipboardPasteParam(e){if(!e)return;const{htmlContent:t,textContent:r}=e,o=this.getActiveWorkbook(),i=o?.getActiveSheet();return!o||!i?void 0:{workbook:o,worksheet:i,text:r,html:t}}async _generateClipboardPasteParamAsync(){const e=this.getActiveWorkbook(),t=e?.getActiveSheet();if(!e||!t)return;const r=(await this._injector.get(ye).read())[0];let o;if(r){const i=r.types,d=i.indexOf(F)!==-1?await r.getType(F).then(c=>c&&c.text()):"",h=i.indexOf(K)!==-1?await r.getType(K).then(c=>c&&c.text()):"";o={workbook:e,worksheet:t,text:d,html:h}}return o}_beforeClipboardPaste(e){const t=this._generateClipboardPasteParam(e);if(t&&(this.fireEvent(this.Event.BeforeClipboardPaste,t),t.cancel))throw new p}_clipboardPaste(e){const t=this._generateClipboardPasteParam(e);if(t&&(this.fireEvent(this.Event.ClipboardPasted,t),t.cancel))throw new p}async _beforeClipboardPasteAsync(){if(!Y()){this._injector.get(P).warn("[Facade]: The navigator object only supports the browser environment");return}const e=await this._generateClipboardPasteParamAsync();if(e&&(this.fireEvent(this.Event.BeforeClipboardPaste,e),e.cancel))throw new p}async _clipboardPasteAsync(){if(!Y()){this._injector.get(P).warn("[Facade]: The navigator object only supports the browser environment");return}const e=await this._generateClipboardPasteParamAsync();if(e&&(this.fireEvent(this.Event.ClipboardPasted,e),e.cancel))throw new p}customizeColumnHeader(e){var t,r;const o=this.getActiveWorkbook();if(!o){console.error("WorkBook not exist");return}const i=o?.getId(),d=this._injector.get(v),h=o.getActiveSheet(),c=h.getSheetId(),l=d.getRenderById(i);l&&(t=e.headerStyle)!=null&&t.size&&(l.with(E).setColumnHeaderSize(l,c,(r=e.headerStyle)==null?void 0:r.size),h?.refreshCanvas()),this._getSheetRenderComponent(i,m.COLUMN).setCustomHeader(e),h?.refreshCanvas()}customizeRowHeader(e){const t=this.getActiveWorkbook();if(!t){console.error("WorkBook not exist");return}const r=t?.getId();this._getSheetRenderComponent(r,m.ROW).setCustomHeader(e)}registerSheetRowHeaderExtension(e,...t){const r=this._getSheetRenderComponent(e,m.ROW),o=r.register(...t);return w(()=>{o.dispose(),r.makeDirty(!0)})}registerSheetColumnHeaderExtension(e,...t){const r=this._getSheetRenderComponent(e,m.COLUMN),o=r.register(...t);return w(()=>{o.dispose(),r.makeDirty(!0)})}registerSheetMainExtension(e,...t){const r=this._getSheetRenderComponent(e,m.MAIN),o=r.register(...t);return w(()=>{o.dispose(),r.makeDirty(!0)})}_getSheetRenderComponent(e,t){const r=this._injector.get(v).getRenderById(e);if(!r)throw new Error(`Render Unit with unitId ${e} not found`);const{components:o}=r,i=o.get(t);if(!i)throw new Error("Render component not found");return i}getSheetHooks(){return this._injector.createInstance($)}pasteIntoSheet(e,t,r){return this._commandService.executeCommand(M.id,{htmlContent:e,textContent:t,files:r})}setProtectedRangeShadowStrategy(e){this._injector.get(B).setProtectedRangeShadowStrategy(e)}getProtectedRangeShadowStrategy(){return this._injector.get(B).getProtectedRangeShadowStrategy()}getProtectedRangeShadowStrategy$(){return this._injector.get(B).getProtectedRangeShadowStrategy$()}setPermissionDialogVisible(e){this._injector.get(de).setShowComponents(e)}}X.extend(xe);class je extends q{openSiderbar(e){return this._logDeprecation("openSiderbar"),this._injector.get(Pe).open(e)}openDialog(e){this._logDeprecation("openDialog");const t=this._injector.get(Ue).open({...e,onClose:()=>{t.dispose()}});return t}customizeColumnHeader(e){const t=this._workbook.getUnitId();this._getSheetRenderComponent(t,m.COLUMN).setCustomHeader(e)}customizeRowHeader(e){const t=this._workbook.getUnitId();this._getSheetRenderComponent(t,m.ROW).setCustomHeader(e)}_getSheetRenderComponent(e,t){const r=this._injector.get(v).getRenderById(e);if(!r)throw new Error(`Render Unit with unitId ${e} not found`);const{components:o}=r,i=o.get(t);if(!i)throw new Error("Render component not found");return i}_logDeprecation(e){this._injector.get(P).warn("[FWorkbook]",`${e} is deprecated. Please use the function of the same name on "FUniver".`)}generateCellParams(e){const t=this.getActiveSheet();return{row:e.row,column:e.col,workbook:this,worksheet:t}}onCellClick(e){const t=this._injector.get(S);return w(t.currentClickedCell$.pipe(u(r=>!!r)).subscribe(r=>{e(r)}))}onCellHover(e){const t=this._injector.get(S);return w(t.currentRichText$.pipe(u(r=>!!r)).subscribe(e))}onCellPointerDown(e){const t=this._injector.get(S);return w(t.currentPointerDownCell$.subscribe(e))}onCellPointerUp(e){const t=this._injector.get(S);return w(t.currentPointerUpCell$.subscribe(e))}onCellPointerMove(e){const t=this._injector.get(S);return w(t.currentCellPosWithEvent$.pipe(u(r=>!!r)).subscribe(r=>{e(r,r.event)}))}onDragOver(e){const t=this._injector.get(H);return w(t.currentCell$.pipe(u(r=>!!r)).subscribe(r=>{e(r)}))}onDrop(e){const t=this._injector.get(H);return w(t.endCell$.pipe(u(r=>!!r)).subscribe(r=>{e(r)}))}startEditing(){const e=this._injector.get(I);return this._injector.get(k).isVisible().visible?!0:e.syncExecuteCommand(f.id,{eventType:O.Dblclick,unitId:this._workbook.getUnitId(),visible:!0})}async endEditing(e){const t=this._injector.get(I);return this._injector.get(k).isVisible().visible&&t.syncExecuteCommand(f.id,{eventType:O.Keyboard,keycode:e?x.ENTER:x.ESC,visible:!1,unitId:this._workbook.getUnitId()}),await he(0),!0}endEditingAsync(e=!0){return this.endEditing(e)}abortEditingAsync(){return this.endEditingAsync(!1)}isCellEditing(){return this._injector.get(k).isVisible().visible}getScrollStateBySheetId(e){const t=this._workbook.getUnitId(),r=this._injector.get(v).getRenderById(t);return r?r.with(U).getScrollStateByParam({unitId:t,sheetId:e}):null}disableSelection(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);return t&&t.with(y).disableSelection(),this}enableSelection(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);return t&&t.with(y).enableSelection(),this}transparentSelection(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);return t&&t.with(y).transparentSelection(),this}showSelection(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);return t&&t.with(y).showSelection(),this}}q.extend(je);class Me extends ee{refreshCanvas(){const e=this._injector.get(v),t=this._fWorkbook.id,r=e.getRenderById(t);if(!r)throw new Error(`Render Unit with unitId ${t} not found`);r.with(E).reCalculate();const o=r.mainComponent;if(!o)throw new Error("Main component not found");return o.makeDirty(),this}highlightRanges(e,t,r){const o=this._injector.get(ne),i=[];for(const d of e){const h=d.getRange(),c=o.addShapeWithNoFresh({range:h,style:t,primary:r});c&&i.push(c)}if(o.refreshShapes(),i.length===0)throw new Error("Failed to highlight current range");return w(()=>{i.forEach(d=>{o.removeShape(d)})})}zoom(e){const t=this._injector.get(I),r=Math.min(Math.max(e,.1),4);return t.executeCommand(T.id,{unitId:this._workbook.getUnitId(),subUnitId:this._worksheet.getSheetId(),zoomRatio:r}),this}getZoom(){return this._worksheet.getZoomRatio()}getVisibleRange(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);if(!t)return null;const r=t.with(E).getCurrentSkeleton();return r?r.getVisibleRangeByViewport(Q.VIEW_MAIN):null}getVisibleRangesOfAllViewports(){const e=this._workbook.getUnitId(),t=this._injector.get(v).getRenderById(e);if(!t)return null;const r=t.with(E).getCurrentSkeleton();return r?r.getVisibleRanges():null}scrollToCell(e,t,r){const o=this._workbook.getUnitId(),i=this._injector.get(v).getRenderById(o);return i&&(i?.with(be)).scrollToCell(e,t,r),this}getScrollState(){const e={offsetX:0,offsetY:0,sheetViewStartColumn:0,sheetViewStartRow:0},t=this._workbook.getUnitId(),r=this._worksheet.getSheetId(),o=this._injector.get(v).getRenderById(t);return o&&o.with(U).getScrollStateByParam({unitId:t,sheetId:r})||e}onScroll(e){var t;const r=this._workbook.getUnitId(),o=(t=this._injector.get(v).getRenderById(r))==null?void 0:t.with(U);if(o){const i=o.validViewportScrollInfo$.subscribe(d=>{e(d)});return w(i)}return w(()=>{})}getSkeleton(){var e,t;const r=(e=this._injector.get(v).getRenderById(this._workbook.getUnitId()))==null?void 0:e.with(E);return(t=r?.getWorksheetSkeleton(this._worksheet.getSheetId()))==null?void 0:t.skeleton}autoResizeColumn(e){return this.autoResizeColumns(e,1)}autoResizeColumns(e,t){const r=this._workbook.getUnitId(),o=this._worksheet.getSheetId(),i=[{startColumn:e,endColumn:e+t-1,startRow:0,endRow:this._worksheet.getRowCount()-1}];return this._commandService.syncExecuteCommand(me.id,{unitId:r,subUnitId:o,ranges:i}),this}setColumnAutoWidth(e,t){return this.autoResizeColumns(e,t)}autoResizeRows(e,t){const r=this._workbook.getUnitId(),o=this._worksheet.getSheetId(),i=[{startRow:e,endRow:e+t-1,startColumn:0,endColumn:this._worksheet.getColumnCount()-1}];return this._commandService.syncExecuteCommand(pe.id,{unitId:r,subUnitId:o,ranges:i}),this}customizeColumnHeader(e){var t,r;const o=this._workbook.getUnitId(),i=this._worksheet.getSheetId(),d=this._injector.get(v).getRenderById(o);d&&(t=e.headerStyle)!=null&&t.size&&d.with(E).setColumnHeaderSize(d,i,(r=e.headerStyle)==null?void 0:r.size),this._getSheetRenderComponent(o,m.COLUMN).setCustomHeader(e,i)}customizeRowHeader(e){var t,r;const o=this._workbook.getUnitId(),i=this._worksheet.getSheetId(),d=this._injector.get(v).getRenderById(o);d&&(t=e.headerStyle)!=null&&t.size&&d.with(E).setRowHeaderSize(d,i,(r=e.headerStyle)==null?void 0:r.size),this._getSheetRenderComponent(o,m.ROW).setCustomHeader(e,i)}setColumnHeaderHeight(e){const t=this._workbook.getUnitId(),r=this._worksheet.getSheetId();return this._commandService.executeCommand(Ee.id,{unitId:t,subUnitId:r,size:e}),this}setRowHeaderWidth(e){const t=this._workbook.getUnitId(),r=this._worksheet.getSheetId();return this._commandService.executeCommand(ke.id,{unitId:t,subUnitId:r,size:e}),this}_getSheetRenderComponent(e,t){const r=this._injector.get(v).getRenderById(e);if(!r)throw new Error(`Render Unit with unitId ${e} not found`);const{components:o}=r,i=o.get(t);if(!i)throw new Error("Render component not found");return i}}ee.extend(Me);class Be extends te{setPermissionDialogVisible(e){this._permissionService.setShowComponents(e)}}te.extend(Be);class De extends ${onCellPointerMove(e){return w(this._injector.get(S).currentPosition$.subscribe(e))}onCellPointerOver(e){return w(this._injector.get(S).currentCell$.subscribe(e))}onCellDragOver(e){return w(this._injector.get(H).currentCell$.subscribe(e))}onCellDrop(e){return w(this._injector.get(H).endCell$.subscribe(e))}onCellRender(e,t=le.Style,r=Se.DATA_VALIDATION){return this._injector.get(fe).intercept(_e.CELL_CONTENT,{effect:t,handler:(o,i,d)=>(o&&!o.customRender&&e&&(o.customRender=[...e]),d(o)),priority:r})}onBeforeCellEdit(e){return this._injector.get(I).beforeCommandExecuted(t=>{const r=t.params;t.id===f.id&&r.visible&&e(r)})}onAfterCellEdit(e){return this._injector.get(I).onCommandExecuted(t=>{const r=t.params;t.id===f.id&&!r.visible&&e(r)})}}$.extend(De);const R={CellClicked:"CellClicked",CellPointerDown:"CellPointerDown",CellPointerUp:"CellPointerUp",CellPointerMove:"CellPointerMove",CellHover:"CellHover"};class Te{get BeforeClipboardChange(){return"BeforeClipboardChange"}get ClipboardChanged(){return"ClipboardChanged"}get BeforeClipboardPaste(){return"BeforeClipboardPaste"}get ClipboardPasted(){return"ClipboardPasted"}get BeforeSheetEditStart(){return"BeforeSheetEditStart"}get SheetEditStarted(){return"SheetEditStarted"}get SheetEditChanging(){return"SheetEditChanging"}get BeforeSheetEditEnd(){return"BeforeSheetEditEnd"}get SheetEditEnded(){return"SheetEditEnded"}get CellClicked(){return R.CellClicked}get CellHover(){return R.CellHover}get CellPointerDown(){return R.CellPointerDown}get CellPointerUp(){return R.CellPointerUp}get CellPointerMove(){return R.CellPointerMove}get DragOver(){return"DragOver"}get Drop(){return"Drop"}get Scroll(){return"Scroll"}get SelectionMoveStart(){return"SelectionMoveStart"}get SelectionChanged(){return"SelectionChanged"}get SelectionMoving(){return"SelectionMoving"}get SelectionMoveEnd(){return"SelectionMoveEnd"}get RowHeaderClick(){return"RowHeaderClick"}get RowHeaderPointerDown(){return"RowHeaderPointerDown"}get RowHeaderPointerUp(){return"RowHeaderPointerUp"}get RowHeaderHover(){return"RowHeaderHover"}get ColumnHeaderClick(){return"ColumnHeaderClick"}get ColumnHeaderPointerDown(){return"ColumnHeaderPointerDown"}get ColumnHeaderPointerUp(){return"ColumnHeaderPointerUp"}get ColumnHeaderHover(){return"ColumnHeaderHover"}get SheetSkeletonChanged(){return"SheetSkeletonChanged"}get BeforeSheetZoomChange(){return"BeforeSheetZoomChange"}get SheetZoomChanged(){return"SheetZoomChanged"}}ge.extend(Te);class $e{get SHEET_VIEWPORT_KEY(){return Q}}ue.extend($e);class Ae extends re{getCell(){var e;const t=this._injector.get(v),r=this._injector.get(P),o=this._workbook.getUnitId(),i=this._worksheet.getSheetId(),d=t.getRenderById(o),h=(e=d?.with(E).getSkeletonParam(i))==null?void 0:e.skeleton;if(!h)throw r.error("[Facade]: `FRange.getCell` can only be called in current worksheet"),new Error("`FRange.getCell` can only be called in current worksheet");return h.getCellWithCoordByIndex(this._range.startRow,this._range.startColumn)}getCellRect(){const{startX:e,startY:t,endX:r,endY:o}=this.getCell(),i={x:e,y:t,width:r-e,height:o-t,top:t,left:e,bottom:o,right:r};return{...i,toJSON:()=>JSON.stringify(i)}}generateHTML(){var e;const t=this._injector.get(oe).generateCopyContent(this._workbook.getUnitId(),this._worksheet.getSheetId(),this._range);return(e=t?.html)!=null?e:""}attachPopup(e){var t,r,o;e.direction=(t=e.direction)!=null?t:"horizontal",e.extraProps=(r=e.extraProps)!=null?r:{},e.offset=(o=e.offset)!=null?o:[0,0];const{key:i,disposableCollection:d}=G(e,this._injector.get(J)),h=this._injector.get(V).attachPopupToCell(this._range.startRow,this._range.startColumn,{...e,componentKey:i},this.getUnitId(),this._worksheet.getSheetId());return h?(d.add(h),d):(d.dispose(),null)}attachAlertPopup(e){const t=this._injector.get(Ie),r={workbook:this._workbook,worksheet:this._worksheet,row:this._range.startRow,col:this._range.startColumn,unitId:this.getUnitId(),subUnitId:this._worksheet.getSheetId()};return t.showAlert({...e,location:r}),{dispose:()=>{t.removeAlert(e.key)}}}attachRangePopup(e){var t,r,o;e.direction=(t=e.direction)!=null?t:"top-center",e.extraProps=(r=e.extraProps)!=null?r:{},e.offset=(o=e.offset)!=null?o:[0,0];const{key:i,disposableCollection:d}=G(e,this._injector.get(J)),h=this._injector.get(V).attachRangePopup(this._range,{...e,componentKey:i},this.getUnitId(),this._worksheet.getSheetId());return h?(d.add(h),d):(d.dispose(),null)}highlight(e,t){const r=this._injector.get(ne),o=r.addShape({range:this._range,style:e,primary:t});if(!o)throw new Error("Failed to highlight current range");return w(()=>{r.removeShape(o)})}showDropdown(e){return this._injector.get(Re).showDropdown(e)}}re.extend(Ae);function G(b,e){const{componentKey:t,isVue3:r}=b;let o;const i=new D;return typeof t=="string"?o=t:(o=`External_${ce(6)}`,i.add(e.register(o,t,{framework:r?"vue3":"react"}))),{key:o,disposableCollection:i}}export{G as J};
