import{a as _e}from"./chunk-VZNWI3XM.js";import{e as J}from"./chunk-HUQBVWNM.js";import{a as qe,b as C}from"./chunk-2WANWINX.js";import{d as Ue,l as Ke,m as Qe}from"./chunk-2RZGI2GI.js";import{b as ue}from"./chunk-5OA3UTKR.js";import{a as Ve}from"./chunk-PSHPNFJ6.js";import"./chunk-EST3G7IM.js";import{a as Pe,b as fe}from"./chunk-TNLJ7CAF.js";import{a as ce}from"./chunk-DXCWD2WZ.js";import{B as H,D as X,J as Z,K as z,j as me,k as $,r as Le,s as Ge,w as De}from"./chunk-VNAU6AHI.js";import"./chunk-2GYG6N64.js";import{a as K,b as Q}from"./chunk-YTVNRIZ3.js";import"./chunk-3XAX4OT5.js";import{ca as Oe,ja as Be,ma as de,na as j}from"./chunk-NF46UI75.js";import{p as Ae,t as q,u as U}from"./chunk-SIUWMJOE.js";import"./chunk-GTE6R5NX.js";import{c as Re}from"./chunk-FGSJTZPD.js";import"./chunk-73F4PDV3.js";import{A as V,D as P,c as R,e as I,h as A,i as B,o as L,r as G,s as pe,t as se,u as D,z as Ne}from"./chunk-TMWBOQE5.js";import{$b as be,Ab as c,Ac as d,B as Ee,Bb as Ce,Cc as Fe,Dc as ae,Ea as b,Gd as y,Ha as xe,Hd as ye,Jd as N,Kb as a,Lb as r,Mb as _,Na as w,Oa as k,Pa as ne,Pc as W,Qb as x,Tb as h,Vb as g,Yb as E,Yc as le,Zc as F,_b as we,a as te,ac as Y,b as ie,bc as ee,gc as p,hc as T,ib as i,ic as u,jc as Me,jd as O,pc as We,rc as M,sc as re,wb as f,za as S,zb as oe,zc as s}from"./chunk-EOQA7B6X.js";var $e=(()=>{class t{transform(e,n,o){if(o===0||n.length>0&&n[0]?.id)return e;let l=[];return n.forEach((v,Se)=>{o>Se&&(v.fromStepId&&!l.find(he=>he===v.fromStepId)&&l.push(v.fromStepId),v.toStepId&&!l.find(he=>he===v.toStepId)&&l.push(v.toStepId))}),e.filter(v=>l.find(Se=>Se===v.id))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=xe({name:"filter_workflow_step",type:t,pure:!0,standalone:!0})}}return t})();function Te(){return t=>{let m=t.get("fromStepId")?.value,e=t.get("toStepId")?.value;return m&&e&&m===e?{sameStep:!0}:null}}function Ie(){return t=>{let m=t.get("roleIds")?.value,e=t.get("userIds")?.value;return(!m||m?.length===0)&&(!e||e?.length===0)?{atLeastOneRequired:!0}:null}}var it=["graph"],nt=()=>({orientation:"TB"});function ot(t,m){t&1&&(a(0,"span",25),p(1),s(2,"translate"),_(3,"app-page-help-text",26),r()),t&2&&(i(),u("",d(2,1,"ADD_WORKFLOW_TRANSITIONS")," "))}function rt(t,m){t&1&&(a(0,"span",25),p(1),s(2,"translate"),_(3,"app-page-help-text",26),r()),t&2&&(i(),u("",d(2,1,"EDIT_WORKFLOW_TRANSITIONS")," "))}function at(t,m){t&1&&(a(0,"div",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"TRANSITION_NAME_REQUIRED")," "))}function lt(t,m){t&1&&(a(0,"div",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"TRANSITION_NAME_MUST_BE_UNIQUE")," "))}function pt(t,m){if(t&1&&(a(0,"div"),f(1,at,3,3,"div",51)(2,lt,3,3,"div",51),r()),t&2){let e,n=g().$implicit;i(),c("ngIf",(e=n.get("name").errors)==null?null:e.required),i(),c("ngIf",n.get("name").hasError("notUnique"))}}function st(t,m){if(t&1&&(a(0,"mat-option",53),p(1),r()),t&2){let e=m.$implicit;c("value",e.id),i(),u(" ",e.name," ")}}function mt(t,m){t&1&&(a(0,"div",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"FROM_STEP_REQUIRED")," "))}function dt(t,m){t&1&&(a(0,"mat-error"),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"FROM_TO_STEP_NOT_SAME")," "))}function ct(t,m){if(t&1&&(a(0,"div"),f(1,mt,3,3,"div",51)(2,dt,3,3,"mat-error",32),r()),t&2){let e,n=g().$implicit;i(),c("ngIf",(e=n.get("fromStepId").errors)==null?null:e.required),i(),c("ngIf",n==null?null:n.hasError("sameStep"))}}function ut(t,m){if(t&1&&(a(0,"mat-option",53),p(1),r()),t&2){let e=m.$implicit;c("value",e.id),i(),u("",e.name," ")}}function ft(t,m){t&1&&(a(0,"div",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"TO_STEP_REQUIRED")," "))}function _t(t,m){t&1&&(a(0,"div",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"FROM_TO_STEP_NOT_SAME")," "))}function gt(t,m){if(t&1&&(a(0,"div"),f(1,ft,3,3,"div",51)(2,_t,3,3,"div",51),r()),t&2){let e,n=g().$implicit;i(),c("ngIf",(e=n.get("toStepId").errors)==null?null:e.required),i(),c("ngIf",n.hasError("sameStep"))}}function vt(t,m){if(t&1&&(a(0,"mat-option",53),p(1),r()),t&2){let e=m.$implicit;c("value",e.id),i(),u(" ",e.name," ")}}function St(t,m){if(t&1&&(a(0,"mat-option",53),p(1),r()),t&2){let e=m.$implicit;c("value",e.id),i(),Me(" ",e.firstName," ",e.lastName," ")}}function ht(t,m){if(t&1){let e=x();a(0,"button",54),h("click",function(){w(e);let o=g().index,l=g();return k(l.removeTransition(o))}),a(1,"mat-icon"),p(2,"delete"),r()()}}function wt(t,m){t&1&&(a(0,"mat-error",52),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"AT_LEAST_ONE_REQUIRED")," "))}function kt(t,m){if(t&1){let e=x();a(0,"div",27)(1,"div",28)(2,"div",11)(3,"div",29)(4,"div",30)(5,"label"),p(6),s(7,"translate"),r(),a(8,"input",31),s(9,"translate"),h("blur",function(o){w(e);let l=g();return k(l.onTransitionChange(o))})("blur",function(){let o=w(e).index,l=g();return k(l.checkUniqueTransitionName(o))}),r(),f(10,pt,3,2,"div",32),r()(),a(11,"div",29)(12,"div",30),We(13),s(14,"filter_workflow_step"),a(15,"label"),p(16),s(17,"translate"),r(),a(18,"mat-select",33),s(19,"translate"),h("selectionChange",function(){let o=w(e).index,l=g();return k(l.filterSteps(o))}),f(20,st,2,2,"mat-option",34),r(),f(21,ct,3,2,"div",32),r()(),a(22,"div",29)(23,"div",30)(24,"label"),p(25),s(26,"translate"),r(),a(27,"mat-select",35),s(28,"translate"),h("selectionChange",function(){let o=w(e).index,l=g();return k(l.filterSteps(o))}),f(29,ut,2,2,"mat-option",34),r(),f(30,gt,3,2,"div",32),r()()(),a(31,"div",11)(32,"div",36)(33,"div",30)(34,"label"),p(35),s(36,"translate"),r(),a(37,"mat-select",37),s(38,"translate"),f(39,vt,2,2,"mat-option",34),r()()(),a(40,"div",36)(41,"div",30)(42,"label"),p(43),s(44,"translate"),r(),a(45,"mat-select",38),s(46,"translate"),f(47,St,2,3,"mat-option",34),r()()()(),a(48,"div",11)(49,"div",39)(50,"div",40)(51,"label"),p(52),s(53,"translate"),r(),a(54,"mat-button-toggle-group",41)(55,"mat-button-toggle",42),p(56),s(57,"translate"),r(),a(58,"mat-button-toggle",43),p(59),s(60,"translate"),r(),a(61,"mat-button-toggle",44),p(62),s(63,"translate"),r(),a(64,"mat-button-toggle",45),p(65),s(66,"translate"),r(),a(67,"mat-button-toggle",46),p(68),s(69,"translate"),r(),a(70,"mat-button-toggle",47),p(71),s(72,"translate"),r(),a(73,"mat-button-toggle",48),p(74),s(75,"translate"),r(),a(76,"mat-button-toggle",49),p(77),s(78,"translate"),r()()()()(),a(79,"div",11)(80,"div",39)(81,"div",30),f(82,ht,3,0,"button",50),r()(),f(83,wt,3,3,"mat-error",51),r()()()}if(t&2){let e=m.$implicit,n=m.index,o=g();c("formGroupName",n),i(6),u(" ",d(7,29,"TRANSITION_NAME"),""),i(2),E("placeholder",d(9,31,"WORKFLOW_TRANSITION_NAME")),i(2),c("ngIf",e.get("name").touched&&e.get("name").errors);let l=Fe(14,33,o.workflowSteps,o.transitions.value,n);i(6),T(d(17,37,"FROM_STEP")),i(2),E("placeholder",d(19,39,"SELECT_FROM_STEP")),i(2),c("ngForOf",l),i(),c("ngIf",e.get("fromStepId").touched&&e.get("fromStepId").errors),i(4),T(d(26,41,"TO_STEP")),i(2),E("placeholder",d(28,43,"SELECT_TO_STEP")),i(2),c("ngForOf",o.workflowSteps),i(),c("ngIf",e.get("toStepId").touched&&(e.get("toStepId").errors||e.errors)),i(5),u(" ",d(36,45,"ROLES"),""),i(2),E("placeholder",d(38,47,"SELECT_ROLE")),i(2),c("ngForOf",o.workflowStore.roles()),i(4),u(" ",d(44,49,"USERS"),""),i(2),E("placeholder",d(46,51,"SELECT_USERS")),i(2),c("ngForOf",o.workflowStore.users()),i(5),T(d(53,53,"COLOR_OF_TRANSITON_BUTTON")),i(4),u("",d(57,55,"APPROVED")," "),i(3),u("",d(60,57,"REJECTED")," "),i(3),u("",d(63,59,"PENDING")," "),i(3),u("",d(66,61,"INPROGRESS")," "),i(3),u("",d(69,63,"ONHOLD")," "),i(3),u("",d(72,65,"CANCELLED")," "),i(3),u("",d(75,67,"ESCALATED")," "),i(3),u("",d(78,69,"COMPLETED")," "),i(5),c("ngIf",!((o.workflowTransitions==null?null:o.workflowTransitions.length)>0)),i(),c("ngIf",(e.get("roleIds").touched||e.get("userIds").touched)&&(e==null?null:e.hasError("atLeastOneRequired")))}}function Tt(t,m){if(t&1){let e=x();a(0,"div",55)(1,"button",56),h("click",function(){w(e);let o=g();return k(o.addTransition(!0))}),_(2,"i-feather",57),p(3),s(4,"translate"),r()()}t&2&&(i(3),u(" ",d(4,1,"ADD_ANOTHER_TRANSITION")," "))}function It(t,m){t&1&&(ne(),a(0,"marker",58),_(1,"path",59),r())}function Et(t,m){if(t&1&&(ne(),a(0,"g",60),_(1,"rect"),a(2,"text",61),p(3),r()()),t&2){let e=m.$implicit;i(),oe("width",e.dimension.width)("height",e.dimension.height)("fill",e.data.color),i(),oe("x",10)("y",e.dimension.height/2),i(),u(" ",e.label," ")}}function xt(t,m){if(t&1&&(ne(),a(0,"g",62),_(1,"path",63),a(2,"text",64)(3,"textPath",65),p(4),r()()()),t&2){let e=m.$implicit;i(3),Ce("dominant-baseline",e.dominantBaseline),oe("href","#"+e.id),i(),u(" ",e.label," ")}}var ge=(()=>{class t{constructor(){this.fb=S(V),this.workflowStore=S(C),this.clonerService=S(Re),this.router=S(y),this.currentStep=2,this.nodes=[],this.links=[],this.curve=Ue,this.currentWorkflow=this.workflowStore.currentWorkflow(),this.workflowSteps=this.currentWorkflow?.workflowSteps,this.workflowTransitions=this.currentWorkflow?.transitions,W(()=>{let e=this.workflowStore.currentStep();e!==this.currentStep&&(this.currentStep=e,e===1?this.onPreviousClick():this.goToWorkflow())},{allowSignalWrites:!0})}get transitions(){return this.transitionFormGroup.get("transitions")}goToWorkflow(){this.router.navigate(["/workflow-settings"])}ngOnInit(){if(this.nodes=this.workflowSteps.map(e=>({id:e.id,label:e.name,data:e})),this.transitionFormGroup=this.fb.group({transitions:this.fb.array([])}),this.workflowTransitions&&this.workflowTransitions?.length===0)this.initialTransition();else{for(let e=0;e<this.workflowTransitions.length;e++)this.addTransition(!1,this.workflowTransitions[e]);this.addAllLink()}}ngAfterViewInit(){setTimeout(()=>{this.graph&&this.graph?.zoomToFit()})}checkUniqueTransitionName(e){let n=this.transitions.at(e).get("name").value;if(this.transitions.controls.some((l,v)=>v!==e&&l.get("name").value===n))this.transitions.at(e).get("name").setErrors({notUnique:!0});else{let l=this.transitions.at(e).get("name").errors;l&&(delete l.notUnique,Object.keys(l).length===0?this.transitions.at(e).get("name").setErrors(null):this.transitions.at(e).get("name").setErrors(l))}}filterSteps(e){this.removeFormItem(e),this.addAllLink()}removeFormItem(e){if(e==this.transitions.length-1)return;let n=this.transitions.length;for(let o=e+1;o<n;o++)this.transitions.removeAt(e+1)}addAllLink(){let e=this.transitions.getRawValue().filter(n=>n.fromStepId&&n.toStepId&&n.name);e.length>0&&(this.links=this.clonerService.deepClone(e.map(n=>({source:n.fromStepId,target:n.toStepId,label:n.name}))))}initialTransition(){this.transitions.push(this.fb.group({id:[null],name:["",I.required],fromStepId:["",I.required],toStepId:["",I.required],isFirstTransaction:[!0],workflowId:[null],color:["inprogress"],roleIds:[[]],userIds:[[]],orderNo:[0]},{validators:[Te(),Ie()]}))}onTransitionChange(e){this.addAllLink()}addTransition(e,n){!e||this.transitions.valid?this.transitions.push(this.fb.group({id:[n?.id||null],name:[n?.name||"",I.required],fromStepId:[{value:n?.fromStepId||"",disabled:!!n?.id},[I.required]],toStepId:[{value:n?.toStepId||"",disabled:!!n?.id},[I.required]],isFirstTransaction:[n?.isFirstTransaction||!1],workflowId:[this.currentWorkflow?.id||null],color:[n?.color||"inprogress"],orderNo:[n?.orderNo||0],roleIds:[n?.workflowTransitionRoles.map(o=>o.roleId)||[]],userIds:[n?.workflowTransitionUsers.map(o=>o.userId)||[]]},{validators:[Te(),Ie()]})):this.transitionFormGroup.markAllAsTouched()}removeTransition(e){this.removeFormItem(e),this.transitions.removeAt(e),this.transitions.length===0&&this.initialTransition(),this.addAllLink()}saveTransition(){if(this.transitionFormGroup.invalid){this.transitionFormGroup.markAllAsTouched();return}let e=this.transitions.getRawValue().map(n=>ie(te({},n),{workflowId:this.currentWorkflow.id}));for(let n=0;n<e.length;n++)e[n].orderNo=n;e[0].id?(e[0].isFirstTransaction=!0,this.workflowStore.updateWorkflowTransition(e)):this.workflowStore.addWorkflowTransition(e)}onPreviousClick(){this.workflowStore.setCurrentStep(1),this.router.navigate(["/workflow-settings/manage/manage-steps"])}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-manage-transition"]],viewQuery:function(n,o){if(n&1&&be(it,5),n&2){let l;Y(l=ee())&&(o.graph=l.first)}},standalone:!0,features:[M],decls:35,vars:20,consts:[["graph",""],["defsTemplate",""],["nodeTemplate",""],["linkTemplate",""],[1,"content"],[1,"container-fluid"],[1,"row","align-items-center"],[1,"col-md-6","mb-2"],["class","mb-0 page-title",4,"ngIf"],[1,"card"],[1,"body"],[1,"row"],[1,"col-sm-9"],[3,"formGroup"],["formArrayName","transitions"],[1,"col-sm-12"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","d-flex mb-2",4,"ngIf"],[1,"m-top-10","col-md-12"],["cdkFocusInitial","",1,"btn","btn-success","btn-sm","me-2",3,"click"],["name","save",1,"small-icon"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],["name","arrow-left",1,"small-icon"],[1,"col-sm-3"],[1,"chart-container",3,"layoutSettings","links","nodes","layout","curve","panOnZoom","autoCenter","autoZoom"],[1,"mb-0","page-title"],["code","MANAGE_WORKFLOW"],[3,"formGroupName"],[1,"card","p-2","mb-1",2,"border","1px solid #d3d4d6"],[1,"col-md-4"],[1,"form-group"],["formControlName","name","type","text",1,"form-control",3,"blur","placeholder"],[4,"ngIf"],["panelClass","mat-select-control","formControlName","fromStepId",1,"form-control",3,"selectionChange","placeholder"],[3,"value",4,"ngFor","ngForOf"],["panelClass","mat-select-control","formControlName","toStepId",1,"form-control",3,"selectionChange","placeholder"],[1,"col-md-6"],["panelClass","mat-select-control","multiple","","formControlName","roleIds","name","role",1,"form-control",3,"placeholder"],["panelClass","mat-select-control","multiple","","formControlName","userIds","name","user",1,"form-control",3,"placeholder"],[1,"col-md-12"],[1,"d-flex","flex-column"],["appearance","standard","formControlName","color",1,"custom-toggle-group"],["value","approved",1,"approved"],["value","rejected",1,"rejected"],["value","pending",1,"pending"],["value","inprogress",1,"inprogress"],["value","onhold",1,"onhold"],["value","cancelled",1,"cancelled"],["value","escalated",1,"escalated"],["value","completed",1,"completed"],["type","button","mat-icon-button","","color","warn",3,"click",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[3,"value"],["type","button","mat-icon-button","","color","warn",3,"click"],[1,"d-flex","mb-2"],["type","button",1,"btn","btn-success","btn-sm","me-2",3,"click"],["name","plus",1,"small-icon"],["id","arrow","viewBox","0 -5 10 10","refX","8","refY","0","markerWidth","4","markerHeight","4","orient","auto"],["d","M0,-5L10,0L0,5",1,"arrow-head"],[1,"node"],["alignment-baseline","central"],[1,"edge"],["stroke-width","2","marker-end","url(#arrow)",1,"line"],["text-anchor","middle",1,"edge-label"],["startOffset","50%",1,"text-path"]],template:function(n,o){if(n&1){let l=x();a(0,"section",4)(1,"div",5)(2,"div",6)(3,"div",7),f(4,ot,4,3,"span",8)(5,rt,4,3,"span",8),r()(),a(6,"div",9)(7,"div",10)(8,"div",11)(9,"div",12)(10,"form",13)(11,"div",14)(12,"div",11)(13,"div",15),f(14,kt,84,71,"div",16)(15,Tt,5,3,"div",17),r()()(),a(16,"div",18)(17,"button",19),h("click",function(){return w(l),k(o.saveTransition())}),_(18,"i-feather",20),p(19),s(20,"translate"),r(),a(21,"button",21),h("click",function(){return w(l),k(o.onPreviousClick())}),_(22,"i-feather",22),p(23),s(24,"translate"),r()()()(),a(25,"div",23)(26,"ngx-graph",24,0),p(28,` [layout]="'dagreCluster'"> `),f(29,It,2,0,"ng-template",null,1,ae)(31,Et,4,6,"ng-template",null,2,ae)(33,xt,5,4,"ng-template",null,3,ae),r()()()()()()()}n&2&&(i(4),c("ngIf",!((o.workflowTransitions==null?null:o.workflowTransitions.length)>0)),i(),c("ngIf",(o.workflowTransitions==null?null:o.workflowTransitions.length)>0),i(5),c("formGroup",o.transitionFormGroup),i(4),c("ngForOf",o.transitions.controls),i(),c("ngIf",!((o.workflowTransitions==null?null:o.workflowTransitions.length)>0)),i(4),u(" ",d(20,15,"SAVE")," "),i(4),u(" ",d(24,17,"PREVIOUS")," "),i(3),c("layoutSettings",re(19,nt))("links",o.links)("nodes",o.nodes)("layout","dagre")("curve",o.curve)("panOnZoom",!0)("autoCenter",!0)("autoZoom",!0))},dependencies:[O,le,F,N,P,L,R,A,B,G,D,pe,se,U,q,j,de,J,H,De,X,$,me,fe,Pe,Oe,Q,K,z,Le,Ge,Z,Qe,Ke,$e,ue],styles:[".mat-button-toggle.approved{color:#28a745!important;background-color:#28a745!important}  .mat-button-toggle.rejected{color:#dc3545!important;background-color:#dc3545!important}  .mat-button-toggle.pending{color:#ffc107!important;background-color:#ffc107!important}  .mat-button-toggle.inprogress{color:#6777ef!important;background-color:#6777ef!important}  .mat-button-toggle.onhold{color:#6c757d!important;background-color:#6c757d!important}  .mat-button-toggle.cancelled{color:#343a40!important;background-color:#343a40!important}  .mat-button-toggle.escalated{color:#fd7e14!important;background-color:#fd7e14!important}  .mat-button-toggle.completed{color:#198754!important;background-color:#198754!important}  .custom-toggle-group mat-button-toggle{min-width:60px;height:30px;font-size:8px}  .mat-button-toggle .mat-pseudo-checkbox{margin-top:-20px!important}"]})}}return t})();function Ct(t,m){t&1&&(a(0,"span",16),p(1),s(2,"translate"),_(3,"app-page-help-text",17),r()),t&2&&(i(),T(d(2,1,"ADD_WORKFLOW_STEP")))}function bt(t,m){t&1&&(a(0,"span",16),p(1),s(2,"translate"),_(3,"app-page-help-text",17),r()),t&2&&(i(),T(d(2,1,"EDIT_WORKFLOW_STEP")))}function Mt(t,m){t&1&&(a(0,"div",26),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"STEP_NAME_IS_REQUIRED")," "))}function Wt(t,m){t&1&&(a(0,"div",26),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"STEP_NAME_MUST_BE_UNIQUE")," "))}function Ft(t,m){if(t&1&&(a(0,"div"),f(1,Mt,3,3,"div",25)(2,Wt,3,3,"div",25),r()),t&2){let e,n,o=g().$implicit;i(),c("ngIf",(e=o.get("name").errors)==null?null:e.required),i(),c("ngIf",(n=o.get("name").errors)==null?null:n.notUnique)}}function Ot(t,m){if(t&1){let e=x();a(0,"button",27),h("click",function(){w(e);let o=g(2);return k(o.addStep(!1))}),_(1,"i-feather",28),p(2),s(3,"translate"),r()}t&2&&(i(2),u(" ",d(3,1,"ADD_ANOTHER_STEP")," "))}function yt(t,m){if(t&1){let e=x();a(0,"div",29)(1,"div",20)(2,"button",30),h("click",function(){w(e);let o=g().index,l=g();return k(l.removeStep(o))}),a(3,"mat-icon"),p(4,"delete"),r()()()()}}function Nt(t,m){if(t&1){let e=x();a(0,"div",18)(1,"div",7)(2,"div",19)(3,"div",20)(4,"label"),p(5),s(6,"translate"),r(),a(7,"input",21),s(8,"translate"),h("blur",function(){let o=w(e).index,l=g();return k(l.checkUniqueStepName(o))}),r(),f(9,Ft,3,2,"div",22),r(),f(10,Ot,4,3,"button",23),r(),f(11,yt,5,0,"div",24),r()()}if(t&2){let e=m.$implicit,n=m.index,o=m.last,l=g();c("formGroupName",n),i(5),u(" ",d(6,6,"STEP_NAME"),""),i(2),E("placeholder",d(8,8,"WORKFLOW_STEP_NAME")),i(2),c("ngIf",e.get("name").touched&&e.get("name").errors),i(),c("ngIf",!(l.currentWorkflow!=null&&l.currentWorkflow.isWorkflowSetup)&&o),i(),c("ngIf",l.steps.length>2&&!(l.currentWorkflow!=null&&l.currentWorkflow.isWorkflowSetup))}}var ve=(()=>{class t{get steps(){return this.stepFormGroup.get("steps")}constructor(){this.fb=S(V),this.workflowStore=S(C),this.toastrService=S(Ae),this.translationService=S(Be),this.router=S(y),this.currentStep=1,this.currentWorkflow=this.workflowStore.currentWorkflow(),this.workflowSteps=this.currentWorkflow?.workflowSteps,this.isWorkflowSetup=this.currentWorkflow?.isWorkflowSetup,W(()=>{let e=this.workflowStore.currentStep();e!==this.currentStep&&(this.currentStep=e,e===0?this.onPreviousClick():this.goToWorkflowTransitions())},{allowSignalWrites:!0})}ngOnInit(){this.createStepFormGroup(),this.workflowSteps&&this.workflowSteps?.length===0?(this.addStep(this.currentWorkflow.isWorkflowSetup,null),this.addStep(this.currentWorkflow.isWorkflowSetup,null)):this.workflowSteps.forEach(e=>{this.addStep(this.currentWorkflow.isWorkflowSetup,e)})}goToWorkflowTransitions(){this.router.navigate(["/workflow-settings/manage/manage-transitions"])}checkUniqueStepName(e){let n=this.steps.at(e).get("name").value;if(this.steps.controls.some((l,v)=>v!==e&&l.get("name").value===n))this.steps.at(e).get("name").setErrors({notUnique:!0});else{let l=this.steps.at(e).get("name").errors;l&&(delete l.notUnique,Object.keys(l).length===0?this.steps.at(e).get("name").setErrors(null):this.steps.at(e).get("name").setErrors(l))}}createStepFormGroup(){this.stepFormGroup=this.fb.group({steps:this.fb.array([])})}addStep(e,n){let o=this.fb.group({id:[n?.id],name:[{value:n?.name,disabled:!1},[I.required]],workflowId:[n?.workflowId]});this.steps.push(o)}removeStep(e){this.steps.removeAt(e)}saveWorkflowSteps(){if(this.stepFormGroup.invalid){this.stepFormGroup.markAllAsTouched();return}if(this.steps.value.length<2){this.toastrService.error(this.translationService.getValue("PLEASE_ADD_AT_LEAST_TWO_STEPS_TO_THE_WORKFLOW"));return}let e=this.steps.value.map(n=>ie(te({},n),{workflowId:this.currentWorkflow.id}));this.isWorkflowSetup?this.workflowStore.updateWorkflowStep(e):this.workflowStore.addWorkflowStep(e)}onPreviousClick(){this.workflowStore.setCurrentStep(0),this.router.navigate(["/workflow-settings/manage",this.currentWorkflow.id])}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-manage-step"]],standalone:!0,features:[M],decls:21,vars:10,consts:[[1,"content"],[1,"container-fluid"],[1,"row","align-items-center"],[1,"col-md-6","mb-2"],["class","mb-0 page-title",4,"ngIf"],[1,"card"],[1,"body"],[1,"row"],[3,"formGroup"],["formArrayName","steps"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"m-top-10","col-md-12"],["cdkFocusInitial","",1,"btn","btn-success","btn-sm","me-2",3,"click"],["name","arrow-right",1,"small-icon"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],["name","arrow-left",1,"small-icon"],[1,"mb-0","page-title"],["code","MANAGE_WORKFLOW"],[3,"formGroupName"],[1,"col-md-4","col-sm-12"],[1,"form-group"],["formControlName","name","type","text",1,"form-control",3,"blur","placeholder"],[4,"ngIf"],["class","btn btn-success btn-sm mt-2",3,"click",4,"ngIf"],["class","col-md-1",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"text-danger"],[1,"btn","btn-success","btn-sm","mt-2",3,"click"],["name","plus",1,"small-icon"],[1,"col-md-1"],["type","button","mat-icon-button","","color","warn",3,"click"]],template:function(n,o){n&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3),f(4,Ct,4,3,"span",4)(5,bt,4,3,"span",4),r()(),a(6,"div",5)(7,"div",6)(8,"div",7)(9,"form",8)(10,"div",9),f(11,Nt,12,10,"div",10),r(),a(12,"div",11)(13,"button",12),h("click",function(){return o.saveWorkflowSteps()}),p(14),s(15,"translate"),_(16,"i-feather",13),r(),a(17,"button",14),h("click",function(){return o.onPreviousClick()}),_(18,"i-feather",15),p(19),s(20,"translate"),r()()()()()()()()),n&2&&(i(4),c("ngIf",!((o.workflowSteps==null?null:o.workflowSteps.length)>0)),i(),c("ngIf",(o.workflowSteps==null?null:o.workflowSteps.length)>0),i(4),c("formGroup",o.stepFormGroup),i(2),c("ngForOf",o.steps.controls),i(3),u(" ",d(15,6,"NEXT")," "),i(5),u(" ",d(20,8,"PREVIOUS")," "))},dependencies:[O,le,F,N,P,L,R,A,B,G,D,pe,se,U,q,j,de,J,H,X,$,me,_e,Q,K,fe,ue,z,Z]})}}return t})();var Rt=()=>["/workflow-settings"];function At(t,m){t&1&&(a(0,"span",21),p(1),s(2,"translate"),_(3,"app-page-help-text",22),r()),t&2&&(i(),T(d(2,1,"ADD_WORKFLOW")))}function Bt(t,m){t&1&&(a(0,"span",21),p(1),s(2,"translate"),_(3,"app-page-help-text",22),r()),t&2&&(i(),T(d(2,1,"EDIT_WORKFLOW")))}function Lt(t,m){t&1&&(a(0,"div",24),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"NAME_IS_REQUIRED")," "))}function Gt(t,m){if(t&1&&(a(0,"div"),f(1,Lt,3,3,"div",23),r()),t&2){let e,n=g();i(),c("ngIf",(e=n.workFormGroup.get("name").errors)==null?null:e.required)}}function Dt(t,m){t&1&&(a(0,"div",24),p(1),s(2,"translate"),r()),t&2&&(i(),u(" ",d(2,1,"DESCRIPTION_IS_REQUIRED")," "))}function Vt(t,m){if(t&1&&(a(0,"div"),f(1,Dt,3,3,"div",23),r()),t&2){let e,n=g();i(),c("ngIf",(e=n.workFormGroup.get("description").errors)==null?null:e.required)}}var Je=(()=>{class t{constructor(){this.fb=S(V),this.workflowStore=S(C),this.router=S(y),this.currentWorkflow=this.workflowStore.currentWorkflow(),this.currentStep=0,W(()=>{let e=this.workflowStore.currentStep();e!==this.currentStep&&(this.currentStep=e,this.goToWorkflowStep())},{allowSignalWrites:!0})}ngOnInit(){this.createFirstFormGroup(),this.workFormGroup.patchValue(this.currentWorkflow)}createFirstFormGroup(){this.workFormGroup=this.fb.group({id:[""],name:["",I.required],description:["",I.required]})}goToWorkflowStep(){this.router.navigate(["/workflow-settings/manage/manage-steps"])}saveWorkflow(){if(this.workFormGroup.invalid){this.workFormGroup.markAllAsTouched();return}let e=this.createWorkflowBuildObject();e.id?this.workflowStore.updateWorkflow(e):this.workflowStore.addWorkflow(e)}createWorkflowBuildObject(){return{id:this.workFormGroup.get("id")?.value,name:this.workFormGroup.get("name")?.value,description:this.workFormGroup.get("description")?.value,isWorkflowSetup:!1,workflowSteps:[],transitions:[]}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=b({type:t,selectors:[["app-create-workflow"]],contentQueries:function(n,o,l){if(n&1&&(we(l,ve,5),we(l,ge,5)),n&2){let v;Y(v=ee())&&(o.manageStepComponent=v.first),Y(v=ee())&&(o.manageTransitionComponent=v.first)}},standalone:!0,features:[M],decls:35,vars:25,consts:[[1,"content"],[1,"container-fluid"],[1,"row","align-items-center"],[1,"col-md-6","mb-2"],["class","mb-0 page-title",4,"ngIf"],[1,"card"],[1,"body"],[3,"formGroup"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["for","name",1,"form-label"],["formControlName","name","type","text","required","",1,"form-control",3,"placeholder"],[4,"ngIf"],["for","description",1,"form-label"],["formControlName","description","type","text","required","",1,"form-control",3,"placeholder"],[1,"m-top-10","col-md-12"],["cdkFocusInitial","",1,"btn","btn-success","btn-sm","me-2",3,"click"],["name","arrow-right",1,"small-icon"],["type","button",1,"btn","btn-danger","btn-sm",3,"routerLink"],["name","x-circle",1,"small-icon"],[1,"mb-0","page-title"],["code","MANAGE_WORKFLOW"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(n,o){n&1&&(a(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3),f(4,At,4,3,"span",4)(5,Bt,4,3,"span",4),r()(),a(6,"div",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"label",11),p(13),s(14,"translate"),r(),_(15,"input",12),s(16,"translate"),f(17,Gt,2,1,"div",13),r()(),a(18,"div",9)(19,"div",10)(20,"label",14),p(21),s(22,"translate"),r(),_(23,"input",15),s(24,"translate"),f(25,Vt,2,1,"div",13),r()()(),a(26,"div",16)(27,"button",17),h("click",function(){return o.saveWorkflow()}),_(28,"i-feather",18),p(29),s(30,"translate"),r(),a(31,"button",19),_(32,"i-feather",20),p(33),s(34,"translate"),r()()()()()()()),n&2&&(i(4),c("ngIf",!(o.currentWorkflow!=null&&o.currentWorkflow.id)),i(),c("ngIf",o.currentWorkflow==null?null:o.currentWorkflow.id),i(3),c("formGroup",o.workFormGroup),i(5),T(d(14,12,"NAME")),i(2),E("placeholder",d(16,14,"WORKFLOW_NAME")),i(2),c("ngIf",o.workFormGroup.get("name").touched&&o.workFormGroup.get("name").errors),i(4),T(d(22,16,"DESCRIPTION")),i(2),E("placeholder",d(24,18,"DESCRIPTION")),i(2),c("ngIf",o.workFormGroup.get("description").touched&&o.workFormGroup.get("description").errors),i(4),u(" ",d(30,20,"NEXT")," "),i(2),c("routerLink",re(24,Rt)),i(2),u(" ",d(34,22,"CANCEL")," "))},dependencies:[O,F,N,ye,P,L,R,A,B,Ne,G,D,U,q,j,J,H,X,$,_e,Q,K,z,Z]})}}return t})();var Ye=(t,m)=>{let e=S(C),n=S(qe),o=t.paramMap.get("id");return o!=="add"?n.getWorkflow(o).pipe(Ve({next:l=>e.setCurrentWorkflow(l),error:l=>e.setError(l)})):(e.setCurrentWorkflowAsEmpty(),Ee(e.currentWorkflow()))};var wn=[{path:"manage-steps",component:ve,canActivate:[ce],data:{claimType:["WORKFLOW_ADD_WORKFLOW","WORKFLOW_UPDATE_WORKFLOW","WORKFLOW_DELETE_WORKFLOW"]}},{path:"manage-transitions",component:ge,canActivate:[ce],data:{claimType:["WORKFLOW_ADD_WORKFLOW","WORKFLOW_UPDATE_WORKFLOW","WORKFLOW_DELETE_WORKFLOW"]}},{path:":id",resolve:{workflow:Ye},component:Je,canActivate:[ce],data:{claimType:["WORKFLOW_ADD_WORKFLOW","WORKFLOW_UPDATE_WORKFLOW","WORKFLOW_DELETE_WORKFLOW"]}}];export{wn as WORKFLOW_ROUTES};
