import{a as x,b as ht}from"./chunk-OQMHZKXL.js";import{a as Ct}from"./chunk-5DGY2OXT.js";import{a as gt}from"./chunk-VBYTSXUA.js";import"./chunk-EDFYBFRY.js";import{a as M,b as St,c as vt}from"./chunk-MDTWJNMV.js";import{a as T,b as xt}from"./chunk-FUBOQZYU.js";import{a as bt,b as Rt,c as It,d as Et,e as Nt,f as wt,g as Mt,h as Tt,i as Dt,j as yt,k as Ot,l as Lt,m as kt,n as jt,o as Ft,p as At}from"./chunk-ZQ2PWCHX.js";import"./chunk-TNLJ7CAF.js";import{a as _t}from"./chunk-DXCWD2WZ.js";import{D as pt,F as lt,J as ft,K as ut,f as mt}from"./chunk-VNAU6AHI.js";import{c as ot,d as ct,e as dt}from"./chunk-2GYG6N64.js";import"./chunk-YTVNRIZ3.js";import{L as nt}from"./chunk-3XAX4OT5.js";import{ia as it,ja as st}from"./chunk-NF46UI75.js";import{p as at,t as rt}from"./chunk-SIUWMJOE.js";import"./chunk-GTE6R5NX.js";import"./chunk-FGSJTZPD.js";import"./chunk-73F4PDV3.js";import"./chunk-TMWBOQE5.js";import{$ as U,$b as E,Ab as f,Ac as l,B as A,Bc as X,Ea as V,Fa as I,Gb as G,Gd as et,Jd as j,Kb as s,L as B,Lb as c,Mb as S,Na as Q,Nb as v,O as H,Oa as W,Ob as g,Qb as K,S as P,Tb as Y,Vb as h,W as $,Yb as J,Zc as Z,a as F,ac as N,ba as z,bc as w,gc as a,hc as C,ib as i,ic as m,jb as _,jd as tt,p as b,qa as L,sc as k,tb as q,wa as R,wb as u,zc as p}from"./chunk-EOQA7B6X.js";var D=class{get count(){return this._count}constructor(o){this.notificationService=o,this.notificationsSubject=new b([]),this.responseHeaderSubject=new b(null),this.loadingSubject=new b(!1),this.loading$=this.loadingSubject.asObservable(),this._count=0,this.responseHeaderSubject$=this.responseHeaderSubject.asObservable()}connect(o){return this.notificationsSubject.asObservable()}disconnect(o){this.notificationsSubject.complete(),this.loadingSubject.complete()}loadNotifications(o){this.loadingSubject.next(!0),this.notificationService.getNotifications(o).pipe(P(()=>A([])),z(()=>this.loadingSubject.next(!1))).subscribe(e=>{let n=new Ct;n.pageSize=parseInt(e.headers.get("pageSize")),n.totalCount=parseInt(e.headers.get("totalCount")),n.skip=parseInt(e.headers.get("skip")),this.responseHeaderSubject.next(F({},n));let r=[...e.body];this._count=r.length,this.notificationsSubject.next(r)})}};var Ut=["input"],zt=()=>["footer"],Vt=()=>[10,20,30];function Qt(t,o){t&1&&(s(0,"th",30),a(1),p(2,"translate"),c()),t&2&&(i(),m(" ",l(2,1,"ACTION")," "))}function Wt(t,o){if(t&1){let e=K();s(0,"button",33),Y("click",function(){Q(e);let r=h().$implicit,d=h();return W(d.viewNotification(r))}),S(1,"i",34),a(2),p(3,"translate"),c()}t&2&&(i(2),m(" ",l(3,1,"VIEW_DOCUMENT")," "))}function qt(t,o){if(t&1&&(s(0,"td",31),u(1,Wt,4,3,"button",32),c()),t&2){let e=o.$implicit;i(),f("ngIf",e.documentId)}}function Gt(t,o){t&1&&(s(0,"th",30),a(1),p(2,"translate"),c()),t&2&&(i(),m(" ",l(2,1,"DATE")," "))}function Kt(t,o){if(t&1&&(s(0,"td",31),a(1),p(2,"utcToLocalTime"),c()),t&2){let e=o.$implicit;i(),m(" ",X(2,1,e.createdDate,"short")," ")}}function Yt(t,o){t&1&&(s(0,"th",30),a(1),p(2,"translate"),c()),t&2&&(i(),m(" ",l(2,1,"MESSAGE")," "))}function Jt(t,o){t&1&&(s(0,"span",36),a(1,"new"),c())}function Xt(t,o){if(t&1&&(s(0,"b"),a(1),c(),a(2),p(3,"translate")),t&2){let e=h().$implicit;i(),m(" ",e.documentName,""),i(),m(" ",l(3,2,"DOCUMENT_PERMISSION_GRANTED_TO_YOU")," ")}}function Zt(t,o){if(t&1&&(v(0),s(1,"b"),a(2),p(3,"translate"),c(),a(4),g()),t&2){let e=h(2).$implicit;i(2),m(" ",l(3,2,"DOCUMENT_NAME"),""),i(2),m(" : ",e.documentName," :: ")}}function te(t,o){if(t&1&&(s(0,"b"),a(1),p(2,"translate"),c(),a(3," :: "),u(4,Zt,5,4,"ng-container",37),a(5)),t&2){let e=h().$implicit;i(),C(l(2,3,"REMINDER")),i(3),f("ngIf",e.documentId),i(),m(" ",e.message," ")}}function ee(t,o){if(t&1&&(a(0),p(1,"translate"),s(2,"strong"),a(3),c(),a(4),p(5,"translate")),t&2){let e=h().$implicit;m(" ",l(1,3,"FILE_REQUEST_WITH_SUBJECT")," "),i(3),C(e.fileRequestSubject),i(),m(" ",l(5,5,"HAS_BEEN_UPDATED"),". ")}}function ie(t,o){if(t&1&&(a(0),p(1,"translate"),s(2,"strong"),a(3),c(),a(4),p(5,"translate"),s(6,"strong"),a(7),c(),a(8),p(9,"translate")),t&2){let e=h().$implicit;m(" ",l(1,5,"WORKFLOW_MESSAGE_1")," "),i(3),C(e.workflowDocumentName),i(),m(" ",l(5,7,"WORKFLOW_MESSAGE_2")," "),i(3),C(e.workflowName),i(),m(" ",l(9,9,"WORKFLOW"),". ")}}function oe(t,o){if(t&1&&(s(0,"td",31),u(1,Jt,2,0,"span",35)(2,Xt,4,4)(3,te,6,5)(4,ee,6,7)(5,ie,10,11),c()),t&2){let e,n=o.$implicit;i(),f("ngIf",!n.isRead),i(),G((e=n.notificationType)===0?2:e===1?3:e===2?4:e===3?5:-1)}}function ne(t,o){if(t&1&&(s(0,"td",38),S(1,"mat-paginator",39),c()),t&2){let e=h();i(),f("length",e.notificationResource.totalCount)("pageSize",e.notificationResource.pageSize)("pageSizeOptions",k(3,Vt))}}function ae(t,o){t&1&&S(0,"tr",40)}function re(t,o){t&1&&S(0,"tr",41)}function se(t,o){t&1&&S(0,"tr",42)}function ce(t,o){t&1&&(s(0,"tr")(1,"td",43)(2,"div",44)(3,"b"),a(4),p(5,"translate"),c()()()()),t&2&&(i(4),m(" ",l(5,1,"NO_DATA_FOUND"),""))}var Ht=(()=>{class t extends it{constructor(e,n,r,d,y,O,$t){super(),this.notificationService=e,this.overlay=n,this.documentService=r,this.toastrService=d,this.router=y,this.commonService=O,this.translationService=$t,this.notifications=[],this.displayedColumns=["action","createdDate","message"],this.notificationResource=new gt,this.notificationResource.pageSize=10,this.notificationResource.orderBy="createdDate desc"}ngOnInit(){this.dataSource=new D(this.notificationService),this.dataSource.loadNotifications(this.notificationResource),this.getResourceParameter()}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),this.sub$.sink=H(this.sort.sortChange,this.paginator.page).pipe(L(()=>{this.notificationResource.skip=this.paginator.pageIndex*this.paginator.pageSize,this.notificationResource.pageSize=this.paginator.pageSize,this.notificationResource.orderBy=this.sort.active+" "+this.sort.direction,this.dataSource.loadNotifications(this.notificationResource)})).subscribe(),this.sub$.sink=B(this.input.nativeElement,"keyup").pipe($(1e3),U(),L(()=>{this.paginator.pageIndex=0,this.notificationResource.skip=0,this.notificationResource.name=this.input.nativeElement.value,this.dataSource.loadNotifications(this.notificationResource)})).subscribe(),this.notificationService.markAllAsRead().subscribe(()=>{})}getResourceParameter(){this.sub$.sink=this.dataSource.responseHeaderSubject$.subscribe(e=>{e&&(this.notificationResource.pageSize=e.pageSize,this.notificationResource.skip=e.skip,this.notificationResource.totalCount=e.totalCount)})}viewNotification(e){e.isRead||(this.sub$.sink=this.notificationService.markAsRead(e.id).subscribe()),e.isRead=!0,e.notificationType==x.DOCUMENT_SHARE?this.commonService.checkDocumentPermission(e.documentId).subscribe(n=>{if(!n){this.toastrService.error(this.translationService.getValue("DOCUMENT_PERMISSION_ERROR"));return}this.sub$.sink=this.documentService.getDocument(e.documentId).subscribe(r=>{if(!r||Object.keys(r).length==0){this.toastrService.error(this.translationService.getValue("DOCUMENT_PERMISSION_ERROR"));return}let y=r.url.split(".")[1],O={documentId:r.id,name:r.name,extension:y,isVersion:!1,isFromPublicPreview:!1,isPreviewDownloadEnabled:!1,isFromFileRequest:!1};this.overlay.open(ct,{position:"center",origin:"global",panelClass:["file-preview-overlay-container","white-background"],data:O})})}):e.notificationType==x.FILE_REQUEST?this.router.navigate(["/file-request"]):e.notificationType==x.WORKFLOW?this.router.navigate(["/current-workflow"]):e.notificationType==x.REMINDER&&this.router.navigate(["/reminders"])}static{this.\u0275fac=function(n){return new(n||t)(_(ht),_(ot),_(dt),_(at),_(et),_(nt),_(st))}}static{this.\u0275cmp=V({type:t,selectors:[["app-notification-list"]],viewQuery:function(n,r){if(n&1&&(E(T,5),E(M,5),E(Ut,5)),n&2){let d;N(d=w())&&(r.paginator=d.first),N(d=w())&&(r.sort=d.first),N(d=w())&&(r.input=d.first)}},features:[q],decls:39,vars:14,consts:[["input",""],[1,"content"],[1,"content-block"],[1,"block-header"],[1,"breadcrumb-main"],[1,"row"],[1,"col-md-6","mb-2"],[1,"mb-0","page-title"],[3,"code"],[1,"col-xl-12","col-lg-12","col-md-12","col-sm-12"],[1,"card"],[1,"body"],[1,"row","margin-2"],[1,"col-md-6"],[1,"form-control",3,"placeholder"],[1,"col"],[1,"table-responsive"],[1,"grid-height-medium"],["mat-table","","matSort","","matSortActive","createdDate","matSortDirection","desc",1,"w-100",3,"dataSource"],["matColumnDef","action"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","createdDate"],["matColumnDef","message"],["matColumnDef","footer"],["mat-footer-cell","","colspan","4",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef","matFooterRowDefSticky"],[4,"matNoDataRow"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["type","button","class","btn btn-sm btn-success",3,"click",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-success",3,"click"],[1,"las","la-eye"],["class","badge bg-success me-2",4,"ngIf"],[1,"badge","bg-success","me-2"],[4,"ngIf"],["mat-footer-cell","","colspan","4"],[3,"length","pageSize","pageSizeOptions"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],["colspan","4"],[1,"m-2"]],template:function(n,r){n&1&&(s(0,"section",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"span",7),a(7),p(8,"translate"),S(9,"app-page-help-text",8),c()()()()(),s(10,"div",5)(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13),S(16,"input",14,0),p(18,"translate"),c()(),s(19,"div",5)(20,"div",15)(21,"div",16)(22,"div",17)(23,"table",18),v(24,19),u(25,Qt,3,3,"th",20)(26,qt,2,1,"td",21),g(),v(27,22),u(28,Gt,3,3,"th",20)(29,Kt,3,4,"td",21),g(),v(30,23),u(31,Yt,3,3,"th",20)(32,oe,6,2,"td",21),g(),v(33,24),u(34,ne,2,4,"td",25),g(),u(35,ae,1,0,"tr",26)(36,re,1,0,"tr",27)(37,se,1,0,"tr",28)(38,ce,6,3,"tr",29),c()()()()()()()()()()()),n&2&&(i(7),m("",l(8,9,"NOTIFICATIONS")," "),i(2),f("code","NOTIFICATIONS"),i(7),J("placeholder",l(18,11,"SEARCH_BY_DOCUMENT_NAME_OR_MESSAGE")),i(7),f("dataSource",r.dataSource),i(12),f("matHeaderRowDef",r.displayedColumns)("matHeaderRowDefSticky",!0),i(),f("matRowDefColumns",r.displayedColumns),i(),f("matFooterRowDef",k(13,zt))("matFooterRowDefSticky",!0))},dependencies:[Z,ft,bt,It,Dt,Nt,Rt,Ot,Et,yt,wt,Tt,Mt,Lt,jt,kt,Ft,M,St,T,rt,mt]})}}return t})();var me=[{path:"",component:Ht,canActivate:[_t]}],Pt=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=R({imports:[j.forChild(me),j]})}}return t})();var Ze=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=I({type:t})}static{this.\u0275inj=R({imports:[tt,ut,Pt,At,lt,vt,xt,pt]})}}return t})();export{Ze as NotificationModule};
