import{a as f,b as p,c as d}from"./chunk-FGSJTZPD.js";import{c as k}from"./chunk-73F4PDV3.js";import{Gd as m,S as a,Z as c,p as n,qa as l,rd as u,va as h,ya as s}from"./chunk-EOQA7B6X.js";var w=(()=>{class o{get SecurityObject(){return this.securityObject$.asObservable()}get companyProfile(){return this._companyProfile$}get Token(){return this._token?this._token:(this._token=this.licenseValidatorService.getJWtToken(),this._token)}get Claims(){return this._claims?this._claims:(this._claims=this.Token?.claims,this._claims??[])}constructor(e,t,i,r,v){this.http=e,this.clonerService=t,this.commonHttpErrorService=i,this.router=r,this.licenseValidatorService=v,this.securityObject$=new n(null),this._companyProfile$=new n(null),this._token=null,this._claims=null,this.isRefreshingToken=!1}isLogin(){let e=this.licenseValidatorService.getAuthObject(),t=this.licenseValidatorService.getBearerToken();return e&&t?(setTimeout(()=>{this.refreshToken()},1e3),!0):!1}login(e){return this.http.post("auth/login",e).pipe(l(t=>{this.tokenTime=new Date;let i=this.clonerService.deepClone(t);this.licenseValidatorService.setTokenUserValue(i),t.isAuthenticated=this.licenseValidatorService.getAuthObject()!=null,this.securityObject$.next(i.user),this.refreshToken()})).pipe(a(this.commonHttpErrorService.handleError))}refreshToken(){let e=new Date;e.setMinutes(e.getMinutes()-f.tokenExpiredTimeInMin);let t;this.clearTimeOutData||clearTimeout(this.clearTimeOutData),this.tokenTime?t=Math.abs(this.tokenTime.getTime()-e.getTime()):(t=6e4,this.tokenTime=new Date),this.clearTimeOutData=setTimeout(()=>{clearTimeout(this.clearTimeOutData),this.refresh().pipe(c(1e3)).subscribe(i=>{if(!i)return;this.tokenTime=new Date;let r=this.clonerService.deepClone(i);this.licenseValidatorService.setTokenUserValue(r),this.securityObject$.next(r.user),this.refreshToken()})},t)}refresh(){return this.isRefreshingToken?null:(this.isRefreshingToken=!0,this.http.post("auth/refresh",{}).pipe(l(e=>{let t=this.clonerService.deepClone(e);this.licenseValidatorService.setTokenUserValue(t),this.securityObject$.next(t.user),this.isRefreshingToken=!1},()=>{},()=>{this.isRefreshingToken=!1})).pipe(a(this.commonHttpErrorService.handleError)))}logout(){this.resetSecurityObject()}updateProfile(e){this._companyProfile$.next(e)}resetSecurityObject(){localStorage.removeItem(this.licenseValidatorService.keyValues.authObj),localStorage.removeItem(this.licenseValidatorService.keyValues.bearerToken),this.securityObject$.next(null),this._token=null,this._claims=null,this.router.navigate(["/login"])}hasClaim(e){let t=!1;if(typeof e=="string")t=this.isClaimValid(e);else{let i=e;if(i)for(let r=0;r<i.length&&(t=this.isClaimValid(i[r]),!t);r++);}return t}isClaimValid(e){let t=!1;return e.indexOf(":")>=0?e=e.split(":")[0].toLowerCase():e=e.toLowerCase(),t=this.Claims?.find(i=>i.toLowerCase()==e)!=null,t}getUserDetail(){return this.licenseValidatorService.getAuthObject()}setUserDetail(e){this.licenseValidatorService.setTokenUserValue({user:this.clonerService.deepClone(e)})}static{this.\u0275fac=function(t){return new(t||o)(s(u),s(d),s(p),s(m),s(k))}}static{this.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{w as a};
