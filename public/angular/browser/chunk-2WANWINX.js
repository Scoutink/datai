import{a as s,b as u}from"./chunk-PSHPNFJ6.js";import{a as i,b as M,c as R,d as x,e as D,f as K,g as b,h as I}from"./chunk-EST3G7IM.js";import{L as P}from"./chunk-3XAX4OT5.js";import{ja as L}from"./chunk-NF46UI75.js";import{p as j}from"./chunk-SIUWMJOE.js";import{b as v}from"./chunk-FGSJTZPD.js";import{$ as F,Nc as C,Pc as A,S as c,W as $,a as p,ab as T,b as y,l,ld as O,na as a,rd as k,va as E,xa as N,ya as S,za as h}from"./chunk-EOQA7B6X.js";var z=(()=>{class e{constructor(o,n){this.httpClient=o,this.commonHttpErrorService=n}getWorkflows(){return this.httpClient.get("workflow").pipe(c(this.commonHttpErrorService.handleError))}getWorkflow(o){let n=`workflow/${o}`;return this.httpClient.get(n).pipe(c(this.commonHttpErrorService.handleError))}addWorkflow(o){return this.httpClient.post("workflow",o).pipe(c(this.commonHttpErrorService.handleError))}updateWorkflow(o){let n=`workflow/${o.id}`;return this.httpClient.put(n,o).pipe(c(this.commonHttpErrorService.handleError))}deleteWorkflow(o){let n=`workflow/${o}`;return this.httpClient.delete(n).pipe(c(this.commonHttpErrorService.handleError))}getvisualWorkflow(o){let n=`workflow/${o}/visualWorkflow`;return this.httpClient.get(n).pipe(c(this.commonHttpErrorService.handleError))}static{this.\u0275fac=function(n){return new(n||e)(S(k),S(v))}}static{this.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var de=new N("Array contain existing names for the signal stores",{factory:()=>[],providedIn:"root"});var fe=Symbol("DEVTOOLS_FEATURE");var _=()=>{},J={clearStorage:_,readFromStorage:_,writeToStorage:_};function B(e){let{key:d,autoSync:o=!0,select:n=r=>r,parse:f=JSON.parse,stringify:m=JSON.stringify,storage:W=()=>localStorage}=typeof e=="string"?{key:e}:e;return x(b((r,t=h(T))=>{if(O(t))return console.warn("'withStorageSync' provides non-functional implementation due to server-side execution"),J;let w=W();return{clearStorage(){w.removeItem(d)},readFromStorage(){let g=w.getItem(d);g&&i(r,f(g))},writeToStorage(){let g=n(M(r));w.setItem(d,m(g))}}}),K({onInit(r,t=h(T)){O(t)||o&&(r.readFromStorage(),A(()=>{r.writeToStorage()}))}}))}var pe=x(I({}));var Y=(()=>{class e{constructor(o,n){this.httpClient=o,this.commonHttpErrorService=n}getWorkflowSteps(){return this.httpClient.get("WorkflowStep").pipe(c(this.commonHttpErrorService.handleError))}getWorkflowStep(o){let n=`WorkflowStep/${o}`;return this.httpClient.get(n).pipe(c(this.commonHttpErrorService.handleError))}addWorkflowStep(o){return this.httpClient.post("workflowStep",o).pipe(c(this.commonHttpErrorService.handleError))}updateWorkflowStep(o){let f=`workflowStep/${o[0].workflowId}`;return this.httpClient.put(f,o).pipe(c(this.commonHttpErrorService.handleError))}deleteWorkflowStep(o){let n=`WorkflowStep/${o}`;return this.httpClient.delete(n).pipe(c(this.commonHttpErrorService.handleError))}static{this.\u0275fac=function(n){return new(n||e)(S(k),S(v))}}static{this.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var X=(()=>{class e{constructor(o,n){this.httpClient=o,this.commonHttpErrorService=n}getWorkflowTransitions(){return this.httpClient.get("WorkflowTransition").pipe(c(this.commonHttpErrorService.handleError))}getWorkflowTransition(o){let n=`workflow/${o}/transitions`;return this.httpClient.get(n).pipe(c(this.commonHttpErrorService.handleError))}addWorkflowTransition(o){return this.httpClient.post("workflowTransition",o).pipe(c(this.commonHttpErrorService.handleError))}updateWorkflowTransition(o){let f=`workflowTransitions/${o[0].workflowId}`;return this.httpClient.put(f,o).pipe(c(this.commonHttpErrorService.handleError))}deleteWorkflowTransition(o){let n=`WorkflowTransition/${o}`;return this.httpClient.delete(n).pipe(c(this.commonHttpErrorService.handleError))}static{this.\u0275fac=function(n){return new(n||e)(S(k),S(v))}}static{this.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var q={workflows:[],commonError:null,currentWorkflow:null,roles:[],currentStep:0,isEditMode:!1,users:[]},_e=R({providedIn:"root"},I(q),B({key:"workflows",autoSync:!0,storage:()=>sessionStorage}),D(({workflows:e})=>({sortedWorkflows:C(()=>e().sort((d,o)=>d.name.localeCompare(o.name))),activeWorkflows:C(()=>e().filter(d=>d.isWorkflowSetup).sort((d,o)=>d.name.localeCompare(o.name)))})),b((e,d=h(z),o=h(X),n=h(Y),f=h(j),m=h(L),W=h(P))=>({loadWorkflows:u(l($(300),a(()=>d.getWorkflows().pipe(s({next:r=>{i(e,{workflows:[...r],commonError:null})},error:r=>{i(e,{commonError:r}),console.error(r)}}))))),deleteWorkflowById:u(l(F(),a(r=>d.deleteWorkflow(r).pipe(s({next:()=>{f.success(m.getValue("WORKFLOW_DELETED_SUCCESSFULLY")),i(e,{workflows:e.workflows().filter(t=>t.id!==r)})},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),addWorkflow:u(l(a(r=>d.addWorkflow(r).pipe(s({next:t=>{i(e,{workflows:[...e.workflows(),p({},t)],commonError:null,currentWorkflow:p({},t),currentStep:1}),f.success(m.getValue("WORKFLOW_CREATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),updateWorkflow:u(l(a(r=>d.updateWorkflow(r).pipe(s({next:t=>{let w=e.currentWorkflow();t.name=t.name,t.description=t.description,i(e,{currentWorkflow:p({},w),workflows:[...e.workflows().filter(g=>g.id!==t.id),w],commonError:null,currentStep:1}),f.success(m.getValue("WORKFLOW_UPDATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),getCurrentWorkflow:()=>e.currentWorkflow(),setCurrentWorkflow:r=>{i(e,{currentWorkflow:p({},r),isEditMode:!0})},setError:r=>{i(e,{commonError:p({},r)})},getWorkflowById:u(l(a(r=>d.getWorkflow(r).pipe(s({next:t=>{i(e,{currentWorkflow:t,commonError:null})},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),addWorkflowStep:u(l(a(r=>n.addWorkflowStep(r).pipe(s({next:t=>{i(e,{currentWorkflow:y(p({},e.currentWorkflow()),{workflowSteps:[...t]}),currentStep:2}),f.success(m.getValue("WORKFLOW_STEP_CREATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),updateWorkflowStep:u(l(a(r=>n.updateWorkflowStep(r).pipe(s({next:t=>{i(e,{currentWorkflow:y(p({},e.currentWorkflow()),{workflowSteps:[...t],transitions:[...e.currentWorkflow().transitions]}),workflows:[...e.workflows().filter(w=>w.id!==t[0].workflowId),y(p({},e.currentWorkflow()),{workflowSteps:[...t],transitions:[...e.currentWorkflow().transitions]})],currentStep:2}),f.success(m.getValue("WORKFLOW_STEP_UPDATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),deleteWorkflowStep:u(l(a(r=>n.deleteWorkflowStep(r).pipe(s({next:()=>{f.success(m.getValue("WORKFLOW_STEP_DELETED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),getWorkflowStepById:u(l(a(r=>n.getWorkflowStep(r).pipe(s({next:()=>{},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),addWorkflowTransition:u(l(a(r=>o.addWorkflowTransition(r).pipe(s({next:t=>{i(e,{currentWorkflow:y(p({},e.currentWorkflow()),{transitions:[...t]}),currentStep:0,commonError:null}),f.success(m.getValue("WORKFLOW_TRANSITION_CREATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),updateWorkflowTransition:u(l(a(r=>o.updateWorkflowTransition(r).pipe(s({next:t=>{i(e,{currentWorkflow:y(p({},e.currentWorkflow()),{transitions:[...t]}),currentStep:0,commonError:null}),f.success(m.getValue("WORKFLOW_TRANSITION_UPDATED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),getWorkflowTransitionById:u(l(a(r=>o.getWorkflowTransition(r).pipe(s({next:()=>{i(e,{})},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),deleteWorkflowTransition:u(l(a(r=>o.deleteWorkflowTransition(r).pipe(s({next:()=>{f.success(m.getValue("WORKFLOW_TRANSITION_DELETED_SUCCESSFULLY"))},error:t=>{i(e,{commonError:t}),console.error(t)}}))))),getRoles:u(l(a(()=>W.getRolesForDropdown().pipe(s({next:r=>{i(e,{roles:[...r]})},error:r=>{i(e,{commonError:r}),console.error(r)}}))))),getUsers:u(l(a(()=>W.getUsersForDropdown().pipe(s({next:r=>{i(e,{users:[...r]})},error:r=>{i(e,{commonError:r}),console.error(r)}}))))),setCurrentWorkflowAsEmpty:()=>{i(e,{currentWorkflow:{id:"",name:"",description:"",isWorkflowSetup:!1,workflowSteps:[],transitions:[]},currentStep:0})},setCurrentStep:r=>{i(e,{currentStep:r})}})),K({onInit(e){e.getRoles(),e.getUsers(),!sessionStorage.getItem("workflows")&&e.loadWorkflows()},onDestroy(e){i(e,{currentWorkflow:null,currentStep:0})}}));export{z as a,_e as b};
